;var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],s=!0,o=!1,a=void 0;try{for(var n,r=e[Symbol.iterator]();!(s=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);s=!0);}catch(e){o=!0,a=e}finally{try{!s&&r.return&&r.return()}finally{if(o)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,s=arguments[t];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(a,n){return function t(e,i){try{var s=r[e](i),o=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});a(o)}("next")})}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}CgsEvent=function(e){this.type=e,this.timeStamp=(new Date).getTime()},CgsEvent.eMapInstanceCreated="mapinstancecreated",CgsEvent.eMapModeChanged="modechanged",CgsEvent.eFeatureClick="featureclick",CgsEvent.eFeatureClickOut="featureclickout",CgsEvent.eKMLSelected="kmlfeatureSelected",CgsEvent.eSymbolInitFinised="esymbolinitfinised",CgsEvent.eSymbolInitFinished="jmpinitcompleted",CgsEvent.eMapConfigReady="emapconfigready",CgsEvent.eUIReady="uiready",CgsEvent.eMapReady="mapready",CgsEvent.eInitMapComplete="initmapcomplete",CgsEvent.eSymbolAdd="symbolnodeadd",CgsEvent.eSymbolDelete="symbolnodedeleted",CgsEvent.eSymbolNodeClick="esymbolnodeclick",CgsEvent.eSymbolNodeRightClick="esymbolnoderightclick",CgsEvent.eSymbolNodeDbClick="esymbolnodedbclick",CgsEvent.eSymbolLayerAdd="eSymbolLayerAdd",CgsEvent.eSymbolLayerDeleted="eSymbolLayerDeleted",CgsEvent.eSymbolClick="esymbolclick",CgsEvent.eSymbolRightClick="esymbolrightclick",CgsEvent.eSymbolDbClick="esymboldbclick",CgsEvent.eSymbolNodeDoff="pullsymbol",CgsEvent.eConfigLoaded="configloaded",CgsEvent.eConfigLoaded="configloaded",CgsEvent.ePostrender="postrender",CgsEvent.eLayerVisibleChanged="layervisiblechanged",CgsEvent.eFeatureDrawnByMouse="featuredrawnbymouse",CgsEvent.eMove="move",CgsEvent.eMoveEnd="moveend",CgsEvent.eViewPoint="viewpoint",CgsEvent.eModeChanged="modechanged",CgsEvent.eLayerAdded="layeradded",CgsEvent.eLayerRemoved="layerremoved",CgsEvent.eSelectEnd="selectend",CgsEvent.eFeatureAdded="featureadded",CgsEvent.eFeatureRemoved="featureremoved",CgsEvent.eFeatureClick="featureclick",CgsEvent.eFeatureHover="featurehover",CgsEvent.eFeatureLeave="featureleave",CgsEvent.eKMLFeatureHover="kmlfeaturehover",CgsEvent.eKMLFeatureLeave="kmlfeatureleave",CgsEvent.eFeatureRightClick="featurerightclick",CgsEvent.eFeatureDoubleClick="featuredoubleclick",CgsEvent.eFeatureClickOut="featureclickout",CgsEvent.eFeatureRightClickOut="featurerightclickout",CgsEvent.eInitMapComplete="initmapcomplete",CgsEvent.eZoomChanged="zoomchanged",CgsEvent.eSymbolValChange="symbolvalchange",CgsEvent.eFeatureCtrlClick="ctrl_featureSelected";var CgsSubPub={idUsed:0,idMap:{},subscribe:function(e,t){this.idUsed+=1;var i=this.idUsed;this._callbacks||(this._callbacks={});return(this._callbacks[e]||(this._callbacks[e]=[])).push([i,t]),this.idMap[i]=e,i},unsubscribe:function(e){var t,i;if(!(t=this.idMap[e]))return e;for(delete this.idMap[e],i=this._callbacks[t].length-1;-1<i;i--)if(this._callbacks[t][i][0]==e)return this._callbacks[t].splice(i,1),e},publish:function(e,t){var i=Array.prototype.slice.call(arguments,0);"[object Array]"!=Object.prototype.toString.call(i[1])&&(i[1]=[i[1]]),i[1].splice(0,0,i[0]);var s,o,a=(i=i[1])[0],e=new CgsEvent(a);if(i.splice(0,1,e),!this._callbacks)return this;if(!(s=this._callbacks[a]))return this;for(o=s.length-1;-1<o;o--)try{s[o][1].apply(this,i)}catch(e){console.error(e),console.trace()}return this}};CgsInherits=function(e,t){var i=Object.create(t.prototype);(i.constructor=e).prototype=i},CgsExtend=function(e,t){var i,s=t.prototype,o=e.prototype;for(i in s)o[i]=s[i];o.constructor=e},CgsConfigLoader=function(e){this.map=e},CgsConfigLoader.prototype.load=function(e){var a=this;null==e&&(e=CGS_SDK_PATH+"configFile/layerConfig.json"),$$.ajax({dataType:"json",async:!1,url:e,success:function(e){if(null!=e.toolbarPlugg&&e.toolbarPlugg.visible&&(a.map.toolbarPlugg=new CgsToolbarPlugg(a.map,e.toolbarPlugg),a.map.toolbarPlugg.activate()),null!=e.treeNodes&&(a.map.treeNodes=e.treeNodes),null!=e.layerNodes)for(var t=0;t<e.layerNodes.length;t++){var i=null,s=null;switch(e.layerNodes[t].type){case"wmts":i=new CgsTileLayer(e.layerNodes[t]);break;case"wms":i=new CgsWMSLayer(e.layerNodes[t]);break;case"wfs":e.layerNodes[t].mapObject=a.map,i=new CgsWFSLayer(e.layerNodes[t]);break;case"kml":e.layerNodes[t].mapObject=a.map,s=new CgsKml(e.layerNodes[t]);break;case"czml":e.layerNodes[t].mapObject=a.map,s=new CgsCzml(e.layerNodes[t]);break;case"geojson":e.layerNodes[t].mapObject=a.map,s=new CgsGeoJson(e.layerNodes[t]);break;case"image":i=new CgsImageLayer(e.layerNodes[t]);break;case"imagewms":i=new CgsImageWMSLayer(e.layerNodes[t]);break;case"xyz":i=new CgsXYZLayer(e.layerNodes[t])}null!=i&&a.map.addLayer(i),null!=s&&a.map.addDataSource(s)}var o;null!=e.modelNodes&&((o={modeGroup:null,modelList:null}).modeGroup=e.modelNodes.modelGroup,o.modelList=e.modelNodes.modelList,a.map.setModelPluggInfo(o),o=null),CgsSubPub.publish("configloaded")},error:a.onError})},CgsConfigLoader.prototype.onError=function(e,t,i){console.error("mapconfig read error:"+t+"\n"+i)},CgsConfigLoader.loadJSONFile=function(filePath,varName){return new Promise(function(ok,no){var that=this;filePath||console.warn("请输入文件路径!"),$$.ajax({dataType:"text",async:!1,url:filePath,success:function success(text){var obj=null;eval("obj = "+text),varName&&(CgsMap[varName]=obj),ok(obj)},error:function(e){console.log("加载配置文件失败",e)}})})};var CgsLog=function(){function e(e){this.options=e,this.jsinfo=console.info,this.jslog=console.log,this.options.enable&&(console.log=function(){},console.info=function(){})}return e.prototype.log=function(e,t){var i,s;!1!==this.options.enable&&(""!==this.options.tag&&this.options.tag!==e||(this.options.trace,i="",this.options.beauty&&(i=" ┌─────────────────────────────────"),s="",this.options.beauty&&(s="└─────────────────────────────────"),this.jslog(i,"\r\n","    标签",e,"\r\n","    ",t,"\r\n",s),this.options.trace&&console.trace("调用栈:")))},e}(),CgsIds;window.logger=new CgsLog({tag:"aaa",trace:!1,beauty:!0,enable:!1}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsUtil=t()}(window,function(){var x_PI=52.35987755982988,PI=3.141592653589793,a=6378245,ee=.006693421622965943,CgsUtil=function(){};function getTriangleArea(e,t,i){var s=Cesium.Cartesian3.distance(e,t),o=Cesium.Cartesian3.distance(t,i),a=Cesium.Cartesian3.distance(i,e),n=(s+o+a)/2;return Math.sqrt(n*(n-s)*(n-o)*(n-a))}function computedOffsetData(e,t,i){var s=new Cesium.Ray(e,t);return Cesium.Ray.getPoint(s,i,new Cesium.Cartesian3)}CgsUtil.getCesiumValue=function(e,t,i){if(!e)return e;if(t){if(e instanceof t)return e;if(e._value&&e._value instanceof t)return e._value}return"function"==typeof e.getValue?e.getValue(i||Cesium.JulianDate.now()):e},CgsUtil.create=function(e,t,i){var s=document.createElement(e);return s.className=t||"",i&&i.appendChild(s),s},CgsUtil.createSvg=function(e,t,i,s){var o=document.createElementNS("http://www.w3.org/2000/svg","svg:svg");o.setAttribute("class","svg-path"),o.setAttribute("width",e),o.setAttribute("height",t),o.setAttribute("viewBox","0 0 "+e+" "+t);var a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",i),o.appendChild(a),s&&s.appendChild(o),o},CgsUtil.createVideo=function(e,t,i,s){var o=CgsUtil.create("video",i,s),a=CgsUtil.create("source","",o);return a.setAttribute("src",e),a.setAttribute("type","video/"+t),o},CgsUtil.get=function(e){return"string"==typeof e?document.getElementById(e):e},CgsUtil.parseDom=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",s=document.createElement("div");return s.className=i,s.innerHTML=e,t?s:s.childNodes},CgsUtil.remove=function(e){var t;!(e=get(e))||(t=e.parentNode)&&t.removeChild(e)},CgsUtil.empty=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},CgsUtil.getStyle=function(e,t){var i,s=e.style[t]||e.currentStyle&&e.currentStyle[t];return s&&"auto"!=s||!document.defaultView||(s=(i=document.defaultView.getComputedStyle(e,null))?i[t]:null),"auto"==s?null:s},CgsUtil.hasClass=function(e,t){if(!e)return!1;if(null!=e.classList)return e.classList.contains(t);var i=getClass(e);return 0<i.length&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},CgsUtil.addClass=function(e,t){var i;if(e)if(null!=e.classList)for(var s=CgsUtil.splitWords(t),o=0,a=s.length;o<a;o++)e.classList.add(s[o]);else hasClass(e,t)||(i=getClass(e),setClass(e,(i?i+" ":"")+t))},CgsUtil.removeClass=function(e,t){e&&(null!=e.classList?e.classList.remove(t):setClass(e,CgsUtil.trim((" "+getClass(e)+" ").replace(" "+t+" "," "))))},CgsUtil.setClass=function(e,t){e.className&&e.className.baseVal?e.className.baseVal=t:e.className=t},CgsUtil.getClass=function(e){return e.correspondingElement&&(e=e.correspondingElement),null==e.className.baseVal?e.className:e.className.baseVal},CgsUtil.enterFullscreen=function(e){return!!e&&(e.requestFullscreen?(e.requestFullscreen(),!0):e.msRequestFullscreen?(e.msRequestFullscreen(),!0):e.mozRequestFullScreen?(e.mozRequestFullScreen(),!0):!!e.webkitRequestFullscreen&&(e.webkitRequestFullscreen(),!0))},CgsUtil.exitFullscreen=function(){return document.exitFullscreen?(document.exitFullscreen(),!0):document.msExitFullscreen?(document.msExitFullscreen(),!0):document.mozCancelFullScreen?(document.mozCancelFullScreen(),!0):!!document.webkitExitFullscreen&&(document.webkitExitFullscreen(),!0)},CgsUtil.degree2dms=function(e){e=Math.abs(e);var t=Math.floor(e),i=Math.floor(60*(e-t)),s=Math.round(3600*(e-t)%60);return{degree:t,minute:i,second:s,str:t+"° "+i+"'  "+s+'"'}},CgsUtil.dms2degree=function(e,t,i){return Math.abs(e)+t/60+i/3600},CgsUtil.getCGCS2000EPSGByLng=function(e,t){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],s=void 0;if(t){var o=parseInt(e/6)+1;if(o<13||23<o)return;s=i?o+4478:o+4489}else{var a=parseInt((e-1.5)/3)+1;if(a<25||45<a)return;s=i?a+4488:a+4509}return"EPSG:"+s},CgsUtil.getCGCS2000EPSGByX=function(e){var t=parseInt(e.toString().slice(0,2));return 13<=t&&t<=23?"EPSG:"+(t+4478):25<=t&&t<=45?"EPSG:"+(t+4488):void 0},CgsUtil.proj4Trans=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"EPSG:4326";if(!t||!i||t==i)return e;try{if(t!=CgsCRS.CGCS2000_GK_Zone_3&&t!=CgsCRS.CGCS2000_GK_Zone_6||(t=CgsUtil.getCGCS2000EPSGByX(e[0])),i==CgsCRS.CGCS2000_GK_Zone_3?i=CgsUtil.getCGCS2000EPSGByLng(e[0],!1,!0):i==CgsCRS.CGCS2000_GK_Zone_6?i=CgsUtil.getCGCS2000EPSGByLng(e[0],!0,!0):i==CgsCRS.CGCS2000_GK_CM_3?i=CgsUtil.getCGCS2000EPSGByLng(e[0],!1,!1):i==CgsCRS.CGCS2000_GK_CM_6&&(i=CgsUtil.getCGCS2000EPSGByLng(e[0],!0,!1)),!t||!i||t==i)return e;var s=proj4(t,i,e);if(Cesium.defined(s)&&1<s.length&&!isNaN(s[0])&&s[0]!=1/0)return s}catch(e){}return e},CgsUtil.proj4TransArr=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"EPSG:4326";if(!t||t==i)return e;for(var s=[],o=0,a=e.length;o<a;o++){var n,r,l=e[o];Array.isArray(l[0])?(n=CgsUtil.proj4TransArr(l,t,i))&&0<n.length&&s.push(n):(r=CgsUtil.proj4Trans(l,t,i))&&s.push(r)}return s},CgsUtil.cartesian2lonlat=function(e){var t=Cesium.Cartographic.fromCartesian(e);return null==t?null:[CgsUtil.pointTransFormatNum(Cesium.Math.toDegrees(t.longitude),6),CgsUtil.pointTransFormatNum(Cesium.Math.toDegrees(t.latitude),6),CgsUtil.pointTransFormatNum(t.height,2)]},CgsUtil.cartesians2lonlats=function(e){for(var t=[],i=0,s=e.length;i<s;i++){var o=CgsUtil.cartesian2lonlat(e[i]);o&&t.push(o)}return t},CgsUtil.cartesian2mercator=function(e){if(!e)return null;var t=CgsUtil.cartesian2lonlat(e);return CgsUtil.lonlat2mercator(t)},CgsUtil.cartesians2mercators=function(e){for(var t=[],i=0,s=e.length;i<s;i++){var o=CgsUtil.cartesian2mercator(e[i]);o&&t.push(o)}return t},CgsUtil.lonlat2cartesian=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return!e||e.length<2?null:Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]||t)},CgsUtil.lonlats2cartesians=function(e,t){for(var i=[],s=0,o=e.length;s<o;s++){var a,n,r=e[s];Array.isArray(r[0])?(a=CgsUtil.lonlats2cartesians(r,t))&&0<a.length&&i.push(a):(n=CgsUtil.lonlat2cartesian(r,t))&&i.push(n)}return i},CgsUtil.lonlat2mercator=function(e){return CgsUtil.jwd2mct(e)},CgsUtil.lonlats2mercators=function(e){for(var t=[],i=0,s=e.length;i<s;i++){var o=CgsUtil.lonlat2mercator(e[i]);t.push(o)}return t},CgsUtil.mercator2cartesian=function(e,t){if(isNaN(e[0])||isNaN(e[1]))return null;var i=CgsUtil.mercator2lonlat(e);return Cesium.defined(t)&&(i[2]=t),CgsUtil.lonlat2cartesian(i)},CgsUtil.mercators2cartesians=function(e,t){for(var i=[],s=0,o=e.length;s<o;s++){var a=CgsUtil.mercator2cartesian(e[s],t);a&&i.push(a)}return i},CgsUtil.mercator2lonlat=function(e){return CgsUtil.mct2jwd(e)},CgsUtil.mercators2lonlats=function(e){for(var t=[],i=0,s=e.length;i<s;i++){var o=CgsUtil.mercator2lonlat(e[i]);t.push(o)}return t},CgsUtil.pointTransFormatNum=function(e,t){return Number(e.toFixed(t||0))},CgsUtil.transformlat=function(e,t){var i=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*PI)+20*Math.sin(2*e*PI))/3,i+=2*(20*Math.sin(t*PI)+40*Math.sin(t/3*PI))/3,i+=2*(160*Math.sin(t/12*PI)+320*Math.sin(t*PI/30))/3},CgsUtil.transformlng=function(e,t){var i=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*PI)+20*Math.sin(2*e*PI))/3,i+=2*(20*Math.sin(e*PI)+40*Math.sin(e/3*PI))/3,i+=2*(150*Math.sin(e/12*PI)+300*Math.sin(e/30*PI))/3},CgsUtil.out_of_china=function(e,t){return e<72.004||137.8347<e||t<.8293||55.8271<t||!1},CgsUtil.bd2gcj=function(e){var t=52.35987755982988,i=Number(e[0])-.0065,s=Number(e[1])-.006,o=Math.sqrt(i*i+s*s)-2e-5*Math.sin(s*t),a=Math.atan2(s,i)-3e-6*Math.cos(i*t),n=o*Math.cos(a),r=o*Math.sin(a);return[n=Number(n.toFixed(6)),r=Number(r.toFixed(6))]},CgsUtil.gcj2bd=function(e){var t=Number(e[0]),i=Number(e[1]),s=Math.sqrt(t*t+i*i)+2e-5*Math.sin(i*x_PI),o=Math.atan2(i,t)+3e-6*Math.cos(t*x_PI),a=s*Math.cos(o)+.0065,n=s*Math.sin(o)+.006;return[a=Number(a.toFixed(6)),n=Number(n.toFixed(6))]},CgsUtil.wgs2gcj=function(e){var t=Number(e[0]),i=Number(e[1]);if(CgsUtil.out_of_china(t,i))return[t,i];var s=CgsUtil.transformlat(t-105,i-35),o=CgsUtil.transformlng(t-105,i-35),n=i/180*PI,r=Math.sin(n),r=1-ee*r*r,l=Math.sqrt(r),u=i+(s=180*s/(a*(1-ee)/(r*l)*PI)),p=t+(o=180*o/(a/l*Math.cos(n)*PI));return[p=Number(p.toFixed(6)),u=Number(u.toFixed(6))]},CgsUtil.gcj2wgs=function(e){var t=Number(e[0]),i=Number(e[1]);if(CgsUtil.out_of_china(t,i))return[t,i];var s=CgsUtil.transformlat(t-105,i-35),o=CgsUtil.transformlng(t-105,i-35),n=i/180*PI,r=Math.sin(n),r=1-ee*r*r,l=Math.sqrt(r),s=180*s/(a*(1-ee)/(r*l)*PI),u=2*t-(t+(o=180*o/(a/l*Math.cos(n)*PI))),p=2*i-(i+s);return[u=Number(u.toFixed(6)),p=Number(p.toFixed(6))]},CgsUtil.bd2wgs=function(e){return CgsUtil.gcj2wgs(tCgsUtil.bd2gcj(e))},CgsUtil.wgs2bd=function(e){return CgsUtil.gcj2bd(CgsUtil.wgs2gcj(e))},CgsUtil.jwd2mct=function(e){var t=Number(e[0]),i=Number(e[1]),s=20037508.34*t/180,o=20037508.34*(o=Math.log(Math.tan((90+i)*PI/360))/(PI/180))/180;return[s=Number(s.toFixed(2)),o=Number(o.toFixed(2)),e[2]||0]},CgsUtil.mct2jwd=function(e){var t=Number(e[0])/20037508.34*180,i=Number(e[1])/20037508.34*180,i=180/PI*(2*Math.atan(Math.exp(i*PI/180))-PI/2);return[t=Number(t.toFixed(6)),i=Number(i.toFixed(6)),e[2]||0]},CgsUtil.getCenter=function(e){var t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2),s=e.camera.getPickRay(i),o=(o=e.globe.pick(s,e))||e.camera.pickEllipsoid(i);return CgsLatLngPoint.fromCartesian(o)},CgsUtil.getExtent=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=void 0,i={xmin:70,xmax:140,ymin:0,ymax:55,height:0},s=e.scene,o=s.globe.ellipsoid,a=s.canvas,n=e.camera.pickEllipsoid(new Cesium.Cartesian2(0,0),o);if(n){var r=o.cartesianToCartographic(n);i.xmin=Cesium.Math.toDegrees(r.longitude),i.ymax=Cesium.Math.toDegrees(r.latitude),i.height=Math.max(i.height,r.height)}else{for(var l,u=a.width/2,p=a.height/2,h=void 0,c=0;c<=p;c+=10){var g=c<=u?c:u;if(h=e.camera.pickEllipsoid(new Cesium.Cartesian2(g,c),o))break}h&&(l=o.cartesianToCartographic(h),i.xmin=Cesium.Math.toDegrees(l.longitude),i.ymax=Cesium.Math.toDegrees(l.latitude),i.height=Math.max(i.height,l.height))}var d,m,f=e.camera.pickEllipsoid(new Cesium.Cartesian2(a.width,a.height),o);if(f){var C=o.cartesianToCartographic(f);i.xmax=Cesium.Math.toDegrees(C.longitude),i.ymin=Cesium.Math.toDegrees(C.latitude),i.height=Math.max(i.height,C.height)}else{for(var y,v=a.width/2,b=a.height/2,D=void 0,S=a.height;b<=S;S-=10){var _=v<=S?S:v;if(D=e.camera.pickEllipsoid(new Cesium.Cartesian2(_,S),o))break}D&&(y=o.cartesianToCartographic(D),i.xmax=Cesium.Math.toDegrees(y.longitude),i.ymin=Cesium.Math.toDegrees(y.latitude),i.height=Math.max(i.height,y.height))}if(i)return i.xmax<i.xmin&&(d=i.xmax,i.xmax=i.xmin,i.xmin=d),i.ymax<i.ymin&&(m=i.ymax,i.ymax=i.ymin,i.ymin=m),t.formatNum&&(i.xmin=CgsUtil.formatNum(i.xmin,6),i.xmax=CgsUtil.formatNum(i.xmax,6),i.ymin=CgsUtil.formatNum(i.ymin,6),i.ymax=CgsUtil.formatNum(i.ymax,6)),i},CgsUtil.getCameraView=function(e,t){var i=e.positionCartographic,s={};return s.lat=CgsUtil.formatNum(Cesium.Math.toDegrees(i.latitude),6),s.lng=CgsUtil.formatNum(Cesium.Math.toDegrees(i.longitude),6),t.simplify?(s.alt=CgsUtil.formatNum(i.height,0),s.heading=CgsUtil.formatNum(Cesium.Math.toDegrees(e.heading||0)%360,0),s.pitch=CgsUtil.formatNum(Cesium.Math.toDegrees(e.pitch||0)%360,0)):(s.alt=CgsUtil.formatNum(i.height,1),s.heading=CgsUtil.formatNum(Cesium.Math.toDegrees(e.heading||0)%360,1),s.pitch=CgsUtil.formatNum(Cesium.Math.toDegrees(e.pitch||0)%360,1),s.roll=CgsUtil.formatNum(Cesium.Math.toDegrees(e.roll||0)%360,1)),s},CgsUtil.pick3DTileset=function(e,t){if(!t)return null;t instanceof Cesium.Cartesian3&&(t=[t]);for(var i=0,s=t.length;i<s;++i){var o=t[i],a=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,o);if(Cesium.defined(a)){var n=e.pick(a,10,10);if(Cesium.defined(n)&&Cesium.defined(n.primitive)&&n.primitive instanceof Cesium.Cesium3DTileset)return n.primitive}}return null},CgsUtil.getTransFun=function(e,t){if(!e||!t)return!1;if(e=CgsUtil.crsName2FunName(e),(t=CgsUtil.crsName2FunName(t))==e)return!1;var i=e+"2"+t;return!!CgsUtil.pointTrans[i]()&&CgsUtil.pointTrans[i]()},CgsUtil.crsName2FunName=function(e){switch(e){default:case CgsChinaCRS.WGS84:return"wgs";case CgsChinaCRS.GCJ02:return"gcj";case CgsChinaCRS.BAIDU:return"bd"}},CgsUtil.getPositionValue=function(e,t){if(!e)return e;var i=void 0;return e instanceof Cesium.Cartesian3?i=e:e._value&&e._value instanceof Cesium.Cartesian3?i=e._value:"function"==typeof e.getValue&&(i=e.getValue(t||Cesium.JulianDate.now())),i},CgsUtil.getMaxHeight=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(null==e||0==e.length)return t;for(var i=t,s=0;s<e.length;s++){var o=Cesium.Cartographic.fromCartesian(e[s]);0==s&&(i=o.height),o.height>i&&(i=o.height)}return CgsUtil.formatNum(i,2)},CgsUtil.getMinHeight=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(null==e||0==e.length)return t;for(var i=t,s=0;s<e.length;s++){var o=Cesium.Cartographic.fromCartesian(e[s]);0==s&&(i=o.height),o.height<i&&(i=o.height)}return CgsUtil.formatNum(i,2)},CgsUtil.addPositionsHeight=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,t=Number(t);if(isNaN(t)||0==t)return e;if(Array.isArray(e)){for(var i=[],s=0,o=e.length;s<o;s++){var a=Cesium.Cartographic.fromCartesian(e[s]),n=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,a.height+t);i.push(n)}return i}var r=Cesium.Cartographic.fromCartesian(e);return Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+t)},CgsUtil.setPositionsHeight=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!e)return e;if(Array.isArray(e)){for(var i=[],s=0,o=e.length;s<o;s++){var a=Cesium.Cartographic.fromCartesian(e[s]),n=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,t);i.push(n)}return i}var r=Cesium.Cartographic.fromCartesian(e);return Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,t)},CgsUtil.getSurfaceHeight=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return t?(e&&e.scene&&(e=e.scene),Cesium.defaultValue(i.has3dtiles,Cesium.defined(CgsUtil.pick3DTileset(e,t)))?CgsUtil.getSurface3DTilesHeight(e,t,i):CgsUtil.getSurfaceTerrainHeight(e,t,i)):t},CgsUtil.getSurface3DTilesHeight=function(o,a){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};n.cartographic=n.cartographic||Cesium.Cartographic.fromCartesian(a);var e=n.cartographic,r=n.callback;if(n.asyn)o.clampToHeightMostDetailed([a],n.objectsToExclude,.2).then(function(e){var t=e[0];if(Cesium.defined(t)){var i=Cesium.Cartographic.fromCartesian(t),s=i.height;if(Cesium.defined(s)&&-1e3<s)return void(r&&r(s,i))}CgsUtil.getSurfaceTerrainHeight(o,a,n)});else{var t=o.sampleHeight(e,n.objectsToExclude,.2);if(Cesium.defined(t)&&-1e3<t)return r&&r(t,e),t}return 0},CgsUtil.getSurfaceTerrainHeight=function(s,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=t.cartographic||Cesium.Cartographic.fromCartesian(e),a=t.callback;if(!Boolean(s.terrainProvider._layers))return a&&a(o.height,o),o.height;if(t.asyn)return Cesium.when(Cesium.sampleTerrainMostDetailed(s.terrainProvider,[o]),function(e){var t=e[0],i=void 0,i=Cesium.defined(t)&&Cesium.defined(t.height)?t.height:s.globe.getHeight(o);a&&a(i,o)}),0;var i=s.globe.getHeight(o);return i&&-1e3<i?(a&&a(i,o),i):o.height},CgsUtil.getSurfacePosition=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!t)return t;var s=Cesium.Cartographic.fromCartesian(t),o=CgsUtil.getSurfaceHeight(e,t,i);return 0!=o||Cesium.defined(i.maxHeight)&&o<=i.maxHeight?(i.relativeHeight&&(o+=s.height),Cesium.Cartesian3.fromRadians(s.longitude,s.latitude,o)):t},CgsUtil.hasPickedModel=function(e,t){if(Cesium.defined(e.id)){var i=e.id;if(i._noMousePick)return i;if(t&&i==t)return i}if(Cesium.defined(e.primitive)){var s=e.primitive;if(s._noMousePick)return s;if(t&&s==t)return s}if(Cesium.defined(e.tileset)){var o=e.tileset;if(o._noMousePick)return o;if(t&&o==t)return o}return null},CgsUtil.getCurrentMousePosition=function(e,t,i){var s,o=void 0,a=void 0;try{a=e.pick(t,5,5)}catch(e){console.warn("getCurrentMousePosition: scene.pick 拾取时异常",e)}if(e.pickPositionSupported&&Cesium.defined(a)&&(!CgsUtil.hasPickedModel(a,i)&&(o=e.pickPosition(t),Cesium.defined(o)))){var n=Cesium.Cartographic.fromCartesian(o);if(0<=n.height)return o;if(!Cesium.defined(a.id)&&-5e3<=n.height)return o}if(Cesium.defined(Cesium.S3MTilesLayer)&&(o=e.pickPosition(t),Cesium.defined(o)))return o;if(e.onlyPickModelPosition)return o;if((o=e.mode==Cesium.SceneMode.SCENE3D?(s=e.camera.getPickRay(t),e.globe.pick(s,e)):e.camera.pickEllipsoid(t,e.globe.ellipsoid),Cesium.defined(o)&&e.camera.positionCartographic.height<1e4)&&Cesium.Cartographic.fromCartesian(o).height<-5e3)return null;return o},CgsUtil.getMidpoint=function(e,t){if(t&&e){var i=Cesium.Cartographic.fromCartesian(e),s=Cesium.Cartographic.fromCartesian(t),o=(i.height+s.height)/2,a=new Cesium.EllipsoidGeodesic(i,s).interpolateUsingFraction(.5);return Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,o)}},CgsUtil.isRepeatPoint=function(e,t){return!(!t||!e)&&(Math.abs(e.x-t.x)<.1&&Math.abs(e.y-t.y)<.1&&Math.abs(e.z-t.z)<.1)},CgsUtil.getRotateCenterPoint=function(e,t,i){var s=Cesium.Cartographic.fromCartesian(e);s.height=0;var o=Cesium.Cartographic.toCartesian(s),a=Cesium.Cartesian3.subtract(o,e,new Cesium.Cartesian3),a=Cesium.Cartesian3.normalize(a,new Cesium.Cartesian3),n=Cesium.Quaternion.fromAxisAngle(a,Cesium.Math.toRadians(i)),r=Cesium.Matrix3.fromQuaternion(n),l=Cesium.Matrix4.fromRotationTranslation(r),u=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),p=Cesium.Matrix4.multiplyByPoint(l,u,new Cesium.Cartesian3);return Cesium.Cartesian3.add(p,e,new Cesium.Cartesian3)},CgsUtil.getOnLinePointByLen=function(e,t,i,s){var o=Cesium.Transforms.eastNorthUpToFixedFrame(e),a=Cesium.Matrix4.inverse(o,new Cesium.Matrix4);e=Cesium.Matrix4.multiplyByPoint(a,e,new Cesium.Cartesian3),t=Cesium.Matrix4.multiplyByPoint(a,t,new Cesium.Cartesian3);var n=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),r=i/Cesium.Cartesian3.distance(e,t);s&&(r+=1);var l=Cesium.Cartesian3.multiplyByScalar(n,r,new Cesium.Cartesian3);return l=Cesium.Matrix4.multiplyByPoint(o,l,new Cesium.Cartesian3)},CgsUtil.getTranslationPosition=function(e,t,i,s,o){o=o||Cesium.Transforms.eastNorthUpToFixedFrame;var a=Cesium.Math.toRadians(-Cesium.defaultValue(i,0));s=(s||"z").toUpperCase();var n=Cesium.Cartesian3["UNIT_"+s],r=Cesium.Quaternion.fromAxisAngle(n,a),l=Cesium.Matrix3.fromQuaternion(r),u=new Cesium.Cartesian3(Cesium.defaultValue(t.x,0),Cesium.defaultValue(t.y,0),Cesium.defaultValue(t.z,0)),p=Cesium.Matrix4.fromRotationTranslation(l,Cesium.Cartesian3.ZERO);Cesium.Matrix4.multiplyByTranslation(p,u,p);var h=o(Cesium.Ellipsoid.WGS84.cartographicToCartesian(Cesium.Cartographic.fromCartesian(e)));Cesium.Matrix4.multiplyTransformation(h,p,p);var c=new Cesium.Cartesian3;return Cesium.Matrix4.getTranslation(p,c),c},CgsUtil.getPositionByHprAndOffset=function(e,t,i,s,o){i=i||new Cesium.HeadingPitchRoll;var a=Cesium.Transforms.headingPitchRollQuaternion(e,i,s,o),n=Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(a,new Cesium.Matrix3),e,new Cesium.Matrix4);return Cesium.Matrix4.multiplyByPoint(n,t,new Cesium.Cartesian3)},CgsUtil.getPositionByDirectionAndLen=function(e,t,i){var s=Cesium.Transforms.eastNorthUpToFixedFrame(e),o=Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(360-(t||0))),a=Cesium.Matrix4.fromRotationTranslation(o);return Cesium.Matrix4.multiply(s,a,s),Cesium.Matrix4.multiplyByPoint(s,new Cesium.Cartesian3(i,0,0),new Cesium.Cartesian3)},CgsUtil.getPositionByHprAndLen=function(e,t,i){var s=Cesium.Transforms.headingPitchRollQuaternion(e,t),o=Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(s,new Cesium.Matrix3),e,new Cesium.Matrix4);return Cesium.Matrix4.multiplyByPoint(o,new Cesium.Cartesian3(0,0,-i),new Cesium.Cartesian3)},CgsUtil.getRayEarthPosition=function(e,t,i,s){t instanceof Cesium.HeadingPitchRoll&&(t=Cesium.Transforms.headingPitchRollQuaternion(e,t));var o=Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(t,new Cesium.Matrix3),e,new Cesium.Matrix4);return CgsUtil.getRayEarthPositionByMatrix(o,i,s)},CgsUtil.getRayEarthPositionByMatrix=function(e,t,i){var s=new Cesium.Cartesian3,o=new Cesium.Ray;Cesium.Matrix4.multiplyByPoint(e,Cesium.Cartesian3.ZERO,s),s.clone(o.origin);var a=new Cesium.Cartesian3(0,0,t?-100:100);return CgsUtil.extend2Earth(a,e,o,i)},CgsUtil.extend2Earth=function(e,t,i,s){s=s||Cesium.Ellipsoid.WGS84;var o=new Cesium.Cartesian3;Cesium.Matrix4.multiplyByPoint(t,e,o),Cesium.Cartesian3.subtract(o,i.origin,i.direction),Cesium.Cartesian3.normalize(i.direction,i.direction);var a=Cesium.IntersectionTests.rayEllipsoid(i,s),n=null;if(a&&(n=Cesium.Ray.getPoint(i,a.start)),n)try{var r=new Cesium.Cartographic;Cesium.Cartographic.fromCartesian(n,null,r)}catch(e){return null}return n},CgsUtil.getHeadingPitchRollByOrientation=function(e,t,i,s){if(!Cesium.defined(t)||!Cesium.defined(e))return new Cesium.HeadingPitchRoll;var o=Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(t,new Cesium.Matrix3),e,new Cesium.Matrix4);return CgsUtil.getHeadingPitchRollByMatrix(o,i,s)},CgsUtil.getHeadingPitchRollByMatrix=function(e,t,i,s){return Cesium.Transforms.fixedFrameToHeadingPitchRoll(e,t,i,s)},CgsUtil.getHeadingPitchRollForLine=function(e,t,i,s){i=i||Cesium.Ellipsoid.WGS84;var o=new Cesium.Cartesian3,a=new Cesium.Matrix4,n=new Cesium.Matrix3,r=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(t,e,o),o);Cesium.Transforms.rotationMatrixFromPositionVelocity(e,r,i,n);var l=Cesium.Matrix4.fromRotationTranslation(n,e,a);return Cesium.Matrix4.multiplyTransformation(l,Cesium.Axis.Z_UP_TO_X_UP,l),CgsUtil.getHeadingPitchRollByMatrix(l,i,s)},CgsUtil.centerOfMass=function(e,t){if(e&&0!=e.length){var i=LatLngArray.toCartesians(e);try{if(1==i.length)return i[0];if(2==i.length)return CgsUtil.getMidpoint(i[0],i[1]);null==t&&(t=CgsUtil.getMaxHeight(i));var s=Cesium.BoundingSphere.fromPoints(i);return CgsUtil.setPositionsHeight(s.center,t)}catch(e){return i[Math.floor(i.length/2)]}}},CgsUtil.buffer=function(e,t){try{t=Cesium.defaultValue(t,1),"Polygon"==e.geometry.type&&e.geometry.coordinates[0].push(e.geometry.coordinates[0][0]),e=turf.buffer(e,t,{units:"meters",steps:64})}catch(e){console.warn("PolyUtil buffer:缓冲分析异常",e)}return e},CgsUtil.getGranularity=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10,i=Cesium.Rectangle.fromCartesianArray(e),s=Math.max(i.height,i.width);return s/=t},CgsUtil.interPolygon=function(u){for(var n=u.scene,e=[],t=u.positions,i=0;i<t.length;i++)e.push(t[i].clone());for(var s,o,a,r,l,p,h=CgsUtil.getGranularity(e,u.splitNum),c=[],g=new Cesium.PolygonGeometry.fromPositions({positions:e,vertexFormat:Cesium.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,granularity:h}),d=new Cesium.PolygonGeometry.createGeometry(g),m=0;m<d.indices.length;m+=3)s=d.indices[m],o=d.indices[m+1],a=d.indices[m+2],r=new Cesium.Cartesian3(d.attributes.position.values[3*s],d.attributes.position.values[3*s+1],d.attributes.position.values[3*s+2]),c.push(r),l=new Cesium.Cartesian3(d.attributes.position.values[3*o],d.attributes.position.values[3*o+1],d.attributes.position.values[3*o+2]),c.push(l),p=new Cesium.Cartesian3(d.attributes.position.values[3*a],d.attributes.position.values[3*a+1],d.attributes.position.values[3*a+2]),c.push(p);var f=0,C=9999,y=Cesium.defaultValue(u.onlyPoint,!1);function v(e,t){var i=void 0,s=void 0,o=void 0,a=void 0,o=t?(delete u.callback,i=CgsUtil.getSurfaceHeight(n,e,u),a=Cesium.Cartographic.fromCartesian(e),s=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,0),Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,i)):(i=(a=Cesium.Cartographic.fromCartesian(e)).height,s=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,0),e);return f<i&&(f=i),i<C&&(C=i),{height:i,point:s,pointDM:o}}function b(e,t){for(var i,s,o,a=[],n=0;n<e.length;n+=3)i=v(e[n],t),s=v(e[n+1],t),o=v(e[n+2],t),y?(CgsUtil.addPointFoyArrOnly(a,i),CgsUtil.addPointFoyArrOnly(a,s),CgsUtil.addPointFoyArrOnly(a,o)):a.push({point1:i,point2:s,point3:o});Cesium.defined(u.minHeight)&&(C=Math.max(u.minHeight,C),f=Math.max(f,C));var r={granularity:h,maxHeight:f,minHeight:C,list:a},l=u.callback;return l&&l(r),r}return u.asyn?CgsUtil.computeSurfacePoints({scene:n,positions:c,has3dtiles:u.has3dtiles,callback:b}):b(c,!0)},CgsUtil.addPointFoyArrOnly=function(e,t){for(var i=!1,s=t.point,o=0;o<e.length;o++){var a=e[o].point;if(s.x==a.x&&s.y==a.y&&s.z==a.z){i=!0;break}}i||e.push(t)},CgsUtil.getHeightRange=function(e,t,i){var s,o={positions:e,scene:t};for(s in i)o[s]=i[s];var a=CgsUtil.interPolygon(o);return{has3dtiles:a._has3dtiles,maxHeight:a.maxHeight,minHeight:a.minHeight}},CgsUtil.computeVolume=function(e){var t=CgsUtil.interPolygon(e);return t=t&&CgsUtil.updateVolumeByMinHeight(t)},CgsUtil.updateVolumeByMinHeight=function(e){for(var t=e.minHeight,i=0,s=0,o=0,a=e.list.length;o<a;o++){var n=e.list[o],r=n.point1,l=n.point2,u=n.point3,p=getTriangleArea(r.point,l.point,u.point);i+=n.area=p;var h=r.height,c=l.height,g=u.height;h<t&&(h=t),c<t&&(c=t),g<t&&(g=t);var d=p*(h-t+c-t+g-t)/3;s+=n.cutVolume=d}return e.totalArea=i,e.totalVolume=s,e},CgsUtil.updateVolume=function(e,t){if(e){var i=e.minHeight,s=e.totalVolume;if(t<=i)return e.fillVolume=0,e.digVolume=s,e;for(var o=0,a=0,n=0,r=e.list.length;n<r;n++){var l=e.list[n];o+=l.area*(t-i);var u=l.point1,p=l.point2,h=l.point3,c=u.height,g=p.height,d=h.height;c<t&&(c=t),g<t&&(g=t),d<t&&(d=t),a+=l.area*(c-t+g-t+d-t)/3}return e.digVolume=a,e.fillVolume=o-(s-a),e}},CgsUtil.getEllipseOuterPositions=function(e){var t=e.position;if(!t)return null;var i=Cesium.defaultValue(e.count,1),s=Cesium.defaultValue(e.semiMajorAxis,e.radius),o=Cesium.defaultValue(e.semiMinorAxis,e.radius),a=Cesium.defaultValue(e.rotation,0);if(!s||!o)return[t,t,t];for(var n=Cesium.EllipseGeometryLibrary.computeEllipsePositions({center:t,semiMajorAxis:s,semiMinorAxis:o,rotation:a,granularity:Math.PI/(16*i)},!0,!0).outerPositions,r=[],l=0,u=n.length;l<u;l+=3){var p=new Cesium.Cartesian3(n[l],n[l+1],n[l+2]);r.push(p)}return r},CgsUtil.formatRectangle=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6,i=CgsUtil.formatNum(Cesium.Math.toDegrees(e.west),t),s=CgsUtil.formatNum(Cesium.Math.toDegrees(e.east),t),o=CgsUtil.formatNum(Cesium.Math.toDegrees(e.north),t);return{xmin:i,xmax:s,ymin:CgsUtil.formatNum(Cesium.Math.toDegrees(e.south),t),ymax:o}},CgsUtil.getRectangle=function(e,t){if(!e)return null;for(var i=e.length-1;0<=i;i--)Cesium.defined(e[i])||e.splice(i,1);e=LatLngArray.toCartesians(e);var s=Cesium.Rectangle.fromCartesianArray(e);return t?CgsUtil.formatRectangle(s):s},CgsUtil.getPositionsRectVertex=function(e,t){var i=Cesium.Rectangle.fromCartesianArray(e),s=CgsUtil.getMaxHeight(e);return CgsUtil.getRectangleOuterPositions({rectangle:i,rotation:t,height:s})},CgsUtil.getRectangleOuterPositions=function(e){var t=e.rectangle,i=Cesium.defaultValue(e.rotation,0),s=Cesium.defaultValue(e.height,0);if(0==i)return[Cesium.Cartesian3.fromRadians(t.west,t.south,s),Cesium.Cartesian3.fromRadians(t.east,t.south,s),Cesium.Cartesian3.fromRadians(t.east,t.north,s),Cesium.Cartesian3.fromRadians(t.west,t.north,s)];var o=Cesium.defaultValue(e.granularity,Cesium.Math.RADIANS_PER_DEGREE),a=new Cesium.Rectangle,n=new Cesium.Cartographic,r=Cesium.RectangleGeometryLibrary.computeOptions(t,o,i,0,a,n),l=r.height,u=r.width,p=Cesium.defaultValue(e.ellipsoid,Cesium.Ellipsoid.WGS84),h=[new Cesium.Cartesian3,new Cesium.Cartesian3,new Cesium.Cartesian3,new Cesium.Cartesian3];return Cesium.RectangleGeometryLibrary.computePosition(r,p,!1,0,0,h[0]),Cesium.RectangleGeometryLibrary.computePosition(r,p,!1,0,u-1,h[1]),Cesium.RectangleGeometryLibrary.computePosition(r,p,!1,l-1,u-1,h[2]),Cesium.RectangleGeometryLibrary.computePosition(r,p,!1,l-1,0,h[3]),0!=s&&(h=CgsUtil.setPositionsHeight(h,s)),h},CgsUtil.getRectPositionsByCenter=function(e){var t=e.center,i=e.width,s=e.height,o=Cesium.defaultValue(e.rotation,0),a=Cesium.defaultValue(e.originX,.5),n=Cesium.defaultValue(e.originY,.5),r=new Cesium.Matrix4,l=new Cesium.Quaternion,u=new Cesium.Matrix4,p=[Cesium.Cartesian3.fromElements(-a,-n,0),Cesium.Cartesian3.fromElements(1-a,-n,0),Cesium.Cartesian3.fromElements(1-a,1-n,0),Cesium.Cartesian3.fromElements(-a,1-n,0)],h=Cesium.Transforms.eastNorthUpToFixedFrame(t,Cesium.Ellipsoid.WGS84,r),c=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,o,l),g=(0,Cesium.Matrix4.fromTranslationQuaternionRotationScale)(Cesium.Cartesian3.ZERO,c,Cesium.Cartesian3.fromElements(i,s),u),d=Cesium.Matrix4.multiply(h,g,g),m=[];return p.forEach(function(e,t){void 0===m[t]&&(m[t]=new Cesium.Cartesian3),Cesium.Matrix4.multiplyByPoint(d,e,m[t])}),m},CgsUtil.getBezierCurve=function(e,t){if(!e||e.length<3)return e;var i=CgsUtil.cartesians2lonlats(e);t&&i.push(i[0]);var s=i[i.length-1][2],o=turf.bezierSpline({type:"Feature",geometry:{type:"LineString",coordinates:i}}),a=CgsUtil.lonlats2cartesians(o.geometry.coordinates,s);return t&&a.push(a[0]),a},CgsUtil.interPolyline=function(e){var t=e.positions,i=e.scene,s=CgsUtil.getGranularity(t,e.splitNum||100);s<=0&&(s=null);for(var o=Cesium.PolylinePipeline.generateArc({positions:t,height:e.height,minDistance:e.minDistance,granularity:s}),a=[],n=0;n<o.length;n+=3){var r,l,u=Cesium.Cartesian3.unpack(o,n);i&&Cesium.defaultValue(e.surfaceHeight,!0)&&(delete e.callback,r=CgsUtil.getSurfaceHeight(i,u,e),l=Cesium.Cartographic.fromCartesian(u),u=Cesium.Cartesian3.fromRadians(l.longitude,l.latitude,r)),a.push(u)}return a},CgsUtil.interLine=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!e||e.length<2)return e;var i=void 0;t.splitNum&&(i=CgsUtil.getGranularity(e,t.splitNum))<=0&&(i=null);for(var s=[e[0]],o=1,a=e.length;o<a;o++)for(var n=e[o-1],r=e[o],l=Cesium.PolylinePipeline.generateArc({positions:[n,r],minDistance:t.minDistance,granularity:i}),u=Cesium.Cartographic.fromCartesian(n).height,p=(Cesium.Cartographic.fromCartesian(r).height-u)/l.length,h=3,c=l.length;h<c;h+=3){var g=Cesium.Cartesian3.unpack(l,h),d=Cesium.Cartographic.fromCartesian(g),m=Number((u+p*h).toFixed(1)),g=Cesium.Cartesian3.fromRadians(d.longitude,d.latitude,m);s.push(g)}return s},CgsUtil.computeSurfaceLine=function(e){return surfaceLineWork.start(e)},CgsUtil.computeSurfacePoints=function(e){return e.split=!1,surfaceLineWork.start(e)},CgsUtil.computeStepSurfaceLine=function(s){var e,t=s.positions,o=[],a={};for(e in s)"positions"!=e&&"callback"!=e&&"end"!=e&&"endItem"!=e&&(a[e]=s[e]);var n=0,r=t.length-1;!function i(){if(r<=n)return s.callback&&s.callback(o),void(s.end&&s.end(o));a.positions=[t[n],t[n+1]],a.callback=function(e,t){s.endItem&&s.endItem(e,t,n),o.push(e),n++,i()},surfaceLineWork.start(a)}()},CgsUtil.getLinkedPointList=function(e,t,i,s){var o=[],a=Cesium.Cartographic.fromCartesian(e),n=Cesium.Cartographic.fromCartesian(t),r=180*a.longitude/Math.PI,l=180*a.latitude/Math.PI,u=180*n.longitude/Math.PI,p=180*n.latitude/Math.PI,h=Math.sqrt((r-u)*(r-u)+(l-p)*(l-p))*i,c=Cesium.Cartesian3.clone(e),g=Cesium.Cartesian3.clone(t),d=Cesium.Cartesian3.distance(c,Cesium.Cartesian3.ZERO),m=Cesium.Cartesian3.distance(g,Cesium.Cartesian3.ZERO);if(Cesium.Cartesian3.normalize(c,c),Cesium.Cartesian3.normalize(g,g),0==Cesium.Cartesian3.distance(c,g))return o;var f=Cesium.Cartesian3.angleBetween(c,g);o.push(e);for(var C=1;C<s-1;C++){var y=C/(s-1),v=1-y,b=Math.sin(v*f)/Math.sin(f),D=Math.sin(y*f)/Math.sin(f),S=Cesium.Cartesian3.multiplyByScalar(c,b,new Cesium.Cartesian3),_=Cesium.Cartesian3.multiplyByScalar(g,D,new Cesium.Cartesian3),w=Cesium.Cartesian3.add(S,_,new Cesium.Cartesian3),P=y*Math.PI,T=d*v+m*y+Math.sin(P)*h,w=Cesium.Cartesian3.multiplyByScalar(w,T,w);o.push(w)}return o.push(t),o},CgsUtil.getOffsetLine=function(e,t){for(var i=[],s=1;s<e.length;s++){var o=e[s-1],a=e[s],n=Cesium.Cartesian3.subtract(o,a,new Cesium.Cartesian3),r=Cesium.Cartesian3.cross(o,n,new Cesium.Cartesian3),l=computedOffsetData(o,r,1e3*t),u=computedOffsetData(a,r,1e3*t);1==s&&i.push(l),i.push(u)}return i},CgsUtil.sliceByMaxDistance=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(e.length<2)return e;for(var s=e.length-1;1<=s;s--){var o=e[s],a=e[s-1],n=Cesium.Cartesian3.distance(o,a);if(0==(t-=n))return i.point?o:e.slice(s);if(t<0){t+=n;var r=CgsUtil.getOnLinePointByLen(o,a,t);return i.point?r:[r].concat(e.slice(s))}}return e},CgsUtil.convex=function(e){if(0<e.length){for(var t=[],i=0;i<e.length;i++)t.push({type:"Feature",geometry:{type:"Point",coordinates:e[i]}});var s,o=turf.convex({type:"FeatureCollection",features:t});!o||(s=o.geometry.coordinates)&&0<s.length&&(e=s[0])}return e},CgsUtil.createMaterialProperty=function(e,t){var i=MaterialPropertyClass[e];if(i){var s=OptsConverClass[e]||OptsConverClass.default;s&&(t.materialType=e,t=s.toCesiumVal(t,{},!0));var o=new i(t);return o._mars_type=e,o}console.warn("createMaterialProperty:未找到该类型的对应材质属性",e)},CgsUtil.createMaterial=function(e,t){if(e){var i=OptsConverClass[e]||OptsConverClass.default;i&&(t.materialType=e,t=i.toCesiumVal(t));var s=void 0,o=MaterialClass[e];return(s=o?new o(t):Cesium.Material.fromType(e,t))._mars_type=e,s}console.error("createMaterial：请指定MaterialType类型")},CgsUtil.toJSON=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=void 0;e._mars_type?i=e._mars_type:e._template.type?i=e._template.type:e.getType&&(i=e.getType()),i||(e instanceof Cesium.Color?i="Color":console.warn("toJSON：未识别的材质类型",e));var s=OptsConverClass[i]||OptsConverClass.default;return s&&(t.materialType=i,s.toJSON(e,t)),t};var OptsConverClass={};CgsUtil.registerOptsConver=function(e,t){OptsConverClass[e]&&console.error("MaterialUtil registerOptsConver: "+e+"类型已存在",t),OptsConverClass[e]=t};var MaterialClass={};CgsUtil.register=function(e,t){MaterialClass[e]&&console.error("MaterialUtil register: "+e+"类型已存在",t),MaterialClass[e]=t},CgsUtil.getTextImage=function(e,t){var i=Cesium.writeTextToCanvas(e,t);return i?i.toDataURL("image/png"):null};var MaterialPropertyClass={};CgsUtil.registerProperty=function(e,t){MaterialPropertyClass[e]&&console.error("MaterialUtil registerProperty: "+e+"属性类型已存在",t),MaterialPropertyClass[e]=t},CgsUtil.template=function(e,a,n){return null!=e&&templateRe.test(e)?e.replace(templateRe,function(e,t,i,s){var o=a[t];if(!Cesium.defined(o))return n?"":e;if("function"==typeof o){if(o=o(a),!Cesium.defined(o))return n?"":e}else if(o.getValue&&"function"==typeof o.getValue&&(o=o.getValue(Cesium.JulianDate.now()),!Cesium.defined(o)))return n?"":e;return o}):e},CgsUtil.getDistance=function(e){if(!Cesium.defined(e)||e.length<2)return 0;for(var t=0,i=1,s=e.length;i<s;i++)t+=Cesium.Cartesian3.distance(e[i-1],e[i]);return t},CgsUtil.getSurfaceDistance=function(e){if(!Cesium.defined(e)||e.length<2)return 0;for(var t=0,i=1,s=e.length;i<s;i++){var o=Cesium.Cartographic.fromCartesian(e[i-1]),a=Cesium.Cartographic.fromCartesian(e[i]),n=new Cesium.EllipsoidGeodesic;n.setEndPoints(o,a);var r=n.surfaceDistance;t+=r=Math.sqrt(Math.pow(r,2)+Math.pow(a.height-o.height,2))}return t},CgsUtil.getClampDistance=function(e,o){var a=0,n=[];CgsUtil.computeStepSurfaceLine({scene:o.scene,positions:e,splitNum:o.splitNum,has3dtiles:o.has3dtiles,endItem:function(e,t,i){var s=CgsUtil.getSurfaceDistance(e);t&&o.disTerrainScale&&(s*=o.disTerrainScale),a+=s,n.push(s),o.endItem&&o.endItem({index:i,positions:e,distance:s,arrDistance:n,all_distance:a})},end:function(){o.callback&&o.callback(a,n)}})},CgsUtil.getArea=function(e){if(!e||!Array.isArray(e)||e.length<3)return 0;e=CgsLatLngArray.toCartesians(e);var t=Cesium.CoplanarPolygonGeometry.createGeometry(Cesium.CoplanarPolygonGeometry.fromPositions({positions:e,vertexFormat:Cesium.VertexFormat.POSITION_ONLY})),i=0;if(!t)return i;for(var s=t.attributes.position.values,o=t.indices,a=0;a<o.length;a+=3){var n=Cesium.Cartesian3.unpack(s,3*o[a],new Cesium.Cartesian3),r=Cesium.Cartesian3.unpack(s,3*o[a+1],new Cesium.Cartesian3),l=Cesium.Cartesian3.unpack(s,3*o[a+2],new Cesium.Cartesian3);i+=CgsUtil.getTriangleArea_1(n,r,l)}return i},CgsUtil.getTriangleArea_1=function(e,t,i){var s=Cesium.Cartesian3.subtract(e,t,new Cesium.Cartesian3),o=Cesium.Cartesian3.subtract(i,t,new Cesium.Cartesian3),a=Cesium.Cartesian3.cross(s,o,s);return.5*Cesium.Cartesian3.magnitude(a)},CgsUtil.getClampArea=function(e,t){function i(e){for(var t=0,i=0,s=e.list.length;i<s;i++){var o=e.list[i],a=o.point1,n=o.point2,r=o.point3;t+=CgsUtil.getTriangleArea_1(a.pointDM,n.pointDM,r.pointDM)}return t}var s=t.callback,o=CgsUtil.interPolygon({positions:e,scene:t.scene,splitNum:t.splitNum,has3dtiles:t.has3dtiles,asyn:t.asyn,callback:function(e){var t=i(e);s&&s(t,e)}});if(t.asyn)return null;var a=i(o);return s&&s(a,o),a};var LangType={ZH:0,ZHHK:1,EN:2};CgsUtil.formatDistance=function(e,t,i){if(null==e)return"";null!=t&&"auto"!=t||(t=e<1e3?"m":"km");var s="";switch(t){default:case"m":s=e.toFixed(2)+getLangText("_米",i);break;case"km":s=(.001*e).toFixed(2)+getLangText("_公里",i);break;case"mile":s=(54e-5*e).toFixed(2)+getLangText("_海里",i);break;case"zhang":s=(.3*e).toFixed(2)+getLangText("_丈",i)}return s},CgsUtil.formatArea=function(e,t,i){if(null==e)return"";null!=t&&"auto"!=t||(t=e<1e6?"m":"km");var s="";switch(t){default:case"m":s=e.toFixed(2)+getLangText("_平方米",i);break;case"km":s=(e/1e6).toFixed(2)+getLangText("_平方公里",i);break;case"mu":s=(.0015*e).toFixed(2)+getLangText("_亩",i);break;case"ha":s=(1e-4*e).toFixed(2)+getLangText("_公顷",i)}return s},CgsUtil.formatVolume=function(e,t,i){return null==e?"":i==LangType.EN||e<1e4?e.toFixed(2)+getLangText("_立方米",i):(e/1e4).toFixed(2)+getLangText("_万立方米",i)};var LangTextObj={"_米":["米","米","m"],"_公里":["公里","公裏","km"],"_海里":["海里","海裏","mile"],"_丈":["丈","丈","zhang"],"_平方米":["平方米","平方米","m²"],"_平方公里":["平方公里","平方公裏","km²"],"_亩":["亩","畝","mu"],"_公顷":["公顷","公頃","ha"],"_立方米":["方","方","m³"],"_万立方米":["万方","万方","wm³"]};function getOneAttrValue(e,t,i){if(null==t||""===t||"Null"===t||"Unknown"===t)return null;if(t.getValue&&"function"==typeof t.getValue&&"material"!=e&&(t=t.getValue(Cesium.JulianDate.now())),"function"==typeof t)return null;if(i.onlySimpleType){if(t instanceof Cesium.Color)return t.toCssColorString();if(!CgsUtil.isSimpleType(t))return null}return t}CgsUtil.getLangText=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=LangTextObj[e];return i&&i[t]||e},CgsUtil.getAttrVal=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!e)return e;try{e.getValue&&(e=e.getValue(Cesium.JulianDate.now()));var i={};if(e._propertyNames&&0<e._propertyNames.length){var s=!0,o=!1,a=void 0;try{for(var n,r=e._propertyNames[Symbol.iterator]();!(s=(n=r.next()).done);s=!0){var l=n.value,u=getOneAttrValue(l,e[l],t);null!=u&&(i[l]=u)}}catch(e){o=!0,a=e}finally{try{!s&&r.return&&r.return()}finally{if(o)throw a}}}else for(var p in e){var h=getOneAttrValue(p,e[p],t);null!=h&&(i[p]=h)}return i}catch(e){console.error("getAttrVal:出错了",e)}return e},CgsUtil.isSimpleType=function(e){return null!=e&&null!=e&&!!(CgsUtil.isString(e)||CgsUtil.isBoolean(e)||CgsUtil.isNumber(e)||Array.isArray(e))};var CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");CgsUtil.uuid=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"M",t=[];t[8]=t[13]=t[18]=t[23]="-",t[14]="4";for(var i,s=0;s<36;s++)t[s]||(i=0|16*Math.random(),t[s]=CHARS[19==s?3&i|8:i]);return e+"-"+t.join("")},CgsUtil.EPSG3857_RADIUS=6378137;var templateRe=/\{ *([a-zA-Z0-9_\u4e00-\u9fa5]+) *\}/g,ys;return CgsUtil.createGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},CgsUtil.getAngle=function(e,t,i){var s=Cesium.Transforms.eastNorthUpToFixedFrame(t),s=Cesium.Matrix4.getMatrix3(s,new Cesium.Matrix3),o=Cesium.Matrix3.getColumn(s,0,new Cesium.Cartesian3),a=Cesium.Matrix3.getColumn(s,1,new Cesium.Cartesian3),n=Cesium.Matrix3.getColumn(s,2,new Cesium.Cartesian3),r=Cesium.Cartesian3.subtract(e,t,new Cesium.Cartesian3),r=Cesium.Cartesian3.cross(r,n,r);r=Cesium.Cartesian3.cross(n,r,r),r=Cesium.Cartesian3.normalize(r,r);var l=Cesium.Cartesian3.angleBetween(o,r);Cesium.Cartesian3.angleBetween(a,r)>.5*Math.PI&&(l=2*Math.PI-l);var u=360-Cesium.Math.toDegrees(l)-180;return i&&(u+=90),u<0?u+=360:360<u&&(u-=360),CgsUtil.formatNum(u,1)},CgsUtil.getEllipseOuterPositions=function(e){var t=e.position;if(!t)return null;var i=Cesium.defaultValue(e.count,1),s=Cesium.defaultValue(e.semiMajorAxis,e.radius),o=Cesium.defaultValue(e.semiMinorAxis,e.radius),a=Cesium.defaultValue(e.rotation,0);if(!s||!o)return[t,t,t];for(var n=Cesium.EllipseGeometryLibrary.computeEllipsePositions({center:t,semiMajorAxis:s,semiMinorAxis:o,rotation:a,granularity:Math.PI/(16*i)},!0,!0).outerPositions,r=[],l=0,u=n.length;l<u;l+=3){var p=new Cesium.Cartesian3(n[l],n[l+1],n[l+2]);r.push(p)}return r},CgsUtil.formatNum=function(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i},CgsUtil.type_string="string",CgsUtil.type_function="function",CgsUtil.isIncluded=function(e,t){for(var i=t.length,s=!1,o=0;o<i;o++)if(t[o]==e){s=!0;break}return s},CgsUtil.FeatureQuickRePositionByCgsPoints=function(e,t){var i=CgsUtil.getPositionArrayFromCgsPoints(t);e.setPosition(i)},CgsUtil.getPositionArrayFromCgsPoints=function(e){for(var t=[],i=0;i<e.length;i++){var s=e[i].getPosition();t.push([s[0],s[1]])}return t},CgsUtil.windowCoordinateToLonLatAlt=function(e,t){var i=e.map3D.camera.getPickRay(t),s=e.map3D.scene.globe.pick(i,e.map3D.scene);if(Cesium.defined(s)){var o=Cesium.Cartographic.fromCartesian(s);return[Cesium.Math.toDegrees(o.longitude),Cesium.Math.toDegrees(o.latitude),o.height]}},CgsUtil.interpolation=function(e,t,i){for(var s=[],i=i,o=0;o<i;o++){var a=(o+1)/i;1<a&&(a=1);var n=[(1-a)*e[0]+a*t[0],(1-a)*e[1]+a*t[1],(1-a)*e[2]+a*t[2]];s.push(n)}return s},CgsUtil.getLonLatTextFromPos=function(e,t){var i,s,o,a,n=Object.assign({format:0,buildText:!1,middleText:"",format0Length:6,spaceTxt:"&nbsp;"},t),r={def:!0,lon:0,lat:-90};return e&&(r.def=!1,r.lon=e[0],r.lat=e[1]),0==n.format&&(r.lon=r.lon.toFixed(n.format0Length),r.lat=r.lat.toFixed(n.format0Length)),n.buildText&&(i="W",s="S",0<r.lon&&(i="E"),0<r.lat&&(s="N"),0==n.format?r.text=i+n.spaceTxt+Math.abs(r.lon)+"°"+n.middleText+s+n.spaceTxt+Math.abs(r.lat)+"°":(o=(o=CgsUtil.degreeFormat1(r.lon,!0)).d+"°"+o.f+"′"+o.m+"″",a=(a=CgsUtil.degreeFormat1(r.lat,!0)).d+"°"+a.f+"′"+a.m+"″",r.text=i+n.spaceTxt+o+n.middleText+s+n.spaceTxt+a)),r},CgsUtil.getGeoStripFromPos=function(e,t){if(!e)return 0;var i=e[0]<0?360-Math.abs(e[0]):e[0];return 2==t?Math.floor((i+1.5)/3):Math.floor((i+6)/6)},CgsUtil.getLonLatFromMousePosition=function(e,t,i){var s=e.pixelToLonLat([t.x,t.y]);return s&&180<s[0]&&(s[0]=s[0]%360,180<s[0]&&(s[0]=s[0]-360)),CgsUtil.getLonLatTextFromPos(s,i)},CgsUtil.getStripNumFromMousePosition=function(e,t,i){var s=e.pixelToLonLat([t.x,t.y]);return CgsUtil.getGeoStripFromPos(s,i)},CgsUtil.degreeFormat1=function(e,t){var i=!0,s=e;e<0&&(i=!1,s=-1*e);var o=Math.floor(s),a=Math.floor(60*(s-o)),n=Math.round(3600*(s-o)%60);60===n&&(n=0,a+=1),60<=a&&(o+=1,a-=60);var r,l={d:o,f:a,m:n,sign:i};return t&&(r=i?"":"-",l.text=r+o+"°"+a+"′"+n+"″"),l},1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG||(CgsUtil.cesiumGeoProjection=new Cesium.GeographicProjection),CgsUtil.getFeaturesByPickedRetFor3D=function(e){var i=[];return _.forEach(e,function(e){var t;e&&e.id&&e.id.feature&&(t=e.id.feature.parentFeature,_.isNil(t)||i.push(t))}),i},CgsUtil.getFeaturesByPickedRetFor2D=function(e){var t=[];return _.forEach(e,function(e){e&&e.parentFeature&&t.push(e.parentFeature)}),t},CgsUtil.getFeaturesByOlFeature=function(e){if(e&&0<e.length){var t=e[0].values_.features;if(t&&0<t.length){if(1==t.length)return t[0].parentFeature;for(var i=new CgsFeature,s=0;s<t.length;s++)i.children.push(t[s].parentFeature);return i}}},CgsUtil.enterOrExitSeverLessMode=function(e,t){var i;t?(e.removeAllLayers(),i=new CgsTileLayer({url:CGS_SDK_PATH+"assets/serverLessData/server1/{TileMatrix}/{TileCol}/{TileRow}.png",requestEncoding:"REST",layer:"quanqiu1-4",text:"全球影像",projection:"EPSG:102113",level:4,tileMatrixSetID:"OGC_Mercator",tileMatrixLabels:[1,2,3,4,5],isAddToLayerTree:!0,proxy:"",pId:"level1"}),e.addLayer(i)):e.loadConfig()},CgsUtil.htmlInputEl=null,CgsUtil.openLoadFileWindow=function(e){var a={readType:"readAsText"};return _.assign(a,e),new Promise(function(s,e){var o=CgsUtil.htmlInputEl,o=a.accept?$$("<input type='file' accept="+a.accept+">"):$$("<input type='file'>");(CgsUtil.htmlInputEl=o).change(function(e){var t=o.get(0).files[0],i=new FileReader;i.onload=function(){CgsUtil.htmlInputEl=null,s({status:"load",file:t,result:i.result})},i.onerror=function(){CgsUtil.htmlInputEl=null,s({status:"error"})},i.onabort=function(){CgsUtil.htmlInputEl=null,s({status:"abort"})},i[a.readType](t)}),o.trigger("click"),console.log("读文件")})},CgsUtil.getPositionFromEntity=function(e){var t=e.position._value;return CgsUtil.getPositionFromCartesian3Pos(t)},CgsUtil.getPositionFromCartesian3Pos=function(e){var t=Cesium.Math.toDegrees,i=Cesium.Cartographic.fromCartesian(e);return{lon:t(i.longitude),lat:t(i.latitude),height:i.height}},CgsUtil.generateRandomNumber=function(e){var t=10*Math.random()+1;10<t&&--t;var i=t*Math.pow(10,e-1);return Math.floor(i)},CgsUtil.generateTableByKeyValue=function(e){var t=$$("<table></table>"),s=$$("<tbody></tbody>");return t.append(s),_.each(e,function(e,t){var i=$$("<tr><td>"+t+"</td><td>"+e+"</td></tr>");s.append(i)}),t},CgsUtil.map3DCheckPositionIfVisible=function(e,t){var i=!1,s=6356752.314145179,o=e.camera.position,a=o.x/6378137,n=o.y/6378137,r=o.z/s,l=a*a+n*n+r*r-1;if(!t)return i;null===t[2]&&(t[2]=0);var u=Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]),p=u.x/6378137-a,h=u.y/6378137-n,c=u.z/s-r,g=-(p*a+h*n+c*r);return l<g&&l<g*g/(p*p+h*h+c*c)||(i=!0),i},CgsUtil.__extends=this&&this.__extends||(ys=Object.setPrototypeOf||"[object Array]"==Object.prototype.toString.call({__proto__:[]})&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}ys(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),CgsUtil.promiseFlow=function(e){return new Promise(function(s,o){!function e(t,i){try{i.length<=t?s():i[t]().then(function(){e(t+1,i)}).catch(function(e){o(e)})}catch(e){console.log(e)}}(0,e)})},CgsUtil.tryNoThrow=function(e){try{e()}catch(e){}},CgsUtil.inciseAnticipateFlyLine=function(e,t,i,s){for(var o=[],i=i,a=0;a<i;a++){var n=(a+1)/i;1<n&&(n=1);var r=[(1-n)*e[0]+n*t[0],(1-n)*e[1]+n*t[1],(e[2]+t[2])/2];o.push(r)}return o[0]&&(o[0].push("head"),o[0].push(this.lastPathPosHead),!s&&0!=s||o[0].push(s)),this.lastPathPosHead=o[o.length-1],o},CgsUtil.on=function(e,t,i,s){if(t){var o=void 0;switch(e){case CgsEventType.cameraMoveStart:o=s.camera.moveStart.addEventListener(t,i||this);break;case CgsEventType.cameraMoveEnd:o=s.camera.moveEnd.addEventListener(t,i||this);break;case CgsEventType.cameraChanged:o=s.camera.changed.addEventListener(t,i||this);break;case CgsEventType.preUpdate:o=s.scene.preUpdate.addEventListener(t,i||this);break;case CgsEventType.postUpdate:o=s.scene.postUpdate.addEventListener(t,i||this);break;case CgsEventType.preRender:o=s.scene.preRender.addEventListener(t,i||this);break;case CgsEventType.postRender:o=s.scene.postRender.addEventListener(t,i||this);break;case CgsEventType.morphStart:o=s.scene.morphStart.addEventListener(t,i||this);break;case CgsEventType.morphComplete:o=s.scene.morphComplete.addEventListener(t,i||this);break;case CgsEventType.clockTick:o=s.clock.onTick.addEventListener(t,i||this)}return o}},CgsUtil.off=function(e,t,i,s){var o=void 0;switch(e){case CgsEventType.cameraMoveStart:o=s.camera.moveStart.removeEventListener(t,i||this);break;case CgsEventType.cameraMoveEnd:o=s.camera.moveEnd.removeEventListener(t,i||this);break;case CgsEventType.cameraChanged:o=s.camera.changed.removeEventListener(t,i||this);break;case CgsEventType.preUpdate:o=s.scene.preUpdate.removeEventListener(t,i||this);break;case CgsEventType.postUpdate:o=s.scene.postUpdate.removeEventListener(t,i||this);break;case CgsEventType.preRender:o=s.scene.preRender.removeEventListener(t,i||this);break;case CgsEventType.postRender:o=s.scene.postRender.removeEventListener(t,i||this);break;case CgsEventType.morphStart:o=s.scene.morphStart.removeEventListener(t,i||this);break;case CgsEventType.morphComplete:o=s.scene.morphComplete.removeEventListener(t,i||this);break;case CgsEventType.clockTick:o=s.clock.onTick.removeEventListener(t,i||this)}return o},CgsUtil.getInputHandles=function(i){var s={};return i instanceof CgsMap2D?console.log("未实现"):_.each(Cesium.ScreenSpaceEventType,function(e,t){s[t]=i.screenSpaceEventHandler.getInputAction(e)}),s},CgsUtil.restoreInputHandles=function(i,s){i instanceof CgsMap2D?console.log("未实现"):_.each(s,function(e,t){e&&(s[t]=i.screenSpaceEventHandler.setInputAction(e,Cesium.ScreenSpaceEventType[t]))})},CgsUtil.getDistanceBy2Array=function(e,t){if(1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG)return new ol.Sphere(6378137).haversineDistance(e,t);var i=Cesium.Cartesian3.fromDegrees(e[0],e[1]),s=Cesium.Cartesian3.fromDegrees(t[0],t[1]);return Cesium.Cartesian3.distance(i,s)},CgsUtil.getRadiusOfInnerUints=function(e,t){var i=CgsUtil.EPSG3857_RADIUS,s=t/i,o=Math.sqrt(2*i*i*(1-Math.cos(s))),a=Math.cos(e[1]/180*Math.PI)*i,n=Math.acos((2*a*a-o*o)/(2*a*a)),r=[e[0]+n/Math.PI*180,e[1]],l=ol.proj.transform(r,"EPSG:4326","EPSG:102113"),u=ol.proj.transform(e,"EPSG:4326","EPSG:102113");return l[0]-u[0]},CgsUtil.rgbToHex=function(e){if(0==e.indexOf("#"))return e;if("black"==e)return"#000000";if("yellow"==e)return"#ffff00";if("white"==e)return"#ffffff";if("green"==e)return"#008000";if("blue"==e)return"#0000ff";if("red"==e)return"#ff0000";if(-1!=e.indexOf("rgb")){var t=e.split(",");return"#"+((1<<24)+(parseInt(t[0].split("(")[1])<<16)+(parseInt(t[1])<<8)+parseInt(t[2].split(")")[0])).toString(16).slice(1)}},CgsUtil.createPositionByAngle=function(e,t,i){var s=CgsUtil.getRadiusOfInnerUints(e,t),o=ol.proj.transform(e,"EPSG:4326","EPSG:102113"),a=s*Math.cos(i/180*Math.PI),n=s*Math.sin(i/180*Math.PI),r=a+o[0],l=n+o[1];return ol.proj.transform([r,l],"EPSG:102113","EPSG:4326")},CgsUtil.funcAfter=function(e,t,i,s){var o=e[t];e["__old_"+t]=o,e[t]=function(){o.apply(i,arguments),s.apply(i,arguments)}},CgsUtil.funcBefore=function(e,t,i,s){var o=e[t];e[t]=function(){s.apply(i,arguments),o.apply(i,arguments)}},CgsUtil.waitTimeAndGetValue=function(e,t,i){return new Promise(function(e,t){})},CgsUtil.verifyLonLat=function(e){if(!this.map||this.map.verifyFlag||!e)return!0;if("[object Array]"==Object.prototype.toString.call(e)){if(0<e.length&&"[object Array]"==Object.prototype.toString.call(e[0])){if("[object Array]"==Object.prototype.toString.call(e[0][0])){for(var t=0;t<e.length;t++)for(var i=0;i<e[t].length;i++)if(e[t][i][0]<-180||180<e[t][i][0]||e[t][i][1]<-90||90<e[t][i][1])return!1}else for(t=0;t<e.length;t++)if(e[t][0]<-180||180<e[t][0]||e[t][1]<-90||90<e[t][1])return!1}else if(0<e.length&&e[0]instanceof Object)for(t=0;t<e.length;t++){var s=0;_.each(e[t],function(e,t){if(0==s){if(e<-180||180<e)return!1}else if(1==s&&(e<-90||90<e))return!1;s++})}else if(1<e.length&&(e[0]<-180||180<e[0]||e[1]<-90||90<e[1]))return!1}else if(e instanceof Object){var s=0,o=!0;if(_.each(e,function(e,t){0==s?(e<-180||180<e)&&(o=!1):1==s&&(e<-90||90<e)&&(o=!1),s++}),!o)return!1}return!0},CgsUtil.defined=function(e){return null!=e},CgsUtil.defaultValue=function(e,t){return null!=e?e:t},CgsUtil.check=function(e,t){switch(t){case"string":return"string"==typeof e||(console.error(e+" is not a string type"),!1);case"number":return"number"==typeof e||(console.error(e+" is not a number type"),!1);case"boolean":return"boolean"==typeof e||(console.error(e+" is not a boolean type"),!1);case"array":return e instanceof Array||(console.error(e+" is not array type"),!1);case"object":return"object"===(void 0===e?"undefined":_typeof(e))||(console.error(e+" is not an object type"),!1);case"function":return"function"==typeof e||(console.error(e+" is not a function type"),!1);default:console.error("unexpected type of "+t)}},CgsUtil.azimuthMeasure=function(e,t){var i=ol.proj.transform(e,"EPSG:4326",this.map.projection),s=ol.proj.transform(t,"EPSG:4326",this.map.projection),o=s[0]-i[0],a=s[1]-i[1],n=180*Math.atan(o/a)/Math.PI;return a<0?n+=180:0<=a&&o<0&&(n+=360),n},CgsUtil.AJAX=function(t){var i=new XMLHttpRequest;i.open("get",t.url),"script"==t.dataType&&(i.setRequestHeader("Accept","text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01"),i.setRequestHeader("X-Requested-With","XMLHttpRequest")),i.send(),i.onreadystatechange=function(){var e;4==i.readyState&&200==i.status&&(e="json"!=t.dataType&&"JSON"!=t.dataType||!i.responseText?i.responseText:JSON.parse(i.responseText),t.success&&t.success(e,i.status))}},CgsUtil.mercatorToLonLat=function(e){var t=e[0]/20037508.34*180,i=e[0]/20037508.34*180;return[t,i=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2)]},CgsUtil.defaultValue=function(e,t){return null!=e?e:t},CgsUtil.defined=function(e){return null!=e},CgsUtil.CgsSetTimeOut=function(e,t){var i,s=t;this.setTimeoutId=void 0,this.pause=function(){window.clearTimeout(this.setTimeoutId),this.setTimeoutId=void 0,s-=new Date-i},this.play=function(){0<s&&(i=new Date,this.setTimeoutId&&(window.clearTimeout(this.setTimeoutId),this.setTimeoutId=void 0),this.setTimeoutId=window.setTimeout(e,s))},this.clearTimeout=function(){this.setTimeoutId&&window.clearTimeout(this.setTimeoutId)},this.play()},CgsUtil.compositorFeature=function(e){for(var t=-99999,i=0,s=0;s<e.length;s++)e[s].feature2D.zIndex&&e[s].feature2D.zIndex>t&&(t=e[s].feature2D.zIndex,i=s);if(-99999!=t)return e[i];for(var o=0,a=0,n=0;n<e.length;n++)e[n].feature2D.id_>o&&(o=e[n].feature2D.id_,a=n);return e[a]},CgsUtil.circlePath=function(e,t){for(var i=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),Cesium.Ellipsoid.WGS84,new Cesium.Matrix4),s=[],o=0;o<361;o+=30){var a=o,n=Cesium.Matrix4.multiplyByPoint(i,new Cesium.Cartesian3(t*Math.cos(a*Math.PI/180),t*Math.sin(a*Math.PI/180),0),new Cesium.Cartesian3),r=Cesium.Cartographic.fromCartesian(n);s.push([Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude),e[2]])}return s},CgsUtil.checkViewer=function(e){var t=this.map,i=new Cesium.BoundingSphere,s=e.getPosition();"[object Array]"==Object.prototype.toString.call(s[0])&&(s=CgsUtil.azimuthCenterPosition(e)),2==s.length&&s.push(0),i.center=Cesium.Cartesian3.fromDegrees(s[0],s[1],s[2]),i.radius=11.02;this.map.getManipulate();return-1!=t.map3D.scene.camera.frustum.computeCullingVolume(t.map3D.scene.camera.position,t.map3D.scene.camera.direction,t.map3D.scene.camera.up).computeVisibility(i)},CgsUtil.azimuthCenterPosition=function(e){var t=e.getPosition();if("[object Array]"==Object.prototype.toString.call(t[0])){var i=0,s=0;if("[object Array]"==Object.prototype.toString.call(t[0])&&1==t.length&&(t=t[0]),"[object Array]"==Object.prototype.toString.call(t[0]))for(var o=0;o<t.length;o++)i+=t[o][0],s+=t[o][1];return[i/=t.length,s/=t.length]}},CgsUtil.updateColorPicker=function(e,t){$$("#"+e).spectrum({allowEmpty:!0,color:"#000000",showInput:!0,containerClassName:"full-spectrum",showInitial:!0,showPalette:!0,showSelectionPalette:!0,showAlpha:!0,maxPaletteSize:7,preferredFormat:"hex",localStorageKey:"spectrum.demo",move:function(){},show:function(){},beforeShow:function(){},hide:function(){},palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(153, 153, 153)","rgb(183, 183, 183)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(239, 239, 239)","rgb(243, 243, 243)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(133, 32, 12)","rgb(153, 0, 0)","rgb(180, 95, 6)","rgb(191, 144, 0)","rgb(56, 118, 29)","rgb(19, 79, 92)","rgb(17, 85, 204)","rgb(11, 83, 148)","rgb(53, 28, 117)","rgb(116, 27, 71)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]});var i=$$($$(document.getElementById(e)).parent()[0].children[2]),s=$$($$(document.getElementById(e)).parent()[0].children[2].children[0]),o=$$($$(document.getElementById(e)).parent()[0].children[2].children[0].children[0]),a=$$($$(document.getElementById(e)).parent()[0].children[2].children[1]);o.css("width","114px"),i.css("width","114px"),i.css("height","23px"),i.css("padding","0px"),s.css("width","114px"),s.css("border","0px"),s.css("padding","0px"),s.css("height","23px"),s.css("background","rgba(255,255,255,0.01)"),a.css("display","none");for(var n=document.getElementsByClassName("sp-choose"),r=0;r<n.length;r++)$$(n[r]).html("确认");for(var l=document.getElementsByClassName("sp-cancel"),u=0;u<l.length;u++)$$(l[u]).html("取消")},CgsUtil.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},CgsUtil.findlayerByName=function(e){for(var t=this.map,i=0;i<t.allLayers.length;i++)if(t.allLayers[i].getText()==e)return t.allLayers[i];return null},CgsUtil.LatLngArrayToCartesians=function(e){if(!Array.isArray(e))return e;var i=[];return e.forEach(function(e){var t=CgsUtil.LatLngPointParse(e);t&&i.push(t.toCartesian(!0))}),i},CgsUtil.centerOfMass=function(e,t){if(e&&0!=e.length){var i=CgsUtil.LatLngArrayToCartesians(e);try{if(1==i.length)return i[0];if(2==i.length)return CgsUtil.getMidpoint(i[0],i[1]);null==t&&(t=CgsUtil.getMaxHeight(i));var s=Cesium.BoundingSphere.fromPoints(i);return CgsUtil.setPositionsHeight(s.center,t)}catch(e){return i[Math.floor(i.length/2)]}}},CgsUtil.getMidpoint=function(e,t){if(t&&e){var i=Cesium.Cartographic.fromCartesian(e),s=Cesium.Cartographic.fromCartesian(t),o=(i.height+s.height)/2,a=new Cesium.EllipsoidGeodesic(i,s).interpolateUsingFraction(.5);return Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,o)}},CgsUtil.setPositionsHeight=function(e,t){if(!e)return e;if(Array.isArray(e)){for(var i=[],s=0,o=e.length;s<o;s++){var a=Cesium.Cartographic.fromCartesian(e[s]),n=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,t||0);i.push(n)}return i}var r=Cesium.Cartographic.fromCartesian(e);return Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,t||0)},CgsUtil.clone=function(e,t,i){if(null==e||"object"!=(void 0===e?"undefined":_typeof(e)))return e;if(t=t||[],i=i||5,e instanceof Date){var s=new Date;return s.setTime(e.getTime()),s}if(Array.isArray(e)&&0<=i){for(var o=[],a=0,n=e.length;a<n;++a)o[a]=clone(e[a],t,i-1);return o}if("object"==(void 0===e?"undefined":_typeof(e))&&0<=i)try{var r,l={};for(r in e)"function"!=typeof r&&-1==t.indexOf(r)&&e.hasOwnProperty(r)&&(l[r]=clone(e[r],t,i-1));return l}catch(e){logError("clone:出错了",e)}return e},CgsUtil.sliceByMaxDistance=function(e,t,i){if(i=i||new Object,e.length<2)return e;for(var s=e.length-1;1<=s;s--){var o=e[s],a=e[s-1],n=Cesium.Cartesian3.distance(o,a);if(0==(t-=n))return i.point?o:e.slice(s);if(t<0){t+=n;var r=CgsUtil.getOnLinePointByLen(o,a,t);return i.point?r:[r].concat(e.slice(s))}}return e},CgsUtil.getOnLinePointByLen=function(e,t,i,s){var o=Cesium.Transforms.eastNorthUpToFixedFrame(e),a=Cesium.Matrix4.inverse(o,new Cesium.Matrix4);e=Cesium.Matrix4.multiplyByPoint(a,e,new Cesium.Cartesian3),t=Cesium.Matrix4.multiplyByPoint(a,t,new Cesium.Cartesian3);var n=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),r=i/Cesium.Cartesian3.distance(e,t);s&&(r+=1);var l=Cesium.Cartesian3.multiplyByScalar(n,r,new Cesium.Cartesian3);return l=Cesium.Matrix4.multiplyByPoint(o,l,new Cesium.Cartesian3)},CgsUtil.getMaxHeight=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(null==e||0==e.length)return t;for(var i=t,s=0;s<e.length;s++){var o=Cesium.Cartographic.fromCartesian(e[s]);0==s&&(i=o.height),o.height>i&&(i=o.height)}return CgsUtil.formatNum(i,2)},CgsUtil.getDistance=function(e){if(!Cesium.defined(e)||e.length<2)return 0;for(var t=0,i=1,s=e.length;i<s;i++)t+=Cesium.Cartesian3.distance(e[i-1],e[i]);return t},CgsUtil.getArea=function(e){if(!e||!Array.isArray(e)||e.length<3)return 0;e=CgsUtil.LatLngArrayToCartesians(e);var t=Cesium.CoplanarPolygonGeometry.createGeometry(Cesium.CoplanarPolygonGeometry.fromPositions({positions:e,vertexFormat:Cesium.VertexFormat.POSITION_ONLY})),i=0;if(!t)return i;for(var s=t.attributes.position.values,o=t.indices,a=0;a<o.length;a+=3){var n=Cesium.Cartesian3.unpack(s,3*o[a],new Cesium.Cartesian3),r=Cesium.Cartesian3.unpack(s,3*o[a+1],new Cesium.Cartesian3),l=Cesium.Cartesian3.unpack(s,3*o[a+2],new Cesium.Cartesian3);i+=CgsUtil.getTriangleArea(n,r,l)}return i},CgsUtil.getTriangleArea=function(e,t,i){var s=Cesium.Cartesian3.subtract(e,t,new Cesium.Cartesian3),o=Cesium.Cartesian3.subtract(i,t,new Cesium.Cartesian3),a=Cesium.Cartesian3.cross(s,o,s);return.5*Cesium.Cartesian3.magnitude(a)},CgsUtil.LatLngPointParse=function(e,t){if(!e)return null;var i,s,o,a,n,r,l,u=void 0;return"string"==typeof e?(i=s.split(","),s=new Object,Array.isArray(i)&&(s.lng=i[0]||0,s.lat=i[1]||0,s.alt=i[2]||0),u=s):Array.isArray(e)?((o=new Object).lng=e[0]||0,o.lat=e[1]||0,o.alt=e[2]||0,u=o):Cesium.defined(e.lat)&&Cesium.defined(e.lng)?((u=new Object).lng=e.lng,u.lat=e.lat,u.alt=e.alt):e instanceof Cesium.Cartesian3||e._value||e.getValue?(u=new Object,a=void 0,e&&(cartesian instanceof Cesium.Cartesian3?a=e:e._value&&e._value instanceof Cesium.Cartesian3?a=e._value:"function"==typeof e.getValue&&(a=e.getValue(t||Cesium.JulianDate.now()))),!a||(n=Cesium.Cartographic.fromCartesian(a))&&(u.lat=Cesium.Math.toDegrees(n.latitude),u.lng=Cesium.Math.toDegrees(n.longitude),u.alt=n.height,u.format()),u._position=e):Cesium.defined(e.x)&&Cesium.defined(e.y)&&Cesium.defined(e.z)?(e=new Cesium.Cartesian3(e.x,e.y,e.z),u=new Object,r=void 0,e&&(cartesian instanceof Cesium.Cartesian3?r=e:e._value&&e._value instanceof Cesium.Cartesian3?r=e._value:"function"==typeof e.getValue&&(r=e.getValue(t||Cesium.JulianDate.now()))),!r||(l=Cesium.Cartographic.fromCartesian(r))&&(u.lat=Cesium.Math.toDegrees(l.latitude),u.lng=Cesium.Math.toDegrees(l.longitude),u.alt=l.height,u.format()),u._position=e):(u=null,logError("坐标解析失败，请确认参数是否无误",e)),u},CgsUtil.colorRgb=function(e){var t=parseInt(e.slice(0,2),16),i=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16);return"rgba("+parseInt(e.slice(6,8),16)+","+s+","+i+","+t/255+")"},CgsUtil.colorHex=function(e){var t=e.slice(5,e.length-1).split(","),i=parseInt(t[0]).toString(16);1==i.length&&(i="0"+i);var s=parseInt(t[1]).toString(16);1==s.length&&(s="0"+s);var o=parseInt(t[2]).toString(16);1==o.length&&(o="0"+o);var a=parseInt(255*t[3]).toString(16);return 1==a.length&&(a="0"+a),a+o+s+i},CgsUtil.exportAsString=function(e){this.map;var t=[];if(e&&0<e.length){for(var i=0;i<e.length;i++){var s=e[i],o={position:CgsDrawFeatureByMouse.arrToString(s.getPosition()),name:s.getName(),appendExplain:s.appendExplain,Radius:s.getRadius?s.getRadius():void 0,pixelSize:s.getPixelSize?s.getPixelSize():void 0,fillColor:s.getFillColor?s.getFillColor():void 0,outlineColor:s.getOutlineColor?s.getOutlineColor():void 0,outlineWidth:s.getOutlineWidth?s.getOutlineWidth():void 0,type:s.getType(),url:s.getUrl?s.getUrl():void 0,font:s.getFont?s.getFont():"600 12px 宋体",fontColor:s.getLabelFillColor?s.getLabelFillColor():"black",fontScale:s.getLabelScale?s.getLabelScale():1,width:s.getWidth?s.getWidth():void 0,followSurface:!!s.getFollowSurface&&(s.getFollowSurface&&s.getFollowSurface())};t.push(o)}var a={features:t};return JSON.stringify(a)}},CgsUtil.importStringFile=function(e){for(var t,i,s=this.map,o=JSON.parse(e).features,a=[],n=0;n<o.length;n++){"CgsPoint"==o[n].type?(t={name:o[n].name,position:CgsDrawFeatureByMouse.stringToArr(o[n].position),fillColor:o[n].fillColor?o[n].fillColor:"rgba(71,199,207,0.2)",pixelSize:o[n].pixelSize?o[n].pixelSize:5,outlineColor:o[n].outlineColor?o[n].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[n].outlineWidth?o[n].outlineWidth:2},i=new CgsPoint(t),s.addFeature(i)):"CgsLabel"==o[n].type?(t={position:CgsDrawFeatureByMouse.stringToArr(o[n].position),fillColor:o[n].fillColor?o[n].fillColor:"rgba(71,199,207,0.2)",outlineColor:o[n].outlineColor?o[n].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[n].outlineWidth?o[n].outlineWidth:0},i=new CgsLabel(t),s.addFeature(i)):"CgsLine"==o[n].type?(t={name:o[n].name,positions:CgsDrawFeatureByMouse.stringToArr(o[n].position),followSurface:o[n].followSurface,fillColor:o[n].fillColor?o[n].fillColor:"rgba(71,199,207,0.2)",outlineColor:o[n].outlineColor?o[n].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[n].outlineWidth?o[n].outlineWidth:0,width:o[n].width},i=new CgsLine(t),s.addFeature(i)):"CgsPolygon"==o[n].type?(t={name:o[n].name,positions:CgsDrawFeatureByMouse.stringToArr(o[n].position),fillColor:o[n].fillColor?o[n].fillColor:"rgba(71,199,207,0.2)",outlineColor:o[n].outlineColor?o[n].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[n].outlineWidth?o[n].outlineWidth:0},i=new CgsPolygon(t),s.addFeature(i)):"CgsRect"==o[n].type?(t={name:o[n].name,positions:CgsDrawFeatureByMouse.stringToArr(o[n].position),fillColor:o[n].fillColor?o[n].fillColor:"rgba(71,199,207,0.2)",outlineColor:o[n].outlineColor?o[n].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[n].outlineWidth?o[n].outlineWidth:0},i=new CgsRect(t),s.addFeature(i)):"CgsCircle"==o[n].type?(t={position:CgsDrawFeatureByMouse.stringToArr(o[n].position),name:o[n].name,radius:parseFloat(o[n].Radius),fillColor:o[n].fillColor?o[n].fillColor:"rgba(71,199,207,0.2)",outlineColor:o[n].outlineColor?o[n].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[n].outlineWidth?o[n].outlineWidth:0},i=new CgsCircle(t),s.addFeature(i)):"CgsMark"==o[n].type&&(t={name:o[n].name,position:CgsDrawFeatureByMouse.stringToArr(o[n].position),url:o[n].url},i=new CgsMark(t),s.addFeature(i)),i instanceof CgsLabel||(o[n].font&&i.setFont(o[n].font),o[n].fontColor&&i.setLabelFillColor(o[n].fontColor),o[n].fontScale&&i.setLabelScale(o[n].fontScale)),o[n]&&o[n].appendExplain&&(i.appendExplain=o[n].appendExplain),a.push(i)}return a},CgsUtil.createLinearGradientCanvas=function(e,t){var i=document.createElement("canvas"),s=1,o=100;if("horizontal"==t&&(s=100,o=1),i.width=s,i.height=o,e instanceof Array&&2<=e.length){for(var a=i.getContext("2d"),n="horizontal"==t?a.createLinearGradient(0,0,512,0):a.createLinearGradient(0,0,0,100),r=0,l=e.length;r<l;r++){var u=e[r],p=u.offset,h=u.color;n.addColorStop(p,h)}a.fillStyle=n,a.fillRect(0,0,s,o)}return i},CgsUtil.createLinearGradient=function(e,t){for(var i=document.createElement("canvas").getContext("2d"),s="horizontal"==t?i.createLinearGradient(0,0,100,0):i.createLinearGradient(0,0,0,100),o=0,a=e.length;o<a;o++){var n=e[o],r=n.offset,l=n.color;s.addColorStop(r,l)}return s},CgsUtil.setDefaultStyle=function(e){this.defaultStyle=e},CgsUtil.addKmlEdit=function(i){var e=this.map,t=i.getPosition();t[0]instanceof Array&&1==t.length?t=t[0][0]:t[0]instanceof Array&&(t=t[0]),2==t.length&&t.push(0);var s=$$('\n        <div>\n            <div class=\'CgsDrawByMouseEdit_infoBox_top\'>\n                <div class = "CgsDrawByMouseEdit_infoBox_top_title">标注</div>\n                <div class="CgsDrawByMouseEdit_infoBox_top_close"></div>\n            </div>\n            <div class = \'CgsDrawByMouseEdit_infoBox\'>\n                <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_cell_title">注记内容</div>\n                    <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                </div>\n                <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_cell_title">注记字体</div>\n                    <select class="CgsDrawByMouseEdit_infoBox_cell_select"  style="height:20px;"><option>微软雅黑</option><option>宋体</option><option>仿宋</option></select>\n                </div>\n                <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_cell_title">注记颜色</div>\n                    <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                </div>\n                <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_cell_title">尺寸</div>\n                    <input class = "CgsDrawByMouseEdit_infoBox_cell_input" ></input>\n                </div>\n                <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_cell_title">填充色</div>\n                    <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                </div>\n                <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_cell_title">外轮廓颜色</div>\n                    <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                </div>\n                <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_cell_title">外轮廓宽度</div>\n                    <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                </div>\n                <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_cell_title">线宽度</div>\n                    <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                </div>\n                <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_cell_title">半径</div>\n                    <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                </div>\n                <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_cell_title">缩放比例</div>\n                    <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                </div>\n            </div>    \n        </div>\n        ').get(0),o=new CgsOverlay({position:[t[0],t[1],t[2]],positioning:"top-center",element:s,offset:[140,-150],draggable:!1,showLine:!1,isRoundCorner:!0,roundCornerSize:7});e.addOverlay(o),i.editOverlay=o;var a=s.children[0].children[1],n=s.children[1].children[1],r=s.children[2].children[1],l=CgsUtil.generateRandomNumber(8),u=s.children[3].children[1],p=s.children[4].children[1],h=CgsUtil.generateRandomNumber(8),c=s.children[5].children[1],g=CgsUtil.generateRandomNumber(8),d=s.children[6].children[1],m=s.children[7].children[1],f=s.children[8].children[1],C=s.children[9].children[1];$$(r).attr("id",l),$$(p).attr("id",h),$$(c).attr("id",g),$$(a).bind("input propertychange",function(e){i.setName($$(a).val())}),$$(u).bind("input propertychange",function(e){i.setPixelSize($$(u).val())}),$$(d).bind("input propertychange",function(e){i.setOutlineWidth(parseInt($$(d).val()))}),$$(n).on("change",function(){i.setFont("400 20px "+$$(n).val())}),$$(r).on("change",function(){var e=$$("#"+l).spectrum("get"),t="rgba("+e._r+","+e._g+","+e._b+","+e._a+")";i.setLabelFillColor(t)}),$$(p).on("change",function(){var e=$$("#"+h).spectrum("get"),t="rgba("+e._r+","+e._g+","+e._b+","+e._a+")";i.setFillColor(t)}),$$(c).on("change",function(){var e=$$("#"+g).spectrum("get"),t="rgba("+e._r+","+e._g+","+e._b+","+e._a+")";i.setOutlineColor(t)}),$$(m).bind("input propertychange",function(e){i.setWidth(parseInt($$(m).val()))}),$$(f).bind("input propertychange",function(e){i.setRadius(parseInt($$(f).val()))}),$$(C).bind("input propertychange",function(e){i.setLabelScale(parseInt($$(C).val()))}),i instanceof CgsPoint?($$(n).parent().css("display","none"),$$(u).parent().css("display","none"),$$(p).parent().css("display","none"),$$(c).parent().css("display","none"),$$(d).parent().css("display","none"),$$(m).parent().css("display","none"),$$(f).parent().css("display","none")):i instanceof CgsLine?($$(a).parent().css("display","none"),$$(n).parent().css("display","none"),$$(r).parent().css("display","none"),$$(u).parent().css("display","none"),$$(c).parent().css("display","none"),$$(d).parent().css("display","none"),$$(f).parent().css("display","none"),$$(C).parent().css("display","none")):i instanceof CgsPolygon?($$(a).parent().css("display","none"),$$(n).parent().css("display","none"),$$(r).parent().css("display","none"),$$(u).parent().css("display","none"),$$(m).parent().css("display","none"),$$(f).parent().css("display","none"),$$(d).parent().css("display","none"),$$(C).parent().css("display","none")):(i instanceof CgsRect||i instanceof CgsCircle||i instanceof CgsLabel)&&($$(a).parent().css("display","none"),$$(n).parent().css("display","none"),$$(r).parent().css("display","none"),$$(u).parent().css("display","none"),$$(p).parent().css("display","none"),$$(c).parent().css("display","none"),$$(d).parent().css("display","none"),$$(m).parent().css("display","none"),$$(f).parent().css("display","none"),$$(C).parent().css("display","none")),setTimeout(function(){CgsUtil.updateColorPicker(h,!1),CgsUtil.updateColorPicker(g,!1),CgsUtil.updateColorPicker(l,!1),i.getFillColor&&$$("#"+h).spectrum("set",i.getFillColor()),i.getOutlineColor&&$$("#"+g).spectrum("set",i.getOutlineColor()),i.getLabelFillColor&&$$("#"+l).spectrum("set",i.getLabelFillColor())},100)},CgsUtil.addAttributeEdit=function(i){var e=this.map,t=i.getPosition();this.defaultStyle&&this.defaultStyle.font&&!i.getName()&&i.setFont(this.defaultStyle.font),this.defaultStyle&&this.defaultStyle.color&&!i.getName()&&i.setLabelFillColor(this.defaultStyle.color),t[0]instanceof Array&&1==t.length?t=t[0][0]:t[0]instanceof Array&&(t=t[0]),2==t.length&&t.push(0);var s=$$('\n            <div class = \'CgsDrawByMouseEdit_infoBox\'>\n                <div class=\'CgsDrawByMouseEdit_infoBox_top\'>\n                    <div class = "CgsDrawByMouseEdit_infoBox_top_title">属性编辑</div>\n                </div>\n                \n                <div class=\'CgsDrawByMouseEdit_infoBox_body\'>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">注记内容</div>\n                        <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">注记字体</div>\n                        <select class="CgsDrawByMouseEdit_infoBox_cell_select"  style="height:20px;">\n                        <option>微软雅黑</option>\n                        <option>宋体</option>\n                        <option>仿宋</option>\n                        <option>黑体</option>\n                        <option>隶书</option>\n                        <option>楷体</option>\n                        </select>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">字体大小</div>\n                        <select class="CgsDrawByMouseEdit_infoBox_cell_select"  style="height:20px;">\n                        <option>12px</option>\n                        <option>14px</option>\n                        <option>16px</option>\n                        <option>18px</option>\n                        <option>20px</option>\n                        <option>22px</option>\n                        <option selected>24px</option>\n                        <option>26px</option>\n                        <option>28px</option>\n                        <option>30px</option>\n                        <option>32px</option>\n                        </select>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">注记颜色</div>\n                        <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">尺寸</div>\n                        <input class = "CgsDrawByMouseEdit_infoBox_cell_input" ></input>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">填充色</div>\n                        <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">外轮廓颜色</div>\n                        <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">外轮廓宽度</div>\n                        <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">线宽度</div>\n                        <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">半径</div>\n                        <input  class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <div class = "CgsDrawByMouseEdit_infoBox_cell_title">缩放比例</div>\n                        <input class = "CgsDrawByMouseEdit_infoBox_cell_input"></input>\n                    </div>\n                    <div class=\'CgsDrawByMouseEdit_infoBox_cell\'>\n                        <button id=\'CgsDrawByMouseEdit_infoBox_delete\'>删除</button>\n                        <button id=\'CgsDrawByMouseEdit_infoBox_confirm\'>确认</button>\n                    </div>\n                </div>\n            </div>    \n        ').get(0),o=new CgsOverlay({position:[t[0],t[1],t[2]],positioning:"top-center",element:s,offset:[140,-150],draggable:!1,showLine:!1,isRoundCorner:!0,roundCornerSize:7});e.addOverlay(o),s=s.children[1],i.editOverlay=o;var a,n=s.children[0].children[1];i.getName&&$$(n).val(i.getName()),!i.getFont||2==(a=i.getFont().split(" ")).length&&a.unshift(0);var r=s.children[1].children[1];a&&$$(r).val(a[2]);var l=s.children[2].children[1];a&&$$(l).val(a[1]);var u=s.children[3].children[1],p=CgsUtil.generateRandomNumber(8),h=s.children[4].children[1];i instanceof CgsPoint&&$$(h).val(i.getPixelSize());var c=s.children[5].children[1],g=CgsUtil.generateRandomNumber(8),d=s.children[6].children[1],m=CgsUtil.generateRandomNumber(8),f=s.children[7].children[1];i instanceof CgsPoint&&$$(f).val(i.getOutlineWidth());var C=s.children[8].children[1];i instanceof CgsLine&&$$(C).val(i.getWidth());var y=s.children[9].children[1];i instanceof CgsCircle&&$$(y).val(i.getRadius());var v=s.children[10].children[1];$$(u).attr("id",p),$$(c).attr("id",g),$$(d).attr("id",m),$$(n).bind("input propertychange",function(e){i.setName($$(n).val())}),$$(h).bind("input propertychange",function(e){!isNaN(parseInt($$(h).val()))&&"number"==typeof parseInt($$(h).val())&&1<parseInt($$(h).val())&&i.setPixelSize($$(h).val())}),$$(f).bind("input propertychange",function(e){i.setOutlineWidth(parseInt($$(f).val()))}),$$(r).on("change",function(){i.setFont("400 "+$$(l).val()+" "+$$(r).val())}),$$(l).on("change",function(){i.setFont("400 "+$$(l).val()+" "+$$(r).val())}),$$(u).on("change",function(){var e=$$("#"+p).spectrum("get"),t="rgba("+e._r+","+e._g+","+e._b+","+e._a+")";i.setLabelFillColor(t)}),$$(c).on("change",function(){var e=$$("#"+g).spectrum("get"),t="rgba("+e._r+","+e._g+","+e._b+","+e._a+")";i.setFillColor(t)}),$$(d).on("change",function(){var e=$$("#"+m).spectrum("get"),t="rgba("+e._r+","+e._g+","+e._b+","+e._a+")";i.setOutlineColor(t)}),$$(C).bind("input propertychange",function(e){!isNaN(parseInt($$(C).val()))&&"number"==typeof parseInt($$(C).val())&&1<parseInt($$(C).val())&&i.setWidth(parseInt($$(C).val()))}),$$(y).bind("input propertychange",function(e){!isNaN(parseInt($$(y).val()))&&"number"==typeof parseInt($$(y).val())&&10<parseInt($$(y).val())&&i.setRadius(parseInt($$(y).val()))}),$$(v).bind("input propertychange",function(e){i.setLabelScale(parseInt($$(v).val()))}),i instanceof CgsPoint?($$(y).parent().css("display","none"),$$(v).parent().css("display","none"),$$(C).parent().css("display","none")):i instanceof CgsLine?($$(h).parent().css("display","none"),$$(d).parent().css("display","none"),$$(f).parent().css("display","none"),$$(y).parent().css("display","none"),$$(v).parent().css("display","none")):i instanceof CgsPolygon?($$(h).parent().css("display","none"),$$(C).parent().css("display","none"),$$(y).parent().css("display","none"),$$(f).parent().css("display","none"),$$(v).parent().css("display","none")):i instanceof CgsRect?($$(h).parent().css("display","none"),$$(f).parent().css("display","none"),$$(C).parent().css("display","none"),$$(y).parent().css("display","none"),$$(v).parent().css("display","none")):i instanceof CgsCircle?($$(h).parent().css("display","none"),$$(f).parent().css("display","none"),$$(C).parent().css("display","none"),$$(v).parent().css("display","none")):i instanceof CgsLabel&&($$(u).parent().css("display","none"),$$(h).parent().css("display","none"),$$(C).parent().css("display","none"),$$(y).parent().css("display","none"),$$(v).parent().css("display","none")),setTimeout(function(){CgsUtil.updateColorPicker(g,!1),CgsUtil.updateColorPicker(m,!1),CgsUtil.updateColorPicker(p,!1),i.getFillColor&&$$("#"+g).spectrum("set",i.getFillColor()),i.getOutlineColor&&$$("#"+m).spectrum("set",i.getOutlineColor()),i.getLabelFillColor&&$$("#"+p).spectrum("set",i.getLabelFillColor()),$$("#CgsDrawByMouseEdit_infoBox_delete").on("click",function(){CgsUtil.removeAttributeEdit(i),i.map.removeFeature(i)}),$$("#CgsDrawByMouseEdit_infoBox_confirm").on("click",function(){CgsUtil.removeAttributeEdit(i)})},100)},CgsUtil.removeAttributeEdit=function(e){e.editOverlay&&e.map&&(e.map.removeOverlay(e.editOverlay),e.editOverlay=null)},CgsUtil.flyToByRange=function(e){var t=[e[0],e[2]],i=[e[1],e[3]],s=Math.max.apply(Math,t),o=Math.min.apply(Math,t),a=Math.max.apply(Math,i),n=Math.min.apply(Math,i),r=Cesium.Cartesian3.fromDegrees(o,n),l=Cesium.Cartesian3.fromDegrees(s,a),u=Cesium.Cartesian3.distance(r,l);this.map.flyTo({destination:[(s+o)/2,(a+n)/2,+u],duration:.5})},CgsUtil.getExtend=function(e){for(var t=[],i=[],s=0;s<e.length;s++)t.push(e[s][0]),i.push(e[s][1]);var o=Math.max.apply(Math,t),a=Math.min.apply(Math,t);return[o,Math.max.apply(Math,i),a,Math.min.apply(Math,i)]},CgsUtil.getProxyURL=function(e){return!0===e?CGS_SDK_PATH+"proxy/proxy.jsp?address=":e},CgsUtil.shallowCopy=function(t){var i={};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i},CgsUtil.jmpColorToRGBA=function(e,t){var i=(255&e).toString(16);"0"==i&&(i="00");var s=((65280&e)>>8).toString(16);"0"==s&&(s="00");var o=((16711680&e)>>16).toString(16);"0"==o&&(o="00");var a={r:parseInt(o,16),g:parseInt(s,16),b:parseInt(i,16),c16:"#"+o+s+i},n="";return t&&("0"==(n=Math.floor(t/100*255).toString(16))&&(n="00"),a.a=t,a.c16="#"+n+o+s+i),a},CgsUtil.RGBTojmpColor=function(e){var t="0"===e.r.toString(16)?"00":e.r.toString(16),i="0"===e.g.toString(16)?"00":e.g.toString(16),s="0"===e.b.toString(16)?"00":e.b.toString(16),o=parseInt("0x"+(t+i+s));return o<16777216&&(o+=4278190080),o},CgsUtil.RGBATojmpColor=function(e){var t=e.r||0,i=e.g||0,s=e.b||0,o=e.a||0,a=t.toString(16),n=i.toString(16),r=s.toString(16),l=o?Math.ceil(255*o).toString(16):Math.ceil(255).toString(16),a=a.padStart(2,"0"),n=n.padStart(2,"0"),r=r.padStart(2,"0"),l=l.padStart(2,"0"),u=parseInt("0x"+(l+a+n+r));return u<16777216&&(u+=4278190080),u},CgsUtil.lonLatToGaussKruger=function(e){var t=e[0],i=Math.floor(t/6),s=3+6*i,o=15e5+1e6*i;return proj4.defs("EPSG:4498","+proj=tmerc +lat_0=0 +lon_0="+s+" +k=1 +x_0="+o+" +y_0=0 +ellps=GRS80 +units=m +no_defs"),proj4("EPSG:4326","EPSG:4498").forward(e)},CgsUtil.gaussKrugerToLonLat=function(e){var t=e[0],i=Math.round((t-15e5)/1e6),s=3+6*(i=i<0?0:i),o=15e5+1e6*i;proj4.defs("EPSG:4498","+proj=tmerc +lat_0=0 +lon_0="+s+" +k=1 +x_0="+o+" +y_0=0 +ellps=GRS80 +units=m +no_defs");var a=proj4("EPSG:4498","EPSG:4326").forward(e);return 180<a[0]?a[0]=180:a[0]<-180&&(a[0]=-180),90<a[1]?a[1]=90:a[1]<-90&&(a[1]=-90),a},CgsUtil.lonLatToStableGaussKruger=function(e){return proj4.defs("EPSG:4468","+proj=tmerc +lat_0=0 +lon_0=117 +k=1 +x_0=39500000 +y_0=0 +ellps=GRS80 +units=m +no_defs"),proj4("EPSG:4326","EPSG:4468").forward(e)},CgsUtil.stableGaussKrugerToLonLat=function(e){return proj4.defs("EPSG:4468","+proj=tmerc +lat_0=0 +lon_0=117 +k=1 +x_0=39500000 +y_0=0 +ellps=GRS80 +units=m +no_defs"),proj4("EPSG:4468","EPSG:4326").forward(e)},CgsUtil.LinearGradientDirection_HORIZONTAL="horizontal",CgsUtil.LinearGradientDirection_VERTICAL="vertical",CgsUtil.inherits=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},CgsUtil.colorAsString=function(e){return ol.color.asString(e)},CgsUtil.getMinHeight=function(e,t){if(null==e||0==e.length)return t||0;for(var i=t,s=0;s<e.length;s++){var o=CgsUtil.LatLngPointParse(e[s]);0==s&&(i=o.alt),o.alt<i&&(i=o.alt)}return CgsUtil.formatNum(i,2)},CgsUtil.getGranularity=function(e,t){var i=Cesium.Rectangle.fromCartesianArray(e),s=Math.max(i.height,i.width);return s/=t},CgsUtil.PolyinterPolyline=function(e){var t=e.positions,i=e.scene,s=CgsUtil.getGranularity(t,e.splitNum||100);s<=0&&(s=null);for(var o=Cesium.PolylinePipeline.generateArc({positions:t,height:e.height,minDistance:e.minDistance,granularity:s}),a=[],n=0;n<o.length;n+=3){var r,l,u=Cesium.Cartesian3.unpack(o,n);i&&Cesium.defaultValue(e.surfaceHeight,!0)&&(delete e.callback,r=CgsUtil.getSurfaceHeight(i,u,e),l=Cesium.Cartographic.fromCartesian(u),u=Cesium.Cartesian3.fromRadians(l.longitude,l.latitude,r)),a.push(u)}return a},CgsUtil.getSurfaceHeight=function(e,t,i){return t?(e&&e.scene&&(e=e.scene),Cesium.defaultValue(i.has3dtiles,Cesium.defined(CgsUtil.pick3DTileset(e,t)))?CgsUtil.getSurface3DTilesHeight(e,t,i):CgsUtil.getSurfaceTerrainHeight(e,t,i)):t},CgsUtil.pick3DTileset=function(e,t){if(!t)return null;t instanceof Cesium.Cartesian3&&(t=[t]);for(var i=0,s=t.length;i<s;++i){var o=t[i],a=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,o);if(Cesium.defined(a)){var n=e.pick(a,10,10);if(Cesium.defined(n)&&Cesium.defined(n.primitive)&&n.primitive instanceof Cesium.Cesium3DTileset)return n.primitive}}return null},CgsUtil.getSurface3DTilesHeight=function(o,a,n){n.cartographic=n.cartographic||Cesium.Cartographic.fromCartesian(a);var e=n.cartographic,r=n.callback;if(n.asyn)o.clampToHeightMostDetailed([a],n.objectsToExclude,.2).then(function(e){var t=e[0];if(Cesium.defined(t)){var i=Cesium.Cartographic.fromCartesian(t),s=i.height;if(Cesium.defined(s)&&-1e3<s)return void(r&&r(s,i))}CgsUtil.getSurfaceTerrainHeight(o,a,n)});else{var t=o.sampleHeight(e,n.objectsToExclude,.2);if(Cesium.defined(t)&&-1e3<t)return r&&r(t,e),t}return 0},CgsUtil.getSurfaceTerrainHeight=function(s,e,t){var o=t.cartographic||Cesium.Cartographic.fromCartesian(e),a=t.callback;if(!Boolean(s.terrainProvider._layers))return a&&a(o.height,o),o.height;if(t.asyn)return Cesium.when(Cesium.sampleTerrainMostDetailed(s.terrainProvider,[o]),function(e){var t=e[0],i=void 0,i=Cesium.defined(t)&&Cesium.defined(t.height)?t.height:s.globe.getHeight(o);a&&a(i,o)}),0;var i=s.globe.getHeight(o);return i&&-1e3<i?(a&&a(i,o),i):o.height},CgsUtil.addPositionsHeight=function(e,t){if(t=Number(t),isNaN(t)||0==t)return e;if(Array.isArray(e)){for(var i=[],s=0,o=e.length;s<o;s++){var a=Cesium.Cartographic.fromCartesian(e[s]),n=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,a.height+t);i.push(n)}return i}var r=Cesium.Cartographic.fromCartesian(e);return Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+t)},CgsUtil.setPositionsHeight=function(e,t){if(!e)return e;if(Array.isArray(e)){for(var i=[],s=0,o=e.length;s<o;s++){var a=Cesium.Cartographic.fromCartesian(e[s]),n=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,t||0);i.push(n)}return i}var r=Cesium.Cartographic.fromCartesian(e);return Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,t||0)},CgsUtil.isNumber=function(e){return"number"==typeof e&&e.constructor==Number},CgsUtil.isString=function(e){return"string"==typeof e&&e.constructor==String},CgsUtil.isBoolean=function(e){return"boolean"==typeof e&&e.constructor==Boolean},CgsUtil.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},CgsUtil.isSimpleType=function(e){return null!=e&&null!=e&&!!(CgsUtil.isString(e)||CgsUtil.isBoolean(e)||CgsUtil.isNumber(e)||Array.isArray(e))},CgsUtil.template=function(e,a,n){return null!=e&&templateRe.test(e)?e.replace(templateRe,function(e,t,i,s){var o=a[t];if(!Cesium.defined(o))return n?"":e;if("function"==typeof o){if(o=o(a),!Cesium.defined(o))return n?"":e}else if(o.getValue&&"function"==typeof o.getValue&&(o=o.getValue(Cesium.JulianDate.now()),!Cesium.defined(o)))return n?"":e;return o}):e},CgsUtil.splitWords=function(e){return CgsUtil.trim(e).split(/\s+/)},CgsUtil.trim=function(e){if(e)return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},CgsUtil.getColorByStyle=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Cesium.Color.YELLOW,i=void 0;return(i=e.color?CgsUtil.isString(e.color)?Cesium.Color.fromCssColorString(e.color):e.color:e.randomColor?Cesium.Color.fromRandom({minimumRed:Cesium.defaultValue(e.minimumRed,0),maximumRed:Cesium.defaultValue(e.maximumRed,.75),minimumGreen:Cesium.defaultValue(e.minimumGreen,0),maximumGreen:Cesium.defaultValue(e.maximumGreen,.75),minimumBlue:Cesium.defaultValue(e.minimumBlue,0),maximumBlue:Cesium.defaultValue(e.maximumBlue,.75)}):t)&&Cesium.defined(e.opacity)&&(e.opacity<0?e.opacity=0:1<e.opacity&&(e.opacity=1),i=i.withAlpha(Number(e.opacity))),i},CgsUtil.getCirclePosition=function(e,t){for(var i=[],s=Cesium.Transforms.eastNorthUpToFixedFrame(e),o=2*Math.PI/120,a=2*Math.PI*270/360,n=0;n<120;n++){var r=a-o*n,l=new Cesium.Cartesian3(Math.sin(r)*t,Math.cos(r)*t,0);i.push(Cesium.Matrix4.multiplyByPoint(s,l,new Cesium.Cartesian3))}return i.push(i[0]),i},CgsUtil.createCylinderInstance=function(e,t,i){for(var s=i.height,o=i.color,a=e.slice(),n=e.length,r=2*n,l=[],u=1/(n-1),p=[],h=[],c=0;c<n;c++){h.push(CgsUtil.addPositionsHeight(t[c],s)),l.push(c*u),l.push(0);var g=(c+1)%n,d=r-(c+1);p.push.apply(p,[d-1,d,c]),p.push.apply(p,[c,g,d-1])}for(var m=0;m<h.length;m++)a.push(h[n-m-1]),l.push(1-m*u),l.push(1);var f=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(a),perPositionHeight:!0});return(f=Cesium.PolygonGeometry.createGeometry(f)).indices=p,f.attributes.st.values=l,new Cesium.GeometryInstance({geometry:f,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(o),distanceDisplayCondition:i.distanceDisplayCondition||new Cesium.DistanceDisplayConditionGeometryInstanceAttribute}})},CgsUtil.createCircleInstance=function(e,t){var i=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(e),perPositionHeight:t.perPositionHeight});return new Cesium.GeometryInstance({geometry:i,attributes:{distanceDisplayCondition:t.distanceDisplayCondition||new Cesium.DistanceDisplayConditionGeometryInstanceAttribute}})},CgsUtil.formatXml=function(e){e=(e="\n"+e.replace(/(<\w+)(\s.*?>)/g,function(e,t,i){return t+" "+i.replace(/\s+(\w+=)/g," $1")}).replace(/>\s*?</g,">\n<")).replace(/\n/g,"\r").replace(/<!--(.+?)-->/g,function(e,t){return"\x3c!--"+escape(t)+"--\x3e"}).replace(/\r/g,"\n");var p=[];return e.replace(/\n(<(([^\?]).+?)(?:\s|\s*?>|\s*?(\/)>)(?:.*?(?:(?:(\/)>)|(?:<(\/)\2>)))?)/gm,function(e,t,i,s,o,a,n,r){var l="/"==o||"/"==a||"/"==n||"/"==r,u="";return"!"==s?u=h(p.length):"/"!=s?(u=h(p.length),l||p.push(i)):(p.pop(),u=h(p.length)),"\n"+u+t}).substring(1).replace(/\n/g,"\r").replace(/(\s*)<!--(.+?)-->/g,function(e,t,i){return"\r"==t.charAt(0)&&(t=t.substring(1)),"\n"+t+"\x3c!--"+(i=unescape(i).replace(/\r/g,"\n")).replace(/^\s*/gm,t)+"--\x3e"}).replace(/\s+$/g,"").replace(/\r/g,"\r\n");function h(e){for(var t=[],i=0;i<e;++i)t.push("    ");return t.join("")}},CgsUtil.getTemplateHtml=function(options){var attr=options.attr;if(!attr)return!1;var title=options.title,isEdit=options.edit,cfg=options.template,attr=CgsUtil.getAttrVal(attr);if(!cfg||"all"==cfg){var countsok=0,inhtml=title?'<div class="mars-popup-titile">'+title+"</div>":"",col;for(col in inhtml+='<div class="mars-popup-content" >',attr)try{if(null==col||null==attr[col])continue;if("Shape"==col||"FID"==col||"OBJECTID"==col||"_definitionChanged"==col||"_propertyNames"==col)continue;if("_"==col.substr(0,1)&&(col=col.substring(1)),"object"==_typeof(attr[col])&&attr[col].hasOwnProperty&&attr[col].hasOwnProperty("getValue")&&(attr[col]=attr[col].getValue(Cesium.JulianDate.now())),"function"==typeof attr[col])continue;var showval=String.prototype.trim.call(String(attr[col]||""));if(""===showval||"Null"==showval||"Unknown"==showval||"0"==showval)continue;inhtml+="<div><label>"+col+"</label>"+showval+"</div>",countsok++}catch(e){console.warn("getTemplateHtml:构造all时异常",e)}return inhtml+="</div>",0!=countsok&&inhtml}if(Array.isArray(cfg)){var _countsok=0,_inhtml=title?'<div class="mars-popup-titile">'+title+"</div>":'<div style="height: 10px;"></div>';_inhtml+='<div class="mars-popup-content" >';for(var _i50=0;_i50<cfg.length;_i50++){var thisfield=cfg[_i50];if(null!=thisfield){var _col=thisfield.field;if("details"==thisfield.type||"button"==thisfield.type){var _ret=function(){var onclickHtml="",callback=thisfield.callback,funName;return callback&&(funName="_cache_getTemplateHtml_"+callbackIndex++,window[funName]=function(){eval(callback+"("+JSON.stringify(attr)+")")},onclickHtml='onclick="'+funName+'();"  '),_inhtml+='<div style="text-align: center;padding: 2px 0;">\n                            <button type="button"  '+onclickHtml+'\n                            data-type="'+_col+'" class="btn btn-primary btn-sm mars3d-popup-btn" >'+(thisfield.name||"查看详情")+"</button>\n                        </div>","continue"}();if("continue"===_ret)continue}else if("html"==thisfield.type){_inhtml+="<div>"+thisfield.html+"</div>";continue}if(!isEdit){if(null==_col||null==attr[_col])continue;if("function"==typeof attr[_col])continue}var _showval2=String.prototype.trim.call(attr[_col]||"");if(isEdit||null!=_showval2&&""!==_showval2&&"Null"!=_showval2&&"Unknown"!=_showval2&&"0"!=_showval2&&0!=_showval2.length){if(thisfield.format)try{_showval2="function"==typeof thisfield.format?thisfield.format(_showval2):eval(thisfield.format+"("+_showval2+")")}catch(e){logError("getTemplateHtml:格式化出错",thisfield)}if(isEdit)switch(thisfield.type){default:case"string":case"number":_showval2='<input type="'+(thisfield.type||"text")+'" class="mars3d-popup-edititem" style="width:'+(options.width||190)+'px;"\n                        data-type="'+_col+'" value="'+_showval2+'" placeholder="请输入 '+thisfield.name+'"  />';break;case"textarea":_showval2='<textarea class="mars3d-popup-edititem" style="width:'+(options.width||190)+'px;"\n                        data-type="'+_col+'"  placeholder="请输入 '+thisfield.name+'"  >'+_showval2+"</textarea>"}thisfield.unit&&(_showval2+=thisfield.unit),_inhtml+="<div><label>"+thisfield.name+"</label>"+_showval2+"</div>",_countsok++}}}return _inhtml+="</div>",0!=_countsok&&_inhtml}if(isObject(cfg))switch(cfg.type){case"iframe":var _url=template(cfg.url,attr,!0),inhtml2='<iframe id="ifarm" src="'+_url+'"  style="width:'+(cfg.width||"300")+"px;height:"+(cfg.height||"300")+'px;overflow:hidden;margin:0;" scrolling="no" frameborder="0" ></iframe>';return inhtml2;case"javascript":var callbackFun=cfg.callback;return eval(callbackFun+"("+JSON.stringify(attr)+")")}else{if(isString(cfg))return template(cfg,attr,!0);if("function"==typeof cfg)return cfg(cfg,attr)}return!1},CgsUtil.merge=function(e){for(var t,i,s=void 0,o=void 0,a=arguments.length,n=Array(1<a?a-1:0),r=1;r<a;r++)n[r-1]=arguments[r];for(o=0,t=n.length;o<t;o++)for(s in i=n[o])e[s]&&isObject(e[s])&&!Array.isArray(e[s])?e[s]=_extends({},e[s],i[s]):e[s]=i[s];return e},CgsUtil.getFullscreenQuad=function(){return new Cesium.Geometry({attributes:new Cesium.GeometryAttributes({position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}),st:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array([0,0,1,0,1,1,0,1])})}),indices:new Uint32Array([3,2,0,0,2,1])})},CgsUtil.createTexture=function(e,t){var i;return Cesium.defined(t)&&((i={}).arrayBufferView=t,e.source=i),new Cesium.Texture(e)},CgsUtil.createFramebuffer=function(e,t,i){return new Cesium.Framebuffer({context:e,colorTextures:[t],depthTexture:i})},CgsUtil.createRawRenderState=function(e){var t={viewport:e.viewport,depthTest:e.depthTest,depthMask:e.depthMask,blending:e.blending};return Cesium.Appearance.getDefaultRenderState(!0,!1,t)},CgsUtil.viewRectangleToLonLatRange=function(e){var t,i={},s=Cesium.Math.mod(e.west,Cesium.Math.TWO_PI),o=Cesium.Math.mod(e.east,Cesium.Math.TWO_PI),a=e.width,n=a>Cesium.Math.THREE_PI_OVER_TWO?(t=0,Cesium.Math.TWO_PI):o-s<a?(t=s)+a:(t=s,o);i.lon={min:Cesium.Math.toDegrees(t),max:Cesium.Math.toDegrees(n)};var r=e.south,l=e.north,u=e.height,p=u>Cesium.Math.PI/12?u/2:0,h=Cesium.Math.clampToLatitudeRange(r-p),c=Cesium.Math.clampToLatitudeRange(l+p);return h<-Cesium.Math.PI_OVER_THREE&&(h=-Cesium.Math.PI_OVER_TWO),c>Cesium.Math.PI_OVER_THREE&&(c=Cesium.Math.PI_OVER_TWO),i.lat={min:Cesium.Math.toDegrees(h),max:Cesium.Math.toDegrees(c)},i},CgsUtil.getAttrVal=function(e,t){if(!e)return e;t=t||{};try{e.getValue&&(e=e.getValue(Cesium.JulianDate.now()));var i={};if(e._propertyNames&&0<e._propertyNames.length){var s=!0,o=!1,a=void 0;try{for(var n,r=e._propertyNames[Symbol.iterator]();!(s=(n=r.next()).done);s=!0){var l=n.value,u=getOneAttrValue(l,e[l],t);null!=u&&(i[l]=u)}}catch(e){o=!0,a=e}finally{try{!s&&r.return&&r.return()}finally{if(o)throw a}}}else for(var p in e){var h=getOneAttrValue(p,e[p],t);null!=h&&(i[p]=h)}return i}catch(e){console.warn("getAttrVal:出错了",e)}return e},CgsUtil.getCesiumColor=function(e,t){return e?CgsUtil.isString(e)?Cesium.Color.fromCssColorString(e):e:t},CgsUtil.getCesiumValue=function(e,t,i){if(!e)return e;if(t){if(e instanceof t)return e;if(e._value&&e._value instanceof t)return e._value}return"function"==typeof e.getValue?e.getValue(i||Cesium.JulianDate.now()):e},CgsUtil}),CgsState={INITIALIZED:"initialized",ADDED:"added",REMOVED:"removed",CLEARED:"cleared",INSTALLED:"installed",ENABLED:"enabled",DISABLED:"disabled",PLAY:"play",PAUSE:"pause",RESTORE:"restore",DESTROY:"destroy"},CgsCRS={EPSG3857:"EPSG:3857",EPSG4326:"EPSG:4326",EPSG4490:"EPSG:4490",CGCS2000_GK_Zone_3:"CGCS2000_GK_Zone_3",CGCS2000_GK_Zone_6:"CGCS2000_GK_Zone_6",CGCS2000_GK_CM_3:"CGCS2000_GK_CM_3",CGCS2000_GK_CM_6:"CGCS2000_GK_CM_6"},CgsChinaCRS={WGS84:"WGS84",GCJ02:"GCJ02",BAIDU:"BD09"},CgsEventType={add:"add",remove:"remove",addGraphic:"addGraphic",removeGraphic:"removeGraphic",addLayer:"addLayer",removeLayer:"removeLayer",update:"update",updateStyle:"updateStyle",updateAttr:"updateAttr",show:"show",hide:"hide",start:"start",change:"change",endItem:"endItem",end:"end",stop:"stop",loadBefore:"loadBefore",load:"load",error:"error",loadConfig:"loadConfig",click:"click",clickGraphic:"clickGraphic",clickTileGraphic:"clickTileGraphic",clickMap:"clickMap",dblClick:"dblClick",leftDown:"leftDown",leftUp:"leftUp",mouseMove:"mouseMove",mouseMoveTarget:"mouseMoveTarget",wheel:"wheel",rightClick:"rightClick",rightDown:"rightDown",rightUp:"rightUp",middleClick:"middleClick",middleDown:"middleDown",middleUp:"middleUp",pinchStart:"pinchStart",pinchEnd:"pinchEnd",pinchMove:"pinchMove",mouseDown:"mouseDown",mouseUp:"mouseUp",mouseOver:"mouseOver",mouseOut:"mouseOut",keydown:"keydown",keyup:"keyup",drawStart:"drawStart",drawMouseMove:"drawMouseMove",drawAddPoint:"drawAddPoint",drawRemovePoint:"drawRemovePoint",drawCreated:"drawCreated",editStart:"editStart",editMouseDown:"editMouseDown",editMouseMove:"editMouseMove",editMovePoint:"editMovePoint",editRemovePoint:"editRemovePoint",editStyle:"editStyle",editStop:"editStop",move:"move",initialTilesLoaded:"initialTilesLoaded",allTilesLoaded:"allTilesLoaded",addTile:"addTile",addTileSuccess:"addTileSuccess",addTileError:"addTileError",removeTile:"removeTile",cameraMoveStart:"cameraMoveStart",cameraMoveEnd:"cameraMoveEnd",cameraChanged:"cameraChanged",preUpdate:"preUpdate",postUpdate:"postUpdate",preRender:"preRender",postRender:"postRender",morphStart:"morphStart",morphComplete:"morphComplete",clockTick:"clockTick"},MaterialType={Color:Cesium.Material.ColorType,Image:Cesium.Material.ImageType,Grid:Cesium.Material.GridType,Checkerboard:Cesium.Material.CheckerboardType,Stripe:Cesium.Material.StripeType,Water:Cesium.Material.WaterType,PolylineDash:Cesium.Material.PolylineDashType,PolylineOutline:Cesium.Material.PolylineOutlineType,PolylineArrow:Cesium.Material.PolylineArrowType,PolylineGlow:Cesium.Material.PolylineGlowType,LineFlow:"LineFlow",LineFlowColor:"LineFlowColor",ODLine:"ODLine",LineFlicker:"LineFlicker",LineTrail:"LineTrail",WallScroll:"WallScroll",ScanLine:"ScanLine",CircleScan:"CircleScan",CircleWave:"CircleWave",RadarLine:"RadarLine",RadarWave:"RadarWave",Text:"Text",RectSlide:"RectSlide",PolyGradient:"PolyGradient",PolyAsphalt:"PolyAsphalt",PolyBlob:"PolyBlob",PolyFacet:"PolyFacet",PolyGrass:"PolyGrass",PolyWood:"PolyWood",EllipsoidElectric:"EllipsoidElectric",EllipsoidWave:"EllipsoidWave",CylinderWave:"CylinderWave"},EFFECT_RIGHT_BOTTOM=[180,-86],EFFECT_LEFT_TOP=[-180,86],CgsEffect=function(e){this.map=e.mapObj.map2D,this.projection=e.projection,this.id=e.id,this.svgObj=null,this.timer=[],this.lineObj=[],this.circleObj=[],this.curveObj=[],this.isAddFlag=!1;var t=this.map.getPixelFromLonLat(EFFECT_RIGHT_BOTTOM)[0]-this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[0],i=this.map.getPixelFromLonLat(EFFECT_RIGHT_BOTTOM)[1]-this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[1];this.w=t,this.h=i,this.div=document.createElement("div"),this.div.id=this.id,this.div.style="z-index:50;",this.div.style.width=parseInt(t)+"px",this.div.style.height=parseInt(i)+"px";var s=new ol.Overlay({element:this.div,offset:[0,0],positioning:"center-center",stopEvent:!1});this.map.addOverlay(s);var o=ol.proj.transform([0,0],"EPSG:4326","EPSG:102113");s.setPosition(o),this.map.render();var n=this;this.mousedown=!1,this.mousemove=!1,this.mousewheel=!1;var a=this.map.getViewport();return a.onmousedown=function(){n.mousedown=!0,n.mousewheel=!1,n.mousemove=!1},a.onmousemove=function(){n.mousemove=!0},a.onmouseup=function(){n.mousedown=!1,n.mousewheel=!1,n.mousemove=!1},a.onmousewheel=function(){n.mousewheel=!0},a.onwheel=function(){n.mousewheel=!0,n.wheelid&&clearTimeout(n.wheelid),n.wheelid=setTimeout(function(){n.mousewheel=!1},1e3)},this.map.on("postcompose",function(){if(!(n.mousemove&&!n.mousedown&&!n.mousewheel||!n.mousemove&&n.mousedown)&&null!=n.map.frameState_){var e=n.map.getPixelFromLonLat(EFFECT_RIGHT_BOTTOM)[0]-n.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[0],t=n.map.getPixelFromLonLat(EFFECT_RIGHT_BOTTOM)[1]-n.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[1];if(n.div.style.width=parseInt(e)+"px",n.div.style.height=parseInt(t)+"px",n.isAddFlag){for(var i=0;i<n.curveObj.length;i++)if(n.curveObj[i].map&&n.curveObj[i].map.map2D==n.curveObj[i].CgsEffectObj.map){d3.select("#"+n.curveObj[i].id).remove();for(var s=0;s<n.timer.length;s++)if(n.timer[s][0]==n.curveObj[i].id){clearInterval(n.timer[s][1]),n.timer.splice(s,1);break}}for(var o,a,i=0;i<n.curveObj.length;i++){n.curveObj[i].map&&n.curveObj[i].map.map2D==n.curveObj[i].CgsEffectObj.map&&(o={CgsEffectObj:n.curveObj[i].CgsEffectObj,startlonlat:n.curveObj[i].startlonlat,endlonlat:n.curveObj[i].endlonlat,bdirection:n.curveObj[i].bdirection,id:n.curveObj[i].id,fillColor:n.curveObj[i].fillColor,width:n.curveObj[i].width,type:n.curveObj[i].type,opacity:n.curveObj[i].opacity,length:n.curveObj[i].length,time:n.curveObj[i].time,clickcall:n.curveObj[i].clickcall,mouseover:n.curveObj[i].mouseover,mouseout:n.curveObj[i].mouseout,bflag:!1,isRefresh:!0},a=new CgsEffectCurve(o),n.map.addEffect(a))}}}}),this},CgsEffect.prototype.getId=function(){return this.Id},CgsEffect.prototype.getSvgObj=function(){return this.svgObj},CgsEffect.prototype.getPosition=function(e){var t=this.map.getPixelFromLonLat(EFFECT_RIGHT_BOTTOM)[0]-this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[0],i=this.map.getPixelFromLonLat(EFFECT_RIGHT_BOTTOM)[1]-this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[1],s=this.map.getPixelFromLonLat(e)[0]-this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[0],o=this.map.getPixelFromLonLat(e)[1]-this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[1],a=[];return a[0]=s/t*100+"%",a[1]=o/i*100+"%",a},CgsEffect.prototype.colorShade=function(e,t,i,s,o,a){for(var n=t?"100%":"0%",r=i?"100%":"0%",l=this.svgObj.append("defs").append("linearGradient").attr("id",e).attr("x1","0%").attr("y1","0%").attr("x2",n).attr("y2",r),u=s.length>o.length?o.length:s.length,p=0;p<u;p++)l.append("stop").style("stop-color",o[p]).style("stop-opacity",a[p]).attr("offset",s[p]);return e},CgsEffect.prototype.angle=function(e,t){var i=this.map.getPixelFromLonLat(t)[0]-this.map.getPixelFromLonLat(e)[0],s=this.map.getPixelFromLonLat(t)[1]-this.map.getPixelFromLonLat(e)[1],o=[];return 0==i&&0<s?o[0]=90:0==i&&s<0?o[0]=-90:0<i&&0==s?o[0]=0:i<0&&0==s?o[0]=180:i<0?o[0]=180+180/3.1415*Math.atan(s/i):0<i&&(o[0]=180/Math.PI*Math.atan(s/i)),o[1]=Math.sqrt(i*i+s*s),o[2]=i,o[3]=s,o},CgsEffect.prototype.getCircleCoordinate=function(e,t,i,s){var o,a,n,r,l,u,p,h,c=[],g=this.map.getPixelFromLonLat(e)[0]-this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[0],d=this.map.getPixelFromLonLat(t)[0]-this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[0],m=this.map.getPixelFromLonLat(e)[1]-this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[1],f=this.map.getPixelFromLonLat(t)[1]-this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[1];return g==d?(c[0]=s?f<m?g-(m-f)/2*Math.sqrt(3):g-(f-m)/2*Math.sqrt(3):f<m?g+(m-f)/2*Math.sqrt(3):g+(f-m)/2*Math.sqrt(3),c[1]=(m+f)/2):(n=m-(o=(g-d)/2-.5*(m*m-f*f)/(g-d))*(a=(m-f)/(g-d)),r=4*(o*a-m)*(o*a-m)-4*(a*a+1)*(o*o+m*m-i*i),l=Math.sqrt(r),u=2*(a*a+1),h=(g+d)/2+.5*(m*m-f*f)/(g-d)-(m-f)/(g-d)*(p=s?(2*n-l)/u:(2*n+l)/u),c[0]=h,c[1]=p),c},CgsEffect.prototype.getCurveMiddleCoordinate=function(e,t,i){var s=this.map.getLonLatFromPixel([i[0]+this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[0],i[1]+this.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[1]]),o=s[0],a=s[1],n=[];return n[0]=(Math.sqrt(3)*(e[0]+t[0])-(2*Math.sqrt(3)-3)*o)/3,n[1]=(Math.sqrt(3)*(e[1]+t[1])-(2*Math.sqrt(3)-3)*a)/3,n},CgsEffect.prototype.addEffect11=function(e){},CgsEffectLine=function(e){this.CgsEffectObj=e.CgsEffectObj,this.startlonlat=e.startlonlat,this.endlonlat=e.endlonlat,this.id=e.id,this.height=e.height,this.fillColor=e.fillColor,this.opacity=e.opacity,this.type=e.type,this.length=e.length,this.time=e.time,this.clickcall=e.clickcall,this.mouseover=e.mouseover,this.mouseout=e.mouseout,this.map=null,this.value=[],this.value=this.CgsEffectObj.angle(this.startlonlat,this.endlonlat),this.w=this.CgsEffectObj.map.getPixelFromLonLat(EFFECT_RIGHT_BOTTOM)[0]-this.CgsEffectObj.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[0],this.svg=null;this.CgsEffectObj.lineObj.push(this),null==d3.select("#svg_"+this.id)[0][0]?this.svg=d3.select("#"+this.CgsEffectObj.id).append("svg").attr("width","100%").attr("height","100%").style("overflow","visible").attr("id","svg_"+this.id).style("pointer-events","none"):this.svg=d3.select("#svg_"+this.id);var t=this.svg.append("defs").append("linearGradient").attr("id","color"+this.id).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");t.append("stop").style("stop-color",this.fillColor).style("stop-opacity","0").attr("offset","0%"),t.append("stop").style("stop-color",this.fillColor).style("stop-opacity","0.5").attr("offset","100%");var i=document.getElementById("svg_"+this.id);return i.style.left=this.CgsEffectObj.getPosition(this.startlonlat)[0],i.style.top=this.CgsEffectObj.getPosition(this.startlonlat)[1],i.style.position="absolute",this},CgsEffectCircle=function(e){this.CgsEffectObj=e.CgsEffectObj,this.lonlat=e.lonlat,this.r=e.r,this.id=e.id,this.width=e.width,this.fillColor=e.fillColor,this.stroke=e.stroke,this.opacity=e.opacity,this.type=e.type,this.level=e.level,this.time=e.time,this.endr=e.endr,this.endopacity=e.endopacity,this.bstart=e.bstart,this.clickcall=e.clickcall,this.mouseover=e.mouseover,this.mouseout=e.mouseout,this.map=null,this.CgsEffectObj.circleObj.push(this),null==d3.select("#svg_"+this.id)[0][0]?this.svg=d3.select("#"+this.CgsEffectObj.id).append("svg").attr("width","100%").attr("height","100%").style("overflow","visible").attr("id","svg_"+this.id).style("pointer-events","none"):this.svg=d3.select("#svg_"+this.id);var t=document.getElementById("svg_"+this.id);return t.style.left=this.CgsEffectObj.getPosition(this.lonlat)[0],t.style.top=this.CgsEffectObj.getPosition(this.lonlat)[1],t.style.position="absolute",this},CgsEffectCurve=function(e){this.CgsEffectObj=e.CgsEffectObj,this.startlonlat=e.startlonlat,this.endlonlat=e.endlonlat,this.bdirection=e.bdirection,this.id=e.id,this.width=e.width,this.fillColor=e.fillColor,this.opacity=null==e.opacity?1:e.opacity,this.type=e.type,this.length=e.length,this.time=e.time,this.clickcall=e.clickcall,this.mouseover=e.mouseover,this.mouseout=e.mouseout,this.fadeTime=e.fadeTime,this.map=null,void 0!==e.bflag&&1!=e.bflag||this.CgsEffectObj.curveObj.push(this),this.w=this.CgsEffectObj.map.getPixelFromLonLat(EFFECT_RIGHT_BOTTOM)[0]-this.CgsEffectObj.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[0],this.h=this.CgsEffectObj.map.getPixelFromLonLat(EFFECT_RIGHT_BOTTOM)[1]-this.CgsEffectObj.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[1];var t,i=this.CgsEffectObj.map.getPixelFromLonLat(this.startlonlat)[0]-this.CgsEffectObj.map.getPixelFromLonLat(this.endlonlat)[0],s=this.CgsEffectObj.map.getPixelFromLonLat(this.startlonlat)[1]-this.CgsEffectObj.map.getPixelFromLonLat(this.endlonlat)[1],o=this.CgsEffectObj.map.getPixelFromLonLat(this.startlonlat)[0]-this.CgsEffectObj.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[0],a=this.CgsEffectObj.map.getPixelFromLonLat(this.startlonlat)[1]-this.CgsEffectObj.map.getPixelFromLonLat(EFFECT_LEFT_TOP)[1];this.dis=Math.sqrt(i*i+s*s),this.position=[],this.position=this.CgsEffectObj.getCircleCoordinate(this.startlonlat,this.endlonlat,this.dis,this.bdirection),this.middleCoordinate=this.CgsEffectObj.getCurveMiddleCoordinate(this.startlonlat,this.endlonlat,this.position),this.value=[],this.value[0]=o-this.position[0],this.value[1]=a-this.position[1],0==this.value[0]&&0<this.value[1]?this.value[2]=-180:0==this.value[0]&&this.value[1]<0?this.value[2]=0:0<this.value[0]&&0==this.value[1]?this.value[2]=90:this.value[0]<0&&0==this.value[1]?this.value[2]=-90:0<this.value[0]&&this.value[1]<0?this.value[2]=180/Math.PI*Math.atan(-1*this.value[0]/this.value[1]):this.value[0]<0&&this.value[1]<0?this.value[2]=-180/Math.PI*Math.atan(this.value[0]/this.value[1]):this.value[0]<0&&0<this.value[1]?this.value[2]=-90-180/Math.PI*Math.atan(-1*this.value[1]/this.value[0]):0<this.value[0]&&0<this.value[1]&&(this.value[2]=-180-180/Math.PI*Math.atan(this.value[0]/this.value[1])),this.arcflag=1,this.bdirection&&0<=i?this.arcflag=-1:this.bdirection&&i<=0||!this.bdirection&&0<=i?this.arcflag=1:!this.bdirection&&i<=0&&(this.arcflag=-1),this.arc=d3.svg.arc(),null==d3.select("#svg_"+this.id)[0][0]?this.svg=d3.select("#"+this.CgsEffectObj.id).append("svg").attr("width","100%").attr("height","100%").style("overflow","visible").attr("id","svg_"+this.id).style("pointer-events","none"):this.svg=d3.select("#svg_"+this.id),1!=e.isRefresh&&((t=this.svg.append("defs").append("linearGradient").attr("id","color"+this.id).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%")).append("stop").style("stop-color",this.fillColor).style("stop-opacity","0.1").attr("offset","0%"),t.append("stop").style("stop-color",this.fillColor).style("stop-opacity","1").attr("offset","90%"));var n=document.getElementById("svg_"+this.id);return n.style.left=this.position[0]/this.w*100+"%",n.style.top=this.position[1]/this.h*100+"%",n.style.position="absolute",this},CgsObject=function(e){ol.Object.call(this,e),this.type="Object"},CgsExtend(CgsObject,ol.Object),CgsObject.prototype.getType=function(){return this.type},CgsIds=CgsIds||0,CgsMap2D=function(e){var t,i,s,o,a=this;this.target=e.target,this.zoom=e.zoom,this.center=e.center,this.projection=void 0===e.projection?"EPSG:102113":e.projection,this.extent=null,(this.center[0]<-180||180<this.center[0])&&console.error("map view center lon is not in [-180,180]"),(this.center[1]<-90||90<this.center[1])&&console.error("map view center lat is not in [-90,90]"),e.extent?(t=e.extent,i=ol.proj.transform([t[0],t[1]],"EPSG:4326",this.projection),s=ol.proj.transform([t[2],t[3]],"EPSG:4326",this.projection),this.extent=[i[0],i[1],s[0],s[1]]):(o=ol.proj.get(e.projection||"EPSG:102113"),this.extent=o.getExtent()),!1===e.isRestrictedExtent?(this.extent="none",this.wrapX=!0):this.wrapX=!1;var n={center:ol.proj.transform(this.center,"EPSG:4326",this.projection),zoom:this.zoom,projection:this.projection,extent:this.extent};this.view=new ol.View(n);var r={doubleClickZoom:!1};r.pinchRotate=e.pinchRotate;var l=ol.interaction.defaults(r);this.allLayers=[],this.wmsLayerInfos=[],this.wmsLayers=[];var u={target:this.target,controls:[],view:this.view,interactions:l};ol.Map.call(this,u),this.type="Map",this.stringStr="string",this.addEventListener("pointermove",function(e){var t=e.pixel;CgsSubPub.publish("viewpoint",{x:t[0],y:t[1]})}),this.vectorLayerSource=new ol.source.Vector({wrapX:this.wrapX}),this.vectorLayer=new ol.layer.Vector({source:this.vectorLayerSource}),this.vectorLayer.setZIndex(9999),this.addLayer(this.vectorLayer),this.allMultiPoints=[];var p,a=this;p={Drag:function(){ol.interaction.Pointer.call(this,{handleDownEvent:p.Drag.prototype.handleDownEvent,handleDragEvent:p.Drag.prototype.handleDragEvent,handleMoveEvent:p.Drag.prototype.handleMoveEvent,handleUpEvent:p.Drag.prototype.handleUpEvent}),a.coordinate_=null,a.cursor_="pointer",a.feature_=null,a.previousCursor_=void 0}},CgsUtil.inherits(p.Drag,ol.interaction.Pointer),p.Drag.prototype.handleDownEvent=function(e){if(!a.feature_||!a.feature_.parentFeature.labelDraggable){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e});if(!t||t.dragEnable){if(t){var i=t.getGeometry();if(i instanceof ol.geom.MultiPolygon)return;if(i instanceof ol.geom.LineString)return;a.coordinate_=e.coordinate,a.feature_=t}return!!t}}},p.Drag.prototype.handleDragEvent=function(e){if((!a.feature_||!a.feature_.parentFeature.labelDraggable)&&(a.coordinate_||(a.coordinate_=e.coordinate),a.feature_||(a.feature_=map.map2D.forEachFeatureAtPixel(e.pixel,function(e){return e})),!a.feature_||a.feature_.dragEnable)){var t=e.coordinate[0]-a.coordinate_[0],i=e.coordinate[1]-a.coordinate_[1];if(a.feature_.getGeometry().translate(t,i),a.coordinate_[0]=e.coordinate[0],a.coordinate_[1]=e.coordinate[1],a.feature_.dragPointFlag&&a.feature_.parentFeature){var s=a.feature_.getGeometry();if("EPSG:4326"==a.projection){if(a.feature_.parentFeature.labelDraggable)return;a.feature_.parentFeature.setPosition(s.getCoordinates())}else if("EPSG:102113"==a.projection){var o=ol.proj.transform(s.getCoordinates(),"EPSG:102113","EPSG:4326");if(a.feature_.parentFeature.labelDraggable)return;a.feature_.parentFeature.setPosition(o)}console.log(a.feature_.getPosition())}}},p.Drag.prototype.handleMoveEvent=function(e){if((!a.feature_||!a.feature_.parentFeature.labelDraggable)&&a.cursor_){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e});if(t&&!t.dragEnable)return;var i=e.map.getTargetElement();t?i.style.cursor!=a.cursor_&&(a.previousCursor_=i.style.cursor,i.style.cursor=a.cursor_):void 0!==a.previousCursor_&&(i.style.cursor=a.previousCursor_,a.previousCursor_=void 0)}},p.Drag.prototype.handleUpEvent=function(e){if(a.feature_&&a.feature_.parentFeature){var t=a.feature_.getGeometry();if("EPSG:4326"==a.projection){if(a.feature_.parentFeature.labelDraggable)return;a.feature_.parentFeature.setPosition(t.getCoordinates())}else if("EPSG:102113"==a.projection){var i=ol.proj.transform(t.getCoordinates(),"EPSG:102113","EPSG:4326");if(a.feature_.parentFeature.labelDraggable)return;a.feature_.parentFeature.setPosition(i)}}return a.coordinate_=null,a.feature_=null,!1},appD=new p.Drag,a.addInteraction(appD)},CgsInherits(CgsMap2D,CgsObject),CgsExtend(CgsMap2D,ol.Map),CgsMap2D.prototype.olMapInit=function(e){ol.Object.call(this);var t=ol.Map.createOptionsInternal(e);this.loadTilesWhileAnimating_=void 0!==e.loadTilesWhileAnimating&&e.loadTilesWhileAnimating,this.loadTilesWhileInteracting_=void 0!==e.loadTilesWhileInteracting&&e.loadTilesWhileInteracting,this.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:ol.has.DEVICE_PIXEL_RATIO,this.logos_=t.logos,this.animationDelayKey_=void 0,this.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_.call(this,Date.now())}.bind(this),this.coordinateToPixelTransform_=ol.transform.create(),this.pixelToCoordinateTransform_=ol.transform.create(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=ol.extent.createEmpty(),this.viewPropertyListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("DIV"),this.viewport_.className="ol-viewport"+(ol.has.TOUCH?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.viewport_.style.msTouchAction="none",this.viewport_.style.touchAction="none",this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var i,s=[ol.events.EventType.CLICK,ol.events.EventType.DBLCLICK,ol.events.EventType.MOUSEDOWN,ol.events.EventType.TOUCHSTART,ol.events.EventType.MSPOINTERDOWN,ol.MapBrowserEvent.EventType.POINTERDOWN,ol.events.EventType.MOUSEWHEEL,ol.events.EventType.WHEEL],o=0,a=s.length;o<a;++o)ol.events.listen(this.overlayContainerStopEvent_,s[o],ol.events.Event.stopPropagation);for(i in this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new ol.MapBrowserEventHandler(this),ol.MapBrowserEvent.EventType)ol.events.listen(this.mapBrowserEventHandler_,ol.MapBrowserEvent.EventType[i],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=t.keyboardEventTarget,this.keyHandlerKeys_=null,ol.events.listen(this.viewport_,ol.events.EventType.WHEEL,this.handleBrowserEvent,this),ol.events.listen(this.viewport_,ol.events.EventType.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls_=t.controls,this.interactions_=t.interactions,this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=new t.rendererConstructor(this.viewport_,this),this.handleResize_,this.focus_=null,this.preRenderFunctions_=[],this.postRenderFunctions_=[],this.tileQueue_=new ol.TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.LAYERGROUP),this.handleLayerGroupChanged_,this),ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.VIEW),this.handleViewChanged_,this),ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.SIZE),this.handleSizeChanged_,this),ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.TARGET),this.handleTargetChanged_,this),this.setProperties(t.values),this.controls_.forEach(function(e){e.setMap(this)},this),ol.events.listen(this.controls_,ol.Collection.EventType.ADD,function(e){e.element.setMap(this)},this),ol.events.listen(this.controls_,ol.Collection.EventType.REMOVE,function(e){e.element.setMap(null)},this),this.interactions_.forEach(function(e){e.setMap(this)},this),ol.events.listen(this.interactions_,ol.Collection.EventType.ADD,function(e){e.element.setMap(this)},this),ol.events.listen(this.interactions_,ol.Collection.EventType.REMOVE,function(e){e.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_,this),ol.events.listen(this.overlays_,ol.Collection.EventType.ADD,function(e){this.addOverlayInternal_(e.element)},this),ol.events.listen(this.overlays_,ol.Collection.EventType.REMOVE,function(e){var t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)},this)},CgsMap2D.prototype.addLayer=function(e){this.allLayers.push(e);var t=this.getLayers();if(null!=e.state&&"WMS"==e.state.type){var i=!1;e.setMap(this);for(var s,o,a,n,r=0;r<this.wmsLayerInfos.length;r++)if(e.state.url==this.wmsLayerInfos[r].layerOpt.url){this.wmsLayerInfos[r].wmsLayers.push(e),e.state.wmsLayerInfo=this.wmsLayerInfos[r],null!=e.state.visible&&!e.state.visible||(""==this.wmsLayerInfos[r].layerOpt.layers?this.wmsLayerInfos[r].layerOpt.layers=e.state.layers:(this.wmsLayerInfos[r].index=t.array_.indexOf(this.wmsLayerInfos[r].wmslayer),t.remove(this.wmsLayerInfos[r].wmslayer),this.wmsLayerInfos[r].layerOpt.layers=e.state.layers+","+this.wmsLayerInfos[r].layerOpt.layers),a=new CgsSourceWMS2D(this.wmsLayerInfos[r].layerOpt),n=new CgsLayerTile2D({opacity:this.wmsLayerInfos[r].layerOpt.opacity,source:a}),this.wmsLayerInfos[r].wmslayer=n,t.insertAt(this.wmsLayerInfos[r].index,n)),i=!0;break}i||(s=t.array_.length,o={layerOpt:{format:e.state.format,projection:e.state.projection,url:e.state.url,version:e.state.version,layers:"",serverType:e.state.serverType,opacity:e.state.opacity,proxy:e.state.proxy,isAddToLayerTree:e.state.isAddToLayerTree},wmslayer:null,index:s,wmsLayers:[e]},this.wmsLayerInfos.push(o),e.state.wmsLayerInfo=o,a=new CgsSourceWMS2D(e.state),n=new CgsLayerTile2D({opacity:e.state.opacity,source:a}),t.push(n),o.wmslayer=n,null==e.state.visible||e.state.visible?o.layerOpt.layers=e.state.layers:n.setVisible(!1))}else t.push(e);e instanceof CgsGroupVector2D?(CgsSubPub.publish("map/groupadded",[e]),e.on("change:visible",function(){CgsSubPub.publish("map/groupvisiblechanged",[this])})):(e instanceof CgsLayerTile2D||e instanceof CgsImageLayer2D||e instanceof ol.layer.Image)&&(e.map2D=this,CgsSubPub.publish("map/layeradded",[e]),e.on("change:visible",function(){CgsSubPub.publish("map/layervisiblechanged",[this])}))},CgsMap2D.prototype.removeLayer=function(e){this.allLayers.splice(this.allLayers.indexOf(e),1);var t=this.getLayers();if(!e.state||"WMS"!=e.state.type)return CgsSubPub.publish("map/layerremoved",[e]),t.remove(e);e.setMap(null);for(var i=0;i<this.wmsLayerInfos.length;i++)if(e.state.url==this.wmsLayerInfos[i].layerOpt.url&&-1<this.wmsLayerInfos[i].layerOpt.layers.indexOf(e.state.layers)){var s=this.wmsLayerInfos[i].wmsLayers.indexOf(e);if(this.wmsLayerInfos[i].wmsLayers.splice(s,1),0==this.wmsLayerInfos[i].layerOpt.layers.indexOf(e.state.layers)?this.wmsLayerInfos[i].layerOpt.layers=this.wmsLayerInfos[i].layerOpt.layers.replace(e.state.layers,""):this.wmsLayerInfos[i].layerOpt.layers=this.wmsLayerInfos[i].layerOpt.layers.replace(","+e.state.layers,""),this.wmsLayerInfos[i].index=t.array_.indexOf(this.wmsLayerInfos[i].wmslayer),t.remove(this.wmsLayerInfos[i].wmslayer),CgsSubPub.publish("map/layerremoved",[e]),""!=this.wmsLayerInfos[i].layerOpt.layers){var o=new CgsSourceWMS2D(this.wmsLayerInfos[i].layerOpt),a=new CgsLayerTile2D({opacity:this.wmsLayerInfos[i].layerOpt.opacity,source:o});this.wmsLayerInfos[i].wmslayer=a,t.insertAt(this.wmsLayerInfos[i].index,a);break}this.wmsLayerInfos.splice(i,1)}return CgsSubPub.publish("map/layerremoved",[e]),t.remove(e)},CgsMap2D.prototype.raiseLayer=function(e){if(e.getMap()){var t=this.allLayers,i=this.getLayers(),s=t.indexOf(e);if(s<t.length){var o=t[s+1];if(t[s+1]=t[s],t[s]=o,e instanceof CgsWMSLayer2D){var a=e.state.wmsLayerInfo,n=a.wmsLayers.indexOf(e);a.wmsLayers.length;if(0==n){var r,l,u=!1;(t[s]instanceof CgsWMSLayer2D&&t[s].state.url!=e.state.url&&0==t[s].state.wmsLayerInfo.wmsLayers.indexOf(t[s])||t[s]instanceof CgsLayerTile2D||t[s]instanceof CgsImageLayer2D)&&(u=!0),u&&(r=i.array_.indexOf(a.wmslayer),l=i.array_[r],i.array_[r]=i.array_[r+1],i.array_[r+1]=l)}else if(!(t[s]instanceof CgsWMSLayer2D&&t[s].state.url!=e.state.url||t[s]instanceof CgsLayerTile2D||t[s]instanceof CgsImageLayer2D)){o=a.wmsLayers[n+1],a.wmsLayers[n+1]=a.wmsLayers[n],a.wmsLayers[n]=o,i.remove(a.wmslayer),a.layerOpt.layers="";for(var p=0;p<a.wmsLayers.length;p++)a.wmsLayers[p].state.visible&&(a.layerOpt.layers=0!=p?a.wmsLayers[p].state.layers+","+a.layerOpt.layers:a.wmsLayers[p].state.layers);var h=new CgsSourceWMS2D(a.layerOpt),c=new CgsLayerTile2D({opacity:a.layerOpt.opacity,source:h});a.wmslayer=c,i.insertAt(a.index,c)}}else{(e instanceof CgsLayerTile2D||e instanceof CgsImageLayer2D)&&(u=!1,(t[s]instanceof CgsWMSLayer2D&&0==t[s].state.wmsLayerInfo.wmsLayers.indexOf(t[s])||t[s]instanceof CgsLayerTile2D||t[s]instanceof CgsImageLayer2D)&&(u=!0),u&&(r=i.array_.indexOf(e),l=i.array_[r],i.array_[r]=i.array_[r+1],i.array_[r+1]=l))}}}},CgsMap2D.prototype.lowerLayer=function(e){if(e.getMap()){var t=this.allLayers,i=this.getLayers(),s=t.indexOf(e);if(0<s){var o=t[s-1];if(t[s-1]=t[s],t[s]=o,e instanceof CgsWMSLayer2D){var a=e.state.wmsLayerInfo,n=a.wmsLayers.indexOf(e);if(0==n){var r,l,u=!1;(t[s]instanceof CgsWMSLayer2D&&t[s].state.url!=e.state.url&&0==t[s].state.wmsLayerInfo.wmsLayers.indexOf(t[s])||t[s]instanceof CgsLayerTile2D||t[s]instanceof CgsImageLayer2D)&&(u=!0),u&&(r=i.array_.indexOf(a.wmslayer),l=i.array_[r],i.array_[r]=i.array_[r-1],i.array_[r-1]=l)}else if(!(t[s]instanceof CgsWMSLayer2D&&t[s].state.url!=e.state.url||t[s]instanceof CgsLayerTile2D||t[s]instanceof CgsImageLayer2D)){o=a.wmsLayers[n-1],a.wmsLayers[n-1]=a.wmsLayers[n],a.wmsLayers[n]=o,i.remove(a.wmslayer),a.layerOpt.layers="";for(var p=0;p<a.wmsLayers.length;p++)a.wmsLayers[p].state.visible&&(a.layerOpt.layers=0!=p?a.wmsLayers[p].state.layers+","+a.layerOpt.layers:a.wmsLayers[p].state.layers);var h=new CgsSourceWMS2D(a.layerOpt),c=new CgsLayerTile2D({opacity:a.layerOpt.opacity,source:h});a.wmslayer=c,i.insertAt(a.index,c)}}else{(e instanceof CgsLayerTile2D||e instanceof CgsImageLayer2D)&&(u=!1,(t[s]instanceof CgsWMSLayer2D&&0==t[s].state.wmsLayerInfo.wmsLayers.indexOf(t[s])||t[s]instanceof CgsLayerTile2D||t[s]instanceof CgsImageLayer2D)&&(u=!0),u&&(r=i.array_.indexOf(e),l=i.array_[r],i.array_[r]=i.array_[r-1],i.array_[r-1]=l))}}}},CgsMap2D.prototype.addKmlVector=function(e){this.addLayer(e)},CgsMap2D.prototype.removeKmlVector=function(e){e.closeManipulateMode(),this.removeLayer(e)},CgsMap2D.prototype.addGroupVector=function(e){e.map||(this.addLayer(e),e.map=this)},CgsMap2D.prototype.removeGroupVector=function(e){this.removeLayer(e),e.map=null},CgsMap2D.prototype.removeGroupsVectorByName=function(e){for(var t=this.getGroupsByName(e),i=0;i<t.length;i++)this.removeGroupVector(t[i])},CgsMap2D.prototype.getGroupsByName=function(e){for(var t=this.getLayers().array_,i=[],s=0;s<t.length;s++)e==t[s].groupName&&i.push(t[s]);return i},CgsMap2D.prototype.getAllGroups=function(){for(var e=this.getLayers().array_,t=[],i=0;i<e.length;i++)null!=e[i].groupName&&t.push(e[i]);return t},CgsMap2D.prototype.removeAllGroups=function(){for(var e=this.getLayers().array_,t=e.length-1;-1<t;t--)null!=e[t].groupName&&this.removeGroupVector(e[t])},CgsMap2D.prototype.getCenter=function(){var e=this.view.getCenter();return ol.proj.transform(e,this.projection,"EPSG:4326")},CgsMap2D.prototype.setCenter=function(e){var t=ol.proj.transform(e,"EPSG:4326",this.projection);this.view.setCenter(t)},CgsMap2D.prototype.getZoom=function(){return Math.round(this.view.getZoom())},CgsMap2D.prototype.setZoom=function(e){this.view.setZoom(e)},CgsMap2D.prototype.setMinZoom=function(e){this.view.setMinZoom(e)},CgsMap2D.prototype.setMaxZoom=function(e){this.view.setMaxZoom(e)},CgsMap2D.prototype.getResolution=function(){return this.view.getResolution()},CgsMap2D.prototype.setResolution=function(e){this.view.setResolution(e)},CgsMap2D.prototype.getZoomByResolution=function(e){var t=this.view.getMaxResolution(),i=Math.floor(Math.log(t/e)/Math.log(2)+.5),s=Math.max(i,0);return s+=this.view.getMinZoom()||0,Math.min(s,28)},CgsMap2D.prototype.getResolutionByZoom=function(e){var t=this.view.getMaxResolution();return e-=this.view.getMinZoom()||0,t/Math.pow(2,e)},CgsMap2D.prototype.getPixelFromLonLat=function(lonLat){_typeof(lonLat[0])==this.stringStr&&(lonLat[0]=eval(lonLat[0])),_typeof(lonLat[1])==this.stringStr&&(lonLat[1]=eval(lonLat[1]));var lonLat=ol.proj.transform(lonLat,"EPSG:4326",this.projection),p=this.getPixelFromCoordinate(lonLat);return p},CgsMap2D.prototype.getLonLatFromPixel=function(e){var t=this.getCoordinateFromPixel(e);return t?ol.proj.transform(t,this.projection,"EPSG:4326"):null},CgsMap2D.prototype.removeFeatureByID=function(e){for(var t,i,s=this.getLayers().array_,o=0;o<s.length;o++){null==s[o].groupName||null!=(i=(t=s[o].getSource()).getFeatureById(e))&&t.removeFeature(i)}},CgsMap2D.prototype.getFeatureByID=function(e){for(var t=this.getLayers().array_,i=0;i<t.length;i++)if(null!=t[i].groupName){var s=t[i].getSource().getFeatureById(e);if(null!=s)return s}return null},CgsMap2D.prototype.saveFeaturesToJSON=function(){for(var e=this.getAllGroups(),t=[],i=0;i<e.length;i++)if(e[i].getVisible())for(var s=e[i].getAllFeatures(),o=0;o<s.length;o++)s[o].style_||(s[o].style_=e[i].style_),s[o].groupName||(s[o].groupName=e[i].groupName),t.push(s[o]);return(new CgsGeoJSON2D).writeFeaturesObject(t)},CgsMap2D.prototype.readFeaturesFromJSON=function(e){var t=(new CgsGeoJSON2D).readFeaturesFromObject(e);return console.info(t),t},CgsMap2D.prototype.addPopup=function(e){var t=this.getOverlayById("ol-feature-popup-overlay");t&&this.removeOverlay(t),this.addOverlay(e)},CgsMap2D.prototype.removePopup=function(e){this.removeOverlay(e)},CgsMap2D.prototype.transform=function(e){return ol.proj.transform(e,"EPSG:102113","EPSG:4326")},CgsMap2D.prototype.transformMeter=function(e){return ol.proj.transform(e,"EPSG:4326","EPSG:102113")},CgsMap2D.prototype.addEffect=function(t){var e,i,s,o,a,n,r,l,u;t.CgsEffectObj.isAddFlag=!0,"line"==t.type?(e=t.svg.append("rect").attr({x:0,y:-t.height/2,width:t.value[1]/t.w*100+"%",height:t.height}).attr({transform:"rotate("+t.value[0]+")"}).style("pointer-events","auto").attr("id",t.id).style("fill",t.fillColor).style("opacity",t.opacity),o=t,e[0][0].onclick=function(e){t.clickcall&&t.clickcall(e,o)},e[0][0].onmouseover=function(e){t.mouseover&&t.mouseover(e,o)},e[0][0].onmouseout=function(e){t.mouseout&&t.mouseout(e,o)}):"flyline"==t.type?(t.svg.append("rect").attr({x:0,y:-t.height/2,width:t.length/t.w*100+"%",height:t.height}).attr({transform:"rotate("+t.value[0]+")"}).attr("id",t.id).style("fill","url(#color"+t.id+")").style("opacity",t.opacity).transition().duration(t.time).ease("linear").attr({x:(t.value[1]-t.length)/t.w*100+"%",y:-t.height/2,width:t.length/t.w*100+"%",height:t.height}).remove(),u=setInterval(function(){t.svg.append("rect").attr({x:0,y:-t.height/2,width:t.length/t.w*100+"%",height:t.height}).attr({transform:"rotate("+t.value[0]+")"}).attr("id",t.id).style("fill","url(#color"+t.id+")").style("opacity",t.opacity).transition().duration(t.time).ease("linear").attr({x:(t.value[1]-t.length)/t.w*100+"%",y:-t.height/2,width:t.length/t.w*100+"%",height:t.height}).remove()},t.time+100),t.CgsEffectObj.timer.push([t.id,u])):"circle"==t.type?(e=t.svg.append("circle").attr({cx:0,cy:0,r:t.r}).attr("id",t.id).style("fill",t.fillColor).style("stroke",t.stroke).style("stroke-width",t.width).style("opacity",t.opacity).style("pointer-events","auto"),o=t,e[0][0].onclick=function(e){t.clickcall&&t.clickcall(e,o)},e[0][0].onmouseover=function(e){t.mouseover&&t.mouseover(e,o)},e[0][0].onmouseout=function(e){t.mouseout&&t.mouseout(e,o)}):"flycircle"==t.type?(t.bstart&&d3.range(t.level).forEach(function(e){t.svg.append("circle").attr({cx:0,cy:0,r:t.r}).style({fill:t.fillColor,stroke:t.stroke,"stroke-width":t.width,opacity:t.opacity}).transition().duration(t.time).delay(50*e).attr("r",t.endr).style("opacity",t.endopacity).remove()}),u=setInterval(function(){d3.range(t.level).forEach(function(e){t.svg.append("circle").attr({cx:0,cy:0,r:t.r}).style({fill:t.fillColor,stroke:t.stroke,"stroke-width":t.width,opacity:t.opacity}).transition().duration(t.time).delay(50*e).attr("r",t.endr).style("opacity",t.endopacity).remove()})},t.time),t.CgsEffectObj.timer.push([t.id,u])):"curve"==t.type?(e=t.svg.append("path").attr("d",t.arc({outerRadius:t.dis+t.width/2,innerRadius:t.dis-t.width/2,startAngle:t.value[2]/180*Math.PI,endAngle:(t.value[2]-60*t.arcflag)/180*Math.PI})).style({fill:t.fillColor}).attr("id",t.id).style("pointer-events","auto"),t.fadeTime?(d3.select("#"+t.id).style({opacity:0}),i=t.fadeTime/20,s=0,t.fadeoutInterval&&(clearInterval(t.fadeoutInterval),t.fadeoutInterval=null),t.fadeinInterval=setInterval(function(){var e=++s/i*t.opacity;d3.select("#"+t.id).style({opacity:e}),s==i&&(clearInterval(t.fadeinInterval),t.fadeinInterval=null)},20)):d3.select("#"+t.id).style({opacity:t.opacity}),o=t,e[0][0].onclick=function(e){t.clickcall&&t.clickcall(e,o)},e[0][0].onmouseover=function(e){t.mouseover&&t.mouseover(e,o)},e[0][0].onmouseout=function(e){t.mouseout&&t.mouseout(e,o)}):"flycurve"==t.type&&(a=2*Math.PI*t.dis,n=t.length/a*360,t.svg.append("path").attr("d",t.arc({outerRadius:t.dis+t.width/2,innerRadius:t.dis-t.width/2,startAngle:t.value[2]/180*Math.PI,endAngle:(t.value[2]-n*t.arcflag)/180*Math.PI})).style({fill:"url(#color"+t.id+")"}).attr("id",t.id).style({opacity:t.opacity}),r=0,l=20/t.time*60,u=setInterval(function(){r*l<=60-n?d3.select("#"+t.id).attr("d",t.arc({outerRadius:t.dis+t.width/2,innerRadius:t.dis-t.width/2,startAngle:(t.value[2]-l*r*t.arcflag)/180*Math.PI,endAngle:(t.value[2]-n*t.arcflag-l*r*t.arcflag)/180*Math.PI})):r*l<60&&d3.select("#"+t.id).attr("d",t.arc({outerRadius:t.dis+t.width/2,innerRadius:t.dis-t.width/2,startAngle:(t.value[2]-l*r*t.arcflag)/180*Math.PI,endAngle:(t.value[2]-60*t.arcflag)/180*Math.PI})),60<=++r*l&&(r=0)},20),t.CgsEffectObj.timer.push([t.id,u]))},CgsMap2D.prototype.modifyEffect=function(e,t,i,s){"height"==i||"width"==i?d3.select("#"+t).attr(i,s):"opacity"!=i&&"fill"!=i&&"stroke"!=i&&"stroke-width"!=i||d3.select("#"+t).style(i,s);for(var o=0;o<e.lineObj.length;o++)if(e.lineObj[o].id==t){if("height"==i){e.lineObj[o].height=s;break}if("fill"==i){e.lineObj[o].fill=s;break}if("opacity"==i){e.lineObj[o].opacity=s;break}}for(o=0;o<e.circleObj.length;o++)if(e.circleObj[o].id==t){if("stroke"==i){e.circleObj[o].stroke=s;break}if("fill"==i){e.circleObj[o].fill=s;break}if("opacity"==i){e.circleObj[o].opacity=s;break}if("stroke-width"==i){e.circleObj[o].width=s;break}}for(o=0;o<e.curveObj.length;o++)if(e.curveObj[o].id==t){if("fill"==i){e.curveObj[o].fillColor=s;break}if("opacity"==i){e.curveObj[o].opacity=s;break}}},CgsMap2D.prototype.removeEffect=function(e,t){d3.select("#"+t).remove();for(var i=0;i<e.timer.length;i++)if(e.timer[i][0]==t){clearInterval(e.timer[i][1]),e.timer.splice(i,1);break}for(i=0;i<e.lineObj.length;i++)if(e.lineObj[i].id==t){e.lineObj.splice(i,1);break}for(i=0;i<e.circleObj.length;i++)if(e.circleObj[i].id==t){e.circleObj.splice(i,1);break}for(i=0;i<e.curveObj.length;i++)if(e.curveObj[i].id==t){e.curveObj.splice(i,1);break}},CgsMap2D.prototype.removeAllEffect=function(e){for(var t=0;t<e.timer.length;t++)clearInterval(e.timer[t][1]);for(t=0;t<e.lineObj.length;t++)d3.select("#"+e.lineObj[t].id).remove();for(t=0;t<e.circleObj.length;t++)d3.select("#"+e.circleObj[t].id).remove();for(t=0;t<e.curveObj.length;t++)d3.select("#"+e.curveObj[t].id).remove();e.lineObj=[],e.circleObj=[],e.curveObj=[],e.timer=[]},CgsMap2D.prototype.removeOverlay=function(e){return e.remove(),this.getOverlays().remove(e)},CgsMap2D.prototype.lockScreen=function(e){var t=!e,i=this.getInteractions();window.PlottingInteraction?i.forEach(function(e){e instanceof PlottingInteraction||e.setActive(t)}):i.forEach(function(e){return e.setActive(t)})},CgsMap2D.prototype.getExtent=function(){var e=this.view.calculateExtent(this.getSize()),t=ol.proj.transform([e[0],e[1]],"EPSG:102113","EPSG:4326"),i=ol.proj.transform([e[2],e[3]],"EPSG:102113","EPSG:4326");return t[0]<-180&&(t[0]=360+t[0]),180<i[0]&&(i[0]=-360+i[0]),[t[0],t[1],i[0],i[1]]},CgsMap2D.prototype.setExtent=function(e){var t=ol.proj.transform([e[0],e[1]],"EPSG:4326","EPSG:102113"),i=ol.proj.transform([e[2],e[3]],"EPSG:4326","EPSG:102113"),s=this.getView().getResolutionForExtent([t[0],t[1],i[0],i[1]],this.getSize());this.getView().setResolution(s),this.getView().setCenter(ol.extent.getCenter([t[0],t[1],i[0],i[1]]))},CgsMap2D.prototype.locateEffectHelperStart=function(){var i=this,s=i.locateEffectHelper;return s.setPostRender=function(){i.on("postcompose",function(){var e,t=i.locateEffectHelper.store;t.geoPos&&(e=map.lonLatToPixel(t.geoPos),s.locateEffectGroup.attr("position",e))})},s},CgsMap2D.prototype.lockZoom=function(){for(var e=this.getInteractions().getArray(),t=0,i=e.length;t<i;t++){var s=e[t];s instanceof ol.interaction.MouseWheelZoom&&(s.setActive(!1),this.removeInteraction(s))}},CgsMap2D.prototype.unlockZoom=function(){this.addInteraction(new ol.interaction.MouseWheelZoom)},CgsMap2D.prototype.addFeature=function(e){var t=this.vectorLayerSource;e instanceof CgsFeature2D&&t.addFeature(e)},CgsMap2D.prototype.removeFeature=function(e){var t=this.vectorLayerSource;e instanceof CgsFeature2D&&t.hasFeature(e)&&t.removeFeature(e)},CgsMap2D.prototype.getLayerByText=function(e){for(var t=this.getLayers().getArray(),i=0,s=t.length;i<s;i++){var o=t[i];if(o.state&&o.state.text===e)return o}return null},CgsSource2D=function(e){ol.source.Source.call(this,e)},CgsInherits(CgsSource2D,CgsObject),CgsExtend(CgsSource2D,ol.source.Source),CgsSourceWMTS2D=function(e){this.proxy=e.proxy,this.url=e.url,this.layername=e.layername,this.projection=null==e.projection?"EPSG:102113":e.projection,this.matrixSet=void 0===e.matrixSet?"OGC_WebMercator":e.matrixSet;var t=ol.proj.get(this.projection),i=t.getExtent();this.tileSize=null==e.tileWidth?256:e.tileWidth;var s=ol.extent.getHeight(i)/this.tileSize;if(this.matrixIds=e.matrixIds,this.resolutions=e.resolutions,null==this.matrixIds&&null==this.resolutions){this.resolutions=new Array(28),this.matrixIds=new Array(28);for(var o=0;o<28;++o)this.resolutions[o]=s/Math.pow(2,o),this.matrixIds[o]=o+1}else if(null==this.matrixIds){this.matrixIds[o]=new Array(this.resolutions.length);for(o=0;o<this.resolutions.length;++o)this.matrixIds[o]=o+1}else if(null==this.resolutions){this.resolutions=new Array(this.matrixIds.length);for(o=0;o<this.matrixIds.length;++o)this.resolutions[o]=s/Math.pow(2,o)}else if(this.matrixIds.length!=this.resolutions.length)if(this.matrixIds.length>this.resolutions.length)for(o=this.resolutions.length;o<this.matrixIds.length;++o)this.resolutions[o]=this.resolutions[o-1]/2;else for(o=this.matrixIds.length;o<this.resolutions.length;++o)this.matrixIds[o]=this.matrixIds[o-1]+1;this.requestEncoding=e.requestEncoding,this.origin=e.origin,null==this.origin&&(this.origin=ol.extent.getTopLeft(i));var a={url:this.url,layer:this.layername,matrixSet:this.matrixSet,requestEncoding:this.requestEncoding,format:"image/png",projection:t,tileGrid:new ol.tilegrid.WMTS({origin:this.origin,resolutions:this.resolutions,matrixIds:this.matrixIds}),style:"default",wrapX:0!=e.wrapX,version:"1.3.0"};CgsSource2D.call(this,a),ol.source.WMTS.call(this,a)},CgsInherits(CgsSourceWMTS2D,CgsSource2D),CgsExtend(CgsSourceWMTS2D,ol.source.WMTS),CgsSourceWMS2D=function(e){this.proxy=e.proxy;var t={url:e.url,params:{LAYERS:e.layers,VERSION:void 0===e.version?"1.3.0":e.version},projection:void 0===e.projection?"EPSG:102113":e.projection,serverType:void 0===e.serverType?"mapserver":e.serverType};CgsSource2D.call(this,t),ol.source.TileWMS.call(this,t)},CgsInherits(CgsSourceWMS2D,CgsSource2D),CgsExtend(CgsSourceWMS2D,ol.source.TileWMS),CgsSourceXYZ2D=function(e){var t={url:e.url.replace("{reverseY}","{-y}")};CgsSource2D.call(this,t),ol.source.XYZ.call(this,t)},CgsInherits(CgsSourceXYZ2D,CgsSource2D),CgsExtend(CgsSourceXYZ2D,ol.source.XYZ),CgsLayer2D=function(e){var t=CgsIds++;this.state={group:null,pId:e.pId,map:null,id:"cgslayer_id_"+t,type:e.type,text:e.text,name:e.name,layer:e.layer,layers:e.layers,url:e.url,level:e.level,minVisLevel:e.minVisLevel,maxVisLevel:e.maxVisLevel,rectangle:e.rectangle,maxHeight:e.maxHeight,minHeight:e.minHeight,visible:e.visible,saveFlag:e.saveFlag,projection:e.projection,version:e.version,isAddToLayerTree:1==e.isAddToLayerTree},e.text||(e.text=e.name),e.minHeight||(e.minHeight=0),e.name||(e.name=e.text),e.rectangle||(e.rectangle=[-180,-90,180,90]),e.minVisLevel||(e.minVisLevel=0),e.maxVisLevel||(e.maxVisLevel=28),null==e.saveFlag&&(e.saveFlag=!0),CgsObject.call(this),ol.layer.Layer.call(this,e)},CgsInherits(CgsLayer2D,CgsObject),CgsExtend(CgsLayer2D,ol.layer.Layer),CgsLayer2D.prototype.getMap=function(){return this.map2D},CgsLayer2D.prototype.getUrl=function(){return this.state.url},CgsLayer2D.prototype.getLayer=function(){return this.state.layer},CgsLayer2D.prototype.getLayers=function(){return this.state.layers},CgsLayer2D.prototype.getLevel=function(){return this.state.level},CgsLayer2D.prototype.getProjection=function(){return this.state.projection},CgsLayer2D.prototype.getVersion=function(){return this.state.version},CgsLayer2D.prototype.setName=function(e){this.state.name=e},CgsLayer2D.prototype.getName=function(){return this.state.name?this.state.name:this.state.text},CgsLayer2D.prototype.setText=function(e){this.state.text=e},CgsLayer2D.prototype.getText=function(){return this.state.text},CgsLayer2D.prototype.setAddToLayerTree=function(e){this.state.isAddToLayerTree=e},CgsLayer2D.prototype.getAddToLayerTree=function(){return this.state.isAddToLayerTree},CgsLayer2D.prototype.getId=function(){return this.state.id},CgsLayer2D.prototype.getPId=function(){return this.state.pId},CgsLayer2D.prototype.setPId=function(e){this.state.pId=e},CgsLayerTile2D=function(s){var e,o=this;s.rectangle&&s.source&&"EPSG:102113"===s.source.projection&&(85<(e=s.rectangle)[1]&&(e[1]=85),e[1]<-85&&(e[1]=-85),85<e[3]&&(s.rectangle[3]=85),e[3]<-85&&(e[3]=-85),s.extent=ol.proj.transformExtent(e,"EPSG:4326",s.source.projection)),s.minVisLevel&&CgsSubPub.subscribe("map/layeradded",function(e,t){var i;t===o&&(i=t.map2D.getResolutionByZoom(s.minVisLevel),t.setMaxResolution(i))}),s.maxVisLevel&&CgsSubPub.subscribe("map/layeradded",function(e,t){var i;t===o&&(i=t.map2D.getResolutionByZoom(s.maxVisLevel),t.setMinResolution(i))}),CgsLayer2D.call(this,s),ol.layer.Tile.call(this,s)},CgsUtil.inherits(CgsLayerTile2D,CgsLayer2D),CgsExtend(CgsLayerTile2D,ol.layer.Tile),CgsWMSLayer2D=function(e){this.state=e,this.state.type="WMS",null==this.state.visible&&(this.state.visible=!0)},CgsUtil.inherits(CgsWMSLayer2D,CgsLayer2D),CgsExtend(CgsWMSLayer2D,ol.layer.Tile),CgsWMSLayer2D.prototype.setVisible=function(e){if(e!=this.state.visible&&(this.state.visible=e,this.state.map)){var t=this.state.map.getLayers(),i=this.state.map.wmsLayerInfos;if(e){for(var s=0;s<i.length;s++)if(this.state.url==i[s].layerOpt.url){i[s].index=t.array_.indexOf(i[s].wmslayer),t.remove(i[s].wmslayer),i[s].layerOpt.layers="";for(var o=0;o<i[s].wmsLayers.length;o++)i[s].wmsLayers[o].state.visible&&(i[s].layerOpt.layers=0!=o?i[s].wmsLayers[o].state.layers+","+i[s].layerOpt.layers:i[s].wmsLayers[o].state.layers);var a=new CgsSourceWMS2D(i[s].layerOpt),n=new CgsLayerTile2D({opacity:i[s].layerOpt.opacity,source:a});i[s].wmslayer=n,t.insertAt(i[s].index,n);break}}else for(s=0;s<i.length;s++)if(this.state.url==i[s].layerOpt.url&&-1<i[s].layerOpt.layers.indexOf(this.state.layers)){if(0==i[s].layerOpt.layers.indexOf(this.state.layers)?i[s].layerOpt.layers=i[s].layerOpt.layers.replace(this.state.layers,""):i[s].layerOpt.layers=i[s].layerOpt.layers.replace(","+this.state.layers,""),""!=i[s].layerOpt.layers){i[s].index=t.array_.indexOf(i[s].wmslayer),t.remove(i[s].wmslayer);a=new CgsSourceWMS2D(i[s].layerOpt),n=new CgsLayerTile2D({opacity:i[s].layerOpt.opacity,source:a});i[s].wmslayer=n,t.insertAt(i[s].index,n);break}i[s].wmslayer.setVisible(!1)}}},CgsWMSLayer2D.prototype.getVisible=function(e){return this.state.visible},CgsWMSLayer2D.prototype.setMap=function(e){this.state.map=e},CgsWMSLayer2D.prototype.getMap=function(){return this.state.map},CgsGroupVector2D=function(e){var t=new ol.source.Vector({wrapX:!1});ol.layer.Vector.call(this,{source:t}),this.groupName=e.groupName,this.map=null},CgsUtil.inherits(CgsGroupVector2D,CgsLayer2D),CgsExtend(CgsGroupVector2D,ol.layer.Vector),CgsGroupVector2D.prototype.getGroupName=function(){return this.groupName},CgsGroupVector2D.prototype.setGroupName=function(e){this.groupName=e},CgsGroupVector2D.prototype.addFeature=function(e){e.setGroupName(this.groupName),this.getSource().addFeature(e)},CgsGroupVector2D.prototype.removeFeature=function(e){e.setGroupName(null),this.getSource().removeFeature(e)},CgsGroupVector2D.prototype.getFeatureById=function(e){return this.getSource().getFeatureById(e)},CgsGroupVector2D.prototype.removeFeatureById=function(e){this.removeFeature(this.getFeatureById(e))},CgsGroupVector2D.prototype.addFeatures=function(e){for(var t=0;t<e.length;t++)e[t].feature2D?this.addFeature(e[t].feature2D):this.addFeature(e[t])},CgsGroupVector2D.prototype.getAllFeatures=function(){return this.getSource().getFeatures()},CgsGroupVector2D.prototype.setVisible,CgsGroupVector2D.prototype.setStyle,CgsImageLayer2D=function(e){e.rec&&4==e.rec.length||(e.rec=[-180,-90,180,90]);var t={url:e.url,imageExtent:e.rec,projection:"EPSG:4326"},i={source:new ol.source.ImageStatic(t)};ol.layer.Image.call(this,i)},CgsInherits(CgsImageLayer2D,ol.layer.Image),CgsExtend(CgsImageLayer2D,CgsLayer2D),CgsImageLayer2D.prototype.getMap=function(){return this.map2D},function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsStyle2D=t()}(window,function(){function e(e){var t=e.image,i=e.stroke,s=e.fill,o=e.text;a.call(this,{image:t,stroke:i,fill:s,text:o})}var a=ol.style.Style;return CgsUtil.inherits(e,a),e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsStyleFill2D=t()}(window,function(){function e(e){var t=e.color;i.call(this,{color:t})}var i=ol.style.Fill;return CgsUtil.inherits(e,i),e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsStyleStroke2D=t()}(window,function(){function e(e){var t=e.color,i=e.width,s=e.lineDash;o.call(this,{color:t,width:i,lineDash:s,lineJoin:"miter",lineCap:"butt"})}var o=ol.style.Stroke;return CgsUtil.inherits(e,o),e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsStylePoint2D=t()}(window,function(){function e(e){var t=e.radius,i=e.stroke,s=e.fill;o.call(this,{radius:t,stroke:i,fill:s})}var o=ol.style.Circle;return CgsUtil.inherits(e,o),e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsStyleText2D=t()}(window,function(){function e(e){var t=e.font,i=e.text,s=e.fill,o=e.stroke,a=e.scale,n=e.backgroundFill,r=e.padding,l=e.textAlign,u=void 0===e.rotation?0:-e.rotation/180*Math.PI,p=0,h=0;null!=e.offset&&(null!=e.offset[0]&&(p=e.offset[0]),null!=e.offset[1]&&(h=e.offset[1])),c.call(this,{font:t,text:i,fill:s,stroke:o,scale:a,backgroundFill:n,padding:r,textAlign:l,rotation:u,offsetX:p,offsetY:h})}var c=ol.style.Text;return CgsUtil.inherits(e,c),e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsStyleIcon2D=t()}(window,function(){function e(e){var t=e.color,i=e.anchor,s=e.offsetOrigin,o=e.opacity,a=e.scale,n=(e.src,e.img),r=e.imgSize,l=e.offset,u=e.size,p=-e.rotation/180*Math.PI||0;h.call(this,{color:t,anchor:i,offsetOrigin:s,opacity:o,scale:a,rotation:p,img:n,imgSize:r,offset:l,size:u})}var h=ol.style.Icon;return CgsUtil.inherits(e,h),e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsFeature2D=t()}(window,function(){function e(e){t.call(this,e),e=e||{},this.parentFeature=e.parentFeature?e.parentFeature:null,this.visible=!0,this.groupName=null,this.id_=this.ol_uid,this.attribute=e.attribute,this.isPopup=!0}var t=ol.Feature,i=ol.style.Style,s=ol.style.Fill;return CgsUtil.inherits(e,t),e.prototype.createLabelStyle=function(e){var t=new CgsStyleStroke2D({color:void 0===e.labelstroke?"rgba(0, 0, 0, 0.0)":e.labelstroke,width:void 0===e.labelstrokewidth?0:e.labelstrokewidth}),i=new CgsStyleFill2D({color:void 0===e.labelfill?"rgba(255, 255, 0, 1.0)":e.labelfill}),s=new CgsStyleFill2D({color:void 0===e.labelBackgroundColor?"rgba(1, 1, 1, 0.8)":e.labelBackgroundColor}),o=!0===e.showLabelBackground,a=[2,7,2,7];"[object Array]"===Object.prototype.toString.call(e.labelBackgroundPadding)&&(a=2===e.labelBackgroundPadding.length?[e.labelBackgroundPadding[1],e.labelBackgroundPadding[0],e.labelBackgroundPadding[1],e.labelBackgroundPadding[0]]:e.labelBackgroundPadding);var n=new CgsStyleText2D({font:void 0===e.labelfont?"24px 微软雅黑":e.labelfont,text:void 0===e.name?"":e.name,rotation:void 0===e.labelrotation?0:e.labelrotation,fill:i,stroke:t,scale:void 0===e.labelscale?1:e.labelscale,offset:void 0===e.labeloffset?[0,-15]:e.labeloffset,backgroundFill:o?s:null,padding:a});return this.labelBackgroundFill=s,n},e.prototype.setGroupName=function(e){this.groupName=e},e.prototype.getGroupName=function(){return this.groupName},e.prototype.setAttribute=function(e){this.attribute=e},e.prototype.getAttribute=function(){return this.attribute},e.prototype.setPopup=function(e){this.isPopup=e},e.prototype.getPopup=function(){return this.isPopup},e.prototype.setVisible=function(e){this.visible!==e&&((this.visible=e)?this.setStyle(this.style):this.setStyle(new i))},e.prototype.getVisible=function(){return this.visible},e.prototype.setName=function(e){this.getStyle().getText().setText(e),this.changed()},e.prototype.getName=function(){return this.getStyle().getText().getText()},e.prototype.setFont=function(e){this.getStyle().getText().setFont(e),this.changed()},e.prototype.getFont=function(){return this.getStyle().getText().getFont()},e.prototype.setLabelOutlineColor=function(e){this.getStyle().getText().getStroke().setColor(e),this.changed()},e.prototype.getLabelOutlineColor=function(){return this.getStyle().getText().getStroke().getColor()},e.prototype.setLabelFillColor=function(e){this.getStyle().getText().getFill().setColor(e),this.changed()},e.prototype.getLabelFillColor=function(){return this.getStyle().getText().getFill().getColor()},e.prototype.setLabelOutlineWidth=function(e){this.getStyle().getText().getStroke().setWidth(e),this.changed()},e.prototype.getLabelOutlineWidth=function(){return this.getStyle().getText().getStroke().getWidth()},e.prototype.setLabelScale=function(e){this.getStyle().getText().setScale(e),this.changed()},e.prototype.getLabelScale=function(){return this.getStyle().getText().getScale()},e.prototype.setLabelOffset=function(e){var t=this.getStyle().getText();t.setOffsetX(e[0]),t.setOffsetY(e[1]),this.changed()},e.prototype.getLabelOffset=function(){var e=[],t=this.getStyle().getText();return e[0]=t.getOffsetX(),e[1]=t.getOffsetY(),e},e.prototype.getLabelBackgroundColor=function(){var e=this.getStyle().getText().getBackgroundFill();return e?e.getColor():e},e.prototype.setLabelBackgroundColor=function(e){var t;this.showLabelBackground&&((t=this.getStyle().getText().getBackgroundFill())?t.setColor(e):(t=new s({color:e}),this.getStyle().getText().setBackgroundFill(t)),this.changed())},e.prototype.getShowLabelBackground=function(){return this.showLabelBackground},e.prototype.setShowLabelBackground=function(e){var t;this.showLabelBackground!==e&&(this.showLabelBackground=e,t=this.getStyle().getText(),e?t.setBackgroundFill(this.labelBackgroundFill):t.setBackgroundFill(new s),this.changed())},e.prototype.getLabelBackgroundPadding=function(){var e=this.getStyle().getText().getPadding();return[e[1],e[0]]},e.prototype.setLabelBackgroundPadding=function(e){var t;"[object Array]"===Object.prototype.toString.call(e)&&(t=[],t=2===e.length?[e[1],e[0],e[1],e[0]]:options.labelBackgroundPadding,this.getStyle().getText().setPadding(t),this.changed())},e.prototype.getZIndex=function(){return this.getStyle().getZIndex()},e.prototype.setZIndex=function(e){this.getStyle().setZIndex(e),this.changed()},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsPoint2D=t()}(window,function(){function e(e){this.coordinate=e.position,this.dragEnable=e.dragEnable||!1,this.projection=void 0===e.projection?"EPSG:102113":e.projection;var t=new a(this.coordinate);t.transform("EPSG:4326",this.projection);var i=e.parentFeature,s=e.attribute;CgsFeature2D.call(this,{geometry:t,parentFeature:i,attribute:s});var o=this.createStyle(e);this.style=o,this.setStyle(o)}var a=ol.geom.Point;return CgsUtil.inherits(e,CgsFeature2D),e.prototype.createStyle=function(e){var t=new CgsStyleStroke2D({color:void 0===e.outlineColor?"rgba(0,153,255,1.0)":e.outlineColor,width:void 0===e.outlineWidth?1:e.outlineWidth,lineDash:e.lineDash||null}),i=new CgsStyleFill2D({color:void 0===e.fillColor?"rgba(255,255,255,0.4)":e.fillColor}),s=void 0===e.pixelSize?5:e.pixelSize,o=new CgsStylePoint2D({fill:i,stroke:t,radius:s}),a=this.createLabelStyle(e),n=e.zIndex;return new CgsStyle2D({image:o,text:a,zIndex:n})},e.prototype.setPosition=function(e){this.coordinate=e;var t=this.getGeometry(),i=ol.proj.transform(e,"EPSG:4326",this.projection);t.setCoordinates(i)},e.prototype.getPosition=function(){return this.coordinate},e.prototype.setDragEnable=function(e){this.dragEnable=e},e.prototype.setPixelSize=function(e){this.getStyle().getImage().setRadius(e),this.changed()},e.prototype.getPixelSize=function(){return this.getStyle().getImage().getRadius()},e.prototype.setFillColor=function(e){var t=this.getStyle().getImage();t.getFill().setColor(e),t.render(),this.changed()},e.prototype.getFillColor=function(){return this.getStyle().getImage().getFill().getColor()},e.prototype.setOutlineColor=function(e){var t=this.getStyle().getImage();t.getStroke().setColor(e),t.render(),this.changed()},e.prototype.getOutlineColor=function(){return this.getStyle().getImage().getStroke().getColor()},e.prototype.setColor=function(e){this.setFillColor(e),this.setOutlineColor(e)},e.prototype.setOutlineWidth=function(e){var t=this.getStyle().getImage();t.getStroke().setWidth(e),t.render(),this.changed()},e.prototype.getOutlineWidth=function(){return this.getStyle().getImage().getStroke().getWidth()},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsLine2D=t()}(window,function(){function e(e){this.projection=void 0===e.projection?"EPSG:102113":e.projection,this.coordinates=[];for(var t=0,i=e.positions.length;t<i;t++)"[object Array]"===Object.prototype.toString.call(e.positions[t])&&this.coordinates.push(e.positions[t].slice(0,2));var s=new ol.geom.LineString(this.coordinates);s.transform("EPSG:4326",this.projection);var o=e.parentFeature,a=e.attribute;CgsFeature2D.call(this,{geometry:s,parentFeature:o,attribute:a});var n=this.createStyle(e);this.style=n,this.setStyle(n)}return CgsUtil.inherits(e,CgsFeature2D),e.prototype.createStyle=function(e){var t=new CgsStyleStroke2D({color:void 0===e.fillColor?"rgba(255, 255, 0, 1.0)":e.fillColor,width:void 0===e.width?1:e.width,lineDash:void 0===e.pixelSize?null:[e.pixelSize]}),i=this.createLabelStyle(e),s=e.zIndex;return new CgsStyle2D({stroke:t,text:i,zIndex:s})},e.prototype.setPosition=function(e){this.coordinates=[];for(var t=0;t<e.length;t++)this.coordinates.push(e[t].slice(0,2));var i=new ol.geom.LineString(this.coordinates);i.transform("EPSG:4326",this.projection),this.setGeometry(i)},e.prototype.getPosition=function(){return this.coordinates},e.prototype.setWidth=function(e){this.getStyle().getStroke().setWidth(e),this.changed()},e.prototype.getWidth=function(){return this.getStyle().getStroke().getWidth()},e.prototype.setDashLine=function(e){this.getStyle().getStroke().setLineDash(e),this.changed()},e.prototype.getDashLine=function(){return this.getStyle().getStroke().getLineDash()},e.prototype.setFillColor=function(e){this.getStyle().getStroke().setColor(e),this.changed()},e.prototype.getFillColor=function(){return this.getStyle().getStroke().getColor()},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsPolygon2D=t()}(window,function(){function e(e){this.projection=void 0===e.projection?"EPSG:102113":e.projection,this.positions=e.positions,"[object Array]"!==Object.prototype.toString.call(e.positions[0][0])&&(this.positions=[this.positions],e.positions=[e.positions]),this.coordinates=[];for(var t=0,i=e.positions.length;t<i;t++)if(4===e.positions[t].length||3===e.positions[t].length){for(var s=[],o=0,a=e.positions[t].length;o<a;o++)s.push(e.positions[t][o]);s.push(e.positions[t][0]),this.coordinates.push(s)}else this.coordinates.push(e.positions[t]);var n=new p(this.coordinates);n.transform("EPSG:4326",this.projection);var r=e.parentFeature,l=e.attribute;CgsFeature2D.call(this,{geometry:n,parentFeature:r,attribute:l});var u=this.createStyle(e);this.style=u,this.setStyle(u)}var p=ol.geom.Polygon;return CgsUtil.inherits(e,CgsFeature2D),e.prototype.createStyle=function(e){this.strokeStyle=new CgsStyleStroke2D({color:void 0===e.outlineColor?"rgba(0,153,255,1.0)":e.outlineColor,width:void 0===e.outlineWidth?1:e.outlineWidth,lineDash:void 0===e.outlineDash?null:e.outlineDash}),this.fillStyle=new CgsStyleFill2D({color:void 0===e.fillColor?"rgba(255,255,255,0.4)":e.fillColor}),this.outline=void 0===e.outline||e.outline,this.fill=void 0===e.fill||e.fill;var t=this.createLabelStyle(e),i=e.zIndex;return new CgsStyle2D({stroke:!1!==e.outline?this.strokeStyle:null,fill:!1!==e.fill?this.fillStyle:null,text:t,zIndex:i})},e.prototype.setPosition=function(e){this.positions=e,this.coordinates=[];for(var t=0,i=e.length;t<i;t++)if(4===e[t].length||3===e[t].length){for(var s=[],o=0,a=e[t].length;o<a;o++)s.push(e[t][o]);s.push(e[t][0]),this.coordinates.push(s)}else this.coordinates.push(e[t]);var n=new ol.geom.Polygon(this.coordinates);n.transform("EPSG:4326",this.projection),this.setGeometry(n)},e.prototype.getPosition=function(){return this.positions},e.prototype.setFill=function(e){var t;this.fill!==e&&(this.fill=e,t=this.getStyle(),this.fill?t.setFill(this.fillStyle):t.setFill(null),this.changed())},e.prototype.getFill=function(){return this.fill},e.prototype.setFillColor=function(e){this.fill&&(this.fillStyle.setColor(e),this.changed())},e.prototype.getFillColor=function(){return this.fillStyle.getColor()},e.prototype.setOutline=function(e){var t;this.outline!==e&&(this.outline=e,t=this.getStyle(),this.outline?t.setStroke(this.strokeStyle):t.setStroke(null),this.changed())},e.prototype.getOutline=function(){return this.outline},e.prototype.setOutlineColor=function(e){this.outline&&(this.strokeStyle.setColor(e),this.changed())},e.prototype.getOutlineColor=function(){return this.strokeStyle.getColor()},e.prototype.setOutlineWidth=function(e){this.outline&&(this.strokeStyle.setWidth(e),this.changed())},e.prototype.getOutlineWidth=function(){return this.strokeStyle.getWidth()},e.prototype.setOutlineDash=function(e){this.outline&&(this.strokeStyle.setLineDash(e),this.changed())},e.prototype.getOutlineDash=function(){return this.strokeStyle.getLineDash()},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsEllipse2D=t()}(window,function(){function e(e){this.projection=void 0===e.projection?"EPSG:102113":e.projection,this.rotation=void 0===e.rotation?0:e.rotation,this.position=e.center||e.position,this.coordinate=ol.proj.transform(this.position,"EPSG:4326",this.projection),this.radiusX=void 0===e.radiusX?3e5:e.radiusX,this.radiusY=void 0===e.radiusY?3e5:e.radiusY,this.radiusXOfInnerUints=this.getRadiusOfInnerUints(this.radiusX),this.radiusYOfInnerUints=this.getRadiusOfInnerUints(this.radiusY);var t=this.getGeometry(),i=e.parentFeature,s=e.attribute;CgsFeature2D.call(this,{geometry:t,parentFeature:i,attribute:s});var o=this.createStyle(e);this.style=o,this.setStyle(o)}return CgsUtil.inherits(e,CgsPolygon2D),e.prototype.getGeometry=function(){for(var e=[],t=0;t<360;t++){var i=this.radiusXOfInnerUints*Math.cos(t/180*Math.PI),s=this.radiusYOfInnerUints*Math.sin(t/180*Math.PI),o=Math.cos(this.rotation/180*Math.PI)*i-Math.sin(this.rotation/180*Math.PI)*s,a=Math.cos(this.rotation/180*Math.PI)*s+Math.sin(this.rotation/180*Math.PI)*i;o+=this.coordinate[0],a+=this.coordinate[1],e.push([o,a])}return new ol.geom.Polygon([e])},e.prototype.setPosition=function(e){this.position=e,this.coordinate=ol.proj.transform(e,"EPSG:4326",this.projection);var t=this.getGeometry();this.setGeometry(t)},e.prototype.getPosition=function(){return this.position},e.prototype.getRadiusOfInnerUints=function(e){var t=CgsUtil.EPSG3857_RADIUS,i=e/t,s=Math.sqrt(2*t*t*(1-Math.cos(i))),o=Math.cos(this.position[1]/180*Math.PI)*t,a=Math.acos((2*o*o-s*s)/(2*o*o)),n=[this.position[0]+a/Math.PI*180,this.position[1]],r=ol.proj.transform(n,"EPSG:4326",this.projection),l=ol.proj.transform(this.position,"EPSG:4326",this.projection);return r[0]-l[0]},e.prototype.setRadiusX=function(e){this.radiusX=e,this.radiusXOfInnerUints=this.getRadiusOfInnerUints(this.radiusX);var t=this.getGeometry();this.setGeometry(t)},e.prototype.getRadiusX=function(){return this.radiusX},e.prototype.setRadiusY=function(e){this.radiusY=e,this.radiusYOfInnerUints=this.getRadiusOfInnerUints(this.radiusY);var t=this.getGeometry();this.setGeometry(t)},e.prototype.getRadiusY=function(){return this.radiusY},e.prototype.setRotation=function(e){this.rotation=e;var t=this.getGeometry();this.setGeometry(t)},e.prototype.getRotation=function(){return this.rotation},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsCircle2D=t()}(window,function(){function e(e){this.position=e.center||e.position,this.projection=void 0===e.projection?"EPSG:102113":e.projection,this.coordinate=ol.proj.transform(this.position,"EPSG:4326",this.projection),this.radius=void 0===e.radius?3e5:e.radius;var t=new a(this.coordinate,this.radius),i=e.parentFeature,s=e.attribute;CgsFeature2D.call(this,{geometry:t,parentFeature:i,attribute:s});var o=this.createStyle(e);this.style=o,this.setStyle(o)}var a=ol.geom.Circle;return CgsUtil.inherits(e,CgsPolygon2D),e.prototype.setPosition=function(e){this.position=e,this.coordinate=ol.proj.transform(e,"EPSG:4326",this.projection),this.getGeometry().setCenter(this.coordinate)},e.prototype.setRadius=function(e){this.radius=e,this.getGeometry().setRadius(e)},e.prototype.getRadius=function(){return this.radius},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsSector2D=t()}(window,function(){function e(e){this.projection=void 0===e.projection?"EPSG:102113":e.projection,this.rotation=void 0===e.rotation?0:e.rotation,this.angle=void 0===e.angle?0:e.angle,this.position=e.center||e.position,this.coordinate=ol.proj.transform(this.position,"EPSG:4326",this.projection),this.radius=void 0===e.radius?3e5:e.radius,this.radiusOfInnerUints=this.getRadiusOfInnerUints(this.radius);var t=this.getGeometry(),i=e.parentFeature,s=e.attribute;CgsFeature2D.call(this,{geometry:t,parentFeature:i,attribute:s});var o=this.createStyle(e);this.style=o,this.setStyle(o)}return CgsUtil.inherits(e,CgsEllipse2D),e.prototype.getGeometry=function(){for(var e=[],t=0;t<=this.angle;t++){var i=this.radiusOfInnerUints*Math.cos(t/180*Math.PI),s=this.radiusOfInnerUints*Math.sin(t/180*Math.PI),o=Math.cos(this.rotation/180*Math.PI)*i-Math.sin(this.rotation/180*Math.PI)*s,a=Math.cos(this.rotation/180*Math.PI)*s+Math.sin(this.rotation/180*Math.PI)*i;o+=this.coordinate[0],a+=this.coordinate[1],e.push([o,a])}return e.push([this.coordinate[0],this.coordinate[1]]),new ol.geom.Polygon([e])},e.prototype.setRadius=function(e){this.radius=e,this.radiusOfInnerUints=this.getRadiusOfInnerUints(this.radius);var t=this.getGeometry();this.setGeometry(t)},e.prototype.getRadius=function(){return this.radius},e.prototype.setAngle=function(e){this.angle=e;var t=this.getGeometry();this.setGeometry(t)},e.prototype.getAngle=function(){return this.angle},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsRect2D=t()}(window,function(){function e(e){var t=Object.assign({},e),i=[];i[0]=e.positions[0],i[1]=[e.positions[1][0],e.positions[0][1]],i[2]=e.positions[1],i[3]=[e.positions[0][0],e.positions[1][1]],i[4]=e.positions[0],t.positions=i,CgsPolygon2D.call(this,t),this.position=e.positions}return CgsUtil.inherits(e,CgsPolygon2D),e.prototype.setPosition=function(e){var t=[];t[0]=e[0],t[1]=[e[1][0],e[0][1]],t[2]=e[1],t[3]=[e[0][0],e[1][1]],t[4]=e[0],CgsPolygon2D.prototype.setPosition.call(this,[t]),this.position=e},e.prototype.getPosition=function(){return this.position},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsMark2D=t()}(window,function(){function e(e){CgsPoint2D.call(this,e)}return CgsUtil.inherits(e,CgsPoint2D),e.prototype.createStyle=function(a){this.positioning=a.positioning;var i=this.getAnchorByPositioning(a.positioning);this.aspect=-a.aspect||0,this.rotation=void 0===a.rotation?0:a.rotation;var s=this.rotation+this.aspect,o=void 0===a.opacity?1:a.opacity,n=void 0===a.scale?1:a.scale,r=a.color,l=a.pixelOffset,u=this.createLabelStyle(a),e=a.zIndex,p=new CgsStyle2D({text:u,zIndex:e});this.imageOptions={style:p,anchor:i,opacity:o,rotation:s,scale:n,color:r,offset:l};var h=this,c=new Image;if(c.src=a.url,this.loadIconPromise=new Promise(function(e){c.onload=e}).then(function(){var e=[c.width,c.height];l&&(i[0]-=l[0]/c.width,i[1]-=l[1]/c.height);var t=new CgsStyleIcon2D({img:c,anchor:i,opacity:o,rotation:s,scale:n,color:r,imgSize:e});p.setImage(t),h.imageStyle=t,h.changed()}),a.scaleByDistance instanceof Array&&4===a.scaleByDistance.length){var g=u.getFont(),d=Number(g.split(" ")[0].replace("px","")),m=g.split(" ")[1];return function(e,t){var i=h.getScaleFromResolution(t,a.scaleByDistance),s=p.getImage();s&&(s!==h.imageStyle&&(s=h.imageStyle,p.setImage(s)),s.setScale(i));var o=Math.floor(d*i);return g=o+"px "+m,u.setFont(g),p}}return p},e.prototype.setColor=function(t){var i=this;this.loadIconPromise.then(function(){var e=ol.color.asString(t);i.imageStyle.color_=e,i.imageStyle=i.imageStyle.clone(),"function"!=typeof i.style&&i.style.setImage(i.imageStyle),i.changed()})},e.prototype.getScaleFromResolution=function(e,t){var i=_slicedToArray(t,4),s=i[0],o=i[1],a=i[2],n=i[3],r=e*CGS_DOTS_PER_INCH*CGS_INCHES_PER_METER*CGS_HEIGHT_TO_SCALE;return r<=s?o:a<=r?n:(n-o)/(a-s)*(r-s)+o},e.prototype.setPositioning=function(o){var a=this;this.positioning!==o&&this.loadIconPromise.then(function(){var e=a.imageStyle.getSize(),t=a.getAnchorByPositioning(a.positioning),i=a.getAnchorByPositioning(o),s=a.imageStyle.getAnchor();s[0]=s[0]/e[0]+(i[0]-t[0]),s[1]=s[1]/e[1]+(i[1]-t[1]),a.imageStyle.setAnchor(s),a.positioning=o,a.changed()})},e.prototype.getAnchorByPositioning=function(e){var t=[];switch(e){case"top-left":t=[0,0];break;case"top-center":t=[.5,0];break;case"top-right":t=[1,0];break;case"center-left":t=[0,.5];break;case"center-center":t=[.5,.5];break;case"center-right":t=[1,.5];break;case"bottom-left":t=[0,1];break;case"bottom-center":t=[.5,1];break;case"bottom-right":t=[1,1];break;default:t=[.5,.5]}return t},e.prototype.setIconScale=function(e){var t=this;this.loadIconPromise.then(function(){t.imageStyle.setScale(e),t.changed()})},e.prototype.getIconScale=function(){return this.imageStyle&&this.imageStyle.getScale()},e.prototype.setPixelOffset=function(i){var s=this;this.loadIconPromise.then(function(){var e=s.imageStyle.getSize(),t=s.getAnchorByPositioning(s.positioning);t[0]-=i[0]/e[0],t[1]-=i[1]/e[1],s.imageStyle.setAnchor(t),s.changed()})},e.prototype.getPixelOffset=function(){return this.imageStyle&&this.imageStyle.normalizedAnchor_},e.prototype.setRotation=function(e){var t=this;this.loadIconPromise.then(function(){e=-((t.rotation=e)+t.aspect)/180*Math.PI,t.imageStyle.setRotation(e),t.changed()})},e.prototype.getRotation=function(){return this.rotation},e.prototype.setUrl=function(e,t){var c=this,g=new Image;g.src=options.url,this.loadIconPromise=new Promise(function(e){g.onload=e}).then(function(){var e,t,i=c.imageOptions,s=i.style,o=i.offset,a=c.imageOptions,n=a.anchor,r=a.opacity,l=a.rotation,u=a.scale,p=a.color;c.imageStyle?(r=(e=c.imageStyle).getOpacity(),l=e.getRotation(),u=e.getScale(),p=e.getColor(),t=e.getSize(),(n=e.getAnchor())[0]/=t[0],n[1]/=t[1]):o&&(n[0]-=o[0]/g.width,n[1]-=o[1]/g.height);var h=new CgsStyleIcon2D({img:g,anchor:n,opacity:r,rotation:l,scale:u,color:p,imgSize:imgSize});s.setImage(h),c.imageStyle=h,c.changed()})},e.prototype.getUrl=function(){return this.imageStyle&&this.imageStyle.getSrc()},e.prototype.setIconOpacity=function(e){var t=this;this.loadIconPromise.then(function(){t.imageStyle.setOpacity(e),t.changed()})},e.prototype.getIconOpacity=function(){return this.imageStyle&&this.imageStyle.getOpacity()},e.prototype.setRotationByVector=function(e){var t=e[0];this.setRotation(270-t)},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsLabel2D=t()}(window,function(){return CgsLabel2D=function(e){CgsPoint2D.call(this,e)},CgsUtil.inherits(CgsLabel2D,CgsPoint2D),CgsLabel2D.prototype.createStyle=function(e){var t=this.createLabelStyle(e),i=e.zIndex;return new CgsStyle2D({text:t,zIndex:i})},CgsLabel2D.prototype.setLabelOffset=function(e){this.style.text_.offsetX_=e[0],this.style.text_.offsetY_=e[1],this.style.setText(this.style.text_.clone()),this.changed(),this.values_.labeloffset&&(this.values_.labeloffset=e)},CgsLabel2D}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsOverlay2D=t()}(window,function(){return CgsOverlay2D=function(e){var i=this;this.parentOverlay=e.parentOverlay,this.position=e.position,this.positioning=e.positioning,this.element=e.element,this.draggable=e.draggable,this.showLine=e.showLine,this.isRoundCorner=!!e.isRoundCorner&&e.isRoundCorner,this.roundCornerSize=e.roundCornerSize?e.roundCornerSize:0,this.lineStyle={},this.brokenLine=e.brokenLine,this.brokenLineOffset=e.brokenLineOffset?e.brokenLineOffset:[0,0],e.lineStyle||(e.lineStyle={}),this.lineStyle.color=e.lineStyle.color?e.lineStyle.color:"rgba(255,255,255,0.9)",this.lineStyle.width=e.lineStyle.width?e.lineStyle.width:1,this.lineStyle.dasharray=e.lineStyle.dasharray?e.lineStyle.dasharray:[],this.lineStyle.dashoffset=e.lineStyle.dashoffset?e.lineStyle.dashoffset:0,this.position=ol.proj.transform(this.position,"EPSG:4326","EPSG:102113"),this.keepInContainer=e.keepInContainer||!1;var t={position:this.position,positioning:this.positioning,element:this.element,stopEvent:!0,offset:e.offset};ol.Overlay.call(this,t),t.stopEvent||(this.element.style.pointerEvents="none");var l;this.on("change:map",function(){var e,t=i.getMap();t&&(e=t.target,0===$$("#"+e).find(".overlaySVG").length&&$$("#"+e).append($$('<svg version ="1.2" xmlns="http://www.w3.org/2000/svg" class="overlaySVG" width="100%" height="100%" style="position:absolute; top:0px; left:0px; pointer-events:none; z-index:100;"></svg>')))}),this.draggable&&(window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$,this.element.onmouseup=function(){},l=this,$$(this.element).mousedown(function(e){var a=e.pageX,n=e.pageY,r=l.getOffset();$$(document).mousemove(function(e){var t=e.pageX-a,i=e.pageY-n,s=r[0]+t,o=r[1]+i;l.setOffset([s,o]),l.updateLine()}),$$(document).mouseup(function(e){$$(document).off("mousemove")})}))},CgsInherits(CgsOverlay2D,ol.Overlay),CgsOverlay2D.prototype.setPos=function(e){this.setPosition(ol.proj.transform(e,"EPSG:4326","EPSG:102113"))},CgsOverlay2D.prototype.render=function(){this.updatePixelPosition(),this.updateLine()},CgsOverlay2D.prototype.setVisible=function(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e,this.updateLine())},CgsOverlay2D.prototype.getVisible=function(){return this.rendered.visible},CgsOverlay2D.prototype.setLineVisible=function(e){this.showLine!==e&&(this.showLine=e,this.updateLine())},CgsOverlay2D.prototype.getLineVisible=function(){return this.showLine},CgsOverlay2D.prototype.setPointerEvents=function(e){var t,i;e!=this.stopEvent_&&(this.stopEvent_=e,this.stopEvent_?this.element.style.pointerEvents="all":this.element.style.pointerEvents="none",t=this.getMap().getOverlayContainerStopEvent(),i=this.getMap().getOverlayContainer(),this.stopEvent_?(i.removeChild(this.element),this.insertFirst_?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element)):(t.removeChild(this.element),this.insertFirst_?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element)))},CgsOverlay2D.prototype.getPointerEvents=function(e){return this.stopEvent_},CgsOverlay2D.prototype.updateLine=function(){if(!this.showLine||!this.rendered.visible)return this.line&&(this.line.remove(),this.line=null),void(this.lineB&&(this.lineB.remove(),this.lineB=null));this.lineAttr={},this.lineAttr.color=this.lineStyle.color,this.lineAttr.width=this.lineStyle.width.toString(),this.lineAttr.dashoffset=this.lineStyle.dashoffset.toString(),this.lineAttr.dasharray="";for(var e=0;e<this.lineStyle.dasharray.length;e++)this.lineAttr.dasharray+=this.lineStyle.dasharray[e],this.lineAttr.dasharray+=" ";if(this.getMap()&&(this.svg=$$("#"+this.getMap().target).find(".overlaySVG"),this.line||0===this.svg.length||(this.brokenLine?(this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.svg.append(this.line),this.lineB=document.createElementNS("http://www.w3.org/2000/svg","line"),this.svg.append(this.lineB)):(this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.svg.append(this.line))),this.line)){var t=this.getOffset();if(t[0]===t[1]===0)return;var i,s,o=this.getMap().getPixelFromLonLat(ol.proj.transform(this.getPosition(),"EPSG:102113","EPSG:4326")),a=this.element.scrollWidth,n=this.element.scrollHeight,r=t[0],l=t[1],u=Math.round(a/2),p=Math.round(n/2),h=0,c=0;if(Math.abs(r+u)<Math.abs(r)&&(h=u),Math.abs(r+a)<Math.abs(r+u)&&(h=a),l<-p&&(c=n),r+=h,l+=c,this.isRoundCorner){divCorner=[],divCorner.push({x:parseFloat(x)+a,y:parseFloat(y)}),divCorner.push({x:parseFloat(x)+a,y:parseFloat(y)+n}),divCorner.push({x:parseFloat(x),y:parseFloat(y)}),divCorner.push({x:parseFloat(x),y:parseFloat(y)+n});for(var g=0;g<divCorner.length;g++)o[0]+r===divCorner[g].x&&o[1]+l===divCorner[g].y&&(0===g?(r-=this.roundCornerSize,l+=this.roundCornerSize):1===g?(r-=this.roundCornerSize,l-=this.roundCornerSize):2===g?(r+=this.roundCornerSize,l+=this.roundCornerSize):3===g&&(r+=this.roundCornerSize,l-=this.roundCornerSize))}this.brokenLine?(s=i=0,this.brokenLineOffset&&(0<l&&0<r?(i=this.brokenLineOffset[0],s=-this.brokenLineOffset[1]):0<l&&r<0?(i=-this.brokenLineOffset[0],s=-this.brokenLineOffset[1]):l<0&&r<0?(i=-this.brokenLineOffset[0],s=this.brokenLineOffset[1]):l<0&&0<r&&(i=this.brokenLineOffset[0],s=this.brokenLineOffset[1])),this.line.setAttribute("x1",Math.round(o[0]).toString()),this.line.setAttribute("y1",Math.round(o[1]).toString()),this.line.setAttribute("x2",Math.round(o[0]+i).toString()),this.line.setAttribute("y2",Math.round(o[1]+l+s).toString()),this.line.setAttribute("stroke-width",this.lineAttr.width),this.line.setAttribute("stroke-dasharray",this.lineAttr.dasharray),this.line.setAttribute("stroke",this.lineAttr.color),this.line.setAttribute("stroke-dashoffset",this.lineAttr.dashoffset),this.lineB.setAttribute("x1",Math.round(o[0]+i).toString()),this.lineB.setAttribute("y1",Math.round(o[1]+l+s).toString()),this.lineB.setAttribute("x2",Math.round(o[0]+r).toString()),this.lineB.setAttribute("y2",Math.round(o[1]+l).toString()),this.lineB.setAttribute("stroke-width",this.lineAttr.width),this.lineB.setAttribute("stroke-dasharray",this.lineAttr.dasharray),this.lineB.setAttribute("stroke",this.lineAttr.color),this.lineB.setAttribute("stroke-dashoffset",this.lineAttr.dashoffset)):(this.line.setAttribute("x1",Math.round(o[0]).toString()),this.line.setAttribute("y1",Math.round(o[1]).toString()),this.line.setAttribute("x2",Math.round(o[0]+r).toString()),this.line.setAttribute("y2",Math.round(o[1]+l).toString()),this.line.setAttribute("stroke-width",this.lineAttr.width),this.line.setAttribute("stroke-dasharray",this.lineAttr.dasharray),this.line.setAttribute("stroke",this.lineAttr.color),this.line.setAttribute("stroke-dashoffset",this.lineAttr.dashoffset))}},CgsOverlay2D.prototype.remove=function(){this.line&&($$(this.line).remove(),this.line=null),this.lineB&&($$(this.lineB).remove(),this.lineB=null)},CgsOverlay2D.prototype.setLineStyle=function(e){this.lineStyle||(this.lineStyle={}),null!=e.color&&(this.lineStyle.color=e.color),null!=e.width&&(this.lineStyle.width=e.width),null!=e.dasharray&&(this.lineStyle.dasharray=e.dasharray),null!=e.dashoffset&&(this.lineStyle.dashoffset=e.dashoffset)},CgsOverlay2D.prototype.getLineStyle=function(){return this.lineStyle},CgsOverlay2D}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsDrawFeatureByMouse2D=t()}(window,function(){function e(e){this.drawFeatureControl={},this.map=e.mapObject.map2D;var t=e.type;this.type=e.type,this.assistantCoordinateShow=!!e.assistantCoordinateShow&&e.assistantCoordinateShow;var i=e.style,s=null;switch(t){case"POINT":t="Point";break;case"LINE":t="LineString";break;case"POLYGON":t="Polygon";break;case"RECT":t="Circle",s=function(e,t){var i=e[0],s=[e[1][0],e[0][1]],o=e[1],a=[e[0][0],e[1][1]],n=t||new r([[i,s,o,a,i]]);return n.setCoordinates([[i,s,o,a,i]]),n};break;case"CIRCLE":t="Circle";break;case"MARK":t="Point";break;case"ANGLE":t="LineString"}e.assistantCoordinateShow?this.assistantCoordinateShow=!0:this.assistantCoordinateShow=!1,a.call(this,{source:new o,type:t,stopClick:!1,geometryFunction:s,style:i})}var h=ol.geom.Point,r=ol.geom.Polygon,c=ol.Feature,o=ol.source.Vector,a=ol.interaction.Draw,g=ol.style.Fill,d=ol.style.Circle,m=ol.style.Text,f=ol.style.Stroke,C=ol.style.Style;return CgsUtil.inherits(e,a),e.prototype.activate=function(){var t=this,e=this.map;e.addInteraction(this),this.pointerMoveListener=e.on("pointermove",function(e){t.sketchFeature&&(CgsSubPub.publish("featuredrawmove2d",[e.coordinate,t.sketchFeature]),t.assistantCoordinateShow&&t.showAssistantInfo(e))}),this.clickListener=e.on("singleclick",function(e){t.assistantCoordinateShow&&t.addAssistantPoint(e)}),this.on("drawstart",function(e){CgsSubPub.publish("featuredrawstart2d",[e.feature,t]),t.sketchFeature=e.feature}),this.on("drawend",function(e){t.removeAssistantPoints(),CgsSubPub.publish("featuredrawend2d",[e.feature,t]),t.sketchFeature=null})},e.prototype.deactivate=function(){this.map.removeInteraction(this),this.pointerMoveListener&&(this.map.un(this.pointerMoveListener.type,this.pointerMoveListener.listener),this.map.un(this.clickListener.type,this.clickListener.listener))},e.prototype.showAssistantInfo=function(e){var t,i,s,o,a,n,r=this.map.vectorLayerSource,l=e.coordinate,u=ol.proj.transform(l,"EPSG:102113","EPSG:4326"),p=u[0].toFixed(2)+", "+u[1].toFixed(2);"CIRCLE"===this.type&&(t=this.sketchFeature.getGeometry().getCenter(),p=(ol.sphere.getDistance(t,l)/1e3).toFixed(2)+" km"),this.tempMovePoint?(this.tempMovePoint.getStyle().getText().setText(p),this.tempMovePoint.getGeometry().setCoordinates(l)):(this.tempMovePoint=new c({geometry:new h(l)}),i=new g({color:"rgba(0,153,225,1)"}),s=new f({color:"rgba(0,153,225,1)",width:2}),o=new d({fill:i,radius:2,stroke:s}),a=new m({text:p,font:"15px 微软雅黑",fill:new g({color:"rgba(255, 255, 0, 1)"})}),n=new C({image:o,text:a}),this.tempMovePoint.setStyle(n),r.addFeature(this.tempMovePoint))},e.prototype.addAssistantPoint=function(e){var t=this.map.vectorLayerSource,i=e.coordinate,s=ol.proj.transform(i,"EPSG:102113","EPSG:4326"),o=s[0].toFixed(2)+", "+s[1].toFixed(2),a=new c({geometry:new h(i)}),n=new g({color:"rgba(0,153,225,1)"}),r=new f({color:"rgba(0,153,225,1)",width:2}),l=new d({fill:n,radius:2,stroke:r}),u=new m({text:o,font:"15px 微软雅黑",fill:new g({color:"rgba(255, 255, 0, 1)"})}),p=new C({image:l,text:u});a.setStyle(p),t.addFeature(a),this.tempAssistantPoints?this.tempAssistantPoints.push(a):this.tempAssistantPoints=[a]},e.prototype.removeAssistantPoints=function(){var e=this.map.vectorLayerSource;if(this.tempAssistantPoints)for(var t=0,i=this.tempAssistantPoints.length;t<i;t++){var s=this.tempAssistantPoints[t];e.removeFeature(s)}this.tempMovePoint&&e.removeFeature(this.tempMovePoint)},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsSelect2D=t()}(window,function(){function e(t){this.map=t.mapObject,this.draggable=t.draggable;var e=void 0===t.multi||t.multi,i=void 0!==t.wrapX&&t.wrapX,s=t.layers,o=t.hitTolerance,a=void 0===t.wrapX?null:t.wrapX;this.hitTolerance=o,this.selectPointerMove=new n({condition:l.pointerMove,multi:e,layers:s,style:a,wrapX:i,hitTolerance:o}),this.selectPointerMove.on("select",function(e){0!==e.selected.length&&"function"==typeof t.hoverCall&&t.hoverCall(e.selected,e.mapBrowserEvent.pixel),0!==e.deselected.length&&"function"==typeof t.leaveCall&&t.leaveCall(e.deselected,e.mapBrowserEvent.pixel)}),this.clickCall=t.clickCall,this.clickOutCall=t.clickOutCall,this.doubleclickCall=t.doubleclickCall,this.doubleclickOutCall=t.doubleclickOutCall,this.draggable&&(this.translate=new r({features:features,style:a}),this.map.addInteraction(this.translate))}var n=ol.interaction.Select,r=ol.interaction.Translate,l=ol.events.condition,t=ol.MapBrowserEventType;return e.prototype.activate=function(){var s=this;this.map.interactions.getArray().indexOf(this.selectPointerMove)<0&&(this.map.addInteraction(this.selectPointerMove),this.mapClickListener=this.map.on(t.SINGLECLICK,function(e){var t=e.pixel,i=s.map.forEachFeatureAtPixel(t,function(e){return e});i?"function"==typeof s.clickCall&&s.clickCall([i],t):"function"==typeof s.clickOutCall&&s.clickOutCall([],t)}),this.mapDoubleClickListener=this.map.on(t.DBLCLICK,function(e){var t=e.pixel,i=s.map.forEachFeatureAtPixel(t,function(e){return e});i?"function"==typeof s.doubleclickCall&&s.doubleclickCall([i],t):"function"==typeof s.doubleclickOutCall&&s.doubleclickOutCall([],t)}))},e.prototype.deactivate=function(){this.map.removeInteraction(this.selectPointerMove),this.mapClickListener&&(this.map.un(this.mapClickListener.type,this.mapClickListener.listener),this.map.un(this.mapDoubleClickListener.type,this.mapDoubleClickListener.listener)),this.draggable&&this.map.removeInteraction(this.translate)},e.prototype.setDraggable=function(e){this.translate&&this.map.removeInteraction(this.translate),this.draggable=e,this.draggable&&(this.translate=r({style:null}),this.map.addInteraction(this.translate))},e.prototype.getDraggable=function(){return this.draggable},e.prototype.setHitTolerance=function(e){this.hitTolerance=e,this.selectPointerMove.setHitTolerance(e)},e.prototype.getHitTolerance=function(){return this.hitTolerance},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsDrawMarkByMouse2D=t()}(window,function(){function e(e){this.iconStyle=e.iconStyle,this.textStyle=e.textStyle,this.mapObj=e.mapObject,this.drawMarkVL=new CgsGroupVector2D({groupName:"DrawMarkByMouse"});var t={image:this.iconStyle,stroke:null,fill:null,text:this.textStyle};this.drawMarkVL.setStyle(new CgsStyle2D(t)),this.drawMarkControl=new CgsInteractionDraw2D({source:this.drawMarkVL.getSource(),type:"Point",style:new CgsStyle2D(t)}),this.mapObj.addLayer(this.drawMarkVL)}return e.prototype.activate=function(){this.mapObj.addInteraction(this.drawMarkControl)},e.prototype.deactivate=function(){this.mapObj.removeInteraction(this.drawMarkControl)},e.prototype.on=function(e,t){this.drawMarkControl.on(e,t)},e}),CgsMeasure2D=function(e){e.mapObject=e.viewer,this.mapObj=e.mapObject.map2D,this.type=e.type,this.measureTooltip=null;var t,i;this.vector=new CgsGroupVector2D({groupName:"MeasureLayer"}),this.vector.setStyle(new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})),this.measureTooltipElement=null,this.draw=new ol.interaction.Draw({source:this.vector.getSource(),type:this.type,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(240, 240, 240, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 255, 0, 0.5)",width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 255, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 0, 255, 0.2)"})})})}),this.mapObj.addGroupVector(this.vector),this.createMeasureTooltip(),this.draw.on("drawstart",function(e){var s=this;i=e.feature;var o=e.coordinate;t=i.getGeometry().on("change",function(e){var t,i=e.target;i instanceof ol.geom.Polygon?(t=s.formatArea(i),o=i.getInteriorPoint().getCoordinates()):i instanceof ol.geom.LineString&&(t=s.formatLine(i),o=i.getLastCoordinate()),s.measureTooltipElement.innerHTML=t,s.measureTooltip.setPosition(o)})},this),this.draw.on("drawend",function(){this.measureTooltipElement.className="tooltip tooltip-static",this.measureTooltip.setOffset([0,-7]),i=null,ol.Observable.unByKey(t)},this)},CgsMeasure2D.prototype.activate=function(){this.mapObj.addInteraction(this.draw)},CgsMeasure2D.prototype.deactivate=function(){this.mapObj.removeInteraction(this.draw)},CgsMeasure2D.prototype.formatArea=function(e){var t=new ol.Sphere(6378137),i=this.mapObj.getView().getProjection(),s=e.clone().transform(i,"EPSG:4326").getLinearRing(0).getCoordinates(),o=Math.abs(t.geodesicArea(s)),a=1e4<o?Math.round(o/1e6*100)/100+" km<sup>2</sup>":Math.round(100*o)/100+" m<sup>2</sup>";return a},CgsMeasure2D.prototype.formatLine=function(e){for(var t=new ol.Sphere(6378137),i=e.getCoordinates(),s=0,o=this.mapObj.getView().getProjection(),a=0,n=i.length-1;a<n;++a){var r=ol.proj.transform(i[a],o,"EPSG:4326"),l=ol.proj.transform(i[a+1],o,"EPSG:4326");s+=t.haversineDistance(r,l)}return 100<s?Math.round(s/1e3*100)/100+" km":Math.round(100*s)/100+" m"},CgsMeasure2D.prototype.on=function(e,t){this.draw.on(e,t)},CgsMeasure2D.prototype.removeResult=function(){var e=this.mapObj.getGroupsByName("MeasureLayer");for(i in e)this.mapObj.removeLayer(e[i]);this.mapObj.removeOverlay(this.measureTooltip)},CgsMeasure2D.prototype.createMeasureTooltip=function(){this.measureTooltipElement&&this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.className="tooltip tooltip-measure",this.measureTooltipElement.style.pointerEvents="none",this.measureTooltip=new ol.Overlay({element:this.measureTooltipElement,offset:[0,-10],positioning:"bottom-center",stopEvent:!1}),this.mapObj.addOverlay(this.measureTooltip)},CgsGeoJSON2D=function(e){var t={defaultDataProjection:e};ol.format.GeoJSON.call(this,t)},CgsInherits(CgsGeoJSON2D,ol.format.GeoJSON),CgsGeoJSON2D.prototype.readFeatureFromObject=function(e,t){var i=e;goog.DEBUG&&console.assert("Feature"==i.type,"geoJSONFeature.type should be Feature");var s,o=CgsGeoJSON2D.readGeometry_(i.geometry,t),a=new CgsFeature2D;return this.geometryName_&&a.setGeometryName(this.geometryName_),a.setGeometry(o),void 0!==i.id&&a.setId(i.id),void 0!==i.style&&(s=CgsGeoJSON2D.prototype.readStyleFromObject(i.style),a.setStyle(s)),void 0!==i.groupName&&a.setGroupName(i.groupName),i.properties&&a.setProperties(i.properties),a},CgsGeoJSON2D.prototype.readFeaturesFromObject=function(e,t){var i=this.getObject_(e),s=null;if("Feature"==i.type)s=[this.readFeatureFromObject(i,t)];else if("FeatureCollection"==i.type)for(var s=[],o=i.features,a=0,n=o.length;a<n;++a)console.info(a+""+n),s.push(this.readFeatureFromObject(o[a],t));else ol.asserts.assert(!1,35);return s},CgsGeoJSON2D.prototype.readStyleFromObject=function(e){if(null==e)return null;var t=e.fill,i=t?this.readFillObject(t):null,s=e.text,o=s?this.readTextObject(s):null,a=e.image,n=a?this.readImageObject(a):null,r=e.stroke,l=r?this.readStrokeObject(r):null;return new CgsStyle2D({image:n,stroke:l,fill:i,text:o})},CgsGeoJSON2D.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);var i={type:"Feature"},s=e.getId();void 0!==s&&(i.id=s);var o=e.getGeometry();i.geometry=o?CgsGeoJSON2D.writeGeometry_(o,t):null;var a=e.getProperties(),n=e.style_;i.style=n?this.writeStyleObject(n):null;var r=e.groupName;return group?i.groupName=r:i.groupName=null,delete a[e.getGeometryName()],ol.obj.isEmpty(a)?i.properties=null:i.properties=a,i},CgsGeoJSON2D.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);for(var i=[],s=0,o=e.length;s<o;++s)i.push(this.writeFeatureObject(e[s],t));return JSON.stringify({type:"FeatureCollection",features:i})},CgsGeoJSON2D.prototype.writeStyleObject=function(e){if(null==e)return null;var t={type:"style"};"function"==typeof e&&(e=e()[0]);var i=e.fill_;t.fill=i?this.writeFillObject(i):null;var s=e.text_;t.text=s?this.writeTextObject(s):null;var o=e.image_;t.image=o?this.writeImageObject(o):null;var a=e.stroke_;return t.stroke=a?this.writeStrokeObject(a):null,t},CgsGeoJSON2D.prototype.writeFillObject=function(e){var t={type:"style"},i=e.color_;return i?t.color=i:t.fill=null,t},CgsGeoJSON2D.prototype.writeTextObject=function(e){var t={type:"style"},i=e.font_;t.font=i||null;var s=e.text_;t.text=s||null;var o=e.rotation_;t.rotation=o?180*o/Math.PI:null;var a=e.fill_;t.fill=a?this.writeFillObject(a):null;var n=e.stroke_;t.stroke=n?this.writeStrokeObject(n):null;var r=e.offsetX_;t.offsetX=r||null;var l=e.offsetY_;return t.offsetY=l||null,t},CgsGeoJSON2D.prototype.writeStrokeObject=function(e){var t={type:"style"},i=e.color_;t.color=i||null;var s=e.width_;t.width=s||null;var o=e.lineDash_;return t.lineDash=o||null,t},CgsGeoJSON2D.prototype.writeImageObject=function(e){var t,i,s,o,a,n,r,l,u=null;return e instanceof CgsStylePoint2D||e instanceof ol.style.Circle?(u={type:"point"},t=e.radius_,u.radius=t||null,i=e.stroke_,u.stroke=i?this.writeStrokeObject(i):null,s=e.fill_,u.fill=s?this.writeStrokeObject(s):null):(e instanceof CgsStyleIcon2D||e instanceof ol.style.Icon)&&(u={type:"icon"},o=e.anchor_,u.anchor=o||null,a=e.opacity_,u.opacity=a||null,n=e.rotation_,u.rotation=n?180*n/Math.PI:null,r=e.scale_,u.scale=r||null,l=e.iconImage_.src_,u.src=l||null),u},CgsGeoJSON2D.prototype.readFillObject=function(e){var t=e.color;return new CgsStyleFill({color:t})},CgsGeoJSON2D.prototype.readTextObject=function(e){var t=e.font,i=e.text,s=e.rotation,o=e.fill?this.readFillObject(e.fill):null,a=e.stroke?this.readStrokeObject(e.stroke):null,n=e.offsetX,r=e.offsetY;return new CgsStyleText({text:i,font:t,rotation:s,fill:o,stroke:a,offset:[n,r]})},CgsGeoJSON2D.prototype.readStrokeObject=function(e){var t=e.color,i=e.width,s=e.lineDash;return new CgsStyleStroke({color:t,width:i,lineDash:s})},CgsGeoJSON2D.prototype.readImageObject=function(e){var t,i,s=null;return"point"==e.type?(t=e.stroke?this.readStrokeObject(e.stroke):null,i={fill:e.fill?this.readStrokeObject(e.fill):null,radius:e.radius,stroke:t},s=new CgsStylePoint(i)):"icon"==e.type&&(i={src:e.src,anchor:e.anchor,opacity:e.opacity,rotation:e.rotation,scale:e.scale},s=new CgsStyleIcon(i)),s},CgsGeoJSON2D.readGeometry_=function(e,t){if(!e)return null;var i=CgsGeoJSON2D.GEOMETRY_READERS_[e.type];return ol.format.Feature.transformWithOptions(i(e),!1,t)},CgsGeoJSON2D.readCircleGeometry_=function(e){goog.DEBUG&&console.assert("Circle"==e.type,"object.type should be Circle");var t=[e.coordinates[0],e.coordinates[1]],i=e.coordinates[2]-e.coordinates[0];return new ol.geom.Circle(t,i)},CgsGeoJSON2D.writeGeometry_=function(e,t){return(0,CgsGeoJSON2D.GEOMETRY_WRITERS_[e.getType()])(ol.format.Feature.transformWithOptions(e,!0,t),t)},CgsGeoJSON2D.writeCircleGeometry_=function(e,t){return{type:"Circle",coordinates:e.getFlatCoordinates()}},CgsGeoJSON2D.GEOMETRY_READERS_={Point:ol.format.GeoJSON.readPointGeometry_,LineString:ol.format.GeoJSON.readLineStringGeometry_,Polygon:ol.format.GeoJSON.readPolygonGeometry_,MultiPoint:ol.format.GeoJSON.readMultiPointGeometry_,MultiLineString:ol.format.GeoJSON.readMultiLineStringGeometry_,MultiPolygon:ol.format.GeoJSON.readMultiPolygonGeometry_,GeometryCollection:ol.format.GeoJSON.readGeometryCollectionGeometry_,Circle:CgsGeoJSON2D.readCircleGeometry_},CgsGeoJSON2D.GEOMETRY_WRITERS_={Point:ol.format.GeoJSON.writePointGeometry_,LineString:ol.format.GeoJSON.writeLineStringGeometry_,Polygon:ol.format.GeoJSON.writePolygonGeometry_,MultiPoint:ol.format.GeoJSON.writeMultiPointGeometry_,MultiLineString:ol.format.GeoJSON.writeMultiLineStringGeometry_,MultiPolygon:ol.format.GeoJSON.writeMultiPolygonGeometry_,GeometryCollection:ol.format.GeoJSON.writeGeometryCollectionGeometry_,Circle:CgsGeoJSON2D.writeCircleGeometry_},CgsAirLine2D=function(e){this.points=null,this.interval=null,this.arrPickPoints=[],this.map=e.mapObject,this.path=null,this.passPath=null,this.mark=e.mark,this.totalTime=e.totalTime,this.completeCallback=e.completeCallback,this.durationCallback=e.durationCallback,this.deltaTime=1,this.deltaInterval=1,this.multipy=16,this.state=CgsAirLine.STATE_START,this.finishFlag=!1,this.optPassLine=e.optPassLine||{},this.optAllLine=e.optAllLine||{},null==this.optAllLine.isDashLine&&(this.optAllLine.isDashLine=!0),this.optAllLine.lineType===CgsLine3D.LINT_DASHED||this.optAllLine.isDashLine?this.isDashLine=!0:this.isDashLine=!1},CgsAirLine2D.prototype.setPoints=function(e){this.points=e},CgsAirLine2D.prototype.showPath=function(){this.path?this.path.feature2D.setVisible(!0):this.points&&1<this.points.length&&null==this.path&&(this.isDashLine?this.path=new CgsDashLine({positions:this.points,width:this.optAllLine.width||2,fillColor:this.optAllLine.fillColor||"rgba(255, 255, 0, 0.8)",oddColor:this.optAllLine.oddColor||"rgba(255, 255, 0, 0)",pixelSize:this.optAllLine.pixelSize||16}):this.path=new CgsLine({positions:this.points,width:this.optAllLine.width||2,fillColor:this.optAllLine.fillColor||"rgba(255,255,0,1.0)",lineType:this.optAllLine.lineType||0}),this.map.map2D.vectorLayerSource.addFeature_(this.path.feature2D))},CgsAirLine2D.prototype.hidePath=function(){this.path&&this.path.feature2D.setVisible(!1)},CgsAirLine2D.prototype.showPassPath=function(){var e;this.passPath?this.passPath.feature2D.setVisible(!0):null!=this.points&&1<this.points.length&&null==this.passPath&&(0!=(e=this.points.slice(0,Math.floor(this.count/this.arrPickPoints.length*(this.points.length-1)))).length&&1!=e.length||(e=[this.points[0],this.points[0]]),this.passPath=new CgsLine({positions:e,width:this.optPassLine.width||2,fillColor:this.optPassLine.fillColor||"rgba(255,255,0,1.0)",lineType:this.optPassLine.lineType||0}),this.map.map2D.vectorLayerSource.addFeature_(this.passPath.feature2D))},CgsAirLine2D.prototype.hidePassPath=function(){this.passPath&&this.passPath.feature2D.setVisible(!1)},CgsAirLine2D.prototype.setPassedRate=function(e){1<=e?e=1:e<=0&&(e=0),this.finishFlag&&this.restart(),this.count=Math.floor(e*(this.arrPickPoints.length-1))},CgsAirLine2D.prototype.getPassedRate=function(){return this.count/this.arrPickPoints.length},CgsAirLine2D.prototype.start=function(e){var s=this,t=0,i=[];if(this.points&&this.points[0]&&(2==this.points[0].length||3==this.points[0].length)){for(var o=0;o<this.points.length-1;o++){var a=Math.sqrt((this.points[o+1][0]-this.points[o][0])*(this.points[o+1][0]-this.points[o][0])+(this.points[o+1][1]-this.points[o][0])*(this.points[o+1][1]-this.points[o][0]));i.push(a),t+=a}for(var n=[],o=0;o<this.points.length-1;o++){var r=Math.asin((this.points[o+1][1]-this.points[o][1])/Math.sqrt((this.points[o][0]-this.points[o+1][0])*(this.points[o][0]-this.points[o+1][0])+(this.points[o][1]-this.points[o+1][1])*(this.points[o][1]-this.points[o+1][1])));this.points[o+1][0]-this.points[o][0]<0&&(r=-r+Math.PI),r=Cesium.Math.toDegrees(r),n.push(-r)}for(var l=this.totalTime/50,u=[],o=0;o<i.length;o++){var p=i[o]/t*l;0==o?u.push(p):u.push(p+u[o-1])}for(var h=0,o=0;o<l;o++)if(o<u[h]){for(var c=[],g=0;g<2;g++)c[g]=0<h?(this.points[h+1][g]-this.points[h][g])*(o-u[h-1])/(u[h]-u[h-1])+this.points[h][g]:(this.points[h+1][g]-this.points[h][g])*o/u[h]+this.points[h][g];this.arrPickPoints.push(c)}else this.arrPickPoints.push(this.points[h+1]),h++;h=this.count=0;var d=this,m=null;this.interval=setInterval(function(){var e,t,i=d.getState();i!=CgsAirLine.STATE_FREEZE&&i!=CgsAirLine.STATE_STOP&&(s.count<s.arrPickPoints.length?(s.mark.feature2D.setPosition(s.arrPickPoints[s.count]),m&&(e=s.getRotationByPoint(m,s.mark.feature2D.getPosition()),s.mark.feature2D.setRotation(-(90+e))),m=s.mark.feature2D.getPosition(),s.passPath&&((t=s.points.slice(0,Math.floor(s.count/s.arrPickPoints.length*(s.points.length-1)))).push(m),s.passPath.setPosition(t)),s.durationCallback&&s.durationCallback(s.mark),s.count+=s.deltaTime):(s.arrPickPoints=[],clearInterval(s.interval),s.completeCallback&&s.completeCallback(s.mark),d.finishFlag=!0,d.state=CgsAirLine.STATE_FREEZE))},50)}else console.info("the points with/without height is needed")},CgsAirLine2D.prototype.stop=function(){this.interval&&(this.arrPickPoints=[],clearInterval(this.interval),this.interval=null,this.path&&this.path.feature2D.remove(),this.completeCallback&&this.completeCallback(this.mark),this.state=CgsAirLine.STATE_STOP)},CgsAirLine2D.prototype.speedUp=function(){this.deltaTime+=this.deltaInterval,this.deltaTime>=this.deltaInterval*this.multipy&&(this.deltaTime=this.deltaInterval*this.multipy)},CgsAirLine2D.prototype.speedDown=function(){this.deltaTime-=this.deltaInterval,this.deltaTime<=this.deltaInterval&&(this.deltaTime=this.deltaInterval)},CgsAirLine2D.prototype.freeze=function(){this.state=CgsAirLine.STATE_FREEZE},CgsAirLine2D.prototype.unfreeze=function(){this.state=CgsAirLine.STATE_UNFREEZE},CgsAirLine2D.prototype.restart=function(){this.interval&&(this.arrPickPoints=[],clearInterval(this.interval),this.interval=null,this.state=CgsAirLine.STATE_STOP),this.start(),this.state=CgsAirLine.STATE_RESTART,this.finishFlag=!1},CgsAirLine2D.prototype.getState=function(){return this.state},CgsAirLine2D.prototype.isFinish=function(){return this.finishFlag},CgsAirLine2D.prototype.getPassedPath=function(){return this.path},CgsAirLine2D.prototype.getRotationByPoint=function(e,t){var i=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),s=Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]);if(0!=(o=Cesium.Cartesian3.distance(i,s))){var i=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),s=Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]),o=Cesium.Cartesian3.distance(i,s),a=Math.asin((t[1]-e[1])/Math.sqrt((e[0]-t[0])*(e[0]-t[0])*Math.cos(Cesium.Math.toRadians(t[1]))*Math.cos(Cesium.Math.toRadians(t[1]))+(e[1]-t[1])*(e[1]-t[1])));t[0]-e[0]<0&&(a=-a+Math.PI),a=Cesium.Math.toDegrees(a);var n=Math.asin((t[2]-e[2])/o),n=Cesium.Math.toDegrees(n);return-a}},CgsStream2D=function(t){var i=this;i.show=t.show,i.url=t.url;var e=CgsUtil.getProxyURL(t.proxy);e&&(this.url=e+this.url),$$.ajax({dataType:"json",async:!0,url:i.url,success:function(e){i.canvas=document.createElement("canvas"),i.windy=new Windy({canvas:i.canvas,data:e,fillColor:t.color,lineCount:t.lineCount,speed:t.speed}),i.loaded=!0,i.overlay=new CgsOverlay2D({position:[0,0],element:i.canvas,positioning:"center-center",stopEvent:!1})},error:function(e,t,i){console.error("stream data read error:"+t+"\n"+i)}})},CgsStream2D.prototype.start=function(){var t=this;t.startId=setInterval(function(){var e;t.loaded&&(clearInterval(t.startId),e=t.map.getView().getCenter(),t.overlay.setPosition(e),t.map.addOverlay(t.overlay),!1===t.show&&t.overlay.setVisible(!1),t.drawWind(),ol.events.listen(t.map.getView(),ol.Object.getChangeEventType(ol.ViewProperty.RESOLUTION),t.drawWind,t),ol.events.listen(t.map,ol.MapEventType.MOVEEND,t.drawWind,t))},1e3)},CgsStream2D.prototype.stop=function(){this.loaded&&(this.windy.stop(),this.map.removeOverlay(this.overlay),ol.events.unlisten(this.map.getView(),ol.Object.getChangeEventType(ol.ViewProperty.RESOLUTION),this.drawWind,this),ol.events.unlisten(this.map,ol.MapEventType.MOVEEND,this.drawWind,this))},CgsStream2D.prototype.drawWind=function(){var e=this.map.getSize();this.canvas.width=e[0],this.canvas.height=e[1];var t=this.map.getView().calculateExtent(e),i=this.map.getView().getCenter();this.overlay.setPosition(i);var s=ol.proj.transform([t[0],t[1]],"EPSG:102113","EPSG:4326"),o=ol.proj.transform([t[2],t[3]],"EPSG:102113","EPSG:4326"),t=[s[0],s[1],o[0],o[1]],a=this;setTimeout(function(){a.windy.start([[0,0],[e[0],e[1]]],e[0],e[1],[[t[0],t[1]],[t[2],t[3]]])},750)},CgsStream2D.prototype.setMap=function(e){this.map=e},CgsStream2D.prototype.getMap=function(){return this.map},CgsStream2D.prototype.setVisible=function(e){this.show=e,this.overlay&&this.overlay.getVisible()!=e&&this.overlay.setVisible(e)},CgsStream2D.prototype.getVisible=function(){return this.show},CgsStream2D.prototype.setColor=function(e){this.fillColor=e,this.windy.setFillColor(e)},CgsStream2D.prototype.getColor=function(){return this.fillColor},CgsStream2D.prototype.setSpeed=function(e){this.speed=e,this.windy.setMaxParticleAge(e),this.drawWind()},CgsStream2D.prototype.getSpeed=function(){return this.speed},CgsStream2D.prototype.setLineCount=function(e){this.lineCount=e,this.windy.setParticleCount(e),this.drawWind()},CgsStream2D.prototype.getLineCount=function(){return this.lineCount},CgsStream2D.prototype.getUrl=function(){return this.url},function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsCluster2D=t()}(window,function(){function e(e){e=e||{},this.map=e.map.map2D,this.imageUrl=e.imageUrl,this.imageScale=e.imageScale||1,this.labelColor=e.labelColor||"yellow",this.labelFont=e.labelFont||"18px sans-serif",this.pixelOffset=e.pixelOffset||[0,0],this.vectorSource=new t,this.layer=new i({source:this.vectorSource}),this.map.addLayer(this.layer)}var t=ol.source.Vector,i=ol.layer.Vector,h=ol.style.Style,c=ol.style.Icon,g=ol.style.Text,d=ol.style.Fill,m=ol.geom.Point,f=ol.Feature,C=proj4("EPSG:4326","EPSG:3857").forward;return e.prototype.setData=function(e){var t=this.vectorSource;t.clear();for(var i=new c({src:this.imageUrl,scale:this.imageScale,offset:this.pixelOffset}),s=0,o=e.length;s<o;s++){var a=e[s],n=new g({text:a.length.toString(),font:this.labelFont,fill:new d({color:this.labelColor})}),r=new h({image:i,text:n}),l=C(a.center),u=new m(l),p=new f({geometry:u});p.setStyle(r),t.addFeature(p)}},e.prototype.clearClusterd=function(){this.vectorSource.clear()},e.prototype.destroy=function(){this.layer&&this.map.removeLayer(this.layer)},e}),CgsKml2D=function(e){this.name=e.name,this.url=e.url,this.map=e.mapObject,this.parent=e.parent,this.selectFeatures=[],this.isLoaded=!1,this.featureArr=[];var i=this,t=new ol.source.Vector({url:e.url,format:new ol.format.KML({extractStyles:!0})});t.once("change",function(){i.isLoaded=!0,i.parent.loadedOperation();var t=i.values_.source.idIndex_;Object.keys(t).forEach(function(e){t[e].isKML=!0,i.featureArr.push(t[e])})}),e.source={source:t},ol.layer.Vector.call(this,e.source)},CgsInherits(CgsKml2D,ol.layer.Vector),CgsKml2D.prototype.getType=function(){return this.type},CgsKml2D.prototype.getUrl=function(){return this.url},CgsKml2D.prototype.openManipulateMode=function(t){var i=this;t.selectedColor=null==t.selectedColor?"rgba(0,0,255,0.5)":t.selectedColor,this.currentSelectFeature=void 0,this.lastSelectedFeature=void 0,this.map.map2D.on("pointermove",function(e){i.map.map2D.forEachFeatureAtPixel(e.pixel,function(e){i.featureArr.includes(e)&&(i.currentSelectFeature?i.currentSelectFeature!=e&&(i.lastSelectedFeature=i.currentSelectFeature,i.currentSelectFeature=null,i.selectFeatures[0]!=i.lastSelectedFeature&&i.lastSelectedFeature.setStyle(new ol.style.Style({fill:new ol.style.Fill({color:i.lastSelectedFeature.values_.geometry.originStyle[0].fill_.color_}),stroke:new ol.style.Stroke({color:i.lastSelectedFeature.values_.geometry.originStyle[0].stroke_.color_})}))):(e.setStyle(new ol.style.Style({fill:new ol.style.Fill({color:t.selectedColor}),stroke:new ol.style.Stroke({color:e.values_.geometry.originStyle[0].stroke_.color_})})),i.currentSelectFeature=e))}),!i.map.map2D.getFeaturesAtPixel(e.pixel)&&i.currentSelectFeature&&i.selectFeatures[0]!=i.currentSelectFeature&&(i.currentSelectFeature.setStyle(new ol.style.Style({fill:new ol.style.Fill({color:i.currentSelectFeature.values_.geometry.originStyle[0].fill_.color_}),stroke:new ol.style.Stroke({color:i.currentSelectFeature.values_.geometry.originStyle[0].stroke_.color_})})),i.currentSelectFeature=null)}),this.map.map2D.on("click",function(e){i.map.map2D.forEachFeatureAtPixel(e.pixel,function(e){i.featureArr.includes(e)&&(0!=i.selectFeatures.length&&(i.selectFeatures[0].setStyle(new ol.style.Style({fill:new ol.style.Fill({color:i.selectFeatures[0].values_.geometry.originStyle[0].fill_.color_}),stroke:new ol.style.Stroke({color:i.selectFeatures[0].values_.geometry.originStyle[0].stroke_.color_})})),i.selectFeatures.splice(0,1)),i.selectFeatures.push(e))})})},CgsKml2D.prototype.closeManipulateMode=function(){this.map.map2D.removeEventListener("pointermove"),this.map.map2D.removeEventListener("click"),this.currentSelectFeature=void 0;var e=!(this.lastSelectedFeature=void 0),t=!1,i=void 0;try{for(var s,o=this.featureArr[Symbol.iterator]();!(e=(s=o.next()).done);e=!0)feature=s.value,feature.values_.geometry&&feature.values_.geometry.originStyle&&feature.setStyle(feature.values_.geometry.originStyle[0])}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}},function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsKilometerGrid2D=t()}(window,function(){var o=ol.Collection,a=ol.layer.Vector,n=ol.source.Vector,d=ol.render.getVectorContext,m=ol.Feature,c=ol.geom.Point,r=ol.geom.LineString,u=ol.style.Stroke,p=ol.style.Style,h=ol.style.Fill,g=ol.style.Text,e=ol.extent,f=e.isEmpty,C=e.getCenter,y=e.getIntersection,v=e.equals,b=e.getWidth,D=e.getHeight,S=e.intersects,_=ol.proj.get,w=ol.proj.equivalent,t=ol.proj,P=t.transform,T=t.transformExtent,M=1e3;function L(e,t,i){return Math.min(Math.max(e,t),i)}function s(e){var t=this,i=e||{},s=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0,maxResolution:40},i);return a.call(t,s),t.projection_=null,t.maxLat_=1/0,t.maxLon_=1/0,t.minLat_=-1/0,t.minLon_=-1/0,t.meridians_=[],t.parallels_=[],t.strokeStyle_=void 0!==i.strokeStyle?i.strokeStyle:x,t.meridiansLabels_=null,t.parallelsLabels_=null,i.showLabels&&(t.lonLabelPosition_=void 0===i.lonLabelPosition?0:i.lonLabelPosition,t.latLabelPosition_=void 0===i.latLabelPosition?1:i.latLabelPosition,this.lonLabelStyle_=void 0!==i.lonLabelStyle?i.lonLabelStyle:new g({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new h({color:"rgba(0,0,0,1)"}),stroke:new u({color:"rgba(255,255,255,1)",width:3})}),this.latLabelStyle_=void 0!==i.latLabelStyle?i.latLabelStyle:new g({font:"12px Calibri,sans-serif",textAlign:"end",fill:new h({color:"rgba(0,0,0,1)"}),stroke:new u({color:"rgba(255,255,255,1)",width:3})}),t.meridiansLabels_=[],t.parallelsLabels_=[],t.addEventListener("postrender",t.drawLabels_.bind(t))),t.setSource(new n({loader:t.loaderFunction.bind(t),strategy:t.strategyFunction.bind(t),features:new o,overlaps:!1,useSpatialIndex:!1,wrapX:i.wrapX})),t.featurePool_=[],t.lineStyle_=new p({stroke:t.strokeStyle_}),t.loadedExtent_=null,t.renderedExtent_=null,t.setRenderOrder(null),t}var x=new u({color:"rgba(0,255,0,0.5)"});return CgsUtil.inherits(s,a),s.prototype.strategyFunction=function(e,t){return[e.slice()]},s.prototype.loaderFunction=function(e,t,i){this.loadedExtent_=e;var s=this.getSource(),o=this.getExtent()||[-1/0,-1/0,1/0,1/0],a=y(o,e);if(!(this.renderedExtent_&&v(this.renderedExtent_,a)||(this.renderedExtent_=a,f(a)))){var n=C(a),r=t*t/4;(!this.projection_||!w(this.projection_,i))&&this.updateProjectionInfo_(i),this.createKilometerGrid_(a,n,t,r);var l,u=this.meridians_.length+this.parallels_.length;for(this.meridiansLabels_&&(u+=this.meridians_.length),this.parallelsLabels_&&(u+=this.parallels_.length);u>this.featurePool_.length;)l=new m,this.featurePool_.push(l);var p=s.getFeaturesCollection();p.clear();for(var h=0,c=0,g=this.meridians_.length;c<g;++c)(l=this.featurePool_[h++]).setGeometry(this.meridians_[c]),l.setStyle(this.lineStyle_),p.push(l);for(c=0,g=this.parallels_.length;c<g;++c)(l=this.featurePool_[h++]).setGeometry(this.parallels_[c]),l.setStyle(this.lineStyle_),p.push(l)}},s.prototype.addMeridian_=function(e,t,i,s,o){var a,n=this.getMeridian_(e,t,i,o);return S(n.getExtent(),s)&&(this.meridiansLabels_&&(a="",a=e%1e5==0?Math.round(e/1e5)+"00":Math.round(e%1e5/M)),this.meridians_[o++]=n),{index:o,label:a}},s.prototype.addParallel_=function(e,t,i,s,o){var a,n=this.getParallel_(e,t,i,o);return S(n.getExtent(),s)&&(this.parallelsLabels_&&(a="",a=e%1e5==0?"0":Math.round(e%1e5/M)),this.parallels_[o++]=n),{index:o,label:a}},s.prototype.drawLabels_=function(e){var t,s,o,a,n,r,u=e.frameState.viewState.rotation,p=e.frameState.extent,h=C(p);u&&(t=b(p),s=D(p),o=Math.abs(Math.cos(u)),n=((a=Math.abs(Math.sin(u)))*s-o*t)/(a*a-o*o),r=(a*t-o*s)/(a*a-o*o),rotationExtent=[h[0]-n/2,h[1]-r/2,h[0]+n/2,h[1]+r/2]);var c=d(e),g=null;if(this.meridiansLabels_)for(i=0,l=this.meridiansLabels_.length;i<l;++i)g=this.meridiansLabels_[i],this.lonLabelStyle_.setText(g.text),c.setTextStyle(this.lonLabelStyle_),c.drawGeometry(g.geom);if(this.parallelsLabels_)for(i=0,l=this.parallelsLabels_.length;i<l;++i)g=this.parallelsLabels_[i],this.latLabelStyle_.setText(g.text),c.setTextStyle(this.latLabelStyle_),c.drawGeometry(g.geom)},s.prototype.createKilometerGrid_=function(e,t,i,s){var o;this.meridiansLabels_&&(this.meridiansLabels_=[],this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_=[],this.parallelsLabels_.length=0),this.meridians_=[],this.parallels_=[];var a=[Math.max(e[0],this.minLonP_),Math.max(e[1],this.minLatP_),Math.min(e[2],this.maxLonP_),Math.min(e[3],this.maxLatP_)],n=T(a,"EPSG:3857","EPSG:4326"),r=CgsUtil.lonLatToStableGaussKruger([n[0],n[1]]),l=CgsUtil.lonLatToStableGaussKruger([n[2],n[3]]),u=l[1],p=l[0],h=r[1],c=r[0],g=Math.floor(c/M)*M,d=Math.floor(p/M)*M,m=Math.floor(h/M)*M,f=Math.floor(u/M)*M,C=L(g,Math.floor(c/M)*M,Math.floor(p/M)*M);cnt=D=0;for(var y=[],v=[];C<d;){C+=M,y.push(C);var b=this.addMeridian_(C,h,u,e,D),D=b.index;v.push(b.label)}o=L(m,Math.floor(h/M)*M,Math.floor(u/M)*M),cnt=D=0;for(var S=[],_=[];o<f;){o+=M,S.push(o);var w=this.addParallel_(o,c,p,e,D);D=w.index,_.push(w.label)}this.addLabels(y,S,_,v)},s.prototype.addLabels=function(e,t,i,s){for(var o=0,a=e.length;o<a;o+=2)for(var n=e[o],r=0,l=t.length;r<l;r+=2){var u=t[r],p=CgsUtil.stableGaussKrugerToLonLat([n+500,u]),h=P(p,"EPSG:4326","EPSG:3857");this.meridiansLabels_.push({geom:new c(h),text:i[r]}),p=CgsUtil.stableGaussKrugerToLonLat([n,u+500]),h=P(p,"EPSG:4326","EPSG:3857"),this.parallelsLabels_.push({geom:new c(h),text:s[o]})}},s.prototype.getMeridian_=function(e,t,i,s){var o=CgsUtil.stableGaussKrugerToLonLat([e,t]),a=CgsUtil.stableGaussKrugerToLonLat([e,i]),o=P(o,"EPSG:4326","EPSG:3857"),a=P(a,"EPSG:4326","EPSG:3857"),n=void 0;return void 0!==this.meridians_[s]?(n=this.meridians_[s]).setCoordinates([o,a]):n=new r([o,a]),n},s.prototype.getMeridianPoint_=function(e,t,i){if(e){var s=e.flatCoordinates,o=1,a=s.length-1;s[o]>s[a]&&(o=a,a=1);var n=Math.max(t[1],s[o]),r=Math.min(t[3],s[a]),l=L(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,n,r),u=[s[o-1]+(s[a-1]-s[o-1])*(l-s[o])/(s[a]-s[o]),l],p=this.meridiansLabels_[i].geom;return p.setCoordinates(u),p}},s.prototype.getMeridians=function(){return this.meridians_},s.prototype.getParallel_=function(e,t,i,s){var o=CgsUtil.stableGaussKrugerToLonLat([t,e]),a=CgsUtil.stableGaussKrugerToLonLat([i,e]),o=P(o,"EPSG:4326","EPSG:3857"),a=P(a,"EPSG:4326","EPSG:3857"),n=void 0;return void 0!==this.parallels_[s]?(n=this.parallels_[s]).setCoordinates([o,a]):n=new r([o,a]),n},s.prototype.getParallelPoint_=function(e,t,i){var s=e.flatCoordinates,o=0,a=s.length-2;s[o]>s[a]&&(o=a,a=0);var n=Math.max(t[0],s[o]),r=Math.min(t[2],s[a]),l=L(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,n,r),u=[l,s[o+1]+(s[a+1]-s[o+1])*(l-s[o])/(s[a]-s[o])],p=this.parallelsLabels_[i].geom;return p.setCoordinates(u),p},s.prototype.getParallels=function(){return this.parallels_},s.prototype.updateProjectionInfo_=function(e){this.epsgProjection=_("EPSG:102113");var t=e.getExtent(),i=this.epsgProjection.getExtent(),s=t[3],o=t[2],a=t[1],n=t[0],r=i[3],l=i[2],u=i[1],p=i[0];this.maxLat_=s,this.maxLon_=o,this.minLat_=a,this.minLon_=n,this.maxLatP_=r,this.maxLonP_=l,this.minLatP_=u,this.minLonP_=p,this.projection_=e},s.prototype.setLineColor=function(e){void 0!==e&&this.strokeStyle_&&this.strokeStyle_.getColor()!==e&&this.strokeStyle_.setColor(e)},s.prototype.setLineWidth=function(e){void 0!==e&&this.strokeStyle_&&this.strokeStyle_.getWidth()!==e&&this.strokeStyle_.setWidth(e)},s.prototype.setLabelFillColor=function(e){void 0!==e&&this.lonLabelStyle_&&(this.lonLabelStyle_.getFill().setColor(e),this.latLabelStyle_.getFill().setColor(e))},s.prototype.setLabelStroke=function(e){void 0!==e&&this.lonLabelStyle_&&(this.lonLabelStyle_.getStroke().setColor(e),this.latLabelStyle_.getStroke().setColor(e))},s.prototype.setLabelStrokeWidth=function(e){void 0!==e&&this.lonLabelStyle_&&(this.lonLabelStyle_.getStroke().setWidth(e),this.latLabelStyle_.getStroke().setWidth(e))},s}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsWideLine2D=t()}(window,function(){function e(e){this.projection=void 0===e.projection?"EPSG:102113":e.projection,this.coordinates=[];for(var t=0,i=e.positions.length;t<i;t++)"[object Array]"===Object.prototype.toString.call(e.positions[t])&&this.coordinates.push(e.positions[t].slice(0,2));var s=new ol.geom.LineString(this.coordinates);s.transform("EPSG:4326",this.projection);var o=e.parentFeature,a=e.attribute;CgsFeature2D.call(this,{geometry:s,parentFeature:o,attribute:a}),this._speed=void 0===e.speed?.001:e.speed,this._lengthTexUint=void 0===e.lengthTexUint?5e3:e.lengthTexUint;var n=this.createStyle(e);this._style=n,this._show=void 0===e.show||e.show,this._show?this.setStyle(n):this.setStyle(new ol.style.Style),this._animation=void 0===e.animation||e.animation,this._animation&&(this._animate(),this.offset=0),this._wideLineType=void 0===e.wideLineType?0:e.wideLineType}return CgsUtil.inherits(e,CgsFeature2D),e.prototype.createStyle=function(e){this._width=void 0===e.width?1:e.width,this._lineDash=void 0===e.lengthTexUint?null:[e.lengthTexUint],this._stroke=new CgsStyleStroke2D({color:void 0===e.color?"rgba(255, 255, 0, 1.0)":e.color,width:this._width,lineDash:this._lineDash}),this._text=this.createLabelStyle(e);var s=this;return function(e){var t,i;return 0===s._wideLineType&&(t=s._width/e,s._stroke.setWidth(t),i=[s._lengthTexUint/e],s._stroke.setLineDash(i)),new CgsStyle2D({stroke:s._stroke,text:s._text})}},e.prototype.createLabelStyle=function(e){var t=new CgsStyleStroke2D({color:void 0===e.labelstroke?"rgba(0, 0, 0, 0.0)":e.labelstroke,width:void 0===e.labelstrokewidth?0:e.labelstrokewidth}),i=new CgsStyleFill2D({color:void 0===e.labelfill?"rgba(255, 255, 0, 1.0)":e.labelfill}),s=new CgsStyleFill2D({color:void 0===e.labelBackgroundColor?"rgba(1, 1, 1, 0.8)":e.labelBackgroundColor}),o=!0===e.showLabelBackground,a=[2,7,2,7];"[object Array]"===Object.prototype.toString.call(e.labelBackgroundPadding)&&(a=2===e.labelBackgroundPadding.length?[e.labelBackgroundPadding[1],e.labelBackgroundPadding[0],e.labelBackgroundPadding[1],e.labelBackgroundPadding[0]]:e.labelBackgroundPadding);var n=new CgsStyleText2D({font:void 0===e.labelfont?"24px 微软雅黑":e.labelfont,text:void 0===e.name?"":e.name,rotation:void 0===e.labelrotation?0:e.labelrotation,fill:i,stroke:t,scale:void 0===e.labelscale?1:e.labelscale,offset:void 0===e.labeloffset?[0,-15]:e.labeloffset,backgroundFill:o?s:null,padding:a});return this.labelBackgroundFill=s,n},e.prototype.setPosition=function(e){this.coordinates=[];for(var t=0;t<e.length;t++)this.coordinates.push(e[t].slice(0,2));var i=new ol.geom.LineString(this.coordinates);i.transform("EPSG:4326",this.projection),this.setGeometry(i)},e.prototype.getPosition=function(){return this.coordinates},e.prototype.setColor=function(e){this._stroke.setColor(e),this.changed()},e.prototype.setSpeed=function(e){this._speed=e},e.prototype.enableAnimation=function(e){this._animation!==e&&(this._animation=e)&&this._animate()},e.prototype.setWidth=function(e){this._stroke.setWidth(e),this._width=e,this.changed()},e.prototype.getWidth=function(){return this._stroke},e.prototype.setLengthTexUint=function(e){var t=[this._lengthTexUint=e];this._stroke.setLineDash(t),this.changed()},e.prototype.setDashLine=function(e){this._stroke.setLineDash(e)},e.prototype.setVisible=function(e){(this._show=e)?this.setStyle(this._style):this.setStyle(new ol.style.Style),this.changed()},e.prototype._animate=function(){var t=this;requestAnimationFrame(function(){var e=t._speed*t._lengthTexUint;Math.abs(t.offset)>=Math.abs(t._lengthTexUint)?t.offset=0:t.offset-=e,t._stroke.setLineDashOffset(t.offset),t.changed(),t._animation&&t._animate()})},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsImagerySplit2D=t()}(window,function(){function e(e){this.map=e.map,this.map?(this.upLayer=this.map.getLayerByText(e.leftImagery),this.downLayer=this.map.getLayerByText(e.rightImagery),this.mode=e.mode||"automatic",this.isActive=void 0!==e.active&&e.active,this.color=e.color||"rgba(255, 255, 255, 0.5)",this.alpha=void 0===e.alpha?1:e.alpha,this.width=void 0===e.width?2:e.width,this.left=void 0===e.left?50:e.left,this.direction=e.direction||"left",this.speed=void 0===e.speed?.05:e.speed,this.again=void 0!==e.again&&e.again,this.isActive&&this.activate()):console.error("need map")}return e.prototype.activate=function(){var l=this;this.active||(this.setSlider(),this.upLayer&&(this.upLayerIndex=this.upLayer.getZIndex(),this.upLayer.setZIndex(9998),this.upLayer.setVisible(!0),this.preRenderListener=this.upLayer.on("prerender",function(e){var t=e.context,i=l.map.getSize(),s=i[0]*(l.left/100),o=ol.render.getRenderPixel(e,[0,0]),a=ol.render.getRenderPixel(e,[s,0]),n=ol.render.getRenderPixel(e,[0,i[1]]),r=ol.render.getRenderPixel(e,[s,i[1]]);t.save(),t.beginPath(),t.moveTo(o[0],o[1]),t.lineTo(n[0],n[1]),t.lineTo(r[0],r[1]),t.lineTo(a[0],a[1]),t.closePath(),t.clip()}),this.postRenderListener=this.upLayer.on("postrender",function(e){e.context.restore()}),this.map.render()),this.downLayer&&(this.downLayer.setVisible(!0),this.downLayerIndex=this.downLayer.getZIndex(),this.downLayer.setZIndex(9997)))},e.prototype.remove=function(){},e.prototype.setSlider=function(){var i,s,o;this.slider||((i=document.createElement("div")).hidden=!0,i.setAttribute("class","imagerySplit_sliderDiv ui-widght-content"),i.setAttribute("draggable","false"),i.setAttribute("id","imagerySplit"),this.map.container.appendChild(i),this.slider=i,s=this.map.getSize()[0],o=this,i.ondrag=function(e){var t;0!==e.pageX&&(t=e.offsetX,o.left+=t/s*100,i.style.left=o.left+"%",o.map.render())}),this.slider.hidden=!1,this.slider.style.left=this.left+"%"},e.prototype.setAnimate=function(){var s=this.map,o=this,a=(new Date).getTime(),n=(new Date).getTime();!function i(){"automatic"===o.mode&&requestAnimationFrame(function(){n=a;var e=(a=(new Date).getTime())-n,t="left"===o.direction?-1:1;o.left+=t*e*o.speed/10,o.left<0&&(o.again?(o.left=0,o.direction="right"):o.left=100),100<o.left&&(o.again?(o.left=100,o.direction="left"):o.left=0),s.render(),o.setSlider(),i()})}()},e.prototype.setUpLayer=function(e){var t=this.map&&this.map.getLayerByText(e);t&&(t.setVisible(!0),t.setZIndex(9998),this.upLayer=t)},e.prototype.getUpLayer=function(){return this.upLayer&&this.upLayer.state.text()},e.prototype.setDownLayer=function(e){var t=this.map&&this.map.getLayerByText(e);t&&(t.setVisible(!0),t.setZIndex(9997),this.upLayer=t)},e.prototype.getDownLayer=function(){return this.downLayer&&this.downLayer.state.text()},e.prototype.deactivate=function(){this.isActive=!1,this.slider.hidden=!0},e.prototype.setAgain=function(e){this.again=e},e.prototype.getAgain=function(){return this.again},e.prototype.setWidth=function(e){this.width=e,this.slider.style.width=e+"px"},e.prototype.getWidth=function(){return this.width},e.prototype.setDirection=function(e){this.direction=e},e.prototype.getDirection=function(){return this.direction},e.prototype.setColor=function(e){this.color=e,this.slider.style.backgroundColor=e},e.prototype.getColor=function(){return this.color},e.prototype.setSpeed=function(e){this.speed=e},e.prototype.getSpeed=function(){return this.speed},e.prototype.setAlpha=function(e){this.alpha=e,this.upLayer&&this.upLayer.setOpacity(e)},e.prototype.getAlpha=function(){return this.alpha},e.prototype.setMap=function(e){this.map=e},e.prototype.getMap=function(){return this.map},e.prototype.setMode=function(e){"manual"===(this.mode=e)?(this.slider.style.cursor="e-resize",this.lastTime=void 0):"automatic"===e?this.slider.style.cursor="default":alert("mode error")},e.prototype.getMode=function(){return this.mode},e}),function(e,t){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"==("undefined"==typeof module?"undefined":_typeof(module))?module.exports=t(require("Cesium")):"object"==("undefined"==typeof exports?"undefined":_typeof(exports))?exports.space=t(require("Cesium")):e.space=t(e.Cesium)}("undefined"!=typeof self?self:void 0,function(i){return a={},s.m=o=[function(e,t){e.exports=i},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.RectangularSensorPrimitive=void 0;var $=s(i(0)),Y=s(i(3)),J=s(i(4)),K=s(i(5)),Z=s(i(6));function s(e){return e&&{default:e}}var X=$.default.BoundingSphere,q=$.default.Cartesian3,o=$.default.Color,c=$.default.combine,Q=$.default.ComponentDatatype,a=$.default.defaultValue,n=$.default.defined,ee=(Object.defineProperties,$.default.destroyObject,$.default.DeveloperError),te=$.default.Matrix4,r=$.default.PrimitiveType,ie=$.default.Buffer,se=$.default.BufferUsage,l=$.default.DrawCommand,oe=$.default.Pass,ae=$.default.RenderState,ne=$.default.ShaderProgram,re=$.default.ShaderSource,le=$.default.VertexArray,ue=$.default.BlendingState,pe=$.default.CullFace,u=$.default.Material,he=$.default.SceneMode,ce=$.default.VertexFormat,ge=$.default.Math,de=$.default.Matrix3,me=(te=$.default.Matrix4,$.default.JulianDate),d=($.default.BoxGeometry,$.default.EllipsoidGeometry,Math.sin),fe=Math.cos,Ce=Math.tan,ye=Math.atan,ve=(Math.asin,{position:0,normal:1});function p(e){var t=this;e=a(e,a.EMPTY_OBJECT),this.show=a(e.show,!0),this.slice=a(e.slice,32),this.modelMatrix=te.clone(e.modelMatrix,new te),this._modelMatrix=new te,this._computedModelMatrix=new te,this._computedScanPlaneModelMatrix=new te,this.radius=a(e.radius,Number.POSITIVE_INFINITY),this._radius=void 0,this.xHalfAngle=a(e.xHalfAngle,0),this._xHalfAngle=void 0,this.yHalfAngle=a(e.yHalfAngle,0),this._yHalfAngle=void 0,this.lineColor=a(e.lineColor,o.WHITE),this.showSectorLines=a(e.showSectorLines,!0),this.showSectorSegmentLines=a(e.showSectorSegmentLines,!0),this.showLateralSurfaces=a(e.showLateralSurfaces,!0),this.material=n(e.material)?e.material:u.fromType(u.ColorType),this._material=void 0,this._translucent=void 0,this.lateralSurfaceMaterial=n(e.lateralSurfaceMaterial)?e.lateralSurfaceMaterial:u.fromType(u.ColorType),this._lateralSurfaceMaterial=void 0,this._lateralSurfaceTranslucent=void 0,this.showDomeSurfaces=a(e.showDomeSurfaces,!0),this.domeSurfaceMaterial=n(e.domeSurfaceMaterial)?e.domeSurfaceMaterial:u.fromType(u.ColorType),this._domeSurfaceMaterial=void 0,this.showDomeLines=a(e.showDomeLines,!0),this.showIntersection=a(e.showIntersection,!0),this.intersectionColor=a(e.intersectionColor,o.WHITE),this.intersectionWidth=a(e.intersectionWidth,5),this.showThroughEllipsoid=a(e.showThroughEllipsoid,!1),this._showThroughEllipsoid=void 0,this.showScanPlane=a(e.showScanPlane,!0),this.scanPlaneColor=a(e.scanPlaneColor,o.WHITE),this.scanPlaneMode=a(e.scanPlaneMode,"horizontal"),this.scanPlaneRate=a(e.scanPlaneRate,10),this._scanePlaneXHalfAngle=0,this._scanePlaneYHalfAngle=0,this._time=me.now(),this._boundingSphere=new X,this._boundingSphereWC=new X,this._sectorFrontCommand=new l({owner:this,primitiveType:r.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._sectorBackCommand=new l({owner:this,primitiveType:r.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._sectorVA=void 0,this._sectorLineCommand=new l({owner:this,primitiveType:r.LINES,boundingVolume:this._boundingSphereWC}),this._sectorLineVA=void 0,this._sectorSegmentLineCommand=new l({owner:this,primitiveType:r.LINES,boundingVolume:this._boundingSphereWC}),this._sectorSegmentLineVA=void 0,this._domeFrontCommand=new l({owner:this,primitiveType:r.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._domeBackCommand=new l({owner:this,primitiveType:r.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._domeVA=void 0,this._domeLineCommand=new l({owner:this,primitiveType:r.LINES,boundingVolume:this._boundingSphereWC}),this._domeLineVA=void 0,this._scanPlaneFrontCommand=new l({owner:this,primitiveType:r.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._scanPlaneBackCommand=new l({owner:this,primitiveType:r.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._scanRadialCommand=void 0,this._colorCommands=[],this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._uniforms={u_type:function(){return 0},u_xHalfAngle:function(){return t.xHalfAngle},u_yHalfAngle:function(){return t.yHalfAngle},u_radius:function(){return t.radius},u_showThroughEllipsoid:function(){return t.showThroughEllipsoid},u_showIntersection:function(){return t.showIntersection},u_intersectionColor:function(){return t.intersectionColor},u_intersectionWidth:function(){return t.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return t.lineColor}},this._scanUniforms={u_xHalfAngle:function(){return t._scanePlaneXHalfAngle},u_yHalfAngle:function(){return t._scanePlaneYHalfAngle},u_radius:function(){return t.radius},u_color:function(){return t.scanPlaneColor},u_showThroughEllipsoid:function(){return t.showThroughEllipsoid},u_showIntersection:function(){return t.showIntersection},u_intersectionColor:function(){return t.intersectionColor},u_intersectionWidth:function(){return t.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return t.lineColor}}}p.prototype.update=function(e){var t,n,i,s,o,a,r,l,u,p,h,c,g,d,m,f,C,y,v=e.mode;if(this.show&&v===he.SCENE3D){var b=!1,D=!1,S=!1,_=this.xHalfAngle,w=this.yHalfAngle;if(_<0||w<0)throw new ee("halfAngle must be greater than or equal to zero.");if(0!=_&&0!=w){this._xHalfAngle===_&&this._yHalfAngle===w||(this._xHalfAngle=_,this._yHalfAngle=w,b=!0);var P=this.radius;if(P<0)throw new ee("this.radius must be greater than or equal to zero.");var T=!1;this._radius!==P&&(T=!0,this._radius=P,this._boundingSphere=new X(q.ZERO,this.radius)),te.equals(this.modelMatrix,this._modelMatrix)&&!T||(te.clone(this.modelMatrix,this._modelMatrix),te.multiplyByUniformScale(this.modelMatrix,this.radius,this._computedModelMatrix),X.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC));var M=this.showThroughEllipsoid;this._showThroughEllipsoid!==this.showThroughEllipsoid&&(this._showThroughEllipsoid=M,D=!0);var L=this.material;this._material!==L&&(this._material=L,S=D=!0);var x,E,A,I,F,k,R,O,V,G,B=L.isTranslucent();this._translucent!==B&&(this._translucent=B,D=!0),this.showScanPlane&&(x=e.time,(E=me.secondsDifference(x,this._time))<0&&(this._time=me.clone(x,this._time)),I=Math.max(E%this.scanPlaneRate/this.scanPlaneRate,0),"horizontal"==this.scanPlaneMode?(F=fe(A=2*w*I-w),k=Ce(_),R=ye(F*k),this._scanePlaneXHalfAngle=R,this._scanePlaneYHalfAngle=A,$.default.Matrix3.fromRotationX(this._scanePlaneYHalfAngle,be)):(A=2*_*I-_,O=Ce(w),V=fe(A),G=ye(V*O),this._scanePlaneXHalfAngle=A,this._scanePlaneYHalfAngle=G,$.default.Matrix3.fromRotationY(this._scanePlaneXHalfAngle,be)),$.default.Matrix4.multiplyByMatrix3(this.modelMatrix,be,this._computedScanPlaneModelMatrix),te.multiplyByUniformScale(this._computedScanPlaneModelMatrix,this.radius,this._computedScanPlaneModelMatrix)),b&&(p=this,f=e.context,C=Se(p,p.xHalfAngle,p.yHalfAngle),y=function(){var e=p.xHalfAngle,t=p.yHalfAngle,i=C.zoy,s=C.zox,o=[],a=de.fromRotationY(e,be);o.push(i.map(function(e){return de.multiplyByVector(a,e,new $.default.Cartesian3)}));a=de.fromRotationX(-t,be);o.push(s.map(function(e){return de.multiplyByVector(a,e,new $.default.Cartesian3)}).reverse());a=de.fromRotationY(-e,be);o.push(i.map(function(e){return de.multiplyByVector(a,e,new $.default.Cartesian3)}).reverse());a=de.fromRotationX(t,be);return o.push(s.map(function(e){return de.multiplyByVector(a,e,new $.default.Cartesian3)})),o}(),p.showLateralSurfaces&&(p._sectorVA=function(e,t){for(var i=Array.prototype.concat.apply([],t).length-t.length,s=new Float32Array(18*i),o=0,a=0,n=t.length;a<n;a++)for(var r=t[a],l=q.normalize(q.cross(r[0],r[r.length-1],De),De),u=0,i=r.length-1;u<i;u++)s[o++]=0,s[o++]=0,s[o++]=0,s[o++]=-l.x,s[o++]=-l.y,s[o++]=-l.z,s[o++]=r[u].x,s[o++]=r[u].y,s[o++]=r[u].z,s[o++]=-l.x,s[o++]=-l.y,s[o++]=-l.z,s[o++]=r[u+1].x,s[o++]=r[u+1].y,s[o++]=r[u+1].z,s[o++]=-l.x,s[o++]=-l.y,s[o++]=-l.z;var p=ie.createVertexBuffer({context:e,typedArray:s,usage:se.STATIC_DRAW}),h=6*Float32Array.BYTES_PER_ELEMENT,c=[{index:ve.position,vertexBuffer:p,componentsPerAttribute:3,componentDatatype:Q.FLOAT,offsetInBytes:0,strideInBytes:h},{index:ve.normal,vertexBuffer:p,componentsPerAttribute:3,componentDatatype:Q.FLOAT,offsetInBytes:3*Float32Array.BYTES_PER_ELEMENT,strideInBytes:h}];return new le({context:e,attributes:c})}(f,y)),p.showSectorLines&&(p._sectorLineVA=function(e,t){for(var i=t.length,s=new Float32Array(9*i),o=0,a=0,n=t.length;a<n;a++){var r=t[a];s[o++]=0,s[o++]=0,s[o++]=0,s[o++]=r[0].x,s[o++]=r[0].y,s[o++]=r[0].z}var l=ie.createVertexBuffer({context:e,typedArray:s,usage:se.STATIC_DRAW}),u=3*Float32Array.BYTES_PER_ELEMENT,p=[{index:ve.position,vertexBuffer:l,componentsPerAttribute:3,componentDatatype:Q.FLOAT,offsetInBytes:0,strideInBytes:u}];return new le({context:e,attributes:p})}(f,y)),p.showSectorSegmentLines&&(p._sectorSegmentLineVA=function(e,t){for(var i=Array.prototype.concat.apply([],t).length-t.length,s=new Float32Array(9*i),o=0,a=0,n=t.length;a<n;a++)for(var r=t[a],l=0,i=r.length-1;l<i;l++)s[o++]=r[l].x,s[o++]=r[l].y,s[o++]=r[l].z,s[o++]=r[l+1].x,s[o++]=r[l+1].y,s[o++]=r[l+1].z;var u=ie.createVertexBuffer({context:e,typedArray:s,usage:se.STATIC_DRAW}),p=3*Float32Array.BYTES_PER_ELEMENT,h=[{index:ve.position,vertexBuffer:u,componentsPerAttribute:3,componentDatatype:Q.FLOAT,offsetInBytes:0,strideInBytes:p}];return new le({context:e,attributes:h})}(f,y)),p.showDomeSurfaces&&(p._domeVA=(h=f,c=$.default.EllipsoidGeometry.createGeometry(new $.default.EllipsoidGeometry({vertexFormat:ce.POSITION_ONLY,stackPartitions:32,slicePartitions:32})),le.fromGeometry({context:h,geometry:c,attributeLocations:ve,bufferUsage:se.STATIC_DRAW,interleave:!1}))),p.showDomeLines&&(p._domeLineVA=(g=f,d=$.default.EllipsoidOutlineGeometry.createGeometry(new $.default.EllipsoidOutlineGeometry({vertexFormat:ce.POSITION_ONLY,stackPartitions:32,slicePartitions:32})),le.fromGeometry({context:g,geometry:d,attributeLocations:ve,bufferUsage:se.STATIC_DRAW,interleave:!1}))),p.showScanPlane&&("horizontal"==p.scanPlaneMode?(m=Se(p,ge.PI_OVER_TWO,0),p._scanPlaneVA=_e(f,m.zox)):(m=Se(p,0,ge.PI_OVER_TWO),p._scanPlaneVA=_e(f,m.zoy)))),D&&(l=this,u=M,B?(l._frontFaceRS=ae.fromCache({depthTest:{enabled:!u},depthMask:!1,blending:ue.ALPHA_BLEND,cull:{enabled:!0,face:pe.BACK}}),l._backFaceRS=ae.fromCache({depthTest:{enabled:!u},depthMask:!1,blending:ue.ALPHA_BLEND,cull:{enabled:!0,face:pe.FRONT}}),l._pickRS=ae.fromCache({depthTest:{enabled:!u},depthMask:!1,blending:ue.ALPHA_BLEND})):(l._frontFaceRS=ae.fromCache({depthTest:{enabled:!u},depthMask:!0}),l._pickRS=ae.fromCache({depthTest:{enabled:!0},depthMask:!0}))),S&&(n=e,function(e,t){var i=n.context,s=Y.default,o=new re({sources:[K.default,t.shaderSource,J.default]});e._sp=ne.replaceCache({context:i,shaderProgram:e._sp,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:ve});var a=new re({sources:[K.default,t.shaderSource,J.default],pickColorQualifier:"uniform"});e._pickSP=ne.replaceCache({context:i,shaderProgram:e._pickSP,vertexShaderSource:s,fragmentShaderSource:a,attributeLocations:ve})}(t=this,i=L),t.showScanPlane&&(s=t,o=n.context,a=Y.default,r=new re({sources:[K.default,i.shaderSource,Z.default]}),s._scanePlaneSP=ne.replaceCache({context:o,shaderProgram:s._scanePlaneSP,vertexShaderSource:a,fragmentShaderSource:r,attributeLocations:ve}))),(D||S)&&function(e,t){e._colorCommands.length=0;var i=t?oe.TRANSLUCENT:oe.OPAQUE;e.showLateralSurfaces&&we(e,e._sectorFrontCommand,e._sectorBackCommand,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorVA,e._uniforms,e._computedModelMatrix,t,i),e.showSectorLines&&we(e,e._sectorLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorLineVA,e._uniforms,e._computedModelMatrix,t,i,!0),e.showSectorSegmentLines&&we(e,e._sectorSegmentLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorSegmentLineVA,e._uniforms,e._computedModelMatrix,t,i,!0),e.showDomeSurfaces&&we(e,e._domeFrontCommand,e._domeBackCommand,e._frontFaceRS,e._backFaceRS,e._sp,e._domeVA,e._uniforms,e._computedModelMatrix,t,i),e.showDomeLines&&we(e,e._domeLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._domeLineVA,e._uniforms,e._computedModelMatrix,t,i,!0),e.showScanPlane&&we(e,e._scanPlaneFrontCommand,e._scanPlaneBackCommand,e._frontFaceRS,e._backFaceRS,e._scanePlaneSP,e._scanPlaneVA,e._scanUniforms,e._computedScanPlaneModelMatrix,t,i)}(this,B);var H=e.commandList,N=e.passes,W=this._colorCommands;if(N.render)for(var z=0,j=W.length;z<j;z++){var U=W[z];H.push(U)}}}};var be=new de,De=new q;function Se(e,t,i){for(var s=e.slice,o=fe(i),a=Ce(i),n=fe(t),r=Ce(t),l=ye(n*a),u=ye(o*r),p=[],h=0;h<s;h++){var c=2*l*h/(s-1)-l;p.push(new q(0,d(c),fe(c)))}for(var g=[],h=0;h<s;h++)c=2*u*h/(s-1)-u,g.push(new q(d(c),0,fe(c)));return{zoy:p,zox:g}}function _e(e,t){for(var i=t.length-1,s=new Float32Array(9*i),o=0,a=0;a<i;a++)s[o++]=0,s[o++]=0,s[o++]=0,s[o++]=t[a].x,s[o++]=t[a].y,s[o++]=t[a].z,s[o++]=t[a+1].x,s[o++]=t[a+1].y,s[o++]=t[a+1].z;var n=ie.createVertexBuffer({context:e,typedArray:s,usage:se.STATIC_DRAW}),r=3*Float32Array.BYTES_PER_ELEMENT,l=[{index:ve.position,vertexBuffer:n,componentsPerAttribute:3,componentDatatype:Q.FLOAT,offsetInBytes:0,strideInBytes:r}];return new le({context:e,attributes:l})}function we(e,t,i,s,o,a,n,r,l,u,p,h){u&&i&&(i.vertexArray=n,i.renderState=o,i.shaderProgram=a,i.uniformMap=c(r,e._material._uniforms),i.uniformMap.u_normalDirection=function(){return-1},i.pass=p,i.modelMatrix=l,e._colorCommands.push(i)),t.vertexArray=n,t.renderState=s,t.shaderProgram=a,t.uniformMap=c(r,e._material._uniforms),h&&(t.uniformMap.u_type=function(){return 1}),t.pass=p,t.modelMatrix=l,e._colorCommands.push(t)}t.RectangularSensorPrimitive=p},function(e,t,i){var s=i(0),o=s&&{default:s},a=i(1),n=i(7),r=i(8);o.default.RectangularSensorPrimitive=a.RectangularSensorPrimitive,o.default.RectangularSensorGraphics=n.RectangularSensorGraphics,o.default.RectangularSensorVisualizer=r.RectangularSensorVisualizer;var l=o.default.DataSourceDisplay,u=l.defaultVisualizersCallback;l.defaultVisualizersCallback=function(e,t,i){var s=i.entities;return u(e,t,i).concat([new r.RectangularSensorVisualizer(e,s)])}},function(e,t){e.exports="attribute vec4 position;\r\nattribute vec3 normal;\r\n\r\nvarying vec3 v_position;\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = czm_modelViewProjection * position;\r\n    v_position = vec3(position);\r\n    v_positionWC = (czm_model * position).xyz;\r\n    v_positionEC = (czm_modelView * position).xyz;\r\n    v_normalEC = czm_normal * normal;\r\n}"},function(e,t){e.exports='#ifdef GL_OES_standard_derivatives\r\n    #extension GL_OES_standard_derivatives : enable\r\n#endif\r\n\r\nuniform bool u_showIntersection;\r\nuniform bool u_showThroughEllipsoid;\r\n\r\nuniform float u_radius;\r\nuniform float u_xHalfAngle;\r\nuniform float u_yHalfAngle;\r\nuniform float u_normalDirection;\r\nuniform float u_type;\r\n\r\nvarying vec3 v_position;\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvec4 getColor(float sensorRadius, vec3 pointEC)\r\n{\r\n    czm_materialInput materialInput;\r\n\r\n    vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\r\n    materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\r\n    materialInput.str = pointMC / sensorRadius;\r\n\r\n    vec3 positionToEyeEC = -v_positionEC;\r\n    materialInput.positionToEyeEC = positionToEyeEC;\r\n\r\n    vec3 normalEC = normalize(v_normalEC);\r\n    materialInput.normalEC = u_normalDirection * normalEC;\r\n\r\n    czm_material material = czm_getMaterial(materialInput);\r\n\r\n    return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\r\n\r\n}\r\n\r\nbool isOnBoundary(float value, float epsilon)\r\n{\r\n    float width = getIntersectionWidth();\r\n    float tolerance = width * epsilon;\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    float delta = max(abs(dFdx(value)), abs(dFdy(value)));\r\n    float pixels = width * delta;\r\n    float temp = abs(value);\r\n    // There are a couple things going on here.\r\n    // First we test the value at the current fragment to see if it is within the tolerance.\r\n    // We also want to check if the value of an adjacent pixel is within the tolerance,\r\n    // but we don\'t want to admit points that are obviously not on the surface.\r\n    // For example, if we are looking for "value" to be close to 0, but value is 1 and the adjacent value is 2,\r\n    // then the delta would be 1 and "temp - delta" would be "1 - 1" which is zero even though neither of\r\n    // the points is close to zero.\r\n    return temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\r\n#else\r\n    return abs(value) < tolerance;\r\n#endif\r\n}\r\n\r\nvec4 shade(bool isOnBoundary)\r\n{\r\n    if (u_showIntersection && isOnBoundary)\r\n    {\r\n        return getIntersectionColor();\r\n    }\r\n    if(u_type == 1.0){\r\n        return getLineColor();\r\n    }\r\n    return getColor(u_radius, v_positionEC);\r\n}\r\n\r\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\r\n{\r\n    vec3 scaled = ellipsoid.inverseRadii * point;\r\n    return dot(scaled, scaled) - 1.0;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec3 sensorVertexWC = czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\r\n    vec3 sensorVertexEC = czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\r\n\r\n    //vec3 pixDir = normalize(v_position);\r\n    float positionX = v_position.x;\r\n    float positionY = v_position.y;\r\n    float positionZ = v_position.z;\r\n\r\n    vec3 zDir = vec3(0.0, 0.0, 1.0);\r\n    vec3 lineX = vec3(positionX, 0 ,positionZ);\r\n    vec3 lineY = vec3(0, positionY, positionZ);\r\n    float resX = dot(normalize(lineX), zDir);\r\n    if(resX < cos(u_xHalfAngle)-0.00001){\r\n        discard;\r\n    }\r\n    float resY = dot(normalize(lineY), zDir);\r\n    if(resY < cos(u_yHalfAngle)-0.00001){\r\n        discard;\r\n    }\r\n\r\n\r\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\r\n    float ellipsoidValue = ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\r\n\r\n    // Occluded by the ellipsoid?\r\n\tif (!u_showThroughEllipsoid)\r\n\t{\r\n\t    // Discard if in the ellipsoid\r\n\t    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\r\n\t    if (ellipsoidValue < 0.0)\r\n\t    {\r\n            discard;\r\n\t    }\r\n\r\n\t    // Discard if in the sensor\'s shadow\r\n\t    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\r\n\t    {\r\n\t        discard;\r\n\t    }\r\n    }\r\n\r\n    // Notes: Each surface functions should have an associated tolerance based on the floating point error.\r\n    bool isOnEllipsoid = isOnBoundary(ellipsoidValue, czm_epsilon3);\r\n    //isOnEllipsoid = false;\r\n    //if((resX >= 0.8 && resX <= 0.81)||(resY >= 0.8 && resY <= 0.81)){\r\n    /*if(false){\r\n        gl_FragColor = vec4(1.0,0.0,0.0,1.0);\r\n    }else{\r\n        gl_FragColor = shade(isOnEllipsoid);\r\n    }\r\n*/\r\n    gl_FragColor = shade(isOnEllipsoid);\r\n\r\n}'},function(e,t){e.exports="uniform vec4 u_intersectionColor;\nuniform float u_intersectionWidth;\nuniform vec4 u_lineColor;\n\nbool inSensorShadow(vec3 coneVertexWC, czm_ellipsoid ellipsoidEC, vec3 pointWC)\n{\n    // Diagonal matrix from the unscaled ellipsoid space to the scaled space.    \n    vec3 D = ellipsoidEC.inverseRadii;\n\n    // Sensor vertex in the scaled ellipsoid space\n    vec3 q = D * coneVertexWC;\n    float qMagnitudeSquared = dot(q, q);\n    float test = qMagnitudeSquared - 1.0;\n    \n    // Sensor vertex to fragment vector in the ellipsoid's scaled space\n    vec3 temp = D * pointWC - q;\n    float d = dot(temp, q);\n    \n    // Behind silhouette plane and inside silhouette cone\n    return (d < -test) && (d / length(temp) < -sqrt(test));\n}\n\n///////////////////////////////////////////////////////////////////////////////\n\nvec4 getLineColor()\n{\n    return u_lineColor;\n}\n\nvec4 getIntersectionColor()\n{\n    return u_intersectionColor;\n}\n\nfloat getIntersectionWidth()\n{\n    return u_intersectionWidth;\n}\n\nvec2 sensor2dTextureCoordinates(float sensorRadius, vec3 pointMC)\n{\n    // (s, t) both in the range [0, 1]\n    float t = pointMC.z / sensorRadius;\n    float s = 1.0 + (atan(pointMC.y, pointMC.x) / czm_twoPi);\n    s = s - floor(s);\n    \n    return vec2(s, t);\n}\n"},function(e,t){e.exports='#ifdef GL_OES_standard_derivatives\r\n    #extension GL_OES_standard_derivatives : enable\r\n#endif\r\n\r\nuniform bool u_showIntersection;\r\nuniform bool u_showThroughEllipsoid;\r\n\r\nuniform float u_radius;\r\nuniform float u_xHalfAngle;\r\nuniform float u_yHalfAngle;\r\nuniform float u_normalDirection;\r\nuniform vec4 u_color;\r\n\r\nvarying vec3 v_position;\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvec4 getColor(float sensorRadius, vec3 pointEC)\r\n{\r\n    czm_materialInput materialInput;\r\n\r\n    vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\r\n    materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\r\n    materialInput.str = pointMC / sensorRadius;\r\n\r\n    vec3 positionToEyeEC = -v_positionEC;\r\n    materialInput.positionToEyeEC = positionToEyeEC;\r\n\r\n    vec3 normalEC = normalize(v_normalEC);\r\n    materialInput.normalEC = u_normalDirection * normalEC;\r\n\r\n    czm_material material = czm_getMaterial(materialInput);\r\n\r\n    material.diffuse = u_color.rgb;\r\n    material.alpha = u_color.a;\r\n\r\n    return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\r\n\r\n}\r\n\r\nbool isOnBoundary(float value, float epsilon)\r\n{\r\n    float width = getIntersectionWidth();\r\n    float tolerance = width * epsilon;\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    float delta = max(abs(dFdx(value)), abs(dFdy(value)));\r\n    float pixels = width * delta;\r\n    float temp = abs(value);\r\n    // There are a couple things going on here.\r\n    // First we test the value at the current fragment to see if it is within the tolerance.\r\n    // We also want to check if the value of an adjacent pixel is within the tolerance,\r\n    // but we don\'t want to admit points that are obviously not on the surface.\r\n    // For example, if we are looking for "value" to be close to 0, but value is 1 and the adjacent value is 2,\r\n    // then the delta would be 1 and "temp - delta" would be "1 - 1" which is zero even though neither of\r\n    // the points is close to zero.\r\n    return temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\r\n#else\r\n    return abs(value) < tolerance;\r\n#endif\r\n}\r\n\r\nvec4 shade(bool isOnBoundary)\r\n{\r\n    if (u_showIntersection && isOnBoundary)\r\n    {\r\n        return getIntersectionColor();\r\n    }\r\n    return getColor(u_radius, v_positionEC);\r\n}\r\n\r\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\r\n{\r\n    vec3 scaled = ellipsoid.inverseRadii * point;\r\n    return dot(scaled, scaled) - 1.0;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec3 sensorVertexWC = czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\r\n    vec3 sensorVertexEC = czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\r\n\r\n    //vec3 pixDir = normalize(v_position);\r\n    float positionX = v_position.x;\r\n    float positionY = v_position.y;\r\n    float positionZ = v_position.z;\r\n\r\n    vec3 zDir = vec3(0.0, 0.0, 1.0);\r\n    vec3 lineX = vec3(positionX, 0 ,positionZ);\r\n    vec3 lineY = vec3(0, positionY, positionZ);\r\n    float resX = dot(normalize(lineX), zDir);\r\n    if(resX < cos(u_xHalfAngle) - 0.0001){\r\n        discard;\r\n    }\r\n    float resY = dot(normalize(lineY), zDir);\r\n    if(resY < cos(u_yHalfAngle)- 0.0001){\r\n        discard;\r\n    }\r\n\r\n\r\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\r\n    float ellipsoidValue = ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\r\n\r\n    // Occluded by the ellipsoid?\r\n\tif (!u_showThroughEllipsoid)\r\n\t{\r\n\t    // Discard if in the ellipsoid\r\n\t    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\r\n\t    if (ellipsoidValue < 0.0)\r\n\t    {\r\n            discard;\r\n\t    }\r\n\r\n\t    // Discard if in the sensor\'s shadow\r\n\t    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\r\n\t    {\r\n\t        discard;\r\n\t    }\r\n    }\r\n\r\n    // Notes: Each surface functions should have an associated tolerance based on the floating point error.\r\n    bool isOnEllipsoid = isOnBoundary(ellipsoidValue, czm_epsilon3);\r\n    gl_FragColor = shade(isOnEllipsoid);\r\n\r\n}'},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.RectangularSensorGraphics=void 0;var s=i(0),o=s&&{default:s},a=o.default.defaultValue,n=o.default.defined,r=Object.defineProperties,l=o.default.DeveloperError,u=o.default.Event,p=o.default.createMaterialPropertyDescriptor,h=o.default.createPropertyDescriptor;function c(e){this._show=void 0,this._radius=void 0,this._xHalfAngle=void 0,this._yHalfAngle=void 0,this._lineColor=void 0,this._showSectorLines=void 0,this._showSectorSegmentLines=void 0,this._showLateralSurfaces=void 0,this._material=void 0,this._showDomeSurfaces=void 0,this._showDomeLines=void 0,this._showIntersection=void 0,this._intersectionColor=void 0,this._intersectionWidth=void 0,this._showThroughEllipsoid=void 0,this._gaze=void 0,this._showScanPlane=void 0,this._scanPlaneColor=void 0,this._scanPlaneMode=void 0,this._scanPlaneRate=void 0,this._definitionChanged=new u,this.merge(a(e,a.EMPTY_OBJECT))}r(c.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:h("show"),radius:h("radius"),xHalfAngle:h("xHalfAngle"),yHalfAngle:h("yHalfAngle"),lineColor:h("lineColor"),showSectorLines:h("showSectorLines"),showSectorSegmentLines:h("showSectorSegmentLines"),showLateralSurfaces:h("showLateralSurfaces"),material:p("material"),showDomeSurfaces:h("showDomeSurfaces"),showDomeLines:h("showDomeLines"),showIntersection:h("showIntersection"),intersectionColor:h("intersectionColor"),intersectionWidth:h("intersectionWidth"),showThroughEllipsoid:h("showThroughEllipsoid"),gaze:h("gaze"),showScanPlane:h("showScanPlane"),scanPlaneColor:h("scanPlaneColor"),scanPlaneMode:h("scanPlaneMode"),scanPlaneRate:h("scanPlaneRate")}),c.prototype.clone=function(e){return n(e)||(e=new c),e.show=this.show,e.radius=this.radius,e.xHalfAngle=this.xHalfAngle,e.yHalfAngle=this.yHalfAngle,e.lineColor=this.lineColor,e.showSectorLines=this.showSectorLines,e.showSectorSegmentLines=this.showSectorSegmentLines,e.showLateralSurfaces=this.showLateralSurfaces,e.material=this.material,e.showDomeSurfaces=this.showDomeSurfaces,e.showDomeLines=this.showDomeLines,e.showIntersection=this.showIntersection,e.intersectionColor=this.intersectionColor,e.intersectionWidth=this.intersectionWidth,e.showThroughEllipsoid=this.showThroughEllipsoid,e.gaze=this.gaze,e.showScanPlane=this.showScanPlane,e.scanPlaneColor=this.scanPlaneColor,e.scanPlaneMode=this.scanPlaneMode,e.scanPlaneRate=this.scanPlaneRate,e},c.prototype.merge=function(e){if(!n(e))throw new l("source is required.");this.show=a(this.show,e.show),this.radius=a(this.radius,e.radius),this.xHalfAngle=a(this.xHalfAngle,e.xHalfAngle),this.yHalfAngle=a(this.yHalfAngle,e.yHalfAngle),this.lineColor=a(this.lineColor,e.lineColor),this.showSectorLines=a(this.showSectorLines,e.showSectorLines),this.showSectorSegmentLines=a(this.showSectorSegmentLines,e.showSectorSegmentLines),this.showLateralSurfaces=a(this.showLateralSurfaces,e.showLateralSurfaces),this.material=a(this.material,e.material),this.showDomeSurfaces=a(this.showDomeSurfaces,e.showDomeSurfaces),this.showDomeLines=a(this.showDomeLines,e.showDomeLines),this.showIntersection=a(this.showIntersection,e.showIntersection),this.intersectionColor=a(this.intersectionColor,e.intersectionColor),this.intersectionWidth=a(this.intersectionWidth,e.intersectionWidth),this.showThroughEllipsoid=a(this.showThroughEllipsoid,e.showThroughEllipsoid),this.gaze=a(this.gaze,e.gaze),this.showScanPlane=a(this.showScanPlane,e.showScanPlane),this.scanPlaneColor=a(this.scanPlaneColor,e.scanPlaneColor),this.scanPlaneMode=a(this.scanPlaneMode,e.scanPlaneMode),this.scanPlaneRate=a(this.scanPlaneRate,e.scanPlaneRate)},t.RectangularSensorGraphics=c},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.RectangularSensorVisualizer=void 0;function s(e,t){if(!P(e))throw new T("scene is required.");if(!P(t))throw new T("entityCollection is required.");t.collectionChanged.addEventListener(s.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._hash={},this._entitiesToVisualize=new a,this._onCollectionChanged(t,t.values,[],[])}var o=i(0),D=o&&{default:o},S=i(1),u=i(9),a=D.default.AssociativeArray,_=D.default.Cartesian3,w=D.default.Color,P=D.default.defined,n=D.default.destroyObject,T=D.default.DeveloperError,M=D.default.Matrix3,L=D.default.Matrix4,x=D.default.Quaternion,E=D.default.MaterialProperty,A=D.default.Property,I=new M,F=(new L,new _),k=new _,R=new x,O=new _,V=new x;s.prototype.update=function(e){if(!P(e))throw new T("time is required.");for(var t=this._entitiesToVisualize.values,i=this._hash,s=this._primitives,o=0,a=t.length;o<a;o++){var n,r,l,u=t[o],p=u._rectangularSensor,h=i[u.id],c=u.isShowing&&u.isAvailable(e)&&A.getValueOrDefault(p._show,e,!0);if(c&&(n=A.getValueOrUndefined(u._position,e,F),v=A.getValueOrUndefined(u._orientation,e,R),b=A.getValueOrUndefined(p._radius,e),r=A.getValueOrUndefined(p._xHalfAngle,e),l=A.getValueOrUndefined(p._yHalfAngle,e),c=P(n)&&P(r)&&P(l)),c){var g=P(h)?h.primitive:void 0;P(g)||((g=new S.RectangularSensorPrimitive).id=u,s.add(g),h={primitive:g,position:void 0,orientation:void 0},i[u.id]=h);var d=A.getValueOrUndefined(p._gaze,e);if(P(d)){var m=A.getValueOrUndefined(d._position,e,k);if(!P(n)||!P(m))continue;var f=_.subtract(n,m,O),C=_.angleBetween(D.default.Cartesian3.UNIT_Z,f),y=_.cross(D.default.Cartesian3.UNIT_Z,f,O),v=x.fromAxisAngle(y,C-Math.PI,V),b=_.distance(n,m);g.modelMatrix=L.fromRotationTranslation(M.fromQuaternion(v,I),n,g.modelMatrix)}else _.equals(n,h.position)&&x.equals(v,h.orientation)||(P(v)?(g.modelMatrix=L.fromRotationTranslation(M.fromQuaternion(v,I),n,g.modelMatrix),h.position=_.clone(n,h.position),h.orientation=x.clone(v,h.orientation)):(g.modelMatrix=D.default.Transforms.eastNorthUpToFixedFrame(n),h.position=_.clone(n,h.position)));g.show=!0,g.gaze=d,g.radius=b,g.xHalfAngle=r,g.yHalfAngle=l,g.lineColor=A.getValueOrDefault(p._lineColor,e,w.WHITE),g.showSectorLines=A.getValueOrDefault(p._showSectorLines,e,!0),g.showSectorSegmentLines=A.getValueOrDefault(p._showSectorSegmentLines,e,!0),g.showLateralSurfaces=A.getValueOrDefault(p._showLateralSurfaces,e,!0),g.material=E.getValue(e,p._material,g.material),g.showDomeSurfaces=A.getValueOrDefault(p._showDomeSurfaces,e,!0),g.showDomeLines=A.getValueOrDefault(p._showDomeLines,e,!0),g.showIntersection=A.getValueOrDefault(p._showIntersection,e,!0),g.intersectionColor=A.getValueOrDefault(p._intersectionColor,e,w.WHITE),g.intersectionWidth=A.getValueOrDefault(p._intersectionWidth,e,1),g.showThroughEllipsoid=A.getValueOrDefault(p._showThroughEllipsoid,e,!0),g.scanPlaneMode=A.getValueOrDefault(p._scanPlaneMode,e),g.scanPlaneColor=A.getValueOrDefault(p._scanPlaneColor,e,w.WHITE),g.showScanPlane=A.getValueOrDefault(p._showScanPlane,e,!0),g.scanPlaneRate=A.getValueOrDefault(p._scanPlaneRate,e,1)}else P(h)&&(h.primitive.show=!1)}return!0},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){for(var e=this._entitiesToVisualize.values,t=this._hash,i=this._primitives,s=e.length-1;-1<s;s--)(0,u.removePrimitive)(e[s],t,i);return n(this)},s.prototype._onCollectionChanged=function(e,t,i,s){for(var o,a=this._entitiesToVisualize,n=this._hash,r=this._primitives,l=t.length-1;-1<l;l--)o=t[l],P(o._rectangularSensor)&&P(o._position)&&a.set(o.id,o);for(l=s.length-1;-1<l;l--)o=s[l],P(o._rectangularSensor)&&P(o._position)?a.set(o.id,o):((0,u.removePrimitive)(o,n,r),a.remove(o.id));for(l=i.length-1;-1<l;l--)o=i[l],(0,u.removePrimitive)(o,n,r),a.remove(o.id)},t.RectangularSensorVisualizer=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.removePrimitive=function(e,t,i){var s=t[e.id];if(a(s)){var o=s.primitive;try{i.remove(o)}catch(e){}o.isDestroyed&&!o.isDestroyed()&&o.destroy(),delete t[e.id]}};var s=i(0),a=(s&&{default:s}).default.defined}],s.c=a,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=2);function s(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}var o,a}),function(){Object.defineProperty(Cesium,"__esModule",{value:!0}),Cesium.ViewShed3D=void 0;var e=function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e},i={cameraPosition:null,viewPosition:null,horizontalAngle:120,verticalAngle:90,visibleAreaColor:new Cesium.Color(0,1,0),hiddenAreaColor:new Cesium.Color(1,0,0),alpha:.5,distance:100,frustum:!0};function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function o(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,o),e&&(t=t||{},this.viewer=e,this.cameraPosition=Cesium.defaultValue(t.cameraPosition,i.cameraPosition),this.viewPosition=Cesium.defaultValue(t.viewPosition,i.viewPosition),this._horizontalAngle=Cesium.defaultValue(t.horizontalAngle,i.horizontalAngle),this._verticalAngle=Cesium.defaultValue(t.verticalAngle,i.verticalAngle),this._visibleAreaColor=Cesium.defaultValue(t.visibleAreaColor,i.visibleAreaColor),this._hiddenAreaColor=Cesium.defaultValue(t.hiddenAreaColor,i.hiddenAreaColor),this._alpha=Cesium.defaultValue(t.alpha,i.alpha),this._distance=Cesium.defaultValue(t.distance,i.distance),this._frustum=Cesium.defaultValue(t.frustum,i.frustum),this.calback=t.calback)}Cesium.ViewShed3D=(e(o,[{key:"_bindMourseEvent",value:function(){var s=this,o=this.viewer,e=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);e.setInputAction(function(e){var t=Cesium.getCurrentMousePosition(o.scene,e.position);t&&(s.cameraPosition?s.cameraPosition&&!s.viewPosition&&(s.viewPosition=t,s._addToScene(),s._unbindMourseEvent(),s.calback&&s.calback()):s.cameraPosition=t)},Cesium.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(e){var t,i=Cesium.getCurrentMousePosition(o.scene,e.endPosition);!i||(t=s.cameraPosition)&&(s.frustumQuaternion=s.getFrustumQuaternion(t,i),s.distance=Number(Cesium.Cartesian3.distance(t,i).toFixed(1)))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this._handler=e}},{key:"_unbindMourseEvent",value:function(){null!=this._handler&&(this._handler.destroy(),delete this._handler)}},{key:"_addToScene",value:function(){this.frustumQuaternion=this.getFrustumQuaternion(this.cameraPosition,this.viewPosition),this._createShadowMap(this.cameraPosition,this.viewPosition),this._addPostProcess(),this.radar||this.addRadar(this.cameraPosition,this.frustumQuaternion),this.viewer.scene.primitives.add(this)}},{key:"_createShadowMap",value:function(e,t){var i=e,s=t,o=this.viewer.scene,a=new Cesium.Camera(o);a.position=i,a.direction=Cesium.Cartesian3.subtract(s,i,new Cesium.Cartesian3(0,0,0)),a.up=Cesium.Cartesian3.normalize(i,new Cesium.Cartesian3(0,0,0));var n=Number(Cesium.Cartesian3.distance(s,i).toFixed(1));this.distance=n,a.frustum=new Cesium.PerspectiveFrustum({fov:Cesium.Math.toRadians(120),aspectRatio:o.canvas.clientWidth/o.canvas.clientHeight,near:.1,far:5e3}),this.viewShadowMap=new Cesium.ShadowMap({lightCamera:a,enable:!1,isPointLight:!1,isSpotLight:!0,cascadesEnabled:!1,context:o.context,pointLightRadius:n})}},{key:"getFrustumQuaternion",value:function(e,t){var i=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),new Cesium.Cartesian3),s=Cesium.Cartesian3.normalize(e,new Cesium.Cartesian3),o=new Cesium.Camera(this.viewer.scene);o.position=e,o.direction=i,o.up=s,i=o.directionWC,s=o.upWC;var a=o.rightWC,n=new Cesium.Cartesian3,r=new Cesium.Matrix3,l=new Cesium.Quaternion,a=Cesium.Cartesian3.negate(a,n),u=r;return Cesium.Matrix3.setColumn(u,0,a,u),Cesium.Matrix3.setColumn(u,1,s,u),Cesium.Matrix3.setColumn(u,2,i,u),Cesium.Quaternion.fromRotationMatrix(u,l)}},{key:"_addPostProcess",value:function(){var e=this,t=this,i=t.viewShadowMap._isPointLight?t.viewShadowMap._pointBias:t.viewShadowMap._primitiveBias;this.postProcess=this.viewer.scene.postProcessStages.add(new Cesium.PostProcessStage({fragmentShader:"uniform float czzj;uniform float dis;uniform float spzj;uniform vec3 visibleColor;uniform vec3 disVisibleColor;uniform float mixNum;uniform sampler2D colorTexture;uniform sampler2D stcshadow;uniform sampler2D depthTexture;uniform mat4 _shadowMap_matrix;uniform vec4 shadowMap_lightPositionEC;uniform vec4 shadowMap_lightDirectionEC;uniform vec3 shadowMap_lightUp;uniform vec3 shadowMap_lightDir;uniform vec3 shadowMap_lightRight;uniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness;uniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth;varying vec2 v_textureCoordinates;vec4 toEye(in vec2 uv, in float depth){vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0)); vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);posInCamera =posInCamera / posInCamera.w;return posInCamera;}float getDepth(in vec4 depth){float z_window = czm_unpackDepth(depth); z_window = czm_reverseLogDepth(z_window);float n_range = czm_depthRange.near;float f_range = czm_depthRange.far;return (2.0 * z_window - n_range - f_range) / (f_range - n_range);}float _czm_sampleShadowMap(sampler2D shadowMap, vec2 uv){return texture2D(shadowMap, uv).r;}float _czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth){ return step(depth, _czm_sampleShadowMap(shadowMap, uv));}float _czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters){float depthBias = shadowParameters.depthBias;float depth = shadowParameters.depth;float nDotL = shadowParameters.nDotL;float normalShadingSmooth = shadowParameters.normalShadingSmooth;float darkness = shadowParameters.darkness;vec2 uv = shadowParameters.texCoords;depth -= depthBias;vec2 texelStepSize = shadowParameters.texelStepSize;float radius = 1.0;float dx0 = -texelStepSize.x * radius;float dy0 = -texelStepSize.y * radius;float dx1 = texelStepSize.x * radius;float dy1 = texelStepSize.y * radius;float visibility =(_czm_shadowDepthCompare(shadowMap, uv, depth) +_czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) + _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +_czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +_czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth) ) * (1.0 / 9.0) ; return visibility;}vec3 pointProjectOnPlane(in vec3 planeNormal, in vec3 planeOrigin, in vec3 point){vec3 v01 = point -planeOrigin;float d = dot(planeNormal, v01);return (point - planeNormal * d);}float ptm(vec3 pt){return sqrt(pt.x*pt.x + pt.y*pt.y + pt.z*pt.z);}void main(){const float PI = 3.141592653589793;vec4 color = texture2D(colorTexture, v_textureCoordinates);vec4 currD = texture2D(depthTexture, v_textureCoordinates);if(currD.r>=1.0){gl_FragColor = color;return;}float depth = getDepth(currD);vec4 positionEC = toEye(v_textureCoordinates, depth);vec3 normalEC = vec3(1.0);czm_shadowParameters shadowParameters;shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy;shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z;shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w;shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w;shadowParameters.depthBias *= max(depth * 0.01, 1.0);vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz);float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0);vec4 shadowPosition = _shadowMap_matrix * positionEC;shadowPosition /= shadowPosition.w;if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))){gl_FragColor = color;return;}vec4 lw = czm_inverseView*  vec4(shadowMap_lightPositionEC.xyz, 1.0);vec4 vw = czm_inverseView* vec4(positionEC.xyz, 1.0);if(distance(lw.xyz,vw.xyz)>dis){gl_FragColor = color;return;}vec3 ptOnSP = pointProjectOnPlane(shadowMap_lightUp,lw.xyz,vw.xyz);directionEC = ptOnSP - lw.xyz;float directionECMO = ptm(directionEC.xyz);float shadowMap_lightDirMO = ptm(shadowMap_lightDir.xyz);float cosJJ = dot(directionEC,shadowMap_lightDir)/(directionECMO*shadowMap_lightDirMO);float degJJ = acos(cosJJ)*(180.0 / PI);degJJ = abs(degJJ);if(degJJ>spzj/2.0){gl_FragColor = color;return;}vec3 ptOnCZ = pointProjectOnPlane(shadowMap_lightRight,lw.xyz,vw.xyz);vec3 dirOnCZ = ptOnCZ - lw.xyz;float dirOnCZMO = ptm(dirOnCZ);float cosJJCZ = dot(dirOnCZ,shadowMap_lightDir)/(dirOnCZMO*shadowMap_lightDirMO);float degJJCZ = acos(cosJJCZ)*(180.0 / PI);degJJCZ = abs(degJJCZ);if(degJJCZ>czzj/2.0){gl_FragColor = color;return;}shadowParameters.texCoords = shadowPosition.xy;shadowParameters.depth = shadowPosition.z;shadowParameters.nDotL = nDotL;float visibility = _czm_shadowVisibility(stcshadow, shadowParameters);if(visibility==1.0){gl_FragColor = mix(color,vec4(visibleColor,1.0),mixNum);}else{if(abs(shadowPosition.z-0.0)<0.01){return;}gl_FragColor = mix(color,vec4(disVisibleColor,1.0),mixNum);}}",uniforms:{czzj:function(){return e.verticalAngle},dis:function(){return e.distance},spzj:function(){return e.horizontalAngle},visibleColor:function(){return e.visibleAreaColor},disVisibleColor:function(){return e.hiddenAreaColor},mixNum:function(){return e.alpha},stcshadow:function(){return t.viewShadowMap._shadowMapTexture},_shadowMap_matrix:function(){return t.viewShadowMap._shadowMapMatrix},shadowMap_lightPositionEC:function(){return t.viewShadowMap._lightPositionEC},shadowMap_lightDirectionEC:function(){return t.viewShadowMap._lightDirectionEC},shadowMap_lightUp:function(){return t.viewShadowMap._lightCamera.up},shadowMap_lightDir:function(){return t.viewShadowMap._lightCamera.direction},shadowMap_lightRight:function(){return t.viewShadowMap._lightCamera.right},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var e=new Cesium.Cartesian2;return e.x=1/t.viewShadowMap._textureSize.x,e.y=1/t.viewShadowMap._textureSize.y,Cesium.Cartesian4.fromElements(e.x,e.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return Cesium.Cartesian4.fromElements(i.normalOffsetScale,t.viewShadowMap._distance,t.viewShadowMap.maximumDistance,t.viewShadowMap._darkness,this.combinedUniforms2)}}}))}},{key:"removeRadar",value:function(){this.viewer.entities.remove(this.radar)}},{key:"resetRadar",value:function(){this.removeRadar(),this.addRadar(this.cameraPosition,this.frustumQuaternion)}},{key:"addRadar",value:function(e,t){this.radar=this.viewer.entities.add({position:e,orientation:t,rectangularSensor:new Cesium.RectangularSensorGraphics({radius:this.distance,xHalfAngle:Cesium.Math.toRadians(this.horizontalAngle/2),yHalfAngle:Cesium.Math.toRadians(this.verticalAngle/2),material:new Cesium.Color(0,1,1,.4),lineColor:new Cesium.Color(1,1,1,1),slice:8,showScanPlane:!1,scanPlaneColor:new Cesium.Color(0,1,1,1),scanPlaneMode:"vertical",scanPlaneRate:3,showThroughEllipsoid:!1,showLateralSurfaces:!1,showDomeSurfaces:!1})})}},{key:"update",value:function(e){this.viewShadowMap&&e.shadowMaps.push(this.viewShadowMap)}},{key:"destroy",value:function(){this.viewer&&this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer&&this.viewer.entities.remove(this.radar),delete this.radar,delete this.postProcess,delete this.viewShadowMap,delete this.verticalAngle,delete this.viewer,delete this.horizontalAngle,delete this.visibleAreaColor,delete this.hiddenAreaColor,delete this.distance,delete this.frustumQuaternion,delete this.cameraPosition,delete this.viewPosition,delete this.alpha}},{key:"horizontalAngle",get:function(){return this._horizontalAngle},set:function(e){this._horizontalAngle=e,this.resetRadar()}},{key:"verticalAngle",get:function(){return this._verticalAngle},set:function(e){this._verticalAngle=e,this.resetRadar()}},{key:"distance",get:function(){return this._distance},set:function(e){this._distance=e,this.resetRadar()}},{key:"visibleAreaColor",get:function(){return this._visibleAreaColor},set:function(e){this._visibleAreaColor=e}},{key:"hiddenAreaColor",get:function(){return this._hiddenAreaColor},set:function(e){this._hiddenAreaColor=e}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=e}}]),o)}(),Cesium.getCurrentMousePosition=function(e,t,i){var s,o=e.pick(t);if(e.pickPositionSupported&&Cesium.defined(o)&&function(e,t){if(Cesium.defined(e.id)){var i=e.id;if(i._noMousePosition)return;if(t&&i==t)return}if(Cesium.defined(e.primitive)){var s=e.primitive;if(s._noMousePosition)return;if(t&&s==t)return}return 1}(o,i)){var a=e.pickPosition(t);if(Cesium.defined(a)){var n=Cesium.Cartographic.fromCartesian(a).height;if(0<=n)return a;if(!Cesium.defined(o.id)&&-500<=n)return a}}return a=e.mode===Cesium.SceneMode.SCENE3D?(s=e.camera.getPickRay(t),e.globe.pick(s,e)):e.camera.pickEllipsoid(t,e.globe.ellipsoid)};var CgsIds=0;Cesium.Camera.DEFAULT_VIEW_RECTANGLE=Cesium.Rectangle.fromDegrees(70,-10,140,60),CgsMap3D=function(e){var t={animation:!1,baseLayerPicker:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,timeline:!1,shouldAnimate:void 0===e.shouldAnimate||e.shouldAnimate,requestRenderMode:void 0!==e.requestRenderMode&&e.requestRenderMode,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,creditContainer:document.createElement("div"),imageryProvider:new Cesium.TileMapServiceImageryProvider({url:Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII/"),maximumLevel:1,credit:"Imagery courtesy Natural Earth"}),orderIndependentTranslucency:void 0===e.orderIndependentTranslucency,contextOptions:{webgl:{alpha:null!=e.webglAlpha}}};Cesium.Viewer.call(this,e.target,t),this.imageryLayers.removeAll(!0),this.scene.globe.depthTestAgainstTerrain=!1,this.scene.globe.showGroundAtmosphere=!1,this.scene.fog.enabled=!1,this.plotScale=null,this.plotScaleFlag=!1,this.navigation=null,this.navigationFlag=!1,this.compass=null,this.compassFlag=!1,this.viewInfo=null,this.viewInfoFlag=!1,this.aerialView=null,this.aerialViewFlag=!1,this.zoomRate=.067,this.localZoom=void 0,this.leftRotateActive=!1,this.rightRotateActive=!1,this.rotateClock=void 0,this.minHeight=10,this.propertyPlugg=void 0,this.modelPlugg=void 0,this.layerPlugg=void 0,this.scene.morphTo3D(0),this.overlays=[],this.featureGroups=[],this.allLayers=[],this.allFeatures=[],this.wmsLayerInfos=[],this.wmsLayers=[],this.wfsLayers=[],this.locked=!1,this.timerObj=[],this._thingCache={},this.starrySky,this.flatCloud=void 0,this.scene.skyBox.show=!1,this.isIconVisible=!0,this.drawFeatureGroup=new CgsFeatureGroup3D("drawFeature"),this.manipulate=void 0,this.handleEvent_(),this.camera.constrainedAxis=void 0,this.camInitInfo={position:this.camera.positionCartographic,heading:Cesium.Math.toDegrees(this.camera.heading),pitch:Cesium.Math.toDegrees(this.camera.pitch),roll:Cesium.Math.toDegrees(this.camera.roll)},this.urlPath=CGS_SDK_PATH,this.isAddToolbar&&(this.toolbar=new CgsToolBar3D(this)),this.pickedRadar=void 0,this.pickedRadarColor=void 0,this.hitTolerance=1,this.hitToleranceWidth=2*this.hitTolerance+1,this.hitToleranceHeight=2*this.hitTolerance+1,CgsFeatureEvent3D._setEvent(),this.blankFlag=!0,this.multiViewLocked=[]},CgsInherits(CgsMap3D,Cesium.Viewer),CgsMap3D.prototype.addThing=function(e){return e&&e._onAdd&&(e._onAdd(this),this._thingCache[e.id]=e),this},CgsMap3D.prototype.addLayer=function(e,t){e.getMap()&&e.getMap()!=this&&e.getMap().removeLayer(e),this.allLayers.push(e);var i=this.imageryLayers;if(null!=e.state&&"WMS"==e.state.type){var s=!1;e.setMap(this);for(var o,a,n,r=0;r<this.wmsLayerInfos.length;r++)if(e.state.url==this.wmsLayerInfos[r].layerOpt.url){this.wmsLayerInfos[r].wmsLayers.push(e),e.state.wmsLayerInfo=this.wmsLayerInfos[r],null!=e.state.visible&&!e.state.visible||(""==this.wmsLayerInfos[r].layerOpt.layers?this.wmsLayerInfos[r].layerOpt.layers=e.state.layers:(this.wmsLayerInfos[r].index=i.indexOf(this.wmsLayerInfos[r].wmslayer),i.remove(this.wmsLayerInfos[r].wmslayer),this.wmsLayerInfos[r].layerOpt.layers=e.state.layers+","+this.wmsLayerInfos[r].layerOpt.layers),n=new CgsWebMapLayer3D_(this.wmsLayerInfos[r].layerOpt,e),this.wmsLayerInfos[r].wmslayer=n,i.add(n,this.wmsLayerInfos[r].index),n.setMap(this)),s=!0;break}s||(o=i.length,a={layerOpt:{format:e.state.format,enablePickFeatures:e.state.enablePickFeatures,projection:e.state.projection,url:e.state.url,proxy:e.state.proxy,version:e.state.version,level:e.state.level,rectangle:e.state.rectangle,layers:"",name:e.state.name,text:e.state.text,isAddToLayerTree:e.state.isAddToLayerTree},wmslayer:null,index:o,wmsLayers:[e]},this.wmsLayerInfos.push(a),e.state.wmsLayerInfo=a,n=new CgsWebMapLayer3D_(e.state,e),i.add(n),n.setMap(this),a.wmslayer=n,null==e.state.visible||e.state.visible?a.layerOpt.layers=e.state.layers:n.setVisible(!1))}else{"WFS"==e.state.type?this.wfsLayers.push(e):"Graticule"==e.state.type?e.activate():(this.getLayers().length<=t?i.add(e):i.add(e,t),e.setMap(this))}CgsSubPub.publish("layerAdded",[this,e]),e._setEvents&&e._setEvents()},CgsMap3D.prototype.removeLayer=function(e){if(e){if(-1!=this.allLayers.indexOf(e)){this.allLayers.splice(this.allLayers.indexOf(e),1);var t,i=this.imageryLayers;if(e.state&&"WMS"==e.state.type){e.setMap(null);for(var s=0;s<this.wmsLayerInfos.length;s++)if(e.state.url==this.wmsLayerInfos[s].layerOpt.url&&CgsUtil.isIncluded(e,this.wmsLayerInfos[s].wmsLayers)){var o=this.wmsLayerInfos[s].wmsLayers.indexOf(e);if(this.wmsLayerInfos[s].wmsLayers.splice(o,1),0==this.wmsLayerInfos[s].layerOpt.layers.indexOf(e.state.layers)?this.wmsLayerInfos[s].layerOpt.layers=this.wmsLayerInfos[s].layerOpt.layers.replace(e.state.layers,""):this.wmsLayerInfos[s].layerOpt.layers=this.wmsLayerInfos[s].layerOpt.layers.replace(","+e.state.layers,""),this.wmsLayerInfos[s].index=i.indexOf(this.wmsLayerInfos[s].wmslayer),i.remove(this.wmsLayerInfos[s].wmslayer),""!=this.wmsLayerInfos[s].layerOpt.layers){var a=new CgsWebMapLayer3D_(this.wmsLayerInfos[s].layerOpt,e);this.wmsLayerInfos[s].wmslayer=a,i.add(a,this.wmsLayerInfos[s].index),a.setMap(this);break}this.wmsLayerInfos.splice(s,1)}}else if("WFS"==e.state.type)for(var n=this.wfsLayers.length,r=this.scene,s=0;s<n;++s){var l=this.wfsLayers[s];if(e.state.url==l.state.url&&e.state.name==l.state.name&&r.primitives.contains(l._placeMark)){r.primitives.remove(l._placeMark),this.wfsLayers.splice(s,1);break}}else{"Graticule"==e.state.type?e.deactivate():(isNaN(e)||(e=i.get(e)),i.remove(e,!1),e.setMap(null),(t=e.getGroup())&&t.removeLayer(e))}CgsSubPub.publish("layerRemoved",[this,e]),e._unsetEvents&&e._unsetEvents()}}else console.warn("layer isn't exist!")},CgsMap3D.prototype.raiseLayer=function(e){if(e.state.map){var t=this.getLayers(),i=t.indexOf(e);if(i<t.length){var s=t[i+1];if(t[i+1]=t[i],t[i]=s,e instanceof CgsWebMapLayer3D){var o=e.state.wmsLayerInfo,a=o.wmsLayers.indexOf(e);o.wmsLayers.length;if(0==a)(t[i]instanceof CgsWebMapLayer3D&&t[i].state.url!=e.state.url&&0==t[i].state.wmsLayerInfo.wmsLayers.indexOf(t[i])||t[i]instanceof CgsTileLayer3D||t[i]instanceof CgsImageLayer3D)&&this.imageryLayers.raise(o.wmslayer);else if(!(t[i]instanceof CgsWebMapLayer3D&&t[i].state.url!=e.state.url||t[i]instanceof CgsTileLayer3D||t[i]instanceof CgsImageLayer3D)){(s=o.wmsLayers[a+1])&&(o.wmsLayers[a+1]=o.wmsLayers[a],o.wmsLayers[a]=s),this.imageryLayers.remove(o.wmslayer),o.layerOpt.layers="";for(var n=0;n<o.wmsLayers.length;n++)o.wmsLayers[n].state.visible&&(o.layerOpt.layers=0!=n?o.wmsLayers[n].state.layers+","+o.layerOpt.layers:o.wmsLayers[n].state.layers);var r=new CgsWebMapLayer3D_(o.layerOpt,e);o.wmslayer=r,this.imageryLayers.add(r,o.index)}}else(e instanceof CgsTileLayer3D||e instanceof CgsImageLayer3D)&&(t[i]instanceof CgsWebMapLayer3D&&0==t[i].state.wmsLayerInfo.wmsLayers.indexOf(t[i])||t[i]instanceof CgsTileLayer3D||t[i]instanceof CgsImageLayer3D)&&this.imageryLayers.raise(e)}}},CgsMap3D.prototype.lowerLayer=function(e){if(e.state.map){var t=this.getLayers(),i=t.indexOf(e);if(0<i){var s=t[i-1];if(t[i-1]=t[i],t[i]=s,e instanceof CgsWebMapLayer3D){var o=e.state.wmsLayerInfo,a=o.wmsLayers.indexOf(e);if(0==a)(t[i]instanceof CgsWebMapLayer3D&&t[i].state.url!=e.state.url&&0==t[i].state.wmsLayerInfo.wmsLayers.indexOf(t[i])||t[i]instanceof CgsTileLayer3D||t[i]instanceof CgsImageLayer3D)&&this.imageryLayers.lower(o.wmslayer);else if(!(t[i]instanceof CgsWebMapLayer3D&&t[i].state.url!=e.state.url||t[i]instanceof CgsTileLayer3D||t[i]instanceof CgsImageLayer3D)){s=o.wmsLayers[a-1],o.wmsLayers[a-1]=o.wmsLayers[a],o.wmsLayers[a]=s,this.imageryLayers.remove(o.wmslayer),o.layerOpt.layers="";for(var n=0;n<o.wmsLayers.length;n++)o.wmsLayers[n].state.visible&&(o.layerOpt.layers=0!=n?o.wmsLayers[n].state.layers+","+o.layerOpt.layers:o.wmsLayers[n].state.layers);var r=new CgsWebMapLayer3D_(o.layerOpt,e);o.wmslayer=r,this.imageryLayers.add(r,o.index)}}else(e instanceof CgsTileLayer3D||e instanceof CgsImageLayer3D)&&(t[i]instanceof CgsWebMapLayer3D&&0==t[i].state.wmsLayerInfo.wmsLayers.indexOf(t[i])||t[i]instanceof CgsTileLayer3D||t[i]instanceof CgsImageLayer3D)&&this.imageryLayers.lower(e)}}},CgsMap3D.prototype.addFeature=function(p){if(p instanceof CgsRadar3D&&p._setEvents(),p instanceof CgsMark3DCollection)return p.setMap(this),void this.scene.primitives.add(p.collection);var e,t,i,h,s;if("overlay"==p.getType())p.setMap(this),!this.isMultiViewsMode||!this.twoViewsMode&&!this.pip||p.parentOverlay||p.parent||((e=p.options).element=$$(e.element).clone()[0],((t=new CgsOverlay3D(e)).parent=p).clones.push(t),this.addFeature(t));else if("popup"==p.getType())p.setMap(this);else if("flyline"==p.type){for(var o=0;o<p.entities.length;o++)this.entities.add(p.entities[o]);p.setElement(p),p.start()}else{"LineAnimation"==p.getType()?(this.entities.add(p.getEntity()),p.label&&this.entities.add(p.label.getEntity()),p.startAnimation()):"rectangle"==p.getType()?(p.setMap(this),p._mountedHook(),this.entities.add(p.getEntity())):"lightCone"==p.getType()||"ScrollWall"==p.getType()||"Pit"==p.getType()||"diffuseWall"==p.getType()||"PolylinePrimitive"==p.getType()?this.scene._primitives.add(p.primitiveCollection):"water"==p.getType()?(p.setMap(this),p._addedHook(),this.scene._primitives.add(p.primitiveCollection)):"EchartsLayer"==p.getType()||"threeLayer"==p.getType()?(p.setMap(this),p.mountedHook()):"dynamicRiver"==p.getType()||"road"==p.getType()?(p.setMap(this),this.scene._primitives.add(p.primitiveCollection)):p.getType()==CgsSlope3D.SLOPE||p.getType()==CgsRibbon3D.RIBBON?(s=this.scene,Cesium.defined(s)&&(s.primitives.add(p.getPrimitive()),p.setMap(this))):p.getType()==CgsRadar3D.GROUND_RADAR?((i=this.entities).add(p.getPrimitive()),p.setMap(this)):p.getType()==CgsRadar3D.PHASEARRAY_RADAR?(i=this.entities,p._primitive&&(i.add(p._primitive),p.setMap(this))):p instanceof CgsRadar3D?(s=this.scene,Cesium.defined(s)&&(p.setElement(p),p.setMap(this),s.primitives.contains(p.getPrimitive())||s.primitives.add(p.getPrimitive()))):p.getType()==CgsSpreadEffect3D.EFFECT_TYPE?(s=this.scene,Cesium.defined(s)&&(s.primitives.add(p.getPrimitive()),p.setMap(this))):p.getType()==CgsParticleCollection3D.EXPLODE||p.getType()==CgsParticleCollection3D.FIREWORKS||p.getType()==CgsParticleCollection3D.TAIL_FIRE?(s=this.scene,Cesium.defined(s)&&(s.primitives.add(p.getParticleCollection()),p.setMap(this))):p.getType()==CgsWideLine3D.WideLine?(s=this.scene,Cesium.defined(s)&&!s.primitives.contains(p.getWideLine())&&(s.primitives.add(p.getWideLine()),p.setMap(this))):p.getType()==Cgs3DTileset3D.Tileset?(s=this.scene,h=this,Cesium.defined(s)&&(p._setEvents(),s.primitives.add(p.getTileset()).readyPromise.then(function(e){var t=e.boundingSphere,i=Cesium.Cartographic.fromCartesian(t.center),s=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),a=i.height;p.setPosition([s,o,a]);var n,r=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,0),l=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,p.getOffsetHeight()),u=Cesium.Cartesian3.subtract(l,r,new Cesium.Cartesian3);e.modelMatrix=Cesium.Matrix4.fromTranslation(u),p.getLocateFlag()&&(n=Math.max(100-t.radius,0),h.camera.viewBoundingSphere(t,new Cesium.HeadingPitchRange(0,-2,n)),h.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)),p.setSuccessFlag(!0),p.setHeightColor(p.getHeightColor()),CgsSubPub.publish("3dTileLoadSuccess",[p])}).otherwise(function(e){throw e}),p.setMap(this))):p instanceof CgsStream3D?(s=this.scene,Cesium.defined(s)&&(s.primitives.add(p.getStream()),p.setMap(this))):p instanceof CgsWindLayer3D?(s=this.scene,Cesium.defined(s)&&(p.setMap(this),s.primitives.add(p.primitives))):p instanceof CgsCanvasWindLayer3D?(s=this.scene,Cesium.defined(s)&&p.setMap(this)):p instanceof CgsPrecipitation3D?(s=this.scene,Cesium.defined(s)&&(s.primitives.add(p.getPrecipitation()),p.setMap(this))):p.getType()==CgsStreamLine3D.StreamLine?(s=this.scene,Cesium.defined(s)&&(s.primitives.add(p.getStreamLine()),p.setMap(this))):p.getType()==CgsGlowFlyLine3D.GlowFlyLine?(s=this.scene,Cesium.defined(s)&&(s.primitives.add(p.getFlyLine()),p.setMap(this))):p.getType()==CgsFlightLine3D.FlightLine?(s=this.scene,Cesium.defined(s)&&(s.primitives.add(p.getPrimitive()),p.setMap(this))):(this.entities.add(p.getEntity()),p.label&&this.entities.add(p.label.getEntity()),p.setMap(this),p.setElement&&p.setElement(p))}this.allFeatures.push(p),CgsSubPub.publish("featureAdded",[this,p])},CgsMap3D.prototype.removeFeature=function(e){if(e){if(e instanceof CgsRadar3D&&e._unsetEvents(),e instanceof CgsMark3DCollection)return e.collection.destroy(),void e.setMap(void 0);if("overlay"===e.getType()){var t=this.overlays.length;for(a=0;a<t&&this.overlays[a]!=e;a++);this.overlays[a]==e&&(e.remove(),e.setMap(void 0))}else if("lightCone"===e.getType()||"ScrollWall"===e.getType()||"Pit"===e.getType()||"water"===e.getType()||"dynamicRiver"===e.getType()||"road"===e.getType()){var i=this.scene;Cesium.defined(i)&&(i.primitives.remove(e.primitiveCollection),e.setMap(void 0))}else if("diffuseWall"===e.getType()){i=this.scene;Cesium.defined(i)&&(e.primitiveCollection.remove(e._primitive),e.setMap(void 0))}else if("PolylinePrimitive"==e.getType())this.scene.primitives.remove(e.primitiveCollection);else if("EchartsLayer"===e.getType()||"threeLayer"===e.getType())e.destory();else if(e.getType()==CgsSlope3D.SLOPE){i=this.scene;Cesium.defined(i)&&(i.primitives.remove(e.getPrimitive()),e.setMap(void 0))}else if(e.getType()==CgsRibbon3D.RIBBON){i=this.scene;Cesium.defined(i)&&(i.primitives.remove(e.getPrimitive()),e.setMap(void 0))}else if(e.getType()==CgsRadar3D.GROUND_RADAR){e.stop(),(o=this.entities).remove(e.getPrimitive()),e.setMap(void 0),this.pickedRadar&&this.pickedRadar==e&&(this.pickedRadar=void 0)}else if(e.getType()==CgsRadar3D.PHASEARRAY_RADAR){(o=this.entities).remove(e._primitive),e.setMap(void 0),this.pickedRadar&&this.pickedRadar==e&&(this.pickedRadar=void 0)}else if(e instanceof CgsRadar3D){i=this.scene;Cesium.defined(i)&&i.primitives.contains(e.getPrimitive())&&(i.primitives.remove(e.getPrimitive()),e.setPrimitive(void 0),e.setMap(void 0)),this.pickedRadar&&this.pickedRadar==e&&(this.pickedRadar=void 0)}else if(e.getType()==CgsSpreadEffect3D.EFFECT_TYPE){i=this.scene;Cesium.defined(i)&&i.primitives.contains(e.getPrimitive())&&(i.primitives.remove(e.getPrimitive()),e.setMap(void 0))}else if(e.getType()==CgsWideLine3D.WideLine){i=this.scene;Cesium.defined(i)&&i.primitives.contains(e.getWideLine())&&(i.primitives.remove(e.getWideLine()),e.setWideLine(void 0),e.setMap(void 0))}else if("flyline"==e.type){clearInterval(e.timer);for(var s=e.entities,o=this.entities,a=0;a<s.length;a++)o.remove(s[a])}else if(e.getType()==CgsParticleCollection3D.EXPLODE||e.getType()==CgsParticleCollection3D.FIREWORKS||e.getType()==CgsParticleCollection3D.TAIL_FIRE){i=this.scene;Cesium.defined(i)&&i.primitives.contains(e.getParticleCollection())&&(i.primitives.remove(e.getParticleCollection()),e.setMap(void 0))}else if(e.getType()==Cgs3DTileset3D.Tileset){i=this.scene;Cesium.defined(i)&&Cesium.defined(i)&&i.primitives.contains(e.getTileset())&&(i.primitives.remove(e.getTileset()),e.setMap(void 0),e._unsetEvents())}else if(e instanceof CgsStream3D){(i=this.scene).frameState.context.uniformState.enableWindBackGround=!1,e.setVisible(!1),Cesium.defined(i)&&i.primitives.contains(e.getStream())&&(i.primitives.remove(e.getStream()),e.setMap(void 0))}else if(e instanceof CgsWindLayer3D){i=this.scene;Cesium.defined(i)&&e.destroy()}else if(e instanceof CgsCanvasWindLayer3D){i=this.scene;Cesium.defined(i)&&e.destroy()}else if(e instanceof CgsPrecipitation3D){i=this.scene;Cesium.defined(i)&&i.primitives.contains(e.getPrecipitation())&&(i.primitives.remove(e.getPrecipitation()),e.setMap(void 0))}else if(e.getType()==CgsStreamLine3D.StreamLine){i=this.scene;Cesium.defined(i)&&i.primitives.contains(e.getStreamLine())&&(i.primitives.remove(e.getStreamLine()),e.setMap(void 0))}else if(e.getType()==CgsGlowFlyLine3D.GlowFlyLine){i=this.scene;Cesium.defined(i)&&i.primitives.contains(e.getFlyLine())&&(i.primitives.remove(e.getFlyLine()),e.setMap(void 0))}else if(e.getType()==CgsFlightLine3D.FlightLine){i=this.scene;Cesium.defined(i)&&i.primitives.contains(e.getPrimitive())&&(i.primitives.remove(e.getPrimitive()),e.setMap(void 0))}else{var o=this.entities,n=e.entity;if(o.contains(n))o.remove(n),e.label&&o.remove(e.label.getEntity());else for(var r,l=this.dataSources._dataSources,a=0;a<l.length;a++){"clusterData"===l[a].name&&l[a].entities.contains(n)&&(l[a].entities.remove(n),r=e.label.entity,e.label&&l[a].entities.contains(r)&&l[a].entities.remove(r))}"LineAnimation"==e.getType()&&e.close(),e.timer&&clearInterval(e.timer);var u=e.getGroup();u&&u.removeFeature(e),e.setMap(null)}-1!=this.allFeatures.indexOf(e)&&this.allFeatures.splice(this.allFeatures.indexOf(e),1),CgsSubPub.publish("featureRemoved",[this,e])}else console.warn("feature isn't exist!")},CgsMap3D.prototype.removeOverlay=function(e){e.parentOverlay&&this.owner?this.owner.removeOverlay(e.parentOverlay):(this.removeFeature(e),console.error("overlay异常，父元素不存在！"))},CgsMap3D.prototype.removeAllMeasureFeature=function(){this.removeFeatureGroup(this.drawFeatureGroup),CgsSubPub.publish("featureMeasureRemoved",[this,this.drawFeatureGroup])},CgsMap3D.prototype.removeAllFeatureByMouse=function(){this.removeFeatureGroup(this.drawFeatureGroup),CgsSubPub.publish("featureByMouseRemoved",[this,this.drawFeatureGroup])},CgsMap3D.prototype.addFeatureGroup=function(e){if(e instanceof CgsFeatureGroup3D){for(var t=e.getFeatures(),i=t.length,s=0;s<i;s++)this.addFeature(t[s]);e.map!=this&&this.featureGroups.push(e),e.map=this}else console.error("parameter is not belong to CgsFeatureGroup3D")},CgsMap3D.prototype.removeFeatureGroup=function(e){if(e instanceof CgsFeatureGroup3D){for(var t=e.getFeatures(),i=t.length,s=0;s<i;s++)this.removeFeature(t[i-s-1]);this.featureGroups.splice(this.featureGroups.indexOf(e),1),e.map=null}},CgsMap3D.prototype.removeAllFeatures=function(){for(var e=this.getAllFeatures(),t=e.length-1;0<=t;t--)this.removeFeature(e[t]);this.scene.primitives.removeAll()},CgsMap3D.prototype.getAllFeatures=function(){return this.allFeatures},CgsMap3D.prototype.getFeatureById=function(e){for(var t=this.getAllFeatures(),i=t.length,s=0;s<i;s++)if(t[s].getId()==e)return t[s]},CgsMap3D.prototype.getAllDataSources=function(){return this.dataSources._dataSources},CgsMap3D.prototype.getLayerIndexByText=function(e){for(var t=this.getLayers(),i=t.length,s=0;s<i;s++)if(e==t[s].getText())return s;return null},CgsMap3D.prototype.getLayers=function(){return this.allLayers},CgsMap3D.prototype.getLayerByIndex=function(e){return layers=this.imageryLayers,layers.get(e)},CgsMap3D.prototype.getLayerById=function(e){for(var t=this.imageryLayers,i=t.length,s=null,o=0;o<i;o++)if(e==t.get(o).getId())return s=t.get(o);for(o=0;o<this.wmsLayerInfos.length;o++)for(var a=0;a<this.wmsLayerInfos[o].wmsLayers.length;a++){var n=this.wmsLayerInfos[o].wmsLayers[a];if(e==n.getId())return s=n}return s},CgsMap3D.prototype.getLayerByName=function(e){for(var t=this.imageryLayers,i=t.length,s=null,o=0;o<i;o++)if(e==t.get(o).getName())return s=t.get(o);return s},CgsMap3D.prototype.pixelToLonLat=function(e){e=new Cesium.Cartesian2(e[0],e[1]);var t=this.scene._camera0.pickEllipsoid(e,this.scene.globe.ellipsoid);if(t){var i=Cesium.Cartographic.fromCartesian(t);return[Cesium.Math.toDegrees(i.longitude),Cesium.Math.toDegrees(i.latitude)]}},CgsMap3D.prototype.lonLatToPixel=function(e){var t=Cesium.Cartographic.fromDegrees(e[0],e[1],e[2]),i=this.scene.globe.ellipsoid.cartographicToCartesian(t),s=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.scene,i);if(s.x&&s.y)return[s.x,s.y]},CgsMap3D.prototype.setSkyAtmosphereVisible=function(e){null!=this.scene.skyAtmosphere&&(this.scene.skyAtmosphere.show=e)},CgsMap3D.prototype.getSkyAtmosphereVisible=function(){return!!this.scene.skyAtmosphere&&this.scene.skyAtmosphere.show},CgsMap3D.prototype.setLightingVisible=function(e){this.scene.globe.enableLighting=e},CgsMap3D.prototype.getLightingVisible=function(){return this.scene.globe.enableLighting},CgsMap3D.prototype.setFogVisible=function(e){this.scene.fog.enabled=e},CgsMap3D.prototype.getFogVisible=function(){return this.scene.fog.enabled},CgsMap3D.prototype.getDataSourceByName=function(e){for(var t=0;t<this.dataSources._dataSources.length;t++)if(this.dataSources._dataSources[t]._name==e)return this.dataSources._dataSources[t]},CgsMap3D.prototype.addDataSource=function(e){(e.map=this).dataSources.add(e),CgsSubPub.publish("loaddatasuccess",[this,e])},CgsMap3D.prototype.removeDataSource=function(e){var t=this.dataSources.indexOf(e);if(0<=t&&(this.dataSources._dataSources[t].map=null),e.eventDispose&&e.eventDispose(),this.dataSources.remove(e,!0),CgsSubPub.publish("removedatasuccess",[this]),e.editFeatures&&0<e.editFeatures.length){for(var i=0;i<e.editFeatures.length;i++)this.owner.removeFeature(e.editFeatures[i]);e.editFeatures=[]}},CgsMap3D.prototype.removeAllDataSource=function(){for(var e=0;e<this.dataSources._dataSources.length;e++)this.dataSources._dataSources[e].map=null;this.dataSources.removeAll(),CgsSubPub.publish("removealldatasuccess",[this])},CgsMap3D.prototype.setTerrain=function(e){e instanceof CgsTerrain3D||e instanceof Cesium.EllipsoidTerrainProvider||e instanceof CgsTileTerrain3D||e instanceof CgsTimeDynamicTerrain3D?(this.terrainProvider=e,this.scene.globe.depthTestAgainstTerrain=!0):console.info("the input param is not instanceof CgsTerrain3D")},CgsMap3D.prototype.getTerrain=function(){return this.terrainProvider},CgsMap3D.prototype.setDefaultTerrain=function(){var e=new Cesium.EllipsoidTerrainProvider;this.setTerrain(e),this.scene.globe.depthTestAgainstTerrain=!1},CgsMap3D.prototype.setPickColor=function(e){this.pickColor=e},CgsMap3D.prototype.getPickColor=function(){return this.pickColor},CgsMap3D.prototype.createExtentRectangle=function(e){null==e&&(e=[-180,-90,180,90]);var t,i=Cesium.Math.toRadians(e[0]),s=Cesium.Math.toRadians(e[1]),o=Cesium.Math.toRadians(e[2]),a=Cesium.Math.toRadians(e[3]);return o<i&&(t=i,i=o,o=t),a<s&&(t=s,s=a,a=t),i!=o&&s!=a||console.error("Rectangle Error: Please check the Extent!"),new Cesium.Rectangle(i,s,o,a)},CgsMap3D.prototype.localZoomIn=function(){Cesium.defined(this.localZoom)||(this.localZoom=new CgsLocalZoom(this,{})),this.localZoom.activate()},CgsMap3D.prototype.leftRotate=function(e){var t=Cesium.defaultValue(e.duration,30);0==t&&(t=30);var i,s,o=Math.PI/(25*t);this.leftRotateActive||(this.leftRotateActive=!this.leftRotateActive,this.rightRotateActive=!1,i=this.scene._camera0.direction,this.scene._camera0.constrainedAxis=i,this.rotateClock&&(clearInterval(this.rotateClock),this.rotateClock=void 0),(s=this).rotateClock=setInterval(function(){CgsSubPub.publish("move3d",[s.owner]),CgsSubPub.publish("move",[s.owner]),s.scene._camera0.rotateRight(o)},20))},CgsMap3D.prototype.rightRotate=function(e){var t=Cesium.defaultValue(e.duration,30);0==t&&(t=30);var i,s,o=Math.PI/(25*t);this.rightRotateActive||(this.rightRotateActive=!this.rightRotateActive,this.leftRotateActive=!1,i=this.scene._camera0.direction,this.scene._camera0.constrainedAxis=i,this.rotateClock&&(clearInterval(this.rotateClock),this.rotateClock=void 0),(s=this).rotateClock=setInterval(function(){CgsSubPub.publish("move3d",[s.owner]),CgsSubPub.publish("move",[s.owner]),s.scene._camera0.rotateLeft(o)},20))},CgsMap3D.prototype.cancelRotate=function(){this.rotateClock&&(clearInterval(this.rotateClock),this.rotateClock=void 0),this.scene._camera0.constrainedAxis=void 0,this.leftRotateActive=!1,this.rightRotateActive=!1},CgsMap3D.prototype.getHeight=function(){var e=this.scene._camera0.positionCartographic;if(e)return e.height},CgsMap3D.prototype.setHeight=function(e){var t=this.scene._camera0,i=(this.container,this.scene.globe.ellipsoid),s=t.positionCartographic;s.height=e;var o=i.cartographicToCartesian(s),a=t.heading,n=t.pitch,r=t.roll,l={};switch(this.scene.mode){case Cesium.SceneMode.SCENE3D:l={destination:o,orientation:{heading:a,pitch:n,roll:r},duration:0};break;case Cesium.SceneMode.SCENE2D:case Cesium.SceneMode.COLUMBUS_VIEW:l={destination:o,duration:0}}t.flyTo(l)},CgsMap3D.prototype.getZoomRate=function(){return this.zoomRate},CgsMap3D.prototype.setZoomRate=function(e){this.zoomRate=e},CgsMap3D.prototype.zoomIn=function(e){var t=this.scene._camera0;e=e||25*this.camera.defaultZoomAmount;var i=this.getHeight();i<=e&&(e=i/2)<2&&(e=0),t.zoomIn(e)},CgsMap3D.prototype.zoomOut=function(e){var t=this.scene._camera0;e=e||25*this.camera.defaultZoomAmount;var i=this.getHeight();i<=e&&(e=i),t.zoomOut(e)},CgsMap3D.prototype.getCenter=function(){var e=this.scene.globe.ellipsoid,t=this.scene._camera0,i=this.container,s=i.scrollWidth/2+i.scrollLeft,o=i.scrollHeight/2+i.scrollTop,a=new Cesium.Cartesian2(s,o),n=t.pickEllipsoid(a,e);if(n){var r=Cesium.Cartographic.fromCartesian(n);if(r)return[Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude)]}},CgsMap3D.prototype.setCenter=function(e){var t,i=this.scene.globe.ellipsoid,s=this.scene._camera0;t=2==e.length?s.positionCartographic.height:e[2];var o={destination:Cesium.Cartesian3.fromDegrees(e[0],e[1],t,i),duration:0};s.flyTo(o)},CgsMap3D.prototype.flyToPosition=function(t){var e,i,s,o=t.destination,a=t.duration,n=t.completeCallback,r=t.noFlyHigher,l=this,u=this.scene._camera0.positionCartographic,p=u.height;t.flyHeight||(4==o.length?t.flyHeight=u.height:(e=Cesium.Math.toDegrees(u.longitude),i=Cesium.Math.toDegrees(u.latitude),s=new CgsMeasure3D({mapObject:this}),t.flyHeight=4*s.distanceMeasure([[o[0],o[1]],[e,i]]),t.flyHeight<u.height&&(r=!0),null!=o[2]&&t.flyHeight<o[2]&&(r=!0),2e7<t.flyHeight&&(t.flyHeight=2e7))),r?l._flyTo(t):l._flyTo({destination:[o[0],o[1],t.flyHeight],duration:null!=a?a/2:2,completeCallback:function(){var e=[],e=2==o.length?[o[0],o[1],p]:o;l._flyTo({destination:e,duration:null!=a?a/2:2,completeCallback:n,rotation:t.rotation})}})},CgsMap3D.prototype._flyTo=function(e){for(var t=e.destination,i=e.duration,s=e.completeCallback,o=this,a=null==e.rotation||"[object Array]"!=Object.prototype.toString.call(e.rotation)||e.rotation.length<3?[0,-90,0]:e.rotation,n=[0,0,0],r=0;r<a.length;r++)n[r]=Cesium.Math.toRadians(a[r]);var l,u,p=this.scene.globe.ellipsoid,h=this.scene._camera0;4!=t.length?(l=2==t.length?h.positionCartographic.height:t[2],u={destination:Cesium.Cartesian3.fromDegrees(t[0],t[1],l,p),duration:i,complete:function(){o.owner.featuresHandleObj&&o.owner.featuresHandleObj.refresh(),s&&s()},orientation:{heading:n[0],pitch:n[1],roll:n[2]}},h.flyTo(u)):(e={destination:this.createExtentRectangle(t),duration:i},h.flyTo(e))},CgsMap3D.prototype.lookAt=function(e){var t=Cesium.Cartesian3.fromDegrees(e.target[0],e.target[1]),i=Cesium.Math.toRadians(e.heading),s=Cesium.Math.toRadians(e.pitch),o=e.range,a=new Cesium.HeadingPitchRange(i,s,o),n=this.scene._camera0;n.lookAt(t,a),n.lookAtTransform(Cesium.Matrix4.IDENTITY)},CgsMap3D.prototype.flyHome=function(e){this.manipulate&&this.manipulate.indoorRoaming&&this.manipulate.indoorRoaming.isIndoorRoaming()&&this.manipulate.indoorRoaming.leaveIndoorRoaming(),this.scene._camera0.flyHome(e);var t=this;this.updateCompassClock&&(clearInterval(this.updateCompassClock),this.updateCompassClock=void 0);var i=0;this.updateCompassClock=setInterval(function(){1<i&&(CgsSubPub.publish("compassUpDate"),t.updateCompassClock&&(clearInterval(t.updateCompassClock),t.updateCompassClock=void 0)),i++},1e3),this.rotateClock&&(clearInterval(this.rotateClock),this.rotateClock=void 0),this.leftRotateActive=!1,this.rightRotateActive=!1,this.scene._camera0.constrainedAxis=void 0},CgsMap3D.prototype.flyToNorse=function(){var e=this.scene._camera0;this.camera.flyTo({destination:e.position,duration:1})},CgsMap3D.prototype.flyBack=function(){var e=this.scene._camera0.positionCartographic.height,t=this.camInitInfo,i=Cesium.Cartographic.clone(t.position),s={destination:[Cesium.Math.toDegrees(i.longitude),Cesium.Math.toDegrees(i.latitude),e],rotation:[t.heading,t.pitch,t.roll]};this.flyTo(s)},CgsMap3D.prototype.locate=function(e){var t,i,s,o,a,n,r,l,u;Array.isArray(e)&&(t=this.scene._camera0,i=Cesium.Math.toDegrees(t.heading),s=Cesium.Math.toDegrees(t.pitch),o=Cesium.Math.toDegrees(t.roll),a=this.getHeight(),n=e[0],r=e[1],l=a,3==e.length&&(l=e[2]),u={destination:[n,r,l],rotation:[i,s,o]},this.flyTo(u))},CgsMap3D.prototype.getMinHeight=function(){return this.minHeight},CgsMap3D.prototype.setMinHeight=function(e){this.minHeight=e,this.scene.screenSpaceCameraController.minimumZoomDistance=e},CgsMap3D.prototype.getMaxHeight=function(){return this.scene._camera0.maxHeight},CgsMap3D.prototype.setMaxHeight=function(e){this.scene._camera0.maxHeight=e,this.scene.screenSpaceCameraController.maximumZoomDistance=e},CgsMap3D.prototype.setBackgroundColor=function(e){this.scene.backgroundColor=Cesium.Color.fromCssColorString(e)},CgsMap3D.prototype.getBackgroundColor=function(){return this.scene.backgroundColor},CgsMap3D.prototype.createExtentRectangle=function(e){null==e&&(e=[-180,-90,180,90]);var t,i=Cesium.Math.toRadians(e[0]),s=Cesium.Math.toRadians(e[1]),o=Cesium.Math.toRadians(e[2]),a=Cesium.Math.toRadians(e[3]);return o<i&&(t=i,i=o,o=t),a<s&&(t=s,s=a,a=t),i!=o&&s!=a||console.error("Rectangle Error: Please check the Extent!"),new Cesium.Rectangle(i,s,o,a)},CgsMap3D.prototype.lockScreen=function(e){var t=this.scene.screenSpaceCameraController;this.manipulate&&this.manipulate.indoorRoaming&&this.manipulate.indoorRoaming.isIndoorRoaming()||(t.enableInputs=!e,this.locked=e)},CgsMap3D.prototype.addPlotScale=function(){this.plotScale||(this.plotScale=new CgsPlotScale3D(this),this.plotScaleFlag=!0)},CgsMap3D.prototype.removePlotScale=function(){var e;this.plotScale&&((e=this.container)&&e.removeChild(document.getElementById("plotScaleDiv")),this.plotScale=null,this.plotScaleFlag=!1)},CgsMap3D.prototype.showPlotScale=function(){var e;!this.plotScale||(e=document.getElementById("plotScaleDiv"))&&(e.style.visibility="visible",this.plotScaleFlag=!0)},CgsMap3D.prototype.hidePlotScale=function(){var e;!this.plotScale||(e=document.getElementById("plotScaleDiv"))&&(e.style.visibility="hidden",this.plotScaleFlag=!1)},CgsMap3D.prototype.addNavigation=function(e){this.navigation||this.compass||(Cesium.defined(e)?(this.compass=new CgsSampleNavigation3D(e),this.compass.setMap(this),this.compassFlag=!0):(this.navigation=new CgsNavigation3D,this.navigation.setMap(this),this.navigationFlag=!0))},CgsMap3D.prototype.removeNavigation=function(){var e;(this.navigation||this.compass)&&(this.navigation&&((e=this.container)&&e.removeChild(document.getElementById("navigationDiv")),this.navigation=null,this.navigationFlag=!1),this.compass&&((e=this.container)&&e.removeChild(document.getElementById("navigationDiv")),this.compass=null,this.compassFlag=!1))},CgsMap3D.prototype.showNavigation=function(){(this.navigation||this.compass)&&(this.navigation&&(this.navigation.show(),this.navigationFlag=!0),this.compass&&(this.compass.show(),this.compassFlag=!0))},CgsMap3D.prototype.hideNavigation=function(){(this.navigation||this.compass)&&(this.navigation&&(this.navigation.hide(),this.navigationFlag=!1),this.compass&&(this.compass.hide(),this.compassFlag=!1))},CgsMap3D.prototype.addCompass=function(e){this.compass||this.navigation},CgsMap3D.prototype.removeCompass=function(){var e;this.compass&&((e=this.container)&&e.removeChild(document.getElementById("navigationDiv")),this.compass=null,this.compassFlag=!1)},CgsMap3D.prototype.showCompass=function(){this.compass&&(this.compass.show(),this.compassFlag=!0)},CgsMap3D.prototype.hideCompass=function(){this.compass&&(this.compass.hide(),this.compassFlag=!1)},CgsMap3D.prototype.addViewInfo=function(){this.viewInfo||this&&(this.isAddViewInfo=!0,this.viewInfo=new CgsViewInfo3D(this),this.viewInfoFlag=!0)},CgsMap3D.prototype.removeViewInfo=function(){var e;this.viewInfo&&((e=this.container)&&e.removeChild(document.getElementById("viewpointGroupDiv")),this.viewInfo=null,this.viewInfoFlag=!1)},CgsMap3D.prototype.showViewInfo=function(){this.viewInfo&&document.getElementById("viewpointGroupDiv")&&(this.isAddViewInfo=!0,this.viewInfo.show(),this.viewInfoFlag=!0)},CgsMap3D.prototype.hideViewInfo=function(){this.viewInfo&&document.getElementById("viewpointGroupDiv")&&(this.viewInfo.hide(),this.viewInfoFlag=!1)},CgsMap3D.prototype.addAerialView=function(){this.aerialView||this&&(this.aerialView=new CgsAerialView3D(this),this.aerialViewFlag=!0)},CgsMap3D.prototype.removeAerialView=function(){var e;this.aerialView&&((e=this.container)&&(e.removeChild(document.getElementById("aerialViewGroupDiv")),this.aerialView.removeAll()),this.aerialView=null,this.aerialViewFlag=!1)},CgsMap3D.prototype.showAerialView=function(){this.aerialView&&document.getElementById("aerialViewGroupDiv")&&(this.aerialView.show(),this.aerialViewFlag=!0)},CgsMap3D.prototype.hideAerialView=function(){this.aerialView&&document.getElementById("aerialViewGroupDiv")&&(this.aerialView.hide(),this.aerialViewFlag=!1)},CgsMap3D.prototype.setFlatCloudVisible=function(e){var t,i;this.flatCloud?this.flatCloud.setVisible(e):(t={show:e},this.flatCloud=new CgsFlatCloud3D(t),i=this.scene,Cesium.defined(i)&&(i.primitives.add(this.flatCloud.getFlatCloud()),this.flatCloud.setMap(this)))},CgsMap3D.prototype.getFlatCloudVisible=function(){return!!this.flatCloud&&this.flatCloud.getVisible()},CgsMap3D.prototype.setLayerBrightness=function(e){for(var t=this.imageryLayers.length,i=0;i<t;i++){var s=this.getLayerByIndex(i);s&&null==s.getMaxHeight()&&s.setBrightness(e)}},CgsMap3D.prototype.showLayerPlugg=function(){this.layerPlugg||(this.layerPlugg=new CgsLayerPlugg(this)),this.layerPlugg.activate()},CgsMap3D.prototype.hideLayerPlugg=function(){this.layerPlugg&&this.layerPlugg.deactivate()},CgsMap3D.prototype.autoRotate=function(e){var t,i=this;null==e.activate&&(e.activate=!0),e.period||(e.period=30),0!=e.activate&&0!=e.period?(t=Math.PI/(25*e.period),this.rotateTimer&&clearInterval(this.rotateTimer),i.scene._camera0.constrainedAxis=Cesium.Cartesian3.UNIT_Z,e.reverse?this.rotateTimer=setInterval(function(){i.scene._camera0.rotateRight(t)},20):this.rotateTimer=setInterval(function(){i.scene._camera0.rotateLeft(t)},20)):this.rotateTimer&&(clearInterval(this.rotateTimer),this.rotateTimer=null,i.scene._camera0.constrainedAxis=void 0)},CgsMap3D.prototype.screenToRect=function(){for(var e,t=this.container,i=t.scrollWidth,s=t.scrollHeight,o=180,a=-180,n=90,r=-90,l=[[0,0],[0,s],[i,s],[i,0]],u=0;u<4;u++){if(!(e=this.pixelToLonLat(l[u])))return;o>e[0]&&(o=e[0]),a<e[0]&&(a=e[0]),n>e[1]&&(n=e[1]),r<e[1]&&(r=e[1])}return[[o,n],[a,r]]},CgsMap3D.prototype.showPropertyPlugg=function(){this.propertyPlugg||(this.propertyPlugg=new CgsPropertyPlugg(this)),this.propertyPlugg.activate()},CgsMap3D.prototype.hidePropertyPlugg=function(){this.propertyPlugg&&this.propertyPlugg.deactivate()},CgsMap3D.prototype.showModelPlugg=function(){this.modelPlugg||(this.modelPlugg=new CgsModelPlugg(this)),this.modelPlugg.activate()},CgsMap3D.prototype.hideModelPlugg=function(){this.modelPlugg&&this.modelPlugg.deactivate()},CgsMap3D.prototype.handleEvent_=function(){var L=!(this.pickColor="rgba(255,0,255,0.5)"),x=!1,E=!1,t=null,l=void 0;this.mousePos=null,this.startPos=null,this.endPos=null,this.startMousePos=null,this.deltaPos=[],this.deltaNamePos=[],this.curMousePosition={x:0,y:0},this.enterFeature=null,this.pickFeature=null,this.lastPickObjs=[];var A=this,I=[];CgsSubPub.subscribe("toolActive",function(e,t,i){(t instanceof CgsPropertyPlugg||t instanceof CgsModelPlugg)&&(i?I.push(t):I.splice(I.indexOf(t),1))});function e(e){CgsSubPub.publish("leftdown",[e.position]);var i=!1,t=!1;if(A.getAllFeatures().forEach(function(e,t){e instanceof CgsFeature3D&&e.parentFeature&&!e.parentFeature.aboutSatellite&&(e.getSelectEnable&&e.getSelectEnable()||e.getDragEnable&&e.getDragEnable())&&(i=!0)}),0<A.dataSources.length&&(t=!0),!i&&!t&&0===I.length)return CgsSubPub.publish("clickspace",[A.pickFeature,e.position,A]),void(A.pickFeature=null);var s=A.scene.drillPick(e.position,3,A.hitToleranceWidth,A.hitToleranceHeight),o=s[p=0];if(o&&o.id)for(;"SatelliteRadar"==o.id||"SatelliteRadar2"==o.id;){if(o.primitive.owner._pickEnable)return;if(!(o=s[++p]))return}var a=!1;o&&o.primitive&&o.primitive.owner&&(a=o.primitive.owner.type===CgsOcean3D.Ocean);var n=!1;if(o&&o.primitive&&(n=o.primitive instanceof Cesium.Cesium3DTileset),!o||a||n)CgsSubPub.publish("clickspace",[A.pickFeature,e.position,A,n]),A.pickFeature=null;else{var r=o.id;if(r=r||o.primitive.id){if(r.feature){var l=[];return _.each(s,function(e){var t;e.id&&e.id.feature&&((t=e.id.feature).feature&&!t.dragEnable&&(t=t.feature),l.push(t))}),this.pickFeature=l[0],CgsSubPub.publish("featureSelected",[l[0],e.position,A,l]),r}if(r.kml)return CgsSubPub.publish("kmlfeatureSelected3d",[r,e.position,A]),r;if(CgsUtil.isArray(r)){for(var u=new CgsFeature,p=0;p<r.length;p++)u.children.push(r[p].feature.parentFeature);CgsSubPub.publish("featureSelected",[u,e.position,A])}}}}function i(e){CgsSubPub.publish("leftdown",[e.position]);var i=!1,s=!1;if(A.getAllFeatures().forEach(function(e,t){e instanceof CgsFeature3D&&e.parentFeature&&!e.parentFeature.aboutSatellite&&(e.getSelectEnable&&e.getSelectEnable()||e.getDragEnable&&e.getDragEnable())&&(i=!0)}),A.dataSources._dataSources.forEach(function(e,t){e.getPickEnable&&e.getPickEnable()&&(s=!0)}),!i&&!s&&0===I.length)return CgsSubPub.publish("clickspace",[A.pickFeature,e.position,A]),void(A.pickFeature=null);var t=A.scene.drillPick(e.position,3,A.hitToleranceWidth,A.hitToleranceHeight),o=0,a=t[o];if(a&&a.id)for(;"SatelliteRadar"==a.id||"SatelliteRadar2"==a.id;){if(a.primitive.owner._pickEnable)return;if(!(a=t[++o]))return}var n=!1;a&&a.primitive&&a.primitive.owner&&(n=a.primitive.owner.type===CgsOcean3D.Ocean);var r=!1;if(a&&a.primitive&&(r=a.primitive instanceof Cesium.Cesium3DTileset),!a||n||r)CgsSubPub.publish("clickspace",[A.pickFeature,e.position,A,r]),A.pickFeature=null;else{var l=a.id;if((l=l||a.primitive.id)&&l.feature){var u=[];return _.each(t,function(e){var t;e.id&&e.id.feature&&((t=e.id.feature).feature&&!t.dragEnable&&(t=t.feature),u.push(t))}),this.pickFeature=u[0],CgsSubPub.publish("ctrl_featureSelected",[u[0],e.position,A,u]),l}if(l&&l.kml)return CgsSubPub.publish("kmlfeatureSelected3d",[l,e.position,A]),l}}function s(e){var i=!1,t=!1;if(A.getAllFeatures().forEach(function(e,t){e instanceof CgsFeature3D&&(e.getSelectEnable&&e.getSelectEnable()||e.getDragEnable&&e.getDragEnable())&&(i=!0)}),0<A.dataSources.length&&(t=!0),i||t||0!==I.length){var s=A.scene.pick(e.position,A.hitToleranceWidth,A.hitToleranceHeight),o=A.scene.drillPick(e.position,3,A.hitToleranceWidth,A.hitToleranceHeight),a=!1;s&&s.primitive&&s.primitive.owner&&(a=s.primitive.owner.type===CgsOcean3D.Ocean);var n=!1;if(s&&s.primitive&&(n=s.primitive instanceof Cesium.Cesium3DTileset),!s||a||n)CgsSubPub.publish("rightclickspace",[l,e.position,A,n]);else{var r=s.id;if(r=r||s.primitive.id){if(r.feature){var l=r.feature;l.feature&&(l=l.feature);var u=[];return _.each(o,function(e){var t;e.id&&e.id.feature&&((t=e.id.feature).feature&&!t.dragEnable&&(t=t.feature),u.push(t))}),CgsSubPub.publish("featurerightclickSelected",[l,e.position,A,u]),r}if(r._position)return CgsSubPub.publish("kmlfeaturerightclickSelected",[r,e.position,A]),r;if(CgsUtil.isArray(r)){for(var p=new CgsFeature,h=0;h<r.length;h++)p.children.push(r[h].feature.parentFeature);CgsSubPub.publish("featurerightclickSelected",[p,e.position,A])}}}}else CgsSubPub.publish("rightclickspace",[l,e.position,A])}function o(e){var i=!1,t=!1;if(A.getAllFeatures().forEach(function(e,t){e instanceof CgsFeature3D&&e.parentFeature&&!e.parentFeature.aboutSatellite&&(e.getSelectEnable&&e.getSelectEnable()||e.getDragEnable&&e.getDragEnable())&&(i=!0)}),0<A.dataSources.length&&(t=!0),i||t||0!==I.length){var s=A.scene.drillPick(e.position,3,A.hitToleranceWidth,A.hitToleranceHeight),o=s[p=0];if(o&&o.id)for(;"SatelliteRadar"==o.id||"SatelliteRadar2"==o.id;){if(o.primitive.owner._pickEnable)return;if(!(o=s[++p]))return}var a=!1;o&&o.primitive&&o.primitive.owner&&(a=o.primitive.owner.type===CgsOcean3D.Ocean);var n=!1;if(o&&o.primitive&&(n=o.primitive instanceof Cesium.Cesium3DTileset),!o||a||n)CgsSubPub.publish("dbclickspace",[null,e.position,A,n]);else{var r=o.id;if(r=r||o.primitive.id){if(r.feature){var l=r.feature;return l.feature&&(l=l.feature),CgsSubPub.publish("featuredbclickSelected",[l,e.position,A]),r}if(r._position)return CgsSubPub.publish("kmlfeaturedbclickSelected",[r,e.position,A]),r;if(CgsUtil.isArray(r)){for(var u=new CgsFeature,p=0;p<r.length;p++)u.children.push(r[p].feature.parentFeature);CgsSubPub.publish("featuredbclickSelected",[u,e.position,A])}}}}}function a(e){CgsSubPub.publish("mousemove",[e.endPosition]);var i=!1,t=!1;if(A.getAllFeatures().forEach(function(e,t){e instanceof CgsFeature3D&&e.parentFeature&&!e.parentFeature.aboutSatellite&&(e.getSelectEnable&&e.getSelectEnable()||e.getDragEnable&&e.getDragEnable())&&(i=!0)}),0<A.dataSources.length&&(t=!0),i||t||0!==I.length){A.curMousePosition.x=e.endPosition.x,A.curMousePosition.y=e.endPosition.y;var s=void 0,o=void 0;if((o=A.scene.drillPick(e.endPosition,3,A.hitToleranceWidth,A.hitToleranceHeight))&&"[object Array]"==Object.prototype.toString.call(o)){var a=o.length,n=void 0;if(A.enterFeature)for(var r=0;r<a;++r){var l=o[r],u=l.id;if((u=u||l.primitive.id)&&u.feature&&A.enterFeature===u.feature){n=R=s=l;break}}else n=o[0];!s&&L&&(s=n||R)}var p,r=0;if(!L&&o&&(s=o[0],1<o.length&&o[1].id&&o[1].id.feature&&o[1].id.feature),s&&s.id)for(;"SatelliteRadar"==s.id||"SatelliteRadar2"==s.id;){if(s.primitive.owner._pickEnable)return;if(!(s=o[++r]))break}if(s&&(p=(p=s.id)||s.primitive.id),p&&!p.kml){p.feature&&p.feature!=A.enterFeature&&(CgsSubPub.publish("featureEnter",[p.feature,e.endPosition,A]),null!=A.enterFeature&&CgsSubPub.publish("featureLeave",[A.enterFeature,e.endPosition,A]),A.enterFeature=p.feature);var h=null;if(p.feature&&(h=p.feature).feature&&(h=h.feature),!h)return;if(F=h.getDragEnable(),h.getLabelDraggable(),F&&(L||x)&&(E=!0),E&&k&&(e.endPosition,CgsSubPub.publish("elementMoveStart",[e,A,A.enterFeature]),k=!1),0==A.deltaPos.length&&F&&L){var c=h.getType(),g=h.getElement(),d=e.startPosition,m=A.scene._camera0.pickEllipsoid(d,A.scene.globe.ellipsoid),f=Cesium.Cartographic.fromCartesian(m,Cesium.Ellipsoid.WGS84),C=Cesium.Math.toDegrees(f.longitude),y=Cesium.Math.toDegrees(f.latitude),v=g.getPosition();if("CgsParabola"==c&&(v=g.getPositions()),"CgsLine"==c||"CgsRect"==c||"CgsPolygon"==c||"CgsCorridor"==c||"CgsWall"==c||"CgsPolylineVolume"==c||"CgsParabola"==c){for(r=0;r<v.length;r++){var b=v[r];if("[object Array]"==Object.prototype.toString.call(b[0])){for(var D=[],S=0;S<b.length;S++){var _=b[S],w=C-_[0],P=y-_[1];(T=[]).push(w),T.push(P),D.push(T)}A.deltaPos.push(D)}else{var T,w=C-(b=v[r])[0],P=y-b[1];(T=[]).push(w),T.push(P),A.deltaPos.push(T)}}g.label&&(w=C-g.label.getPosition()[0],P=y-g.label.getPosition()[1],A.deltaNamePos.push(w),A.deltaNamePos.push(P))}else{"CgsModel"!=c&&"CgsPoint"!=c&&"CgsCircle"!=c&&"CgsMark"!=c&&"CgsCylinder"!=c&&"CgsBox"!=c&&"CgsEllipsoid"!=c&&"CgsEllipse"!=c&&"CgsLabel"!=c||(w=C-v[0],P=y-v[1],A.deltaPos.push(w),A.deltaPos.push(P),g.label&&(w=C-g.label.getPosition()[0],P=y-g.label.getPosition()[1],A.deltaNamePos.push(w),A.deltaNamePos.push(P)))}}}else p&&p.kml?p!=A.enterFeature&&(CgsSubPub.publish("featureEnter",[p,e.endPosition,A]),null!=A.enterFeature&&CgsSubPub.publish("featureLeave",[A.enterFeature,e.endPosition,A]),A.enterFeature=p):A.enterFeature&&(CgsSubPub.publish("featureLeave",[A.enterFeature,A]),A.enterFeature=null,R=void 0);if(L&&E&&F){A.scene.screenSpaceCameraController.enableInputs=!1,A.mousePos=e.endPosition;for(var M=!1,r=0;r<A.lastPickObjs.length;r++){if(A.lastPickObjs[r].primitive._id&&A.lastPickObjs[r].primitive._id.feature&&A.lastPickObjs[r].primitive._id.feature instanceof CgsLabel3D){M=!0;break}if(A.lastPickObjs[r].id&&A.lastPickObjs[r].id.feature instanceof CgsLabel3D){M=!0;break}}CgsSubPub.publish("elementMove",[A,M,L])}!L&&F&&CgsSubPub.publish("elementMove",[A,null,L]),A.lastPickObjs=o,x&&E&&F&&(A.scene.screenSpaceCameraController.enableInputs=!1,A.mousePos=e.endPosition,CgsSubPub.publish("elementHeight",[e,A]))}}var F=!1,k=!0,R=void 0;function n(){for(var e,t=A.getLayers(),i=0;i<t.length;i++){e=!0;var s=t[i];s.getMaxHeight()&&A.getHeight()>s.getMaxHeight()&&(e=!1),s.getMinHeight()&&A.getHeight()<s.getMinHeight()&&(e=!1),s.setHVisible(e)}}function r(e,t){var i=A.scene.drillPick(e.position,3,A.hitToleranceWidth,A.hitToleranceHeight),s=i[r=0];if(s&&s.id)for(;"SatelliteRadar"==s.id||"SatelliteRadar2"==s.id;){if(s.primitive.owner._pickEnable)return;if(!(s=i[++r]))return}if(s){var o=s.id;if((o=o||s.primitive.id)&&o.feature){var a=o.feature;if(a.feature&&(a=a.feature),"left"==t&&(L=!0),"right"==t&&(x=!0),A.deltaPos=[],A.deltaNamePos=[],A.mousePos=A.startPos=e.position,a.getDragEnable()&&(CgsSubPub.publish("elementSelected",[a,e.position,A]),l=a),a.getLabelDraggable()){for(var n=!1,r=0;r<i.length;r++){if(i[r].primitive._id&&i[r].primitive._id.feature&&i[r].primitive._id.feature instanceof CgsLabel3D){n=!0;break}if(i[r].id&&i[r].id.feature instanceof CgsLabel3D){n=!0;break}}n||(CgsSubPub.publish("elementNotSelected",[e.position,A]),x=L=!1,A.delta=null,E=!1,A.scene.screenSpaceCameraController.enableInputs=!0,l=void 0)}return o}}else CgsSubPub.publish("elementNotSelected",[e.position,A]),x=L=!1,A.delta=null,E=!1,l&&(A.scene.screenSpaceCameraController.enableInputs=!A.locked,l=void 0)}function u(e){(L||x)&&(A.enterFeature=null,R=void 0,E&&CgsSubPub.publish("elementMoveFinish",[e.position,l,A]),x=L=E=!1,A.delta=null,A.scene.screenSpaceCameraController.enableInputs=!A.locked,k=!0,t&&clearInterval(t))}function p(e){x=L=!1,r(e,"left")}function h(e){u(e)}function c(e){var t=Cesium.Cartesian2.clone(e.position);A.isIconVisible?CgsMouseIcon3D.showTiltPositionIcon(t):CgsMouseIcon3D.hideTiltPositionIcon(),x=L=!1,r(e,"right")}function g(e){CgsMouseIcon3D.hideTiltPositionIcon(),u(e)}function d(e){var t,i,s,o,a,n,r,l,u,p,h,c,g,d,m,f;A.manipulate&&A.manipulate.getManipulateType()===CgsManipulate3D.MANIPULATE_TYPE_3||(t=A.scene._camera0,i=A.scene.globe.ellipsoid,o=(s=t.positionCartographic).height,a=A.getTerrain(),n=A.scene,h=0,(a instanceof CgsTerrain3D||a instanceof CgsTileTerrain3D)&&(r=Cesium.Cartesian3.fromRadians(s.longitude,s.latitude,2e4),l=Cesium.Cartesian3.fromRadians(s.longitude,s.latitude,0),l=Cesium.Cartesian3.subtract(l,r,l),l=Cesium.Cartesian3.normalize(l,l),u=new Cesium.Ray(r,l),p=n.globe.pick(u,n),h=Cesium.defined(p)?Cesium.Cartographic.fromCartesian(p).height:0),0<h&&o-h<A.getMinHeight()&&(s.height=h+A.getMinHeight(),c=i.cartographicToCartesian(s),g=t.heading,d=t.pitch,m=t.roll,f={},A.scene.mode==Cesium.SceneMode.SCENE3D&&(f={destination:c,orientation:{heading:g,pitch:d,roll:m},duration:0},t.flyTo(f))),CgsSubPub.publish("compassUpDate"),CgsSubPub.publish("zoomChange"))}this.camera.percentageChanged=.1,CgsSubPub.subscribe("moveend3d",function(){A.getHeight();A.getHeight()<A.getMinHeight()&&A.setHeight(A.getMinHeight())}),this.camera.changed.addEventListener(n),this.camera.changed.addEventListener(function(){CgsSubPub.publish("aerialView")}),this.pickerActivate=function(){this.screenSpaceEventHandler.setInputAction(e,Cesium.ScreenSpaceEventType.LEFT_CLICK),this.screenSpaceEventHandler.setInputAction(i,Cesium.ScreenSpaceEventType.LEFT_CLICK,1),this.screenSpaceEventHandler.setInputAction(s,Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.screenSpaceEventHandler.setInputAction(o,Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.screenSpaceEventHandler.setInputAction(a,Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.screenSpaceEventHandler.setInputAction(p,Cesium.ScreenSpaceEventType.LEFT_DOWN),this.screenSpaceEventHandler.setInputAction(h,Cesium.ScreenSpaceEventType.LEFT_UP),this.screenSpaceEventHandler.setInputAction(c,Cesium.ScreenSpaceEventType.RIGHT_DOWN),this.screenSpaceEventHandler.setInputAction(g,Cesium.ScreenSpaceEventType.RIGHT_UP),this.screenSpaceEventHandler.setInputAction(d,Cesium.ScreenSpaceEventType.WHEEL)},this.scene.postRender.addEventListener(function(){CgsSubPub.publish("postRender",A)}),this.pickerActivate(),CgsSubPub.subscribe("layerAdded",function(e,t){A==t&&n()}),CgsSubPub.subscribe("visibleHeightChanged",function(e,t,i){A==i&&n()}),this.scene.screenSpaceCameraController.zoomEventTypes=[Cesium.CameraEventType.WHEEL,Cesium.CameraEventType.PINCH],this.scene.screenSpaceCameraController.tiltEventTypes=[Cesium.CameraEventType.RIGHT_DRAG,Cesium.CameraEventType.PINCH,{eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL},{eventType:Cesium.CameraEventType.RIGHT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL}]},CgsMap3D.prototype.setHitTolerance=function(e){this.hitTolerance=Cesium.defaultValue(e,1),this.hitToleranceHeight=this.hitToleranceWidth=2*this.hitTolerance+1},CgsMap3D.prototype.setMultiplier=function(e){this.clock.multiplier=e},CgsMap3D.prototype.getMultiplier=function(){return this.clock.multiplier},CgsMap3D.prototype.setCurrentTime=function(e){this.clock.currentTime=e?new Cesium.JulianDate(e):Cesium.JulianDate.now()},CgsMap3D.prototype.getCurrentTime=function(){return this.clock.currentTime},CgsMap3D.prototype.locateEffectHelperStart=function(){var i=this,s=i.locateEffectHelper;s.setPostRender=function(){i.scene.postRender.addEventListener(function(){var e=i.locateEffectHelper.store;if(e.geoPos)if(CgsUtil.map3DCheckPositionIfVisible(i,e.geoPos)){s.locateEffectGroup.show();var t=i.owner.lonLatToPixel(e.geoPos);if(!t)return;s.locateEffectGroup.attr("position",t)}else s.locateEffectGroup.hide()},this)}},CgsMap3D.prototype.handleMultiViewsEvent=function(){var e=this.scene.allViewports.length,x=this;this.deltaPos_=[];function t(e){var t=e.screenSpaceEventHandler._element.index;CgsSubPub.publish("leftdown",[e.position,t]);var i=!1,s=!1;if(x.getAllFeatures().forEach(function(e,t){e instanceof CgsFeature3D&&(e.getSelectEnable&&e.getSelectEnable()||e.getDragEnable&&e.getDragEnable())&&(i=!0)}),0<x.dataSources.length&&(s=!0),!i&&!s)return CgsSubPub.publish("clickspace",[x.pickFeature,e.position,x]),void(x.pickFeature=null);var o=x.scene.drillPick(e.position,3,x.hitToleranceWidth,x.hitToleranceHeight,e.screenSpaceEventHandler),a=0,n=o[a];if(n&&n.id)for(;"SatelliteRadar"==n.id||"SatelliteRadar2"==n.id;){if(n.primitive.owner._pickEnable)return;if(!(n=o[++a]))return}if(n){var r=n.id;if((r=r||n.primitive.id)&&r.feature){var l=[];return _.each(o,function(e){var t;e.id&&e.id.feature&&((t=e.id.feature).feature&&(t=t.feature),l.push(t))}),this.pickFeature=l[0],CgsSubPub.publish("featureSelected",[l[0],e.position,x,l]),r}if(r&&r.kml)return CgsSubPub.publish("kmlfeatureSelected3d",[r,e.position,x]),r}else CgsSubPub.publish("clickspace",[x.pickFeature,e.position,x]),x.pickFeature=null}function i(e){var i=!1,t=!1;if(x.getAllFeatures().forEach(function(e,t){e instanceof CgsFeature3D&&(e.getSelectEnable&&e.getSelectEnable()||e.getDragEnable&&e.getDragEnable())&&(i=!0)}),0<x.dataSources.length&&(t=!0),i||t){var s=x.scene.pick(e.position,x.hitToleranceWidth,x.hitToleranceHeight,e.screenSpaceEventHandler);if(s){var o=s.id;if((o=o||s.primitive.id)&&o.feature){var a=o.feature;return a.feature&&!a.dragEnable&&(a=a.feature),CgsSubPub.publish("featurerightclickSelected",[a,e.position,x]),o}if(o&&o._position)return CgsSubPub.publish("kmlfeaturerightclickSelected",[o,e.position,x]),o}else CgsSubPub.publish("rightclickspace",[a,e.position,x])}else CgsSubPub.publish("rightclickspace",[a,e.position,x])}function s(e){var i=!1,t=!1;if(x.getAllFeatures().forEach(function(e,t){e instanceof CgsFeature3D&&(e.getSelectEnable&&e.getSelectEnable()||e.getDragEnable&&e.getDragEnable())&&(i=!0)}),0<x.dataSources.length&&(t=!0),i||t){var s=x.scene.drillPick(e.position,3,x.hitToleranceWidth,x.hitToleranceHeight,e.screenSpaceEventHandler),o=0,a=s[o];if(a&&a.id)for(;"SatelliteRadar"==a.id||"SatelliteRadar2"==a.id;){if(a.primitive.owner._pickEnable)return;if(!(a=s[++o]))return}if(a){var n=a.id;if((n=n||a.primitive.id)&&n.feature){var r=n.feature;return r.feature&&(r=r.feature),CgsSubPub.publish("featuredbclickSelected",[r,e.position,x]),n}if(n&&n._position)return CgsSubPub.publish("kmlfeaturedbclickSelected",[n,e.position,x]),n}else CgsSubPub.publish("dbclickspace",[null,e.position,x])}}function o(e){CgsSubPub.publish("mousemove",[e.endPosition]);var i=!1,t=!1;if(x.getAllFeatures().forEach(function(e,t){e instanceof CgsFeature3D&&(e.getSelectEnable&&e.getSelectEnable()||e.getDragEnable&&e.getDragEnable())&&(i=!0)}),0<x.dataSources.length&&(t=!0),i||t){x.curMousePosition.x=e.endPosition.x,x.curMousePosition.y=e.endPosition.y;var s,o=void 0,a=void 0;if((a=x.scene.drillPick(e.endPosition,3,x.hitToleranceWidth,x.hitToleranceHeight,e.screenSpaceEventHandler))&&"[object Array]"==Object.prototype.toString.call(a)){var n=a.length,r=void 0;if(x.enterFeature)for(var l=0;l<n;++l){var u=a[l],p=u.id;if((p=p||u.primitive.id)&&p.feature&&x.enterFeature===p.feature){r=R=o=u;break}}else r=a[0];!o&&E&&(o=r||R)}if(!E&&a&&(o=a[0],1<a.length&&a[1].id&&a[1].id.feature&&a[1].id.feature),o&&o.id)for(;"SatelliteRadar"==o.id||"SatelliteRadar2"==o.id;){if(o.primitive.owner._pickEnable)return;if(l++,!(o=pickedAlla[l]))break}if(o&&(s=(s=o.id)||o.primitive.id),s&&!s.kml){s.feature&&s.feature!=x.enterFeature&&(CgsSubPub.publish("featureEnter",[s.feature,e.endPosition,x]),null!=x.enterFeature&&CgsSubPub.publish("featureLeave",[x.enterFeature,e.endPosition,x]),x.enterFeature=s.feature);var h=null;if(s.feature&&(h=s.feature).feature&&(h=h.feature),!h)return;if(F=h.getDragEnable(),h.getLabelDraggable(),F&&(E||A)&&(I=!0),I&&k&&(e.endPosition,CgsSubPub.publish("elementMoveStart",[e,x,x.enterFeature]),k=!1),0==x.deltaPos_.length&&F&&E){var c=h.getType(),g=h.getElement(),d=e.startPosition,m=e.screenSpaceEventHandler._element.index,f=x.scene.allViewports[m-1].camera.pickEllipsoid(d,x.scene.globe.ellipsoid),C=Cesium.Cartographic.fromCartesian(f,Cesium.Ellipsoid.WGS84),y=Cesium.Math.toDegrees(C.longitude),v=Cesium.Math.toDegrees(C.latitude),b=g.getPosition();if("CgsParabola"==c&&(b=g.getPositions()),"CgsLine"==c||"CgsRect"==c||"CgsPolygon"==c||"CgsCorridor"==c||"CgsWall"==c||"CgsPolylineVolume"==c||"CgsParabola"==c){for(l=0;l<b.length;l++){var D=b[l];if("[object Array]"==Object.prototype.toString.call(D[0])){for(var S=[],_=0;_<D.length;_++){var w=D[_],P=y-w[0],T=v-w[1];(M=[]).push(P),M.push(T),S.push(M)}x.deltaPos_.push(S)}else{var M,P=y-(D=b[l])[0],T=v-D[1];(M=[]).push(P),M.push(T),x.deltaPos_.push(M)}}g.label&&(P=y-g.label.getPosition()[0],T=v-g.label.getPosition()[1],x.deltaNamePos_.push(P),x.deltaNamePos_.push(T))}else{"CgsModel"!=c&&"CgsPoint"!=c&&"CgsCircle"!=c&&"CgsMark"!=c&&"CgsCylinder"!=c&&"CgsBox"!=c&&"CgsEllipsoid"!=c&&"CgsEllipse"!=c||(P=y-b[0],T=v-b[1],x.deltaPos_.push(P),x.deltaPos_.push(T),g.label&&(P=y-g.label.getPosition()[0],T=v-g.label.getPosition()[1],x.deltaNamePos_.push(P),x.deltaNamePos_.push(T)))}}}else s&&s.kml?s!=x.enterFeature&&(CgsSubPub.publish("featureEnter",[s,e.endPosition,x]),null!=x.enterFeature&&CgsSubPub.publish("featureLeave",[x.enterFeature,e.endPosition,x]),x.enterFeature=s):x.enterFeature&&(CgsSubPub.publish("featureLeave",[x.enterFeature,x]),x.enterFeature=null,R=void 0);if(E&&I&&F){var m=e.screenSpaceEventHandler._element.index;x.scene.allViewports[m-1].camera.aboutSSCC.enableInputs=!1,x.mousePos=e.endPosition;for(var L=!1,l=0;l<x.lastPickObjs.length;l++){if(x.lastPickObjs[l].primitive._id&&x.lastPickObjs[l].primitive._id.feature&&x.lastPickObjs[l].primitive._id.feature instanceof CgsLabel3D){L=!0;break}if(x.lastPickObjs[l].id&&x.lastPickObjs[l].id.feature instanceof CgsLabel3D){L=!0;break}}CgsSubPub.publish("elementMove",[x,L,E,m])}!E&&F&&CgsSubPub.publish("elementMove",[x,null,E,m]),x.lastPickObjs=a,A&&I&&F&&(m=e.screenSpaceEventHandler._element.index,x.scene.allViewports[m-1].camera.aboutSSCC.enableInputs=!1,x.mousePos=e.endPosition,CgsSubPub.publish("elementHeight",[e,x]))}}var E=!(this.deltaNamePos_=[]),A=!1,I=!1,a=null,l=void 0,F=!1,k=!0,R=void 0;function n(e,t){var i,s=x.scene.drillPick(e.position,3,x.hitToleranceWidth,x.hitToleranceHeight,e.screenSpaceEventHandler),o=0,a=s&&s[o];if(a&&a.id)for(;"SatelliteRadar"==a.id||"SatelliteRadar2"==a.id;){if(a.primitive.owner._pickEnable)return;if(!(a=s[++o]))return}if(a){var n=a.id;if((n=n||a.primitive.id)&&n.feature){var r=n.feature;return r.feature&&(r=r.feature),"left"==t&&(E=!0),"right"==t&&(A=!0),x.deltaPos_=[],x.mousePos=x.startPos=e.position,r.getDragEnable()&&(CgsSubPub.publish("elementSelected",[r,e.position,x]),l=r),n}}else{CgsSubPub.publish("elementNotSelected",[e.position,x]),A=E=!1,x.delta=null,I=!1,l&&(i=e.screenSpaceEventHandler._element.index,x.scene.allViewports[i-1].camera.aboutSSCC.enableInputs=!x.multiViewLocked[i-1],l=void 0)}}function r(e){var t;(E||A)&&(x.enterFeature=null,R=void 0,I&&CgsSubPub.publish("elementMoveFinish",[e.position,l,x]),A=E=I=!1,x.delta=null,t=e.screenSpaceEventHandler._element.index,x.scene.allViewports[t-1].camera.aboutSSCC.enableInputs=!x.multiViewLocked[t-1],k=!0,a&&clearInterval(a))}function u(e){A=E=!1,n(e,"left")}function p(e){r(e)}function h(e){var t=Cesium.Cartesian2.clone(e.clientXY),i=x.scene._canvas0.getBoundingClientRect();t.x-=i.left,t.y-=i.top,x.isIconVisible?CgsMouseIcon3D.showTiltPositionIcon(t):CgsMouseIcon3D.hideTiltPositionIcon(),A=E=!1,n(e,"right")}function c(e){CgsMouseIcon3D.hideTiltPositionIcon(),r(e)}function g(){for(var e,t=x.getLayers(),i=0;i<t.length;i++){e=!0;var s=t[i];s.getMaxHeight()&&x.getHeight()>s.getMaxHeight()&&(e=!1),s.getMinHeight()&&x.getHeight()<s.getMinHeight()&&(e=!1)}s.setHVisible(e)}for(var d=this.scene._camera0.maxHeight,m=this.minHeight,f=0;f<e;++f){var C=this.scene.allViewports[f].camera;C.percentageChanged=.1,C.changed.addEventListener(g),C.maxHeight=d;var y=C.aboutSSCC;y.minimumZoomDistance=m,y.maximumZoomDistance=d,y.zoomEventTypes=[Cesium.CameraEventType.WHEEL,Cesium.CameraEventType.PINCH],y.tiltEventTypes=[Cesium.CameraEventType.RIGHT_DRAG,Cesium.CameraEventType.PINCH,{eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL},{eventType:Cesium.CameraEventType.RIGHT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL}];var v=this.scene.allViewports[f].screenSpaceEventHandler;v.setInputAction(t,Cesium.ScreenSpaceEventType.LEFT_CLICK),v.setInputAction(i,Cesium.ScreenSpaceEventType.RIGHT_CLICK),v.setInputAction(s,Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),v.setInputAction(o,Cesium.ScreenSpaceEventType.MOUSE_MOVE),v.setInputAction(u,Cesium.ScreenSpaceEventType.LEFT_DOWN),v.setInputAction(p,Cesium.ScreenSpaceEventType.LEFT_UP),v.setInputAction(h,Cesium.ScreenSpaceEventType.RIGHT_DOWN),v.setInputAction(c,Cesium.ScreenSpaceEventType.RIGHT_UP)}},CgsMap3D.prototype.leftAndRightViews=function(){this.twoViewsMode&&this.scene.leftRightMode||(this.scene.leftRightMode=!0,this.twoViewsMode=!0,this.handleMultiViewsEvent())},CgsMap3D.prototype.upAndDownViews=function(){this.twoViewsMode&&!this.scene.leftRightMode||(this.scene.leftRightMode=!1,this.twoViewsMode=!0,this.handleMultiViewsEvent())},CgsMap3D.prototype.fourViews=function(){this.fourViewsMode||(this.scene.leftRightMode=!0,this.fourViewsMode=!0,this.handleMultiViewsEvent())},CgsMap3D.prototype.disableMultiViews=function(){this.isMultiViewsMode&&(this.isMultiViewsMode=!1,this.twoViewsMode=!1,this.fourViewsMode=!1,this.scene.leftRightMode=!0)},CgsMap3D.prototype.createPiP=function(e){this.scene.createPiP(e),this.pip=!0,this.handleMultiViewsEvent()},CgsMap3D.prototype.deletePiP=function(){this.isMultiViewsMode&&(this.isMultiViewsMode=!1)},CgsMap3D.prototype.mv_pixelToLonLat=function(e,t){e=new Cesium.Cartesian2(e[0],e[1]);var i=this.scene.allViewports[t].camera.pickEllipsoid(e,this.scene.globe.ellipsoid);if(i){var s=Cesium.Cartographic.fromCartesian(i);return[Cesium.Math.toDegrees(s.longitude),Cesium.Math.toDegrees(s.latitude)]}},CgsMap3D.prototype.mv_lonLatToPixel=function(e,t){var i=Cesium.Cartographic.fromDegrees(e[0],e[1],e[2]),s=this.scene.globe.ellipsoid.cartographicToCartesian(i),o=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.scene,s,void 0,t);if(o.x&&o.y)return[o.x,o.y]},CgsMap3D.prototype.lockZoom=function(){this.scene.screenSpaceCameraController.enableZoom=!1},CgsMap3D.prototype.unlockZoom=function(){this.scene.screenSpaceCameraController.enableZoom=!0},CgsLayer3D=function(e,t){var i=function(e){null==e&&(e=[-180,-90,180,90]);if(4!=e.length)return void console.log("图层的显示范围必须包括【west,south,east,north】");var t=Cesium.Math.toRadians(e[0]),i=Cesium.Math.toRadians(e[1]),s=Cesium.Math.toRadians(e[2]),o=Cesium.Math.toRadians(e[3]);{s<t&&(a=t,t=s,s=a)}{var a;o<i&&(a=i,i=o,o=a)}return t!=s&&i!=o?new Cesium.Rectangle(t,i,s,o):void console.error("Rectangle Error: Please check the Extent!")}(t.rectangle);Cesium.ImageryLayer.call(this,e,{rectangle:i}),this.saveFlag=!0,this.show?this.bShow=!0:this.bShow=!1,this.hShow=!0,this.intiShow=!0;t.text||(t.text=t.name),t.minHeight||(t.minHeight=0),t.name||(t.name=t.text),t.rectangle||(t.rectangle=[-180,-90,180,90]),t.minVisLevel||(t.minVisLevel=0),t.maxVisLevel||(t.maxVisLevel=28),null==t.saveFlag&&(t.saveFlag=!0);var s=CgsIds++;this.state={group:null,pId:t.pId,id:"cgslayer_id_"+s,map:null,type:t.type,text:t.text,name:t.name,layer:t.layer,layers:t.layers,url:t.url,level:t.level,minVisLevel:t.minVisLevel,maxVisLevel:t.maxVisLevel,rectangle:t.rectangle,maxHeight:t.maxHeight,minHeight:t.minHeight,visible:t.visible,saveFlag:t.saveFlag,projection:t.projection,version:t.version,isAddToLayerTree:1==t.isAddToLayerTree}},CgsLayer3D.prototype=Cesium.ImageryLayer.prototype,CgsLayer3D.prototype._setEvents=function(){var i=this;this.earthWeakLevel=void 0,this.earthWeakVisible=!1,this.earthWeakEvent=CgsSubPub.subscribe("earthWeak",function(e,t){i.earthWeakVisible=t}),this.terrainColourVisible=!1,this.terrainColourEvent=CgsSubPub.subscribe("terrainColour",function(e,t){i.terrainColourVisible=t})},CgsLayer3D.prototype._unsetEvents=function(){CgsSubPub.unsubscribe(this.earthWeakEvent),CgsSubPub.unsubscribe(this.terrainColourEvent)},CgsLayer3D.prototype.getUrl=function(){return this.state.url},CgsLayer3D.prototype.getLayer=function(){return this.state.layer},CgsLayer3D.prototype.getLayers=function(){return this.state.layers},CgsLayer3D.prototype.getLevel=function(){return this.state.level},CgsLayer3D.prototype.getProjection=function(){return this.state.projection},CgsLayer3D.prototype.getVersion=function(){return this.state.version},CgsLayer3D.prototype.setName=function(e){this.state.name=e},CgsLayer3D.prototype.getName=function(){return this.state.name},CgsLayer3D.prototype.setText=function(e){this.state.text=e},CgsLayer3D.prototype.getText=function(){return this.state.text},CgsLayer3D.prototype.setAddToLayerTree=function(e){this.state.isAddToLayerTree=e},CgsLayer3D.prototype.getAddToLayerTree=function(){return this.state.isAddToLayerTree},CgsLayer3D.prototype.getId=function(){return this.state.id},CgsLayer3D.prototype.getPId=function(){return this.state.pId},CgsLayer3D.prototype.setPId=function(e){this.state.pId=e},CgsLayer3D.prototype.setBrightness=function(e){this.brightness=e},CgsLayer3D.prototype.getBrightness=function(){return this.brightness},CgsLayer3D.prototype.setAlpha=function(e){this.alpha=e},CgsLayer3D.prototype.getAlpha=function(){return this.alpha},CgsLayer3D.prototype.setExtent=function(e,t,i,s){this.state.extent=[],"[object Array]"==Object.prototype.toString.call(e)&&(t=e[1],i=e[2],s=e[3],e=e[0]),this.state.extent=[e,t,i,s];var o,a=this.getIndex(),n=this.getMap();"WMTS"==this.state.type?(o={name:this.state.name,url:this.state.url,rec:this.state.extent,level:this.state.level,text:this.state.text},CgsTileLayer.call(this,o)):this.state.type,n&&(n.removeLayer(n.getLayerByIndex(a)),n.addLayer(this,a))},CgsLayer3D.prototype.getExtent=function(){return this.state.rectangle},CgsLayer3D.prototype.setGroup=function(e){this.state.group=e},CgsLayer3D.prototype.getGroup=function(){return this.state.group},CgsLayer3D.prototype.setVisible=function(e){var t=this.bShow;if(this.bShow=e,this.show=this.bShow&&this.hShow,this instanceof Cgs3DTilesetLayer3D)for(var i=this.tilesetList.length,s=0;s<i;++s){this.tilesetList[s].setVisible(e)}t!=this.bShow&&CgsSubPub.publish("layerVisibleChanged",[this,this.show])},CgsLayer3D.prototype.getVisible=function(){return this.bShow},CgsLayer3D.prototype.setSaveFlag=function(e){this.state.saveFlag=e},CgsLayer3D.prototype.getSaveFlag=function(){return this.state.saveFlag},CgsLayer3D.prototype.setMap=function(e){this.state.map=e},CgsLayer3D.prototype.getMap=function(){return this.state.map},CgsLayer3D.prototype.getIndex=function(){if(this.state.map)return this.state.map.imageryLayers._layers.indexOf(this)},CgsLayer3D.prototype.getType=function(){return this.state.type},CgsLayer3D.prototype.moveUp=function(){this.state.map&&this.state.map.imageryLayers.raise(this)},CgsLayer3D.prototype.moveDown=function(){this.state.map&&this.state.map.imageryLayers.lower(this)},CgsLayer3D.prototype.moveToTop=function(){this.state.map&&this.state.map.imageryLayers.raiseToTop(this)},CgsLayer3D.prototype.moveToBottom=function(){this.state.map&&this.state.map.imageryLayers.lowerToBottom(this)},CgsLayer3D.prototype.getMaxHeight=function(){return this.state.maxHeight},CgsLayer3D.prototype.getMinHeight=function(){return this.state.minHeight},CgsLayer3D.prototype.setMaxHeight=function(e){this.state.maxHeight=e,CgsSubPub.publish("visibleHeightChanged",[this,this.state.map])},CgsLayer3D.prototype.setMinHeight=function(e){this.state.minHeight=e,CgsSubPub.publish("visibleHeightChanged",[this,this.state.map])},CgsLayer3D.prototype.setHVisible=function(e){var t=this.hShow;this.hShow=e,this.show=this.bShow&&this.hShow,t!=this.hShow&&CgsSubPub.publish("layerVisibleChanged",[this,this.show])},CgsLayer3D.prototype.getHVisible=function(){return this.hShow},CgsLayer3D.prototype.IsVisibleExtent=function(){var e=this.getMap();if(!e)return!1;var t=e.view.getHeight();return!(t>this.getMaxHeight()||t<this.getMinHeight())},CgsLayer3D.prototype.getMaxVisLevel=function(){return this.state.maxVisLevel},CgsLayer3D.prototype.getMinVisLevel=function(){return this.state.minVisLevel},CgsLayer3D.prototype.setContrast=function(e){this.contrast=e},CgsLayer3D.prototype.getContrast=function(){return this.contrast},CgsLayer3D.prototype.setHue=function(e){this.hue=e},CgsLayer3D.prototype.getHue=function(){return this.hue},CgsLayer3D.prototype.setSaturation=function(e){this.saturation=e},CgsLayer3D.prototype.getSaturation=function(){return this.saturation},CgsLayer3D.prototype.setGamma=function(e){this.gamma=e},CgsLayer3D.prototype.getGamma=function(){return this.gamma},CgsLayer3D.prototype.setCustomColor=function(e,t,i){this.customColor=Cesium.Color.fromBytes(e,t,i)},CgsLayer3D.prototype.getCustomColor=function(){return this.customColor.toBytes()};var geographicTilingScheme=new Cesium.GeographicTilingScheme,cartographic=new Cesium.Cartographic,cgsTileCacheValueArray=new Array,cgsTileCacheKeyArray=new Array,cgsTilecacheSize=5e3,mapEarth,sztoolBar,junbTool,layerTool,markTool;function loadScript(e,t){var i=document.createElement("script");i.type="text/javascript",void 0!==t&&(i.readyState?i.onreadystatechange=function(){"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onreadystatechange=null,t())}:i.onload=function(){t()}),i.src=e,document.body.appendChild(i)}CgsLayer3D.prototype._requestImagery=function(s,o,a){if(this instanceof Cgs3DTilesetLayer3D){if(s.level<this.limitLevel)return s.image=void 0,s.state=Cesium.ImageryState.INVISIBLE,void(s.request=void 0);var r=this,e=s.level+1,t=e+"_"+s.x+"_"+s.y;if(-1!==(h=this.tilesetKeyCache.indexOf(t)))return s.tileset=this.tilesetList[h],s.state=Cesium.ImageryState.RECEIVED,s.request=void 0,void Cesium.TileProviderError.handleSuccess(this._requestImageError);var i=this.state.url+"/"+e+"/"+s.x+"/"+s.y+"/meta.json",n=[];$$.ajax({async:!1,url:i,type:"get",dataType:"json",success:function(e){if(console.log(e),0==e.length)return s.image=void 0,s.state=Cesium.ImageryState.INVISIBLE,void(s.request=void 0);for(var t=0;t<e.length;++t){var i=e[t].id;n.push(i)}},error:function(){}});for(var l=0;l<n.length;++l){var u=n[l],p=u.split("_"),i=this.state.url+"/"+p[0]+"/"+p[1]+"/"+p[2]+"/tileset.json";$$.ajax({async:!1,url:i,type:"get",dataType:"json",success:function(){var n=new Cgs3DTileset3D({url:i,show:!0,proxy:"none"});for(r.state.map.addFeature(n),n.tileset.luminanceAtZenith=.1,n.tileset.tileLoad.addEventListener(function(){var e=r.heightOffset,t=n.tileset.boundingSphere,i=Cesium.Cartographic.fromCartesian(t.center),s=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,0),o=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,e),a=Cesium.Cartesian3.subtract(o,s,new Cesium.Cartesian3);n.tileset.modelMatrix=Cesium.Matrix4.fromTranslation(a)}),s.tileset=n,s.state=Cesium.ImageryState.RECEIVED,s.request=void 0,Cesium.TileProviderError.handleSuccess(this._requestImageError);1e3<=r.tilesetKeyCache.length;)r.tilesetKeyCache.splice(0,1),r.state.map.removeFeature(r.tilesetList[0]),r.tilesetList.splice(0,1);r.tilesetKeyCache.push(u),r.tilesetList.push(n)},error:function(){s.image=void 0,s.state=Cesium.ImageryState.INVISIBLE,s.request=void 0}})}}else{this.earthWeakVisible||this.terrainColourVisible?(s.image=void 0,s.state=Cesium.ImageryState.INVISIBLE,s.request=void 0):s.state=Cesium.ImageryState.TRANSITIONING;var h,c=this._imageryProvider,t=(s.imageryLayer.state.layer||s.imageryLayer.state.layers)+"_"+s.level+"_"+s.x+"_"+s.y;if(this instanceof CgsTimeDynamicTileLayer3D){var g=c._timeDynamicImagery.currentInterval;if(!g)return;var d=g.data.Time;t=t+"_"+d}if(-1!==(h=cgsTileCacheKeyArray.indexOf(t)))return s.image=cgsTileCacheValueArray[h],s.state=Cesium.ImageryState.RECEIVED,s.request=void 0,void Cesium.TileProviderError.handleSuccess(this._requestImageError);r=this;if(null==this.state||null==this.state||null==this.state.minVisLevel||null==this.state.maxVisLevel)C();else{if(null==this.state.minVisLevel||null==this.state.maxVisLevel)return s.image=void 0,s.state=Cesium.ImageryState.INVISIBLE,void(s.request=void 0);if(!(s.level>=this.state.minVisLevel&&s.level<=this.state.maxVisLevel))return s.image=void 0,s.state=Cesium.ImageryState.INVISIBLE,void(s.request=void 0);C()}}function m(e){if(!Cesium.defined(e))return f();for(s.image=e,s.state=Cesium.ImageryState.RECEIVED,s.request=void 0,Cesium.TileProviderError.handleSuccess(r._requestImageError);cgsTileCacheKeyArray.length>=cgsTilecacheSize;)cgsTileCacheKeyArray.splice(0,1),cgsTileCacheValueArray.splice(0,1);cgsTileCacheKeyArray.push(t),cgsTileCacheValueArray.push(e)}function f(e){if(s.request.state===Cesium.RequestState.CANCELLED)return s.state=Cesium.ImageryState.UNLOADED,void(s.request=void 0);s.state=Cesium.ImageryState.FAILED,s.request=void 0}function C(){var e,t,i=new Cesium.Request({throttle:!0,throttleByServer:!0,type:Cesium.RequestType.IMAGERY,priorityFunction:o});if(s.request=i,s.state=Cesium.ImageryState.TRANSITIONING,t=r.tencentY?(e=c.tilingScheme.getNumberOfYTilesAtLevel(s.level)-s.y-1,c.requestImage(s.x,e,s.level,i,a)):c.requestImage(s.x,s.y,s.level,i,a),!Cesium.defined(t))return s.state=Cesium.ImageryState.UNLOADED,void(s.request=void 0);Cesium.defined(c.getTileCredits)&&(s.credits=c.getTileCredits(s.x,s.y,s.level)),Cesium.when(t,m,f)}},CgsLayerGroup3D=function(e){var s={name:e.name,id:CgsIds++,list:[],keys:[]};this.getId=function(){return s.id},this.setVisible=function(e){for(var t=0;t<s.list.length;t++)s.list[t].setVisible(e)},this.getName=function(){return s.name},this.addLayer=function(e){var t=e.getGroup();if(null!=t){if(t.getId()==s.id)return void console.log("已经添加到该组");t.removeLayer(e)}s.list.push(e),s.keys.push(e.getId()),e.setGroup(this)},this.removeLayer=function(e){if(e.getGroup().getId()==s.id)for(var t=e.getId(),i=0;i<s.keys.length;i++)if(s.keys[i]==t){s.list[i].setGroup(null),s.keys.splice(i,1),s.list.splice(i,1);break}},this.getLayers=function(){for(var e=[],t=0;t<s.list.length;t++)e.push(s.list[t]);return e},this.save=function(){}},CgsTileLayer3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t={name:e.name,type:"WMTS",url:e.url,layer:e.layer,rectangle:e.rectangle,level:e.level,text:e.text,pId:e.pId,visible:1==e.visible,format:e.format,style:e.style,tileMatrixSetID:e.tileMatrixSetID,tileMatrixLabels:e.tileMatrixLabels,tileWidth:e.tileWidth,tileHeight:e.tileHeight,minimumLevel:e.minimumLevel,maximumLevel:e.maximumLevel,minVisLevel:e.minVisLevel,maxVisLevel:e.maxVisLevel,numberOfLevelZeroTilesXY:e.numberOfLevelZeroTilesXY,projection:e.projection,isAddToLayerTree:1==e.isAddToLayerTree,proxy:CgsUtil.getProxyURL(e.proxy)};if(this.state=t,this.tencentY=e.tencentY,null==t.maximumLevel&&(t.maximumLevel=e.level-1),null==t.layer&&(t.layer=e.name),null==t.text&&(t.text=e.layer),null==t.style&&(t.style="default"),null==t.tileMatrixSetID&&(t.tileMatrixSetID="OGC_WebMercator"),null==t.minimumLevel&&(t.minimumLevel=0),null==t.format&&(t.format="image/png"),null==t.tileMatrixLabels){for(var i=[],s=t.minimumLevel;s<t.maximumLevel+1;s++)t.numberOfLevelZeroTilesXY&&10===t.numberOfLevelZeroTilesXY[0]&&5===t.numberOfLevelZeroTilesXY[1]&&"OGC_WGS84"===t.tileMatrixSetID?i.push(s-4):i.push(s+1);t.tileMatrixLabels=i}null==t.maxVisLevel&&(null==t.tileMatrixLabels?t.maxVisLevel=e.level:t.maxVisLevel=t.tileMatrixLabels.length),null==t.tileWidth&&(t.tileWidth=256),null==t.tileHeight&&(t.tileHeight=256),null==t.rectangle&&(t.rectangle=[-180,-90,180,90]),null==t.projection||CgsTileLayer3D.MERCATOR==t.projection?t.numberOfLevelZeroTilesXY?t.tilingScheme=new Cesium.WebMercatorTilingScheme({numberOfLevelZeroTilesX:t.numberOfLevelZeroTilesXY[0],numberOfLevelZeroTilesY:t.numberOfLevelZeroTilesXY[1]}):t.tilingScheme=new Cesium.WebMercatorTilingScheme({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1}):CgsTileLayer3D.WGS84==t.projection&&(t.numberOfLevelZeroTilesXY?t.tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:t.numberOfLevelZeroTilesXY[0],numberOfLevelZeroTilesY:t.numberOfLevelZeroTilesXY[1]}):t.tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1}));var o=CgsUtil.getProxyURL(t.proxy);t.proxy=o?new Cesium.DefaultProxy(o):null,t.url=new Cesium.Resource({url:t.url,proxy:t.proxy});var a=new Cesium.WebMapTileServiceImageryProvider({format:t.format,url:t.url,layer:t.layer,style:t.style,tileMatrixSetID:t.tileMatrixSetID,tileMatrixLabels:t.tileMatrixLabels,maximumLevel:t.maximumLevel,minimumLevel:t.minimumLevel,tileWidth:t.tileWidth,tileHeight:t.tileHeight,ellipsoid:Cesium.Ellipsoid.WGS84,tilingScheme:t.tilingScheme});CgsLayer3D.call(this,a,t),t.maxHeight&&this.setMaxHeight(t.maxHeight),t.minHeight&&this.setMinHeight(t.minHeight)}),CgsTileLayer3D.MERCATOR="EPSG:102113",CgsTileLayer3D.WGS84="EPSG:4326",CgsInherits(CgsTileLayer3D,CgsLayer3D),CgsWebMapLayer3D_=function(e,t){this.owner=t,e.format||(e.format="image/png"),e.enablePickFeatures||(e.enablePickFeatures=!1),e.projection||(e.projection="EPSG:102113"),null==e.projection||CgsTileLayer3D.MERCATOR==e.projection?e.tilingScheme=new Cesium.WebMercatorTilingScheme({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1}):CgsTileLayer3D.WGS84==e.projection&&(e.tilingScheme=new Cesium.GeographicTilingScheme);var i=new Cesium.WebMapServiceImageryProvider({url:e.url,layers:e.layers,ellipsoid:Cesium.Ellipsoid.WGS84,tilingScheme:e.tilingScheme,format:e.format,tileWidth:256,tileHeight:256,enablePickFeatures:e.enablePickFeatures,proxy:e.proxy?new Cesium.DefaultProxy(e.proxy):null,parameters:{srs:e.projection,transparent:!0,format:e.format,version:e.version}});e.text||(e.text=e.layers),e.type="WMS";var s={text:e.text,layers:e.layers,pId:e.pId,type:"WMS",url:e.url,level:e.level,rectangle:e.rectangle,name:e.name,isAddToLayerTree:e.isAddToLayerTree,projection:e.projection,version:e.version,proxy:e.proxy,maxVisLevel:e.maxVisLevel,minVisLevel:e.minVisLevel};CgsLayer3D.call(this,i,s)},CgsInherits(CgsWebMapLayer3D_,CgsLayer3D),CgsWebMapLayer3D=function(e){null==e.rectangle&&(e.rectangle=[-180,-90,180,90]),null==e.saveFlag&&(e.saveFlag=!0),null==e.getAddToLayerTree&&(e.getAddToLayerTree=!0),null==e.visible&&(e.visible=!0),this.state=e,this.state.type="WMS";var t=CgsIds++;this.state.id="cgslayer_id_"+t},CgsInherits(CgsWebMapLayer3D,CgsLayer3D),CgsWebMapLayer3D.prototype.setVisible=function(e){if(e!=this.state.visible&&(this.state.visible=e,this.state.map)){var t=this.state.map.imageryLayers,i=this.state.map.wmsLayerInfos;if(e){for(var s=0;s<i.length;s++)if(this.state.url==i[s].layerOpt.url){i[s].index=t.indexOf(i[s].wmslayer),t.remove(i[s].wmslayer),i[s].layerOpt.layers="";for(var o=0;o<i[s].wmsLayers.length;o++)i[s].wmsLayers[o].state.visible&&(i[s].layerOpt.layers=0!=o?i[s].wmsLayers[o].state.layers+","+i[s].layerOpt.layers:i[s].wmsLayers[o].state.layers);var a=new CgsWebMapLayer3D_(i[s].layerOpt,this);i[s].wmslayer=a,t.add(a,i[s].index),a.setMap(this.state.map);break}}else for(s=0;s<i.length;s++)if(this.state.url==i[s].layerOpt.url&&-1<i[s].layerOpt.layers.indexOf(this.state.layers)){if(0==i[s].layerOpt.layers.indexOf(this.state.layers)?i[s].layerOpt.layers=i[s].layerOpt.layers.replace(this.state.layers,""):i[s].layerOpt.layers=i[s].layerOpt.layers.replace(","+this.state.layers,""),""!=i[s].layerOpt.layers){i[s].index=t.indexOf(i[s].wmslayer),t.remove(i[s].wmslayer);a=new CgsWebMapLayer3D_(i[s].layerOpt,this);i[s].wmslayer=a,t.add(a,i[s].index),a.setMap(this.state.map);break}i[s].wmslayer.setVisible(!1)}}},CgsWebMapLayer3D.prototype.getVisible=function(e){return this.state.visible},CgsWebMapLayer3D.prototype.setPId=function(e){this.state.pId=e},CgsWebMapLayer3D.prototype.getPId=function(){return this.state.pId},CgsWebMapLayer3D.prototype.getMaxVisLevel=function(){return this.state.wmsLayerInfo.wmslayer.state.maxVisLevel},CgsWebMapLayer3D.prototype.getMinVisLevel=function(){return this.state.wmsLayerInfo.wmslayer.state.minVisLevel},CgsXYZLayer3D=function(e){e.layer=e.layer?e.layer:e.name;var t=new Cesium.UrlTemplateImageryProvider(e);CgsLayer3D.call(this,t,e)},CgsInherits(CgsXYZLayer3D,CgsLayer3D),CgsMath3D=function(){},CgsMath3D.EARTH_RADIUS=6378137,CgsMath3D.getRefQuaternion=function(e,t){return t=Cesium.Transforms.headingPitchRollQuaternion(e,new Cesium.HeadingPitchRoll(0,0,0),Cesium.Ellipsoid.WGS84,Cesium.Transforms.eastNorthUpToFixedFrame,t)},CgsMath3D.oriToHeadingPitchRoll=function(e,t){var i=e.getValue(Cesium.JulianDate.fromDate(new Date)),s=new Cesium.Quaternion;(s=CgsMath3D.getRefQuaternion(t,s)).w=-s.w;var o=new Cesium.Quaternion,o=Cesium.Quaternion.multiply(s,i,o),a=new Cesium.HeadingPitchRoll,a=Cesium.HeadingPitchRoll.fromQuaternion(o,a);return[Cesium.Math.toDegrees(a.heading),Cesium.Math.toDegrees(a.pitch),Cesium.Math.toDegrees(a.roll)]},CgsMath3D.calculateIntersection=function(e,t,i,s){var o=t[0]-e[0],a=t[1]-e[1],n=s[0]-i[0],r=s[1]-i[1],l=o*r-n*a;if(l<=Number.MIN_VALUE||l>=Number.MAX_VALUE)return!1;var u=i[0]-e[0],p=e[1]-i[1],h=(r*u+n*p)/l,c=(a*u+o*p)/l;return 0<h&&h<1&&0<c&&c<1},CgsMath3D.isInPolygon=function(e,t){for(var i=!1,s=0,o=e.length-1;s<e.length;o=s,s++){var a=e[o],n=e[s];t[1]<n[1]?t[1]>=a[1]&&(t[1]-a[1])*(n[0]-a[0])>(t[0]-a[0])*(n[1]-a[1])&&(i=!i):t[1]<a[1]&&t[1]>=n[1]&&(t[1]-a[1])*(n[0]-a[0])<(t[0]-a[0])*(n[1]-a[1])&&(i=!i)}return i},CgsMath3D.isDiagonal=function(e,t,i){var s=e.length,o=new Array(.5*(e[t][0]+e[i][0]),.5*(e[t][1]+e[i][1]),0);if(!CgsMath3D.isInPolygon(e,o))return!1;for(var a=0,n=s-1;a<s;n=a,a++)if(a!=t&&a!=i&&n!=t&&n!=i&&CgsMath3D.calculateIntersection(e[t],e[i],e[a],e[n]))return!1;return!0},CgsMath3D.triangulate=function(e,t){var i=e.length;if(i<3)return!1;if(3==i)return t.push(e[0]),t.push(e[1]),t.push(e[2]),!0;for(var s=[],o=0;o<i;o++)s.push(e[o]);for(var a=0,n=1,r=2;a<i;a++,n=(n+1)%i,r=(r+1)%i)if(CgsMath3D.isDiagonal(s,a,r))return t.push(s[a]),t.push(s[n]),t.push(s[r]),s.splice(n,1),CgsMath3D.triangulate(s,t);return!1},CgsMath3D.approxAngularDistance=function(e,t){var i=t[0]-e[0],s=t[1]-e[1],o=Math.sin(Cesium.Math.toRadians(.5*i)),a=Math.sin(Cesium.Math.toRadians(.5*s)),n=a*a+Math.cos(Cesium.Math.toRadians(e[1]))*Math.cos(Cesium.Math.toRadians(t[1]))*o*o,r=Math.sqrt(n);return Cesium.Math.toDegrees(2*Math.asin(1<r?1:r))},CgsMath3D.calcuInterGeoPositionWithoutAltitude=function(e,t,i){var s=Cesium.Math.toRadians(CgsMath3D.approxAngularDistance(t,i));if(0==s)return new Array(t[0],i[1],0);var o=Math.sin(s),a=Math.cos(Cesium.Math.toRadians(t[1])),n=Math.cos(Cesium.Math.toRadians(i[1])),r=Math.sin((1-e)*s)/o,l=Math.sin(e*s)/o,u=r*a*Math.cos(Cesium.Math.toRadians(t[0]))+l*n*Math.cos(Cesium.Math.toRadians(i[0])),p=r*a*Math.sin(Cesium.Math.toRadians(t[0]))+l*n*Math.sin(Cesium.Math.toRadians(i[0])),h=r*Math.sin(Cesium.Math.toRadians(t[1]))+l*Math.sin(Cesium.Math.toRadians(i[1])),c=Cesium.Math.toDegrees(Math.atan2(h,Math.sqrt(u*u+p*p))),g=Cesium.Math.toDegrees(Math.atan2(p,u));return new Array(g,c,0)},CgsMath3D.splitTriangle2GeoPosition=function(e,t,i){for(var s=0,o=0;o<=e;o++)if(0==o)i[s++]=t[0];else for(var a=o/e,n=CgsMath3D.calcuInterGeoPositionWithoutAltitude(a,t[0],t[1]),r=CgsMath3D.calcuInterGeoPositionWithoutAltitude(a,t[0],t[2]),l=0;l<o+1;l++){var u=l/o,p=CgsMath3D.calcuInterGeoPositionWithoutAltitude(u,n,r);i[s++]=p,0}},CgsMath3D.splitLine2GeoPosition=function(e,t,i,s){var o=Cesium.Math.toRadians(approxAngularDistance(t,i)),a=0;if(0==o)return a=t[2],void s.push(t);for(var n=Math.sin(o),r=Math.cos(Cesium.Math.toRadians(t[1])),l=Math.cos(Cesium.Math.toRadians(i[1])),u=0;u<=e;u++){var p=u/e,h=Math.sin((1-p)*o)/n,c=Math.sin(p*o)/n,g=h*r*Math.cos(Cesium.Math.toRadians(t[0]))+c*l*Math.cos(Cesium.Math.toRadians(i[0])),d=h*r*Math.sin(Cesium.Math.toRadians(t[0]))+c*l*Math.sin(Cesium.Math.toRadians(i[0])),m=h*Math.sin(Cesium.Math.toRadians(t[1]))+c*Math.sin(Cesium.Math.toRadians(i[1])),f=Cesium.Math.toDegrees(Math.atan2(m,Math.sqrt(g*g+d*d))),C=Cesium.Math.toDegrees(Math.atan2(d,g)),a=CgsMath3D.getAltitude(C,f);s[u]=new Array(C,f,a),0}},CgsMath3D.splitLine2WorldPosition=function(e,t,i,s){CgsMath3D.splitLine2GeoPosition(e,t,i,s);for(var o=0;o<s.length;o++)s[o]=Cesium.Cartesian3.fromDegrees(s[o][0],s[o][1],s[o][2])},CgsMath3D.splitTriang2Indices=function(e,t){for(var i,s=0,o=0,a=0,n=0,r=0,l=1;l<=e*e;l++)r=(n=(l+(i=Math.ceil(Math.sqrt(l))))%2==1?(a=(s=Math.floor((3*i+l)/2))-i-1,s-i):(a=(s=Math.floor((i+l-1)/2))+i+1,s+i),s),t[o++]=r,t[o++]=n,t[o++]=a},CgsMath3D.lineProjectMeasure=function(e,t){var i=CgsMath3D.approxAngularDistance(e,t);return CgsMath3D.EARTH_RADIUS*Cesium.Math.toRadians(i)},CgsMath3D.geoLineDistanceMeasure=function(e,t){var i=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),s=Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]);return Cesium.Cartesian3.distance(i,s)},CgsMath3D.geoGroundLineDistanceMeasure=function(e,t,i){var s=[];CgsMath3D.splitLine2WorldPosition(i,e,t,s);for(var o=0,a=0;a<s.length-1;a++)o+=Cesium.Cartesian3.distance(s[a],s[a+1]);return o},CgsMath3D.triangleAreaMeasure=function(e,t,i){var s=Cesium.Cartesian3.distance(e,t),o=Cesium.Cartesian3.distance(t,i),a=Cesium.Cartesian3.distance(i,e),n=(s+o+a)/2,r=n*(n-s)*(n-o)*(n-a);return r<0?0:Math.sqrt(r)},CgsMath3D.triangleProjectMeasure=function(e,t,i){var s,o,a,n,r,l,u,p=Cesium.Math.toRadians(CgsMath3D.approxAngularDistance(e,t)),h=Cesium.Math.toRadians(CgsMath3D.approxAngularDistance(t,i)),c=Cesium.Math.toRadians(CgsMath3D.approxAngularDistance(e,i)),g=CgsMath3D.EARTH_RADIUS;return 2<p+h+c?(o=Math.cos(h),a=Math.cos(p),n=Math.cos(c),s=Math.acos((a-n*o)/(Math.sin(h)*Math.sin(c))),g*g*(Math.acos((Math.cos(h)-Math.cos(c)*Math.cos(p))/(Math.sin(p)*Math.sin(c)))+Math.acos((Math.cos(c)-Math.cos(p)*Math.cos(h))/(Math.sin(h)*Math.sin(p)))+s-Math.PI)):(r=Cesium.Cartesian3.fromDegrees(e[0],e[1],0),l=Cesium.Cartesian3.fromDegrees(t[0],t[1],0),u=Cesium.Cartesian3.fromDegrees(i[0],i[1],0),CgsMath3D.triangleAreaMeasure(r,l,u))},CgsMath3D.spiltTriangleProjectMeasure=function(e,t,i,s){if(e===t||e===i||t===i)return 0;var o=[],a=[];o.push(e),o.push(t),o.push(i),CgsMath3D.splitTriangle2GeoPosition(s,o,a);var n=[];CgsMath3D.splitTriang2Indices(s,n);for(var r=[],l=0;l<a.length;l++)r[l]=Cesium.Cartesian3.fromDegrees(a[l][0],a[l][1],0);for(var u=0,p=s*s,h=0;h<p;h++){var c=n[3*l],g=n[3*l+1],d=n[3*l+2];u+=CgsMath3D.triangleAreaMeasure(r[c],r[g],r[d])}return u},CgsMath3D.calcuInsertNum=function(e,t,i,s){var o=0,a=CgsMath3D.lineProjectMeasure(e,t),n=CgsMath3D.geoLineDistanceMeasure(e,t),r=n<a?a:n,a=CgsMath3D.lineProjectMeasure(e,i),l=(n=CgsMath3D.geoLineDistanceMeasure(e,i))<a?a:n,r=l<r?r:l;return a=CgsMath3D.lineProjectMeasure(t,i),r=(l=(n=CgsMath3D.geoLineDistanceMeasure(t,i))<a?a:n)<r?r:l,(o=s<=0?Math.ceil(r/100):Math.ceil(r/s))<1&&(o=1),o},CgsMath3D.calcuTriangleArea=function(e,t,i,s,o){var a=0;if(1e3<e){var n,r,l=Math.ceil(e/1e3);if(1e3<l)a+=CgsMath3D.calcuTriangleArea(l,t,i,s,o);else{n.push(t),n.push(i),n.push(s),CgsMath3D.splitTriangle2GeoPosition(e,n,r);var u=[];CgsMath3D.splitTriang2Indices(e,u);for(var p=l*l,h=0;h<p;h++){var c=u[3*h+1],g=u[3*h+2],d=r[u[3*h]],m=r[c],f=r[g],C=CgsMath3D.calcuInsertNum(d,m,f);a+=CgsMath3D.calcuTriangleArea(C,d,m,f,o)}}}else a+=o?CgsMath3D.spiltTriangleSurfaceMeasure(t,i,s,e):CgsMath3D.spiltTriangleProjectMeasure(t,i,s,e);return a},CgsMath3D.azimuth=function(e,t){var i=Cesium.Math.toRadians(e[0]),s=Cesium.Math.toRadians(e[1]),o=Cesium.Math.toRadians(t[0]),a=Cesium.Math.toRadians(t[1]),n=Math.cos(a),r=Math.sin(i-o)*n,l=Math.cos(s)*Math.sin(a)-Math.sin(s)*n*Math.cos(i-o),u=Math.atan2(r,l);return u<0&&(u+=2*Math.PI),u=2*Math.PI-u},CgsMath3D.isDeasil=function(e,t,i){var s=CgsMath3D.azimuth(e,t),o=CgsMath3D.azimuth(t,i),a=Cesium.Math.toDegrees(o-s);return a<0&&(a+=360),a<180},CgsMath3D.calcuProjectArea=function(e){var t=0;if(3<=e.length)for(var i=0;i<e.length-2;i++){var s=e[0],o=e[i+1],a=e[i+2],n=CgsMath3D.isDeasil(s,o,a)?1:-1;CgsMath3D.calcuInsertNum(s,o,a),t+=CgsMath3D.calcuTriangleArea(insertNum,s,o,a,!1)*n}return t},CgsMath3D.sphericalToCartesian=function(e,t,i){var s=Cesium.Math.toRadians(e),o=Cesium.Math.toRadians(t),a=i*Math.cos(o);return new Array(a*Math.cos(s),a*Math.sin(s),i*Math.sin(o))},CgsMath3D.getCenterPointFromCoordinates=function(e){for(var t=e.length,i=0,s=0,o=0;o<e.length;o++)i+=e[o].longitude,s+=e[o].latitude;return i/=t,s/=t,new Array(i,s)},CgsMath3D.splitCircle2GeoPosition=function(e,t,i,s){var o,a,n=Cesium.Math.toRadians(t),r=Cesium.Math.toRadians(e),l=i/CgsMath3D.EARTH_RADIUS,u=0,p=[],h=2*s*Math.PI/360,c=Math.asin(Math.sin(n)*Math.cos(l)+Math.cos(n)*Math.sin(l)*Math.cos(h));return u=0==Math.cos(n)?r:(o=r-Math.asin(Math.sin(h)*Math.sin(l)/Math.cos(n))+Math.PI,a=2*Math.PI,o-parseInt(o/a)*a-Math.PI),u=Cesium.Math.toDegrees(u),c=Cesium.Math.toDegrees(c),p.push(u),p.push(c),p},CgsMath3D.calcuSlopeAspect=function(e,t){var i=-2;return 0!=t&&(i=Cesium.Math.toDegrees(Math.atan(e/t))),Math.abs(e)<1e-4?Math.abs(t)<1e-4?i=-1:t<0?i=180:0<t&&(i=0):e<0?Math.abs(t)<1e-4?i=270:t<0?i+=180:0<t&&(i+=360):0<e&&(Math.abs(t)<1e-4?i=90:t<0?i+=180:0<t&&(i+=0)),i},CgsMath3D.calcuPositionSlopeAspect=function(e,o,t,a){var i=CgsMath3D.splitCircle2GeoPosition(e[0],e[1],o,0),s=CgsMath3D.splitCircle2GeoPosition(e[0],e[1],o,90),n=CgsMath3D.splitCircle2GeoPosition(e[0],e[1],o,180),r=CgsMath3D.splitCircle2GeoPosition(e[0],e[1],o,270),l=[r[0],i[1]],u=[s[0],i[1]],p=[r[0],n[1]],h=[s[0],n[1]],c=[];c.push(Cesium.Cartographic.fromDegrees(l[0],l[1])),c.push(Cesium.Cartographic.fromDegrees(i[0],i[1])),c.push(Cesium.Cartographic.fromDegrees(u[0],u[1])),c.push(Cesium.Cartographic.fromDegrees(r[0],r[1])),c.push(Cesium.Cartographic.fromDegrees(s[0],s[1])),c.push(Cesium.Cartographic.fromDegrees(p[0],p[1])),c.push(Cesium.Cartographic.fromDegrees(n[0],n[1])),c.push(Cesium.Cartographic.fromDegrees(h[0],h[1]));var g=t&&t.getTerrain();(g instanceof CgsTerrain3D||g instanceof CgsTileTerrain3D)&&Cesium.when(Cesium.sampleTerrain(g,g.level,c),function(e){var t=(e[5].height+2*e[3].height+e[0].height-(e[7].height+2*e[4].height+e[2].height))/(8*o),i=(e[7].height+2*e[6].height+e[5].height-(e[2].height+2*e[1].height+e[0].height))/(8*o),s=CgsMath3D.calcuSlopeAspect(t,i);CgsSubPub.publish("slopeaspect",[s]),"function"==typeof a&&a(s)})},CgsMath3D.calculateAngle=function(e,t){var i=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=t[1][0]-t[0][0],a=t[1][1]-t[0][1],n=(i*o+s*a)/Math.sqrt((i*i+s*s)*(o*o+a*a));return 180*Math.acos(n)/Math.PI},CgsFeature3D=function(e){this.parentFeature=e.parentFeature;this.options=e.temp,this.center=null,this.type=e.type,this.map=null,this.label=null,this.pos=e.pos,this.pickColorFlag=!0,this.labelDraggable=!1,this.saveFlag=Cesium.defaultValue(e.saveFlag,!0),this.attribute=null,this._positionCallback=null,this.entity=null,this.group=null,this.element=null,this.selectFlag=!1,this.dragEnable=!1,this.selectEnable=Cesium.defaultValue(e.selectEnable,!0),this.enableCockpitMode=!1,this.labelstroke=e.labelstroke,this.labelstrokewidth=e.labelstrokewidth,this.labelfill=e.labelfill,this.labelfont=e.labelfont,this.name=e.name,this.labelscale=e.labelscale,this.labeloffset=e.labeloffset,this.labelEyeOffset=e.labelEyeOffset,this.labelVisible=Cesium.defaultValue(e.show,!0),this.scaleByDistance=e.scaleByDistance,this.disableDepthTestDistance=e.disableDepthTestDistance,this.clampToGround=e.clampToGround,this.heightReference=e.heightReference,e.labelDistanceDisplayCondition||e.labelVisibleHeight?this.labelDistanceDisplayCondition=e.labelVisibleHeight||e.labelDistanceDisplayCondition:this.labelDistanceDisplayCondition=0,null==e.groupObject?this.group=null:null==e.groupObject||(this.group=e.groupObject,this.group.push(this)),this.entity=new Cesium.Entity(e.temp),this.entity.feature=this,null==e.label&&null!=this.entity.name&&this.createLabel(this.pos)},CgsFeatureEvent3D=function(){},CgsFeatureEvent3D._setEvent=function(){var a,T=this,M=null,L=null,n=null,r=null,l=null,u=null;T.dragableName=!1;CgsSubPub.subscribe("elementSelected",function(e,t,i,s){var o;t.getEntity()&&(M&&M.getId()!=t.getId()&&M.pickColorFlag&&p(L,M),a=s.getPickColor(),M=t.getElement(),pickColorFlag=M.pickColorFlag,M&&pickColorFlag&&((o=M.getSelectFlag())||("CgsModel"==(L=t.getType())?(M.setSilhouetteSize(3),n=M.getColor(),pickColorFlag&&(M.setSilhouetteColor(a),M.setColor(a)),u=M.getColorBlendAmount(),M.setColorBlendAmount(.5)):"CgsPoint"==L?o||(r=M.getOutlineColor(),pickColorFlag&&M.setOutlineColor(a)):"CgsCircle"==L||"CgsRect"==L||"CgsPolygon"==L||"flyline"==L||"CgsCorridor"==L?o||(l=M.getFillColor(),pickColorFlag&&M.setFillColor(a)):"CgsLine"==L||"CgsParabola"==L?o||(M.lineType!=CgsLine3D.LINT_DASHED?(l=M.getFillColor(),pickColorFlag&&M.setFillColor(a)):(l=M.getEvenColor(),pickColorFlag&&M.setEvenColor(a))):"CgsMark"==L?pickColorFlag&&M.setColor(a):"CgsCylinder"==L||"CgsBox"==L||"CgsEllipse"==L?o||(l=M.getFillColor(),pickColorFlag&&M.setFillColor(a)):"CgsEllipsoid"!=L&&"CgsWall"!=L&&"CgsPolylineVolume"!=L||o||(l=M.getFillColor(),pickColorFlag&&M.setFillColor(a)),M.setSelectFlag(!0))))}),CgsSubPub.subscribe("elementNotSelected",function(e,t,i){M&&M.pickColorFlag&&p(L,M),M&&M.setSelectFlag(!1),M&&M._positionCallback&&((i=M.getMap())&&(i.entities.suspendEvents(),i.entities.resumeEvents()),("CgsModel"!=L&&"CgsMark"!=L&&"CgsPoint"!=L&&"CgsLabel"!=L&&"CgsCircle"!=L&&"CgsCylinder"!=L&&"CgsBox"!=L&&"CgsEllipsoid"!=L&&"CgsEllipse"!=L||"CgsCorridor"==L)&&(M._positionCallback=M._posUpdateCallback(!0),M._positionCallback=null)),M=L=null});function p(e,t){e&&t&&("CgsModel"==e?(t.setColor(n),t.setColorBlendAmount(u),t.setSilhouetteSize(0)):"CgsMark"==e?t.setColor("rgba(255,255,255,1.0)"):"CgsPoint"==e?t.setOutlineColor(r):"CgsCircle"==e||"CgsRect"==e||"CgsPolygon"==e||"CgsCorridor"==e?t.setFillColor(l):"CgsLine"==e||"CgsParabola"==e?t.lineType!=CgsLine3D.LINT_DASHED?t.setFillColor(l):t.setEvenColor(l):"CgsCylinder"!=e&&"CgsBox"!=e&&"CgsEllipsoid"!=e&&"CgsEllipse"!=e&&"CgsWall"!=e&&"CgsPolylineVolume"!=e||t.setFillColor(l))}var e=CgsSubPub.subscribe("elementMove",function(e,t,i,s,o){if(i&&s)T.dragableName=!0;else if(!s)return void(T.dragableName=!1);var a=t.mousePos,n=o?t.cesiumWidget.allViewports[o-1].camera:t.camera,r=n.pickEllipsoid(a,t.scene.globe.ellipsoid);if(r){var l=Cesium.Cartographic.fromCartesian(r,Cesium.Ellipsoid.WGS84),u=Cesium.Math.toDegrees(l.longitude),p=Cesium.Math.toDegrees(l.latitude),h=[];if(M&&M.labelDraggable&&T.dragableName){w=(t.deltaNamePos&&t.deltaNamePos.length,o?t.deltaNamePos_:t.deltaNamePos),h.push(u-w[0]),h.push(p-w[1]);var c,g=M.label.getPosition();"[object Array]"==Object.prototype.toString.call(g[0])&&(g=g[0]),"[object Array]"==Object.prototype.toString.call(g[0])&&(g=g[0]),"[object Array]"!=Object.prototype.toString.call(g[0])&&3==g.length&&g.pop(),c=o?t.mv_lonLatToPixel(g):t.lonLatToPixel(g);var d,m=M.label.getPixelOffset(),f=[a.x,a.y],C=5.5*M.label.getText().length;return m[0]<=0&&m[1]<=0?(f[0]=f[0]+C,f[1]=f[1]+10):0<=m[0]&&m[1]<=0?(f[0]=f[0]-C,f[1]=f[1]+10):m[0]<=0&&0<=m[1]?(f[0]=f[0]+C,f[1]=f[1]-10):0<=m[0]&&0<=m[1]&&(f[0]=f[0]-C,f[1]=f[1]-10),d=o?t.mv_pixelToLonLat(f,o-1):t.pixelToLonLat(f),3==g.length&&(y=g[2],h.push(y)),M.parentFeature.showLineFlag&&M.parentFeature.labelLine&&M.parentFeature.labelLine.setPosition([g,d]),void M.parentFeature.setLabelOffset([a.x-c[0],a.y-c[1]])}if(L&&M&&!M.labelDraggable){var y,h=[];if("CgsModel"==L||"CgsPoint"==L||"CgsCircle"==L||"CgsMark"==L||"CgsCylinder"==L||"CgsBox"==L||"CgsEllipsoid"==L||"CgsEllipse"==L)w=o?t.deltaPos_:t.deltaPos,h.push(u-w[0]),h.push(p-w[1]),3==(g=M.getPosition()).length&&(y=g[2],h.push(y)),M.setPosition(h);else if("CgsLine"==L||"CgsRect"==L||"CgsPolygon"==L||"CgsParabola"==L){M._positionCallback||(M._positionCallback=M._posUpdateCallback(!1));g=M.getPosition();"CgsParabola"==L&&(g=M.getPositions());for(var v=0;v<g.length;v++){var b=[],D=g[v];if(w=o?t.deltaPos_[v]:t.deltaPos[v],"[object Array]"==Object.prototype.toString.call(D[0])&&"[object Array]"==Object.prototype.toString.call(w[0])){for(var S=0;S<D.length;S++){D[S];var _=w[S];(P=[]).push(u-_[0]),P.push(p-_[1]),b.push(P)}h.push(b)}else{(_=[]).push(u-w[0]),_.push(p-w[1]),h.push(_)}}"CgsParabola"==L?M.setPositions(h,!1):M.setPosition(h)}else if("CgsCorridor"==L||"CgsWall"==L||"CgsPolylineVolume"==L){for(g=M.getPosition(),v=0;v<g.length;v++){var w,b=[],D=g[v];if(w=o?t.deltaPos_[v]:t.deltaPos[v],"[object Array]"==Object.prototype.toString.call(D[0])&&"[object Array]"==Object.prototype.toString.call(w[0])){for(S=0;S<D.length;S++){D[S];var P,_=w[S];(P=[]).push(u-_[0]),P.push(p-_[1]),b.push(P)}h.push(b)}else{(_=[]).push(u-w[0]),_.push(p-w[1]),_.push(D[2]),h.push(_)}}M.setPosition(h)}}}});this.pickMoveEvent=e;CgsSubPub.subscribe("featuredragend",function(e,t){pickColorFlag&&p(L,M),M&&M.setSelectFlag(!1)}),CgsSubPub.subscribe("elementHeight",function(e,t,i){if(L&&M&&t.startPosition.y!=t.endPosition.y){i.startPos,i.mousePos;var s=i.getHeight(),o=s/2e3;o<1&&(o=s/1e3),o<1&&(o=s/100),o<1&&(o=2);var a=(t.startPosition.y-t.endPosition.y)*o,n=[];if("CgsModel"==L||"CgsPoint"==L||"CgsMark"==L||"CgsCylinder"==L||"CgsBox"==L||"CgsEllipse"==L||"CgsEllipsoid"==L){var r=M.getPosition();n.push(r[0]),n.push(r[1]),3==r.length?(p=r[2]+(0<a?r[2]/150:r[2]/-150)+a/30,n.push(p)):n.push(a),n[2]<0&&(n[2]=0),"CgsCylinder"==L&&n[2]<=M.getLength()/2&&(n[2]=M.getLength()/2),M.setPosition(n)}else if("CgsLine"==L||"CgsPolylineVolume"==L){M._positionCallback||"CgsLine"!=L||M._posUpdateCallback(!1);for(var r=M.getPosition(),l=0;l<r.length;l++){var u=r[l];if("[object Array]"==Object.prototype.toString.call(u[0]))return;var p,h=[];h.push(u[0]),h.push(u[1]),3==u.length?(p=u[2]+(0<a?u[2]/150:u[2]/-150)+a/30,h.push(p)):h.push(a),h[2]<0&&(h[2]=0),n.push(h)}M.setPosition(n)}else if("CgsRect"==L||"CgsPolygon"==L||"CgsCircle"==L){M._positionCallback||"CgsRect"!=L&&"CgsPolygon"!=L||M._posUpdateCallback(!1);var c=M.getHeight();(c+=(0<a?c/150:c/-150)+a/30)<0&&(c=0),M.setHeight(c)}else if("CgsCorridor"==L||"CgsParabola"==L){c=M.getExtrudedHeight();(c+=(0<a?c/150:c/-150)+a/30)<0&&(c=0),M.setExtrudedHeight(c)}else if("CgsWall"==L){for(n=M.getPosition(),l=0;l<n.length;l++){c=n[l][2];(c+=(0<a?c/150:c/-150)+a/30)<0&&(c=0),n[l][2]=c}M.setPosition(n)}}})},CgsFeature3D.prototype.setGroup=function(e){this.group=e},CgsFeature3D.prototype.getGroup=function(){return this.group},CgsFeature3D.prototype.setMap=function(e){this.map=e;var t=this;!e||"CgsPolygon"!=t.type&&"CgsRect"!=t.type&&"CgsCircle"!=t.type||e.clock.onTick.addEventListener(function(e){!t.map||"CgsPolygon"!=t.type&&"CgsRect"!=t.type||(t.map.scene.globe.depthTestAgainstTerrain?0==t.entity.polygon.height&&0==t.entity.polygon.extrudedHeight&&(t.entity.polygon.height=void 0,t.entity.polygon.extrudedHeight=void 0,t.outline&&(t.entity.polygon.outline=!1)):t.entity.polygon.outline._value||t.outline&&(t.entity.polygon.outline=!0,0==t.height&&0==t.extrudedHeight&&(t.entity.polygon.height=0,t.entity.polygon.extrudedHeight=0))),t.map&&"CgsCircle"==t.type&&(t.map.scene.globe.depthTestAgainstTerrain?0==t.entity.ellipse.height&&(t.entity.ellipse.height=void 0,t.outline&&(t.entity.ellipse.outline=!1)):t.entity.ellipse.outline._value||t.outline&&(t.entity.ellipse.outline=!0,0==t.height&&(t.entity.ellipse.height=0)))}),this.map&&"CgsLine"==this.type&&this.clampToGround&&(this.map.scene.globe.depthTestAgainstTerrain?this.entity.polyline.clampToGround=!0:this.entity.polyline.clampToGround=!1)},CgsFeature3D.prototype.getMap=function(){return this.map},CgsFeature3D.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsFeature3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsFeature3D.prototype.getName=function(){return this.entity.name},CgsFeature3D.prototype.setName=function(e){this.entity.name=e,null!=this.label?this.label.setText(e):this.createLabel(this.pos)},CgsFeature3D.prototype.setVisible=function(e){null==this.options&&(this.options={});var t=e!=this.getVisible();if(this.options.show=e,this.parentFeature&&this.parentFeature.cluster&&(this.visibleSetValue=e,this.clusterShow=e),"flyline"==this.type)for(var i=0;i<this.entities.length;i++)this.entities[i].show=e;else this.entity.show=e;null!=this.label&&(this.label.getVisibled()?this.label.setVisible(e):this.label.setVisible(!1)),t&&CgsSubPub.publish("featureVisibleChange",[this,e])},CgsFeature3D.prototype.getVisible=function(){return this.visibleSetValue?this.visibleSetValue:this.entity.show},CgsFeature3D.prototype.setOption=function(e){this.options=e},CgsFeature3D.prototype.getOption=function(){return this.options},CgsFeature3D.prototype.getCenter=function(){return this.center},CgsFeature3D.prototype.getType=function(){return this.type},CgsFeature3D.prototype.setType=function(e){this.type=e},CgsFeature3D.prototype.getId=function(){return this.entity.id},CgsFeature3D.prototype.getEntity=function(){return this.entity},CgsFeature3D.prototype.createLabel=function(e){var t,i,s,o,a,n;null==this.options.label&&((t=a=o=s=null)!=this.options.position?(t=this.options.position,i=Cesium.Cartographic.fromCartesian(t,Cesium.Ellipsoid.WGS84),s=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),a=i.height):(s=e[0],o=e[1],3==e.lenght&&(a=e[2])),n={name:this.entity.name,show:this.labelVisible,position:[s,o,a],labelstroke:this.labelstroke,labelstrokewidth:this.labelstrokewidth,labelfill:this.labelfill,labelfont:this.labelfont,labelscale:this.labelscale,labeloffset:this.labeloffset,eyeOffset:this.labelEyeOffset,scaleByDistance:this.scaleByDistance,disableDepthTestDistance:this.disableDepthTestDistance,clampToGround:this.clampToGround,distanceDisplayCondition:this.labelDistanceDisplayCondition,heightReference:this.heightReference},a||(n.position=[s,o,a]),this.label=new CgsLabel3D(n),this.label.feature=this)},CgsFeature3D.prototype.getLabel=function(){return this.label},CgsFeature3D.prototype.setElement=function(e){this.element=e},CgsFeature3D.prototype.getElement=function(){return this.element},CgsFeature3D.prototype.setSelectFlag=function(e){this.selectFlag=e},CgsFeature3D.prototype.getSelectFlag=function(){return this.selectFlag},CgsFeature3D.prototype.setDragEnable=function(e){this.dragEnable=e},CgsFeature3D.prototype.getDragEnable=function(){return this.dragEnable},CgsFeature3D.prototype.setSelectEnable=function(e){this.selectEnable=e},CgsFeature3D.prototype.getSelectEnable=function(){return this.selectEnable},CgsFeature3D.prototype.setAttribute=function(e){this.attribute=e},CgsFeature3D.prototype.getAttribute=function(){return this.attribute},CgsFeature3D.prototype.setEnableCockpitMode=function(e){this.enableCockpitMode=e},CgsFeature3D.prototype.getEnableCockpitMode=function(e){return this.enableCockpitMode},CgsFeature3D.prototype.getLabelDraggable=function(){return this.labelDraggable},CgsFeature3D.prototype.setLabelDraggable=function(e){this.labelDraggable=e},CgsFeatureGroup3D=function(e){this.name=e,this.array=new Array},CgsFeatureGroup3D.prototype.addFeature=function(e){return null==e.getGroup()?(e.setGroup(this),this.array.push(e)):0},CgsFeatureGroup3D.prototype.removeAllFeatures=function(){this.array=new Array},CgsFeatureGroup3D.prototype.removeFeature=function(e){for(var t=0;t<this.array.length;++t)e==this.array[t]&&this.array.splice(t,1)},CgsFeatureGroup3D.prototype.getFeatures=function(){return this.array},CgsFeatureGroup3D.prototype.save=function(){},CgsFeatureGroup3D.prototype.setVisible=function(e){for(var t=0;t<this.array.length;t++){this.array[t].setVisible(e)}},CgsPoint3D=function(e){var t=null;e.type="CgsPoint",null==e?(this.pos1=[-75.59777,40.03883,0],this.position=Cesium.Cartesian3.fromDegrees(-75.59777,40.03883),this.fillColor="(255,255,255,0.4)",this.outlineColor="rgba(0,153,255,1.0)",this.outlineWidth=1,this.name="",this.pixelSize=10,this.distanceDisplayCondition=0,this.heightReference=Cesium.HeightReference.NONE):(null==e.position?(this.pos1=[-75.59777,40.03883,0],this.position=Cesium.Cartesian3.fromDegrees(-75.59777,40.03883)):(this.pos1=e.position,3==e.position.length?this.position=Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1],e.position[2]):this.position=Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1],0)),null==e.fillColor?this.fillColor="rgba(255,255,255,0.4)":this.fillColor=e.fillColor,null==e.outlineColor?this.outlineColor="rgba(0,153,255,1.0)":this.outlineColor=e.outlineColor,null==e.outlineWidth?this.outlineWidth=1:this.outlineWidth=e.outlineWidth,null==e.name?this.name="":this.name=e.name,null==e.pixelSize?this.pixelSize=10:this.pixelSize=2*e.pixelSize,this.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0,this.pos1[2]?this.heightReference=Cesium.defaultValue(e.heightReference,Cesium.HeightReference.NONE):this.heightReference=Cesium.defaultValue(e.heightReference,Cesium.HeightReference.CLAMP_TO_GROUND)),this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition),t={name:this.name,position:this.position,point:{color:Cesium.Color.fromCssColorString(this.fillColor),pixelSize:this.pixelSize-2*this.outlineWidth,outlineColor:Cesium.Color.fromCssColorString(this.outlineColor),outlineWidth:this.outlineWidth,distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition),heightReference:this.heightReference}},!0===e.disableDepthTestDistance&&(t.point.disableDepthTestDistance=Number.POSITIVE_INFINITY),e.temp=t,e.pos=e.position,CgsFeature3D.call(this,e);var i=this;function s(){var e=i.getPosition();return Cesium.Cartesian3.fromDegrees(e[0],e[1])}var o=null;this._posCallback=null,this._posUpdateCallback=function(e){return e?(i._posCallback.setCallback(function(){},!0),i._posCallback=null,this.entity.position=o):(i._posCallback=new Cesium.CallbackProperty(s,e),this.entity.position=i._posCallback,o=i._posCallback),i._posCallback}},CgsInherits(CgsPoint3D,CgsFeature3D),CgsPoint3D.prototype.setFillColor=function(e){this.fillColor=e,this.entity.point.color=Cesium.Color.fromCssColorString(this.fillColor)},CgsPoint3D.prototype.getFillColor=function(){return this.fillColor},CgsPoint3D.prototype.setPosition=function(e){this.pos1=e,this.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),this.entity.position=this.position,null!=this.label&&this.label.setPosition(e)},CgsPoint3D.prototype.getPosition=function(){return this.pos1},CgsPoint3D.prototype.setOutlineColor=function(e){this.outlineColor=e,this.entity.point.outlineColor=Cesium.Color.fromCssColorString(this.outlineColor)},CgsPoint3D.prototype.getOutlineColor=function(){return this.outlineColor},CgsPoint3D.prototype.setColor=function(e){this.setFillColor(e),this.setOutlineColor(e)},CgsPoint3D.prototype.setOutlineWidth=function(e){this.outlineWidth=e,this.entity.point.outlineWidth=this.outlineWidth},CgsPoint3D.prototype.getOutlineWidth=function(){return this.outlineWidth},CgsPoint3D.prototype.setPixelSize=function(e){this.pixelSize=2*e,this.entity.point.pixelSize=this.pixelSize-2*this.outlineWidth},CgsPoint3D.prototype.getPixelSize=function(){return this.pixelSize/2},CgsPoint3D.prototype.setVisibleHeight=function(e){this.distanceDisplayCondition=e,"[object Array]"==Object.prototype.toString.call(e)?(this.entity.point.distanceDisplayCondition=new Cesium.DistanceDisplayCondition(e[0],e[1]),this.entity.point.disableDepthTestDistance=100):(this.entity.point.distanceDisplayCondition=new Cesium.DistanceDisplayCondition(e),this.entity.point.disableDepthTestDistance=Number.MAX_VALUE),null!=this.label&&this.label.setVisibleHeight(e)},CgsPoint3D.prototype.getVisibleHeight=function(){return this.distanceDisplayCondition},CgsPoint3D.prototype.setHeightReference=function(e){this.heightReference=e,this.entity.point.heightReference=this.heightReference},CgsPoint3D.prototype.getHeightReference=function(){return this.heightReference},CgsPoint3D.CLAMP_TO_GROUND=Cesium.HeightReference.CLAMP_TO_GROUND,CgsPoint3D.NONE=Cesium.HeightReference.NONE,CgsPoint3D.RELATIVE_TO_GROUND=Cesium.HeightReference.RELATIVE_TO_GROUND,CgsLine3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t=null,r=this;e.type="CgsLine",null==e?(this.name="",this.positions=[[-75.1,39.57],[-77.02,38.53],[-80.5,35.14],[-80.12,25.46]],this.fillColor="rgba(0,153,255,1.0)",this.width=1,this.show=!0,this.lineType=0,this.glowPower=1,this.outlineWidth=0,this.outlineColor="rgba(0,153,255,1.0)",this.distanceDisplayCondition=0,this.clampToGround=!1,this.classificationType=Cesium.ClassificationType.BOTH,this.zIndex=0):(null==e.name?this.name="":this.name=e.name,null==e.positions?this.positions=[-75,43,5e4,-125,43,5e4]:this.positions=e.positions,null==e.fillColor?this.fillColor="rgba(0,153,255,1.0)":this.fillColor=e.fillColor,null==e.width?this.width=1:this.width=e.width,null==e.show?this.show=!0:this.show=e.show,null==e.lineType?this.lineType=0:this.lineType=e.lineType,null==e.glowPower?this.glowPower=1:this.glowPower=e.glowPower,null==e.outlineWidth?this.outlineWidth=0:this.outlineWidth=e.outlineWidth,null==e.outlineColor?this.outlineColor="rgba(0,153,255,1.0)":this.outlineColor=e.outlineColor,this.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0,this.useDynamicColor=Cesium.defaultValue(e.useDynamicColor,!1),this.dynamicColor=Cesium.defaultValue(e.dynamicColor&&Cesium.Color.fromCssColorString(e.dynamicColor),void 0),this.currentIndex=0,this.clampToGround=e.followSurface||!1),this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition);var i=this.positions,s=new Array;if("[object Array]"==Object.prototype.toString.call(i[0])||$$.isArray(i[0]))for(var o=0;o<i.length;o++){for(var a=i[o],n=0;n<a.length;n++)s.push(a[n]);a.length<3&&s.push(0)}else s=i;null==e.classificationType?this.classificationType=Cesium.ClassificationType.BOTH:this.classificationType=e.classificationType,this.clampToGround&&(null==e.zIndex?this.zIndex=0:this.zIndex=e.zIndex),t=this.lineType==CgsLine3D.LINT_TYPE_1?{name:this.name,show:this.show,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(s),width:this.width,material:new Cesium.PolylineGlowMaterialProperty({glowPower:this.glowPower,color:Cesium.Color.fromCssColorString(this.fillColor)}),distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition),clampToGround:this.clampToGround,classificationType:this.classificationType,zIndex:this.zIndex}}:this.lineType==CgsLine3D.LINT_TYPE_2?{name:this.name,show:this.show,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(s),width:this.width,material:new Cesium.PolylineOutlineMaterialProperty({outlineWidth:this.outlineWidth,outlineColor:Cesium.Color.fromCssColorString(this.outlineColor),color:Cesium.Color.fromCssColorString(this.fillColor)}),distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition),clampToGround:this.clampToGround,classificationType:this.classificationType,zIndex:this.zIndex}}:this.lineType==CgsLine3D.LINT_TYPE_3?{name:this.name,show:this.show,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(s),width:this.width,material:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.fromCssColorString(this.fillColor)),distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition),clampToGround:this.clampToGround,classificationType:this.classificationType,zIndex:this.zIndex}}:this.lineType==CgsLine3D.LINT_TYPE_4?{name:this.name,show:this.show,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(s),clampToGround:this.clampToGround,width:this.width,distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition)}}:this.lineType==CgsLine3D.LINT_TYPE_5?{name:this.name,show:this.show,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(s),width:this.width,distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition),clampToGround:this.clampToGround,classificationType:this.classificationType,zIndex:this.zIndex}}:{name:this.name,show:this.show,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(s),width:this.width,distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition),material:Cesium.Color.fromCssColorString(this.fillColor),clampToGround:this.clampToGround,classificationType:this.classificationType,zIndex:this.zIndex}},!0===e.disableDepthTestDistance&&(t.polyline.disableDepthTestDistance=Number.POSITIVE_INFINITY),e.temp=t,e.pos=s,CgsFeature3D.call(this,e),this.pos=s;function l(){var e,t=r.getPosition(),i=!1,s=[];if("[object Array]"==Object.prototype.toString.call(t[0]))for(var o=0;o<t.length;o++){i=(3==t[o].length||t[o].push(0),!0);for(var a=t[o],n=0;n<a.length;n++)s.push(a[n])}else s=t;return e=i?Cesium.Cartesian3.fromDegreesArrayHeights(s):Cesium.Cartesian3.fromDegreesArray(s),e}this._posCallback=null,this._posUpdateCallback=function(e){return e?r._posCallback&&(r._posCallback.setCallback(l,!0),r._posCallback=null):(r._posCallback=new Cesium.CallbackProperty(l,e),this.entity.polyline.positions=r._posCallback,r._posCallback),r._posCallback}}),CgsInherits(CgsLine3D,CgsFeature3D),CgsLine3D.prototype.setPosition=function(e,t){this.positions=e;var i=this.positions,s=!1,o=new Array;if("[object Array]"==Object.prototype.toString.call(i[0])||$$.isArray(i[0]))for(var a=0;a<i.length;a++){3==i[a].length&&(s=!0);for(var n=i[a],r=0;r<n.length;r++)o.push(n[r])}else o=i;this.pos=o,this.entity.polyline.positions=t?1==s?Cesium.Cartesian3.fromDegreesArrayHeights(o):Cesium.Cartesian3.fromDegreesArray(o):new Cesium.CallbackProperty(function(){return o[0],o[1],o[2],o[3],1==s?Cesium.Cartesian3.fromDegreesArrayHeights(o):Cesium.Cartesian3.fromDegreesArray(o)},!1),null!=this.label&&this.label.setPosition(e[0])},CgsLine3D.prototype.getPosition=function(){return this.positions},CgsLine3D.prototype.setFillColor=function(e){this.lineType!=CgsLine.LINT_TYPE_4&&this.lineType!=CgsLine3D.LINT_TYPE_5&&(this.fillColor=e,this.lineType==CgsLine3D.LINT_TYPE_1||this.lineType==CgsLine3D.LINT_TYPE_2?this.entity.polyline.material.color=Cesium.Color.fromCssColorString(e):this.lineType==CgsLine3D.LINT_TYPE_3?this.entity.polyline.material=new Cesium.PolylineArrowMaterialProperty(Cesium.Color.fromCssColorString(this.fillColor)):this.entity.polyline.material=Cesium.Color.fromCssColorString(e))},CgsLine3D.prototype.getFillColor=function(){return this.fillColor},CgsLine3D.prototype.setWidth=function(e){this.entity.polyline.width=e,this.width=e},CgsLine3D.prototype.getWidth=function(){return this.width},CgsLine3D.prototype.setGlowPower=function(e){this.glowPower=e,this.entity.polyline.material.glowPower=e},CgsLine3D.prototype.getGlowPower=function(){return this.glowPower},CgsLine3D.prototype.setOutlineColor=function(e){this.outlineColor=e,this.entity.polyline.material.outlineColor=Cesium.Color.fromCssColorString(e)},CgsLine3D.prototype.getOutlineColor=function(){return this.outlineColor},CgsLine3D.prototype.setOutlineWidth=function(e){this.outlineWidth=e,this.entity.polyline.material.outlineWidth=e},CgsLine3D.prototype.getOutlineWidth=function(){return this.outlineWidth},CgsLine3D.prototype.getLineType=function(){return this.lineType},CgsLine3D.prototype.setFollowSurface=function(e){this.clampToGround=e,this.entity.polyline.clampToGround=e},CgsLine3D.prototype.getFollowSurface=function(){return this.clampToGround},CgsLine3D.prototype.getPointInLine=function(e){var t=e;Cesium.defined(t)||(t=.5);var i=this.positions;if(!(i.length<2)){var s=!1;3===i[0].length&&(s=!0);for(var o=i.length,a=new Cesium.EllipsoidGeodesic,n=0,r=[],l=0;l<o-1;++l){var u=i[l],p=i[l+1],h=void 0,c=void 0,c=s?(h=Cesium.Cartographic.fromDegrees(u[0],u[1],u[2]),Cesium.Cartographic.fromDegrees(p[0],p[1],p[2])):(h=Cesium.Cartographic.fromDegrees(u[0],u[1]),Cesium.Cartographic.fromDegrees(p[0],p[1]));a.setEndPoints(h,c),n+=a.surfaceDistance,r.push({index:l,distance:n})}for(var g=n*t,d=0,m=0,f=r.length,C=0,y=0;y<f;++y){var v=r[y],b=v.distance;if(g<=b){d=v.index,m=g-C;break}C=b}var D=i[d],S=i[d+1],_=void 0,w=void 0,P=0,T=0;s?(_=Cesium.Cartographic.fromDegrees(D[0],D[1],D[2]),w=Cesium.Cartographic.fromDegrees(S[0],S[1],S[2]),T=D[2],P=S[2]-D[2]):(_=Cesium.Cartographic.fromDegrees(D[0],D[1]),w=Cesium.Cartographic.fromDegrees(S[0],S[1])),a.setEndPoints(_,w);var M=a.surfaceDistance,L=a.interpolateUsingSurfaceDistance(m);return L.height=T+P*(m/M),[Cesium.Math.toDegrees(L.longitude),Cesium.Math.toDegrees(L.latitude),L.height]}},CgsLine3D.prototype.setVisibleHeight=function(e){this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition);this.entity.polyline.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsLine3D.prototype.getVisibleHeight=function(e){return this.distanceDisplayCondition},CgsLine3D.LINT_TYPE_1=1,CgsLine3D.LINT_TYPE_2=2,CgsLine3D.LINT_TYPE_3=3,CgsLine3D.LINT_TYPE_4=4,CgsLine3D.LINT_TYPE_5=5,CgsLine3D.LINT_GLOW=1,CgsLine3D.LINT_OUTLINE=2,CgsLine3D.LINT_ARROW=3,CgsLine3D.LINT_DASH=4,CgsLine3D.LINT_DASHED=5,CgsPolygon3D=function(e){var t,i=null,f=this;e.type="CgsPolygon",null==e?(this.positions=[[-108,42,5e3],[-100,42,5e3],[-104,40,5e3]],this.fillColor="(255,255,255,0.4)",this.outlineColor="rgba(0,153,255,1.0)",this.outlineWidth=1,this.extrudedHeight=0,this.height=0,this.name="",this.closeTop=!0,this.closeBottom=!0,this.outline=!0,this.fill=!0,this.distanceDisplayCondition=0):(null==e.positions?this.positions=[[-108,42,5e3],[-100,42,5e3],[-104,40,5e3]]:this.positions=e.positions,e.imageMaterial?this.imageMaterial=e.imageMaterial:e.linearGradient?(t=e.linearGradient,this.imageMaterial=CgsUtil.createLinearGradientCanvas(t.elevationsRamp,t.direction)):null==e.fillColor?this.fillColor="rgba(255,255,255,0.4)":this.fillColor=e.fillColor,null==e.outlineColor?this.outlineColor="rgba(0,153,255,1.0)":this.outlineColor=e.outlineColor,null==e.outlineWidth?this.outlineWidth=1:this.outlineWidth=e.outlineWidth,null==e.name?this.name="":this.name=e.name,null==e.extrudedHeight?this.extrudedHeight=0:this.extrudedHeight=e.extrudedHeight,null==e.height?this.height=0:this.height=e.height,null==e.closeTop?this.closeTop=!0:this.closeTop=e.closeTop,null==e.closeBottom?this.closeBottom=!0:this.closeBottom=e.closeBottom,null==e.outline?this.outline=!0:this.outline=e.outline,null==e.fill?this.fill=!0:this.fill=e.fill,this.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0),this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition);var s=this.positions,o=!1,a=!1,n=[],r=[],l=new Array;if("[object Array]"==Object.prototype.toString.call(s[0])||$$.isArray(s[0])){var u=s[0];if("[object Array]"==Object.prototype.toString.call(u[0])){a=!0;for(var p=0,h=u.length;p<h;p++){3==u[p].length&&(o=!0);for(var c=u[p],g=0;g<c.length;g++)n.push(c[g]),r.push(c[g])}for(var d=1;d<s.length;d++){for(var m={positions:null},C=new Array,y=s[d],p=0;p<y.length;p++){3==y[p].length&&(o=!0);for(var v=y[p],g=0;g<v.length;g++)C.push(v[g])}m.positions=o?Cesium.Cartesian3.fromDegreesArrayHeights(C):Cesium.Cartesian3.fromDegreesArray(C),l.push(m)}}else for(p=0;p<s.length;p++){3==s[p].length&&(o=!0);for(v=s[p],g=0;g<v.length;g++)n.push(v[g]),r.push(v[g])}}else r=[].concat(_toConsumableArray(n=s));2<=r.length&&(o?(r.push(r[0]),r.push(r[1]),r.push(r[2]),r.push(r[3]),r.push(r[4]),r.push(r[5])):(r.push(r[0]),r.push(r[1]),r.push(r[2]),r.push(r[3])));var b=void 0;isNaN(this.extrudedHeight)||(b=parseFloat(this.extrudedHeight)),isNaN(this.height)||(isNaN(this.extrudedHeight)&&(b=0),b+=parseFloat(this.height)),i=1==o?1==a?{name:this.name,polygon:{hierarchy:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(n),holes:l},material:new Cesium.ImageMaterialProperty({image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdMAAABECAYAAADa6t/iAAAAAXNSR0IArs4c6QAAIABJREFUeF7tnQe4FNX5xn+roojSLSACCgpGJBaaYEHFCkgvAgIKSIdL59JsgGhUEEGMNYndqNgTa4zRGBtq7EixICICF6QXdf7PO+fMzvbdu3eXS/jPPI+PiXd2d+Y753z1/d4vRHAFEggkEEggkEAggUACJZJAqESfDj4cSCCQQCCBQAKBBAIJEBjTYBMEEggkEEggkEAggRJKIDCmJRRg8PFAAoEEAgkEEggkEBjTYA8EEggkEEggkEAggRJKIDCmJRRg8PFAAoEEAgkEEggkEBjTYA8EEggkEEggkEAggRJKIDCmJRRg8PFAAoEEAgkEEggkEBjTYA8EEggkEEggkEAggRJKIDCmJRRg8PFAAoEEAgkEEggkEBjTYA9kLAHHcZoBpwC/AG+EQqEvM/5wCW50HKcG0AaoBnwUCoWeKcHXBR8NJBBI4H9UAo7jHAt0Aw4D3gGeCoVCW/eE1wmM6Z6wCv8Dz+A4zsmwbjLc2BzK/wY9iqDON8C7dkN/no/XcBynHDAG7ukD/6oIbTdC1+XAP4EHQ6HQd6l+13GcOsBIoDnwK/A98D7wZCgUWpKPZw6+M5BAIIH8SMBxnAkwcwi8VRH6rYHObwH3h0Khf+TnFzP/1t1iTB3HaQ10BQ4CFgP/CIVCr2X+mP+7d1pjoPc/HpBhWCZDUFqK3BqXLkAt4CtrCFMaJEnfcZwW8P610PU0+KYs7OvAUduhexGM/RSq3BkKhRbmeqUcx6kCjIMeA+DRQ833V98Jl62Bma8Dt4dCoTeT/a7jOM3h2RthUBNYvx/U3gGdi2DcMqj8MvCnUCi0MtfPHXxfIIH/JQk4jtMSaAgcAlQAdCY+C4VCL+wp7+E4jqLRCXBBP3ipMuz/G3QsggXvQZW786F/ivPueTemVgCToU8PeLs8nL0RBq6BRlLkUoaPhEKhn4rz0HvyvY7jXAw0AI6S1gcOhWeqwlOVYOO+0GQLDPweKnuRVV4iuhTGZTzcNhCeqwpnbYKBX0PlV9IZFbuOY2FYb7jzcPhlH/Mb2kJn/wyv/hW4PhQKKWrM6eU4Tn+4ayyMOxY27me+XMa8x09w/13AnFAoVJToRx3HkdMwCTp3hSergBMyz3zILhizEgofBm7Zm/ZgToUffNleJQHr3KtkIsOps6HSSRV4piJ8WRYWlYOdIaj6CwxZDY1eBObuCQ6nffbJ0G0gPGYda53lFhvhmX9DlfmhUOhvpbVgu8OYKhobBZMGw5wasGMfowjrbDeLNVoR6rxQKPRhaQkhm991HOdCG21qQ2ph9U8lsyn/cxC8czAsKQtryph3jryq/AKDV8NMvfPjoVDoL9k8Q3E/40d5/fvBXw6D30JQZRcM+xGukUG9LRQKLUphiM+HD6ZA56YmOvWus36G1/JpTOU1j4V658KSA30j3qYInpXsZMSTOmSO4/SDu8ZFG2N9S93tsPTvwKxQKPReceUZ3B9IYE+VgHV+zwWOBoQ5UIanKlDR6Cg59/8tB98cAD/vB78msAXSUzcthsv/EAqF7ivtd7XYiUJo0xP+pvex1z4O9FoD990D3JTMsc738+fdmOoFHMc5G4rGQ9OzYJlVhvpL2d9g7HcwQ4t1e75fNpPvt96PUtLn2c23C1hrQzClQJSqLg/PVIAPyxlPbmlZWLU/bNrX35Ra4LL651fQpvzJ/t2xjyHRN9wCNy2F8x4AFuSzkG7f63J4ry90aQjfRRhDrcO4FTBdHuicFMZUjkMhtL0Enq9s7tP7TfkOpio6nJeJjIt7j40up0GL7vCf8ubzlXfBzV/B5To8f071nSZFXTQZGreCr+17hxTZroEHH7UHMG2qO/Y3HMeRd99CQkjw+1roFcCLidbVAinOMHsp7tJnVwMvl5ZiKO4a7en32/2v8kZT4AhbcvEeW7V0pTXlSD6XKgqzDql0w+FWJ6R6dX3vJ6FQSBm43XLZPTkUNjSBpyob/fTZgbBif1hbJlpHpXok6a/fb4U7/gtNdcae3C0vkOJHHMc5BxZNhS7No535sDH1HOuEWap8P//uMqbKdU+GNr2jPYryv8CsJTBMkUWpez7W8J9oDMb5F8Jn5aDcr+AFllv3gaIysD1kojpdB/wGB/0KR+400fZJ2+DkrdBuE7ARkDEOwSvVoc+xsOqA6EWttQPu+BAunJ6vFIX1UvvD+12g1+/gqwiHRlmCk7bAgk+gqYypjEvCyyqksTBiMPyxmkn1yqjN+Qz6XpUvlK31SCdD5+6wUN41cNJm+PBZG1V+ksaYCgE4BZp3hLdVD7LG+JYvoM+MUCj0WDYHzYAh7u9v0vgCOEdelX+FYZ9Co2sTKVPHcUbD3YPhhaoGFxX72eGL4RQ920vZPFvwGSMBu2f7ABfDffXhgarwxYFQZMsFukvO5FE74OINUKCyh0owDyVCqzuOo+zMVJhfH9bvm1zOWv/GW6HBdmi53jpWHwFPh0KhvJV2HMfpAg9Mg9G/M8Yz00vqTHpMmIJGW6DfWmgptP4ToVDowUy/JV/32XUcDwVXwILqfplJ+rn/T3Dr24DqpntvmjdiQ8coYf3l2G3w1XNWIe4RaV4/ldDtEniiqm80tdkO3QVH7oBjtpva59mboZGM5gYbva6xaNEvIxfVcZxGpm5XtzUsjzBkkoE27+xPoZOUbs5bPhzHEfBpEDxwEUypBd9ZY17GgcabYPIqaPupRbemPTSO4wyB6ePgutqwfV84bCfc9iF0mZwvRJ11Bgqh26V+raTrGvirHDBlNVLW3O2aXgUtLvEj26O3w3svQ1WleP+TjRJwHGcqFAyB26vDrhjH9OBf4fqvYNh1oVBImYfw5b9Pp97wpLIdMddhu+D2j6HTNaFQSA5DcGUhAZvRGAaPt4OrasEX5cDLDCX7wnAJ5l/AHbGOkMFELLwKhvwefsrQWMlYh4FvMtYqbSU01lm8ZtRH7DsPh0Xnwx9qGJzKWus4KABQyUkykC6TE60goPkWaLUZ6iii+xEQyv1foVBIAL094nIcpyO8Ow66nuJn1cr/CuNXwjQ5nMrslaoN2S2RqTWoQ2HyBJhd068hnrYR3pSikcLZYxCVxvssGgVtTzORjDbffr/BsNVwizygpYDSgu+FQqF37Aa+yAKPlELSIdPf/y6jauqrT1wLQ0806V7vqrcNHvgcmqjeKK8qp+kJC4bqA1Obw7xqBgClSLTBVrhyJXT+r9Jatm4b7tWy73OOqa+g/x7uKXUcpw/cOhkmHQNb9wUZpfdfgyqKrLMySulOq4/i69bHGFOtxdBVMFeAg+sz+LxqRpOh+aV+ZNpsE7z9uHXksmqR8Y3pAhulRz6JnnHQKph/aygU+kOMMZWDMwlO7gAfHZzAmO6E2z8JjGm6lU3+d7tnxsAN3eG6I33gWibfqTPSvgieEPhG66d+RveKMKYNo89yJt8rdSuMwqCfYKZaOv6cr0jKonOF66hnS1NKrx0MpzeAf1cwIDw50wuWQWM5bGovyeocZPLmJbnHcZzjDGaiWwc/wFFEOuhHmK0ARGu0W3reU73H7jSm/eDWCb4S1mO50cWd1pjuEY23EYdmKDw1GAbV9w/NORvgVaE/pcBPAkRiUN8U+G+uDn+rCMvKwpZ9jdc38wtoOtuAkyKjOf3Kwb+YWmPhn4DZuayX2kisPyxtA8PqwasVTYStlHLBjzDaM6JK4UQZcGtIC+G2C+GN8iZlPXAlVJYToci1Lsy9GibXM8a0zjZYptSKIryk4KUSHiYLiY80pkN+gFv1mwvSfbefbWjexzemrYvg+fu192z9S86D0sE7bR9q2mbw1MZUT9VxLSzUb0QBpAyG4OVr4bIm8ENM2l+fU7QfGNN065rq747jDIdHBsGoerA6woGVylNEIxnLvqh0I7xDLABHbRdX/AjzVY+/2TsnJTOm3hPLWJ+/AR54G6r8MR8ZqVjZ2FrvBOjWLxoJe+4GeMlzKpfbdGoPQNm0zbaNr9RSp/Z5RsP1/WBmLdi8n2mJGbga5qltJwxetee8lW3tUXZQoMrddu1OY9oTbr3SN6bh6EJ1uhvTHIxOwFk2nfp8pKeYL0lZozIRenWFhw8xLRUyRs98CSdug9crwb1VDWr32wNgewxit5wFV10710DQu/WGx/U9KqE60G49PKW+TB3UnHlVjuO0B3rBnCYwpzp8fwDs58AvIajsoYiT9mdaAEMhNGwPnwpspb35K3RZB/e8qh5hmD8aJtWHzaVkTOWVzloKI5XivTfdHrCHbAq0uNRP83ZbC48q4gjBhmpwxyHw3kEmcm+zAfooxaXIN2l9K70xdeu6T1lHI/w9juP0hPlToLAebImo3XlvEhjTdGuaRl8I8DgWWp4Nn6qbwF6VfoGhQtF/bWuYOwwY6dWaMPVIePdgv6yjj9TYAXdH4RmSG1OlTZVp8y451AImrtwfdsboBt0j0Iyi34VS+NKBecnqRMrJ7NcRQ3y8QxiEJ4fPLZc4jnM6LLoGxjcyqeAJP0AjEbM8nK8yTpq17APvDYMeDQ14NSw3kTSopU0Rvns5jjMW7h4In5WHDhugpTKI6kFX+2WxAYbF3YOlaEyFAp38DUzTIio6TXg5jtME1k2CAWdCjV0w/QuoLJCM0hJ5jWYdx+kLD4+B4b8zwCOBjVTPWlcGttnaQ+Rj7+9AtZ1wyhZTFG/7BvA8rBsAzVr5SGYd0ns+hgv07vIKc3I5jnMuFI2BLi1MreSIHdClCI7bAWNqwvoyoFpp39VwlxcxxUamUj7D4bYr4JraprVHl7xBpVbnLIQnz4DBx5uIvTQiUxnT676CAtWZH0knvPiaqQxm6/UmGpGylcKLjEwq/gJz1BKgiDKq3hmvnFQzTZTm1Z2S/5/fg/OujCQpMYd+TAHMrwG7EijawJimW9MU+kItE2NhgNq/1A9tdZyi0anfw4TngXu9LIqNfLpD0aXQtrFf1tEvhB3+cKo+uTF1z4EMozI4HvHB4bC8Jkw8Ev5WyWRyovSFF2HpLMqpzmu/veM4AvAU+ACe/X+F0d/B9QK6uU6pMaZFk6DxOQb5rnpvqw1wy5dwjPSuylF51bsRxlHltpHQ9gw/o3TqRnjuLaiiNj6VqMKX4zhDYfZouOZo2LwPHL0Deq2Fa74wQYBrM/JWTtydxjSm1paZQjTsSU9cY+qNUuyqM877Cs4T+EQpkrwtrG1fKISzO8M/VT+06F0pYx1ONTZrwRpuNUX8djJMAiGJ5UiGVGmIy+C6sTCjNmzb1x7QH2Gunl/tJDk7QAY6XjQOltSGZkrR/GDBBL+Deq38Hk03xfmQTT/GbS5rfEbA/R1ham0ftOTWuBfCwt/DkBNKz5gKQXzL59BH6Xal8L5NABRRj92ptmZUC14/HIbXio5UEqlkOQ0XbYB73oKqSr8nZepKH5ke9IsBIQ2fGQqFJG8pKyn7Quh0eWLwke4KjGkJjGmCXmgZRaUFb1MmSGsaRyziOM7l8PBoGH6ccZy9yy3tyKGSY7UyjTH1shBhdLllf7sEFpwGV9f0nVPv+13H+r9wgXAjT2fz3rbnvZ9t5VPd85lEtVjHcUbAyAlw+xEGDRvWwVeHQiHhNmwb46Jp0LE5rPDayHSMtsF9H0FTGf0nsnnO4nzG0JeKBrTTxfB0FZMxcDEmn0ATsZ7FtcNZfT0GRrQ3xDLKCMjECTQ6WuUtlaEUpWaF3k/3/LvTmF4B88ZBYV3joVXdCQs+hW5CLCZEsVqvcSRcMxhmHQk7rGcnZNz1S+ESeVP5NqhDo41h803w1mcR6F2ldsRR+34srZ1d3AnQtrPfl3nCVnj9daii3q2880la+sBJfo+mousxK+C6dD2lqlP2g6Ud4Yr6JtLtuQbukTFtCkMsAKM0IlMZm7u+gRN2wKsHQz21H4hvV4fkbCEr4PVD4fFK8ObBsLwsbNovOZJTqaPqu+Ccn01NuZEOndJaKdtS0hvTMr/B8JUwW7K+2Sor26Zzaid4J1GPaWBM02mtJH+3+mIUTBwMt9Tw06u/2wpvvglVtA4J638W9T4JTm0fvS7Hb4XPtK/kEC0prjG1a67+7FFwQ0eYcaSp+3mX9l7PtExeqURiWrTGjIB7q8HpG2HuMqir97wrMhKLR+LL2Zv1BYyYKh1s5TccrhsMM2oZ59+7wpwAckby0k8eEZGKT3sUjOjiG8XDd8LcpdBdxAxJdb4BXq0bCxe3jM4yKABqugnmLoYmymbl3G6UojGVQlzwX+ishUyotBzHuQTeHQm9T4rujZTY5aXc/yE0FQglKtzP8iwm/Jjhdl1XCGeca6D1qpsufAsaCb3qRi0WOaf+1CNtikdsSFKUB8N9lWBiTfhxf0NwMGkFXHmHRaDlLaqO2Ji2x7d7L/jrIaCWjRuWwlDJvLZtYFcvrNpjRBwf1WDuOI7q1R0M8MglIfgHLByYT2OanPKsY114qoqpmyhdLc9TNehwCvoVmH4mzKkJG1IYT0lHh6vmDmghSsV10FIOkSKKFzJ1ctIbU/2OC0ISyEyRTZFfk+rYwvf8Y7deEJlmc4Yt6rMQTusI//FQ+A4M+BFuV0P/jSloJy3iO7KXWU/hOouK2rI2plZHSD+MgzZt4O+Vox07Gfs3XrRtWsVm4jII+9sLodDSbVbdBVNWwGg9t+r+bvbJcZyYgMbVwR9DZ/WI266DogJoeaafwfHQ/2N/hD6qTwrwU+xnzHQ9LValAG7oBDNrGpIJZQH1PhMzov50HKcbvFsAvU+OtxsKxG5YDt2VbZBBzVkHRYmNqU1bDQOEopJxkMDVQxWVSon3ilK3VDiO0w6KBke3p3hLogWWMZ25BDqq7uim0PJx2fcbDUP6w93VTN105rdQIOOjntFK8Hp5eCeCDUn9Z6qrCpQUyXjkctgKhq6oVIjavF/xbSXuAfoWPigHj1aFrw8A1XpFGP2QS/xuKci0yf4Wm0aP98xzE5k6jiNl0x3Qvw+FRyvDixXSU55pC0sZqYba/nFYcj5MOAH+UdEcRNfYOialJc5RF4G8HV5eDHUEShD4Sz11xXbIMjOmbguO0oueMu4Gd14J4+snb9cIjGk2B8Mq4qGGlWp5JXihPHxRFnovT8fi4xODtOoJ/6jk/767fqoVymkX2tXrM41pjXHPQVyaN/I9HMcZCAvGmOycMiXeVeEXuHExDFSqt9i6zEbVKke188tRiuRu+QouEUhH0VwSY3rbR9BlikolptbcpyM8eKhJq8ooj18FE5WJU5uQsjU5K0vFrrHN5A2B29rBNbVMSjyM3JVsVRZL275jdUkfeO4iKDjaZKYir7BslC5O2w2Q6V7MhTG1jEH12xt0pzvN42NNIwEe8JSxYXwZOcbP17ubTwrshtiWCt+Q9msGz1b2EXZSiK1+hquEMBMizxu/k7eist2EneDFQuh3ookwlfoRC5IAOFv2iYfVR1IJVvoVVhxgNuaCz6GjDGlacoRMFzDRfdYBUI+ZZo/WhQ01offR8FwVE9Hp+SL5grUN5Jws+BJO3gxPCxgTglYboY4QcUpHq9agyCpGmZTcmPoOy5S+cGc1M90lEVdopDMlD7PxZuiyAbpqaIJKBQJyqE6qSPp3xtFxiya/wscHwsX1TP3XTdV7qbusifkTG1NNtJHRljOlq+Z2eFKZDHn/b5pzMGZ0NPio7jb4YX8/rVY8Y5qA4k6ZBs19DSMdS7KfMvms7WkWD6xai97JpoHeZiQukNDsuskT+job4gprYE63wyZkKFRHTBqFmAyUIscGF8LnEQjguMxCSYypfmM8NLgg+jeS9yRnInuro0bCdQU+NkP/1cVGCJshR0BI3ZiOCpdwRcZ0GtDEtJ+IjEV6XPpg/jI4V9zVShenNWKZPmsSnaXWtH4w/Qy46QjjaIaRu8KeqCtCRt3bHzrbGiQiQynAl7ATygbuD4vKwvvl4McyhiddoxsFGI286m+DB/8DjSSbnLTQ5MKYKo04CS7uA89b8mFFCtesgC4SgkZzfe44TiEUDPeRZG4tQh67XiaybcBGpJGG1Mt3T18BrdTOoFmUxY4ksl1sW3ecABd3Ne+oRVaEKrYUQeAlxvM2wKlb4ORt0HJLBJXggTClDhy9BQbI61SaJGepBXuQBLb5vY0olWo+3PSSqWYouL96GaXgdXm0YUfshOO3wZmboL2MphySz+FPF8Loeob8Wu+pKG7UDzBM3rk2dDPLAJPTmqnjOIPh5UEwpza8Vd5ElboOtAhqbX4diNcrGoDOHV9BBxl5Ab3iIujItTbArMevg2EnGwfINaZyaIRizNoRS2xMj95mhOxxAIejjmsBHdoJ0KOfGSfntkkpqbPBvLOH9kxvTK3y12i/E2FDDUNcrp5J7xKzTbt1lpHr35aYI+272u8dYMnRI8UormChYN0ygOE7pi1wgpk8okzCuv0Mo047lT8UZaVtR3Ac50xpfTPFRC1Kse8hkF937z0+yMfsXH9m7o2Xw7W2l9Hde0IAfwuTBbpxI5gSRqa25NL5Up8W0xOxa/jSDm1IpsMcx2lmylHnnQsfWiKQRpvhfYGFvKxIAmM6/wPo+iS81wW6/t5w+Krues9ncIz0lUYU5q0cZTMCvWB9GxhyvJns5LUSnboJ/r4UKglMqSxgCB6tCKvKmMyaKCGVWVNAI+dVyG2P4SlSUtLV+lukg652QTf9r5Kb0v8lfscSG1O7wbrBwkIY0sAnOBDv7ogfYaag6CKx7wi9B8ODh5meTUGc/yPyZHeh7fd0haIroGdjeLmSuc9FYq2C0crTa8KKizrb3ZdJ0fxhHPzhKLjiJ5iluaxloPPx5mAoHSElPeWbSKSxTTnIm5IyerakhtQqH0Vex1iy7gomzfzPg+Htg2DxgaYJPbbv1ZOYFPWdy6C9HBjVQBV5Ks35iU2zjIYpF8Ot1Y2HqstFHH4EF1xt3tmlU8upMbXr3w5QRK0IR0T6SoUJ4PWz8Ti7NzV137BHPSUTr9K0DD0+E4adZPani9CU4pLCzzptldiYKlIXmEksM7rCICQBkAQKKYRTu/ogFx307mvh8aqZGFOrfHrD0nZwUx14rrJRLh5XdOTJUHpbkXGvdXCNegVVfkmJxDTcrguuhqtEymGNs3qmr10KQ2bYunJvWHYW3FgLnqtksjWeonIdlXBaO4XyV43ycljaFqbWhX9VgNVJ3sObneu+h8oj+n5lSkqsAK08NQCiA1x6fHSNTWDBf0bVMktoTBXxjjYUlJH8spKSm07OOltiHYJhUDgcbhFYcx/T9/qm9KWXok5gTG//FM7aYNqC1Fd+mXhutVf+kk9y+wjO5Athzol+T3wk3aP2r6J2XXqfVNkq3SPn/6DfzLxjOd+Nt0CbjdBoO4yoAXceFt3zGw0uK6lNyZUx1cEYDwO6x/d2Tf4WCmVMD4lm33APnVBVQvMKci5DOhA6NzEHS+lR9WpOWgyVZZDVI5S14iuuoAyloKvYpdDVOyZjPgLeOQeO+UJtE8A58QfjhC3wiccIlFOuSL+uM6AzvFjJeGaCuHtRZ+RbamlF0nDmRvh5X1NL0UaVIZq/CLqOTdQo7k+dmN7aT7eEIfRSppvyZUxTKN4YBqSo9JSMllI+byYjv4inc3SZt1SGUDpU6yvHQo5a2sgt8hmTG9PTN8P9luhD69B9DTws5PnfzfSkyOk1avMZ8hPcUi2dMY2uKU2vGc3sk2qHe9Rx8z6GZqo7JTWoxpjOvdZnuNL3hkky7jb1yJGnmhF+oqeMveKd5Ng7fJDJbe2huO/hTlpSa5zqgFlFTRZHoLMtFrMGMKc+zK5mCE68S8HAVV/DWAF4bvX+a0mMqXUYB8LN42BanWi0bLjsJcOXld6wqe1x0LcNfFwO+q+C4Yq8VBvcmjjNK1T8sxXh7YPhqu+hi4CJkq0CHC+lqlSqdLyiQ6VTBbDU2svQaaKWyiwKFDLCgdiyRAHc0wNuOcIAO9MZythdJMMpYJJAhA23wdmboOvPUElDBfRMq1QisGxmek612Zzrt9no+1yZqx1J4MCMnj3dKSuunUl4vyUMGA3nnumnGXSr6x0pXfArtOnhT43xjanZ0B4Xria1dFgP076GY5QuEsI05VSQnLxAxJfYtG4hDGhnZpL2XwN95K3J+LspJ6WwzJzMWIpEN+pRSjSjNFdxnj26tjhfdYUEykwQdtU9B+uZi+C+KjCqliFs0JXamNoDr/YNkeO3g6m1zFSTuz6AC68yNYrkkWmMolJLgC71u75agj66BMbUTfOuhMfqQOg36OLNU42LVuIVoNiPZknRHGkIG7TfrlE9RuCwjBV0cmPaowhuqu7XpcNRx6tw3wQYdby/HkKHj/wRrjwylTG1a6/2iksNrZqXBs90B8mgytA9+ypUFU4hzDcb4yAkMaZ/+BZ6roYex5msUaJIWN+U2pj67RfXDzL1ueK+h37D7XlcBM30HhmXe2w/5hBjGJQu1FzPf5c3mIbI9xHifeQPMFN7SoQN4XR1DoxpN5h/VTz7lQg+/vQ2nD+pJGxINv2uzNVRNgBQNsJD8yaITGVM3QlXusQIpX9Ue7QpVaXuVX/UhBxlDpROleETOEhRo9L6Z2+Eq76CynLS7kmXMTDr8MKVMOAUWJmATjN2T2vvyqGrsdPQtJ4rw7kBKkkXK+OnDJuM/yvJSgum33fdYOh/mo/DcecwS6fnRFfnJDKN8NqugIdHwOj6vtfsGk2x/ISgRWefzs09dC7JPdAFHh0EH1aAK36AugJOPFqSTZWpikl0n40ARD/XyTyv0kxyCu7+GI4V84Y7psx48fdfCQXHGeUYBhIoElcE4Cp22zrTAFgeCoVUR876ss82CF65AGbXMM+nyFRRaNsNMF7yU6Sl+lIzaHUBvGajUs+Yuryvqhlq8yV0VKxRvMxG5/JMhebTeyWqmUoxa0MLCHAI/LkqPF0JPj3QAJmULlPdNTswQ2JE8pQf4I7DTG1XkcolUnqKohZaAAAgAElEQVR3xRgGEWQrw3AKLGwGg+qahnyxVMkR8dLYOga1t8O130JvOX6KRtLWtZMb0+krYXht32CGJ9S8DZMHRg97kKHtsw7G10xjTG0pZVgDk1b1Li8DofqYRmfV3GWU3+cHwifloll3lFIe9T1cL1m5fa+xV/LI9MYV8Er5aM8+8tNKyWmtVedKnub1Z1L2ONUnEdH36D2O2Qadi8wYwws2w1MVDEr+pUqmBh1GxnuzaF1u5UzWyp7DmNaQRBIQ0vPK72GoAG3CN8R2JWQNQLLP0BkWTvZJT7xnKF7pImafX2xLI0rLy/HUmEL9b5VKVD9V9kUZnH3gpkOM46YeUkXfZ2wyQB2dBU2XUXkok5Rq5BNo7RTlzV4C7RQF/zGVgjOdHZMmwJxa0UDIyE95qf3TNkM/ta7JcMopl2MjRiPN+k1bk4+Rk3TBQBh0uplFPeZbuERrnJSBrziKOtfGVAAk6z1fV9M0J8ubvV+IsqOgXlv/ALmN1P+GKvNtmkApBV3/2N2RaAKFciF8MAk6NI1mAQmn69SOI2RrO1h4pV8/VB/p1BUwRWlebWahzQ6F16vAZ2VBtaf2P9p5iUpbZ83Ja9GTbQzvr5tykeHWJlN0JQamETC9N8yqaYA7UqQ6JOLZFTmBgEft1kJdIa+V4kxLZm293lbwZGcY/DtTf6y13aB+vyxrIOhyKhKlnQXEmaxeMaU7i0XsH29MhUiWYtW7TP0ORqv/TEQLQvJKgYhT+DDYUBXuqAovVTDTWYQSTjWCS2Crv78B9QRM0giulFdyY7pIs0iP80FISuXO/RJ6vwU9OkWDjy5ZC0oLJzemPmtSL9FbCrgUASaTMX7gS6irNJXWXZGFFOdx8NeTYeTR0elgF5TiRfFxCM3kxlSsUELWe+AQYQT0XX3XwaBIx0MpNfGhRpH7e4I0lG+x06PCqE0Rb8gx07+lKAVyqgvrm0Cbk6Kb8IWAfuclqKp+74wGLMT3WcYur95JBPS3JCQ9sMawpMY0yefjjanFW1wCaMpQZAQn3aI1tu01irIVQa7ZDz450BhEAXMEuvEMZLJyULpdXpy/hwFPWvukus3QaY4c5Xd2eL+hc60z2KEIBq6FOkJhS6e9lathAHYcZleLGBcfsiL3tI5zJlLIqTG1m0259RHweHt4qTIM+BqaPggv94DLGvlTMnSAOq+Dvwp6rSguqzpBJi9ZnHtsXVLcnj38+q/E1GCL8bzOE0zcQ/Z1tcArS62nVMSEVaZtRgT4ShErHRLZhiID0F+jgxStC0VWrDpdJu9imrhFDt31REPCL9Sx2kjk4UdeUh6qqYo841hFKwJ2KJLWGqpvWC0K+qeaiTgXVYLnK5hpMm+WN/NMM7lkyIXKbb8O/qxsRNoZpDEepViNBkHnc30UpN7JNaQCbXwK742A+UeZlJ1St1IiilojazFKgStVJPpHcSzfd4j/Dln1s9l5ppHcvG4d5nNoUc/PwrisU9/DdZ/D6S2iwUlK8dbZmcaYngzrpkGzC31+Z0lICviPX0BHRQOqjYUvW5ccB726RxtgN534Dpwv8JaMXtSV2JhKyQlI5aGNlZqe+R1cqqyGFJLQ1GkHXvuo2R4j4FEBEe1vu87GYuit8yDHO/aZxsEMMZGJktOCorR+Cz5KRfqS4Hv6wUNjYEpdA9KLPJeRd6uNbdwPUKgUsrIUYcOQgzSvR4+qeagRGYYwiY14nN3slWE2mjzM0E4qDS3sg5cW175O9vzJzqT0mPa5R3aifXnsdjNGUZGgLmUYGm01qN7vE8xrVfeC/hab5hefdd81MEzOfEq9ZsCcMyfAdUeb9VRWTdNrJoh9TA6esmoaX5mRk5Toba3RrJgpAUsmWizdPTk3pnYTCLWmvL16UAXcKQt3ToLx9Uz/kHc4pYtdZgt5ynknek4nDPvsQ+GRIdGjm1SjeWg5NBLyVZ6/jFIFWFQeHqsEtx+e+bxEibzJJnhHoKqcFL5jlKjotMbAxWcZT15KcOBP8INQuFXNPEXVOT45yCgz6aZL18BfpAzVI6h6SRlTUxIV32cHwvIDYI36IBOQ+2stpaDDPMXboNouaLzVoOjc6xc78UfykyeYUf+jVb69YX13GHWCIZlwo2uBQ76DMTKkojZrBu+KPP4EeLe8P6hbikHP1nQzXLQRLlN9RcOP18KTTf3oWo/oetUirVCTe9qo1O6VFMa0Z214xJsSBCgCXfB9dMSq95jznYkkUkamF8IrV8GVx/v9q+4zb4GHlI7UPkoUZQ6EeWN9Ck99Jl5px+yfBDXTyDvCM3i9+lixQIGO40yG3iN9VL++O0wtqoyAEP6xxrQLLB0Nr0UMYVeWp90yqCLFndEQa6tge5monSrwWFW4p6pxbryUv/fTLuvOdzBRzp/2hBu95MCYFicy7Q+PjIKx9UwfcrrLIyc5ZJeZ+HLELgPO0b/d4d8ibKnq7zW3xWwxdFAmYINNowogEXsp4yjQUWSvppS3yjqKmJUVEye5osiF6dKvZngJBfCoRlgKoKeAQsGUJoKVqOfTgKxoD683NNF5h7VQSc6QAFI5GyqSaCXyYkxjDqcMawGMGQoCzWhKhhSc0kb3H2oW/U9fwHmidoryrtNtnVz/3UxzLxoKbZv6KSW3FrkeNu1jIh0v6pGHls4z1ObW3FIZL6UvVAs6a7MdDaTUqtozcnZZOjVxWrYznJaStWrTf1sOreuaSMnjtX3nIHjIGqdTNpu/Samn8njlveqg1twJiy3frRuJ6TAqxSiFo7qG+sKUmskaOGb7HXvDqy1hTG3f+HsGwTC3eIfPcRyxJ3WERQ3gwapwuIYw6yB9b8EJOqzydpWe7wh/nQpDT4B1+xtvfdRKuEE1YfG3ZtRykTzNu+wjmFITbj7C3yOquQ/9KbqW6o70+xzerAgTaiermVpAnJSEB+jy9oyclX96GQWr7NWzKWVVD9bXhcuPjSY+Sd3Dmjgy9X7uECHBl0F3kYwrYstITjH6IEG9TD1/asm4S05MomH10iEqA+n9PYUupb80k/JEogNmSwcqk7SAZSdBQR2TSVPd17tUP53zJfQQ0MkbVFDSNG8XeHKKP3XJ+y03zfshdJnsRVM2vT/AZPWuqgPvW0dRj6geWOnOOjvMUIsLN0FLr41MrWRCteofOZD6/5Jtk+gxmOnBiDlTTjFfFJH90l8ETswqQ2f6a91ygIag14Xna8OM6vDewUaXKRslTl4xObVVV0Zazu1s33l3GFMdgEJoe4lP9i5Q0t+WQes68E4FaKaxOu/YsTpZTU7IVgDe52z/5nDodI4BWagudeIWU2cTa06yWpsMpi7VCRWltdgIzSM3tzw+eW2Ca6sOtCiW/7akz26VqIAHY+CG7j6npctf/DE0/Q5aXOgbU/fQivBAHnoFeKKmASUIoh5Jf6i09VE7TATU+mforsP5Mzx9BAw8Jh9TY2x68lJYfz6M/h08UdVEDSoLKPpV2jyaUzTi/cfD661BiHCtxdlr4BhB/YXQDQNJDAr75okwra4BYrgG5lPolDAySrY+KYzpv+H+6lAgg2ZTZUql9RM72BF+atlF+b4J84+FiUena41J4KSqvaOx5YRW5FAFXq9gaPReqAhLD4yPuLI1puHJK8oiZV2e8JGc/VXyiYi25NDIGFyxFroKbOKdGylZRTwCy2WlcNOdLzvZ5TIYdCbce6hpN9Ml9dimCJ4VWE8GtdhTY2J/2/CNz70yuvVId8mxeuJf0HhaLNLacRyRY3QTyscy/ugDQuDqPCrTIl5psU5F8Won+O1EpA1qkyvMNBuTTpb5+rsFXorgQ2WnIwwxjYBWXulJvfY699IPCXuufzPEOrcshmPUFvfnXLda7g5jejqsm+jP81R0c/mPcNfT8GRzGCogSxk7KFdsNgsyTdvkauEcxzkPGAAjzvQbe2WIHhSwYwuMP9a0A+wImYhHdYamW6DZVsN21PxYE8m6NawvoaNSVe9m6zUX9738doNHL4OCugZwEuafFML1BGhxiW9M/T5T6/0K5HAhPFPfMNDoHV1PV06AIjsdVnERq5ZzSjQBQsnpBK0xVElApYHmMOc4mGP7/mTcVdtRmlRpZo+0wUUkq0dZNRql3+S0TYI+AvgcYupCSqOq9jVNSGSh9kRMoShnIlwxEP50uPFe3SHeXro042g6hTF9FT6oAB2b+ePrVBdsuQmeFsm5PXduv+vLMK8JFNbJxJhGgFKawmO14MlKJhX/vagtM8iWZGtMXcCgph0J35BRWjXRPvbBZCN6+hNBYu/Ueh/0qykXCAnupuhlNNQ3qDTgX7OJilOdK6MDikbD6S2NU+ld0TNpc5DmtTM3p6peGIE5cM+R9IZS9hnvweLoihR0ghmRnxTnt4pzr+M46hroDdgxl24vnqJpgdks2Gp5OTMhSvSAAjsKG7HW4lFSgQpjn0QkQIXfwzA5SMpC5QR85LlexXnvYt9r0Hu3jIKpdcxhl4L7w5cwaKahwJt0KcypYSIi1fbmKWISGCZhH1yxHyDNB0zKTzNH+zaHR6qa1KiIF+75HJqI9F3F8ItsFKd6orxmL8pUDbALNO/oG1N3Ek4YRJDr502ioPrDewPh0oaGwUXpn6u+hWFKI6tOMNYfwZY4tRPBiyqjpMVImEKLZxPK3pjabIBSbeIPrgU3HmHWILINwm1VWAlDV0J3IVQtA1J8JGlbkPrDE81gYi2DLlY6bPBquFkGQGlcHdJCv+0p5EAvjcASPF6KLOPUZQpjKuO9DU5t6zMdKfLSunh9dWFmpKdh3vnxdc04Z0EK/jJY3wXGi3atanp0cqLdko0x1bOP/gGuFxJbEVrGMkqyX5WWGwU9z4YnIujjUp0WpevEWFOw2vZ8K7JIOSKvOGfPOpVj4Yp+vpOlbwjPpBVq+JGSGFMfgDViCPyxmh8B63fcFkKlknPS85hE7sm4eUvNmFqZTIZeaqu0oDQFXHKovCsZEtkDNnqlJ4GgvEttYcsPTJxRPGo7PPZvaCw9nRF+I5O9lNfI1EYLhXBxd8NpKx3tUjgplTvLsmmMhg4XwbMiYf8NBq2GuQLnyKDmxUPzBOM4Tl9Y0h+GN4RXKxrEqRDGsz+GKmpdiUMWRgo1vh81DG8XKEa9XhpxpvSrjLCAGjLM6p/NmTdkmaM0XaexMejaWK4hVTpOqGMp4Yie2ZLVSXJlTP1JF32Ufrb8wZHcsl7v2pzlcLHqaAdAt16GczjMyKTDEAUqsLWYvoZur/9x8GYFUE2u309wuxy11+GlK+CyhrDqABMBXfsVjFGKt1gTO1IYUyHUV0CPnn4bTOxxDHP2LoR53VMZU6twBsAz/WHMscmVhOcfax+LUk1pZAFQptfIJOrVp9MwIF1bXBklU0JmFB1yfFrAzdXgvwdHcwsn+6QUrdpXHvDKQklJG6z+qQ/8N5OUnkGZxrITub2538L12h/3ltCYJih5eWvmtt3JoZMxLZGzkkLme5wxtXuuDzw5GoYeH91Drb96oCqhtzXcov52+P02C6gSNkPpbpUEvDqxasTVYEYXQ26SqONAVIMPvAGNNRRdaPScXPk2pt3gpfG+4nLJhVfB7bdZhJwormJmzwlFN34lTFPfo1K+eTGoljZvEpzd2rSPqHn5yu8sYYSK1GmFnNiYilGk4m+GK3dROVhW1hAESLm50PF/WvL/Ekfe8RSMSs/e8DX0Vt+l2iU0KaKhicQadDCTKvJiTBNO/0m1Q335N2xnOEEjL4+t575PLdm2ahyjoVufGGMq5S4Gk7jL1KaK+vk8z9p7l6yDvyyFvsfAA7bdIDxLUpFHsdqzUhhT7d2PYPKAaIKGyMcMT5N5AeYNSGNMW8M7hdCncfx8RkVsUg6/32oGLSg9X0cKRmnRDTDvjExTyLvTmNrfkqOnzJDasI6BZw6HlysYcJuQmGpfUTtObBov3JeqfRfuaXQc52Q7xs+idTeUh8VloJnKE2nbsRL3ocrBH/Y9zJExvauExvRsKJoATVtGtzipP120q9M0UUrZk7xcidO8bsmnVGumfuq/sDvMOcLvZXbZ84TElaH06uiqm6v0JD6ChKQNqUF0AoLOEbmEQHQ5HRCeN2NqvcKJ0KeLPx9Pk0rufg8ukkfgQqCt110A1w/w6cXCBlV0gjIKJTY8sbvTLuBwC+AQKlKtIS/FFuKtwTzD5vNV9BZMXMpfkafaY8TaVNtQKOqQqwwSiQiM/GWBYkRqfr8MgAtoyPbUOI7THoqGQL8mhuy8wVa4SX2wMqR3R0D57Yi8uu1NRJMXY5pyjmMKT3k4PDIoGvovGQoo8ND7UEVTSpRaU3RfCN0u9Y3prKUwMmWkZGU0GHo2MzVvbXd990cHGQ9Yv9VnNfxJnLOqBRYrY5DGmL4IdxYkn1vq1mnVXvIezBuZzJgCmvgyDvr098+RF824hA1LoK7aYlTXlnIREMXtz4tXnvqv2aR5w9y8OYtMkzhAYvLR6DxR4WnND4PnD4e5hxlglUcYoU+LvWfWEhimc+Si4k1/9YPj4eq6hmdXaHsxWz2uUVsyhspMJL3MeLzJBdEOUPS7Z2tMrZ5Tr+xQmFErul7q1mUXwXnSi1nXo9PpkhTGNCFPd7rvy+XfzVn9cDx0agTf2Pmjycd0plnHbjD36niQVxiNrnqp7Eqxznu6982nMbX9miPqwdr9QbWpHmvgQb1IFDuKNVgxg2nFj1nwI8wQKEkeREqkWroXzebvBuWnyfNPHAtvHGzaY7ymZYGmMgF8eIpPEYRSRqdtguc845PVjEB/3mvPU+GtCtBJqekPocp9sWk429NVCHUv2gONqRTmIHi2O0w+2kRd8kal/KpozV1kt03dFkKbnobbOazglBJLl4pXu9MQaNssmkFH36xpOHeLc1hKrNj1tzTG9CFYNAw6tvBZtCJ3YXhO5jKYZwdGx49gswZSmYV20TMw5Zj+6RM4X+WQhDJwHGcYzCvYUyJTC54abI1lpO5RCUSIaznP4csaIIHS2llw4OG+QQ0PEJAjpIhOLU9nw9MzYFBjn/Up3PYk8vako7Z8579bN3jc9gfrUQQcm/0JXKa64gslMKYiHimAFuf4ZB7eq7p83nKwRXJfLIq84ui1PdyYiihmInTr4cs/3BM9tTjnM3GGQZmpvqvhbjmwylLkXM55MabWCA2Htqf5Cky0c499kGzivZnSIrL7NqfD26oxRqA4/6yUqwaN57XpNnZjOo7TC54cD2Pqw7cR3KDJtrCMpYiYldI9bjsctTOCvEBkD+oDE4ftU9kifQ23adEY6Ho6/LQfXL0SOit1rGhUBBlRlwHlvDwDLmti2KfyEplmjUK0CrOHnY0p+kW1sGitw/SG/rSc5pea/SRjev0yGCElGsXHm+D9lUocAW/0gh71fACQnDvRli3UAAP9XrHqpdbIJyNtcEsUQB84tZMPQvKeLgw+0nzYTYmJFQwAyeyZp6+LNhD6HhewIo5od7xWgvcWD+lwaHVmEm7mMBI6xoClmhpTosjUtMU8ew2MFPuPbRkS+cL0ZTBYhk4Ap7jLDtEYA43P9ikadZvP723bVjSgoRAad4NFdqan7hP14MOfQBNFI0rvJfqNPvDSSOh3QjT5uktb+IKlLfwwG2NqgXGDYcRZ8WPAFGFrLw8VxWZOOGKTaad4Y6p2rfdfgyoqcaQtaxXHcGdzr8kMzBjh1zpdp3kJjNSYTpFnZHQ5jjMeCgqix9wduw0eeQ9OUSYjLXVqRj8Uc1POjaltotW4mwt8UmwRF4izdqI8aHnSCcNrg/yNZR8S4KDVz7BA6SzVSDSVIOv0aHGE5JO9a3DttHrwQiXTxyRvVZGBDOYFG2Hu4cbbdNMSUs4f2YhCBXKNBktLtZbpczmO0x+eKoDVB8MgTTpRS4cm6yQELcSPH8u1Mc3tTMAkik7AjWk+IllOy+jvYJYi06TG1E+tLe0KfY6Lj0y9AQb3am8pvSaHJM4wpVBOqYypiOQ7QrfLTGo68gojRIVoPwjmjUuR5lX/4QwYemI0/Zzbo6oMh2QQSXcn50HOSRfo28igoyPTo6WX5jWgo5dmwuXNfFpRt1VuNdyldQwzDcUY+DOhaCI0PieBMVWKVylcl4nJcZxxMHGEmenpvbdXg39+EVQWZabKB+HzYrEH/aBti+g9Es6mycjL2Cv6zZi0wR98vl5j64REj1kLPddF6+F5ZWCk5LPm6s5Ef8Qb0+yR+Jn8XnHvMUHYK1dC35PM/lBv85Af4Fbti4SDGWJ/w5554Qs09cryWLv6YiXM8rIYeQF45dSYWkM6DEac6/eQhTlPZQgllKSGxRqvcTC6p/EqIg+DmppnrIBLFX3lFBafbtEt8lRAiRMskbqiTB1egTwaQItzI4ypN8s0a17JVM9jo7T29p7n0qUrzAG6bSpMPBa27Jf7yDQ8FUgRUlZp6wzlPwlO7mAI63XIBq+EefKoExpT24h/SXSbjIAs2vJS4CIB9y6130zUAHqB3WRUNXg6LU1emjTvDcCZMKYA5tcwLVfe5fcuGuBNSmO6Fl6aBZef6hsgfY8cujlfQ99XrfOm/3gkIGR6fZhWw1Arxs6JLFVjqshxEjTuGh85PrIYGgsbIaYeZW68iUudjVMyraUZa+ehM8Np3igErDFg68bDWefApxH9orpflJHXr4BWcph0dtV+URGW1YV+xxjkd2TDv8oA9/wXLpDD4pUcUhlTDRsQ+Evfuz8sPwTurAIPHWJquLFAKpdU5SNoKr0o9H1eryTGNGfzPEv68FbPRpxzfaPbix1O5af7Db+DpFUP+IflIlev8uuKwOUQ5a1cmDNj6rOIDD0D7j3MFP+ltNoXwRMCGykiTdvTY2t8Y6DD+fBMRIO7xCjDLADJ3K+hriLAx2LrLOmEncu/x6N5626HpSIRSDvg1zoO51rOS02AUIpTQChNSvgoV4vuOE4BTB7tgypkOG5/GzqOS5QWTief+NaY6CHv6T6fyd9tWqyvJdgXy8tG+PBEaH+yqT8mN6amnkxrWNYIrq0NC6v4LEDyULuvM8hXMRF57ER6Ku3Vk7dA4SroLMYd1VC1v5Ia1TTGVK1f9eHOyfEgJBd85KbGNfA3jTFV9kGo865mwHvkVekX6LIOTt5m/uuKMgaMttiOvksk7XBUrDRvnALPZ2uMjRpGwaTBprc8ko5T73Luz9B7XcR8TXUyHQS3HmqyQl5NWe8VBiAJfxFVMzZ7fvZwuPoo2GQnq3iykA45eoeZiao1/+aAxExRum/oKpijtLB0lxf5JjGmarHSEAVd7qSWfc3Ai2RzX8OoUvWy35GvdpjIHZDEmGZdosnkLBfnHtvrOwF69PNbyorXf2v5lydCgzYGYxCumec1KtV7ltiY2gNim8kHNYSnRHxgqfUEjHnEQ+RGgQtSCTm+XSb2bh089YPe9B1UUkpVEZrSnbv1SmJM5emphikCaCk/GUnVh4T+1aR6/XdbExaZ/Koy8EE5A27SJcq8IZqeIOCVSOGzrmX4KY9ug/1UYxghl9bgJxJmvDGNrlvlYgHMvMPp4+CPR4IascU/umUfeEuzW/cBt5XgG5imiEG9f2KwEsDjBFh0NMyqbtC73vB0bXO1wFyzArpoH+6C21rDNbVM2j7yEuJaqesxP0IfIWTVGywC7jiPNgNjKrT3NOjYPBqE5IKPNItTxrR9KmMqhqfUxiGdxDWlaGvIJwhwJ9isgOvECBWXOsunMdWTGmd53QS4+Pz4tHu6d/H+Hm6N0ZlX3Twq22W5jAtgSie4tXo8pWK635ECdvuS1S8sOYVbppKnedN9Z+SzK0WvkXxN5ARkPIw+019Idl+8MXVLBcKh5C2rVNxnjp91qlrnVwm7Bax+Exf10TYro/GLcryOgsvqGBBazR3wuKJ/1aTzGv2XyJhaYzIAXmkNk44yqRulMlQ47v8T3OoZ0rhRT2mMqdIzg+HR/lBwTPQ8xshPSlEoUp0k46OITmmWF/LBM2lJ5NUio7YYtccIiSrDWBdanGTSvIo4Xltqhhpv2NcYSf1bfawikc90+K4Oc8ciuO0/UFW9tlkNFPfZRboNjDGmWXuj8cbURSLKMITrVsU9QLH3237BETDlPJhf3TeK3p1h0gYBcBrBojpwb1V4saKB1XupTRnG+lvhsrUwVnNbRQaiZ9WhGwSPdoGJdcz6xF46GgKSqV4v1p1GX9kJSDKsbu9zBsZ0CzAZTu5o0tO6wgPkRWV2Y2LkYXQq1p6zMTDmYrijWnSElkzaev7jtsIVa2B6TBTuevuShRRMFGgt38bUyq0rFF0BlzY2YwFjU9GpdlCYtOFtqKKzkZC0wZ7XobCgDVxfI3GaNdHvhMevqY1GgKVY+SSJTNPteq2HqOwuXwPXKKsm5P1u5SGPN6buPlB3hc7ubsGhpJNS/BAKZdLu+hgulg2R7lUWT+lbnaeyZrqV6AU/0nSrsrC6jBlIoqyHOxXLZkcXqvyW11GfWRlTG45rlNFFcHVDmFcNivYzga5qm9O/gd4yAAILZUW6YNOgGjTewyduT7YUcUNlVRPRhADVvqIg0BG0eSJM9t5fUaF6SKVk9d+0aPrfahrVoh0Ai8rC++XMVHoN4FXUo7l+4otVc3kkyCPdlsnk71GN6RpPl60cJ8DwkXBHdROduAdIyDilx4oND483pm5NQwANd2B6Jm+WyT22fjIYHrjQTFSRjL1LNce/fAjnrobWZ8IbqnXZP6pHWem2C36GzuuhkVK2ovd7MvL57B4eBK9cAsOPNW05yTg+XaO8DToXQcFKqKxyhdJz7aFgCNweMRrMTfXLUCnNK+T2BOjU18yk1KWWr+u/gmEu41ISY7oLbv84hntY5BuD4fFWMONIk8JK1M+sfVN9F/RcC5MWm988s1l0/VAMSZNWwDQ5FlH9tbvDmFqDKvL2XnBbM/jjYUb+qc6Q5xgN/gmGSf7CTaQc12XXWFmz9ksyi78AAAcUSURBVAZA+FQVkwmKTb3qyGs6lBzzmSohaf0ERoszMBGRaQQiOdGO1neqHU4UkqdsgZ5F0FUAo4xr8pmck+LcE29Mw+1Z0gU5O7vFeabYe60jPclP0yqdP2ANrCxjskje1C6l/D2Dme4XhRifvBym6D3VIpWXq1jG1BqiLqaN4bnfm7qTN+pGSsKl4lsEVRQxqN5UItSULSaPgjkdYEZNY7DTXfJcxb0oZXKtvBEZIhcYY2txw+BRDVuO+C4ZyfX7Gg/ZiyK9Qbw6eJkuWuyzxXJM6u+y2/J+D7CaWxR63nuJAF0RrKfUleK8+TPor0kSLqF7cS8zmuzOaaZup/pR95/g4T9my7EaYUxPNpvb/T4xWindVqL1TnCwFP1rvbr6BP6666yf4TXtMY1+U3pXmQJvL+8CVtlJIy+nckLsfu4HS3vAFQ3MXMtkhBve00npTvoWxqutRYTcGhIQAXRx71NqWGCHJY7jDLAk3pEsTxpXp6jwHcdxOhkj6b5D5CVSd90TTvNHtBFdAMvrwdOV4O2DzMQi+X2qBbf5GRopPS1nUmkttchoPF3sM+rZ5WREIWhN65V4c93JHJGXaoYau5aztgJr7KRPNA2kjqmTKcJQpBGW969w5mbosB4qyUlWCUVOcsbK37JtdTVZjOU14NUKsHx/E8Vo7m6D7dBShlPZC83jTJpJs6MBx9jUYqrjKJ5YbySa1lsRrkYA5vSMFEcfRBtTkey7Z1eMS3KES+25It8hgqCld3S/b6o39RwX6VtPt6qvVLVx1bJP3wy9lkAV1b6T0k8WR5aJ7s3YmNpU0wh47jy4sbrpBRUiUhR24sqcJio+pUZUA8gZxNuiVxVByKDWMqlkkSXERhHicFQKTTZSaTKNQbtP0bG8EbemYijm7p0CY44zqYBsL9WdZAzldcrgKRqv/Ks5mKp5dhf9lXfpQEnBZ3JJiRxkQBeflTWsRi3FgONOPMnkC2Lv8ekEG7cz0zBcD02KPquetmhjqvF0QtXeKqU/J5vnS/cZ61CNgwFd4S+H2x7TJTBE76DosMSXNWhdYFFDeL4ifFzO2Eld2leNtsLBv1mlK7Sm9rcio5SMOiV+sBRfYCN38dt6JQcZO+01jfjLOWNYPt/F+24LYjzGlk9kzAXoEdeq/pFjlBZhne45I+Qm50L6T0bv41wB/tL9fmn+PdqYKkslmsTZOkfiEt9jLh8zMesoE1yorKMJQtK7noHUmZTO9YaeuwPKBcTTwRX1oAXluVSEGkjyRi5bFBMJqzjGtDUsmQh/qG+mVbhecBE0kmKRJy6vKyuFn8kqWpSmUkM6bMqbx16eJyhhCgGqFJcg9qqjupcf6V7fEW6qAetiwCfenVKgXopGhlnDsLV4tXdaQ6lDrh5S/SMPWShc8UVqAXXwRUuYsecc+yLWYxdJ/uJceIwmOnqkAP5+OMx+HaoKuFMsHtoIGZ4Dj18Hw04xwI5rl8JYNVWnZCLKZI2T3WOoxl6cDGNPgPPXw2yBJmTAi52mTvUctrWrEaCUrIBjaoFSxKK9pf/9P2uoSiL/4LN7hwSMMZ071dDsKUM2azEMd6fh7ElvaHrjX54GlzeGbSG4fTl0E2ZBIyG9zJOMpHRs1oPFc/3OxTGm8oBlzDSMWMZD1v61fPUW5vpFI4yBaKsGwNLWML8mvGvTbyJgaL7Fejp6Py2WohB5OVo09aWpBiaC5awNZb7eK42RkBeudJockX+WJKIyBuf96dD5TGNMZ38KfTW9Jas0dCbysOnNgaaNxJ1pqYk+eXPcMnmm4J5AAv9rEoiuhwtbcMf70F5UfRl3WuyOd/azUZPV2y9eElEA5tx5zvW7ZGxMc/3Dpf19lidUxNpqdNclr0dRyL8DRZ18dfxpL/U6GNDPO89ZqrXAuJX2pg5+P5BACgk4jtMZ7psGoxtAtZ3w2WOAskp5IVspyWJYIJIIO5Tt0zD4Pe4ZY9/v/60xLclC/3/+rM8w0ra7mZ36ZzEQFXviyv9nGQbvHkigNCRg8A7PTIchp8BZG+DBrIGIpfH8e/pvBsZ0T1+hPfD5DELY5X9VKvyuVOjHPfDxg0cKJPD/UgIWfDUBbj4LTv8emgnFu9vJbvZW4QfGdG9d2eC9AgkEEggkECMBA+7hLEBlGfVe7xEtMXvDQgXGdG9YxeAdAgkEEggkEEigVCUQGNNSFX/w44EEAgkEEggksDdIIDCme8MqBu8QSCCQQCCBQAKlKoHAmJaq+IMfDyQQSCCQQCCBvUECgTHdG1YxeIdAAoEEAgkEEihVCQTGtFTFH/x4IIFAAoEEAgnsDRIIjOnesIrBOwQSCCQQSCCQQKlKIDCmpSr+4McDCQQSCCQQSGBvkEBgTPeGVQzeIZBAIIFAAoEESlUCgTEtVfEHPx5IIJBAIIFAAnuDBP4PS+NRNGbhxpsAAAAASUVORK5CYII=",transparent:!0,color:Cesium.Color.WHITE}),fill:this.fill,outline:!1,outlineColor:Cesium.Color.fromCssColorString("rgba(0, 0, 0, 0)"),outlineWidth:0,extrudedHeight:b,height:this.height,closeTop:this.closeTop,closeBottom:this.closeBottom}}:{name:this.name,polygon:{hierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(n)),material:new Cesium.ImageMaterialProperty({image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdMAAABECAYAAADa6t/iAAAAAXNSR0IArs4c6QAAIABJREFUeF7tnQe4FNX5xn+roojSLSACCgpGJBaaYEHFCkgvAgIKSIdL59JsgGhUEEGMNYndqNgTa4zRGBtq7EixICICF6QXdf7PO+fMzvbdu3eXS/jPPI+PiXd2d+Y753z1/d4vRHAFEggkEEggkEAggUACJZJAqESfDj4cSCCQQCCBQAKBBAIJEBjTYBMEEggkEEggkEAggRJKIDCmJRRg8PFAAoEEAgkEEggkEBjTYA8EEggkEEggkEAggRJKIDCmJRRg8PFAAoEEAgkEEggkEBjTYA8EEggkEEggkEAggRJKIDCmJRRg8PFAAoEEAgkEEggkEBjTYA8EEggkEEggkEAggRJKIDCmJRRg8PFAAoEEAgkEEggkEBjTYA9kLAHHcZoBpwC/AG+EQqEvM/5wCW50HKcG0AaoBnwUCoWeKcHXBR8NJBBI4H9UAo7jHAt0Aw4D3gGeCoVCW/eE1wmM6Z6wCv8Dz+A4zsmwbjLc2BzK/wY9iqDON8C7dkN/no/XcBynHDAG7ukD/6oIbTdC1+XAP4EHQ6HQd6l+13GcOsBIoDnwK/A98D7wZCgUWpKPZw6+M5BAIIH8SMBxnAkwcwi8VRH6rYHObwH3h0Khf+TnFzP/1t1iTB3HaQ10BQ4CFgP/CIVCr2X+mP+7d1pjoPc/HpBhWCZDUFqK3BqXLkAt4CtrCFMaJEnfcZwW8P610PU0+KYs7OvAUduhexGM/RSq3BkKhRbmeqUcx6kCjIMeA+DRQ833V98Jl62Bma8Dt4dCoTeT/a7jOM3h2RthUBNYvx/U3gGdi2DcMqj8MvCnUCi0MtfPHXxfIIH/JQk4jtMSaAgcAlQAdCY+C4VCL+wp7+E4jqLRCXBBP3ipMuz/G3QsggXvQZW786F/ivPueTemVgCToU8PeLs8nL0RBq6BRlLkUoaPhEKhn4rz0HvyvY7jXAw0AI6S1gcOhWeqwlOVYOO+0GQLDPweKnuRVV4iuhTGZTzcNhCeqwpnbYKBX0PlV9IZFbuOY2FYb7jzcPhlH/Mb2kJn/wyv/hW4PhQKKWrM6eU4Tn+4ayyMOxY27me+XMa8x09w/13AnFAoVJToRx3HkdMwCTp3hSergBMyz3zILhizEgofBm7Zm/ZgToUffNleJQHr3KtkIsOps6HSSRV4piJ8WRYWlYOdIaj6CwxZDY1eBObuCQ6nffbJ0G0gPGYda53lFhvhmX9DlfmhUOhvpbVgu8OYKhobBZMGw5wasGMfowjrbDeLNVoR6rxQKPRhaQkhm991HOdCG21qQ2ph9U8lsyn/cxC8czAsKQtryph3jryq/AKDV8NMvfPjoVDoL9k8Q3E/40d5/fvBXw6D30JQZRcM+xGukUG9LRQKLUphiM+HD6ZA56YmOvWus36G1/JpTOU1j4V658KSA30j3qYInpXsZMSTOmSO4/SDu8ZFG2N9S93tsPTvwKxQKPReceUZ3B9IYE+VgHV+zwWOBoQ5UIanKlDR6Cg59/8tB98cAD/vB78msAXSUzcthsv/EAqF7ivtd7XYiUJo0xP+pvex1z4O9FoD990D3JTMsc738+fdmOoFHMc5G4rGQ9OzYJlVhvpL2d9g7HcwQ4t1e75fNpPvt96PUtLn2c23C1hrQzClQJSqLg/PVIAPyxlPbmlZWLU/bNrX35Ra4LL651fQpvzJ/t2xjyHRN9wCNy2F8x4AFuSzkG7f63J4ry90aQjfRRhDrcO4FTBdHuicFMZUjkMhtL0Enq9s7tP7TfkOpio6nJeJjIt7j40up0GL7vCf8ubzlXfBzV/B5To8f071nSZFXTQZGreCr+17hxTZroEHH7UHMG2qO/Y3HMeRd99CQkjw+1roFcCLidbVAinOMHsp7tJnVwMvl5ZiKO4a7en32/2v8kZT4AhbcvEeW7V0pTXlSD6XKgqzDql0w+FWJ6R6dX3vJ6FQSBm43XLZPTkUNjSBpyob/fTZgbBif1hbJlpHpXok6a/fb4U7/gtNdcae3C0vkOJHHMc5BxZNhS7No535sDH1HOuEWap8P//uMqbKdU+GNr2jPYryv8CsJTBMkUWpez7W8J9oDMb5F8Jn5aDcr+AFllv3gaIysD1kojpdB/wGB/0KR+400fZJ2+DkrdBuE7ARkDEOwSvVoc+xsOqA6EWttQPu+BAunJ6vFIX1UvvD+12g1+/gqwiHRlmCk7bAgk+gqYypjEvCyyqksTBiMPyxmkn1yqjN+Qz6XpUvlK31SCdD5+6wUN41cNJm+PBZG1V+ksaYCgE4BZp3hLdVD7LG+JYvoM+MUCj0WDYHzYAh7u9v0vgCOEdelX+FYZ9Co2sTKVPHcUbD3YPhhaoGFxX72eGL4RQ920vZPFvwGSMBu2f7ABfDffXhgarwxYFQZMsFukvO5FE74OINUKCyh0owDyVCqzuOo+zMVJhfH9bvm1zOWv/GW6HBdmi53jpWHwFPh0KhvJV2HMfpAg9Mg9G/M8Yz00vqTHpMmIJGW6DfWmgptP4ToVDowUy/JV/32XUcDwVXwILqfplJ+rn/T3Dr24DqpntvmjdiQ8coYf3l2G3w1XNWIe4RaV4/ldDtEniiqm80tdkO3QVH7oBjtpva59mboZGM5gYbva6xaNEvIxfVcZxGpm5XtzUsjzBkkoE27+xPoZOUbs5bPhzHEfBpEDxwEUypBd9ZY17GgcabYPIqaPupRbemPTSO4wyB6ePgutqwfV84bCfc9iF0mZwvRJ11Bgqh26V+raTrGvirHDBlNVLW3O2aXgUtLvEj26O3w3svQ1WleP+TjRJwHGcqFAyB26vDrhjH9OBf4fqvYNh1oVBImYfw5b9Pp97wpLIdMddhu+D2j6HTNaFQSA5DcGUhAZvRGAaPt4OrasEX5cDLDCX7wnAJ5l/AHbGOkMFELLwKhvwefsrQWMlYh4FvMtYqbSU01lm8ZtRH7DsPh0Xnwx9qGJzKWus4KABQyUkykC6TE60goPkWaLUZ6iii+xEQyv1foVBIAL094nIcpyO8Ow66nuJn1cr/CuNXwjQ5nMrslaoN2S2RqTWoQ2HyBJhd068hnrYR3pSikcLZYxCVxvssGgVtTzORjDbffr/BsNVwizygpYDSgu+FQqF37Aa+yAKPlELSIdPf/y6jauqrT1wLQ0806V7vqrcNHvgcmqjeKK8qp+kJC4bqA1Obw7xqBgClSLTBVrhyJXT+r9Jatm4b7tWy73OOqa+g/x7uKXUcpw/cOhkmHQNb9wUZpfdfgyqKrLMySulOq4/i69bHGFOtxdBVMFeAg+sz+LxqRpOh+aV+ZNpsE7z9uHXksmqR8Y3pAhulRz6JnnHQKph/aygU+kOMMZWDMwlO7gAfHZzAmO6E2z8JjGm6lU3+d7tnxsAN3eG6I33gWibfqTPSvgieEPhG66d+RveKMKYNo89yJt8rdSuMwqCfYKZaOv6cr0jKonOF66hnS1NKrx0MpzeAf1cwIDw50wuWQWM5bGovyeocZPLmJbnHcZzjDGaiWwc/wFFEOuhHmK0ARGu0W3reU73H7jSm/eDWCb4S1mO50cWd1pjuEY23EYdmKDw1GAbV9w/NORvgVaE/pcBPAkRiUN8U+G+uDn+rCMvKwpZ9jdc38wtoOtuAkyKjOf3Kwb+YWmPhn4DZuayX2kisPyxtA8PqwasVTYStlHLBjzDaM6JK4UQZcGtIC+G2C+GN8iZlPXAlVJYToci1Lsy9GibXM8a0zjZYptSKIryk4KUSHiYLiY80pkN+gFv1mwvSfbefbWjexzemrYvg+fu192z9S86D0sE7bR9q2mbw1MZUT9VxLSzUb0QBpAyG4OVr4bIm8ENM2l+fU7QfGNN065rq747jDIdHBsGoerA6woGVylNEIxnLvqh0I7xDLABHbRdX/AjzVY+/2TsnJTOm3hPLWJ+/AR54G6r8MR8ZqVjZ2FrvBOjWLxoJe+4GeMlzKpfbdGoPQNm0zbaNr9RSp/Z5RsP1/WBmLdi8n2mJGbga5qltJwxetee8lW3tUXZQoMrddu1OY9oTbr3SN6bh6EJ1uhvTHIxOwFk2nfp8pKeYL0lZozIRenWFhw8xLRUyRs98CSdug9crwb1VDWr32wNgewxit5wFV10710DQu/WGx/U9KqE60G49PKW+TB3UnHlVjuO0B3rBnCYwpzp8fwDs58AvIajsoYiT9mdaAEMhNGwPnwpspb35K3RZB/e8qh5hmD8aJtWHzaVkTOWVzloKI5XivTfdHrCHbAq0uNRP83ZbC48q4gjBhmpwxyHw3kEmcm+zAfooxaXIN2l9K70xdeu6T1lHI/w9juP0hPlToLAebImo3XlvEhjTdGuaRl8I8DgWWp4Nn6qbwF6VfoGhQtF/bWuYOwwY6dWaMPVIePdgv6yjj9TYAXdH4RmSG1OlTZVp8y451AImrtwfdsboBt0j0Iyi34VS+NKBecnqRMrJ7NcRQ3y8QxiEJ4fPLZc4jnM6LLoGxjcyqeAJP0AjEbM8nK8yTpq17APvDYMeDQ14NSw3kTSopU0Rvns5jjMW7h4In5WHDhugpTKI6kFX+2WxAYbF3YOlaEyFAp38DUzTIio6TXg5jtME1k2CAWdCjV0w/QuoLJCM0hJ5jWYdx+kLD4+B4b8zwCOBjVTPWlcGttnaQ+Rj7+9AtZ1wyhZTFG/7BvA8rBsAzVr5SGYd0ns+hgv07vIKc3I5jnMuFI2BLi1MreSIHdClCI7bAWNqwvoyoFpp39VwlxcxxUamUj7D4bYr4JraprVHl7xBpVbnLIQnz4DBx5uIvTQiUxnT676CAtWZH0knvPiaqQxm6/UmGpGylcKLjEwq/gJz1BKgiDKq3hmvnFQzTZTm1Z2S/5/fg/OujCQpMYd+TAHMrwG7EijawJimW9MU+kItE2NhgNq/1A9tdZyi0anfw4TngXu9LIqNfLpD0aXQtrFf1tEvhB3+cKo+uTF1z4EMozI4HvHB4bC8Jkw8Ev5WyWRyovSFF2HpLMqpzmu/veM4AvAU+ACe/X+F0d/B9QK6uU6pMaZFk6DxOQb5rnpvqw1wy5dwjPSuylF51bsRxlHltpHQ9gw/o3TqRnjuLaiiNj6VqMKX4zhDYfZouOZo2LwPHL0Deq2Fa74wQYBrM/JWTtydxjSm1paZQjTsSU9cY+qNUuyqM877Cs4T+EQpkrwtrG1fKISzO8M/VT+06F0pYx1ONTZrwRpuNUX8djJMAiGJ5UiGVGmIy+C6sTCjNmzb1x7QH2Gunl/tJDk7QAY6XjQOltSGZkrR/GDBBL+Deq38Hk03xfmQTT/GbS5rfEbA/R1ham0ftOTWuBfCwt/DkBNKz5gKQXzL59BH6Xal8L5NABRRj92ptmZUC14/HIbXio5UEqlkOQ0XbYB73oKqSr8nZepKH5ke9IsBIQ2fGQqFJG8pKyn7Quh0eWLwke4KjGkJjGmCXmgZRaUFb1MmSGsaRyziOM7l8PBoGH6ccZy9yy3tyKGSY7UyjTH1shBhdLllf7sEFpwGV9f0nVPv+13H+r9wgXAjT2fz3rbnvZ9t5VPd85lEtVjHcUbAyAlw+xEGDRvWwVeHQiHhNmwb46Jp0LE5rPDayHSMtsF9H0FTGf0nsnnO4nzG0JeKBrTTxfB0FZMxcDEmn0ATsZ7FtcNZfT0GRrQ3xDLKCMjECTQ6WuUtlaEUpWaF3k/3/LvTmF4B88ZBYV3joVXdCQs+hW5CLCZEsVqvcSRcMxhmHQk7rGcnZNz1S+ESeVP5NqhDo41h803w1mcR6F2ldsRR+34srZ1d3AnQtrPfl3nCVnj9daii3q2880la+sBJfo+mousxK+C6dD2lqlP2g6Ud4Yr6JtLtuQbukTFtCkMsAKM0IlMZm7u+gRN2wKsHQz21H4hvV4fkbCEr4PVD4fFK8ObBsLwsbNovOZJTqaPqu+Ccn01NuZEOndJaKdtS0hvTMr/B8JUwW7K+2Sor26Zzaid4J1GPaWBM02mtJH+3+mIUTBwMt9Tw06u/2wpvvglVtA4J638W9T4JTm0fvS7Hb4XPtK/kEC0prjG1a67+7FFwQ0eYcaSp+3mX9l7PtExeqURiWrTGjIB7q8HpG2HuMqir97wrMhKLR+LL2Zv1BYyYKh1s5TccrhsMM2oZ59+7wpwAckby0k8eEZGKT3sUjOjiG8XDd8LcpdBdxAxJdb4BXq0bCxe3jM4yKABqugnmLoYmymbl3G6UojGVQlzwX+ishUyotBzHuQTeHQm9T4rujZTY5aXc/yE0FQglKtzP8iwm/Jjhdl1XCGeca6D1qpsufAsaCb3qRi0WOaf+1CNtikdsSFKUB8N9lWBiTfhxf0NwMGkFXHmHRaDlLaqO2Ji2x7d7L/jrIaCWjRuWwlDJvLZtYFcvrNpjRBwf1WDuOI7q1R0M8MglIfgHLByYT2OanPKsY114qoqpmyhdLc9TNehwCvoVmH4mzKkJG1IYT0lHh6vmDmghSsV10FIOkSKKFzJ1ctIbU/2OC0ISyEyRTZFfk+rYwvf8Y7deEJlmc4Yt6rMQTusI//FQ+A4M+BFuV0P/jSloJy3iO7KXWU/hOouK2rI2plZHSD+MgzZt4O+Vox07Gfs3XrRtWsVm4jII+9sLodDSbVbdBVNWwGg9t+r+bvbJcZyYgMbVwR9DZ/WI266DogJoeaafwfHQ/2N/hD6qTwrwU+xnzHQ9LValAG7oBDNrGpIJZQH1PhMzov50HKcbvFsAvU+OtxsKxG5YDt2VbZBBzVkHRYmNqU1bDQOEopJxkMDVQxWVSon3ilK3VDiO0w6KBke3p3hLogWWMZ25BDqq7uim0PJx2fcbDUP6w93VTN105rdQIOOjntFK8Hp5eCeCDUn9Z6qrCpQUyXjkctgKhq6oVIjavF/xbSXuAfoWPigHj1aFrw8A1XpFGP2QS/xuKci0yf4Wm0aP98xzE5k6jiNl0x3Qvw+FRyvDixXSU55pC0sZqYba/nFYcj5MOAH+UdEcRNfYOialJc5RF4G8HV5eDHUEShD4Sz11xXbIMjOmbguO0oueMu4Gd14J4+snb9cIjGk2B8Mq4qGGlWp5JXihPHxRFnovT8fi4xODtOoJ/6jk/767fqoVymkX2tXrM41pjXHPQVyaN/I9HMcZCAvGmOycMiXeVeEXuHExDFSqt9i6zEbVKke188tRiuRu+QouEUhH0VwSY3rbR9BlikolptbcpyM8eKhJq8ooj18FE5WJU5uQsjU5K0vFrrHN5A2B29rBNbVMSjyM3JVsVRZL275jdUkfeO4iKDjaZKYir7BslC5O2w2Q6V7MhTG1jEH12xt0pzvN42NNIwEe8JSxYXwZOcbP17ubTwrshtiWCt+Q9msGz1b2EXZSiK1+hquEMBMizxu/k7eist2EneDFQuh3ookwlfoRC5IAOFv2iYfVR1IJVvoVVhxgNuaCz6GjDGlacoRMFzDRfdYBUI+ZZo/WhQ01offR8FwVE9Hp+SL5grUN5Jws+BJO3gxPCxgTglYboY4QcUpHq9agyCpGmZTcmPoOy5S+cGc1M90lEVdopDMlD7PxZuiyAbpqaIJKBQJyqE6qSPp3xtFxiya/wscHwsX1TP3XTdV7qbusifkTG1NNtJHRljOlq+Z2eFKZDHn/b5pzMGZ0NPio7jb4YX8/rVY8Y5qA4k6ZBs19DSMdS7KfMvms7WkWD6xai97JpoHeZiQukNDsuskT+job4gprYE63wyZkKFRHTBqFmAyUIscGF8LnEQjguMxCSYypfmM8NLgg+jeS9yRnInuro0bCdQU+NkP/1cVGCJshR0BI3ZiOCpdwRcZ0GtDEtJ+IjEV6XPpg/jI4V9zVShenNWKZPmsSnaXWtH4w/Qy46QjjaIaRu8KeqCtCRt3bHzrbGiQiQynAl7ATygbuD4vKwvvl4McyhiddoxsFGI286m+DB/8DjSSbnLTQ5MKYKo04CS7uA89b8mFFCtesgC4SgkZzfe44TiEUDPeRZG4tQh67XiaybcBGpJGG1Mt3T18BrdTOoFmUxY4ksl1sW3ecABd3Ne+oRVaEKrYUQeAlxvM2wKlb4ORt0HJLBJXggTClDhy9BQbI61SaJGepBXuQBLb5vY0olWo+3PSSqWYouL96GaXgdXm0YUfshOO3wZmboL2MphySz+FPF8Loeob8Wu+pKG7UDzBM3rk2dDPLAJPTmqnjOIPh5UEwpza8Vd5ElboOtAhqbX4diNcrGoDOHV9BBxl5Ab3iIujItTbArMevg2EnGwfINaZyaIRizNoRS2xMj95mhOxxAIejjmsBHdoJ0KOfGSfntkkpqbPBvLOH9kxvTK3y12i/E2FDDUNcrp5J7xKzTbt1lpHr35aYI+272u8dYMnRI8UormChYN0ygOE7pi1wgpk8okzCuv0Mo047lT8UZaVtR3Ac50xpfTPFRC1Kse8hkF937z0+yMfsXH9m7o2Xw7W2l9Hde0IAfwuTBbpxI5gSRqa25NL5Up8W0xOxa/jSDm1IpsMcx2lmylHnnQsfWiKQRpvhfYGFvKxIAmM6/wPo+iS81wW6/t5w+Krues9ncIz0lUYU5q0cZTMCvWB9GxhyvJns5LUSnboJ/r4UKglMqSxgCB6tCKvKmMyaKCGVWVNAI+dVyG2P4SlSUtLV+lukg652QTf9r5Kb0v8lfscSG1O7wbrBwkIY0sAnOBDv7ogfYaag6CKx7wi9B8ODh5meTUGc/yPyZHeh7fd0haIroGdjeLmSuc9FYq2C0crTa8KKizrb3ZdJ0fxhHPzhKLjiJ5iluaxloPPx5mAoHSElPeWbSKSxTTnIm5IyerakhtQqH0Vex1iy7gomzfzPg+Htg2DxgaYJPbbv1ZOYFPWdy6C9HBjVQBV5Ks35iU2zjIYpF8Ot1Y2HqstFHH4EF1xt3tmlU8upMbXr3w5QRK0IR0T6SoUJ4PWz8Ti7NzV137BHPSUTr9K0DD0+E4adZPani9CU4pLCzzptldiYKlIXmEksM7rCICQBkAQKKYRTu/ogFx307mvh8aqZGFOrfHrD0nZwUx14rrJRLh5XdOTJUHpbkXGvdXCNegVVfkmJxDTcrguuhqtEymGNs3qmr10KQ2bYunJvWHYW3FgLnqtksjWeonIdlXBaO4XyV43ycljaFqbWhX9VgNVJ3sObneu+h8oj+n5lSkqsAK08NQCiA1x6fHSNTWDBf0bVMktoTBXxjjYUlJH8spKSm07OOltiHYJhUDgcbhFYcx/T9/qm9KWXok5gTG//FM7aYNqC1Fd+mXhutVf+kk9y+wjO5Athzol+T3wk3aP2r6J2XXqfVNkq3SPn/6DfzLxjOd+Nt0CbjdBoO4yoAXceFt3zGw0uK6lNyZUx1cEYDwO6x/d2Tf4WCmVMD4lm33APnVBVQvMKci5DOhA6NzEHS+lR9WpOWgyVZZDVI5S14iuuoAyloKvYpdDVOyZjPgLeOQeO+UJtE8A58QfjhC3wiccIlFOuSL+uM6AzvFjJeGaCuHtRZ+RbamlF0nDmRvh5X1NL0UaVIZq/CLqOTdQo7k+dmN7aT7eEIfRSppvyZUxTKN4YBqSo9JSMllI+byYjv4inc3SZt1SGUDpU6yvHQo5a2sgt8hmTG9PTN8P9luhD69B9DTws5PnfzfSkyOk1avMZ8hPcUi2dMY2uKU2vGc3sk2qHe9Rx8z6GZqo7JTWoxpjOvdZnuNL3hkky7jb1yJGnmhF+oqeMveKd5Ng7fJDJbe2huO/hTlpSa5zqgFlFTRZHoLMtFrMGMKc+zK5mCE68S8HAVV/DWAF4bvX+a0mMqXUYB8LN42BanWi0bLjsJcOXld6wqe1x0LcNfFwO+q+C4Yq8VBvcmjjNK1T8sxXh7YPhqu+hi4CJkq0CHC+lqlSqdLyiQ6VTBbDU2svQaaKWyiwKFDLCgdiyRAHc0wNuOcIAO9MZythdJMMpYJJAhA23wdmboOvPUElDBfRMq1QisGxmek612Zzrt9no+1yZqx1J4MCMnj3dKSuunUl4vyUMGA3nnumnGXSr6x0pXfArtOnhT43xjanZ0B4Xria1dFgP076GY5QuEsI05VSQnLxAxJfYtG4hDGhnZpL2XwN95K3J+LspJ6WwzJzMWIpEN+pRSjSjNFdxnj26tjhfdYUEykwQdtU9B+uZi+C+KjCqliFs0JXamNoDr/YNkeO3g6m1zFSTuz6AC68yNYrkkWmMolJLgC71u75agj66BMbUTfOuhMfqQOg36OLNU42LVuIVoNiPZknRHGkIG7TfrlE9RuCwjBV0cmPaowhuqu7XpcNRx6tw3wQYdby/HkKHj/wRrjwylTG1a6/2iksNrZqXBs90B8mgytA9+ypUFU4hzDcb4yAkMaZ/+BZ6roYex5msUaJIWN+U2pj67RfXDzL1ueK+h37D7XlcBM30HhmXe2w/5hBjGJQu1FzPf5c3mIbI9xHifeQPMFN7SoQN4XR1DoxpN5h/VTz7lQg+/vQ2nD+pJGxINv2uzNVRNgBQNsJD8yaITGVM3QlXusQIpX9Ue7QpVaXuVX/UhBxlDpROleETOEhRo9L6Z2+Eq76CynLS7kmXMTDr8MKVMOAUWJmATjN2T2vvyqGrsdPQtJ4rw7kBKkkXK+OnDJuM/yvJSgum33fdYOh/mo/DcecwS6fnRFfnJDKN8NqugIdHwOj6vtfsGk2x/ISgRWefzs09dC7JPdAFHh0EH1aAK36AugJOPFqSTZWpikl0n40ARD/XyTyv0kxyCu7+GI4V84Y7psx48fdfCQXHGeUYBhIoElcE4Cp22zrTAFgeCoVUR876ss82CF65AGbXMM+nyFRRaNsNMF7yU6Sl+lIzaHUBvGajUs+Yuryvqhlq8yV0VKxRvMxG5/JMhebTeyWqmUoxa0MLCHAI/LkqPF0JPj3QAJmULlPdNTswQ2JE8pQf4I7DTG1XkcolUnqKohZaAAAgAElEQVR3xRgGEWQrw3AKLGwGg+qahnyxVMkR8dLYOga1t8O130JvOX6KRtLWtZMb0+krYXht32CGJ9S8DZMHRg97kKHtsw7G10xjTG0pZVgDk1b1Li8DofqYRmfV3GWU3+cHwifloll3lFIe9T1cL1m5fa+xV/LI9MYV8Er5aM8+8tNKyWmtVedKnub1Z1L2ONUnEdH36D2O2Qadi8wYwws2w1MVDEr+pUqmBh1GxnuzaF1u5UzWyp7DmNaQRBIQ0vPK72GoAG3CN8R2JWQNQLLP0BkWTvZJT7xnKF7pImafX2xLI0rLy/HUmEL9b5VKVD9V9kUZnH3gpkOM46YeUkXfZ2wyQB2dBU2XUXkok5Rq5BNo7RTlzV4C7RQF/zGVgjOdHZMmwJxa0UDIyE95qf3TNkM/ta7JcMopl2MjRiPN+k1bk4+Rk3TBQBh0uplFPeZbuERrnJSBrziKOtfGVAAk6z1fV9M0J8ubvV+IsqOgXlv/ALmN1P+GKvNtmkApBV3/2N2RaAKFciF8MAk6NI1mAQmn69SOI2RrO1h4pV8/VB/p1BUwRWlebWahzQ6F16vAZ2VBtaf2P9p5iUpbZ83Ja9GTbQzvr5tykeHWJlN0JQamETC9N8yqaYA7UqQ6JOLZFTmBgEft1kJdIa+V4kxLZm293lbwZGcY/DtTf6y13aB+vyxrIOhyKhKlnQXEmaxeMaU7i0XsH29MhUiWYtW7TP0ORqv/TEQLQvJKgYhT+DDYUBXuqAovVTDTWYQSTjWCS2Crv78B9QRM0giulFdyY7pIs0iP80FISuXO/RJ6vwU9OkWDjy5ZC0oLJzemPmtSL9FbCrgUASaTMX7gS6irNJXWXZGFFOdx8NeTYeTR0elgF5TiRfFxCM3kxlSsUELWe+AQYQT0XX3XwaBIx0MpNfGhRpH7e4I0lG+x06PCqE0Rb8gx07+lKAVyqgvrm0Cbk6Kb8IWAfuclqKp+74wGLMT3WcYur95JBPS3JCQ9sMawpMY0yefjjanFW1wCaMpQZAQn3aI1tu01irIVQa7ZDz450BhEAXMEuvEMZLJyULpdXpy/hwFPWvukus3QaY4c5Xd2eL+hc60z2KEIBq6FOkJhS6e9lathAHYcZleLGBcfsiL3tI5zJlLIqTG1m0259RHweHt4qTIM+BqaPggv94DLGvlTMnSAOq+Dvwp6rSguqzpBJi9ZnHtsXVLcnj38+q/E1GCL8bzOE0zcQ/Z1tcArS62nVMSEVaZtRgT4ShErHRLZhiID0F+jgxStC0VWrDpdJu9imrhFDt31REPCL9Sx2kjk4UdeUh6qqYo841hFKwJ2KJLWGqpvWC0K+qeaiTgXVYLnK5hpMm+WN/NMM7lkyIXKbb8O/qxsRNoZpDEepViNBkHnc30UpN7JNaQCbXwK742A+UeZlJ1St1IiilojazFKgStVJPpHcSzfd4j/Dln1s9l5ppHcvG4d5nNoUc/PwrisU9/DdZ/D6S2iwUlK8dbZmcaYngzrpkGzC31+Z0lICviPX0BHRQOqjYUvW5ccB726RxtgN534Dpwv8JaMXtSV2JhKyQlI5aGNlZqe+R1cqqyGFJLQ1GkHXvuo2R4j4FEBEe1vu87GYuit8yDHO/aZxsEMMZGJktOCorR+Cz5KRfqS4Hv6wUNjYEpdA9KLPJeRd6uNbdwPUKgUsrIUYcOQgzSvR4+qeagRGYYwiY14nN3slWE2mjzM0E4qDS3sg5cW175O9vzJzqT0mPa5R3aifXnsdjNGUZGgLmUYGm01qN7vE8xrVfeC/hab5hefdd81MEzOfEq9ZsCcMyfAdUeb9VRWTdNrJoh9TA6esmoaX5mRk5Toba3RrJgpAUsmWizdPTk3pnYTCLWmvL16UAXcKQt3ToLx9Uz/kHc4pYtdZgt5ynknek4nDPvsQ+GRIdGjm1SjeWg5NBLyVZ6/jFIFWFQeHqsEtx+e+bxEibzJJnhHoKqcFL5jlKjotMbAxWcZT15KcOBP8INQuFXNPEXVOT45yCgz6aZL18BfpAzVI6h6SRlTUxIV32cHwvIDYI36IBOQ+2stpaDDPMXboNouaLzVoOjc6xc78UfykyeYUf+jVb69YX13GHWCIZlwo2uBQ76DMTKkojZrBu+KPP4EeLe8P6hbikHP1nQzXLQRLlN9RcOP18KTTf3oWo/oetUirVCTe9qo1O6VFMa0Z214xJsSBCgCXfB9dMSq95jznYkkUkamF8IrV8GVx/v9q+4zb4GHlI7UPkoUZQ6EeWN9Ck99Jl5px+yfBDXTyDvCM3i9+lixQIGO40yG3iN9VL++O0wtqoyAEP6xxrQLLB0Nr0UMYVeWp90yqCLFndEQa6tge5monSrwWFW4p6pxbryUv/fTLuvOdzBRzp/2hBu95MCYFicy7Q+PjIKx9UwfcrrLIyc5ZJeZ+HLELgPO0b/d4d8ibKnq7zW3xWwxdFAmYINNowogEXsp4yjQUWSvppS3yjqKmJUVEye5osiF6dKvZngJBfCoRlgKoKeAQsGUJoKVqOfTgKxoD683NNF5h7VQSc6QAFI5GyqSaCXyYkxjDqcMawGMGQoCzWhKhhSc0kb3H2oW/U9fwHmidoryrtNtnVz/3UxzLxoKbZv6KSW3FrkeNu1jIh0v6pGHls4z1ObW3FIZL6UvVAs6a7MdDaTUqtozcnZZOjVxWrYznJaStWrTf1sOreuaSMnjtX3nIHjIGqdTNpu/Samn8njlveqg1twJiy3frRuJ6TAqxSiFo7qG+sKUmskaOGb7HXvDqy1hTG3f+HsGwTC3eIfPcRyxJ3WERQ3gwapwuIYw6yB9b8EJOqzydpWe7wh/nQpDT4B1+xtvfdRKuEE1YfG3ZtRykTzNu+wjmFITbj7C3yOquQ/9KbqW6o70+xzerAgTaiermVpAnJSEB+jy9oyclX96GQWr7NWzKWVVD9bXhcuPjSY+Sd3Dmjgy9X7uECHBl0F3kYwrYstITjH6IEG9TD1/asm4S05MomH10iEqA+n9PYUupb80k/JEogNmSwcqk7SAZSdBQR2TSVPd17tUP53zJfQQ0MkbVFDSNG8XeHKKP3XJ+y03zfshdJnsRVM2vT/AZPWuqgPvW0dRj6geWOnOOjvMUIsLN0FLr41MrWRCteofOZD6/5Jtk+gxmOnBiDlTTjFfFJH90l8ETswqQ2f6a91ygIag14Xna8OM6vDewUaXKRslTl4xObVVV0Zazu1s33l3GFMdgEJoe4lP9i5Q0t+WQes68E4FaKaxOu/YsTpZTU7IVgDe52z/5nDodI4BWagudeIWU2cTa06yWpsMpi7VCRWltdgIzSM3tzw+eW2Ca6sOtCiW/7akz26VqIAHY+CG7j6npctf/DE0/Q5aXOgbU/fQivBAHnoFeKKmASUIoh5Jf6i09VE7TATU+mforsP5Mzx9BAw8Jh9TY2x68lJYfz6M/h08UdVEDSoLKPpV2jyaUzTi/cfD661BiHCtxdlr4BhB/YXQDQNJDAr75okwra4BYrgG5lPolDAySrY+KYzpv+H+6lAgg2ZTZUql9RM72BF+atlF+b4J84+FiUena41J4KSqvaOx5YRW5FAFXq9gaPReqAhLD4yPuLI1puHJK8oiZV2e8JGc/VXyiYi25NDIGFyxFroKbOKdGylZRTwCy2WlcNOdLzvZ5TIYdCbce6hpN9Ml9dimCJ4VWE8GtdhTY2J/2/CNz70yuvVId8mxeuJf0HhaLNLacRyRY3QTyscy/ugDQuDqPCrTIl5psU5F8Won+O1EpA1qkyvMNBuTTpb5+rsFXorgQ2WnIwwxjYBWXulJvfY699IPCXuufzPEOrcshmPUFvfnXLda7g5jejqsm+jP81R0c/mPcNfT8GRzGCogSxk7KFdsNgsyTdvkauEcxzkPGAAjzvQbe2WIHhSwYwuMP9a0A+wImYhHdYamW6DZVsN21PxYE8m6NawvoaNSVe9m6zUX9738doNHL4OCugZwEuafFML1BGhxiW9M/T5T6/0K5HAhPFPfMNDoHV1PV06AIjsdVnERq5ZzSjQBQsnpBK0xVElApYHmMOc4mGP7/mTcVdtRmlRpZo+0wUUkq0dZNRql3+S0TYI+AvgcYupCSqOq9jVNSGSh9kRMoShnIlwxEP50uPFe3SHeXro042g6hTF9FT6oAB2b+ePrVBdsuQmeFsm5PXduv+vLMK8JFNbJxJhGgFKawmO14MlKJhX/vagtM8iWZGtMXcCgph0J35BRWjXRPvbBZCN6+hNBYu/Ueh/0qykXCAnupuhlNNQ3qDTgX7OJilOdK6MDikbD6S2NU+ld0TNpc5DmtTM3p6peGIE5cM+R9IZS9hnvweLoihR0ghmRnxTnt4pzr+M46hroDdgxl24vnqJpgdks2Gp5OTMhSvSAAjsKG7HW4lFSgQpjn0QkQIXfwzA5SMpC5QR85LlexXnvYt9r0Hu3jIKpdcxhl4L7w5cwaKahwJt0KcypYSIi1fbmKWISGCZhH1yxHyDNB0zKTzNH+zaHR6qa1KiIF+75HJqI9F3F8ItsFKd6orxmL8pUDbALNO/oG1N3Ek4YRJDr502ioPrDewPh0oaGwUXpn6u+hWFKI6tOMNYfwZY4tRPBiyqjpMVImEKLZxPK3pjabIBSbeIPrgU3HmHWILINwm1VWAlDV0J3IVQtA1J8JGlbkPrDE81gYi2DLlY6bPBquFkGQGlcHdJCv+0p5EAvjcASPF6KLOPUZQpjKuO9DU5t6zMdKfLSunh9dWFmpKdh3vnxdc04Z0EK/jJY3wXGi3atanp0cqLdko0x1bOP/gGuFxJbEVrGMkqyX5WWGwU9z4YnIujjUp0WpevEWFOw2vZ8K7JIOSKvOGfPOpVj4Yp+vpOlbwjPpBVq+JGSGFMfgDViCPyxmh8B63fcFkKlknPS85hE7sm4eUvNmFqZTIZeaqu0oDQFXHKovCsZEtkDNnqlJ4GgvEttYcsPTJxRPGo7PPZvaCw9nRF+I5O9lNfI1EYLhXBxd8NpKx3tUjgplTvLsmmMhg4XwbMiYf8NBq2GuQLnyKDmxUPzBOM4Tl9Y0h+GN4RXKxrEqRDGsz+GKmpdiUMWRgo1vh81DG8XKEa9XhpxpvSrjLCAGjLM6p/NmTdkmaM0XaexMejaWK4hVTpOqGMp4Yie2ZLVSXJlTP1JF32Ufrb8wZHcsl7v2pzlcLHqaAdAt16GczjMyKTDEAUqsLWYvoZur/9x8GYFUE2u309wuxy11+GlK+CyhrDqABMBXfsVjFGKt1gTO1IYUyHUV0CPnn4bTOxxDHP2LoR53VMZU6twBsAz/WHMscmVhOcfax+LUk1pZAFQptfIJOrVp9MwIF1bXBklU0JmFB1yfFrAzdXgvwdHcwsn+6QUrdpXHvDKQklJG6z+qQ/8N5OUnkGZxrITub2538L12h/3ltCYJih5eWvmtt3JoZMxLZGzkkLme5wxtXuuDzw5GoYeH91Drb96oCqhtzXcov52+P02C6gSNkPpbpUEvDqxasTVYEYXQ26SqONAVIMPvAGNNRRdaPScXPk2pt3gpfG+4nLJhVfB7bdZhJwormJmzwlFN34lTFPfo1K+eTGoljZvEpzd2rSPqHn5yu8sYYSK1GmFnNiYilGk4m+GK3dROVhW1hAESLm50PF/WvL/Ekfe8RSMSs/e8DX0Vt+l2iU0KaKhicQadDCTKvJiTBNO/0m1Q335N2xnOEEjL4+t575PLdm2ahyjoVufGGMq5S4Gk7jL1KaK+vk8z9p7l6yDvyyFvsfAA7bdIDxLUpFHsdqzUhhT7d2PYPKAaIKGyMcMT5N5AeYNSGNMW8M7hdCncfx8RkVsUg6/32oGLSg9X0cKRmnRDTDvjExTyLvTmNrfkqOnzJDasI6BZw6HlysYcJuQmGpfUTtObBov3JeqfRfuaXQc52Q7xs+idTeUh8VloJnKE2nbsRL3ocrBH/Y9zJExvauExvRsKJoATVtGtzipP120q9M0UUrZk7xcidO8bsmnVGumfuq/sDvMOcLvZXbZ84TElaH06uiqm6v0JD6ChKQNqUF0AoLOEbmEQHQ5HRCeN2NqvcKJ0KeLPx9Pk0rufg8ukkfgQqCt110A1w/w6cXCBlV0gjIKJTY8sbvTLuBwC+AQKlKtIS/FFuKtwTzD5vNV9BZMXMpfkafaY8TaVNtQKOqQqwwSiQiM/GWBYkRqfr8MgAtoyPbUOI7THoqGQL8mhuy8wVa4SX2wMqR3R0D57Yi8uu1NRJMXY5pyjmMKT3k4PDIoGvovGQoo8ND7UEVTSpRaU3RfCN0u9Y3prKUwMmWkZGU0GHo2MzVvbXd990cHGQ9Yv9VnNfxJnLOqBRYrY5DGmL4IdxYkn1vq1mnVXvIezBuZzJgCmvgyDvr098+RF824hA1LoK7aYlTXlnIREMXtz4tXnvqv2aR5w9y8OYtMkzhAYvLR6DxR4WnND4PnD4e5hxlglUcYoU+LvWfWEhimc+Si4k1/9YPj4eq6hmdXaHsxWz2uUVsyhspMJL3MeLzJBdEOUPS7Z2tMrZ5Tr+xQmFErul7q1mUXwXnSi1nXo9PpkhTGNCFPd7rvy+XfzVn9cDx0agTf2Pmjycd0plnHbjD36niQVxiNrnqp7Eqxznu6982nMbX9miPqwdr9QbWpHmvgQb1IFDuKNVgxg2nFj1nwI8wQKEkeREqkWroXzebvBuWnyfNPHAtvHGzaY7ymZYGmMgF8eIpPEYRSRqdtguc845PVjEB/3mvPU+GtCtBJqekPocp9sWk429NVCHUv2gONqRTmIHi2O0w+2kRd8kal/KpozV1kt03dFkKbnobbOazglBJLl4pXu9MQaNssmkFH36xpOHeLc1hKrNj1tzTG9CFYNAw6tvBZtCJ3YXhO5jKYZwdGx49gswZSmYV20TMw5Zj+6RM4X+WQhDJwHGcYzCvYUyJTC54abI1lpO5RCUSIaznP4csaIIHS2llw4OG+QQ0PEJAjpIhOLU9nw9MzYFBjn/Up3PYk8vako7Z8579bN3jc9gfrUQQcm/0JXKa64gslMKYiHimAFuf4ZB7eq7p83nKwRXJfLIq84ui1PdyYiihmInTr4cs/3BM9tTjnM3GGQZmpvqvhbjmwylLkXM55MabWCA2Htqf5Cky0c499kGzivZnSIrL7NqfD26oxRqA4/6yUqwaN57XpNnZjOo7TC54cD2Pqw7cR3KDJtrCMpYiYldI9bjsctTOCvEBkD+oDE4ftU9kifQ23adEY6Ho6/LQfXL0SOit1rGhUBBlRlwHlvDwDLmti2KfyEplmjUK0CrOHnY0p+kW1sGitw/SG/rSc5pea/SRjev0yGCElGsXHm+D9lUocAW/0gh71fACQnDvRli3UAAP9XrHqpdbIJyNtcEsUQB84tZMPQvKeLgw+0nzYTYmJFQwAyeyZp6+LNhD6HhewIo5od7xWgvcWD+lwaHVmEm7mMBI6xoClmhpTosjUtMU8ew2MFPuPbRkS+cL0ZTBYhk4Ap7jLDtEYA43P9ikadZvP723bVjSgoRAad4NFdqan7hP14MOfQBNFI0rvJfqNPvDSSOh3QjT5uktb+IKlLfwwG2NqgXGDYcRZ8WPAFGFrLw8VxWZOOGKTaad4Y6p2rfdfgyoqcaQtaxXHcGdzr8kMzBjh1zpdp3kJjNSYTpFnZHQ5jjMeCgqix9wduw0eeQ9OUSYjLXVqRj8Uc1POjaltotW4mwt8UmwRF4izdqI8aHnSCcNrg/yNZR8S4KDVz7BA6SzVSDSVIOv0aHGE5JO9a3DttHrwQiXTxyRvVZGBDOYFG2Hu4cbbdNMSUs4f2YhCBXKNBktLtZbpczmO0x+eKoDVB8MgTTpRS4cm6yQELcSPH8u1Mc3tTMAkik7AjWk+IllOy+jvYJYi06TG1E+tLe0KfY6Lj0y9AQb3am8pvSaHJM4wpVBOqYypiOQ7QrfLTGo68gojRIVoPwjmjUuR5lX/4QwYemI0/Zzbo6oMh2QQSXcn50HOSRfo28igoyPTo6WX5jWgo5dmwuXNfFpRt1VuNdyldQwzDcUY+DOhaCI0PieBMVWKVylcl4nJcZxxMHGEmenpvbdXg39+EVQWZabKB+HzYrEH/aBti+g9Es6mycjL2Cv6zZi0wR98vl5j64REj1kLPddF6+F5ZWCk5LPm6s5Ef8Qb0+yR+Jn8XnHvMUHYK1dC35PM/lBv85Af4Fbti4SDGWJ/w5554Qs09cryWLv6YiXM8rIYeQF45dSYWkM6DEac6/eQhTlPZQgllKSGxRqvcTC6p/EqIg+DmppnrIBLFX3lFBafbtEt8lRAiRMskbqiTB1egTwaQItzI4ypN8s0a17JVM9jo7T29p7n0qUrzAG6bSpMPBa27Jf7yDQ8FUgRUlZp6wzlPwlO7mAI63XIBq+EefKoExpT24h/SXSbjIAs2vJS4CIB9y6130zUAHqB3WRUNXg6LU1emjTvDcCZMKYA5tcwLVfe5fcuGuBNSmO6Fl6aBZef6hsgfY8cujlfQ99XrfOm/3gkIGR6fZhWw1Arxs6JLFVjqshxEjTuGh85PrIYGgsbIaYeZW68iUudjVMyraUZa+ehM8Np3igErDFg68bDWefApxH9orpflJHXr4BWcph0dtV+URGW1YV+xxjkd2TDv8oA9/wXLpDD4pUcUhlTDRsQ+Evfuz8sPwTurAIPHWJquLFAKpdU5SNoKr0o9H1eryTGNGfzPEv68FbPRpxzfaPbix1O5af7Db+DpFUP+IflIlev8uuKwOUQ5a1cmDNj6rOIDD0D7j3MFP+ltNoXwRMCGykiTdvTY2t8Y6DD+fBMRIO7xCjDLADJ3K+hriLAx2LrLOmEncu/x6N5626HpSIRSDvg1zoO51rOS02AUIpTQChNSvgoV4vuOE4BTB7tgypkOG5/GzqOS5QWTief+NaY6CHv6T6fyd9tWqyvJdgXy8tG+PBEaH+yqT8mN6amnkxrWNYIrq0NC6v4LEDyULuvM8hXMRF57ER6Ku3Vk7dA4SroLMYd1VC1v5Ia1TTGVK1f9eHOyfEgJBd85KbGNfA3jTFV9kGo865mwHvkVekX6LIOTt5m/uuKMgaMttiOvksk7XBUrDRvnALPZ2uMjRpGwaTBprc8ko5T73Luz9B7XcR8TXUyHQS3HmqyQl5NWe8VBiAJfxFVMzZ7fvZwuPoo2GQnq3iykA45eoeZiao1/+aAxExRum/oKpijtLB0lxf5JjGmarHSEAVd7qSWfc3Ai2RzX8OoUvWy35GvdpjIHZDEmGZdosnkLBfnHtvrOwF69PNbyorXf2v5lydCgzYGYxCumec1KtV7ltiY2gNim8kHNYSnRHxgqfUEjHnEQ+RGgQtSCTm+XSb2bh089YPe9B1UUkpVEZrSnbv1SmJM5emphikCaCk/GUnVh4T+1aR6/XdbExaZ/Koy8EE5A27SJcq8IZqeIOCVSOGzrmX4KY9ug/1UYxghl9bgJxJmvDGNrlvlYgHMvMPp4+CPR4IascU/umUfeEuzW/cBt5XgG5imiEG9f2KwEsDjBFh0NMyqbtC73vB0bXO1wFyzArpoH+6C21rDNbVM2j7yEuJaqesxP0IfIWTVGywC7jiPNgNjKrT3NOjYPBqE5IKPNItTxrR9KmMqhqfUxiGdxDWlaGvIJwhwJ9isgOvECBWXOsunMdWTGmd53QS4+Pz4tHu6d/H+Hm6N0ZlX3Twq22W5jAtgSie4tXo8pWK635ECdvuS1S8sOYVbppKnedN9Z+SzK0WvkXxN5ARkPIw+019Idl+8MXVLBcKh5C2rVNxnjp91qlrnVwm7Bax+Exf10TYro/GLcryOgsvqGBBazR3wuKJ/1aTzGv2XyJhaYzIAXmkNk44yqRulMlQ47v8T3OoZ0rhRT2mMqdIzg+HR/lBwTPQ8xshPSlEoUp0k46OITmmWF/LBM2lJ5NUio7YYtccIiSrDWBdanGTSvIo4Xltqhhpv2NcYSf1bfawikc90+K4Oc8ciuO0/UFW9tlkNFPfZRboNjDGmWXuj8cbURSLKMITrVsU9QLH3237BETDlPJhf3TeK3p1h0gYBcBrBojpwb1V4saKB1XupTRnG+lvhsrUwVnNbRQaiZ9WhGwSPdoGJdcz6xF46GgKSqV4v1p1GX9kJSDKsbu9zBsZ0CzAZTu5o0tO6wgPkRWV2Y2LkYXQq1p6zMTDmYrijWnSElkzaev7jtsIVa2B6TBTuevuShRRMFGgt38bUyq0rFF0BlzY2YwFjU9GpdlCYtOFtqKKzkZC0wZ7XobCgDVxfI3GaNdHvhMevqY1GgKVY+SSJTNPteq2HqOwuXwPXKKsm5P1u5SGPN6buPlB3hc7ubsGhpJNS/BAKZdLu+hgulg2R7lUWT+lbnaeyZrqV6AU/0nSrsrC6jBlIoqyHOxXLZkcXqvyW11GfWRlTG45rlNFFcHVDmFcNivYzga5qm9O/gd4yAAILZUW6YNOgGjTewyduT7YUcUNlVRPRhADVvqIg0BG0eSJM9t5fUaF6SKVk9d+0aPrfahrVoh0Ai8rC++XMVHoN4FXUo7l+4otVc3kkyCPdlsnk71GN6RpPl60cJ8DwkXBHdROduAdIyDilx4oND483pm5NQwANd2B6Jm+WyT22fjIYHrjQTFSRjL1LNce/fAjnrobWZ8IbqnXZP6pHWem2C36GzuuhkVK2ovd7MvL57B4eBK9cAsOPNW05yTg+XaO8DToXQcFKqKxyhdJz7aFgCNweMRrMTfXLUCnNK+T2BOjU18yk1KWWr+u/gmEu41ISY7oLbv84hntY5BuD4fFWMONIk8JK1M+sfVN9F/RcC5MWm988s1l0/VAMSZNWwDQ5FlH9tbvDmFqDKvL2XnBbM/jjYUb+qc6Q5xgN/gmGSf7CTaQc12XXWFmz9ksyi78AAAcUSURBVAZA+FQVkwmKTb3qyGs6lBzzmSohaf0ERoszMBGRaQQiOdGO1neqHU4UkqdsgZ5F0FUAo4xr8pmck+LcE29Mw+1Z0gU5O7vFeabYe60jPclP0yqdP2ANrCxjskje1C6l/D2Dme4XhRifvBym6D3VIpWXq1jG1BqiLqaN4bnfm7qTN+pGSsKl4lsEVRQxqN5UItSULSaPgjkdYEZNY7DTXfJcxb0oZXKtvBEZIhcYY2txw+BRDVuO+C4ZyfX7Gg/ZiyK9Qbw6eJkuWuyzxXJM6u+y2/J+D7CaWxR63nuJAF0RrKfUleK8+TPor0kSLqF7cS8zmuzOaaZup/pR95/g4T9my7EaYUxPNpvb/T4xWindVqL1TnCwFP1rvbr6BP6666yf4TXtMY1+U3pXmQJvL+8CVtlJIy+nckLsfu4HS3vAFQ3MXMtkhBve00npTvoWxqutRYTcGhIQAXRx71NqWGCHJY7jDLAk3pEsTxpXp6jwHcdxOhkj6b5D5CVSd90TTvNHtBFdAMvrwdOV4O2DzMQi+X2qBbf5GRopPS1nUmkttchoPF3sM+rZ5WREIWhN65V4c93JHJGXaoYau5aztgJr7KRPNA2kjqmTKcJQpBGW969w5mbosB4qyUlWCUVOcsbK37JtdTVZjOU14NUKsHx/E8Vo7m6D7dBShlPZC83jTJpJs6MBx9jUYqrjKJ5YbySa1lsRrkYA5vSMFEcfRBtTkey7Z1eMS3KES+25It8hgqCld3S/b6o39RwX6VtPt6qvVLVx1bJP3wy9lkAV1b6T0k8WR5aJ7s3YmNpU0wh47jy4sbrpBRUiUhR24sqcJio+pUZUA8gZxNuiVxVByKDWMqlkkSXERhHicFQKTTZSaTKNQbtP0bG8EbemYijm7p0CY44zqYBsL9WdZAzldcrgKRqv/Ks5mKp5dhf9lXfpQEnBZ3JJiRxkQBeflTWsRi3FgONOPMnkC2Lv8ekEG7cz0zBcD02KPquetmhjqvF0QtXeKqU/J5vnS/cZ61CNgwFd4S+H2x7TJTBE76DosMSXNWhdYFFDeL4ifFzO2Eld2leNtsLBv1mlK7Sm9rcio5SMOiV+sBRfYCN38dt6JQcZO+01jfjLOWNYPt/F+24LYjzGlk9kzAXoEdeq/pFjlBZhne45I+Qm50L6T0bv41wB/tL9fmn+PdqYKkslmsTZOkfiEt9jLh8zMesoE1yorKMJQtK7noHUmZTO9YaeuwPKBcTTwRX1oAXluVSEGkjyRi5bFBMJqzjGtDUsmQh/qG+mVbhecBE0kmKRJy6vKyuFn8kqWpSmUkM6bMqbx16eJyhhCgGqFJcg9qqjupcf6V7fEW6qAetiwCfenVKgXopGhlnDsLV4tXdaQ6lDrh5S/SMPWShc8UVqAXXwRUuYsecc+yLWYxdJ/uJceIwmOnqkAP5+OMx+HaoKuFMsHtoIGZ4Dj18Hw04xwI5rl8JYNVWnZCLKZI2T3WOoxl6cDGNPgPPXw2yBJmTAi52mTvUctrWrEaCUrIBjaoFSxKK9pf/9P2uoSiL/4LN7hwSMMZ071dDsKUM2azEMd6fh7ElvaHrjX54GlzeGbSG4fTl0E2ZBIyG9zJOMpHRs1oPFc/3OxTGm8oBlzDSMWMZD1v61fPUW5vpFI4yBaKsGwNLWML8mvGvTbyJgaL7Fejp6Py2WohB5OVo09aWpBiaC5awNZb7eK42RkBeudJockX+WJKIyBuf96dD5TGNMZ38KfTW9Jas0dCbysOnNgaaNxJ1pqYk+eXPcMnmm4J5AAv9rEoiuhwtbcMf70F5UfRl3WuyOd/azUZPV2y9eElEA5tx5zvW7ZGxMc/3Dpf19lidUxNpqdNclr0dRyL8DRZ18dfxpL/U6GNDPO89ZqrXAuJX2pg5+P5BACgk4jtMZ7psGoxtAtZ3w2WOAskp5IVspyWJYIJIIO5Tt0zD4Pe4ZY9/v/60xLclC/3/+rM8w0ra7mZ36ZzEQFXviyv9nGQbvHkigNCRg8A7PTIchp8BZG+DBrIGIpfH8e/pvBsZ0T1+hPfD5DELY5X9VKvyuVOjHPfDxg0cKJPD/UgIWfDUBbj4LTv8emgnFu9vJbvZW4QfGdG9d2eC9AgkEEggkECMBA+7hLEBlGfVe7xEtMXvDQgXGdG9YxeAdAgkEEggkEEigVCUQGNNSFX/w44EEAgkEEggksDdIIDCme8MqBu8QSCCQQCCBQAKlKoHAmJaq+IMfDyQQSCCQQCCBvUECgTHdG1YxeIdAAoEEAgkEEihVCQTGtFTFH/x4IIFAAoEEAgnsDRIIjOnesIrBOwQSCCQQSCCQQKlKIDCmpSr+4McDCQQSCCQQSGBvkEBgTPeGVQzeIZBAIIFAAoEESlUCgTEtVfEHPx5IIJBAIIFAAnuDBP4PS+NRNGbhxpsAAAAASUVORK5CYII=",transparent:!0,color:Cesium.Color.WHITE}),fill:this.fill,outline:!1,outlineColor:Cesium.Color.fromCssColorString("rgba(0, 0, 0, 0)"),outlineWidth:0,extrudedHeight:b,height:this.height,closeTop:this.closeTop,closeBottom:this.closeBottom}}:1==a?{name:this.name,polygon:{hierarchy:{positions:Cesium.Cartesian3.fromDegreesArray(n),holes:l},material:this.imageMaterial?this.imageMaterial:Cesium.Color.fromCssColorString(this.fillColor),fill:this.fill,outline:!1,outlineColor:Cesium.Color.fromCssColorString("rgba(0, 0, 0, 0)"),outlineWidth:0,extrudedHeight:b,height:this.height,closeTop:this.closeTop,closeBottom:this.closeBottom}}:{name:this.name,polygon:{hierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(n)),material:this.imageMaterial?this.imageMaterial:Cesium.Color.fromCssColorString(this.fillColor),fill:this.fill,outline:!1,outlineColor:Cesium.Color.fromCssColorString("rgba(0, 0, 0, 0)"),outlineWidth:0,extrudedHeight:b,height:this.height,closeTop:this.closeTop,closeBottom:this.closeBottom}};var D=o?Cesium.Cartesian3.fromDegreesArrayHeights(r):Cesium.Cartesian3.fromDegreesArray(r);function S(){var e=f.getPosition(),t=!1,i=new Array,s=!1,o=new Array;if("[object Array]"==Object.prototype.toString.call(e[0])){var a=e[0];if("[object Array]"==Object.prototype.toString.call(a[0])){s=!0;for(var n=e[0],r=0;r<n.length;r++){3==n[r].length&&(t=!0);for(var l=n[r],u=0;u<l.length;u++)i.push(l[u])}for(var p=1;p<e.length;p++){for(var h={positions:null},c=new Array,g=e[p],r=0;r<g.length;r++){3==g[r].length&&(t=!0);for(var d=g[r],u=0;u<d.length;u++)c.push(d[u])}h.positions=t?Cesium.Cartesian3.fromDegreesArrayHeights(c):Cesium.Cartesian3.fromDegreesArray(c),o.push(h)}}else for(r=0;r<e.length;r++){3==e[r].length&&(t=!0);for(d=e[r],u=0;u<d.length;u++)i.push(d[u])}}else i=e;var m={positions:null,holes:null};return m.positions=t?Cesium.Cartesian3.fromDegreesArrayHeights(i):Cesium.Cartesian3.fromDegreesArray(i),m.holes=o,1==t?1==s?{positions:Cesium.Cartesian3.fromDegreesArrayHeights(i),holes:o}:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(i)):1==s?{positions:Cesium.Cartesian3.fromDegreesArray(i),holes:o}:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(i))}i.polyline={show:this.outline,positions:D,width:this.outlineWidth||1,material:Cesium.Color.fromCssColorString(this.outlineColor),disableDepthTestDistance:!0===e.disableDepthTestDistance?Number.POSITIVE_INFINITY:void 0},!0===e.disableDepthTestDistance&&(i.polygon.disableDepthTestDistance=Number.POSITIVE_INFINITY),e.temp=i,e.pos=n,CgsFeature3D.call(this,e),this.pos=n,this._posCallback=null,this._posUpdateCallback=function(e){return e?f._posCallback&&(f._posCallback.setCallback(S,!0),f._posCallback=null):(f._posCallback=new Cesium.CallbackProperty(S,e),this.entity.polygon.hierarchy=f._posCallback),f._posCallback}},CgsInherits(CgsPolygon3D,CgsFeature3D),CgsPolygon3D.prototype.setPosition=function(e){this.positions=e;var t=this.positions,i=!1,s=new Array,o=!1,a=new Array;if("[object Array]"==Object.prototype.toString.call(t[0])){var n=t[0];if("[object Array]"==Object.prototype.toString.call(n[0])){o=!0;for(var r=t[0],l=0;l<r.length;l++){3==r[l].length&&(i=!0);for(var u=r[l],p=0;p<u.length;p++)s.push(u[p])}for(var h=1;h<t.length;h++){for(var c={positions:null},g=new Array,d=t[h],l=0;l<d.length;l++){3==d[l].length&&(i=!0);for(var m=d[l],p=0;p<m.length;p++)g.push(m[p])}c.positions=i?Cesium.Cartesian3.fromDegreesArrayHeights(g):Cesium.Cartesian3.fromDegreesArray(g),a.push(c)}this.entity.polyline&&(this.entity.polyline.positions=i?Cesium.Cartesian3.fromDegreesArrayHeights(s.slice().concat(s.slice(0,3))):Cesium.Cartesian3.fromDegreesArray(s.slice().concat(s.slice(0,2))))}else for(l=0;l<t.length;l++){3==t[l].length&&(i=!0);for(m=t[l],p=0;p<m.length;p++)s.push(m[p])}}else s=t;this.pos=s,this._posCallback||(1==i?(this.entity.polygon.hierarchy=1==o?{positions:Cesium.Cartesian3.fromDegreesArrayHeights(s),holes:a}:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(s)),this.entity.polyline.positions=Cesium.Cartesian3.fromDegreesArrayHeights(s.slice().concat(s.slice(0,3)))):(this.entity.polygon.hierarchy=1==o?{positions:Cesium.Cartesian3.fromDegreesArray(s),holes:a}:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(s)),this.entity.polyline.positions=Cesium.Cartesian3.fromDegreesArray(s.slice().concat(s.slice(0,2))))),null!=this.label&&this.label.setPosition([s[0],s[1],this.height])},CgsPolygon3D.prototype.getPosition=function(){return this.positions},CgsPolygon3D.prototype.setFillColor=function(e){this.fillColor=e,this.entity.polygon.material=Cesium.Color.fromCssColorString(this.fillColor);var t=this;setTimeout(function(){t.entity.polygon.material=Cesium.Color.fromCssColorString(t.getFillColor())},50)},CgsPolygon3D.prototype.getFillColor=function(){return this.fillColor},CgsPolygon3D.prototype.setOutlineColor=function(e){this.outlineColor=e,this.entity.polyline.material=Cesium.Color.fromCssColorString(e);var t=this;setTimeout(function(){t.entity.polyline.material=Cesium.Color.fromCssColorString(e)},50)},CgsPolygon3D.prototype.getOutlineColor=function(){return this.outlineColor},CgsPolygon3D.prototype.setOutlineWidth=function(e){this.outlineWidth=e,this.entity.polyline.width=e},CgsPolygon3D.prototype.getOutlineWidth=function(){return this.outlineWidth},CgsPolygon3D.prototype.setExtrudedHeight=function(e){this.extrudedHeight=e,isNaN(this.height)||(e+=parseFloat(this.height)),this.entity.polygon.extrudedHeight=e},CgsPolygon3D.prototype.getExtrudedHeight=function(){return this.extrudedHeight},CgsPolygon3D.prototype.setHeight=function(e){var t;this.height=e,this.entity.polygon.height=e,isNaN(this.extrudedHeight)?this.entity.polygon.extrudedHeight=parseFloat(e):this.entity.polygon.extrudedHeight=parseFloat(this.extrudedHeight)+parseFloat(e),null!=this.label&&(t=this.label.getPosition(),this.label.setPosition([t[0],t[1],e]))},CgsPolygon3D.prototype.getHeight=function(){return this.height},CgsPolygon3D.prototype.setCloseTop=function(e){this.closeTop=e,this.entity.polygon.closeTop=e},CgsPolygon3D.prototype.getCloseTop=function(){return this.closeTop},CgsPolygon3D.prototype.setCloseBottom=function(e){this.closeBottom=e,this.entity.polygon.closeBottom=e},CgsPolygon3D.prototype.getCloseBottom=function(){return this.closeBottom},CgsPolygon3D.prototype.setOutline=function(e){this.outline=e,this.entity.polyline&&(this.entity.polyline.show=e)},CgsPolygon3D.prototype.getOutline=function(){return this.outline},CgsPolygon3D.prototype.setFill=function(e){this.fill=e,this.entity.polygon.fill=this.fill},CgsPolygon3D.prototype.getFill=function(){return this.fill},CgsPolygon3D.prototype.setVisibleHeight=function(e){this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition);this.entity.polygon.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsPolygon3D.prototype.getVisibleHeight=function(){return this.distanceDisplayCondition},CgsRect3D=function(e){var t=null,i=this;e.type="CgsRect",null==e?(this.positions=[[-100,30],[-90,40]],this.fillColor="(255,255,255,0.4)",this.outline=!0,this.outlineColor="rgba(0,153,255,1.0)",this.outlineWidth=1,this.extrudedHeight=0,this.height=0,this.name="",this.fillFlag=!0,this.distanceDisplayCondition=0,this.closeTop=!0,this.closeBottom=!0,this.material=Cesium.Color.fromCssColorString("rgba(255,255,255,0.4)"),this.materialState=!1):(null==e.materialState||0==e.materialState?this.materialState=!1:this.materialState=!0,null==e.positions?this.positions=[[-100,30],[-90,40]]:this.positions=e.positions,e.material?this.material=new Cesium.ImageMaterialProperty({image:e.material.image,transparent:!0,color:Cesium.Color.WHITE}):this.material=Cesium.Color.fromCssColorString("rgba(255,255,255,0.4)"),null==e.fillColor?this.fillColor="rgba(255,255,255,0.4)":this.fillColor=e.fillColor,null==e.outline?this.outline=!0:this.outline=e.outline,null==e.outlineColor?this.outlineColor="rgba(0,153,255,1.0)":this.outlineColor=e.outlineColor,null==e.outlineWidth?this.outlineWidth=1:this.outlineWidth=e.outlineWidth,null==e.name?this.name="":this.name=e.name,null==e.extrudedHeight?this.extrudedHeight=0:this.extrudedHeight=e.extrudedHeight,null==e.height?this.height=0:this.height=e.height,this.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0,null==e.fill?this.fillFlag=!0:this.fillFlag=e.fill,null==e.closeTop?this.closeTop=!0:this.closeTop=e.closeTop,null==e.closeBottom?this.closeBottom=!0:this.closeBottom=e.closeBottom),this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition);var s=CgsFeature.switchRectToPolygonPos(this.positions);function o(){var e=i.getPosition(),t=CgsFeature.switchRectToPolygonPos(e);return new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(t))}t=this.materialState?{name:this.name,polygon:{hierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(s)),material:this.material,fill:this.fillFlag,outline:this.outline,outlineColor:Cesium.Color.fromCssColorString(this.outlineColor),outlineWidth:this.outlineWidth,extrudedHeight:parseInt(this.extrudedHeight)+parseInt(this.height),height:this.height,closeTop:this.closeTop,closeBottom:this.closeBottom,clampToGround:!1}}:{name:this.name,polygon:{hierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(s)),material:Cesium.Color.fromCssColorString(this.fillColor),fill:this.fillFlag,outline:this.outline,outlineColor:Cesium.Color.fromCssColorString(this.outlineColor),outlineWidth:this.outlineWidth,extrudedHeight:parseInt(this.extrudedHeight)+parseInt(this.height),height:this.height,closeTop:this.closeTop,closeBottom:this.closeBottom,clampToGround:!1}},e.temp=t,e.pos=s,CgsFeature3D.call(this,e),this.pos=s,this._posCallback=null,this._posUpdateCallback=function(e){return e?i._posCallback&&(i._posCallback.setCallback(o,!0),i._posCallback=null):(i._posCallback=new Cesium.CallbackProperty(o,e),this.entity.polygon.hierarchy=i._posCallback),i._posCallback},this.callbackPosition=!1},CgsInherits(CgsRect3D,CgsFeature3D),CgsRect3D.prototype.getTemp=function(){return this.temp},CgsRect3D.prototype.getPos=function(){return this.pos},CgsRect3D.prototype.setPosition=function(e){this.positions=e;var t=CgsFeature.switchRectToPolygonPos(e);this.pos=t,this.entity.polygon.hierarchy=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(t)),null!=this.label&&this.label.setPosition([this.pos[0],this.pos[1],this.height])},CgsRect3D.prototype.getPosition=function(){return this.positions},CgsRect3D.prototype.setFillColor=function(e){this.fillColor=e,this.entity.polygon.material=Cesium.Color.fromCssColorString(e);var t=this;setTimeout(function(){t.entity.polygon.material=Cesium.Color.fromCssColorString(t.getFillColor())},50)},CgsRect3D.prototype.getFillColor=function(){return this.fillColor},CgsRect3D.prototype.setOutlineColor=function(e){this.outlineColor=e,this.entity.polygon.outlineColor=Cesium.Color.fromCssColorString(e);var t=this;setTimeout(function(){t.entity.polygon.outlineColor=Cesium.Color.fromCssColorString(t.getOutlineColor())},50)},CgsRect3D.prototype.setMaterial=function(e){this.material=e,this.entity.polygon.material.image=e;var t=this;setTimeout(function(){t.entity.polygon.material.image=e},50)},CgsRect3D.prototype.getOutlineColor=function(){return this.outlineColor},CgsRect3D.prototype.setOutlineWidth=function(e){this.outlineWidth=e,this.entity.polygon.outlineWidth=e},CgsRect3D.prototype.getOutlineWidth=function(){return this.outlineWidth},CgsRect3D.prototype.setExtrudedHeight=function(e){0==(this.extrudedHeight=e)&&(e=.1),this.entity.polygon.extrudedHeight=e+this.height},CgsRect3D.prototype.getExtrudedHeight=function(){return this.extrudedHeight},CgsRect3D.prototype.setHeight=function(e){var t;this.height=e,this.entity.polygon.height=e,0==this.extrudedHeight?this.entity.polygon.extrudedHeight=.1+e:this.entity.polygon.extrudedHeight=this.extrudedHeight+e,null!=this.label&&(t=this.label.getPosition(),this.label.setPosition([t[0],t[1],e]))},CgsRect3D.prototype.getHeight=function(){return this.height},CgsRect3D.prototype.setOutline=function(e){this.outline=e,this.entity.polygon.outline=e},CgsRect3D.prototype.getOutline=function(){return this.outline},CgsRect3D.prototype.setVisibleHeight=function(e){this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition);this.entity.polygon.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsRect3D.prototype.getVisibleHeight=function(){return this.distanceDisplayCondition},CgsMark3D=function(e){e.type="CgsMark";var t,i,s,o,a,n,r,l=null;null==e?(this.pos1=[-75.59777,40.03883,0],this.position=Cesium.Cartesian3.fromDegrees(-75.59777,40.03883),this.url="airport.png",this.scale=1,this.rotation=0,this.name="",this.positioning="center-center",this.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,this.verticalOrigin=Cesium.VerticalOrigin.CENTER,this.pixelOffset=[0,0],this.fill="rgba(255,255,255,1)",this.distanceDisplayCondition=0,this.description=void 0,this.picAspect=e.aspect?-e.aspect:null,this.rotateWithCamera=!0):(e.aspect&&(this.picAspect=-e.aspect),null==e.position?(this.pos1=[-75.59777,40.03883,0],this.position=Cesium.Cartesian3.fromDegrees(-75.59777,40.03883)):(this.pos1=e.position,3==e.position.length?this.position=Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1],e.position[2]):this.position=Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1])),null==e.description?this.description=void 0:this.description=e.description,null==e.url?this.url="":this.url=e.url,null==e.scale?this.scale=1:this.scale=e.scale,null==e.rotation?(this.rotation=0,this.picAspect&&(this.rotation=this.rotation+this.picAspect/180*Math.PI),this.realRotation=0):(this.realRotation=e.rotation,t=this.picAspect?(e.rotation+this.picAspect/180*Math.PI)/180*Math.PI:e.rotation/180*Math.PI,this.rotation=t),null==e.name?this.name="":this.name=e.name,null==e.positioning?(this.positioning="center-center",this.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,this.verticalOrigin=Cesium.VerticalOrigin.CENTER):(this.positioning=e.positioning,this.__convertToPositioning(this.positioning)),null==e.pixelOffset?this.pixelOffset=[0,0]:this.pixelOffset=e.pixelOffset,this.fill=e.color||"rgba(255,255,255,1)",e.distanceDisplayCondition||e.visibleHeight?this.distanceDisplayCondition=e.visibleHeight||e.distanceDisplayCondition:this.distanceDisplayCondition=0,this.rotateWithCamera=Cesium.defaultValue(e.rotateWithCamera,!0)),this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition),l={description:this.description,position:this.position,name:this.name,billboard:{image:this.url,horizontalOrigin:this.horizontalOrigin,verticalOrigin:this.verticalOrigin,scale:this.scale,pixelOffset:new Cesium.Cartesian2(this.pixelOffset[0],this.pixelOffset[1]),rotation:this.rotation,color:Cesium.Color.fromCssColorString(this.fill),distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition),disableRotation:!this.rotateWithCamera,heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}},!0===e.disableDepthTestDistance&&(l.billboard.disableDepthTestDistance=Number.POSITIVE_INFINITY),Array.isArray(e.scaleByDistance)&&4==e.scaleByDistance.length&&(s=(i=_slicedToArray(e.scaleByDistance,4))[0],o=i[1],a=i[2],n=i[3],r=new Cesium.NearFarScalar(s,o,a,n),l.billboard.scaleByDistance=r,l.billboard.pixelOffsetScaleByDistance=r),e.temp=l,CgsFeature3D.call(this,e)},CgsInherits(CgsMark3D,CgsFeature3D),CgsMark3D.prototype.setPositioning=function(e){this.positioning=e,this.__convertToPositioning(this.positioning),this.entity.billboard.horizontalOrigin=this.horizontalOrigin,this.entity.billboard.verticalOrigin=this.verticalOrigin},CgsMark3D.prototype.getPositioning=function(){return this.positioning},CgsMark3D.prototype.__convertToPositioning=function(e){"top-left"==this.positioning?(this.horizontalOrigin=Cesium.HorizontalOrigin.LEFT,this.verticalOrigin=Cesium.VerticalOrigin.TOP):"top-center"==this.positioning?(this.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,this.verticalOrigin=Cesium.VerticalOrigin.TOP):"top-right"==this.positioning?(this.horizontalOrigin=Cesium.HorizontalOrigin.RIGHT,this.verticalOrigin=Cesium.VerticalOrigin.TOP):"center-left"==this.positioning?(this.horizontalOrigin=Cesium.HorizontalOrigin.LEFT,this.verticalOrigin=Cesium.VerticalOrigin.CENTER):"center-center"==this.positioning?(this.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,this.verticalOrigin=Cesium.VerticalOrigin.CENTER):"center-right"==this.positioning?(this.horizontalOrigin=Cesium.HorizontalOrigin.RIGHT,this.verticalOrigin=Cesium.VerticalOrigin.CENTER):"bottom-left"==this.positioning?(this.horizontalOrigin=Cesium.HorizontalOrigin.LEFT,this.verticalOrigin=Cesium.VerticalOrigin.BOTTOM):"bottom-center"==this.positioning?(this.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,this.verticalOrigin=Cesium.VerticalOrigin.BOTTOM):"bottom-right"==this.positioning&&(this.horizontalOrigin=Cesium.HorizontalOrigin.RIGHT,this.verticalOrigin=Cesium.VerticalOrigin.BOTTOM)},CgsMark3D.prototype.setPosition=function(e){3==(this.pos1=e).length?this.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):this.position=Cesium.Cartesian3.fromDegrees(e[0],e[1]),this.entity.position=this.position,null!=this.label&&this.label.setPosition(e)},CgsMark3D.prototype.getPosition=function(){return this.pos1},CgsMark3D.prototype.setUrl=function(e){this.url=e,this.entity.billboard.image=e},CgsMark3D.prototype.getUrl=function(){return this.url},CgsMark3D.prototype.setScale=function(e){this.scale=e,this.entity.billboard.scale=this.scale},CgsMark3D.prototype.getScale=function(){return this.scale},CgsMark3D.prototype.setRotation=function(e){this.realRotation=e,e=this.picAspect?(e+this.picAspect)/180*Math.PI:e/180*Math.PI,this.rotation=e,this.entity.billboard.rotation=this.rotation},CgsMark3D.prototype.getRotation=function(){return this.realRotation},CgsMark3D.prototype.setPixelOffset=function(e){this.pixelOffset=e,this.entity.billboard.pixelOffset=new Cesium.Cartesian2(this.pixelOffset[0],this.pixelOffset[1])},CgsMark3D.prototype.getPixelOffset=function(){return this.pixelOffset},CgsMark3D.prototype.setColor=function(e){this.fill=e,this.entity.billboard.color=Cesium.Color.fromCssColorString(e)},CgsMark3D.prototype.getColor=function(){return this.fill},CgsMark3D.prototype.setVisibleHeight=function(e){this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition);"[object Array]"==Object.prototype.toString.call(e)?this.entity.billboard.distanceDisplayCondition=new Cesium.DistanceDisplayCondition(e[0],e[1]):this.entity.billboard.distanceDisplayCondition=new Cesium.DistanceDisplayCondition(e),this.entity.billboard.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsMark3D.prototype.getVisibleHeight=function(){return this.distanceDisplayCondition},CgsMark3D.prototype.setRotationByVector=function(e){var C=this,y=e[0];for(this.autoRotation&&(CgsSubPub.unsubscribe(this.autoRotation),this.autoRotation=null);180<y;)y-=360;for(;y<-180;)y+=360;(90<y||y<-90)&&(y=-y),this.autoRotation=CgsSubPub.subscribe("postRender",function(e,t){var i,s,o,a,n,r,l,u,p,h,c,g,d,m,f;C.getMap()==t&&(i=C.getPosition(),180<(f=90==y?[i[0],i[1]-.01]:-90==y?[i[0],i[1]+.01]:90<y||y<-90?[i[0]-.01,i[1]-.01*Math.tan(y*Math.PI/180)]:[i[0]+.01,i[1]-.01*Math.tan(y*Math.PI/180)])[0]&&(f[0]=f[0]-360),isNaN(f[0])||isNaN(f[1])||(s=Cesium.Cartesian3.fromDegrees(f[0],f[1],0),o=Cesium.Cartesian3.fromDegrees(i[0],i[1],0),a=new Cesium.Cartesian3(s.x-o.x,s.y-o.y,s.z-o.z),n=new Cesium.Cartesian3(0,0,0),n=Cesium.Cartesian3.normalize(a,n),r=t.camera.direction,l=t.camera.right,u=Cesium.Cartesian3.dot(r,n),p=new Cesium.Cartesian3(n.x-r.x*u,n.y-r.y*u,n.z-r.z*u),h=new Cesium.Cartesian3(0,0,0),h=Cesium.Cartesian3.normalize(p,h),c=new Cesium.Cartesian3(0,0,0),Cesium.Cartesian3.cross(h,l,c),g=Cesium.Cartesian3.dot(h,l),d=Math.acos(g)/Math.PI*180,m=!1,0==c.x?0<c.y?0<r.y&&(m=!0):0==c.y?c.z<0?r.z<0&&(m=!0):0<r.z&&(m=!0):r.y<0&&(m=!0):0<c.x?0<r.x&&(m=!0):r.x<0&&(m=!0),m&&(d=-d),C.setRotation(270-d)))})},CgsMark3D.prototype.stopAutoRotation=function(){this.autoRotation&&CgsSubPub.unsubscribe(this.autoRotation),this.autoRotation=null},CgsMark3DCollection=function(h){var c=this;this.collection=new Cesium.PrimitiveCollection,this.billboards=new Cesium.BillboardCollection,this.labers=new Cesium.LabelCollection,h.forEach(function(e){var t,i=e;e.aspect&&(i.picAspect=-e.aspect),null==e.url?i.url="":i.url=e.url,null==e.name?i.name="":i.name=e.name,null==e.position?i.position=Cesium.Cartesian3.fromDegrees(-75.59777,40.03883):3==e.position.length?i.position=Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1],e.position[2]):i.position=Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1]),null==e.scale?i.scale=1:i.scale=e.scale,null==e.rotation?(i.rotation=0,i.picAspect&&(i.rotation=i.rotation+i.picAspect/180*Math.PI),c.realRotation=0):(i.realRotation=e.rotation,t=i.picAspect?(h.rotation+i.picAspect/180*Math.PI)/180*Math.PI:h.rotation/180*Math.PI,c.rotation=t),null==e.pixelOffset?i.pixelOffset=[0,0]:i.pixelOffset=e.pixelOffset,i.fill=e.color||"rgba(255,255,255,1)",null==e.positioning?(i.positioning="center-center",i.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,i.verticalOrigin=Cesium.VerticalOrigin.CENTER):(i.positioning=e.positioning,"top-left"==e.positioning?(i.horizontalOrigin=Cesium.HorizontalOrigin.LEFT,i.verticalOrigin=Cesium.VerticalOrigin.TOP):"top-center"==e.positioning?(i.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,i.verticalOrigin=Cesium.VerticalOrigin.TOP):"top-right"==e.positioning?(i.horizontalOrigin=Cesium.HorizontalOrigin.RIGHT,i.verticalOrigin=Cesium.VerticalOrigin.TOP):"center-left"==e.positioning?(i.horizontalOrigin=Cesium.HorizontalOrigin.LEFT,i.verticalOrigin=Cesium.VerticalOrigin.CENTER):"center-center"==e.positioning?(i.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,i.verticalOrigin=Cesium.VerticalOrigin.CENTER):"center-right"==e.positioning?(i.horizontalOrigin=Cesium.HorizontalOrigin.RIGHT,i.verticalOrigin=Cesium.VerticalOrigin.CENTER):"bottom-left"==e.positioning?(i.horizontalOrigin=Cesium.HorizontalOrigin.LEFT,i.verticalOrigin=Cesium.VerticalOrigin.BOTTOM):"bottom-center"==e.positioning?(i.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,i.verticalOrigin=Cesium.VerticalOrigin.BOTTOM):"bottom-right"==e.positioning&&(i.horizontalOrigin=Cesium.HorizontalOrigin.RIGHT,i.verticalOrigin=Cesium.VerticalOrigin.BOTTOM)),e.distanceDisplayCondition||e.visibleHeight?i.distanceDisplayCondition=e.visibleHeight||e.distanceDisplayCondition:i.distanceDisplayCondition=0,i.rotateWithCamera=Cesium.defaultValue(e.rotateWithCamera,!0);var s,o,a,n,r,l,u={description:void 0,image:i.url,position:i.position,horizontalOrigin:i.horizontalOrigin,verticalOrigin:i.verticalOrigin,scale:i.scale,pixelOffset:new Cesium.Cartesian2(i.pixelOffset[0],i.pixelOffset[1]),rotation:i.rotation,color:Cesium.Color.fromCssColorString(i.fill),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(i.distanceDisplayCondition[0],i.distanceDisplayCondition[1]),disableRotation:!i.rotateWithCamera,heightReference:Cesium.HeightReference.NONE};Array.isArray(e.scaleByDistance)&&4==e.scaleByDistance.length&&(o=(s=_slicedToArray(e.scaleByDistance,4))[0],a=s[1],n=s[2],r=s[3],l=new Cesium.NearFarScalar(o,a,n,r),u.scaleByDistance=l,u.pixelOffsetScaleByDistance=l),c.billboards.add(u),null==i.labelfont&&(i.labelfont="24px 微软雅黑"),null==i.labelscale&&(i.labelscale=1),null==i.labelfill&&(i.labelfill="rgba(255,255,0,1.0)"),null==i.labelstroke&&(i.labelstroke="rgba(0, 0, 0, 0.0)"),null==i.labelstrokewidth&&(i.labelstrokewidth=0),null==i.labeloffset&&(i.pixelOffset=[0,-15]),void 0===i.labelEyeOffset&&(i.labelEyeOffset=[0,0,-10]),null==i.labelBackgroundColor&&(i.labelBackgroundColor="rgba(1, 1, 1, 0.8)"),null==i.showLabelBackground&&(i.showLabelBackground=!1),null==i.labelBackgroundPadding&&(i.labelBackgroundPadding=[7,5]),i.distanceDisplayCondition||(i.distanceDisplayCondition=0),void 0===i.heightReference&&(i.clampToGround?i.heightReference=Cesium.HeightReference.CLAMP_TO_GROUND:i.heightReference=Cesium.HeightReference.NONE);var p={position:i.position,text:i.name,font:i.labelfont,scale:i.labelscale,fillColor:Cesium.Color.fromCssColorString(i.labelfill),outlineColor:Cesium.Color.fromCssColorString(i.labelstroke),outlineWidth:i.labelstrokewidth,style:Cesium.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Cesium.Cartesian2(i.labeloffset[0],i.labeloffset[1]),eyeOffset:new(Function.prototype.bind.apply(Cesium.Cartesian3,[null].concat(_toConsumableArray(i.labelEyeOffset)))),backgroundColor:Cesium.Color.fromCssColorString(i.labelBackgroundColor),showBackground:i.showLabelBackground,backgroundPadding:new Cesium.Cartesian2(i.labelBackgroundPadding[0],i.labelBackgroundPadding[1]),distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(i.distanceDisplayCondition),heightReference:i.heightReference};c.labers.add(p)}),this.collection.add(this.billboards),this.collection.add(this.labers)},CgsMark3DCollection.prototype.getType=function(){return"CgsMark3DCollection"},CgsMark3DCollection.prototype.getMap=function(){return this.map},CgsMark3DCollection.prototype.setMap=function(e){this.map=e},CgsInherits(CgsMark3DCollection,CgsFeature3D),CgsCircle3D=function(e){var t,i;e.type="CgsCircle",null==e?(this.pos1=[-111,40,0],this.position=Cesium.Cartesian3.fromDegrees(-111,40),this.height=0,this.radius=3e5,this.fill=!0,this.fillColor="rgba(255, 255, 255, 0.4)",this.outlineColor="rgba(0,153,255,1.0)",this.outlineWidth=1,this.name="",this.outline=!0):(null==e.position&&null==e.center?(this.pos1=[-111,40,0],this.position=Cesium.Cartesian3.fromDegrees(-111,40,15e4)):(this.pos1=Cesium.defined(e.position)?e.position:e.center,this.pos1.length,this.position=Cesium.Cartesian3.fromDegrees(this.pos1[0],this.pos1[1]),this.height=0),null==e.radius?this.radius=3e5:this.radius=e.radius,null==e.fill?this.fill=!0:this.fill=e.fill,e.linearGradient?(i=e.linearGradient,this.imageMaterial=CgsUtil.createLinearGradientCanvas(i.elevationsRamp,i.direction)):null==e.fillColor?this.fillColor="rgba(255,255,255,0.4)":this.fillColor=e.fillColor,null==e.outlineColor?this.outlineColor="rgba(0,153,255,1.0)":this.outlineColor=e.outlineColor,null==e.outlineWidth?this.outlineWidth=1:this.outlineWidth=e.outlineWidth,null==e.name?this.name="":this.name=e.name,null==e.outline?this.outline=!0:this.outline=e.outline,null==e.height?this.height=0:this.height=e.height,this.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0),this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition),t={position:this.position,name:this.name,ellipse:{semiMinorAxis:this.radius,semiMajorAxis:this.radius,height:this.height,fill:this.fill,material:this.imageMaterial?this.imageMaterial:Cesium.Color.fromCssColorString(this.fillColor),outlineColor:Cesium.Color.fromCssColorString(this.outlineColor),outlineWidth:this.outlineWidth,outline:this.outline,distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition)}},e.temp=t,e.pos=Cesium.defined(e.position)?e.position:e.center,CgsFeature3D.call(this,e)},CgsInherits(CgsCircle3D,CgsFeature3D),CgsCircle3D.prototype.setPosition=function(e){this.pos1=e;var t=null;3==e.length?(t=Cesium.Cartesian3.fromDegrees(e[0],e[1]),this.setHeight(e[2])):(t=Cesium.Cartesian3.fromDegrees(e[0],e[1]),this.height=0),this.position=t,this.entity.position=this.position,null!=this.label&&this.label.setPosition(e)},CgsCircle3D.prototype.getPosition=function(){return this.pos1},CgsCircle3D.prototype.setRadius=function(e){this.radius=e,this.entity.ellipse.semiMinorAxis=this.radius,this.entity.ellipse.semiMajorAxis=this.radius},CgsCircle3D.prototype.getRadius=function(){return this.radius},CgsCircle3D.prototype.setHeight=function(e){var t;this.height=e,this.pos1[2]=e,this.entity.ellipse.height=this.height,null!=this.label&&(t=this.label.getPosition(),this.label.setPosition([t[0],t[1],e]))},CgsCircle3D.prototype.getHeight=function(){return this.height},CgsCircle3D.prototype.setFill=function(e){this.fill!=e&&(this.fill=e,this.entity.ellipse.fill=this.fill)},CgsCircle3D.prototype.getFill=function(){return this.fill},CgsCircle3D.prototype.setFillColor=function(e){this.fillColor=e,this.entity.ellipse.material=Cesium.Color.fromCssColorString(this.fillColor);var t=this;setTimeout(function(){t.entity.ellipse.material=Cesium.Color.fromCssColorString(t.getFillColor())},50)},CgsCircle3D.prototype.getFillColor=function(){return this.fillColor},CgsCircle3D.prototype.setOutlineColor=function(e){this.outlineColor=e,this.entity.ellipse.outlineColor=Cesium.Color.fromCssColorString(this.outlineColor);var t=this;setTimeout(function(){t.entity.ellipse.outlineColor=Cesium.Color.fromCssColorString(t.getOutlineColor())},50)},CgsCircle3D.prototype.getOutlineColor=function(){return this.outlineColor},CgsCircle3D.prototype.setOutlineWidth=function(e){this.outlineWidth=e,this.entity.ellipse.outlineWidth=this.outlineWidth},CgsCircle3D.prototype.getOutlineWidth=function(){return this.outlineWidth},CgsCircle3D.prototype.setOutline=function(e){this.outline=e,this.entity.ellipse.outline=e},CgsCircle3D.prototype.getOutline=function(){return this.outline},CgsCircle3D.prototype.setVisibleHeight=function(e){this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition);this.entity.ellipse.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsCircle3D.prototype.getVisibleHeight=function(){return this.distanceDisplayCondition},CgsSector3D=function(e){var t;e.type="CgsPolygon",null==e?(this.position=[116,40,0],this.fillColor="(255,255,255,0.4)",this.outlineColor="rgba(0,153,255,1.0)",this.outlineWidth=1,this.extrudedHeight=0,this.height=0,this.name="",this.closeTop=!0,this.closeBottom=!0,this.outline=!0,this.fill=!0,this.distanceDisplayCondition=0,this.rotation=0,this.angle=0,this.radius=3e5):(null==e.position&&null==e.center?this.position=[116,40,0]:(this.position=e.center||e.position,2==this.position.length&&(this.position[2]=0)),null==e.fillColor?this.fillColor="rgba(255,255,255,0.4)":this.fillColor=e.fillColor,null==e.outlineColor?this.outlineColor="rgba(0,153,255,1.0)":this.outlineColor=e.outlineColor,null==e.outlineWidth?this.outlineWidth=1:this.outlineWidth=e.outlineWidth,null==e.name?this.name="":this.name=e.name,null==e.extrudedHeight?this.extrudedHeight=0:this.extrudedHeight=e.extrudedHeight,null==e.height?this.height=0:this.height=e.height,null==e.outline?this.outline=!0:this.outline=e.outline,null==e.fill?this.fill=!0:this.fill=e.fill,this.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0,this.rotation=void 0===e.rotation?0:e.rotation,this.angle=void 0===e.angle?60:e.angle,this.radius=void 0===e.radius?3e5:e.radius),this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition),this.coordinates=this.calculatePositions(),t={name:this.name,polygon:{hierarchy:{positions:this.coordinates},material:Cesium.Color.fromCssColorString(this.fillColor),fill:this.fill,outline:this.outline,outlineColor:Cesium.Color.fromCssColorString(this.outlineColor),outlineWidth:this.outlineWidth,extrudedHeight:parseInt(this.extrudedHeight)+parseInt(this.height),height:this.height}},e.temp=t,e.pos=this.position,CgsFeature3D.call(this,e),this.pos=this.position},CgsInherits(CgsSector3D,CgsFeature3D),CgsSector3D.prototype.calculatePositions=function(){for(var e=[],t=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2]),i=0;i<this.angle;i++){var s=this.radius*Math.cos(i/180*Math.PI),o=this.radius*Math.sin(i/180*Math.PI),a=Math.cos(this.rotation/180*Math.PI)*s-Math.sin(this.rotation/180*Math.PI)*o,n=Math.cos(this.rotation/180*Math.PI)*o+Math.sin(this.rotation/180*Math.PI)*s;a+=t.x,n+=t.y,e.push({x:a,y:n,z:t.z})}return e.push(t),e},CgsSector3D.prototype.calculateAndSetPositions=function(){this.coordinates=this.calculatePositions(),this.entity.polygon.hierarchy={positions:this.coordinates},null!=this.label&&this.label.setPosition(this.position)},CgsSector3D.prototype.setPosition=function(e){this.position=e,this.calculateAndSetPositions()},CgsSector3D.prototype.getPosition=function(){return this.positions},CgsSector3D.prototype.setRadius=function(e){this.radius=e,this.calculateAndSetPositions()},CgsSector3D.prototype.getRadius=function(){return this.radius},CgsSector3D.prototype.setRotation=function(e){this.rotation=e,this.calculateAndSetPositions()},CgsSector3D.prototype.getRotation=function(){return this.rotation},CgsSector3D.prototype.setAngle=function(e){this.angle=e,this.calculateAndSetPositions()},CgsSector3D.prototype.getAngle=function(){return this.angle},CgsSector3D.prototype.getPosition=function(){return this.positions},CgsSector3D.prototype.setFillColor=function(e){this.fillColor=e,this.entity.polygon.material=Cesium.Color.fromCssColorString(this.fillColor);var t=this;setTimeout(function(){t.entity.polygon.material=Cesium.Color.fromCssColorString(t.getFillColor())},50)},CgsSector3D.prototype.getFillColor=function(){return this.fillColor},CgsSector3D.prototype.setOutlineColor=function(e){this.outlineColor=e,this.entity.polygon.outlineColor=Cesium.Color.fromCssColorString(e);var t=this;setTimeout(function(){t.entity.polygon.outlineColor=Cesium.Color.fromCssColorString(t.getOutlineColor())},50)},CgsSector3D.prototype.getOutlineColor=function(){return this.outlineColor},CgsSector3D.prototype.setOutlineWidth=function(e){this.outlineWidth=e,this.entity.polygon.outlineWidth=e},CgsSector3D.prototype.getOutlineWidth=function(){return this.outlineWidth},CgsSector3D.prototype.setExtrudedHeight=function(e){this.extrudedHeight=e,this.entity.polygon.extrudedHeight=parseInt(e)+parseInt(this.height)},CgsSector3D.prototype.getExtrudedHeight=function(){return this.extrudedHeight},CgsSector3D.prototype.setHeight=function(e){var t;this.height=e,this.entity.polygon.height=e,this.entity.polygon.extrudedHeight=parseInt(this.extrudedHeight)+parseInt(e),null!=this.label&&(t=this.label.getPosition(),this.label.setPosition([t[0],t[1],e]))},CgsSector3D.prototype.getHeight=function(){return this.height},CgsSector3D.prototype.setOutline=function(e){this.outline=e,this.entity.polygon.outline=e},CgsSector3D.prototype.getOutline=function(){return this.outline},CgsSector3D.prototype.setFill=function(e){this.fill=e,this.entity.polygon.fill=this.fill},CgsSector3D.prototype.getFill=function(){return this.fill},CgsSector3D.prototype.setVisibleHeight=function(e){this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition);this.entity.polygon.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsSector3D.prototype.getVisibleHeight=function(){return this.distanceDisplayCondition},CgsParabola3D=function(e){this.options=e,this.state={start:e.positions[0],end:e.positions[1],height:e.height,fact:e.fact,rotation:e.rotation,color:e.fillColor,width:e.width,extrudedHeight:e.extrudedHeight,type:"CgsParabola"},this.state.color||(this.state.color="rgba(0,153,255,1.0)"),this.state.width||(this.state.width=20),null==this.state.extrudedHeight&&(this.state.extrudedHeight=0),this.calculateLine(e),this.entity.polyline.material=new Cesium.PolylineGlowMaterialProperty({glowPower:.05,color:Cesium.Color.fromCssColorString(this.state.color)}),this.setWidth(this.state.width)},CgsInherits(CgsParabola3D,CgsLine3D),CgsParabola3D.prototype.calculateLine=function(e){null==this.state.fact&&(this.state.fact=.5);var t=Cesium.Cartesian3.fromDegrees(this.state.start[0],this.state.start[1],this.state.extrudedHeight),i=Cesium.Cartesian3.fromDegrees(this.state.end[0],this.state.end[1],this.state.extrudedHeight),s=Cesium.Cartesian3.distance(t,i);null==this.state.height&&(d=s/4*this.state.fact+this.state.extrudedHeight,this.state.height=d);var o,a,n,r,l,u,p,h,c,g,d=this.state.height+this.state.extrudedHeight,m=(this.state.start[0]+this.state.end[0])/2,f=(this.state.start[1]+this.state.end[1])/2,C=Cesium.Cartesian3.fromDegrees(m,f,d),y=new Cesium.Cartesian3(0,0,0);this.state.rotation||(this.state.rotation=0),this.state.rotation&&(o=i.x-t.x,a=i.y-t.y,n=i.z-t.z,r=-(o*i.x+a*i.y+n*i.z)/(o*o+a*a+n*n),l=new Cesium.Cartesian3(o*r+i.x,a*r+i.y,n*r+i.z),u=Cesium.Cartesian3.subtract(C,l,y),p=new Cesium.Cartesian3(o,a,n),Cesium.Cartesian3.normalize(p,p),h=Cesium.Math.toRadians(this.state.rotation),c=Cesium.Quaternion.fromAxisAngle(p,h),g=Cesium.Matrix3.fromQuaternion(c),Cesium.Matrix3.multiplyByVector(g,u,u),C=Cesium.Cartesian3.add(u,l,y));for(var v=Cesium.HermiteSpline.createNaturalCubic({times:[0,.5,1],points:[t,C,i]}),b=[],D=0;D<=50;D++){var S=v.evaluate(D/50),_=Cesium.Cartographic.fromCartesian(S),w=[];w.push(180*_.longitude/Math.PI,180*_.latitude/Math.PI,_.height),b.push(w)}e.positions=b,this.positions?this.setPosition(b):CgsLine3D.call(this,e)},CgsParabola3D.prototype.setFillColor=function(e){this.state.color=e,this.entity.polyline.material.color=Cesium.Color.fromCssColorString(this.state.color)},CgsParabola3D.prototype.getFillColor=function(){return this.state.color},CgsParabola3D.prototype.setStart=function(e,t){this.state.start=e,t||this.calculateLine(this.state)},CgsParabola3D.prototype.getStart=function(){return this.state.start},CgsParabola3D.prototype.setEnd=function(e,t){this.state.end=e,t||this.calculateLine(this.state)},CgsParabola3D.prototype.getEnd=function(){return this.state.end},CgsParabola3D.prototype.getHeight=function(){return this.state.height},CgsParabola3D.prototype.getFact=function(){return this.state.fact},CgsParabola3D.prototype.getRotation=function(){return this.state.rotation},CgsParabola3D.prototype.getWidth=function(){return this.state.width},CgsParabola3D.prototype.getType=function(){return this.state.type},CgsParabola3D.prototype.getPositions=function(){var e=[];return e[0]=this.state.start,e[1]=this.state.end,e},CgsParabola3D.prototype.setPositions=function(e,t){this.state.start=e[0],this.state.end=e[1],t||this.calculateLine(this.state)},CgsParabola3D.prototype.getExtrudedHeight=function(){return this.state.extrudedHeight},CgsParabola3D.prototype.setExtrudedHeight=function(e){this.state.extrudedHeight=e,this.calculateLine(this.state)},CgsModel3D=function(e){var t=null;this.minimumPixelSize=64,e.type="CgsModel",void 0===e?(this.name="",this.pos1=[-123.0744619,44.0503706,5e4],this.position=Cesium.Cartesian3.fromDegrees(-123.0744619,44.0503706,5e4),this.rotation=[0,0,0],this.scale=2e4,this.url="",this.silhouetteColor="rgba(0,255,255,1.0)",this.silhouetteSize=0,this.color="rgba(255,255,255,1.0)",this.colorBlendAmount=0,this.distanceDisplayCondition=0,this.autoScale=!1,this.minimumScale=void 0,this.maximumScale=void 0):(this.modelOriginalRotation=e.modelOriginalRotation,this.modelOriginalRotation||(this.modelOriginalRotation=[-90,0,0]),e.aspect&&(this.aspect=e.aspect),null==e.position?(this.pos1=[-123.0744619,44.0503706,5e4],this.position=Cesium.Cartesian3.fromDegrees(-123.0744619,44.0503706,5e4)):(this.pos1=e.position,3==e.position.length?this.position=Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1],e.position[2]):this.position=Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1])),this.autoScale=Cesium.defaultValue(e.autoScale,!1),this.minimumScale=Cesium.defaultValue(e.minimumScale,void 0),this.maximumScale=Cesium.defaultValue(e.maximumScale,void 0),null==e.url?this.url="":this.url=e.url,null==e.name?this.name="":this.name=e.name,null==e.rotation||"[object Array]"!=Object.prototype.toString.call(e.rotation)||e.rotation.length<3?this.rotation=[0,0,0]:this.rotation=e.rotation,this.aspect&&(this.rotation[0]=this.rotation[0]+this.aspect),Cesium.defined(e.silhouetteColor)?this.silhouetteColor=e.silhouetteColor:this.silhouetteColor="rgba(0,255,255,1.0)",Cesium.defined(e.silhouetteSize)?this.silhouetteSize=e.silhouetteSize:this.silhouetteSize=0,Cesium.defined(e.color)?this.color=e.color:this.color="rgba(255,255,255,1.0)",Cesium.defined(e.colorBlendAmount)?this.colorBlendAmount=e.colorBlendAmount:this.colorBlendAmount=0,this.minimumPixelSize=1==Cesium.defined(e.minimumPixelSize)?e.minimumPixelSize:64,this.scale=1==Cesium.defined(e.scale)?e.scale:1,e.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0),this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition),this.colorBlendMode=Cesium.defaultValue(e.colorBlendMode,Cesium.ColorBlendMode.MIX),this.description=e.description;for(var i=[0,0,0],s=0;s<this.rotation.length;s++)i[s]=Cesium.Math.toRadians(this.rotation[s]);var o,a,n,r,l,u,p=new Cesium.HeadingPitchRoll(i[0],i[1],i[2]);this.orientation=Cesium.Transforms.headingPitchRollQuaternion(this.position,p),t={name:this.name,show:e.show,position:this.position,orientation:this.orientation,model:{uri:this.url,minimumPixelSize:this.minimumPixelSize,maximumScale:this.maximumScale,minimumScale:this.minimumScale,autoScale:this.autoScale,scale:this.scale,silhouetteColor:Cesium.Color.fromCssColorString(this.silhouetteColor),silhouetteSize:this.silhouetteSize,color:Cesium.Color.fromCssColorString(this.color),colorBlendAmount:this.colorBlendAmount,colorBlendMode:this.colorBlendMode,distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition),heightReference:Cesium.defaultValue(e.heightReference,Cesium.HeightReference.NONE)}},Array.isArray(e.scaleByDistance)&&4==e.scaleByDistance.length&&(a=(o=_slicedToArray(e.scaleByDistance,4))[0],n=o[1],r=o[2],l=o[3],u=new Cesium.NearFarScalar(a,n,r,l),t.model.scaleByDistance=u,t.model.pixelOffsetScaleByDistance=u),e.temp=t,e.pos=e.position,CgsFeature3D.call(this,e)},CgsInherits(CgsModel3D,CgsFeature3D),CgsModel3D.prototype.setPosition=function(e){var t;e&&(3==(this.pos1=e).length?this.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):this.position=Cesium.Cartesian3.fromDegrees(e[0],e[1]),this.entity.position=this.position,null!=this.label&&this.label.setPosition(e),!this.enableCockpitMode||(t=this.getMap().manipulate.aircraftCockpit)&&t.setPosition(e.slice(0)))},CgsModel3D.prototype.getPosition=function(){return this.pos1},CgsModel3D.prototype.setRotation=function(e){null==e||"[object Array]"!=Object.prototype.toString.call(e)||e.length<3?this.rotation=[0,0,0]:this.rotation=e,this.aspect&&(this.rotation[0]=this.rotation[0]+this.aspect);for(var t=[0,0,0],i=0;i<this.rotation.length;i++)t[i]=Cesium.Math.toRadians(this.rotation[i]);var s,o,a=new Cesium.HeadingPitchRoll(t[0],t[1],t[2]);this.entity.orientation=Cesium.Transforms.headingPitchRollQuaternion(this.position,a),!this.enableCockpitMode||(s=this.getMap().manipulate.aircraftCockpit)&&(this.modelOriginalRotation,o=[e[0]+180,e[1],e[2]],s.setRotation(o))},CgsModel3D.prototype.getRotation=function(){return this.aspect&&(this.rotation[0]=this.rotation[0]-this.aspect),this.rotation},CgsModel3D.prototype.setPixelSize=function(e){this.minimumPixelSize=e,this.entity.model.minimumPixelSize=this.minimumPixelSize},CgsModel3D.prototype.getPixelSize=function(){return this.minimumPixelSize},CgsModel3D.prototype.setUrl=function(e){this.url=e,this.entity.model.uri=this.url},CgsModel3D.prototype.getUrl=function(){return this.url},CgsModel3D.prototype.setScale=function(e){this.scale=e,this.entity.model.scale=this.scale},CgsModel3D.prototype.getScale=function(){return this.scale},CgsModel3D.prototype.setAutoMaxScale=function(e){this.maximumScale=e,this.entity.model.maximumScale=e},CgsModel3D.prototype.getAutoMaxScale=function(){return this.maximumScale},CgsModel3D.prototype.setAutoMinScale=function(e){this.minimumScale=e,this.entity.model.minimumScale=e},CgsModel3D.prototype.getAutoMinScale=function(){return this.minimumScale},CgsModel3D.prototype.setAutoScale=function(e){this.autoScale=e,this.entity.model.autoScale=e},CgsModel3D.prototype.getAutoScale=function(){return this.autoScale},CgsModel3D.prototype.setSilhouetteColor=function(e){this.silhouetteColor=e,this.entity.model.silhouetteColor=Cesium.Color.fromCssColorString(this.silhouetteColor)},CgsModel3D.prototype.getSilhouetteColor=function(){return this.silhouetteColor},CgsModel3D.prototype.setSilhouetteSize=function(e){this.silhouetteSize=e,this.entity.model.silhouetteSize=this.silhouetteSize},CgsModel3D.prototype.getSilhouetteSize=function(){return this.silhouetteSize},CgsModel3D.prototype.setColor=function(e){this.color=e,this.entity.model.color=Cesium.Color.fromCssColorString(this.color)},CgsModel3D.prototype.getColor=function(){return this.color},CgsModel3D.prototype.setColorBlendAmount=function(e){this.colorBlendAmount=e,this.entity.model.colorBlendAmount=this.colorBlendAmount},CgsModel3D.prototype.getColorBlendAmount=function(){return this.colorBlendAmount},CgsModel3D.prototype.setVisibleHeight=function(e){this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition);this.entity.model.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsModel3D.prototype.getVisibleHeight=function(){return this.distanceDisplayCondition},CgsModel3D.prototype.setColorBlendMode=function(e){this.colorBlendMode=e,this.entity.model.colorBlendMode=e},CgsModel3D.prototype.getBoundingSphere=function(){return this.model.boundingSphere},CgsDrawFeatureByMouse3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var E=e.mapObject.map3D,A={type:(this.options=e).type,points:[],entities:[],list:[],options:e,tempEntitiesList:[],tempPoints:[]},_=null,I=null,F=null,k=null,R=0,O=this,w=e.mapObject,a=E.screenSpaceEventHandler.getInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),V=!1;function s(e){var t,i,s,o,a,n,r,l,u,p,h,c,g,d,m,f,C,y=w,v=e.position.x,b=e.position.y,D=e.screenSpaceEventHandler._element.index,S=0==D?E.pixelToLonLat([v,b]):E.mv_pixelToLonLat([v,b],D-1);S&&(A.type==CgsDrawFeatureByMouse3D.SHAPE_POINT?(CgsSubPub.publish("featuredrawstart3d",[S]),A.points.push(S),(h=A.options).position=S,t=new CgsPoint3D(h),E.addFeature(t),E.drawFeatureGroup.addFeature(t),CgsSubPub.publish("featureDrawnByMouse",[t,O,E]),A.points=[],A.entities=[]):A.type==CgsDrawFeatureByMouse3D.SHAPE_MARK?(CgsSubPub.publish("featuredrawstart3d",[S]),A.points.push(S),(h=A.options).position=S,i=new CgsMark3D(h),E.addFeature(i),E.drawFeatureGroup.addFeature(i),CgsSubPub.publish("featureDrawnByMouse",[i,O,E]),A.points=[],A.entities=[]):A.type==CgsDrawFeatureByMouse3D.SHAPE_MODEL?(CgsSubPub.publish("featuredrawstart3d",[S]),A.points.push(S),(h=A.options).position=S,s=new CgsModel3D(h),E.addFeature(s),E.drawFeatureGroup.addFeature(s),CgsSubPub.publish("featureDrawnByMouse",[s,O,E]),A.points=[],A.entities=[]):A.type==CgsDrawFeatureByMouse3D.SHAPE_CIRCLE?0==A.points.length?(V&&(O.tempMovePoint=M(S),O.tempAptoticPoint=M(S),_=new CgsLine3D({name:"",positions:[S,S],followSurface:!1,width:1,fillColor:"rgba(0,153,225,1)"}),y.map3D.addFeature(_),O.circleLine=_),CgsSubPub.publish("featuredrawstart3d",[S]),A.points.push(S)):(V&&(y.map3D.removeFeature(O.tempAptoticPoint),O.tempAptoticPoint=null,y.map3D.removeFeature(O.tempMovePoint),O.tempMovePoint=null),O.circleLine&&(y.map3D.removeFeature(O.circleLine),O.circleLine=null),h=A.options,A.points.push(S),o=A.points[0],a=Cesium.Cartesian3.fromDegrees(S[0],S[1]),n=Cesium.Cartesian3.fromDegrees(o[0],o[1]),r=Cesium.Cartesian3.distance(a,n),E.drawFeatureGroup.addFeature(A.entities[0]),A.entities[0].setRadius(r),A.entities[0].labelList=A.tempEntitiesList,CgsSubPub.publish("featureDrawnByMouse",[A.entities[0],O,E]),T()):A.type==CgsDrawFeatureByMouse3D.SHAPE_LINE?(V&&(O.tempMovePoint||(O.tempMovePoint=M(S)),O.tempPointGroup||(O.tempPointGroup=[]),O.tempPointGroup.push(M(S)),O.tempMovePoint&&null!=O.tempMovePoint||(O.tempMovePoint=M(S),O.tempMovePoint.getPosition())),0==A.points.length?(CgsSubPub.publish("featuredrawstart3d",[S]),A.points.push(S)):(A.points.push(S),A.entities=[],d=A.points.length,m=A.points[d-2],f=A.points[d-1],0==(C=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(m[0],m[1]),Cesium.Cartesian3.fromDegrees(f[0],f[1])))?A.points.pop():O.options.mode&&CgsSubPub.publish("featuredrawlinetemp",[S,C,"3D"]))):A.type==CgsDrawFeatureByMouse3D.SHAPE_MEASURE_LINE?0==A.points.length?(CgsSubPub.publish("featuredrawstart3d",[S]),A.points.push(S)):(A.points.push(S),A.entities=[],d=A.points.length,m=A.points[d-2],f=A.points[d-1],0==(C=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(m[0],m[1]),Cesium.Cartesian3.fromDegrees(f[0],f[1])))&&A.points.pop(),R=parseFloat(R)+parseFloat(C)):A.type==CgsDrawFeatureByMouse3D.SHAPE_RECTANGLE?0==A.points.length?(CgsSubPub.publish("featuredrawstart3d",[S]),A.points.push(S),V&&(O.tempAptoticPoint=M(S),O.tempMovePoint=M(S))):(V&&(y.map3D.removeFeature(O.tempAptoticPoint),y.map3D.removeFeature(O.tempMovePoint),O.tempAptoticPoint=null,O.tempMovePoint=null),h=A.options,A.points.push(S),l=A.points[0],h.positions=[l,S],u=A.entities.pop(),E.removeFeature(u),p=new CgsRect3D(h),E.addFeature(p),E.drawFeatureGroup.addFeature(p),p.labelList=A.tempEntitiesList,CgsSubPub.publish("featureDrawnByMouse",[p,O,E]),T()):A.type==CgsDrawFeatureByMouse3D.SHAPE_POLYGON?(V&&(O.tempPointGroup||(O.tempPointGroup=[]),O.tempPointGroup.push(M(S)),O.tempMovePoint&&null!=O.tempMovePoint||(O.tempMovePoint=M(S))),h=A.options,0==A.points.length?(CgsSubPub.publish("featuredrawstart3d",[S]),A.points.push(S),k=null):1==A.points.length?(A.points.push(S),0==A.entities.length?(null==k&&(h.positions=A.points,k=new CgsLine3D(h),E.addFeature(k)),A.entities.push(k)):k&&k.setPosition(A.points)):1<A.points.length&&(A.points.push(S),(c=CgsFeature.checkPolygonPositions(A.points))[0]||(A.entities[0].entity.polygon?(g=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(c[1])),A.entities[0].entity.polygon.hierarchy=new Cesium.CallbackProperty(function(e,t){return g},!1),A.entities[0].positions=A.points,A.entities[0].entity.polyline&&(A.entities[0].entity.polyline.positions=new Cesium.CallbackProperty(function(e,t){return Cesium.Cartesian3.fromDegreesArray(c[1])},!1))):k&&E.removeFeature(k)))):A.type==CgsDrawFeatureByMouse3D.SHAPE_ANGLE&&(V&&(O.tempMovePoint||(O.tempMovePoint=M(S)),O.tempPointGroup||(O.tempPointGroup=[]),O.tempPointGroup.push(M(S)),O.tempMovePoint&&null!=O.tempMovePoint||(O.tempMovePoint=M(S),O.tempMovePoint.getPosition())),0==A.points.length&&(CgsSubPub.publish("featuredrawstart3d",[S]),A.points.push(S)),2<=A.points.length?(A.points.push(S),P(e)):(A.points.push(S),A.entities=[],d=A.points.length,m=A.points[d-2],f=A.points[d-1],0==(C=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(m[0],m[1]),Cesium.Cartesian3.fromDegrees(f[0],f[1])))?A.points.pop():O.options.mode&&CgsSubPub.publish("featuredrawlinetemp",[S,C,"3D"]))))}function P(e){var t=e.position.x,i=e.position.y,s=e.screenSpaceEventHandler._element.index,o=0==s?E.pixelToLonLat([t,i]):E.mv_pixelToLonLat([t,i],s-1),a=w;if(o)if(A.type==CgsDrawFeatureByMouse3D.SHAPE_LINE||A.type==CgsDrawFeatureByMouse3D.SHAPE_ANGLE){if(V){O.tempMovePoint&&O.tempPointGroup.push(O.tempMovePoint);for(var n=0;n<O.tempPointGroup.length;n+=1)a.map3D.removeFeature(O.tempPointGroup[n]);O.tempPointGroup=[],O.tempMovePoint=null}var r=A.options;if(0==A.points.length)return;r.positions=A.points,I&&(I.setPosition(r.positions),E.drawFeatureGroup.addFeature(I),CgsSubPub.publish("featureDrawnByMouse",[I,O,E])),A.points=[],A.entities=[],I=null,R=0}else if(A.type==CgsDrawFeatureByMouse3D.SHAPE_MEASURE_LINE){var l,u,p,h,c,r=A.options;if(0==A.points.length)return;r.positions=A.points,F&&(F.setPosition(r.positions),l=r.positions.length,u=r.positions[l-2],p=o,h=Cesium.Cartesian3.distance(new Cesium.Cartesian3.fromDegrees(u[0],u[1]),new Cesium.Cartesian3.fromDegrees(p[0],p[1])).toFixed(2),c=null,c=1e3<(h=parseFloat(h)+parseFloat(R))?parseFloat(h/1e3).toFixed(2)+" km":parseFloat(h).toFixed(2)+" m",F.setName(c),F.getLabel().setPosition(o)),E.drawFeatureGroup.addFeature(F),CgsSubPub.publish("featureDrawnByMouse",[F,O,E]),A.points=[],A.entities=[],F=null,R=0}else if(A.type==CgsDrawFeatureByMouse3D.SHAPE_POLYGON){if(V){a.map3D.allFeatures.length;O.tempMovePoint&&O.tempPointGroup.push(O.tempMovePoint);for(n=0;n<O.tempPointGroup.length;n+=1)a.map3D.removeFeature(O.tempPointGroup[n]);O.tempPointGroup=[],O.tempMovePoint=null}r=A.options;if(A.points.length<=1)return;var g=A.entities.pop();g&&E.removeFeature(g),r.positions=A.points;var d=new CgsPolygon3D(r);E.drawFeatureGroup.addFeature(d),E.addFeature(d),A.entities.push(d),CgsSubPub.publish("featureDrawnByMouse",[d,O,E]),A.points=[],A.entities=[],k=null,R=0}}function o(e){P(e)}function n(e){var t,i,s,o,a,n,r,l=e.endPosition.x,u=e.endPosition.y,p=e.screenSpaceEventHandler._element.index;if((T=0==p?E.pixelToLonLat([l,u]):E.mv_pixelToLonLat([l,u],p-1))&&0!=A.points.length){if(A.type==CgsDrawFeatureByMouse3D.SHAPE_CIRCLE){var h,c,g,d,m,f,C,y,v=A.options;0<A.points.length&&(h=A.points[0],C=Cesium.Cartesian3.fromDegrees(T[0],T[1]),c=Cesium.Cartesian3.fromDegrees(h[0],h[1]),g=Cesium.Cartesian3.distance(C,c),d=JSON.stringify(g),0==A.entities.length?(v.center=h,v.radius=g,m=new CgsCircle3D(v),E.addFeature(m),A.entities.push(m)):(A.entities[0].entity.ellipse.semiMinorAxis=new Cesium.CallbackProperty(function(){return g},!1),A.entities[0].entity.ellipse.semiMajorAxis=new Cesium.CallbackProperty(function(){return g},!1),A.entities[0].radius=g),V&&O.tempMovePoint&&(O.tempMovePoint.setPosition(T),O.tempMovePoint.setName(parseFloat(CgsGeometry.formatDistance(d)).toFixed(2)+" km\n")),O.circleLine&&(f=[],C=[],V&&(f.push(O.tempAptoticPoint.getPosition()),C.push(O.tempAptoticPoint.getPosition()[0]),C.push(O.tempAptoticPoint.getPosition()[1])),f.push(T),C.push(T[0]),C.push(T[1]),y=Cesium.Cartesian3.fromDegreesArray(C),O.circleLine.entity.polyline.positions=new Cesium.CallbackProperty(function(e,t){return y},!1),O.circleLine.positions=f))}else if(A.type==CgsDrawFeatureByMouse3D.SHAPE_MEASURE_LINE){var b,D,S,_,w,P,v=A.options;0!=A.points.length&&(v.positions=Cesium.clone(A.points),v.positions.push(T),0==A.entities.length?(F||(F=new CgsLine3D(v),E.addFeature(F),F._posUpdateCallback(!1),(P=F.getLabel())&&P.setFontSize("16px")),A.entities.push(F)):F&&(F.setPosition(v.positions),b=v.positions.length,D=v.positions[b-2],S=v.positions[b-1],_=Cesium.Cartesian3.distance(new Cesium.Cartesian3.fromDegrees(D[0],D[1]),new Cesium.Cartesian3.fromDegrees(S[0],S[1])).toFixed(2),w=null,w=1e3<(_=parseFloat(_)+parseFloat(R))?"总长度："+parseFloat(_/1e3).toFixed(2)+" km":"总长度："+parseFloat(_).toFixed(2)+" m",F.setName(w),(P=F.getLabel()).setPosition(S)))}else if(A.type==CgsDrawFeatureByMouse3D.SHAPE_LINE||A.type==CgsDrawFeatureByMouse3D.SHAPE_ANGLE){V&&O.tempMovePoint&&(O.tempMovePoint.setPosition(T),O.tempMovePoint.setName(T[0].toFixed(2)+","+T[1].toFixed(2)));var v=A.options;if(0!=A.points.length)if(v.positions=Cesium.clone(A.points),v.positions.push(T),0==A.entities.length)I||(I=new CgsLine3D(v),E.addFeature(I)),A.entities.push(I);else{for(var T=[],M=0;M<v.positions.length;M++)for(var L=v.positions[M],x=0;x<L.length;x++)T.push(L[x]);T=Cesium.Cartesian3.fromDegreesArray(T),A.entities[0].entity.polyline.positions=new Cesium.CallbackProperty(function(e,t){return T},!1),I.positions=v.positions}}else{A.type==CgsDrawFeatureByMouse3D.SHAPE_RECTANGLE?(V&&(O.tempMovePoint.setPosition(T),O.tempMovePoint.setName(T[0].toFixed(2)+","+T[1].toFixed(2))),0<A.points.length&&(v=A.options,t=A.points[0],v.positions=[t,T],d=T[0].toFixed(2)+","+T[1].toFixed(2),0==A.entities.length?(i=new CgsRect3D(v),E.addFeature(i),A.entities.push(i),v={position:T,name:d,fillColor:"rgba(0,153,225,1)",pixelSize:2,outlineColor:"rgba(0,153,225,1)",outlineWidth:2,labelfont:"6px 宋体"}):A.entities[0].entity.polygon&&(s=CgsFeature.switchRectToPolygonPos(v.positions),r=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(s)),A.entities[0].entity.polygon.hierarchy=new Cesium.CallbackProperty(function(e,t){return r},!1),A.entities[0].positions=v.positions))):A.type==CgsDrawFeatureByMouse3D.SHAPE_POLYGON&&((v=A.options).positions=Cesium.clone(A.points),v.positions.push(T),V&&O.tempMovePoint&&(O.tempMovePoint.setPosition(T),O.tempMovePoint.setName(T[0].toFixed(2)+","+T[1].toFixed(2))),1==A.points.length?0==A.entities.length?(null==k&&(k=new CgsLine3D(v),E.addFeature(k)),A.entities.push(k)):k&&k.setPosition(v.positions):1<A.points.length&&(2==A.points.length&&A.entities[0]instanceof CgsLine3D?((o=A.entities.pop())&&E.removeFeature(o),k=k&&void 0,a=new CgsPolygon3D(v),E.addFeature(a),A.entities.push(a)):(n=CgsFeature.checkPolygonPositions(v.positions))[0]||A.entities[0].entity.polygon&&(r=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(n[1])),A.entities[0].entity.polygon.hierarchy=new Cesium.CallbackProperty(function(e,t){return r},!1),A.entities[0].positions=v.positions,A.entities[0].entity.polyline&&(A.entities[0].entity.polyline.positions=new Cesium.CallbackProperty(function(e,t){return Cesium.Cartesian3.fromDegreesArray(n[1])},!1)))))}CgsSubPub.publish("featuredrawmove3d",[T,A.entities[A.entities.length-1]])}}function T(){A.entities=[],A.points=[],A.cache={},A.tempEntitiesList=[]}function M(e){var t=w,i={position:e,name:e[0].toFixed(2)+","+e[1].toFixed(2),fillColor:"rgba(0,153,225,1)",pixelSize:2,outlineColor:"rgba(0,153,225,1)",outlineWidth:2,labelfont:"15px 宋体"},s=new CgsPoint3D(i);return t.map3D.addFeature(s),A.tempPoints.push(s),s}e.assistantCoordinateShow&&e.assistantCoordinateShow&&(V=!0),this.activate=function(){if(E.screenSpaceEventHandler.setInputAction(s,Cesium.ScreenSpaceEventType.LEFT_CLICK),A.type!=CgsDrawFeatureByMouse3D.SHAPE_POINT&&A.type!=CgsDrawFeatureByMouse3D.SHAPE_MARK&&A.type!=CgsDrawFeatureByMouse3D.SHAPE_MODEL&&(E.screenSpaceEventHandler.setInputAction(n,Cesium.ScreenSpaceEventType.MOUSE_MOVE),E.screenSpaceEventHandler.setInputAction(o,Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)),E.isMultiViewsMode)for(var e=E.cesiumWidget.allViewports.length,t=0;t<e;++t){var i=E.cesiumWidget.allViewports[t].screenSpaceEventHandler;i.setInputAction(s,Cesium.ScreenSpaceEventType.LEFT_CLICK),A.type!=CgsDrawFeatureByMouse3D.SHAPE_POINT&&A.type!=CgsDrawFeatureByMouse3D.SHAPE_MARK&&A.type!=CgsDrawFeatureByMouse3D.SHAPE_MODEL&&(i.setInputAction(n,Cesium.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction(o,Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK))}},this.deactivate=function(){for(var e=0;e<A.list.length;e++)E.removeFeature(A.list[e]);for(var t=0;t<A.entities.length;t++)E.removeFeature(A.entities[t]);for(var i=0;i<A.tempPoints.length;i++)E.removeFeature(A.tempPoints[i]);if(O.circleLine&&E.removeFeature(O.circleLine),E.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),A.type!=CgsDrawFeatureByMouse3D.SHAPE_POINT&&(E.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),E.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),E.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),E.screenSpaceEventHandler.setInputAction(a,Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)),E.pickerActivate(),E.isMultiViewsMode){for(var s=E.cesiumWidget.allViewports.length,e=0;e<s;++e){var o=E.cesiumWidget.allViewports[e].screenSpaceEventHandler;o.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),A.type!=CgsDrawFeatureByMouse3D.SHAPE_POINT&&(o.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),o.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),o.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK))}E.handleMultiViewsEvent()}A.entities=[],A.list=[],A.points=[],A.tempEntitiesList=[],A.tempPoints=[],F=I=_=null},this.dispose=function(){this.deactivate()}}),CgsDrawFeatureByMouse3D.SHAPE_POINT="POINT",CgsDrawFeatureByMouse3D.SHAPE_CIRCLE="CIRCLE",CgsDrawFeatureByMouse3D.SHAPE_LINE="LINE",CgsDrawFeatureByMouse3D.SHAPE_MEASURE_LINE="measureline",CgsDrawFeatureByMouse3D.SHAPE_RECTANGLE="RECT",CgsDrawFeatureByMouse3D.SHAPE_POLYGON="POLYGON",CgsDrawFeatureByMouse3D.SHAPE_MARK="MARK",CgsDrawFeatureByMouse3D.SHAPE_MODEL="model",CgsDrawFeatureByMouse3D.SHAPE_ANGLE="ANGLE",CgsSelectRegion3D=function(e){var C=e.mapObject,y={type:e.type,points:[],entities:[],list:[],options:e};function t(e){var t,i,s,o,a,n,r,l,u,p,h,c,g,d,m=e.position.x,f=e.position.y;y.type==CgsDrawFeatureByMouse3D.SHAPE_CIRCLE?(n=C.pixelToLonLat([m,f]),0==y.points.length?y.points.push(n):(r=y.options,t=y.points[0],i=Cesium.Cartesian3.fromDegrees(n[0],n[1]),s=Cesium.Cartesian3.fromDegrees(t[0],t[1]),o=Cesium.Cartesian3.distance(i,s),r.center=t,r.radius=o,c=y.entities.pop(),C.removeFeature(c),a=new CgsCircle3D(r),C.addFeature(a),y.list.push(a),(d=[]).push(t),d.push([o,0]),y.options.selectEndCallback&&y.options.selectEndCallback(d),v())):y.type==CgsDrawFeatureByMouse3D.SHAPE_RECTANGLE?(n=C.pixelToLonLat([m,f]),0==y.points.length?y.points.push(n):(r=y.options,l=y.points[0],u=n,h=[],(p=[])[0]=Math.min(l[0],u[0]),h[0]=Math.max(l[0],u[0]),p[1]=Math.min(l[1],u[1]),h[1]=Math.max(l[1],u[1]),r.positions=[p,h],c=y.entities.pop(),C.removeFeature(c),g=new CgsRect3D(r),C.addFeature(g),y.list.push(g),(d=[])[0]=p,d[1]=[p[0],h[1]],d[2]=h,d[3]=[h[0],p[1]],y.options.selectEndCallback&&y.options.selectEndCallback(d),v())):y.type==CgsDrawFeatureByMouse3D.SHAPE_POLYGON&&y.points.push([m,f])}function i(e){var t=e.position.x,i=e.position.y;C.pixelToLonLat([t,i])}function s(e){i(e)}function o(e){var t,i,s,o,a,n,r,l,u,p,h,c,g,d=e.endPosition.x,m=e.endPosition.y;y.type==CgsDrawFeatureByMouse3D.SHAPE_CIRCLE?0<y.points.length&&(n=C.pixelToLonLat([d,m]),r=y.options,t=y.points[0],i=Cesium.Cartesian3.fromDegrees(n[0],n[1]),s=Cesium.Cartesian3.fromDegrees(t[0],t[1]),o=Cesium.Cartesian3.distance(i,s),null!=(c=y.entities.pop())&&C.removeFeature(c),r.center=t,r.radius=o,a=new CgsCircle3D(r),C.addFeature(a),y.entities.push(a)):y.type==CgsDrawFeatureByMouse3D.SHAPE_RECTANGLE?(n=C.pixelToLonLat([d,m]),0<y.points.length&&(r=y.options,l=y.points[0],u=n,h=[],(p=[])[0]=Math.min(l[0],u[0]),h[0]=Math.max(l[0],u[0]),p[1]=Math.min(l[1],u[1]),h[1]=Math.max(l[1],u[1]),r.positions=[p,h],(c=y.entities.pop())&&C.removeFeature(c),g=new CgsRect3D(r),C.addFeature(g),y.entities.push(g))):y.type==CgsDrawFeatureByMouse3D.SHAPE_POLYGON&&0!=y.points.length&&(0==y.entities.length?(y.points.concat([[d,m]]),y.entities.push()):y.points.concat([[d,m]]))}function v(){y.entities=[],y.points=[],y.cache={}}this.activate=function(){C.screenSpaceEventHandler.setInputAction(t,Cesium.ScreenSpaceEventType.LEFT_CLICK),y.type!=CgsDrawFeatureByMouse3D.SHAPE_POINT&&y.type!=CgsDrawFeatureByMouse3D.SHAPE_MARK&&y.type!=CgsDrawFeatureByMouse3D.SHAPE_MODEL&&(C.screenSpaceEventHandler.setInputAction(o,Cesium.ScreenSpaceEventType.MOUSE_MOVE),C.screenSpaceEventHandler.setInputAction(i,Cesium.ScreenSpaceEventType.RIGHT_CLICK),C.screenSpaceEventHandler.setInputAction(s,Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK))},this.deactivate=function(){for(var e=0;e<y.list.length;e++)C.removeFeature(y.list[e]);C.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),y.type!=CgsDrawFeatureByMouse3D.SHAPE_POINT&&(C.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),C.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),C.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)),C.pickerActivate()},this.dispose=function(){this.deActivate()}},CgsLabel3D=function(e){var t,i,s,o,a,n,r=null;if(this.visible=!0,e.type="CgsLabel",null==e)this.name="Hello",this.font="微软雅黑",this.pos1=[-75.1641667,39.9522222,0],this.position=Cesium.Cartesian3.fromDegrees(-75.1641667,39.9522222),this.fill="rgba(255,255,0,1.0)",this.scale=1,this.pixelOffset=[0,-15],this.outlineColor="rgba(0, 0, 0, 0.0)",this.outlineWidth=0,this.labelBackgroundColor="rgba(1, 1, 1, 0.8)",this.showLabelBackground=!1,this.labelBackgroundPadding=[7,5],this.distanceDisplayCondition=0,this.eyeOffset=[0,0,-10];else{if(null==e.name?this.name="":this.name=e.name,null==e.position)return void console.info("the label's position is needed, please check your params");this.pos1=e.position,3==e.position.length?this.position=Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1],e.position[2]):this.position=Cesium.Cartesian3.fromDegrees(e.position[0],e.position[1]),null==e.labelfont?this.font="24px 微软雅黑":this.font=e.labelfont,null==e.labelfill?this.fill="rgba(255,255,0,1.0)":this.fill=e.labelfill,null==e.labeloffset?this.pixelOffset=[0,-15]:this.pixelOffset=e.labeloffset,void 0===e.labelEyeOffset?this.eyeOffset=[0,0,-10]:this.eyeOffset=e.labelEyeOffset,null==e.labelstroke?this.outlineColor="rgba(0, 0, 0, 0.0)":this.outlineColor=e.labelstroke,null==e.labelstrokewidth?this.outlineWidth=0:this.outlineWidth=e.labelstrokewidth,null==e.labelscale?this.scale=1:this.scale=e.labelscale,void 0!==e.backgroundColor&&(e.labelBackgroundColor=e.backgroundColor),null==e.labelBackgroundColor?this.labelBackgroundColor="rgba(1, 1, 1, 0.8)":this.labelBackgroundColor=e.labelBackgroundColor,void 0!==e.showBackground&&(e.showLabelBackground=e.showBackground),null==e.showLabelBackground?this.showLabelBackground=!1:this.showLabelBackground=e.showLabelBackground,void 0!==e.backgroundPadding&&(e.labelBackgroundPadding=e.backgroundPadding),null==e.labelBackgroundPadding?this.labelBackgroundPadding=[7,5]:this.labelBackgroundPadding=e.labelBackgroundPadding,e.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0,void 0===e.heightReference?e.clampToGround?this.heightReference=Cesium.HeightReference.CLAMP_TO_GROUND:this.heightReference=Cesium.HeightReference.NONE:this.heightReference=e.heightReference}this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition),r={position:this.position,label:{text:this.name,font:this.font,scale:this.scale,fillColor:Cesium.Color.fromCssColorString(this.fill),outlineColor:Cesium.Color.fromCssColorString(this.outlineColor),outlineWidth:this.outlineWidth,style:Cesium.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Cesium.Cartesian2(this.pixelOffset[0],this.pixelOffset[1]),eyeOffset:new(Function.prototype.bind.apply(Cesium.Cartesian3,[null].concat(_toConsumableArray(this.eyeOffset)))),backgroundColor:Cesium.Color.fromCssColorString(this.labelBackgroundColor),showBackground:this.showLabelBackground,backgroundPadding:new Cesium.Cartesian2(this.labelBackgroundPadding[0],this.labelBackgroundPadding[1]),distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition),heightReference:this.heightReference}},!0===e.disableDepthTestDistance&&(r.label.disableDepthTestDistance=Number.POSITIVE_INFINITY),Array.isArray(e.scaleByDistance)&&4==e.scaleByDistance.length&&(i=(t=_slicedToArray(e.scaleByDistance,4))[0],s=t[1],o=t[2],a=t[3],n=new Cesium.NearFarScalar(i,s,o,a),r.label.scaleByDistance=n,r.label.pixelOffsetScaleByDistance=n),null==e?(e.temp=r,e.pos=[-75.1641667,39.9522222]):(e.temp=r,e.pos=e.position),CgsFeature3D.call(this,e)},CgsInherits(CgsLabel3D,CgsFeature3D),CgsLabel3D.prototype.setPosition=function(e){3==(this.pos1=e).length?this.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):this.position=Cesium.Cartesian3.fromDegrees(e[0],e[1]),this.entity.position=this.position},CgsLabel3D.prototype.getPosition=function(){return this.pos1},CgsLabel3D.prototype.setFont=function(e){this.font=e,this.entity.label.font=this.font},CgsLabel3D.prototype.getFont=function(){return this.font},CgsLabel3D.prototype.setFillColor=function(e){this.fill=e,this.entity.label.fillColor=Cesium.Color.fromCssColorString(this.fill)},CgsLabel3D.prototype.getFillColor=function(){return this.fill},CgsLabel3D.prototype.setText=function(e){this.name=e,this.entity.label.text=this.name},CgsLabel3D.prototype.getText=function(){return this.name},CgsLabel3D.prototype.setPixelOffset=function(e){this.pixelOffset=e,this.entity.label.pixelOffset=new Cesium.Cartesian2(this.pixelOffset[0],this.pixelOffset[1])},CgsLabel3D.prototype.getPixelOffset=function(){return this.pixelOffset},CgsLabel3D.prototype.getOutlineColor=function(){return this.outlineColor},CgsLabel3D.prototype.setOutlineColor=function(e){this.outlineColor=e,this.entity.label.outlineColor=Cesium.Color.fromCssColorString(this.outlineColor)},CgsLabel3D.prototype.getOutlineWidth=function(){return this.outlineWidth},CgsLabel3D.prototype.setOutlineWidth=function(e){this.outlineWidth=e,this.entity.label.outlineWidth=this.outlineWidth},CgsLabel3D.prototype.getScale=function(){return this.scale},CgsLabel3D.prototype.setScale=function(e){this.scale=e,this.entity.label.scale=this.scale},CgsLabel3D.prototype.getLabelBackgroundColor=function(){return this.labelBackgroundColor},CgsLabel3D.prototype.setLabelBackgroundColor=function(e){this.labelBackgroundColor=e,this.entity.label.backgroundColor=Cesium.Color.fromCssColorString(this.labelBackgroundColor)},CgsLabel3D.prototype.getShowLabelBackground=function(){return this.showLabelBackground},CgsLabel3D.prototype.setShowLabelBackground=function(e){this.showLabelBackground=e,this.entity.label.showBackground=e},CgsLabel3D.prototype.getLabelBackgroundPadding=function(){return this.labelBackgroundPadding},CgsLabel3D.prototype.setLabelBackgroundPadding=function(e){this.labelBackgroundPadding=e,this.entity.label.backgroundPadding=new Cesium.Cartesian2(e[0],e[1])},CgsLabel3D.prototype.setVisibled=function(e){this.visible=e,this.entity.label.show=e},CgsLabel3D.prototype.getVisibled=function(){return this.visible},CgsLabel3D.prototype.setVisibleHeight=function(e){var t;this.distanceDisplayCondition=e,t="[object Array]"==Object.prototype.toString.call(e)?new Cesium.DistanceDisplayCondition(e[0],e[1]):new Cesium.DistanceDisplayCondition(e),this.entity.label.distanceDisplayCondition=t},CgsLabel3D.prototype.getVisibleHeight=function(){return this.distanceDisplayCondition},CgsLabel3D.prototype.setEyeOffset=function(e){this.entity.label.eyeOffset.setValue(new(Function.prototype.bind.apply(Cesium.Cartesian3,[null].concat(_toConsumableArray(e)))))},CgsKml3D=function(t){this.parent=t.parent,this.state=t,this.changeFeatures=[],this.changeKmlFeatures=[];var e={camera:t.mapObject.map3D.scene.camera,canvas:t.mapObject.map3D.scene.canvas};this.state.pickEnable=Cesium.defaultValue(t.pickEnable,!1),Cesium.KmlDataSource.call(this,e);var i,s=this;this.show=Cesium.defaultValue(t.visible,!0),this.isLoaded=!1,t.result&&(i=new X2JS,this.result=i.xml_str2json(t.result)),null==t.saveFlag&&(this.state.saveFlag=!0),null==t.type&&(this.state.type="kml"),"other"!=t.dataType&&this.load(t.url,e).then(function(e){t.name&&(s._name=t.name),s.isLoaded=!0,s.parent.loadedOperation()},function(e){CgsSubPub.publish("datasourceloaderror",[s])}),this.fileLoad=function(e){this.load(e).then(function(){t.name&&(s._name=t.name),CgsSubPub.publish("datasourceloadByFileSucess",[s.parent])},function(e){CgsSubPub.publish("datasourceloaderror")})},this.editFeatures=[]},CgsInherits(CgsKml3D,Cesium.KmlDataSource),CgsKml3D.prototype.setVisible=function(e){if(this.show=e,CgsSubPub.publish("kmlremove",[this]),0<this.editFeatures.length)for(var t=0;t<this.editFeatures.length;t++)this.editFeatures[t].setVisible(this.show)},CgsKml3D.prototype.getVisible=function(){return!0==this.show},CgsKml3D.prototype.eventDispose=function(){var e=this;e.kmlEvent_select&&(CgsSubPub.unsubscribe(e.kmlEvent_select),e.kmlEvent_select=null),e.kmlEvent_Enter&&(CgsSubPub.unsubscribe(e.kmlEvent_Enter),e.kmlEvent_Enter=null),e.kmlEvent_Leave&&(CgsSubPub.unsubscribe(e.kmlEvent_Leave),e.kmlEvent_Leave=null),e.kmlEvent_FeatureHover&&(CgsSubPub.unsubscribe(e.kmlEvent_FeatureHover),e.kmlEvent_FeatureHover=null),e.kmlEvent_FeatureLeave&&(CgsSubPub.unsubscribe(e.kmlEvent_FeatureLeave),e.kmlEvent_FeatureLeave=null),e.kmlEvent_FeatureClick&&(CgsSubPub.unsubscribe(e.kmlEvent_FeatureClick),e.kmlEvent_FeatureClick=null)},CgsKml3D.prototype.getType=function(){return this.state.type},CgsKml3D.prototype.getUrl=function(){return this.state.url},CgsKml3D.prototype.getName=function(){return this.state.name},CgsKml3D.prototype.setName=function(e){this._name=e,this.state.name=e},CgsKml3D.prototype.getPId=function(){return this.state.pId},CgsKml3D.prototype.setPId=function(e){this.state.pId=e},CgsKml3D.prototype.getSaveFlag=function(){return this.state.saveFlag},CgsKml3D.prototype.setSaveFlag=function(e){this.state.saveFlag=e},CgsKml3D.prototype.setPickEnable=function(e){this.state.pickEnable=e},CgsKml3D.prototype.getPickEnable=function(){return this.state.pickEnable},CgsKml3D.prototype.openManipulateMode=function(i){this.isLoaded?this.openManipulate(i):CgsSubPub.subscribe("kmlloaded",function(e,t){t.openManipulate(i)})},CgsKml3D.prototype.openManipulate=function(s){var o=this;(s=s||{}).outlineColor=s.outlineColor,s.fillColor=s.fillColor,s.selectedColor=null==s.selectedColor?"rgba(0,0,255,0.5)":s.selectedColor;var e=this._entityCollection.values,t=[];o.currentFeature=null;for(var i=0;i<e.length;i++)20<e[i]._id.length&&t.push(e[i]);for(i=0;i<t.length;i++)t[i].polygon&&t[i].polygon._material&&t[i].polygon._material._color&&(t[i].polygon.initializeFillColor=t[i].polygon._material._color._value);for(i=0;i<t.length;i++)s.fillColor&&(t[i].polygon.material=s.fillColor),s.outlineColor&&(t[i].polygon.outlineColor=s.outlineColor);o.kmlEvent_select=CgsSubPub.subscribe("kmlfeatureSelected3d",function(e,t,i){o.currentFeature==t?(s.selectedColor&&(s.fillColor?o.currentFeature.polygon.material=Cesium.Color.fromCssColorString(s.fillColor):o.currentFeature.polygon.material=o.currentFeature.polygon.initializeFillColor),o.currentFeature=null):(o.currentFeature&&s.selectedColor&&(s.fillColor?o.currentFeature.polygon.material=Cesium.Color.fromCssColorString(s.fillColor):o.currentFeature.polygon.material=o.currentFeature.polygon.initializeFillColor),o.currentFeature=t,o.currentFeature&&(o.currentFeature.polygon.material=Cesium.Color.fromCssColorString(s.selectedColor)))}),o.kmlEvent_Enter=CgsSubPub.subscribe("featureEnter",function(e,t,i){o.currentFeature!=t&&(t.polygon.material=Cesium.Color.fromCssColorString(s.selectedColor))}),o.kmlEvent_Leave=CgsSubPub.subscribe("featureLeave",function(e,t,i){o.currentFeature!=t&&(s.fillColor?t.polygon.material=Cesium.Color.fromCssColorString(s.fillColor):t.polygon.material=t.polygon.initializeFillColor)})},CgsKml3D.prototype.closeEdit=function(){this.editTool&&(this.editTool.setEnableEditMode({enable:!1}),this.editTool=null),this.event1&&(CgsSubPub.unsubscribe(this.event1),this.event1=null),this.event2&&(CgsSubPub.unsubscribe(this.event2),this.event2=null),this.lastSelectFeature&&this.lastSelectFeature.editOverlay.setVisible(!1)},CgsKml3D.prototype.openEdit=function(){var e=this.map.owner,s=this,o=new CgsDrawByMouse({map:e,mode:CgsDrawByMouse.LineMode,createOptions:{width:4,fill:!1},editPointStyle:{pixelSize:10,labelfont:"10px 微软雅黑"}});if(this.editTool=o,this.editTool&&this.editTool.setEnableEditMode({enable:!0}),this.firstFlag){o.setEnableEditMode({enable:!0});for(var t=0;t<this.editFeatures.length;t++)this.editFeatures[t].editFlag=!1,this.editFeatures[t].hasTranPos=!1,this.editFeatures[t].hasTranStyle=!1,this.editFeatures[t]instanceof CgsPoint&&(this.editFeatures[t]._id=this.editFeatures[t].getName()+"_"+(t+1))}else{var i=[],a=[];if(this.path=null,this.pathPlaceMark=null,this.stylePath=null,this.result.kml)this.result.kml.Document.Folder?(i=this.result.kml.Document.Folder.Placemark,this.path=this.result.kml.Document.Folder):(a=this.result.kml.Document.Placemark,this.pathPlaceMark=this.result.kml.Document),this.stylePath=this.result.kml.Document;else{if(this.result.Document.Folder)if(this.result.Document.Folder.Placemark)i=this.result.Document.Folder.Placemark,this.path=this.result.Document.Folder,this.stylePath=this.result.Document;else if(this.result.Document.Folder instanceof Array){for(var n=this.result.Document.Folder,r=0;r<n.length;r++)for(var l=0;l<n[r].Placemark.length;l++)i.push(n[r].Placemark[l]);this.path=this.result.Document.Folder,this.stylePath=this.result.Document}this.result.Document.Placemark&&(a=this.result.Document.Placemark,this.pathPlaceMark=this.result.Document,this.stylePath=this.result.Document)}s.currentFeature=null;for(var u=[],p=0;p<this.stylePath.Style.length;p++)u.push(this.stylePath.Style[p]);this.pointArr=[],this.pointArrTemp=[],this.lineArr=[],this.lineArrTemp=[],this.polygonArr=[],this.polygonArrTemp=[],this.firstFlag=!0;for(var h=[],c=0;c<i.length;c++)i[c].Polygon?this.polygonArr.push(i[c]):i[c].LineString?this.lineArr.push(i[c]):i[c].Point?this.pointArr.push(i[c]):i[c].MultiGeometry&&h.push(i[c]),i[c].GType="Folder";for(c=0;c<a.length;c++)a[c].Polygon?this.polygonArr.push(a[c]):a[c].LineString?this.lineArr.push(a[c]):a[c].Point?this.pointArr.push(a[c]):a[c].MultiGeometry&&h.push(a[c]),a[c].GType="PlaceMark";if(0<this.lineArr.length)for(var g=0;g<this.lineArr.length;g++){var d={positions:CgsKml3D.transformPosition(this.lineArr[g].LineString.coordinates)};(D=this.lineArr[g].Style).LineStyle&&(d.fillColor=CgsUtil.colorRgb(D.LineStyle.color),d.width=parseInt(D.LineStyle.width));var m=new CgsLine(d);m.GType=this.lineArr[g].GType,e.addFeature(m),m.kmlFeature=!0,this.lineArrTemp.push(m),this.editFeatures.push(m),m._id=this.lineArr[g].name+"_"+this.editFeatures.length}if(0<this.pointArr.length)for(var f=0;f<this.pointArr.length;f++){var C=CgsKml3D.transformPosition(this.pointArr[f].Point.coordinates);C[0]instanceof Array&&(C=C[0]);var y={position:C,name:this.pointArr[f].name,pixelSize:0},v=new CgsPoint(y);v.GType=this.pointArr[f].GType,e.addFeature(v),this.pointArr[f].Style.LabelStyle&&(this.pointArr[f].Style.LabelStyle.color&&(console.log(this.pointArr[f].Style.LabelStyle.color),v.setLabelFillColor(CgsUtil.colorRgb(this.pointArr[f].Style.LabelStyle.color))),this.pointArr[f].Style.LabelStyle.scale),v.kmlFeature=!0,this.pointArrTemp.push(v),this.editFeatures.push(v),v._id=this.pointArr[f].name+"_"+this.editFeatures.length}if(0<this.polygonArr.length)for(var b=0;b<this.polygonArr.length;b++){var D,S={positions:CgsKml3D.transformPosition(this.polygonArr[b].Polygon.outerBoundaryIs.LinearRing.coordinates)};S.map&&(S={positions:S.map,outlineColor:"rgba(0,255,0,1.0)",outlineWidth:1}),(D=this.polygonArr[b].Style).LineStyle&&(S.outlineColor=CgsUtil.colorRgb(D.LineStyle.color),S.outlineWidth=D.LineStyle.width),D.PolyStyle&&(S.fillColor=CgsUtil.colorRgb(D.PolyStyle.color),S.fill=1==D.PolyStyle.fill);var _=new CgsPolygon(S);_.GType=this.polygonArr[b].GType,_.kmlFeature=!0,this.polygonArrTemp.push(_),e.addFeature(_),this.editFeatures.push(_),_._id=this.polygonArr[b].name+"_"+this.editFeatures.length}0<h.length&&this.openEditMultiGeometry(h,o),e.map3D.dataSources.remove(this,!0),CgsSubPub.publish("removedatasuccess",[e.map3D]),o.setEnableEditMode({enable:!0}),this.editTool=o;for(var w=0;w<this.editFeatures.length;w++)CgsUtil.addKmlEdit(this.editFeatures[w]),this.editFeatures[w].editOverlay.setVisible(!1)}s=this;this.event1=CgsSubPub.subscribe(CgsEvent.eFeatureClick,function(e,t,i){t&&t.kmlFeature&&!t.editFlag&&(CgsDrawByMouse.addFeatureToTool(o,t),t.editFlag=!0,CgsUtil.addKmlEdit(t)),s.lastSelectFeature&&(s.lastSelectFeature.editOverlay.setVisible(!1),s.lastSelectFeature=null),t.editOverlay&&(t.editOverlay.setVisible(!0),s.lastSelectFeature=t)}),this.event2=CgsSubPub.subscribe(CgsEvent.eFeatureClickOut,function(e,t,i){s.lastSelectFeature&&(s.lastSelectFeature.editOverlay.setVisible(!1),s.lastSelectFeature=null)})},CgsKml3D.prototype.openEditMultiGeometry=function(e,t){for(var i,s,o=this.map.owner,a=0;a<e.length;a++)if(e[a].MultiGeometry.Polygon&&e[a].MultiGeometry.Polygon instanceof Array)for(var n=0;n<e[a].MultiGeometry.Polygon.length;n++){var r=CgsKml3D.transformPosition(e[a].MultiGeometry.Polygon[n].outerBoundaryIs.LinearRing.coordinates);this.stylePath.Style&&this.stylePath.Style.PolyStyle&&(f=CgsUtil.colorRgb(this.stylePath.Style.PolyStyle.color)),this.stylePath.Style&&this.stylePath.Style.LineStyle&&(C=CgsUtil.colorRgb(this.stylePath.Style.LineStyle.color),y=this.stylePath.Style.LineStyle.width),(v=new CgsPolygon({positions:r,fillColor:f||"rgba(0,255,0,1.0)",outlineColor:C||"rgba(0,255,0,1.0)",outlineWidth:y||1}))._id=e[a].name+"_poly_"+n,o.addFeature(v),v.orgType="MultiGeometry",this.editFeatures.push(v),CgsDrawByMouse.addFeatureToTool(t,v)}else if(!e[a].MultiGeometry.Polygon||e[a].MultiGeometry.Polygon instanceof Array)if(e[a].MultiGeometry.LineString&&e[a].MultiGeometry.LineString instanceof Array)for(var l=0;l<e[a].MultiGeometry.LineString.length;l++){var u=CgsKml3D.transformPosition(e[a].MultiGeometry.LineString[l].coordinates),p=new CgsLine({positions:u});o.addFeature(p),p._id=lineArr[a].name+"_line_"+l,p.orgType="MultiGeometry",this.editFeatures.push(p),CgsDrawByMouse.addFeatureToTool(t,p)}else if(!e[a].MultiGeometry.LineString||e[a].MultiGeometry.LineString instanceof Array)if(e[a].MultiGeometry.Point&&e[a].MultiGeometry.Point instanceof Array)for(var h=0;h<e[a].MultiGeometry.Point.length;h++){var c=CgsKml3D.transformPosition(e[a].MultiGeometry.Point[h].coordinates);c[0]instanceof Array&&(c=c[0]);var g={position:c,name:pointArr[a].name},d=new CgsPoint(g);o.addFeature(d),d._id=pointArr[a].name+"_poit_"+h,d.orgType="MultiGeometry",this.editFeatures.push(d),CgsDrawByMouse.addFeatureToTool(t,d)}else{!e[a].MultiGeometry.Point||e[a].MultiGeometry.Point instanceof Array||((i=CgsKml3D.transformPosition(e[a].MultiGeometry.Point.coordinates))[0]instanceof Array&&(i=i[0]),s={position:i,name:pointArr[a].name},d=new CgsPoint(s),o.addFeature(d),d._id=pointArr[a].name+"_poit_p",d.orgType="MultiGeometry",this.editFeatures.push(d),CgsDrawByMouse.addFeatureToTool(t,d))}else{var m=CgsKml3D.transformPosition(e[a].MultiGeometry.LineString.coordinates),p=new CgsLine({positions:m});o.addFeature(p),p._id=lineArr[a].name+"_line_p",p.orgType="MultiGeometry",this.editFeatures.push(p),CgsDrawByMouse.addFeatureToTool(t,p)}else{var f,C,y,v,r=CgsKml3D.transformPosition(e[a].MultiGeometry.Polygon.outerBoundaryIs.LinearRing.coordinates);this.stylePath.Style&&this.stylePath.Style.PolyStyle&&(f=CgsUtil.colorRgb(this.stylePath.Style.PolyStyle.color)),this.stylePath.Style&&this.stylePath.Style.LineStyle&&(C=CgsUtil.colorRgb(this.stylePath.Style.LineStyle.color),y=this.stylePath.Style.LineStyle.width),(v=new CgsPolygon({positions:r,fillColor:f||"rgba(0,255,0,1.0)",outlineColor:C||"rgba(0,255,0,1.0)",outlineWidth:y||1}))._id=e[a].name+"_poly_p",v.orgType="MultiGeometry",o.addFeature(v),this.editFeatures.push(v),CgsDrawByMouse.addFeatureToTool(t,v)}},CgsKml3D.prototype.saveEdit=function(){this.map.owner,this.path.Placemark;if(this.path)if(this.path.Placemark)for(var e=0;e<this.path.Placemark.length;e++){var t,i,s,o,a,n,r,l,u,p,h,c=this.getFeatureById(this.path.Placemark[e].name);if(this.path.Placemark[e].Polygon)this.path.Placemark[e].Polygon.outerBoundaryIs.LinearRing.coordinates&&(t=this.getFeaturePosStr(this.path.Placemark[e].name),this.path.Placemark[e].Polygon.outerBoundaryIs.LinearRing.coordinates=t),this.path.Placemark[e].Style&&this.path.Placemark[e].Style.PolyStyle&&(i=c.getFillColor(),this.path.Placemark[e].Style.PolyStyle.color=CgsUtil.colorHex(i)),this.path.Placemark[e].Style&&this.path.Placemark[e].Style.LineStyle&&(s=c.getOutlineColor(),this.path.Placemark[e].Style.LineStyle.color=CgsUtil.colorHex(s));else if(this.path.Placemark[e].LineString){this.path.Placemark[e].LineString.coordinates&&(o=this.getFeaturePosStr(this.path.Placemark[e].name),this.path.Placemark[e].LineString.coordinates=o),this.path.Placemark[e].Style&&this.path.Placemark[e].Style.LineStyle&&(a=c.getFillColor(),this.path.Placemark[e].Style.LineStyle.color=CgsUtil.colorHex(a),n=c.getWidth(),this.path.Placemark[e].Style.LineStyle.width=n)}else if(this.path.Placemark[e].Point){this.path.Placemark[e].Point.coordinates&&(r=this.getFeaturePosStr(this.path.Placemark[e].name),this.path.Placemark[e].Point.coordinates=r),this.path.Placemark[e].Style&&this.path.Placemark[e].Style.LabelStyle&&(l=c.getLabelFillColor(),this.path.Placemark[e].Style.LabelStyle.color=CgsUtil.colorHex(l),u=c.getLabelScale(),this.path.Placemark[e].Style.LabelStyle.scale=u),this.path.Placemark[e].name&&(p=c.getName(),this.path.Placemark[e].name=p)}else if(this.path.Placemark[e].MultiGeometry)if(this.path.Placemark[e].MultiGeometry.Polygon&&this.path.Placemark[e].MultiGeometry.Polygon instanceof Array)for(var g,d=0;d<this.path.Placemark[e].MultiGeometry.Polygon.length;d++){this.path.Placemark[e].MultiGeometry.Polygon[d].outerBoundaryIs.LinearRing.coordinates&&(g=this.getFeaturePosStr(this.path.Placemark[e].name+"_poly_"+d),this.path.Placemark[e].MultiGeometry.Polygon[d].outerBoundaryIs.LinearRing.coordinates=g)}else if(!this.path.Placemark[e].MultiGeometry.Polygon||this.path.Placemark[e].MultiGeometry.Polygon instanceof Array)if(this.path.Placemark[e].MultiGeometry.LineString&&this.path.Placemark[e].MultiGeometry.LineString instanceof Array)for(var m=0;m<this.path.Placemark[e].MultiGeometry.LineString.length;m++);else if(!this.path.Placemark[e].MultiGeometry.LineString||this.path.Placemark[e].MultiGeometry.LineString instanceof Array)if(this.path.Placemark[e].MultiGeometry.Point&&this.path.Placemark[e].MultiGeometry.Point instanceof Array)for(var f=0;f<this.path.Placemark[e].MultiGeometry.Point.length;f++);else this.path.Placemark[e].MultiGeometry.Point&&(this.path.Placemark[e].MultiGeometry.Point,Array);else;else{this.path.Placemark[e].MultiGeometry.Polygon.outerBoundaryIs.LinearRing.coordinates&&(h=this.getFeaturePosStr(this.path.Placemark[e].name+"_poly_p"),this.path.Placemark[e].MultiGeometry.Polygon.outerBoundaryIs.LinearRing.coordinates=h)}}else if(this.path instanceof Array)for(var C=0;C<this.path.length;C++)for(var y=0;y<this.path[C].Placemark.length;y++){var v,b,D,S,_,w,P,T,M,L,x,E=this.getFeatureById(this.path[C].Placemark[y].name);if(this.path[C].Placemark[y].Polygon)this.path[C].Placemark[y].Polygon.outerBoundaryIs.LinearRing.coordinates&&(v=this.getFeaturePosStr(this.path[C].Placemark[y].name),this.path[C].Placemark[y].Polygon.outerBoundaryIs.LinearRing.coordinates=v),this.path[C].Placemark[y].Style&&this.path[C].Placemark[y].Style.PolyStyle&&(b=E.getFillColor(),this.path[C].Placemark[y].Style.PolyStyle.color=CgsUtil.colorHex(b)),this.path[C].Placemark[y].Style&&this.path[C].Placemark[y].Style.LineStyle&&(D=E.getOutlineColor(),this.path[C].Placemark[y].Style.LineStyle.color=CgsUtil.colorHex(D));else if(this.path[C].Placemark[y].LineString){this.path[C].Placemark[y].LineString.coordinates&&(S=this.getFeaturePosStr(this.path[C].Placemark[y].name),this.path[C].Placemark[y].LineString.coordinates=S),this.path[C].Placemark[y].Style&&this.path[C].Placemark[y].Style.LineStyle&&(_=E.getFillColor(),this.path[C].Placemark[y].Style.LineStyle.color=CgsUtil.colorHex(_),w=E.getWidth(),this.path[C].Placemark[y].Style.LineStyle.width=w)}else if(this.path[C].Placemark[y].Point){this.path[C].Placemark[y].Point.coordinates&&(P=this.getFeaturePosStr(this.path[C].Placemark[y].name),this.path[C].Placemark[y].Point.coordinates=P),this.path[C].Placemark[y].Style&&this.path[C].Placemark[y].Style.LabelStyle&&(T=E.getLabelFillColor(),this.path[C].Placemark[y].Style.LabelStyle.color=CgsUtil.colorHex(T),M=E.getLabelScale(),this.path[C].Placemark[y].Style.LabelStyle.scale=M),this.path[C].Placemark[y].name&&(L=E.getName(),this.path[C].Placemark[y].name=L)}else if(this.path[C].Placemark[y].MultiGeometry)if(this.path[C].Placemark[y].MultiGeometry.Polygon&&this.path[C].Placemark[y].MultiGeometry.Polygon instanceof Array)for(var A,I=0;I<this.path[C].Placemark[y].MultiGeometry.Polygon.length;I++){this.path[C].Placemark[y].MultiGeometry.Polygon[I].outerBoundaryIs.LinearRing.coordinates&&(A=this.getFeaturePosStr(this.path[C].Placemark[y].name+"_poly_"+I),this.path[C].Placemark[y].MultiGeometry.Polygon[I].outerBoundaryIs.LinearRing.coordinates=A)}else if(!this.path[C].Placemark[y].MultiGeometry.Polygon||this.path[C].Placemark[y].MultiGeometry.Polygon instanceof Array)if(this.path[C].Placemark[y].MultiGeometry.LineString&&this.path[C].Placemark[y].MultiGeometry.LineString instanceof Array)for(var F=0;F<this.path[C].Placemark[y].MultiGeometry.LineString.length;F++);else if(!this.path[C].Placemark[y].MultiGeometry.LineString||this.path[C].Placemark[y].MultiGeometry.LineString instanceof Array)if(this.path[C].Placemark[y].MultiGeometry.Point&&this.path[C].Placemark[y].MultiGeometry.Point instanceof Array)for(var k=0;k<this.path[C].Placemark[y].MultiGeometry.Point.length;k++);else this.path[C].Placemark[y].MultiGeometry.Point&&(this.path[C].Placemark[y].MultiGeometry.Point,Array);else;else{this.path[C].Placemark[y].MultiGeometry.Polygon.outerBoundaryIs.LinearRing.coordinates&&(x=this.getFeaturePosStr(this.path[C].Placemark[y].name+"_poly_p"),this.path[C].Placemark[y].MultiGeometry.Polygon.outerBoundaryIs.LinearRing.coordinates=x)}}if(this.pathPlaceMark)for(var R=0;R<this.pathPlaceMark.Placemark.length;R++){var O,V,G,B,H,N,W,z,j,U,$,Y=this.getFeatureById(this.pathPlaceMark.Placemark[R].name);if(this.pathPlaceMark.Placemark[R].Polygon)this.pathPlaceMark.Placemark[R].Polygon.outerBoundaryIs.LinearRing.coordinates&&(O=this.getFeaturePosStr(this.pathPlaceMark.Placemark[R].name),this.pathPlaceMark.Placemark[R].Polygon.outerBoundaryIs.LinearRing.coordinates=O),this.pathPlaceMark.Placemark[R].Style&&this.pathPlaceMark.Placemark[R].Style.PolyStyle&&(V=Y.getFillColor(),this.pathPlaceMark.Placemark[R].Style.PolyStyle.color=CgsUtil.colorHex(V)),this.pathPlaceMark.Placemark[R].Style&&this.pathPlaceMark.Placemark[R].Style.LineStyle&&(G=Y.getOutlineColor(),this.pathPlaceMark.Placemark[R].Style.LineStyle.color=CgsUtil.colorHex(G));else if(this.pathPlaceMark.Placemark[R].LineString){this.pathPlaceMark.Placemark[R].LineString.coordinates&&(B=this.getFeaturePosStr(this.pathPlaceMark.Placemark[R].name),this.pathPlaceMark.Placemark[R].LineString.coordinates=B),this.pathPlaceMark.Placemark[R].Style&&this.pathPlaceMark.Placemark[R].Style.LineStyle&&(H=Y.getFillColor(),this.pathPlaceMark.Placemark[R].Style.LineStyle.color=CgsUtil.colorHex(H),N=Y.getWidth(),this.pathPlaceMark.Placemark[R].Style.LineStyle.width=N)}else if(this.pathPlaceMark.Placemark[R].Point){this.pathPlaceMark.Placemark[R].Point.coordinates&&(W=this.getFeaturePosStr(this.pathPlaceMark.Placemark[R].name),this.pathPlaceMark.Placemark[R].Point.coordinates=W),this.pathPlaceMark.Placemark[R].Style&&this.pathPlaceMark.Placemark[R].Style.LabelStyle&&(z=Y.getLabelFillColor(),this.pathPlaceMark.Placemark[R].Style.LabelStyle.color=CgsUtil.colorHex(z),j=Y.getLabelScale(),this.pathPlaceMark.Placemark[R].Style.LabelStyle.scale=j),this.pathPlaceMark.Placemark[R].name&&(U=Y.getName(),this.pathPlaceMark.Placemark[R].name=U)}else if(this.pathPlaceMark.Placemark[R].MultiGeometry)if(this.pathPlaceMark.Placemark[R].MultiGeometry.Polygon&&this.pathPlaceMark.Placemark[R].MultiGeometry.Polygon instanceof Array)for(var J,K=0;K<this.pathPlaceMark.Placemark[R].MultiGeometry.Polygon.length;K++){this.pathPlaceMark.Placemark[R].MultiGeometry.Polygon[K].outerBoundaryIs.LinearRing.coordinates&&(J=this.getFeaturePosStr(this.pathPlaceMark.Placemark[R].name+"_poly_"+K),this.pathPlaceMark.Placemark[R].MultiGeometry.Polygon[K].outerBoundaryIs.LinearRing.coordinates=J)}else if(!this.pathPlaceMark.Placemark[R].MultiGeometry.Polygon||this.pathPlaceMark.Placemark[R].MultiGeometry.Polygon instanceof Array)if(this.pathPlaceMark.Placemark[R].MultiGeometry.LineString&&this.pathPlaceMark.Placemark[R].MultiGeometry.LineString instanceof Array)for(var Z=0;Z<this.pathPlaceMark.Placemark[R].MultiGeometry.LineString.length;Z++);else if(!this.pathPlaceMark.Placemark[R].MultiGeometry.LineString||this.pathPlaceMark.Placemark[R].MultiGeometry.LineString instanceof Array)if(this.pathPlaceMark.Placemark[R].MultiGeometry.Point&&this.pathPlaceMark.Placemark[R].MultiGeometry.Point instanceof Array)for(var X=0;X<this.pathPlaceMark.Placemark[R].MultiGeometry.Point.length;X++);else this.pathPlaceMark.Placemark[R].MultiGeometry.Point&&(this.pathPlaceMark.Placemark[R].MultiGeometry.Point,Array);else;else{this.pathPlaceMark.Placemark[R].MultiGeometry.Polygon.outerBoundaryIs.LinearRing.coordinates&&($=this.getFeaturePosStr(this.pathPlaceMark.Placemark[R].name+"_poly_p"),this.pathPlaceMark.Placemark[R].MultiGeometry.Polygon.outerBoundaryIs.LinearRing.coordinates=$)}}return'<?xml version="1.0" encoding="UTF-8"?>'+(new X2JS).json2xml_str(this.result)},CgsKml3D.findPointStyleByName=function(e,t){for(var i=0;i<t.length;i++){t[i]._id==e&&t[i]}},CgsKml3D.transformPosition=function(e){for(var t=e.split(" "),i=[],s=0;s<t.length;s++){var o=t[s].split(","),a=[parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])];i.push(a)}return i},CgsKml3D.transformPosition2=function(e){var t=[],i="";if((t=1==e.length?e[0]:e)[0]instanceof Array)for(var s=0;s<t.length;s++)i=i+t[s][0]+","+t[s][1]+","+t[s][2]+" ";else i=i+t[0]+","+t[1]+","+t[2];return i},CgsKml3D.prototype.getFeaturePosStr=function(e){for(var t=0;t<this.editFeatures.length;t++)if("MultiGeometry"==this.editFeatures[t].orgType){if(this.editFeatures[t]._id==e&&!this.editFeatures[t].hasTranPos)return this.editFeatures[t].hasTranPos=!0,CgsKml3D.transformPosition2(this.editFeatures[t].getPosition())}else if(this.editFeatures[t]._id==e+"_"+(t+1)&&!this.editFeatures[t].hasTranPos)return this.editFeatures[t].hasTranPos=!0,CgsKml3D.transformPosition2(this.editFeatures[t].getPosition())},CgsKml3D.prototype.getFeatureById=function(e){for(var t=0;t<this.editFeatures.length;t++)if("MultiGeometry"==this.editFeatures[t].orgType){if(this.editFeatures[t]._id==e&&!this.editFeatures[t].hasTranStyle)return this.editFeatures[t].hasTranStyle=!0,this.editFeatures[t]}else if(this.editFeatures[t]._id==e+"_"+(t+1)&&!this.editFeatures[t].hasTranStyle)return this.editFeatures[t].hasTranStyle=!0,this.editFeatures[t]},CgsKml3D.prototype.closeManipulateMode=function(){for(var e=this,t=e._entityCollection.values,i=[],s=0;s<t.length;s++)20<t[s]._id.length&&i.push(t[s]);for(s=0;s<i.length;s++)i[s].polygon.material=i[s].polygon.initializeFillColor;e.kmlEvent_select&&(CgsSubPub.unsubscribe(e.kmlEvent_select),e.kmlEvent_select=null),e.kmlEvent_Enter&&(CgsSubPub.unsubscribe(e.kmlEvent_Enter),e.kmlEvent_Enter=null),e.kmlEvent_Leave&&(CgsSubPub.unsubscribe(e.kmlEvent_Leave),e.kmlEvent_Leave=null)},CgsKml3D.prototype.openEdit_=function(){this.setPickEnable(!0),this.changeFeatures=[],this.changeKmlFeatures=[],this.editTool=new CgsDrawByMouse({map:map,mode:CgsDrawByMouse.LineMode,createOptions:{width:6,fill:!1},editPointStyle:{pixelSize:10,labelfont:"10px 微软雅黑"}}),this.editTool.setEnableEditMode({enable:!0}),this.kmlEvent_select=CgsSubPub.subscribe("kmlfeatureSelected3d",function(e,t,i){var s={};if(this.changeFeatures){var o=!0,a=!1,n=void 0;try{for(var r,l=this.changeFeatures[Symbol.iterator]();!(o=(r=l.next()).done);o=!0){if(r.value.id==t.id)return}}catch(e){a=!0,n=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw n}}if(t.polygon){var u=[],p=!0,h=!1,c=void 0;try{for(var g,d=t.polygon.hierarchy._value.positions[Symbol.iterator]();!(p=(g=d.next()).done);p=!0){var m=g.value,f=Cesium.Cartographic.fromCartesian(m);u.push([180*f.longitude/Math.PI,180*f.latitude/Math.PI,0])}}catch(e){h=!0,c=e}finally{try{!p&&d.return&&d.return()}finally{if(h)throw c}}s.positions=u,s.name=t.name;var C=new CgsPolygon(s);C.id=t.id,map.addFeature(C),this.changeFeatures.push(C),this.changeKmlFeatures.push(t.polygon),CgsDrawByMouse.addFeatureToTool(this.editTool,C)}else if(t.polyline){var y=[],v=!0,b=!1,D=void 0;try{for(var S,_=t.polyline.positions._value[Symbol.iterator]();!(v=(S=_.next()).done);v=!0){var w=S.value,P=Cesium.Cartographic.fromCartesian(w);y.push([180*P.longitude/Math.PI,180*P.latitude/Math.PI,0])}}catch(e){b=!0,D=e}finally{try{!v&&_.return&&_.return()}finally{if(b)throw D}}s.positions=y,s.name=t.name?t.name:"";var T=new CgsLine(s);T.id=t.id,map.addFeature(T),this.changeFeatures.push(T),this.changeKmlFeatures.push(t.polyline),CgsDrawByMouse.addFeatureToTool(this.editTool,T)}}}.bind(this))},CgsKml3D.prototype.closeEdit_=function(){this.editTool&&this.editTool.setEnableEditMode(!1),this.removeEditFeatures(),CgsSubPub.unsubscribe(this.kmlEvent_select)},CgsKml3D.prototype.exportEditResult_=function(e){var t=(new DOMParser).parseFromString(this.result,"text/xml"),i=!0,s=!1,o=void 0;try{for(var a,n=this.changeFeatures[Symbol.iterator]();!(i=(a=n.next()).done);i=!0){var r,l,u,p,h,c,g=a.value,d=null,d=36<g.id.length?g.id.substr(0,g.id.length-36):g.id,m=t.getElementById(d),f=m.getElementsByTagName("MultiGeometry")[0],C=m.getElementsByTagName("Polygon")[0],y=m.getElementsByTagName("LineString")[0],v=m.getElementsByTagName("Point")[0];f?(r=this.entities.getById(d)._children.indexOf(this.entities.getById(g.id)),h=f.children[r].getElementsByTagName("coordinates"),1==(l=g.getPosition()).length&&(l=l[0]),h[0].textContent=l.join(" ")):C?(h=C.getElementsByTagName("coordinates"),1==(u=g.getPosition()).length&&(u=u[0]),h[0].textContent=u.join(" ")):y?(h=y.getElementsByTagName("coordinates"),1==(p=g.getPosition()).length&&(p=p[0]),h[0].textContent=p.join(" ")):v&&(h=v.getElementsByTagName("coordinates"),c=g.getPosition(),h[0].textContent=c.join(" "))}}catch(e){s=!0,o=e}finally{try{!i&&n.return&&n.return()}finally{if(s)throw o}}return(new XMLSerializer).serializeToString(t)},CgsKml3D.prototype.updateKml=function(){for(var e=[],t=0;t<this.changeFeatures.length;t++)if(this.changeFeatures[t]instanceof CgsPolygon)this.changeKmlFeatures[t].hierarchy=this.changeFeatures[t].getEntity().polygon.hierarchy;else if(this.changeFeatures[t]instanceof CgsLine){var i=!0,s=!1,o=void 0;try{for(var a,n=this.changeFeatures[t].getPosition()[Symbol.iterator]();!(i=(a=n.next()).done);i=!0){var r=a.value;e.push(Cesium.Cartesian3.fromDegrees(r[0],r[1],0))}}catch(e){s=!0,o=e}finally{try{!i&&n.return&&n.return()}finally{if(s)throw o}}this.changeKmlFeatures[t].positions=e}},CgsKml3D.prototype.removeEditFeatures=function(){var e=!0,t=!1,i=void 0;try{for(var s,o=this.changeFeatures[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){var a=s.value;map.removeFeature(a)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this.changeFeatures=[],this.changeKmlFeatures=[]},CgsGeoJson3D=function(t){this.parent=t.parent,this.url=t.url,null==(this.state=t).saveFlag&&(this.state.saveFlag=!0),null==t.type&&(this.state.type="geojson"),this.state.pickEnable=Cesium.defaultValue(t.pickEnable,!1),Cesium.GeoJsonDataSource.call(this);var i=this;"other"!=t.dataType&&this.load(t.url,{stroke:void 0===t.stroke?Cesium.Color.BLACK:Cesium.Color.fromCssColorString(t.stroke),fill:void 0===t.fill?Cesium.Color.YELLOW:Cesium.Color.fromCssColorString(t.fill)}).then(function(){t.name&&(i._name=t.name)},function(e){CgsSubPub.publish("datasourceloaderror")}),this.show=void 0===t.visible||t.visible,this.fileLoad=function(e){this.load(e,{stroke:void 0===t.stroke?Cesium.Color.BLACK:Cesium.Color.fromCssColorString(t.stroke),fill:void 0===t.fill?Cesium.Color.YELLOW:Cesium.Color.fromCssColorString(t.fill)}).then(function(){t.name&&(i._name=t.name),CgsSubPub.publish("datasourceloadByFileSucess",[i.parent])},function(e){CgsSubPub.publish("datasourceloaderror")})}},CgsInherits(CgsGeoJson3D,Cesium.GeoJsonDataSource),CgsGeoJson3D.prototype.setVisible=function(e){this.show=e,CgsSubPub.publish("geojsonvisible",[this,e])},CgsGeoJson3D.prototype.getVisible=function(){return!0==this.show},CgsGeoJson3D.prototype.remove=function(){var e=this.map.map3D;e&&(this.map.map3D.dataSources.remove(this,!0),CgsSubPub.publish("geojsonremove",[this,e]),this.map.map3D=null)},CgsGeoJson3D.prototype.getType=function(){return this.state.type},CgsGeoJson3D.prototype.getUrl=function(){return this.state.url},CgsGeoJson3D.prototype.getName=function(){return this.state.name},CgsGeoJson3D.prototype.setName=function(e){this._name=e,this.state.name=e},CgsGeoJson3D.prototype.getPId=function(){return this.state.pId},CgsGeoJson3D.prototype.setPId=function(e){this.state.pId=e},CgsGeoJson3D.prototype.getSaveFlag=function(){return this.state.saveFlag},CgsGeoJson3D.prototype.setSaveFlag=function(e){this.state.saveFlag=e},CgsGeoJson3D.prototype.setPickEnable=function(e){this.state.pickEnable=e},CgsGeoJson3D.prototype.getPickEnable=function(){return this.state.pickEnable},CgsGeoJson3D.loadByJSON=function(e){},CgsCzml3D=function(t){this.parent=t.parent,this.url=t.url,null==(this.state=t).saveFlag&&(this.state.saveFlag=!0),null==t.type&&(this.state.type="czml"),this.state.pickEnable=Cesium.defaultValue(t.pickEnable,!1),Cesium.CzmlDataSource.call(this);var i=this;"other"!=t.dataType&&this.load(t.url).then(function(){t.name&&(i._name=t.name)},function(e){CgsSubPub.publish("datasourceloaderror")}),this.show=void 0===t.visible||t.visible,this.fileLoad=function(e){this.load(e).then(function(){t.name&&(i._name=t.name),CgsSubPub.publish("datasourceloadbyfilesuccess",[i.parent])},function(e){CgsSubPub.publish("datasourceloaderror")})}},CgsInherits(CgsCzml3D,Cesium.CzmlDataSource),CgsCzml3D.prototype.setVisible=function(e){this.show=e,CgsSubPub.publish("czmlvisible",[this,e])},CgsCzml3D.prototype.getVisible=function(){return!0==this.show},CgsCzml3D.prototype.remove=function(){var e=this.map.map3D;e&&(this.map.map3D.dataSources.remove(this,!0),CgsSubPub.publish("czmlemove",[this,e]),this.map.map3D=null)},CgsCzml3D.prototype.getType=function(){return this.state.type},CgsCzml3D.prototype.getUrl=function(){return this.state.url},CgsCzml3D.prototype.getName=function(){return this.state.name},CgsCzml3D.prototype.setName=function(e){this._name=e,this.state.name=e},CgsCzml3D.prototype.getPId=function(){return this.state.pId},CgsCzml3D.prototype.setPId=function(e){this.state.pId=e},CgsCzml3D.prototype.getSaveFlag=function(){return this.state.saveFlag},CgsCzml3D.prototype.setSaveFlag=function(e){this.state.saveFlag=e},CgsCzml3D.prototype.setPickEnable=function(e){this.state.pickEnable=e},CgsCzml3D.prototype.getPickEnable=function(){return this.state.pickEnable},CgsTerrain3D=function(e){this.url=e.url;var t=CgsUtil.getProxyURL(e.proxy);this.proxy=t?new Cesium.DefaultProxy(t):null,this.url=new Cesium.Resource({url:this.url,proxy:this.proxy}),this.onError=e.onError,this.requestWaterMask=Cesium.defaultValue(e.requestWaterMask,!1),this.requestVertexNormals=Cesium.defaultValue(e.requestVertexNormals,!1),this.noLayerInfo=Cesium.defaultValue(e.noLayerInfo,!1);var i={url:this.url,onError:e.onError,requestWaterMask:this.requestWaterMask,requestVertexNormals:this.requestVertexNormals,noLayerInfo:this.noLayerInfo};Cesium.CgsCesiumTerrainProvider.call(this,i),this.level=Cesium.defaultValue(e.level,8)},CgsInherits(CgsTerrain3D,Cesium.CgsCesiumTerrainProvider),CgsTileTerrain3D=function(e){var t;t=e.proxy?new Cesium.DefaultProxy(e.proxy):new Cesium.DefaultProxy(CGS_SDK_PATH+"proxy/proxy.jsp?address="),this.requestWaterMask=Cesium.defaultValue(e.requestWaterMask,!1),this.requestVertexNormals=Cesium.defaultValue(e.requestVertexNormals,!1),this.tileMaxLevel=Cesium.defaultValue(e.tileMaxLevel,6),this.numberOfLevelZeroTilesXY=Cesium.defaultValue(e.numberOfLevelZeroTilesXY,[18,9]),this.maximumLevel=Cesium.defaultValue(e.maximumLevel,this.tileMaxLevel+4),this.databaseName=Cesium.defaultValue(e.databaseName,"全球300米");var i={url:e.url,proxy:t,databaseName:this.databaseName,requestWaterMask:this.requestWaterMask,requestVertexNormals:this.requestVertexNormals,numberOfLevelZeroTilesXY:this.numberOfLevelZeroTilesXY,maximumLevel:this.maximumLevel};Cesium.FeBILTerrainProvider.call(this,i),this.url=e.url,this.proxy=e.proxy,this.level=Cesium.defaultValue(e.level,this.maximumLevel)},CgsInherits(CgsTileTerrain3D,Cesium.FeBILTerrainProvider),CgsOverlay3D=function(e){this.options=e,this.clones=[],this.overlay3DIndex=e.overlay3DIndex,this.parentOverlay=e.parentOverlay,this.state={position:e.position.concat(),positioning:e.positioning,offset:e.offset,div:null,id:CgsIds++,map:null,type:"overlay",bflag:!0,stopEvent:e.stopEvent,isRoundCorner:!!e.isRoundCorner&&e.isRoundCorner,roundCornerSize:e.roundCornerSize?e.roundCornerSize:0},this.lineStyle={},this.brokenLine=e.brokenLine,this.brokenLineOffset=!!e.brokenLineOffset&&e.brokenLineOffset,e.lineStyle||(e.lineStyle={}),this.lineStyle.color=e.lineStyle.color?e.lineStyle.color:"rgba(255,255,255,0.9)",this.lineStyle.width=e.lineStyle.width?e.lineStyle.width:1,this.lineStyle.dasharray=e.lineStyle.dasharray?e.lineStyle.dasharray:[],this.lineStyle.dashoffset=e.lineStyle.dashoffset?e.lineStyle.dashoffset:0,this.draggable=e.draggable,this.showLine=e.showLine,this.keepInContainer=e.keepInContainer||!1,this.state.position.length<3&&this.state.position.push(0),null!=e.type&&(this.state.type="popup"),null==e.offset&&(this.state.offset=[0,0]),0!=e.stopEvent&&(this.state.stopEvent=!0),this.dom=e.element;var t=document.createElement("div");(this.state.div=t).style.position="absolute",t.style.minHeight="10px",t.style.minWidth="10px",this.setPointerEvents(this.state.stopEvent),t.appendChild(this.dom),this.state.div=t,this.zindexBase=.02,this.visible=!0,this.distanceDisplayCondition=Cesium.defaultValue(e.distanceDisplayCondition,void 0)},CgsOverlay3D.prototype.update=function(){var e,t,i,s,o,a,n;if(this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip))if(Cesium.defined(this.parent)&&1==this.map.scene.canvas.index){(e=this.computeVisible())&&(strTop=this.state.div.style.top,strLeft=this.state.div.style.left,C=parseInt(strTop.slice(0,strTop.length-2)),y=parseInt(strLeft.slice(0,strLeft.length-2)),this.map.pip&&(i=this.state.div.offsetHeight+C,t=this.state.div.offsetWidth+y,a=this.map.scene.canvas.offsetTop+this.map.scene.canvas.offsetHeight,n=this.map.scene.canvas.offsetLeft+this.map.scene.canvas.offsetWidth),this.map.twoViewsMode&&(C<this.map.scene.canvas.offsetTop||y<this.map.scene.canvas.offsetLeft)||this.map.pip&&(C<this.map.scene.canvas.offsetTop||y<this.map.scene.canvas.offsetLeft||a<i||n<t)?this.visible=!1:this.visible=!0)}else{if(Cesium.defined(this.parent)||0!=this.map.scene.canvas.index)return;(e=this.computeVisible())&&(strTop=this.state.div.style.top,strLeft=this.state.div.style.left,C=parseInt(strTop.slice(0,strTop.length-2)),y=parseInt(strLeft.slice(0,strLeft.length-2)),t=this.state.div.offsetWidth+y,i=this.state.div.offsetHeight+C,this.map.pip&&(s=this.map.scene.allViewports[0].canvas.offsetTop,o=this.map.scene.allViewports[0].canvas.offsetLeft,a=this.map.scene.allViewports[0].canvas.offsetTop+this.map.scene.allViewports[0].canvas.offsetHeight,n=this.map.scene.allViewports[0].canvas.offsetLeft+this.map.scene.allViewports[0].canvas.offsetWidth),this.map.twoViewsMode&&(i>this.map.scene.canvas.height||t>this.map.scene.canvas.width)?this.visible=!1:this.map.pip?this.visible=n<y||a<C||t<o||i<s:this.visible=!0)}else e=this.computeVisible();if(!e)return this.state.div.style.visibility="hidden",void this.updateLine();this.state.bflag&&this.visible?this.state.div.style.visibility="visible":this.state.div.style.visibility="hidden";var r,l,u,p=this.state.map.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Cartographic.fromDegrees(this.state.position[0],this.state.position[1],this.state.position[2]));if(p&&(this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip)&&(Cesium.defined(this.parent)||0!=this.map.scene.canvas.index)?Cesium.defined(this.parent)&&1==this.map.scene.canvas.index&&(u=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.state.map.scene,p,void 0,0),this.map.twoViewsMode&&(r=this.map.scene._canvas0.offsetTop,l=this.map.scene._canvas0.offsetWidth),this.map.pip&&(r=(this.map.scene.canvas.offsetHeight-this.map.scene._canvas0.offsetHeight)/2+this.map.scene.canvas.offsetTop,l=(this.map.scene.canvas.offsetWidth-this.map.scene._canvas0.offsetWidth)/2+this.map.scene.canvas.offsetLeft),u.x=u.x+l,u.y=u.y+r):u=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.state.map.scene,p),u)){var h=this.state.div.offsetWidth,c=this.state.div.offsetHeight,g=0,d=0;switch(this.state.positioning){case CgsOverlay3D.TOP_LEFT:break;case CgsOverlay3D.TOP_CENTER:g=-h/2;break;case CgsOverlay3D.TOP_RIGHT:g=-h;break;case CgsOverlay3D.CENTER_LEFT:d=-c/2;break;case CgsOverlay3D.CENTER_CENTER:g=-h/2,d=-c/2;break;case CgsOverlay3D.CENTER_RIGHT:g=-h,d=-c/2;break;case CgsOverlay3D.BOTTOM_LEFT:d=-c;break;case CgsOverlay3D.BOTTOM_CENTER:g=-h/2,d=-c;break;case CgsOverlay3D.BOTTOM_RIGHT:g=-h,d=-c}var m,f,C=u.y+d+this.state.offset[1],y=u.x+g+this.state.offset[0];this.keepInContainer&&(m=this.map.container.clientHeight,f=this.map.container.clientWidth,C<0?C=0:m<C+c&&(C=m-c),y<0?y=0:f<y+h&&(y=f-h)),this.state.div.style.top=Math.round(C)+"px",this.state.div.style.left=Math.round(y)+"px",this.updateLine();var v,b,D,S,_,w,P,T=this.state.map.getCenter();!T||(v=this.state.position)&&(void 0!==this.overlay3DIndex?this.state.div.style.zIndex=this.overlay3DIndex:(_=(b=v[0]-T[0])*b+(D=v[1]-T[1])*D*(S=Math.cos((v[1]+T[1])/360*Math.PI))*S,w=this.zindexBase?Math.round((5e3-_)*this.zindexBase):Math.round(5e3-_),this.state.div.style.zIndex=""+w),this.getVisible()&&Cesium.defined(this.distanceDisplayCondition)&&(P=map.getHeight(),"[object Array]"==Object.prototype.toString.call(this.distanceDisplayCondition)?1==this.distanceDisplayCondition.length?P<this.distanceDisplayCondition[0]?this.state.div.style.visibility="visible":this.state.div.style.visibility="hidden":2==this.distanceDisplayCondition.length&&(P>this.distanceDisplayCondition[0]&&P<this.distanceDisplayCondition[1]?this.state.div.style.visibility="visible":this.state.div.style.visibility="hidden"):P<this.distanceDisplayCondition?this.state.div.style.visibility="visible":this.state.div.style.visibility="hidden"))}},CgsOverlay3D.prototype.setMap=function(map){var that,_$$,jqueryOut,onStop;this.state.map=map,this.map=map,map&&(0==$$(map.container).find(".overlaySVG").length&&$$(map.container).append($$('<svg version ="1.2" xmlns="http://www.w3.org/2000/svg" class="overlaySVG" width="100%" height="100%" style="position:absolute; top:0px; left:0px; pointer-events:none; z-index:100;"></svg>')),map.overlays.push(this),this.state.map.container.appendChild(this.state.div),this.state.map.scene.postRender.addEventListener(this.update,this),this.update(),this.draggable&&(that=this,_$$=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$,jqueryOut=_$$,onStop=function(){that.isDraging&&(that.isDraging=!1,that.map.scene.postRender.addEventListener(that.update,that))},this.state.div.onmouseup=function(){onStop()},jqueryOut(this.state.div).draggable({cursor:"default",onDrag:function onDrag(e){var x=eval($$(this).css("left").replace("px","")),y=eval($$(this).css("top").replace("px","")),offsetX=0,offsetY=0,divWidth=that.state.div.scrollWidth,divHeight=that.state.div.scrollHeight,p1,p2,offsetTop,offsetWidth,p2,offset,height,width,type;switch(that.state.positioning){case CgsOverlay3D.TOP_LEFT:break;case CgsOverlay3D.TOP_CENTER:offsetX=-divWidth/2;break;case CgsOverlay3D.TOP_RIGHT:offsetX=-divWidth;break;case CgsOverlay3D.CENTER_LEFT:offsetY=-divHeight/2;break;case CgsOverlay3D.CENTER_CENTER:offsetX=-divWidth/2,offsetY=-divHeight/2;break;case CgsOverlay3D.CENTER_RIGHT:offsetX=-divWidth,offsetY=-divHeight/2;break;case CgsOverlay3D.BOTTOM_LEFT:offsetY=-divHeight;break;case CgsOverlay3D.BOTTOM_CENTER:offsetX=-divWidth/2,offsetY=-divHeight;break;case CgsOverlay3D.BOTTOM_RIGHT:offsetX=-divWidth,offsetY=-divHeight}that.state.map&&(p1=that.state.map.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Cartographic.fromDegrees(that.state.position[0],that.state.position[1],that.state.position[2])),p1&&(that.map&&that.map.isMultiViewsMode&&(that.map.twoViewsMode||that.map.pip)&&Cesium.defined(that.parent)?Cesium.defined(that.parent)&&(p2=Cesium.SceneTransforms.wgs84ToWindowCoordinates(that.state.map.scene,p1,void 0,0),this.map.twoViewsMode&&(offsetTop=this.map.scene._canvas0.offsetTop,offsetWidth=this.map.scene._canvas0.offsetWidth),this.map.pip&&(offsetTop=(this.map.scene.canvas.offsetHeight-this.map.scene._canvas0.offsetHeight)/2+this.map.scene.canvas.offsetTop,offsetWidth=(this.map.scene.canvas.offsetWidth-this.map.scene._canvas0.offsetWidth)/2+this.map.scene.canvas.offsetLeft),p2.x=p2.x+offsetWidth,p2.y=p2.y+offsetTop):p2=Cesium.SceneTransforms.wgs84ToWindowCoordinates(that.state.map.scene,p1),p2&&(that.state.offset[1]=y-p2.y-offsetY,that.state.offset[0]=x-p2.x-offsetX,that.updateLine(),that.parentOverlay.flag||(offset=that.parentOverlay.getPixelOffset(),height=that.dom.offsetHeight,width=that.dom.offsetWidth,offset[0]<0&&0<offset[1]+height&&offset[1]<0?type=4.5:-20<offset[0]&&0<offset[1]?type=3:offset[0]<-40&&0<offset[1]?type=offset[0]+divWidth<40&&20<offset[0]+divWidth?4.51:offset[0]<=-1*(divWidth-40)?4.2:offset[0]>=-1*divWidth&&offset[0]<divWidth/2*-1?4.3:4:offset[0]<-40&&offset[1]<0?type=offset[0]+divWidth<40&&20<offset[0]+divWidth?1.51:offset[0]<=-1*(divWidth-40)?1.2:offset[0]>=-1*divWidth&&offset[0]<divWidth/2*-1?1.3:1:-20<offset[0]&&offset[1]<0&&offset[1]+height<0?type=2:offset[0]<-20&&-40<offset[0]&&offset[1]<0?type=1.5:0<offset[0]&&0<offset[1]+height&&offset[1]<0?type=2.5:offset[0]<=-20&&-40<=offset[0]&&0<offset[1]&&(type=3.5),that.parentOverlay&&that.parentOverlay.lineOverlay&&CgsMapNote.move(offset,type,that.parentOverlay,that.parentOverlay.lineOverlay,that.parentOverlay.noteLineColor)))))},onBeforeDrag:function(){that.map.scene.postRender.removeEventListener(that.update,that),that.isDraging=!0},onStopDrag:function(){onStop()}})))},CgsOverlay3D.prototype.getMap=function(){return this.state.map},CgsOverlay3D.prototype.updateDom=function(e){if(this.state.div.removeChild(this.dom),this.dom=e,this.state.div.appendChild(e),this.update(),this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip))for(var t=0;t<this.clones.length;++t){var i=this.clones[t],s=$$(e).clone()[0];i.updateDom(s)}},CgsOverlay3D.prototype.updateLine=function(){if(!this.showLine||1!=this.getVisible())return this.line&&(this.line.remove(),this.line=null),void(this.lineB&&(this.lineB.remove(),this.lineB=null));if(this.state.map){this.svg=$$(this.state.map.container).find(".overlaySVG"),this.lineAttr={},this.lineAttr.color=this.lineStyle.color,this.lineAttr.width=this.lineStyle.width.toString(),this.lineAttr.dashoffset=this.lineStyle.dashoffset.toString(),this.lineAttr.dasharray="";for(var e=0;e<this.lineStyle.dasharray.length;e++)this.lineAttr.dasharray+=this.lineStyle.dasharray[e],this.lineAttr.dasharray+=" ";this.line||(this.brokenLine?(this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.svg.append(this.line),this.lineB=document.createElementNS("http://www.w3.org/2000/svg","line"),this.svg.append(this.lineB)):(this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.svg.append(this.line)));var t,i,s,o=$$(this.state.div).css("left").replace("px",""),a=$$(this.state.div).css("top").replace("px",""),n=this.state.div.scrollWidth,r=this.state.div.scrollHeight,l=this.state.map.scene.globe.ellipsoid.cartographicToCartesian(Cesium.Cartographic.fromDegrees(this.state.position[0],this.state.position[1],this.state.position[2]));if(l)if(this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip)&&Cesium.defined(this.parent)?Cesium.defined(this.parent)&&(s=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.state.map.scene,l,void 0,0),this.map.twoViewsMode&&(t=this.map.scene._canvas0.offsetTop,i=this.map.scene._canvas0.offsetWidth),this.map.pip&&(t=(this.map.scene.canvas.offsetHeight-this.map.scene._canvas0.offsetHeight)/2+this.map.scene.canvas.offsetTop,i=(this.map.scene.canvas.offsetWidth-this.map.scene._canvas0.offsetWidth)/2+this.map.scene.canvas.offsetLeft),s.x=s.x+i,s.y=s.y+t):s=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.state.map.scene,l),s){var u,p,h=o-s.x,c=a-s.y,g=Math.round(n/2),d=(Math.round(r/2),0),m=0;if(Math.abs(h+g)<Math.abs(h)&&(d=g),Math.abs(h+n)<Math.abs(h+g)&&(d=n),Math.abs(c+r)<Math.abs(c)&&(m=r),h+=d,c+=m,this.state.isRoundCorner){divCorner=[];divCorner.push({x:parseFloat(o)+n,y:parseFloat(a)}),divCorner.push({x:parseFloat(o)+n,y:parseFloat(a)+r}),divCorner.push({x:parseFloat(o),y:parseFloat(a)}),divCorner.push({x:parseFloat(o),y:parseFloat(a)+r});for(e=0;e<divCorner.length;e++)s.x+h==divCorner[e].x&&s.y+c==divCorner[e].y&&(0==e?(h-=this.state.roundCornerSize,c+=this.state.roundCornerSize):1==e?(h-=this.state.roundCornerSize,c-=this.state.roundCornerSize):2==e?(h+=this.state.roundCornerSize,c+=this.state.roundCornerSize):3==e&&(h+=this.state.roundCornerSize,c-=this.state.roundCornerSize))}this.brokenLine?(this.brokenLineOffset?0<c&&0<h?(u=this.brokenLineOffset[0],p=-this.brokenLineOffset[1]):0<c&&h<0?(u=-this.brokenLineOffset[0],p=-this.brokenLineOffset[1]):c<0&&h<0?(u=-this.brokenLineOffset[0],p=this.brokenLineOffset[1]):c<0&&0<h&&(u=this.brokenLineOffset[0],p=this.brokenLineOffset[1]):p=u=0,this.line.setAttribute("x1",Math.round(s.x).toString()),this.line.setAttribute("y1",Math.round(s.y).toString()),this.line.setAttribute("x2",Math.round(s.x+u).toString()),this.line.setAttribute("y2",Math.round(s.y+c+p).toString()),this.line.setAttribute("stroke-width",this.lineAttr.width),this.line.setAttribute("stroke-dasharray",this.lineAttr.dasharray),this.line.setAttribute("stroke",this.lineAttr.color),this.line.setAttribute("stroke-dashoffset",this.lineAttr.dashoffset),this.lineB.setAttribute("x1",Math.round(s.x+u).toString()),this.lineB.setAttribute("y1",Math.round(s.y+c+p).toString()),this.lineB.setAttribute("x2",Math.round(s.x+h).toString()),this.lineB.setAttribute("y2",Math.round(s.y+c).toString()),this.lineB.setAttribute("stroke-width",this.lineAttr.width),this.lineB.setAttribute("stroke-dasharray",this.lineAttr.dasharray),this.lineB.setAttribute("stroke",this.lineAttr.color),this.lineB.setAttribute("stroke-dashoffset",this.lineAttr.dashoffset)):(this.line.setAttribute("x1",Math.round(s.x).toString()),this.line.setAttribute("y1",Math.round(s.y).toString()),this.line.setAttribute("x2",Math.round(s.x+h).toString()),this.line.setAttribute("y2",Math.round(s.y+c).toString()),this.line.setAttribute("stroke-width",this.lineAttr.width),this.line.setAttribute("stroke-dasharray",this.lineAttr.dasharray),this.line.setAttribute("stroke",this.lineAttr.color),this.line.setAttribute("stroke-dashoffset",this.lineAttr.dashoffset))}}},CgsOverlay3D.prototype.remove=function(){if(this.state.div.parentNode&&this.state.div.parentNode.removeChild(this.state.div),this.state.map){this.state.map.scene.postRender.removeEventListener(this.update,this);for(var e=this.state.map.overlays.length-1;0<=e;e--)if(this.state.map.overlays[e]==this){this.state.map.overlays.splice(e,1);break}}if(this.line&&($$(this.line).remove(),this.line=null),this.lineB&&($$(this.lineB).remove(),this.lineB=null),this.state.map=null,this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip))for(e=0;e<this.clones.length;++e){this.clones[e].remove()}},CgsOverlay3D.prototype.setOffset=function(e){if(e&&2==e.length&&(this.state.offset=e,this.update()),this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip))for(var t=0;t<this.clones.length;++t){this.clones[t].setOffset(e)}},CgsOverlay3D.prototype.getOffset=function(){return this.state.offset},CgsOverlay3D.prototype.setVisible=function(e){if(this.state.map&&this.state.bflag!=e)if(this.state.bflag=e){if(!this.computeVisible())return;this.state.div.style.visibility="visible"}else this.line&&($$(this.line).remove(),this.line=null),this.lineB&&($$(this.lineB).remove(),this.lineB=null),this.state.div.style.visibility="hidden";if(this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip))for(var t=0;t<this.clones.length;++t){this.clones[t].setVisible(e)}},CgsOverlay3D.prototype.getVisible=function(){return"hidden"!=this.state.div.style.visibility},CgsOverlay3D.prototype.getGroup=function(){return this.state.group},CgsOverlay3D.prototype.setPointerEvents=function(e){if(this.state.div.style.pointerEvents=e?"all":"none",this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip))for(var t=0;t<this.clones.length;++t){this.clones[t].setPointerEvents(e)}},CgsOverlay3D.prototype.getPointerEvents=function(){var e=!0;return"none"==this.state.div.style.pointerEvents&&(e=!1),e},CgsOverlay3D.prototype.getType=function(){return this.state.type},CgsOverlay3D.prototype.setPosition=function(e){if(this.state.position=e,this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip))for(var t=0;t<this.clones.length;++t){this.clones[t].setPosition(e)}},CgsOverlay3D.prototype.getPosition=function(){return this.state.position},CgsOverlay3D.prototype.setPositioning=function(e){if(this.state.positioning=e,this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip))for(var t=0;t<this.clones.length;++t){this.clones[t].setPositioning(e)}},CgsOverlay3D.prototype.getPositioning=function(){return this.state.positioning},CgsOverlay3D.prototype.computeVisible=function(){if(!this.state.map)return!1;var e,t;if((e=this.state.map.trackedEntity)&&(t=this.parentOverlay.mobileObj)&&e==t.model.feature3D.getEntity())return!0;var i=6356752.314145179,s=this.state.map.camera.position,o=s.x/6378137,a=s.y/6378137,n=s.z/i,r=o*o+a*a+n*n-1;if(!this.state.position)return!1;null==this.state.position[2]&&(this.state.position[2]=0);var l=Cesium.Cartesian3.fromDegrees(this.state.position[0],this.state.position[1],this.state.position[2]),u=l.x/6378137-o,p=l.y/6378137-a,h=l.z/i-n,c=-(u*o+p*a+h*n);return!(r<c&&r<c*c/(u*u+p*p+h*h))},CgsOverlay3D.prototype.setLineVisible=function(e){if(this.showLine=e,this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip))for(var t=0;t<this.clones.length;++t){this.clones[t].setLineVisible(e)}},CgsOverlay3D.prototype.getLineVisible=function(){return this.showLine},CgsOverlay3D.prototype.setLineStyle=function(e){if(this.lineStyle||(this.lineStyle={}),null!=e.color&&(this.lineStyle.color=e.color),null!=e.width&&(this.lineStyle.width=e.width),null!=e.dasharray&&(this.lineStyle.dasharray=e.dasharray),null!=e.dashoffset&&(this.lineStyle.dashoffset=e.dashoffset),this.map&&this.map.isMultiViewsMode&&(this.map.twoViewsMode||this.map.pip))for(var t=0;t<this.clones.length;++t){this.clones[t].setLineStyle(e)}},CgsOverlay3D.prototype.getLineStyle=function(){return this.lineStyle},CgsOverlay3D.prototype.getOverlay3DIndex=function(){return this.overlay3DIndex},CgsOverlay3D.prototype.setOverlay3DIndex=function(e){this.overlay3DIndex=e},CgsOverlay3D.TOP_LEFT="top-left",CgsOverlay3D.TOP_CENTER="top-center",CgsOverlay3D.TOP_RIGHT="top-right",CgsOverlay3D.CENTER_LEFT="center-left",CgsOverlay3D.CENTER_CENTER="center-center",CgsOverlay3D.CENTER_RIGHT="center-right",CgsOverlay3D.BOTTOM_LEFT="bottom-left",CgsOverlay3D.BOTTOM_CENTER="bottom-center",CgsOverlay3D.BOTTOM_RIGHT="bottom-right",CgsImageLayer3D=function(e){null==e.isAddToLayerTree&&(e.isAddToLayerTree=!0),null==e.visible&&(e.visible=!0);var t={name:e.name,layer:void 0===e.layer?e.name:e.layer,type:"Image",url:e.url,rectangle:e.rec,isAddToLayerTree:e.isAddToLayerTree,text:e.text,visible:e.visible,pId:e.pId},i=function(e){null==e&&(e=[-180,-90,180,90]);var t=Cesium.Math.toRadians(e[0]),i=Cesium.Math.toRadians(e[1]),s=Cesium.Math.toRadians(e[2]),o=Cesium.Math.toRadians(e[3]);{s<t&&(a=t,t=s,s=a)}{var a;o<i&&(a=i,i=o,o=a)}t!=s&&i!=o||console.error("Rectangle Error: Please check the Extent!");return new Cesium.Rectangle(t,i,s,o)}(t.rectangle),s=new Cesium.SingleTileImageryProvider({url:t.url,rectangle:i});CgsLayer3D.call(this,s,t)},CgsInherits(CgsImageLayer3D,CgsLayer3D),CgsToolBar3D=function(e){mapEarth=e,this.UiToolBar(mapEarth),this.layerToolActive=!1,this.markToolActive=!1},CgsToolBar3D.prototype.UiToolBar=function(t){var s=this,e=t.container,i=document.getElementById("toolDiv");i&&e.removeChild(document.getElementById("toolDiv")),(sztoolBar=new Array).push(["tc","图层"]),sztoolBar.push(["bh","标绘"]),sztoolBar.push(["cl","测量"]),sztoolBar.push(["qh","二三维切换"]),sztoolBar.push(["dw","默认视角"]),sztoolBar.push(["fd","放大"]),sztoolBar.push(["sx","缩小"]),sztoolBar.push(["blkzd","光照"]),sztoolBar.push(["drd","大气层"]),sztoolBar.push(["dcd","雾气"]),(i=document.createElement("div")).setAttribute("id","toolDiv"),i.setAttribute("class","cgstoolBarDiv"),i.style.zIndex="900",i.style.visibility="visible";for(var o=0;o<sztoolBar.length;o++){var a=(r=sztoolBar[o])[0],n=r[1];(l=document.createElement("div")).setAttribute("class","tool_normalDiv"),l.style.zIndex="901",l.setAttribute("title",n),l.setAttribute("id",a),(u=document.createElement("div")).setAttribute("class","junb_itemImageDiv "+a),l.onclick=function(e){document.getElementById(this.id).setAttribute("class","tool_pressDiv"),"bh"==this.id?s.markToolActive?(s.markTool.deactivate(),document.getElementById("bh").setAttribute("class","tool_hoverDiv")):(s.markTool||(s.markTool=new CgsMarkTool3D(t)),s.markTool.activate(),document.getElementById("bh").setAttribute("class","tool_pressDiv")):"tc"==this.id?s.layerToolActive?(s.layerTool.deactivate(),document.getElementById("tc").setAttribute("class","tool_hoverDiv")):(s.layerTool||(s.layerTool=new CgsLayerTool3D(t)),s.layerTool.activate(),document.getElementById("tc").setAttribute("class","tool_pressDiv")):"cl"==this.id?(s.measureTool||(s.measureTool=new CgsMeasureTool3D(t)),s.measureToolActive?(s.measureToolActive=!1,s.measureTool.deactivate(),document.getElementById("cl").setAttribute("class","tool_hoverDiv")):(s.measureToolActive=!0,s.measureTool.activate(),document.getElementById("cl").setAttribute("class","tool_pressDiv"))):"qh"==this.id?"3D"==t.view.mode?t.view.switchSceneMode("2D",0):t.view.switchSceneMode("3D",0):"dw"==this.id?t.view.flyHome():"fd"==this.id?t.view.zoomIn():"sx"==this.id?t.view.zoomOut():"blkzd"==this.id?this.lightingVisible?(t.setLightingVisible(!1),this.lightingVisible=!1):(t.setLightingVisible(!0),this.lightingVisible=!0):"drd"==this.id?this.skyAtmosphereVisible?(t.setSkyAtmosphereVisible(!1),this.skyAtmosphereVisible=!1):(t.setSkyAtmosphereVisible(!0),this.skyAtmosphereVisible=!0):"dcd"==this.id&&(this.fogVisible?(t.setFogVisible(!1),this.fogVisible=!1):(t.setFogVisible(!0),this.fogVisible=!0))},l.onmousedown=function(e){document.getElementById(this.id).setAttribute("class","tool_pressDiv")},l.onmouseup=function(e){var t=document.getElementById(this.id);"tc"==this.id?s.layerToolActive?t.setAttribute("class","tool_pressDiv"):t.setAttribute("class","tool_hoverDiv"):"bh"==this.id?s.markToolActive?t.setAttribute("class","tool_pressDiv"):t.setAttribute("class","tool_hoverDiv"):"cl"==this.id&&s.measureToolActive?t.setAttribute("class","tool_pressDiv"):t.setAttribute("class","tool_hoverDiv")},l.onmouseleave=function(e){var t=document.getElementById(this.id);"tc"==this.id?s.layerToolActive?t.setAttribute("class","tool_pressDiv"):t.setAttribute("class","tool_normalDiv"):"bh"==this.id?s.markToolActive?t.setAttribute("class","tool_pressDiv"):t.setAttribute("class","tool_normalDiv"):"cl"==this.id&&s.measureToolActive?t.setAttribute("class","tool_pressDiv"):t.setAttribute("class","tool_normalDiv")},l.onmouseenter=function(e){var t=document.getElementById(this.id);"tc"==this.id?s.layerToolActive?t.setAttribute("class","tool_pressDiv"):t.setAttribute("class","tool_hoverDiv"):"bh"==this.id&&s.markToolActive?t.setAttribute("class","tool_pressDiv"):t.setAttribute("class","tool_hoverDiv")},l.appendChild(u),i.appendChild(l)}for(o=sztoolBar.length;o<sztoolBar.length;o++){var r,l,u,a=(r=sztoolBar[o])[0],n=r[1];(l=document.createElement("div")).setAttribute("class","tool_disableDiv"),l.style.zIndex="901",l.setAttribute("title",n),l.setAttribute("id",a),(u=document.createElement("div")).setAttribute("class","junb_itemImageDiv "+a),l.appendChild(u),i.appendChild(l)}e.appendChild(i),CgsSubPub.subscribe("markToolClosed",function(){junbTool&&(junbTool.Hide(),junbTool=null),document.getElementById("bh").setAttribute("class","tool_normalDiv")}),CgsSubPub.subscribe("toolActive",function(e,t,i){t==s.layerTool?(i?document.getElementById("tc").setAttribute("class","tool_pressedDiv"):document.getElementById("tc").setAttribute("class","tool_normalDiv"),s.layerToolActive=i):t==s.markTool&&(i?document.getElementById("bh").setAttribute("class","tool_pressedDiv"):document.getElementById("bh").setAttribute("class","tool_normalDiv"),s.markToolActive=i)})},CgsToolBar3D.prototype.show=function(){this.UiControl(mapEarth)},CgsToolBar3D.prototype.hide=function(){document.getElementById("toolDiv");junbId&&mapEarth.container.removeChild(document.getElementById("toolDiv"))},CgsPlotScale3D=function(c){this.map=c,this.createScaleDiv(c),c.scene.postRender.addEventListener(function(){var e,t,i,s,o,a,n,r,l,u,p,h;c&&c.plotScaleFlag&&(e=c.container,(t=[]).push(30),t.push(e.clientHeight-30),t.push(130),t.push(e.clientHeight-30),(i=c.pixelToLonLat([t[0],t[1]]))?(s=Cesium.Cartesian3.fromDegrees(i[0],i[1]),(o=c.pixelToLonLat([t[2],t[3]]))?(a=Cesium.Cartesian3.fromDegrees(o[0],o[1]),n=Cesium.Cartesian3.distance(s,a),!(r=document.getElementById("plotScaleDivText"))||n<1||(u=null,u=1e3<=(l=parseInt(n))?(l/=1e3," km"):" m",p=l<10?l.toFixed(1):l.toFixed(0),r.innerHTML="比例尺 : "+p+u,(h=document.getElementById("plotScaleDiv"))&&(h.style.visibility="visible"))):(h=document.getElementById("plotScaleDiv"))&&(h.style.visibility="hidden")):(h=document.getElementById("plotScaleDiv"))&&(h.style.visibility="hidden"))})},CgsPlotScale3D.prototype.createScaleDiv=function(e){var t=CGS_SDK_PATH+"assets/image/CgsViewInfo/",i=document.createElement("div");i.style.position="absolute",i.setAttribute("id","plotScaleDiv"),i.style.width="auto",i.style.height="0px",i.style.left="30px",i.style.bottom="30px";var s=document.createElement("div");s.style.position="relative",s.style.width="150px",s.style.height="0px",s.style.left="0px",s.style.bottom="0px",s.style.borderTop="solid rgba(255,255,255,1.0) 2px",s.style.pointerEvents="none",i.appendChild(s);var o=document.createElement("div");o.style.position="absolute",o.style.width="2px",o.style.height="0px",o.style.left="0px",o.style.bottom="0px",o.style.borderTop="solid rgb(0,0,0) 2px",o.style.pointerEvents="none",o.style.borderColor="rgba(255,255,255,1.0)",i.appendChild(o);var a='<img class="aa-plotScaleDiv-bg" src="'+t+'bg3.png">';$$(i).append(a);var n=document.createElement("div");n.style.position="absolute",n.style.width="2px",n.style.height="0px",n.style.left="148px",n.style.bottom="0px",n.style.borderTop="solid rgb(0,0,0) 2px",n.style.pointerEvents="none",n.style.borderColor="rgba(255,255,255,1.0)",i.appendChild(n);var r=document.createElement("div");r.setAttribute("id","plotScaleDivText"),r.style.position="relative",r.style.color="rgba(255,255,255,1.0)",r.innerHTML="比例尺",r.style.bottom="40px",r.style.fontFamily="微软雅黑",r.style.fontSize="14px",i.appendChild(r),i.style.visibility="hidden",e.container.appendChild(i)},CgsAirLine3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){this.points=null,this.posProperty=null,this.voProperty=null,this.interval=null,this.completeCallback=null,this.durationCallback=null,this.state=CgsAirLine3D.STATE_START,this.finishFlag=!1,this.passedPath=null,this.pathState=!1,this.passLineEntity=null,this.passPathState=!1,this.smooth=e.smooth,this.map=e.mapObject,this.model=e.model,e.satelineFlag&&(this.mark=e.mark),this.totalTime=e.totalTime,this.completeCallback=e.completeCallback,this.durationCallback=e.durationCallback,this.curTime=0,this.deltaTime=0,this.deltaInterval=50,this.originalTime=0,this.multiplier=Cesium.defaultValue(e.multiplier,1),this.rate=0,this.preRate=0;var t=Cesium.defaultValue(e.optAllLine,{}),i=Cesium.defaultValue(t.lineType,CgsLine3D.LINT_DASHED),s=null==t.isDashLine||t.isDashLine;this.isDashLine=i===CgsLine3D.LINT_DASHED||s,t.lineType=i,t.evenColor=t.fillColor,this.optAllLine=t;var o=Cesium.defaultValue(e.optPassLine,{}),a=Cesium.defaultValue(o.lineType,0),n=Cesium.defaultValue(o.glowPower,1),r=Cesium.defaultValue(o.fillColor,"rgba(255,255,0,1.0)"),l=Cesium.defaultValue(o.width,2);o.lineType=a,o.glowPower=n,o.fillColor=r,o.width=l,this.optPassLine=o,this.satelineFlag=Cesium.defaultValue(e.satelineFlag,!1),this.orbitMotionFlag=Cesium.defaultValue(e.orbitMotionFlag,!1),this.numOfPoints=Cesium.defaultValue(e.numOfPoints,5e3),this.prePathState=!1,this.tailFire=void 0,this.ribbon=void 0,this.slope=void 0}),CgsAirLine3D.prototype.setPoints=function(e){var t;this.points=e,"[object Array]"==Object.prototype.toString.call(e)&&(this.passedPath=new CgsLine({positions:[e[0],e[0]],followSurface:!1,width:20}),this.optPassLine.positions=[e[0],e[1]],this.passLineEntity=new CgsLine3D(this.optPassLine),this.satelineFlag&&this.optAllLine.useDynamicColor&&(t={width:this.optAllLine.width,fillColor:this.optAllLine.fillColor,lineType:this.optAllLine.lineType,positions:[e[0],e[1]]},this.preLineEntity=new CgsLine3D(t)),this.showPath(this.map),this.hidePath())},CgsAirLine3D.prototype.showPath=function(e){if(this.lineEntity)return this.lineEntity.entity.show=!0,void(this.pathState=!0);for(var t=new Cesium.SampledPositionProperty,i=new Date,s=new Date,o=this.totalTime,a=0;a<this.points.length;++a)s.setTime(i.getTime()+a*o/(this.points.length-1)),t.addSample(Cesium.JulianDate.fromDate(s),Cesium.Cartesian3.fromDegrees(this.points[a][0],this.points[a][1],this.points[a][2]));t.setInterpolationOptions({interpolationDegree:5,interpolationAlgorithm:Cesium.LagrangePolynomialApproximation});var n,r=[];this.satelineFlag?n=Math.ceil(this.totalTime/this.numOfPoints):(n=50,this.smooth&&50<this.totalTime/50&&(n=this.totalTime/50));for(var l=0;l<this.totalTime/n;l++){s.setTime(i.getTime()+n*l);var u=t.getValue(Cesium.JulianDate.fromDate(s)),p=Cesium.Cartographic.fromCartesian(u);r.push([180*p.longitude/Math.PI,180*p.latitude/Math.PI,p.height])}l>this.totalTime/n&&(s.setTime(i.getTime()+this.totalTime),u=t.getValue(Cesium.JulianDate.fromDate(s)),p=Cesium.Cartographic.fromCartesian(u),r.push([180*p.longitude/Math.PI,180*p.latitude/Math.PI,p.height])),this.optAllLine.positions=r,this.isDashLine?this.lineEntity=new CgsDashLine3D(this.optAllLine):this.lineEntity=new CgsLine3D(this.optAllLine),this.pathState=!0,this.map.map3D.addFeature(this.lineEntity)},CgsAirLine3D.prototype.hidePath=function(){if(this.lineEntity)return this.lineEntity.entity.show=!1,void(this.pathState=!1)},CgsAirLine3D.prototype.getPathState=function(){return this.pathState},CgsAirLine3D.prototype.showPassPath=function(){if(this.passLineEntity)return this.passLineEntity.entity.show=!0,void(this.passPathState=!0)},CgsAirLine3D.prototype.hidePassPath=function(){if(this.passLineEntity)return this.passLineEntity.entity.show=!1,void(this.passPathState=!1)},CgsAirLine3D.prototype.getPassPathState=function(){return this.passPathState},CgsAirLine3D.prototype.showPrePath=function(){if(this.preLineEntity)return this.preLineEntity.entity.show=!0,void(this.prePathState=!0)},CgsAirLine3D.prototype.hidePrePath=function(){if(this.preLineEntity)return this.preLineEntity.entity.show=!1,void(this.prePathState=!1)},CgsAirLine3D.prototype.getPrePathState=function(){return this.prePathState},CgsAirLine3D.prototype.start=function(){this.startTime=new Date,this.posProperty=new Cesium.SampledPositionProperty;var _=this.model,e=this.totalTime,w=this.completeCallback,P=this.durationCallback,T=this.posProperty,M=_.feature3D.getEntity();this.pathState?this.lineEntity&&(this.map.map3D.entities.contains(this.lineEntity.entity)||this.map.map3D.addFeature(this.lineEntity),this.lineEntity.setVisible(!0)):this.lineEntity&&(this.map.map3D.entities.contains(this.lineEntity.entity)||this.map.map3D.addFeature(this.lineEntity),this.lineEntity.setVisible(!1)),this.passPathState?this.passLineEntity&&(this.map.map3D.addFeature(this.passLineEntity),this.passLineEntity.setVisible(!0)):this.passLineEntity&&(this.map.map3D.addFeature(this.passLineEntity),this.passLineEntity.setVisible(!1)),this.satelineFlag&&(this.prePathState?this.preLineEntity&&(this.map.map3D.addFeature(this.preLineEntity),this.preLineEntity.setVisible(!0)):this.preLineEntity&&(this.map.map3D.addFeature(this.preLineEntity),this.preLineEntity.setVisible(!1))),this.finishFlag=!1;for(var L=null,t=0;t<this.points.length;++t)(L=new Date).setTime(this.startTime.getTime()+t*e/(this.points.length-1)),this.posProperty.addSample(Cesium.JulianDate.fromDate(L),Cesium.Cartesian3.fromDegrees(this.points[t][0],this.points[t][1],this.points[t][2]));this.voProperty=new Cesium.VelocityOrientationProperty(T);var x=this.voProperty,E=(this.startTime,this.startTime);this.originalTime=0,this.originalTime=this.startTime.getTime(),this.curTime=0,T.setInterpolationOptions({interpolationDegree:5,interpolationAlgorithm:Cesium.LagrangePolynomialApproximation});var A=this;this.interval=setInterval(function(){var e=A.getState();if(e!=CgsAirLine3D.STATE_FREEZE&&e!=CgsAirLine3D.STATE_STOP&&!A.finishFlag){var t=A.deltaInterval+A.deltaTime;if(A.curTime+=t,A.curTime>=A.totalTime&&(A.curTime=A.totalTime),E.setTime(A.originalTime+A.curTime),E<=L){var i=Cesium.Cartographic.fromCartesian(T.getValue(Cesium.JulianDate.fromDate(E))),s=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),a=A.passedPath.getPosition();a.push([s,o,i.height]),A.passedPath.setPosition(a),_.setPosition([s,o,i.height]),_.mapNote&&_.mapNote.setPosition([s,o,i.height]),_.partner&&_.partner.setPosition([s,o,i.height]),_.airRadar&&_.airRadar.setPosition([s,o,i.height]);var n=A.map.map3D.manipulate.aircraftCockpit;n&&n.setPosition([s,o,i.height]);parseInt(A.totalTime/50);var r=E.getTime()-A.originalTime;r>=A.curTime&&(A.curTime=r);var l=A.curTime/A.totalTime;if(A.satelineFlag)if(A.mark&&A.mark.setPosition([s,o,i.height]),A.orbitMotionFlag){var u=A.optAllLine.positions.length,p=parseInt(l*u),h=[],c=[];if(0==l||0==p?(h.push(A.optAllLine.positions[0]),h.push(A.optAllLine.positions[1])):h=A.optAllLine.positions.slice(0,p),100<h.length){for(g=0;g<h.length;g+=10)c.push(h[g]);c.push([s,o,i.height]),A.passLineEntity.setPosition(c)}else h.push([s,o,i.height]),A.passLineEntity.setPosition(h);if(100<(u=(h=A.optAllLine.positions.slice(p+1)).length)){c=[];for(var g=0;g<u;g+=10)c.push(h[g]);c.unshift([s,o,i.height]),A.preLineEntity.setPosition(c)}else h.unshift([s,o,i.height]),A.preLineEntity.setPosition(h);A.changeFlag=!0}else{A.lineEntity.useDynamicColor&&(u=A.optAllLine.positions.length,p=parseInt(l*u),A.lineEntity.currentIndex=p)}else{var d=[];0==l?(d.push(A.optAllLine.positions[0]),d.push(A.optAllLine.positions[1])):d=A.optAllLine.positions.slice(0,parseInt(l*A.optAllLine.positions.length+1)),A.smooth&&d.push([s,o,i.height]),A.passLineEntity.getVisible()&&A.passLineEntity.setPosition(d)}M.orientation=x.getValue(Cesium.JulianDate.fromDate(E));var m,f=M.orientation,C=T.getValue(Cesium.JulianDate.fromDate(E)),y=CgsMath3D.oriToHeadingPitchRoll(f,C),v=A.model.feature3D.modelOriginalRotation;v&&(y=[y[0]+v[0],y[1]+v[1],y[2]+v[2]]),A.model.setRotation(y),n&&n.setRotation([y[0]+90,0,0]),A.tailFire&&(y[0]-=180,A.tailFire.setRotate(y,-1),y[0]=0,y[2]=0,y[1]=-y[1],A.tailFire.setRotation(y,-1),.5<(m=A.tailFire.getTranslation()[1]*Math.sin(Cesium.Math.toRadians(-y[1])))?A.tailFire.setPosition([s,o,i.height-m]):A.tailFire.setPosition([s,o,i.height-m+.3])),A.ribbon&&A.ribbon.setPosition([s,o,i.height]),A.slope&&A.slope.setPosition([s,o,i.height]),A.radar&&(A.radar.getType()==CgsRadar.SATELLITE_RADAR&&A.radar.getVisible()?A.radar.setPosition({launchPosition:[s,o,i.height],destinationPosition:[s,o,0]}):A.radar.getType()==CgsRadar.AIR_RADAR&&A.radar.getVisible()&&(A.radar.setPosition([s,o,i.height]),E>A.limitTime&&(A.radar.setLength(i.height),A.limitTime.setTime(A.limitTime.getTime()+A.totalTime/10)))),A.scanArea&&((h=A.optAllLine.positions.slice(0,parseInt(l*A.optAllLine.positions.length))).push([s,o]),A.scanArea.setPosition(h)),A.overlay&&A.overlay.setPosition([s,o,i.height]);var b,D=_.feature3D.getLabel();D&&(b=M.position,D.getEntity().position=b),P&&P(_)}else{A.finishFlag=!0,A.state=CgsAirLine3D.STATE_FREEZE;var S=A.optAllLine.positions[A.optAllLine.positions.length-1];_.setPosition(S);d=[];d=A.optAllLine.positions.slice(0),A.passLineEntity.setPosition(d),clearInterval(A.interval),w&&w(_)}}},100)},CgsAirLine3D.prototype.stop=function(){this.interval&&(clearInterval(this.interval),this.state=CgsAirLine3D.STATE_STOP),this.lineEntity&&this.map.map3D.removeFeature(this.lineEntity),this.passLineEntity&&this.map.map3D.removeFeature(this.passLineEntity),this.preLineEntity&&this.map.map3D.removeFeature(this.preLineEntity)},CgsAirLine3D.prototype.freeze=function(){this.state=CgsAirLine3D.STATE_FREEZE},CgsAirLine3D.prototype.unfreeze=function(){this.state=CgsAirLine3D.STATE_UNFREEZE},CgsAirLine3D.prototype.restart=function(){this.stop(),this.start(),this.state=CgsAirLine3D.STATE_RESTART,this.finishFlag=!1},CgsAirLine3D.prototype.getState=function(){return this.state},CgsAirLine3D.prototype.isFinish=function(){return this.finishFlag},CgsAirLine3D.prototype.getPassedPath=function(){return this.passedPath},CgsAirLine3D.prototype.speedUp=function(){this.deltaTime+=this.deltaInterval},CgsAirLine3D.prototype.speedDown=function(){this.deltaTime-=this.deltaInterval,this.deltaTime<=this.deltaInterval&&(this.deltaTime=this.deltaInterval)},CgsAirLine3D.prototype.setPassedRate=function(e){1<=e?e=1:e<=0&&(e=0),this.finishFlag&&this.restart(),this.curTime=e*this.totalTime},CgsAirLine3D.prototype.getPassedRate=function(){return this.curTime/this.totalTime},CgsAirLine3D.prototype.addTailFire=function(e){this.tailFire=e},CgsAirLine3D.prototype.addRibbon=function(e){this.ribbon=e},CgsAirLine3D.prototype.addSlope=function(e){this.slope=e},CgsAirLine3D.prototype.getMultiplier=function(){return this.multiplier},CgsAirLine3D.prototype.setMultiplier=function(e){this.multiplier=e,this.deltaInterval=50*this.multiplier},CgsAirLine3D.prototype.getOrbitMotionFlag=function(){return this.orbitMotionFlag},CgsAirLine3D.prototype.setOrbitMotionFlag=function(e){this.orbitMotionFlag=e},CgsAirLine3D.prototype.addRadar=function(e){this.radar=e},CgsAirLine3D.prototype.addScanArea=function(e){this.map.addFeature(e),this.scanArea=e},CgsAirLine3D.prototype.setIntervalTime=function(e){this.curTime=e},CgsAirLine3D.prototype.getIntervalTime=function(){return this.curTime},CgsAirLine3D.prototype.dispose=function(){this.lineEntity&&this.map.map3D.removeFeature(this.lineEntity),this.passLineEntity&&this.map.map3D.removeFeature(this.passLineEntity),this.model&&this.map.removeFeature(this.model),this.mark&&this.map.removeFeature(this.mark),this.ribbon&&this.map.removeFeature(this.ribbon),this.slope&&this.map.removeFeature(this.slope),this.radar&&this.map.removeFeature(this.radar),this.scanArea&&this.map.removeFeature(this.scanArea)},CgsAirLine3D.STATE_START=0,CgsAirLine3D.STATE_FREEZE=1,CgsAirLine3D.STATE_UNFREEZE=2,CgsAirLine3D.STATE_RESTART=3,CgsAirLine3D.STATE_STOP=4,CgsNavigation3D=function(e){this.rotateRate3D=.001,this.moveRate2D=.01;var t=document.createElement("div");t.setAttribute("id","navigationDiv"),e||t.setAttribute("class","navigation_group");var i=document.createElement("div");i.setAttribute("class","navigation_pie");var s=document.createElement("div");s.setAttribute("class","navigation_home"),s.setAttribute("title","复位");var o=document.createElement("div");o.setAttribute("class","navigation_up"),o.setAttribute("title","上旋");var a=document.createElement("div");a.setAttribute("class","navigation_right normal"),a.setAttribute("title","右旋");var n=document.createElement("div");n.setAttribute("class","navigation_down"),n.setAttribute("title","下旋");var r=document.createElement("div");r.setAttribute("class","navigation_left"),r.setAttribute("title","左旋"),t.appendChild(i),t.appendChild(s),t.appendChild(o),t.appendChild(a),t.appendChild(n),t.appendChild(r);var l=null;this.setMap=function(e){(l=e).container.appendChild(t)};var u=0;s.onmouseover=function(){s.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/middle_hover.png')"},s.onmouseout=function(){s.style.background=""};var p=document.createElement("input");p.setAttribute("class","navigation_range"),p.setAttribute("class","navigation_input");var h=50;p.type="range",p.max=h,p.min=0,p.value=h/2,p.step=1,p.zIndex=0,s.onmousedown=function(){S(),l&&l.flyHome(2),s.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/middle_select.png')",u=setInterval(function(){p.value=h/2,clearInterval(u),u=0},100)},s.onmouseup=function(){s.style.background=""};var c=null,g=null,d=null,m=null,f=null,C=null,y=null,v=null,b=null,D=null;function S(){c&&(clearInterval(c),c=0,r.style.background=""),g&&(clearInterval(g),g=0,a.style.background=""),d&&(clearInterval(d),d=0,o.style.background=""),m&&(clearInterval(m),m=0,n.style.background=""),f&&clearInterval(f),C&&clearInterval(C),y&&clearInterval(y),l&&(l.camera.constrainedAxis=void 0)}o.onmouseover=function(){d||(o.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/up_hover.png')")},o.onmouseout=function(){d||(o.style.background="")},o.onmousedown=function(){S(),d=setInterval(function(){var e;l&&(l.scene.mode==Cesium.SceneMode.SCENE3D?(l.camera.constrainedAxis=l.camera.up,l.camera.rotateDown(.001)):(e=l.scene.globe.ellipsoid.cartesianToCartographic(l.camera.position).height/100,l.camera.moveDown(e)))},20),o.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/up_select.png')"},o.ondblclick=function(){S(),d=setInterval(function(){var e;l&&(l.scene.mode==Cesium.SceneMode.SCENE3D?(l.camera.constrainedAxis=l.camera.up,l.camera.rotateDown(.001)):(e=l.scene.globe.ellipsoid.cartesianToCartographic(l.camera.position).height/100,l.camera.moveDown(e)))},20),o.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/up_select.png')"},o.onmouseup=function(){S(),l&&(l.camera.constrainedAxis=void 0),o.style.background=""},a.onmouseover=function(){g||(a.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/right_hover.png')")},a.onmouseout=function(){g||(a.style.background="")},a.onmousedown=function(){S(),g=setInterval(function(){var e;l&&(l.scene.mode==Cesium.SceneMode.SCENE3D?(l.camera.constrainedAxis=l.camera.up,l.camera.rotateRight(.001)):(e=l.scene.globe.ellipsoid.cartesianToCartographic(l.camera.position).height/100,l.camera.moveRight(e)))},20),a.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/right_select.png')"},a.ondblclick=function(){S(),g=setInterval(function(){var e;l&&(l.scene.mode==Cesium.SceneMode.SCENE3D?(l.camera.constrainedAxis=l.camera.up,l.camera.rotateRight(.001)):(e=l.scene.globe.ellipsoid.cartesianToCartographic(l.camera.position).height/100,l.camera.moveRight(e)))},20),a.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/right_select.png')"},a.onmouseup=function(){S(),l.camera.constrainedAxis=void 0,a.style.background=""},n.onmouseover=function(){m||(n.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/down_hover.png')")},n.onmouseout=function(){m||(n.style.background="")},n.onmousedown=function(){S(),m=setInterval(function(){var e;l&&(l.scene.mode==Cesium.SceneMode.SCENE3D?(l.camera.constrainedAxis=l.camera.up,l.camera.rotateUp(.001)):(e=l.scene.globe.ellipsoid.cartesianToCartographic(l.camera.position).height/100,l.camera.moveUp(e)))},20),n.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/down_select.png')"},n.ondblclick=function(){S(),m=setInterval(function(){var e;l&&(l.scene.mode==Cesium.SceneMode.SCENE3D?(l.camera.constrainedAxis=l.camera.up,l.camera.rotateUp(.001)):(e=l.scene.globe.ellipsoid.cartesianToCartographic(l.camera.position).height/100,l.camera.moveUp(e)))},20),n.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/down_select.png')"},n.onmouseup=function(){m&&(clearInterval(m),l.camera.constrainedAxis=void 0),n.style.background=""},r.onmouseover=function(){c||(r.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/left_hover.png')")},r.onmouseout=function(){c||(r.style.background="")},r.onmousedown=function(){S(),c=setInterval(function(){var e;l&&(l.scene.mode==Cesium.SceneMode.SCENE3D?(l.camera.constrainedAxis=l.camera.up,l.camera.rotateLeft(.001)):(e=l.scene.globe.ellipsoid.cartesianToCartographic(l.camera.position).height/100,l.camera.moveLeft(e)))},20),r.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/left_select.png')"},r.ondblclick=function(){S(),c=setInterval(function(){var e;l&&(l.scene.mode==Cesium.SceneMode.SCENE3D?(l.camera.constrainedAxis=l.camera.up,l.camera.rotateLeft(.001)):(e=l.scene.globe.ellipsoid.cartesianToCartographic(l.camera.position).height/100,l.camera.moveLeft(e)))},20),r.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/left_select.png')"},r.onmouseup=function(){c&&(clearInterval(c),l.camera.constrainedAxis=void 0),r.style.background=""};var _=document.createElement("div");_.setAttribute("class","navigation_panzoomBar");var w=document.createElement("div");w.setAttribute("class","navigation_zoomin");var P=document.createElement("div");P.setAttribute("class","navigation_zoominImage");var T=document.createElement("div");T.setAttribute("class","navigation_zoomin_plus"),document.createElement("div").setAttribute("class","navigation_zoombar");var M=document.createElement("div");M.setAttribute("class","navigation_zoomout");var L=document.createElement("div");L.setAttribute("class","navigation_zoomoutImage");var x=document.createElement("div");x.setAttribute("class","navigation_zoomout_minus"),t.appendChild(_),_.appendChild(w),w.appendChild(P),w.appendChild(T),_.appendChild(M),M.appendChild(L),M.appendChild(x),t.appendChild(p);var E=!1,A=10,I=0;p.onmousemove=function(){var e,t;E&&l&&(I=I||l.getHeight(),e=p.value,(t=I+I/h*(e-h/2))<A&&(t=A),l.setHeight(t))},p.onmousedown=function(){l&&(v&&(clearInterval(v),v=0),v=setInterval(function(){I=I||l.getHeight();var e=p.value,t=I+I/h*(e-h/2);t<A&&(t=A),l.setHeight(t),clearInterval(v),v=0},20),E=!0)},p.onmouseup=function(){v=setInterval(function(){p.value=h/2,v&&clearInterval(v)},20),I=0,E=!1},p.onmouseleave=function(){v&&(clearInterval(v),v=0),v=setInterval(function(){p.value=h/2,clearInterval(v),v=0},20),I=0,E=!1};var F=0,k=0,R=!1,O=0,V=0;w.onmousedown=function(){var e;T.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/plus_select.png')",l&&(R=!0,I=I||l.getHeight(),F=F||new Date,e=new Date,F&&e&&(e.getTime()-F.getTime()<=200?(k+=1,F=e):(F=0,k=1,I=l.getHeight())),f&&(clearInterval(f),I=k=V=f=0),f=setInterval(function(){!function(e){if(0==p.value)return;var t=e+e/h*-k;t<A&&(t=A);l.setHeight(t),0<p.value&&(p.value=parseInt(p.value)-1)}(I),k+=1,V=parseInt(V)+1},50))},w.onmouseup=function(){T.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/plus_hover.png')",f&&(clearInterval(f),I=k=V=f=0),D&&(clearInterval(D),D=0),R=!1,O=0,D=setInterval(function(){R||(O+=1),200<20*O&&(p.value=h/2,O=0,clearInterval(D),D=0)},20)},w.onmouseout=function(){T.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/plus_hover.png')",f&&(clearInterval(f),I=k=V=f=0),D&&(clearInterval(D),D=0),R=!1,D=setInterval(function(){p.value=h/2,O=0,clearInterval(D),D=0},20)};var G=0,B=0,H=!1,N=0,W=0;M.onmousedown=function(){var e;x.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/minus_select.png')",l&&(mouseoutDownFlag=!0,I=I||l.getHeight(),G=G||new Date,e=new Date,G&&e&&(e.getTime()-G.getTime()<=200?(B+=1,G=e):(G=0,B=1,I=l.getHeight())),C&&(clearInterval(C),I=B=W=C=0),C=setInterval(function(){!function(e){if(p.value==h)return;var t=e+e/h*B;t<A&&(t=A);l.setHeight(t),0<p.value&&(p.value=parseInt(p.value)+1)}(I),B+=1,W=parseInt(W)+1},50))},M.onmouseup=function(){x.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/minus_hover.png')",C&&(clearInterval(C),I=B=W=C=0),b&&(clearInterval(b),b=0),H=!1,N=0,b=setInterval(function(){H||(N+=1),300<20*N&&(p.value=h/2,N=0,clearInterval(b),b=0)},20)},M.onmouseout=function(){x.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/minus_hover.png')",C&&(clearInterval(C),I=B=W=C=0),b&&(clearInterval(b),b=0),H=!1,b=setInterval(function(){p.value=h/2,N=0,clearInterval(b),b=0},20)},this.show=function(){t.style.visibility="visible"},this.hide=function(){t.style.visibility="hidden"},this.getRotate3D=function(){return this.zoomRotate3D},this.setRotate3D=function(e){this.zoomRotate3D=e},this.getMoveRate2D=function(){return this.moveRate2D},this.setMoveRate2D=function(e){this.moveRate2D=e}},CgsSampleNavigation3D=function(e){this.rotateRate3D=.001,this.moveRate2D=.01;var t=document.createElement("div");t.setAttribute("id","navigationDiv"),e=e||{},t.setAttribute("class","navigation_group");var i=document.createElement("div");i.setAttribute("class","navigation_pie");var s=document.createElement("div");s.setAttribute("class","navigation_home"),s.setAttribute("title","复位");var o=document.createElement("div");o.setAttribute("class","navigation_up"),o.setAttribute("title","上旋");var a=document.createElement("div");a.setAttribute("class","navigation_right normal"),a.setAttribute("title","右旋");var n=document.createElement("div");n.setAttribute("class","navigation_down"),n.setAttribute("title","下旋");var r=document.createElement("div");r.setAttribute("class","navigation_left"),r.setAttribute("title","左旋"),t.appendChild(i),t.appendChild(s),t.appendChild(o),t.appendChild(a),t.appendChild(n),t.appendChild(r);var l=Cesium.defaultValue(e.minHeight,1500),u=Cesium.defaultValue(e.maxHeight,96e5),p=0;s.onmouseover=function(){s.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/middle_hover.png')"},s.onmouseout=function(){s.style.background=""};var h=document.createElement("input");h.setAttribute("class","navigation_range"),h.setAttribute("class","navigation_input");var c=u;h.type="range",h.max=c,h.min=l,h.value=l,h.step=1,h.zIndex=0;var g=null;this.setMap=function(e){(g=e).container.appendChild(t),e.setMinHeight(l),e.setMaxHeight(u),h.value=e.camInitInfo.position.height},s.onmousedown=function(){P(),g&&g.flyHome(2),s.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/middle_select.png')",p=setInterval(function(){h.value=g.camInitInfo.position.height,clearInterval(p),p=0},100)},s.onmouseup=function(){s.style.background=""};var d=null,m=null,f=null,C=null,y=null,v=null,b=null,D=null,S=null,_=null,w=!1;function P(){d&&(clearInterval(d),d=0,r.style.background=""),m&&(clearInterval(m),m=0,a.style.background=""),f&&(clearInterval(f),f=0,o.style.background=""),C&&(clearInterval(C),C=0,n.style.background=""),y&&clearInterval(y),v&&clearInterval(v),b&&clearInterval(b),g&&(g.camera.constrainedAxis=void 0),w=!1}o.onmouseover=function(){f||(o.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/up_hover.png')")},o.onmouseout=function(){w||P(),f||(o.style.background="")},o.onmousedown=function(){P(),f=setInterval(function(){var e;g&&(g.scene.mode==Cesium.SceneMode.SCENE3D?(g.camera.constrainedAxis=g.camera.up,g.camera.rotateDown(.001)):(e=g.scene.globe.ellipsoid.cartesianToCartographic(g.camera.position).height/100,g.camera.moveDown(e)))},20),o.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/up_select.png')"},o.ondblclick=function(){P(),w=!0,f=setInterval(function(){var e;g&&(g.scene.mode==Cesium.SceneMode.SCENE3D?(g.camera.constrainedAxis=g.camera.up,g.camera.rotateDown(.001)):(e=g.scene.globe.ellipsoid.cartesianToCartographic(g.camera.position).height/100,g.camera.moveDown(e)))},20),o.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/up_select.png')"},o.onmouseup=function(){P(),g&&(g.camera.constrainedAxis=void 0),o.style.background=""},a.onmouseover=function(){m||(a.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/right_hover.png')")},a.onmouseout=function(){w||P(),m||(a.style.background="")},a.onmousedown=function(){P(),m=setInterval(function(){var e;g&&(g.scene.mode==Cesium.SceneMode.SCENE3D?(g.camera.constrainedAxis=g.camera.up,g.camera.rotateRight(.001)):(e=g.scene.globe.ellipsoid.cartesianToCartographic(g.camera.position).height/100,g.camera.moveRight(e)))},20),a.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/right_select.png')"},a.ondblclick=function(){P(),w=!0,m=setInterval(function(){var e;g&&(g.scene.mode==Cesium.SceneMode.SCENE3D?(g.camera.constrainedAxis=g.camera.up,g.camera.rotateRight(.001)):(e=g.scene.globe.ellipsoid.cartesianToCartographic(g.camera.position).height/100,g.camera.moveRight(e)))},20),a.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/right_select.png')"},a.onmouseup=function(){P(),g.camera.constrainedAxis=void 0,a.style.background=""},n.onmouseover=function(){C||(n.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/down_hover.png')")},n.onmouseout=function(){w||P(),C||(n.style.background="")},n.onmousedown=function(){P(),C=setInterval(function(){var e;g&&(g.scene.mode==Cesium.SceneMode.SCENE3D?(g.camera.constrainedAxis=g.camera.up,g.camera.rotateUp(.001)):(e=g.scene.globe.ellipsoid.cartesianToCartographic(g.camera.position).height/100,g.camera.moveUp(e)))},20),n.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/down_select.png')"},n.ondblclick=function(){P(),w=!0,C=setInterval(function(){var e;g&&(g.scene.mode==Cesium.SceneMode.SCENE3D?(g.camera.constrainedAxis=g.camera.up,g.camera.rotateUp(.001)):(e=g.scene.globe.ellipsoid.cartesianToCartographic(g.camera.position).height/100,g.camera.moveUp(e)))},20),n.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/down_select.png')"},n.onmouseup=function(){C&&(clearInterval(C),g.camera.constrainedAxis=void 0),n.style.background=""},r.onmouseover=function(){d||(r.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/left_hover.png')")},r.onmouseout=function(){w||P(),d||(r.style.background="")},r.onmousedown=function(){P(),d=setInterval(function(){var e;g&&(g.scene.mode==Cesium.SceneMode.SCENE3D?(g.camera.constrainedAxis=g.camera.up,g.camera.rotateLeft(.001)):(e=g.scene.globe.ellipsoid.cartesianToCartographic(g.camera.position).height/100,g.camera.moveLeft(e)))},20),r.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/left_select.png')"},r.ondblclick=function(){P(),w=!0,d=setInterval(function(){var e;g&&(g.scene.mode==Cesium.SceneMode.SCENE3D?(g.camera.constrainedAxis=g.camera.up,g.camera.rotateLeft(.001)):(e=g.scene.globe.ellipsoid.cartesianToCartographic(g.camera.position).height/100,g.camera.moveLeft(e)))},20),r.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/left_select.png')"},r.onmouseup=function(){d&&(clearInterval(d),g.camera.constrainedAxis=void 0),r.style.background=""};var T=document.createElement("div");T.setAttribute("class","navigation_panzoomBar");var M=document.createElement("div");M.setAttribute("class","navigation_zoomin");var L=document.createElement("div");L.setAttribute("class","navigation_zoominImage");var x=document.createElement("div");x.setAttribute("class","navigation_zoomin_plus"),document.createElement("div").setAttribute("class","navigation_zoombar");var E=document.createElement("div");E.setAttribute("class","navigation_zoomout");var A=document.createElement("div");A.setAttribute("class","navigation_zoomoutImage");var I=document.createElement("div");I.setAttribute("class","navigation_zoomout_minus"),t.appendChild(T),T.appendChild(M),M.appendChild(L),M.appendChild(x),T.appendChild(E),E.appendChild(A),E.appendChild(I),t.appendChild(h);var F=!1;h.onmousemove=function(){var e;F&&g&&(e=h.value,g.setHeight(parseInt(e)))},h.onmousedown=function(){g&&(D&&(clearInterval(D),D=0),D=setInterval(function(){var e=h.value;g.setHeight(parseInt(e)),clearInterval(D),D=0},20),F=!0)},h.onmouseup=function(){F=!1},h.onmouseleave=function(){D&&(clearInterval(D),D=0),F=!1};var k=0,R=0,O=!1,V=0,G=0;M.onmousedown=function(){var e;x.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/plus_select.png')",g&&(O=!0,k=k||new Date,e=new Date,k&&e&&(e.getTime()-k.getTime()<=200?(R+=1e3,k=e):(k=0,R=1e3)),y&&(clearInterval(y),R=G=y=0),y=setInterval(function(){!function(e){if(parseInt(h.value)==l)return;var t=g.getHeight()-e;t<l&&(t=l);g.setHeight(t),h.value=t}(R),R+=1e3,G=parseInt(G)+1},50))},M.onmouseup=function(){x.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/plus_hover.png')",y&&(clearInterval(y),R=G=y=0),_&&(clearInterval(_),_=0),O=!1,V=0,_=setInterval(function(){O||(V+=1),200<20*V&&(V=0,clearInterval(_),_=0)},20)},M.onmouseout=function(){x.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/plus_hover.png')",y&&(clearInterval(y),R=G=y=0),_&&(clearInterval(_),_=0),O=!1,_=setInterval(function(){V=0,clearInterval(_),_=0},20)};var B=0,H=0,N=!1,W=0,z=0;E.onmousedown=function(){var e;I.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/minus_select.png')",g&&(mouseoutDownFlag=!0,B=B||new Date,e=new Date,B&&e&&(e.getTime()-B.getTime()<=500?(H+=1e3,B=e):(B=0,H=1e3)),v&&(clearInterval(v),H=z=v=0),v=setInterval(function(){!function(e){if(parseInt(h.value)==c)return;var t=g.getHeight()+e;u<t&&(t=u);g.setHeight(t),h.value=t}(H),H+=1e3,z=parseInt(z)+1},50))},E.onmouseup=function(){I.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/minus_hover.png')",v&&(clearInterval(v),H=z=v=0),S&&(clearInterval(S),S=0),N=!1,W=0,S=setInterval(function(){N||(W+=1),300<20*W&&(W=0,clearInterval(S),S=0)},20)},E.onmouseout=function(){I.style.background="url('"+CGS_SDK_PATH+"/assets/image/scale/minus_hover.png')",v&&(clearInterval(v),H=z=v=0),S&&(clearInterval(S),S=0),N=!1,S=setInterval(function(){W=0,clearInterval(S),S=0},20)},CgsSubPub.subscribe("compassUpDate",function(e){var t;g&&(t=g.getHeight(),h.value=t)}),this.show=function(){t.style.visibility="visible"},this.hide=function(){t.style.visibility="hidden"},this.getRotate3D=function(){return this.zoomRotate3D},this.setRotate3D=function(e){this.zoomRotate3D=e},this.getMoveRate2D=function(){return this.moveRate2D},this.setMoveRate2D=function(e){this.moveRate2D=e}},CgsDashLine3D=function(e){var t;null!=e.positions&&(this.evenColor=Cesium.defaultValue(e.evenColor,"rgba(255.0,255.0,0.0,0.8)"),this.oddColor=Cesium.defaultValue(e.oddColor,"rgba(255.0,255.0,0.0,0.0)"),this.dashLength=Cesium.defaultValue(e.dashLength||e.pixelSize,16),this.dashPattern=Cesium.defaultValue(e.dashPattern,"0000000011111111"),null==(t=e).lineType&&(t.lineType=CgsLine3D.LINT_DASHED),CgsLine3D.call(this,t),this.entity.polyline.material=new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.fromCssColorString(this.evenColor),gapColor:Cesium.Color.fromCssColorString(this.oddColor),dashLength:this.dashLength,dashPattern:parseInt(this.dashPattern,2)}))},CgsInherits(CgsDashLine3D,CgsLine3D),CgsDashLine3D.prototype.setFillColor=function(e){this.evenColor=e,this.entity.polyline.material.color=Cesium.Color.fromCssColorString(e)},CgsDashLine3D.prototype.getFillColor=function(){return this.evenColor},CgsDashLine3D.prototype.setOddColor=function(e){this.oddColor=e,this.entity.polyline.material.gapColor=Cesium.Color.fromCssColorString(e)},CgsDashLine3D.prototype.getOddColor=function(){return this.oddColor},CgsDashLine3D.prototype.setDashLength=function(e){this.dashLength=e,this.entity.polyline.material.dashLength=e},CgsDashLine3D.prototype.getDashLength=function(){return this.dashLength},CgsDashLine3D.prototype.setDashPattern=function(e){this.dashPattern=e,this.entity.polyline.material.dashPattern=parseInt(e,2)},CgsDashLine3D.prototype.getDashPattern=function(){return this.dashPattern},CgsLineAnimation3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t,b,D,S,_,w=this;null!=e.positions&&(this.totalTime=Cesium.defaultValue(e.totalTime,5e3),this.loop=Cesium.defaultValue(e.loop,!0),this.reverse=Cesium.defaultValue(e.reverse,!1),this.interpolation=Cesium.defaultValue(e.interpolation,CgsLineAnimation3D.LINEER_INTER),this.finish=!1,t={},null==(t=e).lineType&&(t.lineType=CgsLine3D.LINT_TYPE_1),this.viewer=void 0,CgsLine3D.call(this,t),(b=this.getEntity())&&(D=[],S=0,this.start=null,e.positions,_=0,this.startAnimation=function(){this.posProperty=null;var i=this.getPosition(),e=this.getTotalTime();this.finish=!1,this.start=new Date,this.posProperty=new Cesium.SampledPositionProperty;var s=[],o=[],a=this.posProperty;!function(e){var t=!1;3==e[0].length&&(t=!0),(D=[]).push(S=0);for(var i=0;i<e.length-1;++i){var s=e[i],o=e[i+1],a=void 0,n=void 0,n=t?(a=Cesium.Cartesian3.fromDegrees(s[0],s[1],s[2]),Cesium.Cartesian3.fromDegrees(o[0],o[1],o[2])):(a=Cesium.Cartesian3.fromDegrees(s[0],s[1]),Cesium.Cartesian3.fromDegrees(o[0],o[1])),r=Cesium.Cartesian3.distance(a,n);S+=r,D.push(S)}}(i);for(var n=null,t=!1,r=0;r<i.length;++r){3==i[r].length&&(t=!0),n=new Date;var l=this.start.getTime()+e*(D[r]/S);n.setTime(l),s.push(l);var u=null,u=t?Cesium.Cartesian3.fromDegrees(i[r][0],i[r][1],i[r][2]):Cesium.Cartesian3.fromDegrees(i[r][0],i[r][1]);this.posProperty.addSample(Cesium.JulianDate.fromDate(n),u),o.push(u)}var p=null,p=t?Cesium.Cartesian3.fromDegrees(i[0][0],i[0][1],i[0][2]):Cesium.Cartesian3.fromDegrees(i[0][0],i[0][1],0);this.interpolation==CgsLineAnimation3D.HERMITE_INTER?a.setInterpolationOptions({interpolationDegree:2,interpolationAlgorithm:Cesium.HermitePolynomialApproximation}):this.interpolation==CgsLineAnimation3D.LAGRANGE_INTER?a.setInterpolationOptions({interpolationDegree:5,interpolationAlgorithm:Cesium.LagrangePolynomialApproximation}):a.setInterpolationOptions({interpolationDegree:1,interpolationAlgorithm:Cesium.LinearApproximation});var h=this.start,c=this.start,g=this.start,d=[p,p],m=[];m.push(o[0]),b.polyline.positions=new Cesium.CallbackProperty(function(){return d},!1);var f=0,C=!1,y=!1;g.setTime(s[f]);var v=w.getReverse();_=setInterval(function(){if(c<=n){var e=c.getTime();if(v&&y)if(e<=s[f]&&0<f&&(m.pop(),f--,this.interpolation==CgsLineAnimation3D.LINEER_INTER&&(C=!0)),C){for(r in d=[],m)d.push(m[r]);d.push(a.getValue(Cesium.JulianDate.fromDate(c))),C=!1}else this.interpolation==CgsLineAnimation3D.LINEER_INTER?(d.pop(),d.push(a.getValue(Cesium.JulianDate.fromDate(c)))):d.pop();else y||(e>s[f]&&f<i.length&&(m.push(o[f]),f++,this.interpolation==CgsLineAnimation3D.LINEER_INTER&&(C=!0),m.length>i.length&&m.pop()),C?(d=m,v||d.push(a.getValue(Cesium.JulianDate.fromDate(c))),C=!1):(this.interpolation==CgsLineAnimation3D.LINEER_INTER&&d.pop(),d.push(a.getValue(Cesium.JulianDate.fromDate(c)))))}else{var t=w.getLoop();v=w.getReverse(),doingFlag=!1,t?v&&!y?(y=!0,c.setTime(h.getTime()),m=[],m=o):(f=0,m=[],d=[p,p],c.setTime(s[0]),h.setTime(s[0])):(clearInterval(_),_=0,w.finish=!0,w.interpolation==CgsLineAnimation3D.LINEER_INTER&&(d=o),y=!1,b.polyline.positions=new Cesium.CallbackProperty(function(){return d},!0))}v&&y?(c.setTime(h.getTime()-10),c.getTime()<=s[0]&&(y=!1,d=[],c.setTime(s[0]),h.setTime(s[0]))):c.setTime(h.getTime()+10)},10)},this.close=function(){clearInterval(_)},this.setTotalTime=function(e){this.totalTime=e,_&&(this.close(),b.polyline.positions=new Cesium.CallbackProperty(function(){},!0)),this.startAnimation()},this.getTotalTime=function(){return this.totalTime},this.setLoop=function(e){this.loop=e,_||this.startAnimation()},this.getLoop=function(){return this.loop},this.setReverse=function(e){(this.reverse=e)&&this.setLoop(e)},this.getReverse=function(){return this.reverse},this.setInterpolation=function(e){this.interpolation=e,_&&(this.close(),b.polyline.positions=new Cesium.CallbackProperty(function(){},!0)),this.startAnimation()},this.getInterpolation=function(){return this.interpolation},this.getType=function(){return"LineAnimation"},this.getSelfType=function(){return"CgsLineAnimation"},this.isFinish=function(){return this.finish}))}),CgsInherits(CgsLineAnimation3D,CgsLine3D),CgsLineAnimation3D.LINEER_INTER=0,CgsLineAnimation3D.HERMITE_INTER=1,CgsLineAnimation3D.LAGRANGE_INTER=2,CgsViewInfo3D=function(m){var f,C;m&&(this.map=m,this.divGroup=void 0,this.createViewDiv(m),C=f="",CgsSubPub.subscribe("viewpoint",function(e,t,i){if(i){if(!m)return;var s=document.getElementById("viewpointDiv");if(!s)return;var o,a,n="",r="经&nbsp  纬&nbsp  度&nbsp &nbsp  ";Cesium.defined(t)?((o=m.pixelToLonLat([t.x,t.y]))?r+=o[0].toFixed(6)+"°&nbsp  "+o[1].toFixed(6)+"°":(a=-90,r+=(0).toFixed(6)+"°&nbsp  "+a.toFixed(6)+"°"),C=r):(C||(a=-90,r+=(0).toFixed(6)+"°&nbsp  "+a.toFixed(6)+"°",C=r),r=C),n+=r;var l="</br>相机高度&nbsp &nbsp  ",u=m.getHeight();n+=l+=1e3<u?(u/=1e3).toFixed(2)+"&nbsp km":u.toFixed(2)+"&nbsp m";var p,h,c,g,d="</br>当前高程&nbsp &nbsp  ";Cesium.defined(t)?(p=new Cesium.Cartesian2(t.x,t.y),(h=m.camera.pickEllipsoid(p,m.scene.globe.ellipsoid))?(c=m.scene.globe.ellipsoid.cartesianToCartographic(h),d+=((g=m.getTerrain())instanceof CgsTerrain3D||g instanceof CgsTileTerrain3D?c.height:Math.abs(c.height))<.1?(0).toFixed(2)+"&nbsp m":c.height.toFixed(2)+"&nbsp m"):d+=(0).toFixed(2)+"&nbsp m",f=d):(f||(d+=(0).toFixed(2)+"&nbsp m",f=d),d=f),n+=d,s.innerHTML=n}}))},CgsViewInfo3D.prototype.createViewDiv=function(s){var e=document.createElement("div");e.style.position="absolute",e.setAttribute("id","viewpointGroupDiv"),e.style.width="auto",e.style.height="auto",e.style.left="30px",e.style.bottom="80px";var t=document.createElement("div");t.setAttribute("id","viewpointDiv"),t.style.position="relative",t.style.color="rgba(255,255,255,1.0)",t.innerHTML="",t.style.bottom="0px",t.style.fontFamily="微软雅黑",t.style.fontSize="14px",t.style.lineHeight="1.5",e.appendChild(t);var o=document.createElement("div");o.setAttribute("id","viewlevelDiv"),o.style.position="relative",o.style.color="rgba(255,255,255,1.0)",o.innerHTML="",o.style.bottom="0px",o.style.fontFamily="微软雅黑",o.style.fontSize="14px",o.style.lineHeight="1.5",e.appendChild(o);var c=document.createElement("div");c.setAttribute("id","viewtimeDiv"),c.style.position="relative",c.style.color="rgba(255,255,255,1.0)",c.innerHTML="",c.style.bottom="0px",c.style.fontFamily="微软雅黑",c.style.fontSize="14px",c.style.lineHeight="1.5",e.appendChild(c),e.style.visibility="visible",s.container.appendChild(e);setInterval(function(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,s=e.getDate(),o=e.getHours(),a=e.getMinutes(),n=e.getSeconds(),r="",l="";r+=t+"-",r+=(i<10?"0":"")+i+"-",l+=(o<10?"0":"")+o,l+=(a<10?":0":":")+a;var u="",p="天文时间&nbsp &nbsp  ";u+=p+=(r+=(s<10?"0":"")+s)+" "+(l+=(n<10?":0":":")+n);var h="</br>作战时间&nbsp &nbsp  ";u+=h+=r+" "+l,c.innerHTML=u},1e3),CgsSubPub.subscribe("moveend3d",function(){for(var e="当前层级&nbsp &nbsp  ",t=s.getHeight(),i=0;i<22;i++)if(0==i){if(t>177497170/Math.pow(2,i)){e+=""+i;break}}else if(t>177497170/Math.pow(2,i)&&t<177497170/Math.pow(2,i-1)){e+=""+i;break}o.innerHTML=e})},CgsViewInfo3D.prototype.show=function(){this.divGroup.style.visibility="visible"},CgsViewInfo3D.prototype.hide=function(){this.divGroup.style.visibility="hidden"},CgsAerialView3D=function(l){var u,e,p,h,n;Cesium.defined(l)&&(this.divGroup=void 0,this._createViewDiv(l),(u=new Cesium.Viewer("aerialViewContainer",{contextOptions:{webgl:{preserveDrawingBuffer:!0},allowTextureFilterAnisotropic:!1},imageryProvider:new Cesium.SingleTileImageryProvider({url:CGS_SDK_PATH+"image/aerialView.png",rectangle:Cesium.Rectangle.fromDegrees(-180,-90,180,90)}),animation:!1,sceneMode:Cesium.SceneMode.SCENE2D,baseLayerPicker:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,timeline:!1,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1}))._cesiumWidget._creditContainer.style.display="none",u.camera.flyHome(0),u.scene.screenSpaceCameraController.enableInputs=!1,e={position:[104.99999999999999,24.803215726473667],url:CGS_SDK_PATH+"image/aerialMark.png",scale:1,positioning:"center-center"},p=new CgsMark3D(e),u.entities.add(p.getEntity()),h=!1,l.scene.globe.ellipsoid,l.canvas,n=l.scene,CgsSubPub.subscribe("aerialView",function(e){var t,i,s,o,a;h||((t=new Cesium.Ray).origin=l.camera.positionWC,t.direction=l.camera.directionWC,a=new Cesium.Cartesian3,a=n.globe.pick(t,n,a),Cesium.defined(a)&&(i=Cesium.Cartographic.fromCartesian(a),s=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),Cesium.defined(p)&&p.setPosition([s,o])))}),u.screenSpaceEventHandler.setInputAction(function(){},Cesium.ScreenSpaceEventType.LEFT_CLICK),u.screenSpaceEventHandler.setInputAction(function(){},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.divGroup.onclick=function(e){h=!0;var t=navigator.userAgent,i=null;-1<t.indexOf("Firefox")?i=new Cesium.Cartesian2(e.layerX,e.layerY):-1<t.indexOf("Chrome")&&(i=new Cesium.Cartesian2(e.offsetX,e.offsetY));var s,o,a,n,r=u.camera.pickEllipsoid(i,u.scene.globe.ellipsoid);r&&(s=Cesium.Cartographic.fromCartesian(r),o=Cesium.Math.toDegrees(s.longitude),a=Cesium.Math.toDegrees(s.latitude),p.setPosition([o,a]),Cesium.defined(l)&&(n=l.camera.positionCartographic,Cesium.Cartesian3.fromDegrees(o,a,n.height),l.flyTo({destination:[o,a,n.height],duration:3,completeCallback:function(){h=!1}})))},this.removeAll=function(){u.entities.removeAll()})},CgsAerialView3D.prototype._createViewDiv=function(e){var t=document.createElement("div");t.style.position="absolute",t.setAttribute("id","aerialViewGroupDiv"),t.style.width="366px",t.style.height="186px",t.style.right="5px",t.style.bottom="5px",t.style.border="1px solid #6a859c",t.style.backgroundColor="rgba(13,25,42,0.7)",t.style.zIndex="999999";var i=document.createElement("div");i.setAttribute("id","aerialViewContainer"),i.style.position="relative",i.style.color="rgba(255,255,255,1.0)",i.innerHTML="",i.style.top="2px",i.style.bottom="0px",i.style.left="2px",i.style.right="0px",i.style.width="360px",i.style.height="180px",i.style.border="1px solid rgba(105,122,141,0.9)",t.appendChild(i),t.style.visibility="visible",e.container.appendChild(t),this.divGroup=t},CgsAerialView3D.prototype.show=function(){this.divGroup.style.visibility="visible"},CgsAerialView3D.prototype.hide=function(){this.divGroup.style.visibility="hidden"},CgsManipulate3D=function(i){function e(e,t){return i.apply(this,arguments)}return e.toString=function(){return i.toString()},e}(function(s,e){var y,t,o,v,b,D,S,_,i,w,P,T,M,L,x,E,A,a,I,n,r,l,F,u,p;function h(e){switch(e){case" ":return y.indoorRoaming&&y.indoorRoaming.isIndoorRoaming()?void y.indoorRoaming.setNeedJump(!0):"home";case"V":case"v":return"manipulate";case"W":case"w":return"moveForward";case"S":case"s":return"moveBackward";case"A":case"a":return"moveLeft";case"D":case"d":return"moveRight";case"E":case"e":return y.indoorRoaming&&y.indoorRoaming.enterIndoorRoaming(),"undefined";case"R":case"r":return y.indoorRoaming&&y.indoorRoaming.leaveIndoorRoaming(),"undefined";case"F":case"f":return void(y._isFKeyDownDoing||(y._frameInfoDisplay=!y._frameInfoDisplay,y._frameInfoDisplay?y._showFrameInfo():y._hideFrameInfo(),y._isFKeyDownDoing=!0));default:return}}function k(e,t){return t=Cesium.Transforms.headingPitchRollQuaternion(e,new Cesium.HeadingPitchRoll(0,0,0),Cesium.Ellipsoid.WGS84,Cesium.Transforms.eastNorthUpToFixedFrame,t)}function c(e){var t=document.createElement("div");t.style.position="absolute",t.setAttribute("id","frameInfoGroupDiv"),t.style.width="auto",t.style.height="auto",t.style.left="1400px",t.style.top="600px",t.style.width="75px",t.style.height="44px",t.style.border="1px solid white",t.style.textAlign="right",t.style.visibility="hidden",t.style.display="none";var i=document.createElement("div");i.setAttribute("id","frameMSDiv"),i.style.position="relative",i.style.color="#daea32",i.innerHTML="",i.style.bottom="0px",i.style.fontFamily="微软雅黑",i.style.fontSize="14px",i.style.lineHeight="1.5",t.appendChild(i);var s=document.createElement("div");s.setAttribute("id","frameFPSDiv"),s.style.position="relative",s.style.color="#e52",s.innerHTML="",s.style.bottom="0px",s.style.fontFamily="微软雅黑",s.style.fontSize="14px",s.style.lineHeight="1.5",t.appendChild(s),e.container.appendChild(t),this.divFrameGroup=t}s&&(this.map=s,y=this,t=s.scene,v=e?(o=s.scene.allViewports[e-1].canvas,s.scene.allViewports[e-1].camera):(o=t._canvas0,t._camera0),this.viewIndex=e||0,b=void 0,D=new Cesium.BoundingSphere,this.selectModel=void 0,this.feature=void 0,this.lastFeature=void 0,this.manipulteType=CgsManipulate3D.MANIPULATE_TYPE_1,e||(this._lastFpsSampleTime=void 0,this._frameCount=0,this._time=void 0,this._fps=0,this._frameTime=0,this.divFrameGroup=void 0,c(s),this._frameInfoDisplay=!1,this._isFKeyDownDoing=!1),i=1,M=T=P=-30,x=200,L=_=S=0,w=90,A=E=0,this.aircraftCockpit=void 0,this.cockpitLoadingFinish=!1,a=new Cesium.BoundingSphere,I=new Cesium.Matrix4,this.indoorRoaming=void 0,n=this.trackMode=!1,r=!0,this.focusFlag=!0,o.onblur=function(){y.focusFlag=!1},o.onfocus=function(){y.focusFlag=!0},o.onmouseenter=function(){y.focusFlag=!0},o.onmouseleave=function(){y.focusFlag=!1},navigator.userAgent.match("Firefox")?o.onwheel=function(e){var t={x:e.layerX,y:e.layerY};CgsSubPub.publish("viewpoint",[t,s.isAddViewInfo])}:o.onmousewheel=function(e){var t={x:e.layerX,y:e.layerY};CgsSubPub.publish("viewpoint",[t,s.isAddViewInfo])},l=new Cesium.ScreenSpaceEventHandler(o),p=u=!(F={looking:!1,moveForward:!1,moveBackward:!1,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1,home:!1,manipulate:!1}),l.setInputAction(function(e){y.manipulteType!=CgsManipulate3D.MANIPULATE_TYPE_3&&y.manipulteType!=CgsManipulate3D.MANIPULATE_TYPE_2||e.position},Cesium.ScreenSpaceEventType.LEFT_DOWN),l.setInputAction(function(e){p=!1},Cesium.ScreenSpaceEventType.LEFT_UP),l.setInputAction(function(e){y.manipulteType!=CgsManipulate3D.MANIPULATE_TYPE_3&&y.manipulteType!=CgsManipulate3D.MANIPULATE_COCKPIT||(u=!0,e.position)},Cesium.ScreenSpaceEventType.RIGHT_DOWN),l.setInputAction(function(e){p=u=!1,A=E=0},Cesium.ScreenSpaceEventType.RIGHT_UP),l.setInputAction(function(e){var t,i;u&&(p=!0),p&&(e.endPosition.x,e.startPosition.x,t=e.endPosition.x-e.startPosition.x,t/=o.clientWidth,T+=500*t,E+=500*t,i=e.endPosition.y-e.startPosition.y,i/=o.clientHeight,89<=(A+=320*i)&&(A=89),A<=-89&&(A=-89),1e-5<=(M+=320*i)-90?M=90:M+90<=-1e-5&&(M=-90)),CgsSubPub.publish("viewpoint",[e.endPosition,s.isAddViewInfo])},Cesium.ScreenSpaceEventType.MOUSE_MOVE),l.setInputAction(function(e){0<e?y.manipulteType==CgsManipulate3D.MANIPULATE_TYPE_3&&(y.trackMode||L>=6*D.radius&&(L-=10)):y.manipulteType==CgsManipulate3D.MANIPULATE_TYPE_3&&(y.trackMode||L<=150*D.radius&&1200<=(L+=10)&&(L=1200))},Cesium.ScreenSpaceEventType.WHEEL),document.addEventListener("keydown",function(e){if(y.focusFlag){var t=h(e.key);if(void 0!==(void 0===t?"undefined":_typeof(t))&&(F[t]=!0,"manipulate"==t&&(F[t]=!1,b=void 0)),null==t&&y.manipulteType==CgsManipulate3D.MANIPULATE_TYPE_2)switch(e.keyCode){case 37:return void((S-=i)<-1e3&&(S=-1e3));case 38:return void(1e3<(_+=i)&&(_=1e3));case 39:return void(1e3<(S+=i)&&(S=1e3));case 40:return void((_-=i)<-1e3&&(_=-1e3))}}},!1),document.addEventListener("keyup",function(e){var t=h(e.key);void 0!==(void 0===t?"undefined":_typeof(t))&&"manipulate"!=t&&(F[t]=!1),document.getElementById("frameInfoGroupDiv")&&(y._isFKeyDownDoing=!1)},!1),new Cesium.Cartesian3,new Cesium.Cartographic,e||(t.preRender.addEventListener(function(){CgsSubPub.publish("preRender")}),t.postRender.addEventListener(function(){var e;y.aircraftCockpit&&!y.cockpitLoadingFinish&&(e=y.aircraftCockpit.getEntity(),y.map.dataSourceDisplay.getBoundingSphere(e,!1,a),0!==a.radius&&(y.cockpitLoadingFinish=!0)),y._frameInfoDisplay&&function(){if(!Cesium.defined(y._time))return y._lastFpsSampleTime=Cesium.getTimestamp(),y._time=Cesium.getTimestamp();var e=document.getElementById("frameFPSDiv"),t=document.getElementById("frameMSDiv"),i=y._time,s=Cesium.getTimestamp(),o=(y._time=s)-i;y._frameCount++;var a=y._fps,n=s-y._lastFpsSampleTime;1e3<n&&(a=1e3*y._frameCount/n|0,y._lastFpsSampleTime=s,y._frameCount=0),a!==this._fps&&(e.innerHTML=a+" FPS",y._fps=a),o!==y._frameTime&&(t.innerHTML=o.toFixed(2)+" MS",y._frameTime=o)}()}),this._showFrameInfo=function(){var e=document.getElementById("frameInfoGroupDiv");e?e.style.visibility="visible":c(y.map)},this._hideFrameInfo=function(){var e=document.getElementById("frameInfoGroupDiv");e&&(e.style.visibility="hidden")}),s.clock.onTick.addEventListener(function(e){s.camera;F.home&&y.focusFlag&&y.getManipulateType()==CgsManipulate3D.MANIPULATE_TYPE_1&&y.map.blankFlag&&(s.flyHome(),F.home=!1,function(){F.manipulate=!1,y.map.trackedEntity&&y.map.trackedEntity.owners?(y.map.trackedEntity.owners[y.viewIndex]&&(y.map.trackedEntity.owners[y.viewIndex]=void 0,y.map.trackedEntity.index--),0==y.map.trackedEntity.index&&(y.map.trackedEntity=void 0)):y.map.trackedEntity=void 0;y.feature&&(y.feature.setVisible(!0),this.feature&&this.feature.feature3D&&this.feature.feature3D.enableCockpitMode(!1));this.feature=void 0,this.manipulteType=CgsManipulate3D.MANIPULATE_TYPE_1,b=void 0,this.selectModel=void 0,_=S=0}()),CgsSubPub.publish("viewpoint"),F.manipulate&&function(){var e,t,i,s,o,a,n,r,l,u,p,h;if(y.selectModel||y.indoorRoaming)switch(y.getManipulateType()){case CgsManipulate3D.MANIPULATE_FREEDOM:return T=0,M=P,L=3*D.radius+x;case CgsManipulate3D.MANIPULATE_FIRST:return y.feature&&(g=y.feature.getPosition(),s=y.selectModel.orientation,b=Cesium.Cartesian3.fromDegrees(g[0],g[1],g[2]),o=s.getValue(Cesium.JulianDate.fromDate(new Date)),a=new Cesium.Quaternion,(a=k(b,a)).w=-a.w,n=new Cesium.Quaternion,n=Cesium.Quaternion.multiply(a,o,n),r=new Cesium.HeadingPitchRoll,r=Cesium.HeadingPitchRoll.fromQuaternion(n,r),m=Cesium.Math.toRadians(Cesium.Math.toDegrees(r.heading)+w),f=r.pitch,u=r.roll,e=Cesium.Transforms.eastNorthUpToFixedFrame(b),t=Cesium.Matrix4.fromTranslation(new Cesium.Cartesian3(S*D.radius,_*D.radius,0)),i=new Cesium.Matrix4,i=Cesium.Matrix4.multiply(e,t,i),h=new Cesium.Cartesian3(i[12],i[13],i[14]),v.setView({destination:h,orientation:{heading:m,pitch:f,roll:u}}),T=0,M=P,L=3*D.radius+x);case CgsManipulate3D.MANIPULATE_THIRD:return y.feature&&(g=y.feature.getPosition(),s=y.selectModel.orientation,b=Cesium.Cartesian3.fromDegrees(g[0],g[1],g[2]),o=s.getValue(Cesium.JulianDate.fromDate(new Date)),(a=k(b)).w=-a.w,n=new Cesium.Quaternion,n=Cesium.Quaternion.multiply(a,o,n),r=new Cesium.HeadingPitchRoll,r=Cesium.HeadingPitchRoll.fromQuaternion(n,r),m=Cesium.Math.toRadians((Cesium.Math.toDegrees(r.heading)+w)%360),1e-4<(l=Cesium.Math.toDegrees(r.pitch)+M)-90?l=89.9:l+90<1e-4&&(l=-89.9),f=Cesium.Math.toRadians(l),u=r.roll,Math.abs(m)<Cesium.Math.EPSILON5&&(m=0),Math.abs(u)<Cesium.Math.EPSILON5&&(u=0),m+=Cesium.Math.toRadians(T),p=L,h=Cesium.Cartesian3.fromDegrees(g[0],g[1],g[2]),C=Cesium.Transforms.eastNorthUpToFixedFrame(h),v.lookAtTransform(C,new Cesium.HeadingPitchRange(m,f,p)),v.lookAtTransform(Cesium.Matrix4.IDENTITY));case CgsManipulate3D.MANIPULATE_COCKPIT:if(y.aircraftCockpit){var c=y.aircraftCockpit.getRotation();if(!Cesium.defined(c))return;var g=y.feature.getPosition();y.feature.getPosition()[0]!==g[0]||y.feature.getPosition()[1]!==g[1]||y.feature.getPosition()[2]!==g[2]||(y.feature.getRotation()[0],c[0]);var d=Cesium.Cartesian3.fromDegrees(g[0],g[1],g[2]),m=Cesium.Math.toRadians(c[0]),f=Cesium.Math.toRadians(c[1]);m+=Cesium.Math.toRadians(E),f+=Cesium.Math.toRadians(A);var C=Cesium.Transforms.eastNorthUpToFixedFrame(d,Cesium.Ellipsoid.WGS84,I);C=Cesium.Matrix4.multiplyByTranslation(C,new Cesium.Cartesian3(0,0,.5),C),v.lookAtTransform(C,new Cesium.HeadingPitchRange(m,f,2)),v.lookAtTransform(Cesium.Matrix4.IDENTITY)}return;case CgsManipulate3D.MANIPULATE_INDOOR:y.indoorRoaming&&y.indoorRoaming.isIndoorRoaming()&&y.indoorRoaming.updateCameraWithModel(F)}}()}),this.setSelectFeature=function(e){if(Cesium.defined(e)&&e.feature3D&&(this.feature!=e.feature3D||e.sateline)){if("CgsModel"!=e.feature3D.getType())return"please select model";if(this.selectModel=e.feature3D.getEntity(),!Cesium.defined(this.selectModel))return void(this.feature=void 0);var t;this.feature&&this.feature.feature3D&&this.manipulteType===CgsManipulate3D.MANIPULATE_COCKPIT&&(this.feature.feature3D.setEnableCockpitMode&&this.feature.feature3D.setEnableCockpitMode(!1),this.lastFeature=this.feature,t=this,setTimeout(function(){t.lastFeature.setVisible(!0)},2500)),(this.feature=e).mobileObj&&(n=e.mobileObj.getHideModelFlag(),this.aircraftCockpit&&this.aircraftCockpit.setPosition(e.getPosition())),this.feature.feature3D.setEnableCockpitMode&&this.feature.feature3D.setEnableCockpitMode(!0),y.map.dataSourceDisplay.getBoundingSphere(this.selectModel,!1,D),0===D.radius&&(D.radius=10),L=3*D.radius+x}},this.getSelectModel=function(){return this.selectModel},this.setManipulateType=function(e){var t;this.manipulteType=e,y.feature||y.indoorRoaming?(e!=CgsManipulate3D.MANIPULATE_COCKPIT&&!y.indoorRoaming&&this.aircraftCockpit&&this.aircraftCockpit.setVisible(!1),e==CgsManipulate3D.MANIPULATE_FIRST?(y.map.trackedEntity&&y.map.trackedEntity.owners?(y.map.trackedEntity.owners[y.viewIndex]&&(y.map.trackedEntity.owners[y.viewIndex]=void 0,y.map.trackedEntity.index--),0==y.map.trackedEntity.index&&(y.map.trackedEntity=void 0)):y.map.trackedEntity=void 0,y.feature.setVisible(!1),F.manipulate=!0,_=S=0,y.feature.mobileObj&&y.feature.mobileObj.setHideModelFlag(!1)):e==CgsManipulate3D.MANIPULATE_THIRD?(y.feature.setVisible(!0),F.manipulate=!0,y.map.trackedEntity=y.selectModel,y.map.trackedEntity.owners?y.map.trackedEntity.owners[y.viewIndex]||(y.map.trackedEntity.owners[y.viewIndex]=y).map.trackedEntity.index++:(y.map.trackedEntity.owners=[],(y.map.trackedEntity.owners[y.viewIndex]=y).map.trackedEntity.index=1),M=T=P,y.feature.mobileObj&&y.feature.mobileObj.setHideModelFlag(n)):e==CgsManipulate3D.MANIPULATE_FREEDOM?(y.feature&&y.feature.setVisible(!0),F.manipulate=!1,y.map.trackedEntity&&y.map.trackedEntity.owners?(y.map.trackedEntity.owners[y.viewIndex]&&(y.map.trackedEntity.owners[y.viewIndex]=void 0,y.map.trackedEntity.index--),0==y.map.trackedEntity.index&&(y.map.trackedEntity=void 0)):y.map.trackedEntity=void 0,r&&(t=y.feature.getPosition(),y.map.flyTo({destination:[t[0],t[1],t[2]+5e3],rotation:[0,-89,0],duration:.5})),y.feature.mobileObj&&y.feature.mobileObj.setHideModelFlag(n)):e==CgsManipulate3D.MANIPULATE_COCKPIT?this.aircraftCockpit&&(this.aircraftCockpit.setVisible(!0),y.feature.mobileObj&&y.feature.mobileObj.setHideModelFlag(!1),y.map.trackedEntity=y.aircraftCockpit.getEntity(),y.map.trackedEntity.owners?y.map.trackedEntity.owners[y.viewIndex]||(y.map.trackedEntity.owners[y.viewIndex]=y).map.trackedEntity.index++:(y.map.trackedEntity.owners=[],(y.map.trackedEntity.owners[y.viewIndex]=y).map.trackedEntity.index=1),y.feature.setVisible(!1),F.manipulate=!0,y.feature&&y.feature.feature3D&&!y.feature.feature3D.getEnableCockpitMode()&&y.feature.feature3D.setEnableCockpitMode(!0),A=E=_=S=0):e==CgsManipulate3D.MANIPULATE_INDOOR&&(F.manipulate=!0,this.indoorCamHeading=0,this.indoorCamPitch=0)):console.log("feature undefined")},this.createAircraftCockpit=function(e){var t;this.aircraftCockpit||(t={visible:!0,dialVisible:!0,mapObject:this.map,url:e},this.aircraftCockpit=new CgsAircraftCockpit3D(t))},this.getManipulateType=function(){return this.manipulteType},this.setOffsetX=function(e){S=e},this.getOffsetX=function(){return S},this.setOffsetY=function(e){_=e},this.getOffsetY=function(){return _},this.setOffsetAmount=function(e){this.selectModel?D.radius<e&&(i=D.radius):i=e},this.getOffsetAmount=function(){return i},this.setOffsetHeading=function(e){T=e},this.getOffsetHeading=function(){return T},this.setOffsetPitch=function(e){M=e},this.getOffsetPitch=function(){return M},this.setOffsetHeight=function(e){L-=x,L+=e,x=e},this.getOffsetHeight=function(){return x},this.setLocateFlag=function(e){r=e},this.getLocateFlag=function(){return r},this.setModelOffsetHeading=function(e){w=e},this.getModelOffsetHeading=function(){return w})}),CgsManipulate3D.MANIPULATE_TYPE_1=1,CgsManipulate3D.MANIPULATE_TYPE_2=2,CgsManipulate3D.MANIPULATE_TYPE_3=3,CgsManipulate3D.MANIPULATE_TYPE_4=4,CgsManipulate3D.MANIPULATE_TYPE_5=5,CgsManipulate3D.MANIPULATE_FREEDOM=1,CgsManipulate3D.MANIPULATE_FIRST=2,CgsManipulate3D.MANIPULATE_THIRD=3,CgsManipulate3D.MANIPULATE_COCKPIT=4,CgsManipulate3D.MANIPULATE_INDOOR=5,CgsFlyLine3D=function(e){this.timer=null,this.selfType="CgsFlyLine",this.entities=[],null==e?(this.name="",this.positions=[[118,30,5e4],[120,32,5e4]],this.evenColor="rgba(255,255,255,1.0)",this.width=2,this.show=!0,this.followSurface=!0,this.time=3e3,this.saveFlag=!0):(this.name=void 0===e.name?"":e.name,this.positions=void 0===e.positions?[[118,30,5e4],[120,32,5e4]]:e.positions,this.evenColor=void 0===e.evenColor?"rgba(255,255,255,0.99)":e.evenColor,this.width=void 0===e.width?2:e.width,this.followSurface=void 0!==e.followSurface&&e.followSurface,this.show=void 0===e.show||e.show,this.time=void 0===e.time?3e3:e.time,this.saveFlag=void 0===e.saveFlag||e.saveFlag);var t=!1;if(2==this.positions.length){var i,s=this.positions,o=new Array;if("[object Array]"==Object.prototype.toString.call(s[0]))for(var a=0;a<s.length;a++){3==s[a].length&&(t=!0);for(var n=s[a],r=0;r<n.length;r++)o.push(n[r])}else o=s;i=t?new Cesium.CatmullRomSpline({times:[0,1],points:[Cesium.Cartesian3.fromDegrees(o[0],o[1],o[2]),Cesium.Cartesian3.fromDegrees(o[3],o[4],o[5])]}):new Cesium.CatmullRomSpline({times:[0,1],points:[Cesium.Cartesian3.fromDegrees(o[0],o[1],0),Cesium.Cartesian3.fromDegrees(o[2],o[3],0)]});for(var l=[],a=0;a<100;a++){var u=i.evaluate(a/100),p=Cesium.Cartographic.fromCartesian(u),h=[];h.push(180*p.longitude/Math.PI,180*p.latitude/Math.PI,p.height),l.push(h)}this.poslist=l}else this.poslist=e.positions,3==e.positions[0].length&&(t=!0);var c=Cesium.Color.fromCssColorString(this.evenColor);1==c.alpha&&(c.alpha=.99);var g={alpha:0,blue:1,green:1,red:1};g.alpha=.01,g.blue=c.blue,g.green=c.green,g.red=c.red;var d=[];this.pointsLength=30;var m=null;if(1==t){for(a=0;a<this.pointsLength;a++)d[3*a]=this.poslist[a][0],d[3*a+1]=this.poslist[a][1],d[3*a+2]=this.poslist[a][2];m=Cesium.Cartesian3.fromDegreesArrayHeights(d)}else{for(a=0;a<this.pointsLength;a++)d[2*a]=this.poslist[a][0],d[2*a+1]=this.poslist[a][1];m=Cesium.Cartesian3.fromDegreesArray(d)}for(a=0;a<this.pointsLength/2;a++){var f={name:this.name,show:this.show,polyline:{positions:[m[a],m[a+1]],followSurface:!1,width:this.width*(a/(this.pointsLength/2)),material:new Cesium.StripeMaterialProperty({evenColor:c,oddColor:g,repeat:1,orientation:Cesium.StripeOrientation.VERTICAL,offset:0})}};this.entities.push(new Cesium.Entity(f))}this.bflag=t,this.pos=d,this.type="flyline"},CgsInherits(CgsFlyLine3D,CgsFeature3D),CgsFlyLine3D.prototype.setPosition=function(e,t){var i=t;this.entities[e].polyline.positions=new Cesium.CallbackProperty(function(){var e=[i[0],i[1],i[2],i[3],i[4],i[5]];return Cesium.Cartesian3.fromDegreesArrayHeights(e)},!1)},CgsFlyLine3D.prototype.start=function(){var t=0,i=this,e=setInterval(function(){if(i.bflag)for(var e=0;e<i.pointsLength;e+=2)i.setPosition(e/2,[i.poslist[t+e/2][0],i.poslist[t+e/2][1],i.poslist[t+e/2][2],i.poslist[t+e/2+1][0],i.poslist[t+e/2+1][1],i.poslist[t+e/2+1][2]]);else for(e=0;e<i.pointsLength;e+=2)i.setPosition(e/2,[i.poslist[t+e/2][0],i.poslist[t+e/2][1],i.poslist[t+e/2+1][0],i.poslist[t+e/2+1][1]]);++t==i.poslist.length-i.pointsLength/2&&(t=0)},i.time/(i.poslist.length-i.pointsLength/2));i.timer=e},CgsFlyLine3D.prototype.getId=function(){if(this.entities&&0<this.entities.length)return this.entities[0].id},CgsFlyLine3D.prototype.getVisible=function(){if(this.entities&&0<this.entities.length)return this.entities[0].show},CgsFlyLine3D.prototype.getType=function(){return this.type},CgsFlyLine3D.prototype.getEvenColor=function(){return this.evenColor},CgsFlyLine3D.prototype.getFollowSurface=function(){return this.followSurface},CgsFlyLine3D.prototype.getWidth=function(){return this.width},CgsFlyLine3D.prototype.getVisible=function(){return this.show},CgsFlyLine3D.prototype.getTime=function(){return this.time},CgsFlyLine3D.prototype.getName=function(){return this.name},CgsFlyLine3D.prototype.getPosition=function(){return this.positions},CgsFlyLine3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsFlyLine3D.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsFlyLine3D.prototype.getSelfType=function(){return this.selfType},function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsCluster3D=t()}(window,function(){function e(e){var t=0<arguments.length&&void 0!==e?e:{};this.map=t.map.map3D;var i=new o("clusterData");this.map.dataSources.add(i),this.state={imageUrl:t.imageUrl,imageScale:t.imageScale||1,labelFont:t.labelFont||"16px sans-serif",labelColor:s.fromCssColorString(t.labelColor||"yellow"),pixelOffset:t.pixelOffset,clusterDataSource:i}}var t=Cesium,d=t.BillboardGraphics,m=t.Entity,s=t.Color,o=t.CustomDataSource,f=t.LabelGraphics,C=t.Cartesian3;return e.prototype.setData=function(e){var t=this.state.clusterDataSource.entities;t.removeAll();for(var i=this.state.imageUrl,s=this.state.imageScale,o=this.state.labelFont,a=this.state.labelColor,n=new C(0,0,-20),r=this.state.pixelOffset,l=0,u=e.length;l<u;l++){var p=e[l],h=p.center,c=p.length+"",g=new m({position:C.fromDegrees(h[0],h[1]),billboard:new d({image:i,scale:s}),label:new f({text:c,font:o,fillColor:a,eyeOffset:n,pixelOffset:r})});t.add(g)}},e.prototype.clearClusterd=function(){this.state.clusterDataSource.entities.removeAll()},e.prototype.destroy=function(){this.state.clusterDataSource&&this.map.dataSources.remove(this.state.clusterDataSource)},e}),CgsMeasure3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var S=e.map3D,_={type:e.type,points:[],entities:[],list:[],labelList:[],mode:e.mode,timeFlag:!1,currentLength:0};this.state=_,this._lineColor=Cesium.defaultValue(e.lineColor,"rgba(0.0,255.0,255.0,0.8)"),this._fillColor=Cesium.defaultValue(e.fillColor,"rgba(0.0,255.0,0.0,0.3)"),this._coverColor=Cesium.defaultValue(e.coverColor,"rgba(255.0,0.0,0.0,0.3)");var w=this;function t(e){var t=e.position.x,i=e.position.y,s=S.pixelToLonLat([t,i]);if(null!=s){var o,a,n,r,l,u,p,h,c,g,d,m,f=s[0],C=s[1];if(_.type==CgsMeasure3D.SHAPE_POINT){var y=new CgsPoint3D({position:s});_.list.push(y),S.addFeature(y)}else if(_.type!=CgsMeasure3D.SHAPE_CIRCLE)if(_.type==CgsMeasure3D.SHAPE_LINE)if(0==_.points.length)_.points.push(f),_.points.push(C),P(f,C,!1);else{var v,b,D=_.points.length;if(f==_.points[D-2]&&C==_.points[D-1])return;_.points.push(f),_.points.push(C),_.coordinates=Cesium.Cartesian3.fromDegreesArray(_.points),_.mode==CgsMeasure3D.MODE_LINE?(v=_.entities[0].getLabel(),b=T(!0),v.setText(b),v.setPosition([f,C]),v.setFontSize("16px"),P(f,C,!1)):P(f,C,!0)}else{_.type==CgsMeasure3D.SHAPE_RECTANGLE?0==_.points.length?_.points.push([f,C]):(o=M(_.points[0][0],_.points[0][1],f,C),_.coordinates=Cesium.Rectangle.fromDegrees(o[0][0],o[0][1],o[1][0],o[1][1]),_.entities[0].entity.rectangle.coordinates=_.coordinates,function(e){var t={area:0,vertexes:{NE:null,NW:null,SE:null,SW:null},lines:{NE_NW:0,NW_SW:0,SW_SE:0,SE_NE:0}},i=Cesium.Rectangle.southwest(e),s=Cesium.Rectangle.southeast(e),o=Cesium.Rectangle.northeast(e),a=Cesium.Rectangle.northwest(e);t.vertexes.NE={lat:Cesium.Math.toDegrees(o.latitude),lng:Cesium.Math.toDegrees(o.longitude)},t.vertexes.NW={lat:Cesium.Math.toDegrees(a.latitude),lng:Cesium.Math.toDegrees(a.longitude)},t.vertexes.SE={lat:Cesium.Math.toDegrees(s.latitude),lng:Cesium.Math.toDegrees(s.longitude)},t.vertexes.SW={lat:Cesium.Math.toDegrees(i.latitude),lng:Cesium.Math.toDegrees(i.longitude)},t.lines.NE_NW=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(t.vertexes.NE.lng,t.vertexes.NE.lat),Cesium.Cartesian3.fromDegrees(t.vertexes.NW.lng,t.vertexes.NW.lat)),t.lines.NW_SW=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(t.vertexes.NW.lng,t.vertexes.NW.lat),Cesium.Cartesian3.fromDegrees(t.vertexes.SW.lng,t.vertexes.SW.lat)),t.lines.SW_SE=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(t.vertexes.SW.lng,t.vertexes.SW.lat),Cesium.Cartesian3.fromDegrees(t.vertexes.SE.lng,t.vertexes.SE.lat)),t.lines.SE_NE=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(t.vertexes.SE.lng,t.vertexes.SE.lat),Cesium.Cartesian3.fromDegrees(t.vertexes.NE.lng,t.vertexes.NE.lat)),t.area=Math.round(t.lines.NE_NW*t.lines.NW_SW/1e6);var n=Cesium.Rectangle.center(e),r=Cesium.Math.toDegrees(n.latitude),l={position:[Cesium.Math.toDegrees(n.longitude),r],name:t.area+"km^2",fill:"rgba(255,255,0,1.0)",fontSize:"16px"},u=new CgsLabel3D(l);u.setSaveFlag(!1),S.addFeature(u),_.labelList.push(u)}(_.coordinates),_.points=[],_.entities=[]):_.type==CgsMeasure3D.SHAPE_POLYGON?_.points.push([t,i]):_.type==CgsMeasure3D.VISIBLE_LINE?0==_.points.length?(_.points.push(f),_.points.push(C),P(f,C,!1)):(2<_.points.length&&(_.points.pop(),_.points.pop()),_.points.push(f),_.points.push(C),P(f,C,!1),_.coordinates=Cesium.Cartesian3.fromDegreesArray(_.points),_.entities[0].entity.polyline.positions=_.coordinates,a=_.points[0],n=_.points[1],r=_.points[2],l=_.points[3],u=new Cesium.Cartesian3.fromDegrees(a,n),p=new Cesium.Cartesian3.fromDegrees(r,l),h={position:[a,n],radius:b=Cesium.Cartesian3.distance(u,p),fill:w._fillColor,outline:!1,name:" "},(c=new CgsCircle3D(h)).setSaveFlag(!1),S.addFeature(c),_.entities.push(c),_.list.push(c),b=w.distanceVisible([[_.points[0],_.points[1]],[_.points[2],_.points[3]]]),Cesium.defined(b)&&(d={name:1e3<b?(b/=1e3,parseFloat(b).toFixed(2)+" km"):parseFloat(b).toFixed(2)+" m",position:[(g=w.getVisibleLine())[1][0],g[1][1],g[1][2]],fontSize:"16px",pixelOffset:[-15,-15]},v=new CgsLabel3D(d),S.addFeature(v),_.entities.push(v),_.list.push(v),m={position:[g[1][0],g[1][1],g[1][2]],pixelSize:1},(y=new CgsPoint3D(m)).setSaveFlag(!1),S.addFeature(y),_.labelList.push(y)),_.points=[],_.entities=[],_.currentLength=0):_.type==CgsMeasure3D.VISIBLE_POLYGON&&(_.points.length,_.points.push(f),_.points.push(C),P(f,C,!1))}}}function i(e){var t,i,s,o,a,n,r,l=e.endPosition.x,u=e.endPosition.y,p=S.pixelToLonLat([l,u]);if(null!=p&&_.type!=CgsMeasure3D.SHAPE_CIRCLE)if(_.type==CgsMeasure3D.SHAPE_LINE){0!=_.points.length&&(h=p[0],c=p[1],_.points.push(h),_.points.push(c),_.coordinates=Cesium.Cartesian3.fromDegreesArray(_.points),0==_.entities.length?(a=_.points[0],n=_.points[1],(r=new CgsLine3D({positions:[[h,c],[a,n]],name:" "})).setSaveFlag(!1),S.addFeature(r),(d=r.getLabel()).setSaveFlag(!1),_.entities.push(r),_.list.push(r),_.entities[0].entity.polyline.positions=new Cesium.CallbackProperty(function(e,t){return _.coordinates},!1)):(d=_.entities[0].getLabel(),t=T(!1),d.setText(t),d.setPosition([h,c]),d.setFontSize("16px")),i=_.points.length,_.points.length=i-2)}else if(_.type==CgsMeasure3D.SHAPE_RECTANGLE){0!=_.points.length&&(h=p[0],c=p[1],s=M(a=_.points[0][0],n=_.points[0][1],h,c),_.coordinates=Cesium.Rectangle.fromDegrees(s[0][0],s[0][1],s[1][0],s[1][1]),0==_.entities.length?(o=new CgsRect3D({positions:s}),S.addFeature(o),_.entities.push(o),_.list.push(o)):_.entities[0].entity.rectangle.coordinates=new Cesium.CallbackProperty(function(e,t){return _.coordinates},!1))}else if(_.type==CgsMeasure3D.SHAPE_POLYGON)0!=_.points.length&&_.entities.length;else if(_.type==CgsMeasure3D.VISIBLE_LINE){0!=_.points.length&&(h=p[0],c=p[1],2<_.points.length&&(_.points.pop(),_.points.pop()),_.points.push(h),_.points.push(c),_.coordinates=Cesium.Cartesian3.fromDegreesArray(_.points),0==_.entities.length&&(a=_.points[0],n=_.points[1],(r=new CgsLine3D({positions:[[h,c],[a,n]],followSurface:!1,fill:w._lineColor,name:" "})).setSaveFlag(!1),S.addFeature(r),(d=r.getLabel()).setSaveFlag(!1),_.entities.push(r),_.list.push(r),_.entities[0].entity.polyline.positions=new Cesium.CallbackProperty(function(e,t){return _.coordinates},!1)))}else if(_.type==CgsMeasure3D.VISIBLE_POLYGON)if(4<_.points.length){var h=p[0],c=p[1];4<_.points.length&&(_.points.pop(),_.points.pop()),_.points.push(h),_.points.push(c);for(var g,d,m=[],f=0;f<_.points.length/2;++f){var C=[];C.push(_.points[2*f+0]),C.push(_.points[2*f+1]),m.push(C)}_.coordinates=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(_.points)),1==_.entities.length&&(_.entities[0].entity.polyline.positions=[],(g=new CgsPolygon3D({positions:m,fill:w._fillColor,name:" "})).setSaveFlag(!1),S.addFeature(g),(d=g.getLabel()).setSaveFlag(!1),_.entities.push(g),_.list.push(g),_.entities[1].entity.polygon.hierarchy=new Cesium.CallbackProperty(function(e,t){return _.coordinates},!1))}else{0<_.points.length&&(2<_.points.length&&(_.points.pop(),_.points.pop()),h=p[0],c=p[1],_.points.push(h),_.points.push(c),_.coordinates=Cesium.Cartesian3.fromDegreesArray(_.points)),0==_.entities.length&&(a=_.points[0],n=_.points[1],(r=new CgsLine3D({positions:[[h,c],[a,n]],fill:w._fillColor,name:" "})).setSaveFlag(!1),S.addFeature(r),_.entities.push(r),_.list.push(r),_.entities[0].entity.polyline.positions=new Cesium.CallbackProperty(function(e,t){return _.coordinates},!1))}}function s(e){var t,i,s=e.position.x,o=e.position.y,a=S.pixelToLonLat([s,o]);null!=a&&(t=a[0],i=a[1],_.type==CgsMeasure3D.SHAPE_LINE?(P(t,i,!1),_.points.push(t),_.points.push(i),_.coordinates=Cesium.Cartesian3.fromDegreesArray(_.points),_.entities[0].entity.polyline.positions=_.coordinates,_.points=[],_.entities=[],_.currentLength=0):_.type==CgsMeasure3D.VISIBLE_POLYGON&&(P(t,i,!1),_.points.push(t),_.points.push(i),_.coordinates=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(_.points)),_.entities[1].entity.polygon.hierarchy=_.coordinates,_.points=[],_.entities=[],_.currentLength=0))}function P(e,t,i){var s,o,a=new CgsPoint3D({position:[e,t],pixelSize:1});a.setSaveFlag(!1),S.addFeature(a),_.labelList.push(a),i&&(s=a.getLabel(),o=T(!0),s.setText(o),s.setPosition([e,t]),s.setFontSize("16px"))}function T(e){var t=_.points.length,i=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(_.points[t-4],_.points[t-3]),Cesium.Cartesian3.fromDegrees(_.points[t-2],_.points[t-1])),i=Math.round(i/1e3),s=_.currentLength+i;return e&&(_.currentLength=s),s+"km"}function M(e,t,i,s){var o;return i<e&&(o=e,e=i,i=o),s<t&&(o=t,t=s,s=o),[[e,t],[i,s]]}this._visibleLine=[],null==_.mode&&(_.mode=this.MODE_DEFAULT),this.setMode=function(e){this.state.mode=e},this.getMode=function(){return this.state.mode},this.activate=function(){S.screenSpaceEventHandler.setInputAction(t,Cesium.ScreenSpaceEventType.LEFT_CLICK),_.type!=CgsMeasure3D.SHAPE_POINT&&(S.screenSpaceEventHandler.setInputAction(i,Cesium.ScreenSpaceEventType.MOUSE_MOVE),S.screenSpaceEventHandler.setInputAction(s,Cesium.ScreenSpaceEventType.RIGHT_CLICK))},this.remove=function(){for(var e=0;e<_.list.length;e++)S.removeFeature(_.list[e]);for(e=0;e<_.labelList.length;e++)S.removeFeature(_.labelList[e])},this.deactivate=function(){this.remove(),S.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),_.type!=CgsMeasure3D.SHAPE_POINT&&(S.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),S.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)),S.pickerActivate()},this.distanceMeasure=function(e){if(Cesium.defined(e)&&!(e.length<2)){for(var t=0,i=0;i<e.length-1;++i){var s=e[i];2==s.length&&s.push(0);var o=e[i+1];2==o.length&&o.push(0);var a=Cesium.Cartesian3.distance(new Cesium.Cartesian3.fromDegrees(s[0],s[1],s[2]),new Cesium.Cartesian3.fromDegrees(o[0],o[1],o[2]));t+=parseFloat(a)}return t}},this.areaMeasure=function(e){if(Cesium.defined(S)){var t=S.scene.globe.ellipsoid;if(Cesium.defined(e)&&!(e.length<3)){var i=0,s=e.length,o=e[s-1];2==o.length&&o.push(0);for(var a=0;a<s;a++){var n=e[a];2==n.length&&n.push(0),i+=Cesium.Math.toRadians(n[0]-o[0])*(2+Math.sin(Cesium.Math.toRadians(o[1]))+Math.sin(Cesium.Math.toRadians(n[1]))),o=n}var r=(t.maximumRadius+t.maximumRadius)/2e3;return Math.abs(i*r*r/2)}}},this.distanceVisible=function(e){if(Cesium.defined(e)&&2===e.length){this._visibleLine=[];var t=[],i=e[0][0],s=e[0][1];t.push(i),t.push(s),Cesium.defined(e[0][2])?t.push(e[0][2]):t.push(0),this._visibleLine.push(t),t=[];var o=e[1][0],a=e[1][1],n=new Cesium.Cartesian3.fromDegrees(i,s),r=new Cesium.Cartesian3.fromDegrees(o,a),l=new Cesium.Ray;Cesium.Cartesian3.clone(n,l.origin);var u=Cesium.Cartesian3.subtract(r,n,l.direction);l.direction=Cesium.Cartesian3.normalize(u,l.direction);var p=Cesium.IntersectionTests.grazingAltitudeLocation(l,S.scene.globe.ellipsoid);if(Cesium.defined(p)){var h=Cesium.Cartographic.fromCartesian(p,Cesium.Ellipsoid.WGS84),c=Cesium.Math.toDegrees(h.longitude),g=Cesium.Math.toDegrees(h.latitude);return t.push(c),t.push(g),t.push(h.height),this._visibleLine.push(t),Cesium.Cartesian3.distance(n,p)}}},this.getVisibleLine=function(){return this._visibleLine},this.setFillColor=function(e){Cesium.defined(e)&&(this._fillColor=e)},this.getFillColor=function(){return this._fillColor},this.setCoverColor=function(e){Cesium.defined(e)&&(this._coverColor=e)},this.getCoverColor=function(){return this._coverColor},this.setLineColor=function(e){Cesium.defined(e)&&(this._lineColor=e)},this.getLineColor=function(){return this._lineColor},this.dispose=function(){this.deActive()}}),CgsMeasure3D.MODE_DEFAULT=1,CgsMeasure3D.MODE_LINE=2,CgsMeasure3D.SHAPE_POINT="point",CgsMeasure3D.SHAPE_CIRCLE="CIRCLE",CgsMeasure3D.SHAPE_LINE="LINE",CgsMeasure3D.SHAPE_RECTANGLE="RECT",CgsMeasure3D.SHAPE_POLYGON="POLYGON",CgsMeasure3D.VISIBLE_LINE="visibleLine",CgsMeasure3D.VISIBLE_POLYGON="visiblePolygon",CgsMeasure3D.GRADIENT_ANALYZE="gradientAnalyze",CgsMeasure3D.PROFILE_ANALYZE="profileAnalyze",CgsMeasure3D.FILLDIG_ANALYZE="filldigAnalyze",CgsMeasure3D.FLOOD_ANALYZE="floodAnalyze",CgsComponent3D=function(e){this.state={componentList:[]},this.map=e},CgsComponent3D.prototype.loadByPath=function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.body.appendChild(t)},CgsComponent3D.prototype.loadByName=function(e){var t="assets/componentLib/"+e+"/"+e+".js",i=document.createElement("script");i.type="text/javascript",i.src=t,document.body.appendChild(i)},CgsComponent3D.prototype.add=function(e){var t={name:e.state.name,id:e.state.id,component:e};this.state.componentList.push(t),this.map.entities.add(e.entity),null!=e.unitComponent&&e.addToMap()},CgsComponent3D.prototype.remove=function(e){null!=e.unitComponent&&e.removeFromMap(),this.map.entities.remove(e.entity);for(var t=0;t<this.state.componentList.length;t++){if(null!=this.state.componentList[t])if(this.state.componentList[t].id==e.state.id){this.state.componentList[t]=void 0;break}}},CgsComponent3D.prototype.removeAll=function(){for(var e=0;e<this.state.componentList.length;e++){var t=this.state.componentList[e].component;null!=t.unitComponent&&t.removeFromMap(),this.map.entities.remove(t.entity)}this.state.componentList=[]},CgsComponent3D.prototype.recoverComponent=function(options,name,str){var self=this,path="assets/componentLib/"+name+"/"+name+".js";loadScript(path,function(){eval(str),self.add(component)})},CgsFlyPath3D=function(y){var v={startlon:y.start[0],startlat:y.start[1],currentLon:y.start[0],currentLat:y.start[1],endlon:y.end[0],endlat:y.end[1],imagePath:y.imagePath,height:y.height,position_array:[],imageArray:[],intervalId:0,stepNumber:100,currentStep:0,isArriveEnd:!1,redLine:null,fact:5};this.state=v,this.map=y.mapObject.map3D,this.setHeight=function(e){this.remove(),v.height=e,this.addBezier(v.position_array,v.startlon,v.startlat,v.endlon,v.endlat),this.addImage(v.imagePath)},this.setStartEndPosition=function(e,t,i,s){this.remove(),v.startlon=e,v.startlat=t,v.endlon=i,v.endlat=s,this.addBezier(v.position_array,v.startlon,v.startlat,v.endlon,s,this),this.addImage(v.imagePath)},this.setSpeed=function(e){clearInterval(this.state.intervalId),this.state.intervalId=setInterval(t,e)},this.remove=function(){this.map.removeFeature(this.state.redLine);for(var e=0;e<this.state.imageArray.length;e++)this.map.entities.remove(this.state.imageArray[e]);v.position_array=[]},this.addBezier=function(e,t,i,s,o){var a,n=Cesium.Cartesian3.fromDegrees(t,i,0),r=Cesium.Cartesian3.fromDegrees(s,o,0),l=Cesium.Cartesian3.distance(n,r);null==y.height&&(a=l/2*v.fact,v.height=a);for(var u=new Cesium.CatmullRomSpline({times:[0,1],points:[n,r]}),p=Cesium.Cartographic.fromCartesian(u.evaluate(.5)),h=Cesium.HermiteSpline.createNaturalCubic({times:[0,.5,1],points:[n,Cesium.Cartesian3.fromRadians(p.longitude,p.latitude,v.height),r]}),c=[],g=0;g<=v.stepNumber;g++){var d=h.evaluate(g/v.stepNumber),m=Cesium.Cartographic.fromCartesian(d),f=[];f.push(180*m.longitude/Math.PI,180*m.latitude/Math.PI,m.height),c.push(f),e.push(d)}var C=new CgsLine3D({positions:c,fill:"rgba(0,255,0,0.2)"});v.redLine=C,this.map.addFeature(C),v.stepNumber=e.length};var o=this;function t(){0==v.isArriveEnd?(v.currentStep=v.currentStep+1,v.imageArray[0].position=v.position_array[v.currentStep],v.imageArray[1].position=v.position_array[v.currentStep-1],v.imageArray[2].position=v.position_array[v.currentStep-2],v.imageArray[3].position=v.position_array[v.currentStep-3],v.currentStep==v.stepNumber&&(v.isArriveEnd=!0)):(v.currentStep=v.currentStep-1,v.imageArray[0].position=v.position_array[v.currentStep-3],v.imageArray[1].position=v.position_array[v.currentStep-2],v.imageArray[2].position=v.position_array[v.currentStep-1],v.imageArray[3].position=v.position_array[v.currentStep],0==v.currentStep&&(v.isArriveEnd=!1));var e,t=o.getPositionOnLatLon(v.startlon,v.startlat),i=o.getPositionOnLatLon(v.endlon,v.endlat),s=[i[0]-t[0],i[1]-t[1]];e=0==v.isArriveEnd?Math.atan2(-s[0],-s[1]):Math.atan2(s[0],s[1]),v.imageArray[0].billboard.rotation=e,v.imageArray[1].billboard.rotation=e,v.imageArray[2].billboard.rotation=e,v.imageArray[3].billboard.rotation=e}this.addImage=function(e){v.imageArray[0]=this.map.entities.add({position:Cesium.Cartesian3.fromDegrees(v.startlon,v.startlat),billboard:{image:e}}),v.imageArray[0].billboard.color=Cesium.Color.WHITE.withAlpha(1),v.imageArray[1]=this.map.entities.add({position:Cesium.Cartesian3.fromDegrees(v.startlon,v.startlat),billboard:{image:e}}),v.imageArray[1].billboard.color=Cesium.Color.WHITE.withAlpha(.8),v.imageArray[2]=this.map.entities.add({position:Cesium.Cartesian3.fromDegrees(v.startlon,v.startlat),billboard:{image:e}}),v.imageArray[2].billboard.color=Cesium.Color.WHITE.withAlpha(.4),v.imageArray[3]=this.map.entities.add({position:Cesium.Cartesian3.fromDegrees(v.startlon,v.startlat),billboard:{image:e}}),v.imageArray[3].billboard.color=Cesium.Color.WHITE.withAlpha(.2)},this.getPositionOnLatLon=function(e,t){var i=Cesium.Cartesian3.fromDegrees(e,t),s=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.map.scene,i);return[s.x,s.y]},this.addBezier(v.position_array,v.startlon,v.startlat,v.endlon,v.endlat),this.addImage(v.imagePath),v.intervalId=setInterval(t,100)},CgsBox3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){e.type="CgsBox";var t={name:e.name,center:e.center,position:e.position,dimensions:e.dimensions,show:e.show,fill:e.fill,fillColor:e.fillColor,outline:e.outline,outlineColor:e.outlineColor,outlineWidth:e.outlineWidth,shadows:e.shadows,distanceDisplayCondition:e.distanceDisplayCondition};null==(this.state=t).position&&null==t.center?t.position=[110,40]:t.position=Cesium.defined(e.position)?e.position:e.center,null==t.dimensions&&(t.dimensions=[3e4,3e4,2e4]),null==t.show&&(t.show=!0),null==t.fill&&(t.fill=!0),null==t.fillColor&&(t.fillColor="rgba(255, 255, 0, 0.5)"),null==t.outline&&(t.outline=!0),null==t.outlineColor&&(t.outlineColor="rgba(255, 0, 255, 1.0)"),null==t.outlineWidth&&(t.outlineWidth=1),null==t.shadows&&(t.shadows="DISABLED"),e.name||(e.name=""),t.distanceDisplayCondition||(t.distanceDisplayCondition=0),t.distanceDisplayCondition=CgsFeature.checkVisibleHeight(t.distanceDisplayCondition);var i={position:CgsBox3D.getPositionInCartesian3(t.position),name:e.name,box:{dimensions:new Cesium.Cartesian3(t.dimensions[0],t.dimensions[1],t.dimensions[2]),fill:t.fill,material:Cesium.Color.fromCssColorString(t.fillColor),outline:t.outline,outlineColor:Cesium.Color.fromCssColorString(t.outlineColor),outlineWidth:t.outlineWidth,shadows:CgsBox3D.SHADOWS[t.shadows],show:t.show,distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(t.distanceDisplayCondition)}};e.temp=i,CgsFeature3D.call(this,e)}),CgsInherits(CgsBox3D,CgsFeature3D),CgsBox3D.prototype.setPosition=function(e){this.state.position=e;var t=CgsBox3D.getPositionInCartesian3(e);this.entity.position=t,null!=this.label&&this.label.setPosition(e)},CgsBox3D.prototype.getPosition=function(){return this.state.position},CgsBox3D.prototype.setDimensions=function(e){this.state.dimensions=e,this.entity.box.dimensions=new Cesium.Cartesian3(e[0],e[1],e[2])},CgsBox3D.prototype.getDimensions=function(){return this.state.dimensions},CgsBox3D.prototype.setFill=function(e){this.state.fill=e,this.entity.box.fill=e},CgsBox3D.prototype.getFill=function(){return this.state.fill},CgsBox3D.prototype.setMaterial=function(e){this.state.material=e,this.entity.box.material=Cesium.Color.fromCssColorString(e)},CgsBox3D.prototype.getMaterial=function(){return this.state.material},CgsBox3D.prototype.setOutline=function(e){this.state.outline=e,this.entity.box.outline=e},CgsBox3D.prototype.getOutline=function(){return this.state.outline},CgsBox3D.prototype.setOutlineColor=function(e){this.state.outlineColor=e,this.entity.box.outlineColor=Cesium.Color.fromCssColorString(e)},CgsBox3D.prototype.getOutlineColor=function(){return this.state.outlineColor},CgsBox3D.prototype.setOutlineWidth=function(e){this.state.outlineWidth=e,this.entity.box.outlineWidth=e},CgsBox3D.prototype.getOutlineWidth=function(){return this.state.outlineWidth},CgsBox3D.prototype.setShadows=function(e){this.state.shadows=e,this.entity.box.shadows=CgsBox3D.SHADOWS[e]},CgsBox3D.prototype.getShadows=function(){return this.state.shadows},CgsBox3D.prototype.setFillColor=function(e){this.state.fillColor=e,this.entity.box.material=Cesium.Color.fromCssColorString(e)},CgsBox3D.prototype.getFillColor=function(){return this.state.fillColor},CgsBox3D.getPositionInCartesian3=function(e){var t=2==e.length?Cesium.Cartesian3.fromDegrees(e[0],e[1]):Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]);return t},CgsBox3D.prototype.setVisibleHeight=function(e){this.state.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.state.distanceDisplayCondition);this.entity.box.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsBox3D.prototype.getVisibleHeight=function(){return this.state.distanceDisplayCondition},CgsBox3D.SHADOWS={DISABLED:Cesium.ShadowMode.DISABLED,CAST_ONLY:Cesium.ShadowMode.CAST_ONLY,ENABLED:Cesium.ShadowMode.ENABLED,RECEIVE_ONLY:Cesium.ShadowMode.RECEIVE_ONLY},CgsCorridor3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){e.type="CgsCorridor";var s={name:e.name,positions:e.positions,width:e.width,height:e.height,cornerType:e.cornorType,extrudedHeight:e.extrudedHeight,show:e.show,fill:e.fill,fillColor:e.fillColor,outline:e.outline,outlineColor:e.outlineColor,outlineWidth:e.outlineWidth,shadows:e.shadows,distanceDisplayCondition:e.distanceDisplayCondition};this.state=s,this.callbackFlag=Cesium.defaultValue(e.callbackFlag,!1),null==s.name&&(s.name=""),null==s.positions&&(s.positions=[[-100,40],[-105,40],[-105,30]]),null==s.width&&(s.width=20),null==s.cornerType&&(s.cornerType="ROUNDED"),null==s.extrudedHeight&&(s.extrudedHeight=0),null==s.height&&(s.height=100),null==s.show&&(s.show=!0),null==s.fillColor&&(s.fillColor="rgba(255,255,0,0.5)"),null==s.fill&&(s.fill=!0),null==s.outline&&(s.outline=!0),null==s.outlineColor&&(s.outlineColor="rgba(255,0,0,0.8)"),null==s.outlineWidth&&(s.outlineWidth=2),null==s.shadows&&(s.shadows="DISABLED"),null==s.distanceDisplayCondition&&(s.distanceDisplayCondition=0),s.distanceDisplayCondition=CgsFeature.checkVisibleHeight(s.distanceDisplayCondition),this.getPositionValue=function(e){for(var t=[],i=0;i<e.length;i++)3==e[i].length&&(s.positions[i]=[e[i][0],e[i][1]]),t.push(e[i][0],e[i][1]);return t};var t={name:s.name,corridor:{positions:Cesium.Cartesian3.fromDegreesArray(this.getPositionValue(s.positions)),width:s.width,cornerType:CgsCorridor3D.CORNERTYPE[s.cornerType],height:s.height+s.extrudedHeight,extrudedHeight:s.extrudedHeight,show:s.show,fill:s.fill,material:Cesium.Color.fromCssColorString(s.fillColor),outline:s.outline,outlineColor:Cesium.Color.fromCssColorString(s.outlineColor),outlineWidth:s.outlineWidth,shadows:CgsCorridor3D.SHADOWS[s.shadows],distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(s.distanceDisplayCondition)}};e.temp=t,e.pos=s.positions[0],CgsFeature3D.call(this,e)}),CgsInherits(CgsCorridor3D,CgsFeature3D),CgsCorridor3D.prototype.setPosition=function(e){this.state.positions=e;var t,i=this.getPositionValue(e),s=Cesium.Cartesian3.fromDegreesArray(i);this.callbackFlag?this.entity.corridor.positions=new Cesium.CallbackProperty(function(){return s},!1):this.entity.corridor.positions=s,null!=this.label&&((t=e[0].slice(0))[2]=this.state.extrudedHeight,this.label.setPosition(t))},CgsCorridor3D.prototype.getPosition=function(){return this.state.positions},CgsCorridor3D.prototype.setWidth=function(e){this.state.width=e,this.entity.corridor.width=e},CgsCorridor3D.prototype.getWidth=function(){return this.state.width},CgsCorridor3D.prototype.setCornerType=function(e){this.state.cornerType=e,this.entity.corridor.cornerType=CgsCorridor3D.CORNERTYPE[e]},CgsCorridor3D.prototype.getCornerType=function(){return this.state.cornerType},CgsCorridor3D.prototype.setHeight=function(e){var t=(this.state.height=e)+this.state.extrudedHeight;this.entity.corridor.height=t},CgsCorridor3D.prototype.getHeight=function(){return this.state.height},CgsCorridor3D.prototype.setExtrudedHeight=function(e){var t;this.state.extrudedHeight=e,this.entity.corridor.extrudedHeight=e,this.entity.corridor.height=e+this.state.height,null!=this.label&&((t=this.label.getPosition())[2]=e,this.label.setPosition(t))},CgsCorridor3D.prototype.getExtrudedHeight=function(){return this.state.extrudedHeight},CgsCorridor3D.prototype.setFill=function(e){this.state.fill=e,this.entity.corridor.fill=e},CgsCorridor3D.prototype.getFill=function(){return this.state.fill},CgsCorridor3D.prototype.setFillColor=function(e){this.state.fillColor=e,this.entity.corridor.material=Cesium.Color.fromCssColorString(e)},CgsCorridor3D.prototype.getFillColor=function(){return this.state.fillColor},CgsCorridor3D.prototype.setOutline=function(e){this.state.outline=e,this.entity.corridor.outline=e},CgsCorridor3D.prototype.getOutline=function(){return this.state.outline},CgsCorridor3D.prototype.setOutlineColor=function(e){this.state.outlineColor=e,this.entity.corridor.outlineColor=Cesium.Color.fromCssColorString(e)},CgsCorridor3D.prototype.getOutlineColor=function(){return this.state.outlineColor},CgsCorridor3D.prototype.setOutlineWidth=function(e){this.state.outlineWidth=e,this.entity.corridor.outlineWidth=e},CgsCorridor3D.prototype.getOutlineWidth=function(){return this.state.outlineWidth},CgsCorridor3D.prototype.setShadows=function(e){this.state.shadows=e,this.entity.corridor.shadows=CgsCorridor3D.SHADOWS[e]},CgsCorridor3D.prototype.getShadows=function(){return this.state.shadows},CgsCorridor3D.prototype.setVisibleHeight=function(e){this.state.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.state.distanceDisplayCondition);this.entity.corridor.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsCorridor3D.prototype.getVisibleHeight=function(){return this.state.distanceDisplayCondition},CgsCorridor3D.SHADOWS={disabled:Cesium.ShadowMode.DISABLED,cast_only:Cesium.ShadowMode.CAST_ONLY,enabled:Cesium.ShadowMode.ENABLED,receive_only:Cesium.ShadowMode.RECEIVE_ONLY},CgsCorridor3D.CORNERTYPE={BEVELED:Cesium.CornerType.BEVELED,MITERED:Cesium.CornerType.MITERED,ROUNDED:Cesium.CornerType.ROUNDED},CgsEllipse3D=function(e){var t;e.type="CgsEllipse",null==e?(this.pos1=[-111,40,0],this.height=0,this.extrudedHeight=0,this.radiusX=3e5,this.radiusY=1e5,this.fillColor="rgba(255, 255, 255, 0.1)",this.fill=!0,this.outline=!0,this.rotation=0,this.stRotation=0,this.outlineColor="rgba(0, 153, 255, 1.0)",this.outlineWidth=2,this.name="",this.distanceDisplayCondition=0):(null==e.position&&null==e.center?this.pos1=[-111,40,0]:(this.pos1=Cesium.defined(e.position)?e.position:e.center,2==this.pos1.length&&(this.pos1[2]=0),this.height=this.pos1[2]),null==e.radiusX?this.radiusX=3e5:this.radiusX=e.radiusX,null==e.radiusY?this.radiusY=3e5:this.radiusY=e.radiusY,e.radiusX<e.radiusY&&(t=this.radiusX,this.radiusX=this.radiusY,this.radiusY=t),null==e.fill?this.fill=!0:this.fill=e.fill,null==e.fillColor?this.fillColor="rgba(255,255,255,0.1)":this.fillColor=e.fillColor,null==e.outline?this.outline=!0:this.outline=e.outline,null==e.outlineColor?this.outlineColor="rgba(0, 153, 255, 1.0)":this.outlineColor=e.outlineColor,null==e.outlineWidth?this.outlineWidth=5:this.outlineWidth=e.outlineWidth,null==e.name?this.name="":this.name=e.name,null==e.outline?this.outline=!0:this.outline=e.outline,this.extrudedHeight=0,null==e.rotation?this.rotation=0:this.rotation=e.rotation,null==e.stRotation?this.stRotation=0:this.stRotation=e.stRotation,this.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0),this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition),this.radiusXOfInnerUints=this.getRadiusOfInnerUints(this.radiusX),this.radiusYOfInnerUints=this.getRadiusOfInnerUints(this.radiusY),this.reSetGeometry();var i={positions:this.coordinates,fillColor:this.fillColor,outlineColor:this.outlineColor,outlineWidth:this.outlineWidth,extrudedHeight:this.extrudedHeight,height:this.height,name:this.name,closeTop:!0,closeBottom:!0,outline:this.outline,fill:this.fill,distanceDisplayCondition:this.distanceDisplayCondition,parentFeature:e.parentFeature,labelfont:e.labelfont,labeloffset:e.labeloffset};CgsPolygon3D.call(this,i)},CgsInherits(CgsEllipse3D,CgsPolygon3D),CgsEllipse3D.prototype.setPosition=function(e){this.pos1=e,this.reSetGeometry(),CgsPolygon3D.prototype.setPosition.call(this,this.coordinates),this.setHeight(e[2]),this.entity.position=new Cesium.CallbackProperty(function(){return Cesium.Cartesian3.fromDegrees(e[0],e[1])},!1),null!=this.label&&this.label.setPosition(e)},CgsEllipse3D.prototype.getPosition=function(){return this.pos1},CgsEllipse3D.prototype.setRadiusX=function(e){this.radiusX=e,this.radiusXOfInnerUints=this.getRadiusOfInnerUints(this.radiusX),this.reSetGeometry(),CgsPolygon3D.prototype.setPosition.call(this,this.coordinates)},CgsEllipse3D.prototype.getRadiusX=function(){return this.radiusX},CgsEllipse3D.prototype.setRadiusY=function(e){this.radiusY=e,this.radiusYOfInnerUints=this.getRadiusOfInnerUints(this.radiusY),this.reSetGeometry(),CgsPolygon3D.prototype.setPosition.call(this,this.coordinates)},CgsEllipse3D.prototype.getRadiusY=function(){return this.radiusY},CgsEllipse3D.prototype.setRotation=function(e){this.rotation=e,this.reSetGeometry(),CgsPolygon3D.prototype.setPosition.call(this,this.coordinates)},CgsEllipse3D.prototype.getRotation=function(){return this.rotation},CgsEllipse3D.prototype.getType=function(){return"CgsEllipse"},CgsEllipse3D.prototype.getRadiusOfInnerUints=function(e){var t=6378137,i=e/t,s=Math.sqrt(2*t*t*(1-Math.cos(i))),o=Math.cos(this.pos1[1]/180*Math.PI)*t,a=Math.acos((2*o*o-s*s)/(2*o*o));return[this.pos1[0]+a/Math.PI*180,this.pos1[1]][0]-this.pos1[0]},CgsEllipse3D.prototype.reSetGeometry=function(){this.coordinates=[[]];for(var e=0;e<360;e++){var t=this.radiusXOfInnerUints*Math.cos(e/180*Math.PI),i=this.radiusYOfInnerUints*Math.sin(e/180*Math.PI),s=Math.cos(this.rotation/180*Math.PI)*t-Math.sin(this.rotation/180*Math.PI)*i,o=Math.cos(this.rotation/180*Math.PI)*i+Math.sin(this.rotation/180*Math.PI)*t;s+=this.pos1[0],o+=this.pos1[1],this.coordinates[0].push([s,o])}},CgsEllipsoid3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){e.type="CgsEllipsoid";var t={name:e.name,position:e.position,radii:e.radii,show:e.show,fill:e.fill,fillColor:e.fillColor,outline:e.outline,outlineColor:e.outlineColor,outlineWidth:e.outlineWidth,subdivisions:e.subdivisions,stackPartitions:e.stackPartitions,slicePartitions:e.slicePartitions,shadows:e.shadows,center:e.center,distanceDisplayCondition:e.distanceDisplayCondition};null==(this.state=t).name&&(t.name=""),null==t.position&&(t.position=[-30,-20]),2==t.position.length&&(t.position[2]=0),null==t.radii&&(t.radii=[2e4,4e4,7e3]),null==t.show&&(t.show=!0),null==t.fill&&(t.fill=!0),null==t.fillColor&&(t.fillColor="rgba(25,255,78,0.6)"),null==t.outline&&(t.outline=!0),null==t.outlineColor&&(t.outlineColor="rgba(215,255,178,0.6)"),null==t.outlineWidth&&(t.outlineWidth=5),null==t.subdivisions&&(t.subdivisions=128),null==t.stackPartitions&&(t.stackPartitions=64),null==t.slicePartitions&&(t.slicePartitions=64),null==t.shadows&&(t.shadows="DISABLED"),null==t.center&&(t.center=t.position),null==t.distanceDisplayCondition&&(t.distanceDisplayCondition=0),t.distanceDisplayCondition=CgsFeature.checkVisibleHeight(t.distanceDisplayCondition);var i={name:t.name,position:Cesium.Cartesian3.fromDegrees(t.position[0],t.position[1],t.position[2]),ellipsoid:{radii:new Cesium.Cartesian3(t.radii[0],t.radii[1],t.radii[2]),show:t.show,fill:t.fill,material:Cesium.Color.fromCssColorString(t.fillColor),outline:t.outline,outlineColor:Cesium.Color.fromCssColorString(t.outlineColor),outlineWidth:t.outlineWidth,subdivisions:t.subdivisions,slicePartitions:t.slicePartitions,stackPartitions:t.stackPartitions,shadows:CgsEllipsoid3D.SHADOWS[t.shadows],distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(t.distanceDisplayCondition)}};e.temp=i,e.pos=t.position,CgsFeature3D.call(this,e)}),CgsInherits(CgsEllipsoid3D,CgsFeature3D),CgsEllipsoid3D.prototype.setPosition=function(e){2==e.length&&(e[2]=0),this.state.position=e,this.entity.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),null!=this.label&&this.label.setPosition(e)},CgsEllipsoid3D.prototype.getPosition=function(){return this.state.position},CgsEllipsoid3D.prototype.setRadii=function(e){this.state.radii=e,this.entity.ellipsoid.radii=new Cesium.Cartesian3(e[0],e[1],e[2])},CgsEllipsoid3D.prototype.getRadii=function(){return this.state.radii},CgsEllipsoid3D.prototype.setFill=function(e){this.state.fill=e,this.entity.ellipsoid.fill=e},CgsEllipsoid3D.prototype.getFill=function(){return this.state.fill},CgsEllipsoid3D.prototype.setFillColor=function(e){this.state.fillColor=e,this.entity.ellipsoid.material=Cesium.Color.fromCssColorString(e)},CgsEllipsoid3D.prototype.getFillColor=function(){return this.state.fillColor},CgsEllipsoid3D.prototype.setOutline=function(e){this.state.outline=e,this.entity.ellipsoid.outline=e},CgsEllipsoid3D.prototype.getOutline=function(){return this.state.outline},CgsEllipsoid3D.prototype.setOutlineColor=function(e){this.state.outlineColor=e,this.entity.ellipsoid.outlineColor=Cesium.Color.fromCssColorString(e)},CgsEllipsoid3D.prototype.getOutlineColor=function(){return this.state.outlineColor},CgsEllipsoid3D.prototype.setOutlineWidth=function(e){this.state.outlineWidth=e,this.entity.ellipsoid.outlineWidth=e},CgsEllipsoid3D.prototype.getOutlineWidth=function(){return this.state.outlineWidth},CgsEllipsoid3D.prototype.setSubdivisions=function(e){this.state.subdivisions=e,this.entity.ellipsoid.subdivisions=e},CgsEllipsoid3D.prototype.getSubdivisions=function(){return this.state.subdivisions},CgsEllipsoid3D.prototype.setSlicePartitions=function(e){this.state.slicePartitions=e,this.entity.ellipsoid.slicePartitions=e},CgsEllipsoid3D.prototype.getSlicePartitions=function(){return this.state.slicePartitions},CgsEllipsoid3D.prototype.setStackPartitions=function(e){this.state.stackPartitions=e,this.entity.ellipsoid.stackPartitions=e},CgsEllipsoid3D.prototype.getStackPartitions=function(){return this.state.stackPartitions},CgsEllipsoid3D.prototype.setShadows=function(e){this.state.shadows=e,this.entity.ellipsoid.shadows=CgsEllipsoid3D.SHADOWS[e]},CgsEllipsoid3D.prototype.getShadows=function(){return this.state.shadows},CgsEllipsoid3D.prototype.setVisibleHeight=function(e){this.state.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.state.distanceDisplayCondition);this.entity.ellipsoid.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsEllipsoid3D.prototype.getVisibleHeight=function(){return this.state.distanceDisplayCondition},CgsEllipsoid3D.SHADOWS={DISABLED:Cesium.ShadowMode.DISABLED,CAST_ONLY:Cesium.ShadowMode.CAST_ONLY,ENABLED:Cesium.ShadowMode.ENABLED,RECEIVE_ONLY:Cesium.ShadowMode.RECEIVE_ONLY},CgsPolylineVolume3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){e.type="CgsPolylineVolume";var t={name:e.name,positions:e.positions,shape:e.shape,show:e.show,cornerType:e.cornorType,fill:e.fill,fillColor:e.fillColor,outline:e.outline,outlineColor:e.outlineColor,outlineWidth:e.outlineWidth,shadows:e.shadows,center:e.center,distanceDisplayCondition:e.distanceDisplayCondition};null==(this.state=t).name&&(t.name=""),null==t.positions&&(t.positions=[[-30,-20,0],[-25,-15,0],[-20,-20,0]]),null==t.show&&(t.show=!0),null==t.fill&&(t.fill=!0),null==t.fillColor&&(t.fillColor="rgba(25,255,78,0.6)"),null==t.outline&&(t.outline=!1),null==t.outlineColor&&(t.outlineColor="rgba(215,255,178,0.6)"),null==t.outlineWidth&&(t.outlineWidth=5),null==t.shadows&&(t.shadows="DISABLED"),null==t.center&&(t.center=t.positions[0]),null==t.cornerType&&(t.cornerType="ROUNDED"),null==t.shape&&(t.shape=[[-5e4,-5e4],[-5e4,5e4],[5e4,5e4],[5e4,-5e4]]),null==t.distanceDisplayCondition&&(t.distanceDisplayCondition=0),t.distanceDisplayCondition=CgsFeature.checkVisibleHeight(t.distanceDisplayCondition),this.getShapeValue=function(e){for(var t=[],i=0;i<e.length;i++){var s=e[i][0],o=e[i][1],a=new Cesium.Cartesian2(s,o);t.push(a)}return t},this.getPositionValue=function(e){for(var t=[],i=0;i<e.length;i++)2==e[i].length&&(e[i][2]=0,this.state.positions[i][2]=0),t.push(e[i][0],e[i][1],e[i][2]);return t};var i={name:t.name,polylineVolume:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(this.getPositionValue(t.positions)),show:t.show,fill:t.fill,material:Cesium.Color.fromCssColorString(t.fillColor),outline:t.outline,outlineColor:t.outlineColor,outlineWidth:t.outlineWidth,shadows:CgsPolylineVolume3D.SHADOWS[t.shadows],cornerType:CgsPolylineVolume3D.CORNERTYPE[t.cornerType],shape:this.getShapeValue(t.shape),distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(t.distanceDisplayCondition)}};e.temp=i,e.pos=t.positions[0],CgsFeature3D.call(this,e)}),CgsInherits(CgsPolylineVolume3D,CgsFeature3D),CgsPolylineVolume3D.prototype.setPosition=function(e){this.state.positions=e;var t=this.getPositionValue(e);this.entity.polylineVolume.positions=new Cesium.CallbackProperty(function(){return Cesium.Cartesian3.fromDegreesArrayHeights(t)},!0),null!=this.label&&this.label.setPosition(e[0])},CgsPolylineVolume3D.prototype.getPosition=function(){return this.state.positions},CgsPolylineVolume3D.prototype.setFill=function(e){this.state.fill=e,this.entity.polylineVolume.fill=e},CgsPolylineVolume3D.prototype.getFill=function(){return this.state.fill},CgsPolylineVolume3D.prototype.setFillColor=function(e){this.state.fillColor=e,this.entity.polylineVolume.material=Cesium.Color.fromCssColorString(e)},CgsPolylineVolume3D.prototype.getFillColor=function(){return this.state.fillColor},CgsPolylineVolume3D.prototype.setOutline=function(e){this.state.outline=e,this.entity.polylineVolume.outline=e},CgsPolylineVolume3D.prototype.getOutline=function(){return this.state.outline},CgsPolylineVolume3D.prototype.setOutlineColor=function(e){this.state.outlineColor=e,this.entity.polylineVolume.outlineColor=Cesium.Color.fromCssColorString(e)},CgsPolylineVolume3D.prototype.getOutlineColor=function(){return this.state.outlineColor},CgsPolylineVolume3D.prototype.setOutlineWidth=function(e){this.state.outlineWidth=e,this.entity.polylineVolume.outlineWidth=e},CgsPolylineVolume3D.prototype.getOutlineWidth=function(){return this.state.outlineWidth},CgsPolylineVolume3D.prototype.setShape=function(e){this.state.shape=e,this.entity.polylineVolume.shape=this.getShapeValue(e)},CgsPolylineVolume3D.prototype.getShape=function(){return this.state.shape},CgsPolylineVolume3D.prototype.setShadows=function(e){this.state.shadows=e,this.entity.polylineVolume.shadows=CgsPolylineVolume3D.SHADOWS[e]},CgsPolylineVolume3D.prototype.getShadows=function(){return this.state.shadows},CgsPolylineVolume3D.prototype.setCornerType=function(e){this.state.cornerType=e,this.entity.polylineVolume.cornerType=CgsPolylineVolume3D.CORNERTYPE[e]},CgsPolylineVolume3D.prototype.getCornerType=function(){return this.state.cornerType},CgsPolylineVolume3D.prototype.setVisibleHeight=function(e){this.state.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.state.distanceDisplayCondition);this.entity.polylineVolume.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsPolylineVolume3D.prototype.getVisibleHeight=function(){return this.state.distanceDisplayCondition},CgsPolylineVolume3D.SHADOWS={DISABLED:Cesium.ShadowMode.DISABLED,CAST_ONLY:Cesium.ShadowMode.CAST_ONLY,ENABLED:Cesium.ShadowMode.ENABLED,RECEIVE_ONLY:Cesium.ShadowMode.RECEIVE_ONLY},CgsPolylineVolume3D.CORNERTYPE={BEVELED:Cesium.CornerType.BEVELED,MITERED:Cesium.CornerType.MITERED,ROUNDED:Cesium.CornerType.ROUNDED},CgsWall3D=function(e){e.type="CgsWall";var t,i={name:e.name,positions:e.positions,show:e.show,fill:e.fill,fillColor:e.fillColor,outline:e.outline,outlineColor:e.outlineColor,outlineWidth:e.outlineWidth,shadows:e.shadows,center:e.center,distanceDisplayCondition:e.distanceDisplayCondition,materialState:e.materialState,diffHeight:e.diffHeight,material:e.material};if(this.state=i,this.maximumHeights=[],this.minimumHeights=[],null==i.name&&(i.name=""),null==i.materialState||0==i.materialState?i.materialState=!1:i.materialState=!0,i.material?i.material=new Cesium.ImageMaterialProperty({image:e.material.image,transparent:!0,color:Cesium.Color.WHITE}):i.material=Cesium.Color.fromCssColorString("rgba(255,255,255,0.4)"),null==i.positions)i.positions=[[-110,-10],[-70,20],[0,5]];else if(null==this.state.diffHeight)for(var s=0;s<this.state.positions.length;s++)2==this.state.positions[s].length?(this.minimumHeights.push(0),this.maximumHeights.push(5)):3==this.state.positions[s].length&&(this.minimumHeights.push(this.state.positions[s][2]),this.maximumHeights.push(Number(this.state.positions[s][2])+Number(5)));else for(s=0;s<this.state.positions.length;s++)2==this.state.positions[s].length?(this.minimumHeights.push(0),this.maximumHeights.push(this.state.diffHeight)):3==this.state.positions[s].length&&(this.minimumHeights.push(this.state.positions[s][2]),this.maximumHeights.push(Number(this.state.positions[s][2])+Number(this.state.diffHeight)));null==i.show&&(i.show=!0),null==i.fill&&(i.fill=!0),null==i.fillColor&&(i.fillColor="rgba(25,255,78,0.6)"),null==i.outline&&(i.outline=!0),null==i.outlineColor&&(i.outlineColor="rgba(215,255,178,0.6)"),null==i.outlineWidth&&(i.outlineWidth=1),null==i.shadows&&(i.shadows="DISABLED"),null==i.center?i.center=i.positions[0]:i.center=i.center,null==i.distanceDisplayCondition&&(i.distanceDisplayCondition=0),i.distanceDisplayCondition=CgsFeature.checkVisibleHeight(i.distanceDisplayCondition),this.getPositionValue=function(e){for(var t=[],i=0;i<e.length;i++)2==e[i].length&&(e[i][2]=0,this.state.positions[i][2]=0),t.push(e[i][0],e[i][1],e[i][2]);return t},t=i.materialState?{name:i.name,wall:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(this.getPositionValue(i.positions)),show:i.show,fill:i.fill,material:i.material,outline:i.outline,maximumHeights:this.maximumHeights,minimumHeights:this.minimumHeights,outlineColor:Cesium.Color.fromCssColorString(i.outlineColor),outlineWidth:i.outlineWidth,shadows:CgsEllipsoid.SHADOWS[i.shadows],distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(i.distanceDisplayCondition)}}:{name:i.name,wall:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(this.getPositionValue(i.positions)),show:i.show,fill:i.fill,material:Cesium.Color.fromCssColorString(i.fillColor),outline:i.outline,maximumHeights:this.maximumHeights,minimumHeights:this.minimumHeights,outlineColor:Cesium.Color.fromCssColorString(i.outlineColor),outlineWidth:i.outlineWidth,shadows:CgsEllipsoid.SHADOWS[i.shadows],distanceDisplayCondition:CgsFeature.checkDistanceDisplayCondition(i.distanceDisplayCondition)}},e.temp=t,e.pos=i.positions[0],CgsFeature3D.call(this,e)},CgsInherits(CgsWall3D,CgsFeature3D),CgsWall3D.prototype.setPosition=function(e){this.state.positions=e;var t=this.getPositionValue(e);var i=Cesium.Cartesian3.fromDegreesArrayHeights(t);this.entity.wall.positions=i,null!=this.label&&this.label.setPosition(e[0])},CgsWall3D.prototype.getPosition=function(){return this.state.positions},CgsWall3D.prototype.setFill=function(e){this.state.fill=e,this.entity.wall.fill=e},CgsWall3D.prototype.getFill=function(){return this.state.fill},CgsWall3D.prototype.setFillColor=function(e){this.state.fillColor=e,this.entity.wall.material=Cesium.Color.fromCssColorString(e)},CgsWall3D.prototype.getFillColor=function(){return this.state.fillColor},CgsWall3D.prototype.setOutline=function(e){this.state.outline=e,this.entity.wall.outline=e},CgsWall3D.prototype.getOutline=function(){return this.state.outline},CgsWall3D.prototype.setOutlineColor=function(e){this.state.outlineColor=e,this.entity.wall.outlineColor=Cesium.Color.fromCssColorString(e)},CgsWall3D.prototype.getOutlineColor=function(){return this.state.outlineColor},CgsWall3D.prototype.setOutlineWidth=function(e){this.state.outlineWidth=e,this.entity.wall.outlineWidth=e},CgsWall3D.prototype.getOutlineWidth=function(){return this.state.outlineWidth},CgsWall3D.prototype.setShadows=function(e){this.state.shadows=e,this.entity.wall.shadows=CgsWall3D.SHADOWS[e]},CgsWall3D.prototype.getShadows=function(){return this.state.shadows},CgsWall3D.prototype.setVisibleHeight=function(e){this.state.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.state.distanceDisplayCondition);this.entity.wall.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsWall3D.prototype.getVisibleHeight=function(){return this.state.distanceDisplayCondition},CgsWall3D.SHADOWS={DISABLED:Cesium.ShadowMode.DISABLED,CAST_ONLY:Cesium.ShadowMode.CAST_ONLY,ENABLED:Cesium.ShadowMode.ENABLED,RECEIVE_ONLY:Cesium.ShadowMode.RECEIVE_ONLY},CgsCylinder3D=function(e){e.type="CgsCylinder",null==e?(this.position=[121,45,2e5],this.fillColor="rgba(0,255,0,1.0)",this.outlineColor="rgba(0,255,0,1.0)",this.length=4e5,this.name="",this.topRadius=0,this.bottomRadius=2e5,this.outline=!1,this.fillFlag=!0,this.verticalLines=16,this.slices=128,this.distanceDisplayCondition=0):(null==e.position?this.position=[121,45,2e5]:this.position=e.position,null==e.fillColor?this.fillColor="rgba(0,255,0,1.0)":this.fillColor=e.fillColor,null==e.outlineColor?this.outlineColor=this.fillColor:this.outlineColor=e.outlineColor,null==e.name?this.name="":this.name=e.name,null==e.length?this.length=4e5:this.length=e.length,null==e.topRadius?this.topRadius=0:this.topRadius=e.topRadius,null==e.bottomRadius?this.bottomRadius=4e5:this.bottomRadius=e.bottomRadius,null==e.outline?this.outline=!0:this.outline=e.outline,null==e.fillFlag?this.fillFlag=!0:this.fillFlag=e.fillFlag,e.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0,this.verticalLines=Cesium.defaultValue(e.verticalLines,16),this.slices=Cesium.defaultValue(e.slices,128)),this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(this.distanceDisplayCondition);var t=this.position,i={position:Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]),name:this.name,cylinder:{length:this.length,topRadius:this.topRadius,bottomRadius:this.bottomRadius,fill:this.fillFlag,material:Cesium.Color.fromCssColorString(this.fillColor),outline:this.outline,outlineColor:Cesium.Color.fromCssColorString(this.outlineColor),numberOfVerticalLines:this.verticalLines,slices:this.slices}};e.temp=i,e.pos=this.position,CgsFeature3D.call(this,e)},CgsInherits(CgsCylinder3D,CgsFeature3D),CgsCylinder3D.prototype.getTemp=function(){return this.temp},CgsCylinder3D.prototype.getPos=function(){return this.temppos},CgsCylinder3D.prototype.setPosition=function(e){this.position=e;var t=null;t=3==e.length?Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):Cesium.Cartesian3.fromDegrees(e[0],e[1]),this.entity.position=t,null!=this.label&&this.label.setPosition(e)},CgsCylinder3D.prototype.getPosition=function(){return this.position},CgsCylinder3D.prototype.setLength=function(e){this.length=e,this.entity.cylinder.length=e},CgsCylinder3D.prototype.getLength=function(){return this.length},CgsCylinder3D.prototype.setTopRadius=function(e){this.topRadius=e,this.entity.cylinder.topRadius=this.topRadius},CgsCylinder3D.prototype.getTopRadius=function(){return this.topRadius},CgsCylinder3D.prototype.setBottomRadius=function(e){this.bottomRadius=e,this.entity.cylinder.bottomRadius=this.bottomRadius},CgsCylinder3D.prototype.getBottomRadius=function(){return this.bottomRadius},CgsCylinder3D.prototype.setFillFlag=function(e){this.fillFlag=e,this.entity.cylinder.fill=e},CgsCylinder3D.prototype.getFillFlag=function(){return this.fillFlag},CgsCylinder3D.prototype.setFillColor=function(e){this.fillColor=e,this.entity.cylinder.material=Cesium.Color.fromCssColorString(e);var t=this;setTimeout(function(){t.entity.cylinder.material=Cesium.Color.fromCssColorString(t.getFillColor())},50)},CgsCylinder3D.prototype.getFillColor=function(){return this.fillColor},CgsCylinder3D.prototype.setOutlineFlag=function(e){this.outline=e,this.entity.cylinder.outline=e},CgsCylinder3D.prototype.getOutlineFlag=function(){return this.outline},CgsCylinder3D.prototype.setOutline=function(e){this.outline=e,this.entity.cylinder.outline=e},CgsCylinder3D.prototype.getOutline=function(){return this.outline},CgsCylinder3D.prototype.setOutlineColor=function(e){this.outlineColor=e,this.entity.cylinder.outlineColor=Cesium.Color.fromCssColorString(e);var t=this;setTimeout(function(){t.entity.cylinder.outlineColor=Cesium.Color.fromCssColorString(t.getOutlineColor())},50)},CgsCylinder3D.prototype.getOutlineColor=function(){return this.outlineColor},CgsCylinder3D.prototype.setVerticalLines=function(e){this.verticalLines=e,this.entity.cylinder.numberOfVerticalLines=e},CgsCylinder3D.prototype.getVerticalLines=function(){return this.verticalLines},CgsCylinder3D.prototype.setSlices=function(e){this.slices=e,this.entity.cylinder.slices=e},CgsCylinder3D.prototype.getSlices=function(){return this.slices},CgsCylinder3D.prototype.setVisibleHeight=function(e){this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e);var t=CgsFeature.checkDistanceDisplayCondition(this.distanceDisplayCondition);this.entity.cylinder.distanceDisplayCondition=t,null!=this.label&&this.label.setVisibleHeight(e)},CgsCylinder3D.prototype.getVisibleHeight=function(){return this.distanceDisplayCondition},CgsRadar3D=function(e){this._show=Cesium.defaultValue(e.show,!0),this._type=void 0,this._primitive=void 0,this._map=void 0,this._id=void 0,this._feature=void 0,this.selfType=e.selfType,this.saveFlag=Cesium.defaultValue(e.saveFlag,!0);this.leftDownEvent=void 0,this._pickEnable=!1},CgsRadar3D.prototype.setPickEnable=function(e){this._pickEnable=e,null!=this._primitive.picking&&(this._primitive.picking=e)},CgsRadar3D.prototype.getPickEnable=function(){return this._pickEnable},CgsRadar3D.prototype._setEvents=function(){var g=this,e=CgsSubPub.subscribe("leftdown",function(e,a,n){var t,r,i,s,o,l,u,p;function h(){if(r){var e;r.camera.position;return n?(e=r.cesiumWidget.allViewports[n-1].screenSpaceEventHandler,r.scene.pick({x:a.x,y:a.y},3,3,e)):r.scene.pick({x:a.x,y:a.y})}}function c(){for(var e=g.getBoundingSphere(),t=n?r.cesiumWidget.allViewports[n-1].camera:r.camera,i=t.getPickRay(a),s=!1,o=0;o<e.length;++o)if(Cesium.IntersectionTests.rayTriangle(i,e[o][0],e[o][1],e[o][2],!1,new Cesium.Cartesian3)){s=!0;break}return s}g._pickEnable&&(t=g.getType(),(r=g.getMap())&&(null!=r.pickedRadar&&r.pickedRadarColor&&(r.pickedRadar instanceof CgsLayerRadar3D?(r.pickedRadar.setColor(r.pickedRadarColor),r.pickedRadar.setLineColor(r.pickedRadarColor),r.pickedRadar=void 0,r.pickedRadarColor=void 0):r.pickedRadar instanceof CgsPhaseArrayRadar3D?(r.pickedRadar.setSurfaceColor(r.pickedRadarColor),r.pickedRadar.setLineColor(r.pickedRadarLineColor),r.pickedRadar=void 0,r.pickedRadarColor=void 0,r.pickedRadarLineColor=void 0):(r.pickedRadar.setColor(r.pickedRadarColor),r.pickedRadar=void 0,r.pickedRadarColor=void 0)),i=!1,t==CgsRadar3D.AIRBORNE_RADAR?i=null!=(s=h())&&(s.id==CgsAirborneRadar3D.URDL||s.id==CgsAirborneRadar3D.FACE):t==CgsRadar3D.GROUND_RADAR||t==CgsRadar3D.PHASEARRAY_RADAR?i=!!(o=g.getBoundingSphere(),l=n?r.cesiumWidget.allViewports[n-1].camera:r.camera,u=l.getPickRay(a),p=!1,Cesium.IntersectionTests.raySphere(u,o,new Cesium.Cartesian3)&&(p=!0),p):t==CgsRadar3D.SCAN_RADAR?i=null!=(s=h())&&s.id==CgsScanRadar3D.FACE||!!c():t==CgsRadar3D.SATELLITE_RADAR?i=null!=(s=h())&&s.id==CgsSatelliteRadar3D.SatelliteRadar:t!=CgsRadar3D.RO_RADAR&&t!=CgsRadar3D.PLANESCAN_RADAR&&t!=CgsRadar3D.AIR_RADAR&&t!=CgsRadar3D.SPREAD_RADAR&&t!=CgsRadar3D.SEARCH_RADAR&&t!=CgsRadar3D.DYNTRANS&&t!=CgsRadar3D.LAYER_RADAR&&t!=CgsRadar3D.PLANE_RADAR||(i=!!c()),i&&(g instanceof CgsLayerRadar3D?(r.pickedRadar=g,r.pickedRadarColor=g.getColor(),g.setColor(r.getPickColor()),g.setLineColor(r.getPickColor())):g instanceof CgsPhaseArrayRadar3D?(r.pickedRadar=g,r.pickedRadarColor=g.getSurfaceColor(),r.pickedRadarLineColor=g.getLineColor(),g.setSurfaceColor(r.getPickColor()),g.setLineColor(r.getPickColor())):(r.pickedRadar=g,r.pickedRadarColor=g.getColor(),g.setColor(r.getPickColor())))))});this.leftDownEvent=e},CgsRadar3D.prototype._unsetEvents=function(){CgsSubPub.unsubscribe(this.leftDownEvent)},CgsRadar3D.prototype.setElement=function(e){this._feature=e},CgsRadar3D.prototype.getPrimitive=function(){return null==this._primitive&&this._feature._updateGeometry(),this._primitive},CgsRadar3D.prototype.setPrimitive=function(e){this._primitive=e},CgsRadar3D.prototype.getType=function(){return this._type},CgsRadar3D.prototype.getSelfType=function(){return this.selfType},CgsRadar3D.prototype.setVisible=function(e){this._show=e,this._primitive.show=e},CgsRadar3D.prototype.getVisible=function(){return this._show},CgsRadar3D.prototype.setMap=function(e){this._map=e},CgsRadar3D.prototype.getMap=function(){return this._map},CgsRadar3D.prototype.getFeature=function(){return this._feature},CgsRadar3D.prototype.setFeature=function(e){this._feature=e},CgsRadar3D.prototype.getId=function(){return this._id},CgsRadar3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsRadar3D.prototype.setSaveFlag=function(e){return this.saveFlag=e},CgsRadar3D.RADAR_TYPE_1="GroundRadar",CgsRadar3D.RADAR_TYPE_2="SearchRadar",CgsRadar3D.RADAR_TYPE_3="AirRadar",CgsRadar3D.RADAR_TYPE_4="SpreadRadar",CgsRadar3D.RADAR_TYPE_5="Cone",CgsRadar3D.RADAR_TYPE_5="AirBorneRadar",CgsRadar3D.RADAR_TYPE_6="ScanRadar",CgsRadar3D.RADAR_TYPE_7="LayerRadar",CgsRadar3D.RADAR_TYPE_8="cylinderTrans",CgsRadar3D.RADAR_TYPE_9="SatelliteRadar",CgsRadar3D.GROUND_RADAR="GroundRadar",CgsRadar3D.SEARCH_RADAR="SearchRadar",CgsRadar3D.AIR_RADAR="AirRadar",CgsRadar3D.SPREAD_RADAR="SpreadRadar",CgsRadar3D.PLANE_RADAR="Cone",CgsRadar3D.AIRBORNE_RADAR="AirBorneRadar",CgsRadar3D.SCAN_RADAR="ScanRadar",CgsRadar3D.PLANESCAN_RADAR="PlaneScanRadar",CgsRadar3D.LAYER_RADAR="LayerRadar",CgsRadar3D.RO_RADAR="RORadar",CgsRadar3D.DYNTRANS="cylinderTrans",CgsRadar3D.SATELLITE_RADAR="SatelliteRadar",CgsRadar3D.PHASEARRAY_RADAR="phaseArrayRadar",CgsGroundRadar3D=function(e){var t=Cesium.defaultValue(e.position,void 0);if(!Cesium.defined(t))return"not radar position";this._position=[],3!==t.length?(this._position.push(t[0]),this._position.push(t[1]),this._position.push(0)):this._position=t;var i=this;this._radius=Cesium.defaultValue(e.radius,500),this._color=Cesium.defaultValue(e.color,"rgba(255.0,0.0,0.0,0.8)"),this._speed=Cesium.defaultValue(e.speed,1);var s=Cesium.defaultValue(e.show,!0);this._stackPartitions=32,this._slicePartitions=32,this._minRadius=Cesium.defaultValue(e.minRadius,0),this._maxRadius=Cesium.defaultValue(e.maxRadius,this._radius),CgsRadar3D.call(this,e),this._type=CgsRadar3D.RADAR_TYPE_1,this.selfType="CgsGroundRadar",this._moveDirection=!0,this._changeRadius=this._radius;(new Date).toString();e={position:Cesium.Cartesian3.fromDegrees(this._position[0],this._position[1],this._position[2]),ellipsoid:{radii:new Cesium.Cartesian3(i._radius,i._radius,i._radius),fill:!1,show:s,outline:!0,outlineColor:Cesium.Color.fromCssColorString(this._color),slicePartitions:i._slicePartitions,stackPartitions:i._stackPartitions}};this._primitive=new Cesium.Entity(e),this._changeRadius=this._minRadius,this.updatePosition=function(){return i._changeRadius>i._maxRadius&&(i._changeRadius=i._minRadius),i._changeRadius+=3*i._speed,new Cesium.Cartesian3(i._changeRadius,i._changeRadius,i._changeRadius)},this._callback=new Cesium.CallbackProperty(i.updatePosition,!1),this._primitive.ellipsoid.radii=this._callback},CgsInherits(CgsGroundRadar3D,CgsRadar3D),CgsGroundRadar3D.prototype.getBoundingSphere=function(){var e=Cesium.Cartesian3.fromDegrees(this._position[0],this._position[1],this._position[2]),t=this._changeRadius;return new Cesium.BoundingSphere(e,t)},CgsGroundRadar3D.prototype.setPosition=function(e){this._position=e,this._primitive.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2])},CgsGroundRadar3D.prototype.getPosition=function(){return this._position},CgsGroundRadar3D.prototype.setRadius=function(e){this._radius=e},CgsGroundRadar3D.prototype.getRadius=function(){return this._radius},CgsGroundRadar3D.prototype.setColor=function(e){this._color=e,this._primitive.ellipsoid.outlineColor=Cesium.Color.fromCssColorString(e)},CgsGroundRadar3D.prototype.getColor=function(){return this._color},CgsGroundRadar3D.prototype.setSpeed=function(e){this._speed=e},CgsGroundRadar3D.prototype.getSpeed=function(){return this._speed},CgsGroundRadar3D.prototype.setMinRadius=function(e){this._minRadius=e},CgsGroundRadar3D.prototype.getMinRadius=function(){return this._minRadius},CgsGroundRadar3D.prototype.setMaxRadius=function(e){this._radius<e&&(e=this._radius),this._maxRadius=e},CgsGroundRadar3D.prototype.getMaxRadius=function(){return this._maxRadius},CgsGroundRadar3D.prototype.start=function(e){this._callback=new Cesium.CallbackProperty(this.updatePosition,!1)},CgsGroundRadar3D.prototype.stop=function(){this._callback=new Cesium.CallbackProperty(new Cesium.Cartesian3(0,0,0),!0)},CgsSearchRadar3D=function(e){if(this._position=Cesium.defaultValue(e.position,void 0),!Cesium.defined(this._position))return"not radar position";this._angle=Cesium.defaultValue(e.angle,30),this._radius=Cesium.defaultValue(e.radius,500),this._distance=Cesium.defaultValue(e.distance,1e3),this._color=Cesium.defaultValue(e.color,"rgba(255.0,0.0,0.0,0.8)"),this._scale=Cesium.defaultValue(e.scale,1),this._heading=Cesium.defaultValue(e.heading,0),this._pitch=Cesium.defaultValue(e.pitch,0),this._speed=Cesium.defaultValue(e.speed,1);Cesium.defaultValue(e.show,!0);CgsRadar3D.call(this,e),this._type=CgsRadar3D.RADAR_TYPE_2,this.selfType="CgsSearchRadar",this._modelMatrix=void 0,this._bottomMatrix=void 0,this._moveAngle=this._angle,this._moveDirection=!0,this._start=!0;var t=2*Cesium.Math.toDegrees(Math.tan(this._radius/this._distance)),i={position:this._position,angle:t,length:this._distance,color:Cesium.Color.fromCssColorString(this._color),scale:this._scale,heading:this._heading,pitch:this._pitch,show:!0,roll:this._roll,type:1};this._primitive=new Cesium.FeRadarEffect(i)},CgsInherits(CgsSearchRadar3D,CgsRadar3D);CgsSearchRadar3D.prototype.getBoundingSphere=function(){return this._primitive.boundingSphere},CgsSearchRadar3D.prototype._update=function(){Cesium.defined(this._primitive)&&(0<Math.abs(this._angle)&&this._start&&(this._moveAngle>=this._angle?this._moveDirection=!0:this._moveAngle<=-this._angle&&(this._moveDirection=!1),this._moveDirection?this._moveAngle-=.1*this._speed:this._moveAngle+=.1*this._speed),this._primitive.roll=this._moveAngle)},CgsSearchRadar3D.prototype.setPosition=function(e){2==(this._position=e).length&&e.push(0),this._primitive.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2])},CgsSearchRadar3D.prototype.getPosition=function(){return this._position},CgsSearchRadar3D.prototype.setAngle=function(e){this._angle=e,this._primitive._angle=e},CgsSearchRadar3D.prototype.getAngle=function(){return this._angle},CgsSearchRadar3D.prototype.setRadius=function(e){this._radius=e,this._updateGeometry()},CgsSearchRadar3D.prototype.getRadius=function(){return this._radius},CgsSearchRadar3D.prototype.setDistance=function(e){this._distance=e,this._updateGeometry()},CgsSearchRadar3D.prototype.getDistance=function(){return this._distance},CgsSearchRadar3D.prototype.setScale=function(e){this._scale=e,this._primitive.scale=this._scale},CgsSearchRadar3D.prototype.getScale=function(){return this._scale},CgsSearchRadar3D.prototype.setHeading=function(e){this._heading=e,this._primitive.heading=this._heading},CgsSearchRadar3D.prototype.getHeading=function(){return this._heading},CgsSearchRadar3D.prototype.setPitch=function(e){this._pitch=e,this._primitive.pitch=this._pitch},CgsSearchRadar3D.prototype.getPitch=function(){return this._pitch},CgsSearchRadar3D.prototype.setSpeed=function(e){this._speed=e,this._primitive._speed=this._speed},CgsSearchRadar3D.prototype.getSpeed=function(){return this._speed},CgsSearchRadar3D.prototype.setColor=function(e){this._color=e,this._primitive.baseColor=e},CgsSearchRadar3D.prototype.getColor=function(){return this._color},CgsSearchRadar3D.prototype.start=function(){this._start=!0},CgsSearchRadar3D.prototype.stop=function(){this._start=!1},CgsSearchRadar3D.prototype._updateGeometry=function(){var e=this.getVisible(),t=this.getMap();t instanceof CgsMap&&(t=t.map3D),Cesium.defined(t)&&t instanceof CgsMap3D&&t.scene.primitives.contains(this._primitive)&&(t.scene.primitives.remove(this._primitive),this._primitive=void 0);var i=2*Cesium.Math.toDegrees(Math.tan(this._radius/this._distance)),s={position:this._position,angle:i,show:e,length:this._distance,color:Cesium.Color.fromCssColorString(this._color),scale:this._scale,heading:this._heading,pitch:this._pitch,roll:this._roll,type:1};this._primitive=new Cesium.FeRadarEffect(s),Cesium.defined(t)&&t.scene.primitives.add(this._primitive)},CgsSearchRadar3D.SEARCHRADAR="searchradar",CgsAirRadar3D=function(e){if(this._position=Cesium.defaultValue(e.position,void 0),!Cesium.defined(this._position))return"not radar position";2==this._position.length&&this._position.push(0);this._angle=Cesium.defaultValue(e.angle,30),this._length=Cesium.defaultValue(e.length,500),this._color=Cesium.defaultValue(e.color,"rgba(255.0,255.0,255.0,0.1)"),this._waveColor=Cesium.defaultValue(e.waveColor,"rgba(0.0,255.0,0.0,1.0)"),this._scale=Cesium.defaultValue(e.scale,1),this._heading=Cesium.defaultValue(e.heading,0),this._pitch=Cesium.defaultValue(e.pitch,0),this._roll=Cesium.defaultValue(e.roll,0),this._speed=Cesium.defaultValue(e.speed,1e5),this._waveWidth=Cesium.defaultValue(e.waveWidth,1);var t=Cesium.defaultValue(e.show,!0);this._waveNum=Cesium.defaultValue(e.waveNum,10),this._waveNum=Math.min(this._waveNum,10),this._waveWidth=Math.min(this._waveWidth,5),CgsRadar3D.call(this,e),this._type=CgsRadar3D.RADAR_TYPE_3,this.selfType="CgsAirRadar";var i={position:this._position,angle:this._angle,length:this._length,color:Cesium.Color.fromCssColorString(this._color),waveColor:Cesium.Color.fromCssColorString(this._waveColor),scale:this._scale,heading:this._heading,pitch:this._pitch,roll:this._roll,waveNum:this._waveNum,speed:this._speed,show:t,waveWidth:this._waveWidth};this._primitive=new Cesium.FeRadarEffect(i)},CgsInherits(CgsAirRadar3D,CgsRadar3D),CgsAirRadar3D.prototype.getBoundingSphere=function(){return this._primitive.boundingSphere},CgsAirRadar3D.prototype.setPosition=function(e){2==(this._position=e).length&&e.push(0),this._primitive.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2])},CgsAirRadar3D.prototype.getPosition=function(){return this._position},CgsAirRadar3D.prototype.setWaveNum=function(e){this._waveNum=e,this._waveNum=Math.min(this._waveNum,10),this._updateGeometry()},CgsAirRadar3D.prototype.getWaveNum=function(){return this._waveNum},CgsAirRadar3D.prototype.setWaveWidth=function(e){this._waveWidth=e,this._waveWidth=Math.min(this._waveWidth,5),this._updateGeometry()},CgsAirRadar3D.prototype.getWaveWidth=function(){return this._waveWidth},CgsAirRadar3D.prototype.setAngle=function(e){this._angle=e,this._updateGeometry()},CgsAirRadar3D.prototype.getAngle=function(){return this._angle},CgsAirRadar3D.prototype.setLength=function(e){this._length=e,this._updateGeometry()},CgsAirRadar3D.prototype.getLength=function(){return this._length},CgsAirRadar3D.prototype.setScale=function(e){this._scale=e,this._primitive.scale=e},CgsAirRadar3D.prototype.getScale=function(){return this._scale},CgsAirRadar3D.prototype.setHeading=function(e){this._heading=e,this._primitive.heading=e},CgsAirRadar3D.prototype.getHeading=function(){return this._heading},CgsAirRadar3D.prototype.setPitch=function(e){this._pitch=e,this._primitive.pitch=e},CgsAirRadar3D.prototype.getPitch=function(){return this._pitch},CgsAirRadar3D.prototype.setRoll=function(e){this._roll=e,this._primitive.roll=e},CgsAirRadar3D.prototype.getRoll=function(){return this._roll},CgsAirRadar3D.prototype.setSpeed=function(e){this._speed=e,this._primitive.speed=e},CgsAirRadar3D.prototype.getSpeed=function(){return this._speed},CgsAirRadar3D.prototype.setColor=function(e){this._color=e,this._primitive.baseColor=e},CgsAirRadar3D.prototype.getColor=function(){return this._color},CgsAirRadar3D.prototype.setWaveColor=function(e){this._waveColor=e,this._primitive.waveColor=e},CgsAirRadar3D.prototype.getWaveColor=function(){return this._waveColor},CgsAirRadar3D.prototype._updateGeometry=function(){var e=this.getVisible(),t=this.getMap();t instanceof CgsMap&&(t=t.map3D),Cesium.defined(t)&&t instanceof CgsMap3D&&t.scene.primitives.contains(this._primitive)&&(t.scene.primitives.remove(this._primitive),this._primitive=void 0);var i={position:this._position,show:e,angle:this._angle,length:this._length,color:Cesium.Color.fromCssColorString(this._color),waveColor:Cesium.Color.fromCssColorString(this._waveColor),scale:this._scale,heading:this._heading,pitch:this._pitch,roll:this._roll,speed:this._speed,waveWidth:this._waveWidth};this._primitive=new Cesium.FeRadarEffect(i),Cesium.defined(t)&&t.scene.primitives.add(this._primitive)},CgsSpreadRadar3D=function(e){if(this._position=Cesium.defaultValue(e.position,void 0),!Cesium.defined(this._position))return"not radar position";2==this._position.length&&this._position.push(0);this._radius=Cesium.defaultValue(e.radius,500),this._color=Cesium.defaultValue(e.color,"rgba(255.0,255.0,255.0,0.1)"),this._waveColor=Cesium.defaultValue(e.waveColor,"rgba(0.0,255.0,0.0,1.0)"),this._scale=Cesium.defaultValue(e.scale,1),this._speed=Cesium.defaultValue(e.speed,1e3),this._waveNum=Cesium.defaultValue(e.waveNum,10),this._waveWidth=Cesium.defaultValue(e.waveWidth,1);var t=Cesium.defaultValue(e.show,!0);this._waveNum=Math.min(this._waveNum,10),this._waveWidth=Math.min(this._waveWidth,5),this._angle=Cesium.defaultValue(e.angle,30),this._heading=Cesium.defaultValue(e.heading,0),this._pitch=Cesium.defaultValue(e.pitch,0),this._roll=Cesium.defaultValue(e.roll,0),CgsRadar3D.call(this,e),this._type=CgsRadar3D.SPREAD_RADAR,this.selfType="CgsSpreadRadar";var i={position:this._position,radius:this._radius,color:Cesium.Color.fromCssColorString(this._color),waveColor:Cesium.Color.fromCssColorString(this._waveColor),scale:this._scale,waveNum:this._waveNum,speed:this._speed,show:t,angle:this._angle,heading:this._heading+this._angle/2,pitch:this._pitch,roll:this._roll,waveWidth:this._waveWidth,type:2};this._primitive=new Cesium.FeRadarEffect(i)},CgsInherits(CgsSpreadRadar3D,CgsRadar3D),CgsSpreadRadar3D.prototype.getBoundingSphere=function(){return this._primitive.boundingSphere},CgsSpreadRadar3D.prototype.setPosition=function(e){2==(this._position=e).length&&e.push(0),this._primitive.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2])},CgsSpreadRadar3D.prototype.getPosition=function(){return this._position},CgsSpreadRadar3D.prototype.setWaveWidth=function(e){this._waveWidth=e,this._waveWidth=Math.min(this._waveWidth,5),this._updateGeometry()},CgsSpreadRadar3D.prototype.getWaveWidth=function(){return this._waveWidth},CgsSpreadRadar3D.prototype.setRadius=function(e){this._radius=e,this._updateGeometry()},CgsSpreadRadar3D.prototype.getRadius=function(){return this._radius},CgsSpreadRadar3D.prototype.setScale=function(e){this._scale=e,this._primitive.scale=e},CgsSpreadRadar3D.prototype.getScale=function(){return this._scale},CgsSpreadRadar3D.prototype.setSpeed=function(e){this._speed=e,this._primitive.speed=e},CgsSpreadRadar3D.prototype.getSpeed=function(){return this._speed},CgsSpreadRadar3D.prototype.setColor=function(e){this._color=e,this._primitive.baseColor=e},CgsSpreadRadar3D.prototype.getColor=function(){return this._color},CgsSpreadRadar3D.prototype.setWaveColor=function(e){this._waveColor=e,this._primitive.waveColor=e},CgsSpreadRadar3D.prototype.getWaveColor=function(){return this._waveColor},CgsSpreadRadar3D.prototype.setAngle=function(e){this._angle=e,this._updateGeometry()},CgsSpreadRadar3D.prototype.getAngle=function(){return this._angle},CgsSpreadRadar3D.prototype.setHeading=function(e){this._heading=e,this._primitive.heading=e+this._angle/2},CgsSpreadRadar3D.prototype.getHeading=function(){return this._heading},CgsSpreadRadar3D.prototype.setPitch=function(e){this._pitch=e,this._primitive.pitch=e},CgsSpreadRadar3D.prototype.getPitch=function(){return this._pitch},CgsSpreadRadar3D.prototype.setRoll=function(e){this._roll=e,this._primitive.roll=e},CgsSpreadRadar3D.prototype.getRoll=function(){return this._roll},CgsSpreadRadar3D.prototype._updateGeometry=function(){var e=this.getVisible(),t=this.getMap();t instanceof CgsMap&&(t=t.map3D),Cesium.defined(t)&&t instanceof CgsMap3D&&t.scene.primitives.contains(this._primitive)&&(t.scene.primitives.remove(this._primitive),t.scene.primitives.remove(this._primitive),this._primitive=void 0);var i={position:this._position,radius:this._radius,show:e,color:Cesium.Color.fromCssColorString(this._color),waveColor:Cesium.Color.fromCssColorString(this._waveColor),scale:this._scale,speed:this._speed,angle:this._angle,heading:this._heading+this._angle/2,pitch:this._pitch,roll:this._roll,waveWidth:this._waveWidth,type:2};this._primitive=new Cesium.FeRadarEffect(i),Cesium.defined(t)&&t.scene.primitives.add(this._primitive)},CgsAirborneRadar3D=function(e){this.map=null,this.position=Cesium.defaultValue(e.position,[120.3,23.5,1e4]),this.color=Cesium.defaultValue(e.color,"rgba(255,0,0,0.8)"),this.radius=Cesium.defaultValue(e.radius,1e5),this.hAngle=Cesium.defaultValue(e.hAngle,60),this.vAngle=Cesium.defaultValue(e.vAngle,30),this.hStep=Cesium.defaultValue(e.hStep,1),this.vStep=Cesium.defaultValue(e.vStep,1),this.show=Cesium.defaultValue(e.show,!0),this.heading=Cesium.defaultValue(e.heading,0),this.pitch=Cesium.defaultValue(e.pitch,0),this.roll=Cesium.defaultValue(e.roll,0),this.scale=Cesium.defaultValue(e.scale,1),this.ids=[],this.type="AirBorneRadar",this._primitive,this.center,this.surfaceVert,this.upVert,this.downVert,this.leftVert,this.rightVert,this.translation=void 0,this.modelMatrix,this.faceInstance,this.upInstance,this.downInstance,this.leftInstance,this.rightInstance,this.facePrimitive,this.upPrimitive,this.downPrimitive,this.leftPrimitive,this.rightPrimitive,CgsRadar3D.call(this,e),this.calculate(),this.createPrimitives()},CgsInherits(CgsAirborneRadar3D,CgsRadar3D),CgsAirborneRadar3D.prototype.calculate=function(){Cesium.Math.toRadians(this.hAngle);var e=Cesium.Math.toRadians(this.vAngle),t=(Cesium.Math.toRadians(this.hStep),Cesium.Math.toRadians(this.vStep),Cesium.Math.toRadians(this.heading)),i=Cesium.Math.toRadians(this.pitch),s=Cesium.Math.toRadians(this.roll);this.center=[],this.center.push(this.position[0]),this.center.push(this.position[1]),this.center.push(this.position[2]+this.radius*Math.sin(e/2));Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2]),Cesium.Cartesian3.fromDegrees(this.center[0],this.center[1],this.center[2]);this.translation=new Cesium.Cartesian3(0,0,this.radius*Math.sin(e/2));var o=Cesium.Matrix3.fromRotationZ(t),a=Cesium.Matrix3.fromRotationY(s),n=Cesium.Matrix3.fromRotationX(i),r=Cesium.Matrix3.multiply(o,a,new Cesium.Matrix3),l=Cesium.Matrix3.multiply(r,n,new Cesium.Matrix3),u=Cesium.Matrix3.fromScale(new Cesium.Cartesian3(this.scale,this.scale,this.scale));this.modelMatrix=Cesium.Matrix4.multiplyByMatrix3(Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2])),Cesium.Matrix3.multiply(l,u,new Cesium.Matrix3),new Cesium.Matrix4),this.calcFace(),this.calcUDLR()},CgsAirborneRadar3D.prototype.calcFace=function(){if("[object Array]"==Object.prototype.toString.call(this.surfaceVert)&&0<this.surfaceVert.length)for(;0<this.surfaceVert.length;)this.surfaceVert.pop();else this.surfaceVert=new Array;for(var e=Cesium.Math.toRadians(this.hAngle),t=Cesium.Math.toRadians(this.vAngle),i=Cesium.Math.toRadians(this.hStep),s=Cesium.Math.toRadians(this.vStep),o=-t/2;o+s<=t/2;o+=s){for(var a=-e/2;a+i<=e/2;a+=i){var n=this.radius*Math.cos(o)*Math.sin(a),r=this.radius*Math.cos(o)*Math.cos(a),l=this.radius*Math.sin(o),u=this.radius*Math.cos(o+s)*Math.sin(a),p=this.radius*Math.cos(o+s)*Math.cos(a),h=this.radius*Math.sin(o+s),c=this.radius*Math.cos(o)*Math.sin(a+i),g=this.radius*Math.cos(o)*Math.cos(a+i),d=this.radius*Math.sin(o),m=this.radius*Math.cos(o+s)*Math.sin(a+i),f=this.radius*Math.cos(o+s)*Math.cos(a+i),C=this.radius*Math.sin(o+s);this.surfaceVert.push(n),this.surfaceVert.push(r),this.surfaceVert.push(l),this.surfaceVert.push(u),this.surfaceVert.push(p),this.surfaceVert.push(h),this.surfaceVert.push(c),this.surfaceVert.push(g),this.surfaceVert.push(d),this.surfaceVert.push(u),this.surfaceVert.push(p),this.surfaceVert.push(h),this.surfaceVert.push(c),this.surfaceVert.push(g),this.surfaceVert.push(d),this.surfaceVert.push(m),this.surfaceVert.push(f),this.surfaceVert.push(C)}n=this.radius*Math.cos(o)*Math.sin(a),r=this.radius*Math.cos(o)*Math.cos(a),l=this.radius*Math.sin(o),u=this.radius*Math.cos(o+s)*Math.sin(a),p=this.radius*Math.cos(o+s)*Math.cos(a),h=this.radius*Math.sin(o+s),c=this.radius*Math.cos(o)*Math.sin(e/2),g=this.radius*Math.cos(o)*Math.cos(e/2),d=this.radius*Math.sin(o),m=this.radius*Math.cos(o+s)*Math.sin(e/2),f=this.radius*Math.cos(o+s)*Math.cos(e/2),C=this.radius*Math.sin(o+s);this.surfaceVert.push(n),this.surfaceVert.push(r),this.surfaceVert.push(l),this.surfaceVert.push(u),this.surfaceVert.push(p),this.surfaceVert.push(h),this.surfaceVert.push(c),this.surfaceVert.push(g),this.surfaceVert.push(d),this.surfaceVert.push(u),this.surfaceVert.push(p),this.surfaceVert.push(h),this.surfaceVert.push(c),this.surfaceVert.push(g),this.surfaceVert.push(d),this.surfaceVert.push(m),this.surfaceVert.push(f),this.surfaceVert.push(C)}for(a=-e/2;a+i<=e/2;a+=i){n=this.radius*Math.cos(o)*Math.sin(a),r=this.radius*Math.cos(o)*Math.cos(a),l=this.radius*Math.sin(o),u=this.radius*Math.cos(t/2)*Math.sin(a),p=this.radius*Math.cos(t/2)*Math.cos(a),h=this.radius*Math.sin(t/2),c=this.radius*Math.cos(o)*Math.sin(a+i),g=this.radius*Math.cos(o)*Math.cos(a+i),d=this.radius*Math.sin(o),m=this.radius*Math.cos(t/2)*Math.sin(a+i),f=this.radius*Math.cos(t/2)*Math.cos(a+i),C=this.radius*Math.sin(t/2);this.surfaceVert.push(n),this.surfaceVert.push(r),this.surfaceVert.push(l),this.surfaceVert.push(u),this.surfaceVert.push(p),this.surfaceVert.push(h),this.surfaceVert.push(c),this.surfaceVert.push(g),this.surfaceVert.push(d),this.surfaceVert.push(u),this.surfaceVert.push(p),this.surfaceVert.push(h),this.surfaceVert.push(c),this.surfaceVert.push(g),this.surfaceVert.push(d),this.surfaceVert.push(m),this.surfaceVert.push(f),this.surfaceVert.push(C)}n=this.radius*Math.cos(o)*Math.sin(a),r=this.radius*Math.cos(o)*Math.cos(a),l=this.radius*Math.sin(o),u=this.radius*Math.cos(t/2)*Math.sin(a),p=this.radius*Math.cos(t/2)*Math.cos(a),h=this.radius*Math.sin(t/2),c=this.radius*Math.cos(o)*Math.sin(e/2),g=this.radius*Math.cos(o)*Math.cos(e/2),d=this.radius*Math.sin(o),m=this.radius*Math.cos(t/2)*Math.sin(e/2),f=this.radius*Math.cos(t/2)*Math.cos(e/2),C=this.radius*Math.sin(t/2);this.surfaceVert.push(n),this.surfaceVert.push(r),this.surfaceVert.push(l),this.surfaceVert.push(u),this.surfaceVert.push(p),this.surfaceVert.push(h),this.surfaceVert.push(c),this.surfaceVert.push(g),this.surfaceVert.push(d),this.surfaceVert.push(u),this.surfaceVert.push(p),this.surfaceVert.push(h),this.surfaceVert.push(c),this.surfaceVert.push(g),this.surfaceVert.push(d),this.surfaceVert.push(m),this.surfaceVert.push(f),this.surfaceVert.push(C);for(o=0;o<this.surfaceVert.length;++o)o%3==0&&(this.surfaceVert[o]+=this.translation.x),o%3==1&&(this.surfaceVert[o]+=this.translation.y),o%3==2&&(this.surfaceVert[o]+=this.translation.z)},CgsAirborneRadar3D.prototype.calcUDLR=function(){this.upVert=new Array,this.downVert=new Array,this.leftVert=new Array,this.rightVert=new Array;var e,t=Cesium.Math.toRadians(this.hAngle),i=Cesium.Math.toRadians(this.vAngle),s=Cesium.Math.toRadians(this.hStep),o=Cesium.Math.toRadians(this.vStep);for(this.leftVert.push(1e-7),this.leftVert.push(0),this.leftVert.push(0-this.radius*Math.sin(i/2)),l=-i/2;l<i/2;l+=o){var a=this.radius*Math.cos(l)*Math.sin(-t/2),n=this.radius*Math.cos(l)*Math.cos(-t/2),r=this.radius*Math.sin(l);this.leftVert.push(a),this.leftVert.push(n),this.leftVert.push(r)}a=this.radius*Math.cos(i/2)*Math.sin(-t/2),n=this.radius*Math.cos(i/2)*Math.cos(-t/2),r=this.radius*Math.sin(i/2);for(this.leftVert.push(a),this.leftVert.push(n),this.leftVert.push(r),e=-t/2;e<t/2;e+=s){a=this.radius*Math.cos(i/2)*Math.sin(e),n=this.radius*Math.cos(i/2)*Math.cos(e),r=this.radius*Math.sin(i/2);this.leftVert.push(a),this.leftVert.push(n),this.leftVert.push(r)}a=this.radius*Math.cos(i/2)*Math.sin(t/2),n=this.radius*Math.cos(i/2)*Math.cos(t/2),r=this.radius*Math.sin(i/2);for(this.leftVert.push(a),this.leftVert.push(n),this.leftVert.push(r),l=i/2;-i/2<l;l-=o){a=this.radius*Math.cos(l)*Math.sin(t/2),n=this.radius*Math.cos(l)*Math.cos(t/2),r=this.radius*Math.sin(l);this.leftVert.push(a),this.leftVert.push(n),this.leftVert.push(r)}a=this.radius*Math.cos(-i/2)*Math.sin(t/2),n=this.radius*Math.cos(-i/2)*Math.cos(t/2),r=this.radius*Math.sin(-i/2);for(this.leftVert.push(a),this.leftVert.push(n),this.leftVert.push(r),e=t/2;-t/2<e;e-=s){a=this.radius*Math.cos(-i/2)*Math.sin(e),n=this.radius*Math.cos(-i/2)*Math.cos(e),r=this.radius*Math.sin(-i/2);this.leftVert.push(a),this.leftVert.push(n),this.leftVert.push(r)}a=this.radius*Math.cos(-i/2)*Math.sin(-t/2),n=this.radius*Math.cos(-i/2)*Math.cos(-t/2),r=this.radius*Math.sin(-i/2);this.leftVert.push(a),this.leftVert.push(n),this.leftVert.push(r);for(var l=0;l<this.leftVert.length;++l)l%3==0&&(this.leftVert[l]+=this.translation.x),l%3==1&&(this.leftVert[l]+=this.translation.y),l%3==2&&(this.leftVert[l]+=this.translation.z)},CgsAirborneRadar3D.prototype.instance=function(){this.faceInstance=new Cesium.GeometryInstance({geometry:new Cesium.Geometry({attributes:{position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:this.surfaceVert})},primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:Cesium.BoundingSphere.fromVertices(this.surfaceVert)}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color.fromCssColorString(this.color))},id:"AirborneRadar3DFace"}),this.ids.push("AirborneRadar3DFace"),this.leftInstance=new Cesium.GeometryInstance({geometry:new Cesium.Geometry({attributes:{position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:this.leftVert})},primitiveType:Cesium.PrimitiveType.TRIANGLE_FAN,boundingSphere:Cesium.BoundingSphere.fromVertices(this.leftVert)}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color.fromCssColorString(this.color))},id:"AirborneRadar3DURDL"}),this.ids.push("AirborneRadar3DURDL")},CgsAirborneRadar3D.prototype.createPrimitives=function(){this.instance(),this._primitive=new Cesium.PrimitiveCollection({destroyPrimitives:!1}),this.facePrimitive=new Cesium.Primitive({geometryInstances:this.faceInstance,appearance:new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!0}),asynchronous:!1,allowPicking:!0,cull:!1}),this.facePrimitive.modelMatrix=this.modelMatrix,this._primitive.add(this.facePrimitive),this.leftPrimitive=new Cesium.Primitive({geometryInstances:this.leftInstance,appearance:new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!0}),asynchronous:!1,allowPicking:!0,cull:!1}),this.leftPrimitive.modelMatrix=this.modelMatrix,this._primitive.add(this.leftPrimitive)},CgsAirborneRadar3D.prototype.removePrimitives=function(){var e=this.getMap();Cesium.defined(e)&&e.scene.primitives.contains(this._primitive)&&(e.scene.primitives.remove(this._primitive),this._primitive=null)},CgsAirborneRadar3D.prototype.setHAngle=function(e){this.hAngle=e,this._updateGeometry()},CgsAirborneRadar3D.prototype.getHAngle=function(){return this.hAngle},CgsAirborneRadar3D.prototype.setVAngle=function(e){this.vAngle=e,this._updateGeometry()},CgsAirborneRadar3D.prototype.getVAngle=function(){return this.vAngle()},CgsAirborneRadar3D.prototype._updateGeometry=function(){var e=this.getMap();e instanceof CgsMap&&(e=e.map3D),Cesium.defined(e)&&e instanceof CgsMap3D&&e.scene.primitives.contains(this._primitive)&&(e.scene.primitives.remove(this._primitive),this._primitive=new Cesium.PrimitiveCollection),this.calculate(),this.createPrimitives(),Cesium.defined(e)&&e.scene.primitives.add(this._primitive)},CgsAirborneRadar3D.prototype.setType=function(e){this.type=e},CgsAirborneRadar3D.prototype.getType=function(){return this.type},CgsAirborneRadar3D.prototype.setVisible=function(e){this.show=e;for(var t=0;t<this._primitive.length;++t){this._primitive.get(t).show=e}},CgsAirborneRadar3D.prototype.getVisible=function(){return this.show},CgsAirborneRadar3D.prototype.setColor=function(e){this.color=e;for(var t=0;t<this._primitive.length;++t)for(var i=0;i<this.ids.length;++i){var s=this.ids[i],o=this._primitive.get(t).getGeometryInstanceAttributes(s);Cesium.defined(o)&&(o.color=Cesium.ColorGeometryInstanceAttribute.toValue(Cesium.Color.fromCssColorString(this.color)))}},CgsAirborneRadar3D.prototype.getColor=function(){return this.color},CgsAirborneRadar3D.prototype.setRadius=function(e){this.radius=e,this._updateGeometry()},CgsAirborneRadar3D.prototype.getRadius=function(){return this.radius},CgsAirborneRadar3D.prototype.calcModelMatrix=function(){var e=Cesium.Math.toRadians(this.heading),t=Cesium.Math.toRadians(this.pitch),i=Cesium.Math.toRadians(this.roll),s=Cesium.Math.toRadians(this.vAngle),o=Cesium.Matrix3.fromRotationZ(e),a=Cesium.Matrix3.fromRotationY(i),n=Cesium.Matrix3.fromRotationX(t),r=Cesium.Matrix3.multiply(o,a,new Cesium.Matrix3),l=Cesium.Matrix3.multiply(r,n,new Cesium.Matrix3),u=Cesium.Matrix3.fromScale(new Cesium.Cartesian3(this.scale,this.scale,this.scale));this.center=[],this.center.push(this.position[0]),this.center.push(this.position[1]),this.center.push(this.position[2]+this.radius*Math.sin(s/2)),this.modelMatrix=Cesium.Matrix4.multiplyByMatrix3(Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2])),Cesium.Matrix3.multiply(l,u,new Cesium.Matrix3),new Cesium.Matrix4);for(var p=0;p<this._primitive.length;++p)this._primitive.get(p).modelMatrix=this.modelMatrix},CgsAirborneRadar3D.prototype.setScale=function(e){this.scale=e,this.calcModelMatrix()},CgsAirborneRadar3D.prototype.getScale=function(){return this.scale},CgsAirborneRadar3D.prototype.setPosition=function(e){this.position=e,this.calcModelMatrix()},CgsAirborneRadar3D.prototype.getPosition=function(){return this.position},CgsAirborneRadar3D.prototype.setHeading=function(e){this.heading=e,this.calcModelMatrix()},CgsAirborneRadar3D.prototype.getHeading=function(){return this.heading},CgsAirborneRadar3D.prototype.setPitch=function(e){this.pitch=e,this.calcModelMatrix()},CgsAirborneRadar3D.prototype.getPitch=function(){return this.pitch()},CgsAirborneRadar3D.prototype.setRoll=function(e){this.roll=e,this.calcModelMatrix()},CgsAirborneRadar3D.prototype.getRoll=function(){return this.roll},CgsAirborneRadar3D.URDL="AirborneRadar3DURDL",CgsAirborneRadar3D.FACE="AirborneRadar3DFace",CgsScanRadar3D=function(e){this.map=null,this.position=Cesium.defaultValue(e.position,[120.3,23.5,1e4]),this.show=Cesium.defaultValue(e.show,!0),this.heading=Cesium.defaultValue(e.heading,0),this.pitch=Cesium.defaultValue(e.pitch,0),this.roll=Cesium.defaultValue(e.roll,0),this.scale=Cesium.defaultValue(e.scale,1),this.ids=[],this.type="ScanRadar",this._primitive=void 0,this.scanPrimitive,this.modelMatrix=Cesium.Matrix4.IDENTITY,this.scanURDLColor=Cesium.defaultValue(e.scanURDLColor,"rgba(110,110,0,0.3)"),this.horiFaceColor=Cesium.defaultValue(e.horiFaceColor,"rgba(0,225,0,1.0)"),this.vertFaceColor=Cesium.defaultValue(e.vertFaceColor,"rgba(0,225,0,1.0)"),this.centerColor=Cesium.defaultValue(e.centerColor,"rgba(0,0,225,0.3)"),this.color=Cesium.defaultValue(e.color,"rgba(255,0,0,0.3)"),this.radius=Cesium.defaultValue(e.radius,2e5),this.hAngle=Cesium.defaultValue(e.hAngle,130),this.vAngle=Cesium.defaultValue(e.vAngle,60),this.tStep=Cesium.defaultValue(e.tStep,1),this.calculate(),this.calOpt(),this.scanPrimitive=new Cesium.FeScanAspectPrimitive(this.opt),CgsRadar3D.call(this,e),this.createPrimitives()},CgsInherits(CgsScanRadar3D,CgsRadar3D),CgsScanRadar3D.prototype.calOpt=function(){this.opt={scanURDLColor:this.scanURDLColor,horiFaceColor:this.horiFaceColor,vertFaceColor:this.vertFaceColor,radarURDLColor:this.color,centerColor:this.centerColor,radius:this.radius,hAngle:this.hAngle,vAngle:this.vAngle,tStep:this.tStep,speed:this.speed,modelMatrix:this.modelMatrix,position:this.position,show:this.show}},CgsScanRadar3D.prototype.calculate=function(){Cesium.Math.toRadians(this.hAngle),Cesium.Math.toRadians(this.vAngle),Cesium.Math.toRadians(this.tStep);var e=Cesium.Math.toRadians(this.heading),t=Cesium.Math.toRadians(this.pitch),i=Cesium.Math.toRadians(this.roll),s=Cesium.Matrix3.fromRotationZ(e),o=Cesium.Matrix3.fromRotationY(i),a=Cesium.Matrix3.fromRotationX(t),n=Cesium.Matrix3.multiply(s,o,new Cesium.Matrix3),r=Cesium.Matrix3.multiply(n,a,new Cesium.Matrix3),l=Cesium.Matrix3.fromScale(new Cesium.Cartesian3(this.scale,this.scale,this.scale));this.modelMatrix=Cesium.Matrix4.multiplyByMatrix3(Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2])),Cesium.Matrix3.multiply(r,l,new Cesium.Matrix3),new Cesium.Matrix4)},CgsScanRadar3D.prototype.getBoundingSphere=function(){return this.scanPrimitive.boundingSphere},CgsScanRadar3D.prototype.createPrimitives=function(){this._primitive=new Cesium.PrimitiveCollection,this.calOpt(),this.scanPrimitive=new Cesium.FeScanAspectPrimitive(this.opt),this._primitive.add(this.scanPrimitive)},CgsScanRadar3D.prototype.removePrimitives=function(){var e=this.getMap();Cesium.defined(e)&&e.scene.primitives.contains(this._primitive)&&(e.scene.primitives.remove(this._primitive),this._primitive=null)},CgsScanRadar3D.prototype.setHAngle=function(e){this.hAngle=e,this.scanPrimitive.setHAngle(e)},CgsScanRadar3D.prototype.getHAngle=function(){return this.hAngle},CgsScanRadar3D.prototype.setVAngle=function(e){this.vAngle=e,this.scanPrimitive.setVAngle(e)},CgsScanRadar3D.prototype.getVAngle=function(){return this.vAngle()},CgsScanRadar3D.prototype._updateGeometry=function(){var e=this.getMap();e instanceof CgsMap&&(e=e.map3D),Cesium.defined(e)&&e instanceof CgsMap3D&&e.scene.primitives.contains(this._primitive)&&(e.scene.primitives.remove(this._primitive),this._primitive=new Cesium.PrimitiveCollection),this.calculate(),this.createPrimitives(),Cesium.defined(e)&&e.scene.primitives.add(this._primitive)},CgsScanRadar3D.prototype.setType=function(e){this.type=e},CgsScanRadar3D.prototype.getType=function(){return this.type},CgsScanRadar3D.prototype.setSpeed=function(e){this.scanPrimitive.setSpeed(e)},CgsScanRadar3D.prototype.getSpeed=function(){return this.scanPrimitive.getSpeed()},CgsScanRadar3D.prototype.setVisible=function(e){this.show=e;for(var t=0;t<this._primitive.length;++t){this._primitive.get(t).show=e}},CgsScanRadar3D.prototype.getVisible=function(){return this.show},CgsScanRadar3D.prototype.setColor=function(e){this.color=e,this.scanPrimitive.setRadarURDLColor(this.color)},CgsScanRadar3D.prototype.getColor=function(){return this.color},CgsScanRadar3D.prototype.setScanURDLColor=function(e){this.scanPrimitive.setScanURDLColor(this.color)},CgsScanRadar3D.prototype.setRadius=function(e){this.radius=e,this.scanPrimitive.setRadius(e)},CgsScanRadar3D.prototype.getRadius=function(){return this.radius},CgsScanRadar3D.prototype.setIsHorizontal=function(e){this.scanPrimitive.setIsHorizontal(e)},CgsScanRadar3D.prototype.getIsHorizontal=function(){return this.scanPrimitive.getIsHorizontal()},CgsScanRadar3D.prototype.setIsVertical=function(e){this.scanPrimitive.setIsVertical(e)},CgsScanRadar3D.prototype.getIsVertical=function(){return this.scanPrimitive.getIsVertical()},CgsScanRadar3D.prototype.calcModelMatrix=function(){var e=Cesium.Math.toRadians(this.heading),t=Cesium.Math.toRadians(this.pitch),i=Cesium.Math.toRadians(this.roll),s=(Cesium.Math.toRadians(this.vAngle),Cesium.Matrix3.fromRotationZ(e)),o=Cesium.Matrix3.fromRotationY(i),a=Cesium.Matrix3.fromRotationX(t),n=Cesium.Matrix3.multiply(s,o,new Cesium.Matrix3),r=Cesium.Matrix3.multiply(n,a,new Cesium.Matrix3),l=Cesium.Matrix3.fromScale(new Cesium.Cartesian3(this.scale,this.scale,this.scale));this.modelMatrix=Cesium.Matrix4.multiplyByMatrix3(Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2])),Cesium.Matrix3.multiply(r,l,new Cesium.Matrix3),new Cesium.Matrix4);for(var u=0;u<this._primitive.length;++u)this._primitive.get(u).modelMatrix=this.modelMatrix},CgsScanRadar3D.prototype.setScale=function(e){this.scale=e,this.calcModelMatrix()},CgsScanRadar3D.prototype.getScale=function(){return this.scale},CgsScanRadar3D.prototype.setPosition=function(e){this.position=e},CgsScanRadar3D.prototype.getPosition=function(){return this.position},CgsScanRadar3D.prototype.setHeading=function(e){this.heading=e,this.calcModelMatrix()},CgsScanRadar3D.prototype.getHeading=function(){return this.heading},CgsScanRadar3D.prototype.setPitch=function(e){this.pitch=e,this.calcModelMatrix()},CgsScanRadar3D.prototype.getPitch=function(){return this.pitch()},CgsScanRadar3D.prototype.setRoll=function(e){this.roll=e,this.calcModelMatrix()},CgsScanRadar3D.prototype.getRoll=function(){return this.roll},CgsScanRadar3D.FACE="facescanradar",CgsDynTransmit3D=function(e){this._map=void 0,this.show=Cesium.defaultValue(e.show,!0),this.speedVert=Cesium.defaultValue(e.speedVert,.001),this.speedHori=Cesium.defaultValue(e.speedHori,1e-4),this.color=Cesium.defaultValue(e.color,"rgba(0,110,110,0.2)"),this.upColor=Cesium.defaultValue(e.color,"rgba(0,110,110,0.3)"),this.downColor=Cesium.defaultValue(e.color,"rgba(0,110,110,0.3)"),this.radius=Cesium.defaultValue(e.radius,1e4),this.textureNumVert=Cesium.defaultValue(e.textureNumVert,2),this.textureNumHori=Cesium.defaultValue(e.textureNumHori,2),this.positions=Cesium.defaultValue(e.positions,[[113,35,1e5],[115,31,5e5]]),this.textUrlVert=Cesium.defaultValue(e.textUrlVert,CGS_SDK_PATH+"assets/DynTransmitTex/w.png"),this.textUrlHori=Cesium.defaultValue(e.textUrlHori,CGS_SDK_PATH+"assets/DynTransmitTex/t.png"),this.vertActive=Cesium.defaultValue(e.vertActive,!0),this.vertUpdate=Cesium.defaultValue(e.vertUpdate,!0),this.horiActive=Cesium.defaultValue(e.horiActive,!0),this.horiUpdate=Cesium.defaultValue(e.horiUpdate,!0),this.upFaceActive=Cesium.defaultValue(e.upFaceActive,!0),this.downFaceActive=Cesium.defaultValue(e.downFaceActive,!0);var t={show:this.show,color:this.color,upColor:this.upColor,downColor:this.downColor,speed:this.speed,speedVert:this.speedVert,speedHori:this.speedHori,radius:this.radius,positions:this.positions,textureNumVert:this.textureNumVert,textureNumHori:this.textureNumHori,textUrlVert:this.textUrlVert,textUrlHori:this.textUrlHori};CgsRadar3D.call(this,e),this._type="cylinderTrans",this._primitive=new Cesium.FeDynTransPrimitive(t)},CgsInherits(CgsDynTransmit3D,CgsRadar3D),CgsDynTransmit3D.prototype.getBoundingSphere=function(){return this._primitive.boundingSphere},CgsDynTransmit3D.prototype.setType=function(e){this._type=e},CgsDynTransmit3D.prototype.getType=function(){return this._type},CgsDynTransmit3D.prototype.setPositions=function(e){this._primitive.positions=e},CgsDynTransmit3D.prototype.getPositions=function(){return this._primitive&&this._primitive.positions?this._primitive.positions:void 0},CgsDynTransmit3D.prototype.setRadius=function(e){this._primitive.radius=e},CgsDynTransmit3D.prototype.getRadius=function(){return this._primitive.radius},CgsDynTransmit3D.prototype.setTextureNumVert=function(e){this._primitive.textureNumVert=e},CgsDynTransmit3D.prototype.getTextureNumVert=function(){return this._primitive.textureNumVert},CgsDynTransmit3D.prototype.setTextureNumHori=function(e){this._primitive.textureNumHori=e},CgsDynTransmit3D.prototype.getTextureNumHori=function(){return this._primitive.textureNumHori},CgsDynTransmit3D.prototype.setTextureSpeedVert=function(e){this._primitive.speedVert=e},CgsDynTransmit3D.prototype.getTextureSpeedVert=function(){return this._primitive.speedVert},CgsDynTransmit3D.prototype.setTextureSpeedHori=function(e){this._primitive.speedHori=e},CgsDynTransmit3D.prototype.getTextureSpeedHori=function(){return this._primitive.speedHori},CgsDynTransmit3D.prototype.setTextUrlVert=function(e){this._primitive.textUrlVert=e},CgsDynTransmit3D.prototype.getTextUrlVert=function(){return this._primitive.textUrlVert},CgsDynTransmit3D.prototype.setTextUrlHori=function(e){this._primitive.textUrlHori=e},CgsDynTransmit3D.prototype.getTextUrlHori=function(){return this._primitive.textUrlHori},CgsDynTransmit3D.prototype.setVertActive=function(e){this._primitive.vertActive=e},CgsDynTransmit3D.prototype.getVertActive=function(){return this._primitive.vertActive},CgsDynTransmit3D.prototype.setVertUpdate=function(e){this._primitive.vertUpdate=e},CgsDynTransmit3D.prototype.getVertActive=function(){return this._primitive.vertActive},CgsDynTransmit3D.prototype.setHoriActive=function(e){this._primitive.horiActive=e},CgsDynTransmit3D.prototype.getHoriActive=function(){return this._primitive.horiActive},CgsDynTransmit3D.prototype.setHoriUpdate=function(e){this._primitive.horiUpdate=e},CgsDynTransmit3D.prototype.getHoriActive=function(){return this._primitive.horiActive},CgsDynTransmit3D.prototype.setUpFaceActive=function(e){this._primitive.upFaceActive=e},CgsDynTransmit3D.prototype.getUpFaceActive=function(){return this._primitive.upFaceActive},CgsDynTransmit3D.prototype.setDownFaceActive=function(e){this._primitive.downFaceActive=e},CgsDynTransmit3D.prototype.getDownFaceActive=function(){return this._primitive.downFaceActive},CgsDynTransmit3D.prototype.setColor=function(e){this._primitive.color=e},CgsDynTransmit3D.prototype.getColor=function(){return this._primitive.color},CgsDynTransmit3D.prototype.setUpColor=function(e){this._primitive.upColor=e},CgsDynTransmit3D.prototype.getUpColor=function(){return this._primitive.upColor},CgsDynTransmit3D.prototype.setDownColor=function(e){this._primitive.downColor=e},CgsDynTransmit3D.prototype.getDownColor=function(){return this._primitive.downColor},CgsDynTransmit3D.prototype.setVisible=function(e){this.show=e,this._primitive.show=e},CgsDynTransmit3D.prototype.getVisible=function(){return this._primitive.show},CgsDynTransmit3D.prototype.setSpeed=function(e){this._primitive.speed=e},CgsDynTransmit3D.prototype.getSpeed=function(){return this._primitive.speed},CgsDynTransmit3D.prototype._updateGeometry=function(){var e,t=this.getMap();null!=t&&(t instanceof CgsMap&&(t=t.map3D),Cesium.defined(t)&&t instanceof CgsMap3D&&t.scene.primitives.contains(this._primitive)&&(t.scene.primitives.remove(this._primitive),this._primitive=void 0),e={show:this.show,color:this.color,upColor:this.upColor,downColor:this.downColor,speed:this.speed,speedVert:this.speedVert,speedHori:this.speedHori,radius:this.radius,positions:this.positions,textureNumVert:this.textureNumVert,textureNumHori:this.textureNumHori,textUrlVert:this.textUrlVert,textUrlHori:this.textUrlHori},this._primitive=new Cesium.FeDynTransPrimitive(e),Cesium.defined(t)&&t.scene.primitives.add(this._primitive))},CgsShadows3D=function(e){this.map=map.map3D,this.map.clock.multiplier=e.multiplier,this.setTime(e.currentTime),this.start(e.startDate,e.endDate,e.currentTime)},CgsShadows3D.prototype.getTime=function(){var e=this.map.clock.currentTime;return Cesium.JulianDate.toDate(e)},CgsShadows3D.prototype.setTime=function(e){this.map.clock.currentTime=Cesium.JulianDate.fromDate(e),this.stop()},CgsShadows3D.prototype.getIsStart=function(){return this.map.clock.shouldAnimate},CgsShadows3D.prototype.getMultiplier=function(){return this.map.clock.multiplier},CgsShadows3D.prototype.setMultiplier=function(e){this.map.clock.multiplier=e,this.map&&(this.map.clock.multiplier=e)},CgsShadows3D.prototype.enabledHook=function(e){this.map&&(this.map.viewer.shadows=e,this.map.viewer.terrainShadows=e?Cesium.ShadowMode.ENABLED:Cesium.ShadowMode.DISABLED,this.map.scene.globe.enableLighting=e)},CgsShadows3D.prototype.mountedHook=function(){},CgsShadows3D.prototype.addedHook=function(){this.lastStartTime=this.map.clock.startTime,this.lastStopTime=this.map.clock.stopTime,this.lastShouldAnimate=this.map.clock.shouldAnimate,this.lastClockRange=this.map.clock.clockRange,this.lastMultiplier=this.map.clock.multiplier,this.lastShadows=this.map.viewer.shadows,this.enabledHook(this.enabled),this.map.clock.shouldAnimate=!1,this.map.clock.clockRange=Cesium.ClockRange.LOOP_STOP,this.map.clock.multiplier=Cesium.defaultValue(this.options.multiplier,1600),this.options.time&&(this.time=this.options.time),this.map.on("clockTick",this.onClockTickHanlder,this)},CgsShadows3D.prototype.removedHook=function(){this.map.off("clockTick",this.onClockTickHanlder,this),this.enabledHook(!1),this.map.viewer.shadows=this.lastShadows,this.map.clock.clockRange=this.lastClockRange,this.map.clock.multiplier=this.lastMultiplier,this.map.clock.shouldAnimate=this.lastShouldAnimate},CgsShadows3D.prototype.onClockTickHanlder=function(){this.map.clock.shouldAnimate&&this.fire("change")},CgsShadows3D.prototype.start=function(e,t,i){this.map&&(!e||!t||t<=e||(this.map.clock.startTime=Cesium.JulianDate.fromDate(e),this.map.clock.currentTime=Cesium.JulianDate.fromDate(i||e),this.map.clock.stopTime=Cesium.JulianDate.fromDate(t),this.map.clock.shouldAnimate=!0))},CgsShadows3D.prototype.pause=function(){this.map&&(this.map.clock.shouldAnimate=!1)},CgsShadows3D.prototype.proceed=function(){this.map&&(this.map.clock.shouldAnimate=!0)},CgsShadows3D.prototype.stop=function(){this.map&&(this.map.clock.shouldAnimate=!1)},CgsShadows3D.prototype.clear=function(){this.stop(),this.currentTime=new Date,this.map.clock.startTime=this.lastStartTime,this.map.clock.stopTime=this.lastStopTime},CgsSkyLine3D=function(e){this._map=map.map3D,this.constructor(e),this._mountedHook()},CgsSkyLine3D.prototype.constructor=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,0,0)),this.width=Cesium.defaultValue(e.width,2),this.strokeType=Cesium.defaultValue(e.strokeType,new Cesium.Cartesian3(!0,!0,!1)),this.bjColor=Cesium.defaultValue(e.bjColor,new Cesium.Color(0,0,1)),this.distance=Cesium.defaultValue(e.distance,500)};var skyLineSource="#extension GL_OES_standard_derivatives : enable\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform float lineWidth;\nuniform float height;\nuniform bvec3 strokeType;\nuniform vec3 tjxColor;\nuniform vec3 bjColor;\nuniform vec3 cameraPos;\nuniform float mbDis;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\nvec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\nvec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\nposInCamera =posInCamera / posInCamera.w;\nreturn posInCamera;\n}\nfloat getDepth(in vec4 depth){\nfloat z_window = czm_unpackDepth(depth);\n z_window = czm_reverseLogDepth(z_window);\nfloat n_range = czm_depthRange.near;\nfloat f_range = czm_depthRange.far;\nreturn (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nbool isTJX(vec2 uv,float lw){\nvec2 pixelSize = lw / czm_viewport.zw;\nfloat dx0 = -pixelSize.x;\nfloat dy0 = -pixelSize.y;\nfloat dx1 = pixelSize.x;\nfloat dy1 = pixelSize.y;\nvec2 currUV = uv + vec2(dx0, dy0);\nvec4 currDepth = texture2D(depthTexture, currUV);\n float depth = getDepth(currDepth);\n if(depth>=1.0)return true;\ncurrUV = uv + vec2(0.0, dy0);\ncurrDepth = texture2D(depthTexture, currUV);\ndepth = getDepth(currDepth);\nif(depth>=1.0)return true;\ncurrUV = uv + vec2(dx1, dy0);\ncurrDepth = texture2D(depthTexture, currUV);\ndepth = getDepth(currDepth);\nif(depth>=1.0)return true;\ncurrUV = uv + vec2(dx0, 0.0);\ncurrDepth = texture2D(depthTexture, currUV);\ndepth = getDepth(currDepth);\nif(depth>=1.0)return true;\ncurrUV = uv + vec2(dx1, 0.0);\ncurrDepth = texture2D(depthTexture, currUV);\ndepth = getDepth(currDepth);\nif(depth>=1.0)return true;\ncurrUV = uv + vec2(dx0, dy1);\ncurrDepth = texture2D(depthTexture, currUV);\ndepth = getDepth(currDepth);\nif(depth>=1.0)return true;\ncurrUV = uv + vec2(0.0, dy1);\ncurrDepth = texture2D(depthTexture, currUV);\ndepth = getDepth(currDepth);\nif(depth>=1.0)return true;\ncurrUV = uv + vec2(dx1, dy1);\ncurrDepth = texture2D(depthTexture, currUV);\ndepth = getDepth(currDepth);\nif(depth>=1.0)return true;\nreturn false;\n}\nvoid main(){\nvec4 color = texture2D(colorTexture, v_textureCoordinates);\nif(height>14102.0){\ngl_FragColor = color;\nreturn;\n}\nvec4 currD = texture2D(depthTexture, v_textureCoordinates);\nif(currD.r>=1.0){\ngl_FragColor = color;\nreturn;\n}\nfloat depth = getDepth(currD);\nvec4 positionEC = toEye(v_textureCoordinates, depth);\nvec3 dx = dFdx(positionEC.xyz);\nvec3 dy = dFdy(positionEC.xyz);\nvec3 normal = normalize(cross(dx,dy));\nif(strokeType.y||strokeType.z){\nvec4 wp = czm_inverseView * positionEC;\nif(distance(wp.xyz,cameraPos)>mbDis){\ngl_FragColor = color;\n}else{\nfloat dotNum = abs(dot(normal,normalize(positionEC.xyz)));\nif(dotNum<0.05){\ngl_FragColor = vec4(bjColor,1.0);\nreturn;\n}\n}\n}\nif(strokeType.x||strokeType.z){\nbool tjx = isTJX(v_textureCoordinates,lineWidth);\nif(tjx){\ngl_FragColor = vec4(tjxColor,1.0);\nreturn;\n}\n}\ngl_FragColor = color;\n}";function createAnalyzeTooltip(e){e.analyzeTooltipElement=document.createElement("div"),e.analyzeTooltipElement.className="cgstooltip cgstooltip-analyze",e.analyzeTooltipElement.style.pointerEvents="none",e.analyzeTooltip=new CgsOverlay3D({position:[0,0],element:e.analyzeTooltipElement,offset:[0,-6],positioning:"center-center",stopEvent:!1,distanceDisplayCondition:[0,1e5]}),e.analyzeTooltip.setVisible(!1),e._viewer.addFeature(e.analyzeTooltip),e._state.list.push(e.analyzeTooltip)}function createHeightChangedEle(i){i.heightChangedEle&&(i._viewer.container.removeChild(i.heightChangedEle),i.heightChangedEle=void 0);i.heightChangedEle=$$(" \n\t<div class=\"height-changed\">\n\t\t<input class='demoPanel__range_' id='analyzeheightchanged' type='range' min='0' max='2000' step='10' value='0'>\n\t\t<input class='demoPanel__input_ demoPanel__input_inrange_' value='0'>\n\t</div>   \t       \n\t")[0],i._viewer.container.appendChild(i.heightChangedEle),i.inputRangeEle=i.heightChangedEle.children[0],i.inputTextEle=i.heightChangedEle.children[1],i.inputRangeEle.oninput=function(e){var t=this.value;i.inputTextEle.value=t,i.setRIAHeight(Number(t))},i.inputTextEle.oninput=function(e){var t=this.value;i.inputRangeEle.value=t,i.setRIAHeight(Number(t))}}function drawWaterPlaneAndWaterPrism(e,t,i,s){var o=e;this.waterMinHeight=t,this.waterHeight=o.waterAltitude,this.curWaterSpeed=s;this._isSimulate=!0,this.eventID=void 0,this.timer=void 0,this.prismWater&&(this.prismWater=void 0),this.planeWater&&(this.planeWater=void 0);for(var a=[],n=0;n<o.floodKeyPoint.length;++n)a.push(o.floodKeyPoint[n]);for(var r=[],l=0;l<a.length;++l){var u=Cesium.Math.toDegrees(a[l].longitude),p=Cesium.Math.toDegrees(a[l].latitude),h=o.waterAltitude;r.push(u),r.push(p),r.push(h)}o._viewer.scene.globe.depthTestAgainstTerrain&&(this.prismWater=o._viewer.entities.add({name:"prismWater",polygon:{hierarchy:Cesium.Cartesian3.fromDegreesArrayHeights(r),extrudedHeight:this.waterMinHeight,perPositionHeight:!0,material:Cesium.Color.fromCssColorString(o._floodColor),closeTop:!1,closeBottom:!1,outline:!1,outlineColor:Cesium.Color.fromCssColorString("rgba(255,0,0,1)")}}),o._state.entities.push(this.prismWater),o._prismWater=this.prismWater);var c,g=new Cesium.OceanMaterialProperty({normalMap:"http://localhost:8809/SDK/SDK3D/Cesium/Assets/Textures/waterNormalsSmall.jpg",frequency:100,animationSpeed:.02,amplitude:30,baseWaterColor:new Cesium.Color(.2,.3,.6,.8),specularIntensity:.5,fadeFactor:1});this.planeWater=void 0,o._viewer.scene.globe.depthTestAgainstTerrain?this.planeWater=o._viewer.entities.add({name:"planeWater",polygon:{hierarchy:Cesium.Cartesian3.fromDegreesArrayHeights(r),perPositionHeight:!0,material:g,outline:!1,outlineColor:Cesium.Color.fromCssColorString("rgba(255,0,0,1)")}}):(c=Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(o.floodKeyPoint),this.planeWater=o._viewer.entities.add({name:"planeWater",polygon:{hierarchy:c,material:g,outline:!1,outlineColor:Cesium.Color.fromCssColorString("rgba(255,0,0,1)")}})),o._state.entities.push(this.planeWater)}CgsSkyLine3D.prototype._enabledHook=function(e){this.postProcessStage.enabled=e},CgsSkyLine3D.prototype._mountedHook=function(){var e=this,t=this._map.camera;this.postProcessStage=new Cesium.PostProcessStage({fragmentShader:skyLineSource,uniforms:{height:function(){return t.positionCartographic.height},lineWidth:function(){return e.width},strokeType:function(){return e.strokeType},tjxColor:function(){return e.color},bjColor:function(){return e.bjColor},cameraPos:function(){return t.position},mbDis:function(){return e.distance}},enabled:this.enabled}),this._addedHook()},CgsSkyLine3D.prototype._addedHook=function(){this._map.scene.postProcessStages.add(this.postProcessStage)},CgsSkyLine3D.prototype._removedHook=function(){this._map.scene.postProcessStages.remove(this.postProcessStage)},CgsSkyLine3D.prototype.destroy=function(e){this.postProcessStage&&(this.postProcessStage.destroy(),delete this.postProcessStage)},CgsSlope3D=function(e){this._map=void 0,this.show=Cesium.defaultValue(e.show,!0),this.color=Cesium.defaultValue(e.color,"rgba(255,0,0,0.2)"),this.minAlpha=Cesium.defaultValue(e.minAlpha,0);var t=Cesium.Color.fromCssColorString(this.color);this.maxAlpha=Cesium.defaultValue(e.maxAlpha,t.alpha),this.maxNum=Cesium.defaultValue(e.maxNum,100),this.offsetX=Cesium.defaultValue(e.offsetX,0),this.offsetZ=Cesium.defaultValue(e.offsetZ,0),this.type="slope";var i={show:this.show,color:this.color,positions:this.positions,maxNum:this.maxNum,deleteNum:this.deleteNum,offsetX:this.offsetX,offsetZ:this.offsetZ,minAlpha:this.minAlpha,maxAlpha:this.maxAlpha};this._primitive=new Cesium.FeSlopePrimitive(i),Cesium.FeSlopePrimitive.call(this,i)},CgsSlope3D.prototype.getMap=function(){return this._map},CgsSlope3D.prototype.setMap=function(e){this._map=e},CgsSlope3D.prototype.getPrimitive=function(){return this._primitive},CgsSlope3D.prototype.setType=function(e){this.type=e},CgsSlope3D.prototype.getType=function(){return this.type},CgsSlope3D.prototype.setOffsetX=function(e){this._primitive.offsetX=e},CgsSlope3D.prototype.getOffsetX=function(){return this._primitive.offsetX},CgsSlope3D.prototype.setOffsetZ=function(e){this._primitive.offsetZ=e},CgsSlope3D.prototype.getOffsetZ=function(){return this._primitive.offsetZ},CgsSlope3D.prototype.setPosition=function(e){this._primitive.addPoint(e)},CgsSlope3D.prototype.setMaxNum=function(e){return this._primitive.maxNum=e},CgsSlope3D.prototype.getMaxNum=function(){return this._primitive.maxNum},CgsSlope3D.prototype.setColor=function(e){this._primitive.color=e},CgsSlope3D.prototype.getColor=function(){return this._primitive.color},CgsSlope3D.prototype.setVisible=function(e){this.show=e,this._primitive.show=e},CgsSlope3D.prototype.getVisible=function(){return this._primitive.show},CgsSlope3D.prototype.setMinAlpha=function(e){this._primitive.minAlpha=e},CgsSlope3D.prototype.getMinAlpha=function(){return this._primitive.minAlpha},CgsSlope3D.prototype.setMaxAlpha=function(e){this._primitive.maxAlpha=e},CgsSlope3D.prototype.getMaxAlpha=function(){return this._primitive.maxAlpha},CgsSlope3D.SLOPE="slope",CgsRibbon3D=function(e){this._map=void 0,this.show=Cesium.defaultValue(e.show,!0),this.color=Cesium.defaultValue(e.color,"rgba(255,0,0,1)"),this.minAlpha=Cesium.defaultValue(e.minAlpha,.005);var t=Cesium.Color.fromCssColorString(this.color);this.maxAlpha=Cesium.defaultValue(e.maxAlpha,t.alpha),this.maxNum=Cesium.defaultValue(e.maxNum,100),this.offsetX=Cesium.defaultValue(e.offsetX,0),this.offsetY=Cesium.defaultValue(e.offsetY,0),this.offsetZ=Cesium.defaultValue(e.offsetZ,0),this.width=Cesium.defaultValue(e.width,5),this.type="ribbon";var i={show:this.show,color:this.color,positions:this.positions,maxNum:this.maxNum,deleteNum:this.deleteNum,offsetX:this.offsetX,offsetY:this.offsetY,offsetZ:this.offsetZ,width:this.width,minAlpha:this.minAlpha,maxAlpha:this.maxAlpha};this._primitive=new Cesium.FeRibbonPrimitive(i),Cesium.FeRibbonPrimitive.call(this,i)},CgsRibbon3D.prototype.getMap=function(){return this._map},CgsRibbon3D.prototype.setMap=function(e){this._map=e},CgsRibbon3D.prototype.getPrimitive=function(){return this._primitive},CgsRibbon3D.prototype.setType=function(e){this.type=e},CgsRibbon3D.prototype.getType=function(){return this.type},CgsRibbon3D.prototype.setOffsetX=function(e){this._primitive.offsetX=e},CgsRibbon3D.prototype.getOffsetX=function(){return this._primitive.offsetX},CgsRibbon3D.prototype.setOffsetY=function(e){this._primitive.offsetY=e},CgsRibbon3D.prototype.getOffsetY=function(){return this._primitive.offsetY},CgsRibbon3D.prototype.setOffsetZ=function(e){this._primitive.offsetZ=e},CgsRibbon3D.prototype.getOffsetZ=function(){return this._primitive.offsetZ},CgsRibbon3D.prototype.setWidth=function(e){this._primitive.width=e},CgsRibbon3D.prototype.getWidth=function(){return this._primitive.width},CgsRibbon3D.prototype.setPosition=function(e){this._primitive.addPoint(e)},CgsRibbon3D.prototype.setMaxNum=function(e){return this._primitive.worldCoordArr=[],this._primitive.maxNum=e},CgsRibbon3D.prototype.getMaxNum=function(){return this._primitive.maxNum},CgsRibbon3D.prototype.setRotate=function(e){return this._primitive.curHpr=e},CgsRibbon3D.prototype.getRotate=function(){return this._primitive.curHpr},CgsRibbon3D.prototype.setDelteNum=function(e){return this._primitive.delteNum=e},CgsRibbon3D.prototype.getDelteNum=function(){return this._primitive.delteNum},CgsRibbon3D.prototype.setColor=function(e){this._primitive.color=e},CgsRibbon3D.prototype.getColor=function(){return this._primitive.color},CgsRibbon3D.prototype.setVisible=function(e){this.show=e,this._primitive.show=e},CgsRibbon3D.prototype.getVisible=function(){return this._primitive.show},CgsRibbon3D.prototype.setMinAlpha=function(e){this._primitive.minAlpha=e},CgsRibbon3D.prototype.getMinAlpha=function(){return this._primitive.minAlpha},CgsRibbon3D.prototype.setMaxAlpha=function(e){this._primitive.maxAlpha=e},CgsRibbon3D.prototype.getMaxAlpha=function(){return this._primitive.maxAlpha},CgsRibbon3D.RIBBON="ribbon",CgsGlowFlyLine3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.show=Cesium.defaultValue(e.show,!0),this.color=Cesium.defaultValue(e.color,"rgba(0.0,255.0,255.0,1.0)"),this.pointNum=Cesium.defaultValue(e.pointNum,100),this.speed=Cesium.defaultValue(e.speed,50),this.glowPower=Cesium.defaultValue(e.glowPower,.1),this.width=Cesium.defaultValue(e.width,10),this.map=void 0;var t={show:this.show,color:this.color,pointNum:this.pointNum,speed:this.speed,width:this.width};this.type=CgsGlowFlyLine3D.GlowFlyLine,this.flyLine=new Cesium.FeFlyLine(t),this.saveFlag=!0}),CgsGlowFlyLine3D.prototype.setMap=function(e){this.map=e},CgsGlowFlyLine3D.prototype.getMap=function(){return this.map},CgsGlowFlyLine3D.prototype.getFlyLine=function(){return this.flyLine},CgsGlowFlyLine3D.prototype.getType=function(){return this.type},CgsGlowFlyLine3D.prototype.setVisible=function(e){this.show=e,this.flyLine.show=e},CgsGlowFlyLine3D.prototype.getVisible=function(){return this.show},CgsGlowFlyLine3D.prototype.addFlyLine=function(e){Cesium.defined(e)&&Cesium.defined(e.positions)?(this.flyLine.add(e),this.flyLine.dirty()):console.info(" you must defined positions")},CgsGlowFlyLine3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsGlowFlyLine3D.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsGlowFlyLine3D.GlowFlyLine="CgsGlowFlyLine",CgsPlaneRadar3D=function(e){this.position=Cesium.defaultValue(e.position,[[115,35,5e5],[115,31,5e5]]),this._show=Cesium.defaultValue(e.show,!0),this.highLight=Cesium.defaultValue(e.highLight,!1),this.flash=Cesium.defaultValue(e.flash,!1),this.moveInterval=Cesium.defaultValue(e.moveInterval,2),this.flashInterval=Cesium.defaultValue(e.flashInterval,.1),this.highLightInterval=Cesium.defaultValue(e.highLightInterval,.1),this.move=Cesium.defaultValue(e.move,!0),this.outRadius=Cesium.defaultValue(e.outRadius,16e3),this.middleRadius=Cesium.defaultValue(e.middleRadius,8e3),this.inRadius=Cesium.defaultValue(e.inRadius,2e3),this.color=Cesium.defaultValue(e.color,"rgba(123,15, 15, 0.1)"),this.ringColor=Cesium.defaultValue(e.ringColor,"rgba(255,255,255,1)"),this.highLightColor=Cesium.defaultValue(e.highLightColor,"rgba(255,0,255,1)");var t={color:this.color,ringColor:this.ringColor,highLightColor:this.highLightColor,show:this._show,outRadius:this.outRadius,middleRadius:this.middleRadius,inRadius:this.inRadius,position:this.position,move:this.move,speed:this.speed,flash:this.flash,flashInterval:this.flashInterval,highLight:this.highLight,highLightInterval:this.highLightInterval};this._primitive=new Cesium.FePlaneRadarPrimitive(t),CgsRadar3D.call(this,e),this._type=CgsRadar.PLANE_RADAR},CgsInherits(CgsPlaneRadar3D,CgsRadar3D),CgsPlaneRadar3D.prototype.getBoundingSphere=function(){return this._primitive.boundingSphere},CgsPlaneRadar3D.prototype.setPosition=function(e){this.position=e,this._primitive.position=e},CgsPlaneRadar3D.prototype.getPosition=function(){return this._primitive?this._primitive.position:this.position},CgsPlaneRadar3D.prototype.setColor=function(e){this.color=e,this._primitive.color=e},CgsPlaneRadar3D.prototype.getColor=function(){return this._primitive.color},CgsPlaneRadar3D.prototype.setHighLightColor=function(e){this.highLightColor=e,this._primitive.highLightColor=e},CgsPlaneRadar3D.prototype.getHighLightColor=function(){return this._primitive.highLightColor},CgsPlaneRadar3D.prototype.setRingColor=function(e){this.ringColor=e,this._primitive.ringColor=e},CgsPlaneRadar3D.prototype.getRingColor=function(){return this._primitive.ringColor},CgsPlaneRadar3D.prototype.setMove=function(e){this._primitive.move=e},CgsPlaneRadar3D.prototype.getMove=function(){return this._primitive.move},CgsPlaneRadar3D.prototype.setHighLight=function(e){this.highLight=e,this._primitive.highLight=e},CgsPlaneRadar3D.prototype.getHighLight=function(){return this._primitive.highLight},CgsPlaneRadar3D.prototype.setFlash=function(e){this.flash=e,this._primitive.flash=e},CgsPlaneRadar3D.prototype.getFlash=function(){return this._primitive.flash},CgsPlaneRadar3D.prototype.setOutRadius=function(e){this.outRadius=e,this._primitive.outRadius=e},CgsPlaneRadar3D.prototype.getOutRadius=function(){return this._primitive.outRadius},CgsPlaneRadar3D.prototype.setMiddleRadius=function(e){this.middleRadius=e,this._primitive.middleRadius=e},CgsPlaneRadar3D.prototype.getMiddleRadius=function(){return this._primitive.middleRadius},CgsPlaneRadar3D.prototype.setInRadius=function(e){this.inRadius=e,this._primitive.inRadius=e},CgsPlaneRadar3D.prototype.getInRadius=function(){return this._primitive.inRadius},CgsPlaneRadar3D.prototype.setMoveInterval=function(e){this.moveInterval=e,this._primitive.moveInterval=e},CgsPlaneRadar3D.prototype.getMoveInterval=function(){return this.moveInterval},CgsPlaneRadar3D.prototype.setFlashInterval=function(e){this.flashInterval=e,this._primitive.flashInterval=e},CgsPlaneRadar3D.prototype.getFlashInterval=function(){return this.flashInterval},CgsPlaneRadar3D.prototype.setHighLightInterval=function(e){this.highLightInterval=e,this._primitive.highLightInterval=e},CgsPlaneRadar3D.prototype.getHighLightInterval=function(){return this.highLightInterval},CgsPlaneRadar3D.prototype._updateGeometry=function(){var e,t=this.getMap();null!=t&&(t instanceof CgsMap&&(t=t.map3D),Cesium.defined(t)&&t instanceof CgsMap3D&&t.scene.primitives.contains(this._primitive)&&(t.scene.primitives.remove(this._primitive),this._primitive=void 0),e={color:this.color,ringColor:this.ringColor,highLightColor:this.highLightColor,show:this.show,outRadius:this.outRadius,middleRadius:this.middleRadius,inRadius:this.inRadius,position:this.position,move:this.move,speed:this.speed,flash:this.flash,flashInterval:this.flashInterval,highLight:this.highLight,highLightInterval:this.highLightInterval},this._primitive=new Cesium.FePlaneRadarPrimitive(e),Cesium.defined(t)&&t.scene.primitives.add(this._primitive))},CgsSatelliteRadar3D=function(e){var t=!1;e.launchPositions&&(t=!0),this.cirPosition=Cesium.defaultValue(e.destinationPosition,[120.3,23.5,1e3]),this.vertexPosition=Cesium.defaultValue(e.launchPosition,[96,40,1e4]),this._show=Cesium.defaultValue(e.show,!0),this.satelliteRadius=Cesium.defaultValue(e.radius,1e5),this.radarColor=Cesium.defaultValue(e.radarColor,"rgba(255,0, 0, 1)");this.type=CgsRadar.SATELLITE_RADAR,this.selfType="CgsSatelliteRadar",this.primitives=[],this.bottomCirVert=[],this.bottomTempVert=[],this.triangleVert=[],this._start=!0;var i=Cesium.HeadingPitchRoll.fromDegrees(0,0,0,new Cesium.HeadingPitchRoll);this.rotate=Cesium.Matrix3.fromHeadingPitchRoll(i,new Cesium.Matrix3),this.matScale=Cesium.Matrix3.fromScale(new Cesium.Cartesian3(1,1,1)),this.modelMatrix=Cesium.Matrix4.IDENTITY,CgsRadar3D.call(this,e),this.triangleInstance=void 0,this.bottomCirInstance=void 0,this._primitive=new Cesium.PrimitiveCollection,this.bottomCirPrimitive,this.trianglePrimitive,this.bottomCir(e,t),this.radarHookFace(),this.instance(),this.createPrimitives()},CgsInherits(CgsSatelliteRadar3D,CgsRadar3D),CgsSatelliteRadar3D.prototype.bottomCir=function(e,t){var i=Math.PI/180,s=[],o=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(this.cirPosition[0],this.cirPosition[1],this.cirPosition[2]),Cesium.Ellipsoid.WGS84,new Cesium.Matrix4),a=Cesium.Cartesian3.fromDegrees(this.vertexPosition[0],this.vertexPosition[1],this.vertexPosition[2]);if(this.modelMatrix=Cesium.Matrix4.fromTranslation(a,new Cesium.Matrix4),t)for(var n=0;n<e.launchPositions.length;n++){var r=Cesium.Math.toRadians(e.launchPositions[n][0]),l=Cesium.Math.toRadians(e.launchPositions[n][1]);(h=Cesium.Cartesian3.fromRadians(r,l,0)).x-=a.x,h.y-=a.y,h.z-=a.z,s.push(h.x),s.push(h.y),s.push(h.z)}else for(n=0;n<=360;++n){var u=this.satelliteRadius*Math.cos(n*i),p=this.satelliteRadius*Math.sin(n*i),h=Cesium.Matrix4.multiplyByPoint(o,new Cesium.Cartesian3(u,p,0),new Cesium.Cartesian3),c=Cesium.Cartographic.fromCartesian(h);c.height=0,(h=Cesium.Cartesian3.fromRadians(c.longitude,c.latitude,c.height)).x-=a.x,h.y-=a.y,h.z-=a.z,s.push(h.x),s.push(h.y),s.push(h.z)}this.bottomCirVert=s},CgsSatelliteRadar3D.prototype.radarHookFace=function(){this.triangleVert=[],this.triangleVert.push(0),this.triangleVert.push(0),this.triangleVert.push(1e-6);for(var e=0;e<this.bottomCirVert.length;e+=3)this.triangleVert.push(this.bottomCirVert[e]),this.triangleVert.push(this.bottomCirVert[e+1]),this.triangleVert.push(this.bottomCirVert[e+2]);this.triangleVert.push(this.bottomCirVert[0]),this.triangleVert.push(this.bottomCirVert[1]),this.triangleVert.push(this.bottomCirVert[2])},CgsSatelliteRadar3D.prototype.instance=function(){this.triangleInstance=new Cesium.GeometryInstance({geometry:new Cesium.Geometry({attributes:{position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:this.triangleVert})},primitiveType:Cesium.PrimitiveType.TRIANGLE_FAN,boundingSphere:Cesium.BoundingSphere.fromVertices(this.triangleVert)}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color.fromCssColorString(this.radarColor))},id:"SatelliteRadar"}),this.bottomCirInstance=new Cesium.GeometryInstance({geometry:new Cesium.Geometry({attributes:{position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:this.bottomCirVert})},primitiveType:Cesium.PrimitiveType.LINE_LOOP,boundingSphere:Cesium.BoundingSphere.fromVertices(this.bottomCirVert)}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color.fromCssColorString(this.radarColor))},id:"SatelliteRadar2"})},CgsSatelliteRadar3D.prototype.createPrimitives=function(){this.bottomCirPrimitive=new Cesium.Primitive({geometryInstances:this.bottomCirInstance,appearance:new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!0}),asynchronous:!1,allowPicking:!0,cull:!1}),this.bottomCirPrimitive.modelMatrix=this.modelMatrix,this._primitive.add(this.bottomCirPrimitive),(this.bottomCirPrimitive.owner=this).trianglePrimitive=new Cesium.Primitive({geometryInstances:this.triangleInstance,appearance:new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!0}),asynchronous:!1,allowPicking:!0}),this.trianglePrimitive.modelMatrix=this.modelMatrix,this._primitive.add(this.trianglePrimitive),this.trianglePrimitive.owner=this},CgsSatelliteRadar3D.prototype.setPosition=function(e){this.position=e},CgsSatelliteRadar3D.prototype.setMap=function(e){this.map=e},CgsSatelliteRadar3D.prototype.getMap=function(e){return this.map},CgsSatelliteRadar3D.prototype.getType=function(){return this.type},CgsSatelliteRadar3D.prototype.setColor=function(e){this.radarColor=e;var t=this._primitive._primitives[1].getGeometryInstanceAttributes(CgsSatelliteRadar3D.SatelliteRadar);this._primitive._primitives[0].getGeometryInstanceAttributes(CgsSatelliteRadar3D.SatelliteRadar2).color=Cesium.ColorGeometryInstanceAttribute.toValue(Cesium.Color.fromCssColorString(e)),t.color=Cesium.ColorGeometryInstanceAttribute.toValue(Cesium.Color.fromCssColorString(e))},CgsSatelliteRadar3D.prototype.getColor=function(){return this.radarColor},CgsSatelliteRadar3D.prototype.setRadius=function(e){this.satelliteRadius=e,this._updateGeometry()},CgsSatelliteRadar3D.prototype.getRadius=function(){return this.satelliteRadius},CgsSatelliteRadar3D.prototype.setVisible=function(e){this._show=e,this._primitive.show=e},CgsSatelliteRadar3D.prototype.getVisible=function(){return this._show},CgsSatelliteRadar3D.prototype._updateGeometry=function(e){var t=this.getMap();null!=t&&(t instanceof CgsMap&&(t=t.map3D),Cesium.defined(t)&&t instanceof CgsMap3D&&t.scene.primitives.contains(this._primitive)&&(t.scene.primitives.remove(this._primitive),this._primitive=void 0),this.triangleInstance=void 0,this.bottomCirInstance=void 0,this._primitive=new Cesium.PrimitiveCollection,this.bottomCirPrimitive=void 0,this.trianglePrimitive=void 0,e&&(this.cirPosition=Cesium.defaultValue(e.destinationPosition,[120.3,23.5,1e3]),this.vertexPosition=Cesium.defaultValue(e.launchPosition,[96,40,1e4])),this.bottomCir(),this.radarHookFace(),this.instance(),this.createPrimitives(),Cesium.defined(t)&&t.scene.primitives.add(this._primitive))},CgsSatelliteRadar3D.SatelliteRadar="SatelliteRadar",CgsSatelliteRadar3D.SatelliteRadar2="SatelliteRadar2",CgsLayerRadar3D=function(e){var t;this.map=null,this.show=Cesium.defaultValue(e.show,!0),this.speed=Cesium.defaultValue(e.speed,30),this.color=Cesium.defaultValue(e.color,"rgba(0,150,140,0.2)"),this.lineColor=Cesium.defaultValue(e.lineColor,"rgba(0,190,180,0.4)"),this.scanColor=Cesium.defaultValue(e.scanColor,"rgba(0,180,190,0.4)"),this.url=Cesium.defaultValue(e.url,void 0),this.isClockwise=Cesium.defaultValue(e.isClockwise,!0),Cesium.defined(this.url)&&(t={show:this.show,color:this.color,lineColor:this.lineColor,scanColor:this.scanColor,speed:this.speed,url:this.url,isClockwise:this.isClockwise},this._primitive=new Cesium.FeLayerRadarPrimitive(t),CgsRadar3D.call(this,e),this._type="LayerRadar")},CgsInherits(CgsLayerRadar3D,CgsRadar3D),CgsLayerRadar3D.prototype.getBoundingSphere=function(){return this._primitive.boundingSphere},CgsLayerRadar3D.prototype.setLineColor=function(e){this._primitive.setLineColor(e)},CgsLayerRadar3D.prototype.getLineColor=function(){return this._primitive.getLineColor()},CgsLayerRadar3D.prototype.setScanColor=function(e){this._primitive.setScanColor(e)},CgsLayerRadar3D.prototype.getScanColor=function(){return this._primitive.getScanColor()},CgsLayerRadar3D.prototype.setColor=function(e){this._primitive.setColor(e)},CgsLayerRadar3D.prototype.getColor=function(){return this._primitive.getColor()},CgsLayerRadar3D.prototype.setVisible=function(e){this.show=e,this._primitive._show=e},CgsLayerRadar3D.prototype.getVisible=function(){return this._primitive._show},CgsLayerRadar3D.prototype.setSpeed=function(e){this._primitive.setSpeed(e)},CgsLayerRadar3D.prototype.getSpeed=function(){return this._primitive.getSpeed()},CgsLayerRadar3D.prototype.setIsClockwise=function(e){this.isClockwise=e,this._primitive.setIsClockwise(e)},CgsLayerRadar3D.prototype.getIsClockwise=function(){return this.isClockwise},CgsLayerRadar3D.prototype._updateGeometry=function(){var e,t=this.getMap();null!=t&&(t instanceof CgsMap&&(t=t.map3D),Cesium.defined(t)&&t instanceof CgsMap3D&&t.scene.primitives.contains(this._primitive)&&(t.scene.primitives.remove(this._primitive),this._primitive=void 0),e={show:this.show,color:this.color,lineColor:this.lineColor,scanColor:this.scanColor,speed:this.speed,url:this.url},this._primitive=new Cesium.FeLayerRadarPrimitive(e),Cesium.defined(t)&&t.scene.primitives.add(this._primitive))},CgsPlaneScanRadar3D=function(e){this._position=Cesium.defaultValue(e.position,[120,40,5e3]),this._waveColor=Cesium.defaultValue(e.waveColor,"rgba(0,255,0,1.0)"),this.lineColor=Cesium.defaultValue(e.lineColor,"rgba(0,255,0,1.0)"),this._radius=Cesium.defaultValue(e.radius,2e5),this.waveNum=Cesium.defaultValue(e.ring,5),this._height=0,3!==this._position.length?this._height=0:this._height=this._position[2],this.ringPri=[],this._show=Cesium.defaultValue(e.show,!0),this._waveShow=Cesium.defaultValue(e.waveShow,!0),this._crossShow=Cesium.defaultValue(e.crossShow,!0),this._curFrameIndex=0,this._lastTimeStamp=void 0,this._circlePoint=Cesium.defaultValue(e.circlePoint,180),this._boundSphere=void 0,this._angle=Cesium.defaultValue(e.angle,30),this._speed=Cesium.defaultValue(e.speed,1),this._clockwise=Cesium.defaultValue(e.clockwise,!1),CgsRadar3D.call(this,e),this._type=CgsRadar.PLANESCAN_RADAR,this.selfType="PlaneScanRadar",this.boundingSphere=void 0,this.hori=[],this.vert=[],this._primitive=new Cesium.PrimitiveCollection,this.createPrimitives()},CgsInherits(CgsPlaneScanRadar3D,CgsRadar3D),CgsPlaneScanRadar3D.prototype.createPrimitives=function(){this._primitive=new Cesium.PrimitiveCollection,this.ringPri=[],this.vertPri=void 0,this.horiPri=void 0;var e={position:this._position,radius:this._radius,speed:this._speed,angle:this._angle,color:this._waveColor,ring:this.waveNum,waveShow:this._waveShow,crossShow:this._crossShow,show:this._show,clockwise:this._clockwise};this._scanAspectPrimitive=new Cesium.FeScanPrimitive(e),this._primitive.add(this._scanAspectPrimitive);var t=[];if(this._waveShow)for(var i=0;i<this.waveNum;++i){this._circlePoint,this._circlePoint;var s=this.splitCircle2GeoPosition(this._radius*(i+1)/this.waveNum,-1,this._circlePoint*(i+1)/this.waveNum+1);if(t.push(s),this.waveNum-1==i){for(var o=[],a=Cesium.Cartesian3.fromDegrees(this._position[0],this._position[1],this._position[2]),i=0;i<s.length-1;++i)o.push([a,s[i],s[i+1]]);this.boundingSphere=o}}this.splitLine(this._radius),this._crossShow&&(t.push(this.vert),t.push(this.hori));var n=new Cesium.FePlaneScanPrimitive({singleRingPosArr:t,color:this.lineColor});this.ringPri.push(n),this._primitive.add(n)},CgsPlaneScanRadar3D.prototype.getBoundingSphere=function(){return this.boundingSphere},CgsPlaneScanRadar3D.prototype.removePrimitives=function(){var e=this.getMap();null!=e&&(e instanceof CgsMap&&(e=e.map3D),Cesium.defined(e)&&e instanceof CgsMap3D&&e.scene.primitives.contains(this._primitive)&&(e.scene.primitives.remove(this._primitive),this._primitive=void 0),this._primitive=new Cesium.PrimitiveCollection,this.hori=[],this.vert=[],this.ringPri=[],this.vertPri=void 0,this.horiPri=void 0)},CgsPlaneScanRadar3D.prototype.splitCircle2GeoPosition=function(e,t,i){for(var s=this._position[0],o=this._position[1],a=this._position[2],n=[],r=(this._circlePoint,Cesium.Math.toRadians(o)),l=Cesium.Math.toRadians(s),u=e/6378137,p=(Math.PI,0),h=t;h<=i;++h){var c,g,d=2*h*Math.PI/(i-1),m=Math.asin(Math.sin(r)*Math.cos(u)+Math.cos(r)*Math.sin(u)*Math.cos(d));p=0==Math.cos(r)?l:(c=l-Math.asin(Math.sin(d)*Math.sin(u)/Math.cos(r))+Math.PI,g=2*Math.PI,c-parseInt(c/g)*g-Math.PI),p=Cesium.Math.toDegrees(p),m=Cesium.Math.toDegrees(m),n.push(Cesium.Cartesian3.fromDegrees(p,m,a))}return n},CgsPlaneScanRadar3D.prototype.splitLine=function(e){for(var t=this._position[0],i=this._position[1],s=this._position[2],o=(this._circlePoint,6378137),a=Cesium.Math.toRadians(i),n=Cesium.Math.toRadians(t),r=e/o,l=(Math.PI,0),u=0,p=this._circlePoint/2,h=p;0<=h;--h){r=e/o*(h/p);var c=0*Math.PI/360,u=Math.asin(Math.sin(a)*Math.cos(r)+Math.cos(a)*Math.sin(r)*Math.cos(c));l=0==Math.cos(a)?n:(g=n-Math.asin(Math.sin(c)*Math.sin(r)/Math.cos(a))+Math.PI,d=2*Math.PI,g-parseInt(g/d)*d-Math.PI),l=Cesium.Math.toDegrees(l),u=Cesium.Math.toDegrees(u),this.vert.push(Cesium.Cartesian3.fromDegrees(l,u,s))}for(h=1;h<=p;++h){r=e/o*(h/p);c=360*Math.PI/360;u=Math.asin(Math.sin(a)*Math.cos(r)+Math.cos(a)*Math.sin(r)*Math.cos(c)),l=0==Math.cos(a)?n:(g=n-Math.asin(Math.sin(c)*Math.sin(r)/Math.cos(a))+Math.PI,d=2*Math.PI,g-parseInt(g/d)*d-Math.PI),l=Cesium.Math.toDegrees(l),u=Cesium.Math.toDegrees(u),this.vert.push(Cesium.Cartesian3.fromDegrees(l,u,s))}for(h=p;0<=h;--h){r=e/o*(h/p);c=180*Math.PI/360;u=Math.asin(Math.sin(a)*Math.cos(r)+Math.cos(a)*Math.sin(r)*Math.cos(c)),l=0==Math.cos(a)?n:(g=n-Math.asin(Math.sin(c)*Math.sin(r)/Math.cos(a))+Math.PI,d=2*Math.PI,g-parseInt(g/d)*d-Math.PI),l=Cesium.Math.toDegrees(l),u=Cesium.Math.toDegrees(u),this.hori.push(Cesium.Cartesian3.fromDegrees(l,u,s))}for(h=1;h<=p;++h){r=e/o*(h/p);var g,d,c=540*Math.PI/360;u=Math.asin(Math.sin(a)*Math.cos(r)+Math.cos(a)*Math.sin(r)*Math.cos(c)),l=0==Math.cos(a)?n:(g=n-Math.asin(Math.sin(c)*Math.sin(r)/Math.cos(a))+Math.PI,d=2*Math.PI,g-parseInt(g/d)*d-Math.PI),l=Cesium.Math.toDegrees(l),u=Cesium.Math.toDegrees(u),this.hori.push(Cesium.Cartesian3.fromDegrees(l,u,s))}},CgsPlaneScanRadar3D.prototype.setPosition=function(e){this._position=e,this._updateGeometry()},CgsPlaneScanRadar3D.prototype.getPosition=function(){return this._position},CgsPlaneScanRadar3D.prototype.setVisible=function(e){if(this._show=e,this._scanAspectPrimitive.show=e)this.setWaveVisible(this._waveShow),this.setCrossVisible(this._crossShow);else for(var t=0;t<this.ringPri.length;++t)this.ringPri[t].show=e},CgsPlaneScanRadar3D.prototype.getVisible=function(){return this._show},CgsPlaneScanRadar3D.prototype.setWaveVisible=function(e){this._waveShow=e,this._updateGeometry()},CgsPlaneScanRadar3D.prototype.getWaveVisible=function(){return this._waveShow},CgsPlaneScanRadar3D.prototype.setCrossVisible=function(e){this._crossShow=e,this._updateGeometry()},CgsPlaneScanRadar3D.prototype.getCrossVisible=function(){return this._crossShow},CgsPlaneScanRadar3D.prototype.setMap=function(e){this.map=e},CgsPlaneScanRadar3D.prototype.getMap=function(e){return this.map},CgsPlaneScanRadar3D.prototype.setRadius=function(e){this._radius=e,this._updateGeometry()},CgsPlaneScanRadar3D.prototype.getRadius=function(){return this._radius},CgsPlaneScanRadar3D.prototype.setSpeed=function(e){this._speed=e,this._scanAspectPrimitive._speed=e},CgsPlaneScanRadar3D.prototype.getSpeed=function(){return this._speed},CgsPlaneScanRadar3D.prototype.setAngle=function(e){this._angle=e,this._scanAspectPrimitive._angle=e},CgsPlaneScanRadar3D.prototype.getAngle=function(){return this._angle},CgsPlaneScanRadar3D.prototype.setWaveColor=function(e){this._waveColor=e,this._scanAspectPrimitive.color=Cesium.Color.fromCssColorString(e)},CgsPlaneScanRadar3D.prototype.getWaveColor=function(){return this._waveColor},CgsPlaneScanRadar3D.prototype.setColor=function(e){this.lineColor=e;for(var t=0;t<this.ringPri.length;++t)this.ringPri[t].color=e},CgsPlaneScanRadar3D.prototype.getColor=function(){return this.lineColor},CgsPlaneScanRadar3D.prototype.setRing=function(e){this.waveNum=e,this._updateGeometry()},CgsPlaneScanRadar3D.prototype.getRing=function(){return this.waveNum},CgsPlaneScanRadar3D.prototype._updateGeometry=function(){this.removePrimitives(),this.createPrimitives();var e=this.getMap();e&&e.scene.primitives.add(this._primitive)},CgsPlaneScanRadar3D.prototype.setClockwise=function(e){this._clockwise=e,this._scanAspectPrimitive.clockwise=e},CgsPlaneScanRadar3D.prototype.getClockwise=function(){return this._clockwise},CgsRORadar3D=function(e){this.position=Cesium.defaultValue(e.position,[120,40,5e3]),this.color=Cesium.defaultValue(e.color,"rgba(255,0,0,0.4)"),this.flowerColor=Cesium.defaultValue(e.flowerColor,"rgba(0,255,0,1.0)"),this._show=Cesium.defaultValue(e.show,!0),this.radius=Cesium.defaultValue(e.radius,3e5);this.type=CgsRadar.RO_RADAR,this.radarType=Cesium.defaultValue(e.type,2),this.selfType="CgsRORadar";var t={position:this.position,radius:this.radius,color:this.color,flowerColor:this.flowerColor,show:this._show,type:this.radarType};this._primitive=new Cesium.FeROPrimitive(t),CgsRadar3D.call(this,e)},CgsInherits(CgsRORadar3D,CgsRadar3D),CgsRORadar3D.prototype.getBoundingSphere=function(){return this._primitive.boundingSphere},CgsRORadar3D.prototype.setPosition=function(e){this.position=e,this._primitive.position=e},CgsRORadar3D.prototype.getPosition=function(){return this.position},CgsRORadar3D.prototype.setMap=function(e){this.map=e},CgsRORadar3D.prototype.getMap=function(e){return this.map},CgsRORadar3D.prototype.getType=function(){return this.type},CgsRORadar3D.prototype.setVisible=function(e){this._show=e,this._primitive.show=e},CgsRORadar3D.prototype.getVisible=function(){return this._show},CgsRORadar3D.prototype.setColor=function(e){this.color=e,this._updateGeometry()},CgsRORadar3D.prototype.getColor=function(){return this.color},CgsRORadar3D.prototype.setFlowerColor=function(e){this.flowerColor=e,this._updateGeometry()},CgsRORadar3D.prototype.getFlowerColor=function(){return this.flowerColor},CgsRORadar3D.prototype.setRadius=function(e){this.radius=e,this._updateGeometry()},CgsRORadar3D.prototype.getRadius=function(){return this.radius},CgsRORadar3D.prototype.setRadarType=function(e){this.radarType=e,this._updateGeometry()},CgsRORadar3D.prototype.getRadarType=function(){return this.radarType},CgsRORadar3D.prototype._updateGeometry=function(){var e,t=this.getMap();null!=t&&(t instanceof CgsMap&&(t=t.map3D),Cesium.defined(t)&&t instanceof CgsMap3D&&t.scene.primitives.contains(this._primitive)&&(t.scene.primitives.remove(this._primitive),this._primitive=void 0),this.getRadius(),this.getColor(),this.getFlowerColor(),this.getPosition(),this.getVisible(),this.getRadarType(),Cesium.defined(t)&&t.scene.primitives.contains(this._primitive)&&(t.scene.primitives.remove(this._primitive),this._primitive=void 0),e={position:this.position,radius:this.radius,color:this.color,flowerColor:this.flowerColor,show:this._show,type:this.radarType},this._primitive=new Cesium.FeROPrimitive(e),Cesium.defined(t.scene)&&(t.scene.primitives.add(this._primitive),this.setMap(t)))},CgsAnalyze3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var n,t=e.mapObject;this._viewer=void 0,Cesium.defined(t)&&(this._viewer=t.map3D,this._showPoint=Cesium.defaultValue(e.showPoint,!0),this._showGradientDlg=Cesium.defaultValue(e.showGradientDlg,!0),this._state={type:e.type,points:[],entities:[],list:[],labelList:[],mode:e.mode,timeFlag:!1,currentLength:0,primitives:[],altitudes:[],polygonAnalyzeLine:[]},this._lineColor=Cesium.defaultValue(e.lineColor,"rgba(0.0,255.0,255.0,0.8)"),this._fillColor=Cesium.defaultValue(e.fillColor,"rgba(0.0,255.0,0.0,0.3)"),this._coverColor=Cesium.defaultValue(e.coverColor,"rgba(255.0,0.0,0.0,0.3)"),this._sampleLength=Cesium.defaultValue(e.sampleLength,10),this._interval=Cesium.defaultValue(e.sampleCount,60),this._labelColor=Cesium.defaultValue(e.labelColor,"rgba(255.0,255.0,255.0,1.0)"),this._prismColor=Cesium.defaultValue(e.prismColor,"rgba(90,90,0,0.5)"),this._groundColor=Cesium.defaultValue(e.groundColor,"rgba(128,96,0,1.0)"),this._baseColor=Cesium.defaultValue(e.baseColor,"rgba(225,225,0,1.0)"),this._floodColor=Cesium.defaultValue(e.floodColor,"rgba(28,41,79,0.8)"),this._isTerrain=void 0,this._drawlineObj=void 0,this._drawpolygonObj=void 0,this._drawCircleObj=void 0,(n=this)._lineAnalyzeInfo=[],this._visibleDistance=0,this._coverRate=0,this._gradient=[],this._gradientAllPoint=[],this._slopeAspectAllPoint=[],this._gradientTool=null,this._slopeAspectTool=null,this._profileHeight=[],this._profileAllPoint=[],this._profileTool=null,this._fillDigTool=null,this._floodTool=null,this._profilePoint=void 0,this._gradientPoint=void 0,this._slopeAspectPoint=void 0,this._terrainSamples=[],this.fillDigKeyPoint=void 0,this._baseHeight=0,this.minHeight=0,this.maxHeight=0,this._prism=void 0,this._plane=void 0,this.mDefaultDepth=!0,this.mDepth=0,this.mMinAltiPointZ=0,this.mMaxAltiPointZ=0,this.digVolume=0,this.fillVolume=0,this.groundArea=0,this.maxAltiPoint=void 0,this.minAltiPoint=void 0,this._sampleInterval=Cesium.defaultValue(e.sampleInterval,100),this.isCalculateDone=!1,this.slopeEast=-180,this.slopeWest=180,this.slopeNorth=-90,this.slopeSouth=90,this.slopeSpanX=0,this.slopeSpanY=0,this.slopeInterpolationCountX=0,this.slopeInterpolationCountY=0,this.slopeIntervalX=100,this.slopeIntervalY=100,this.slopeDefaultCalcuMode=!0,this.slopeDivisions=[0,2,6,10,25,45,90],this.slopeColors=[Cesium.Color.fromCssColorString("rgba(127.0, 255.0, 212.0, 0.5)"),Cesium.Color.fromCssColorString("rgba(0.0, 255.0, 0.0, 0.5)"),Cesium.Color.fromCssColorString("rgba(255.0, 255.0, 0.0, 0.5)"),Cesium.Color.fromCssColorString("rgba(255.0, 215.0, 0.0, 0.5)"),Cesium.Color.fromCssColorString("rgba(255.0, 128.0, 0.0, 0.5)"),Cesium.Color.fromCssColorString("rgba(255.0, 97.0, 0.0, 0.5)"),Cesium.Color.fromCssColorString("rgba(255.0, 0.0, 0.0, 0.5)")],this.aspectImages=[CGS_SDK_PATH+"assets/aspect/up.png",CGS_SDK_PATH+"assets/aspect/upRight.png",CGS_SDK_PATH+"assets/aspect/right.png",CGS_SDK_PATH+"assets/aspect/rightDown.png",CGS_SDK_PATH+"assets/aspect/down.png",CGS_SDK_PATH+"assets/aspect/downLeft.png",CGS_SDK_PATH+"assets/aspect/left.png",CGS_SDK_PATH+"assets/aspect/leftUp.png"],this.slopeList=[],this.aspectList=[],this.slopePositionList=[],this.slopeAspectPositionList=[],this.floodSurfaceArea=0,this.isFloodVolumeCalcu=!1,this.floodVolume=0,this.floodKeyPoint=void 0,this.waterAltitude=0,this.baseWaterHeight=0,this.minWaterHeight=0,this.maxWaterHeight=0,this.clock=void 0,this._waterSpeed=10,this.floodInstance=[],this.visibilityFrustum=new Cesium.FeViewFrustum,this._viewer.scene.primitives.add(this.visibilityFrustum),CgsSubPub.subscribe("toolStopResize",function(e,t,i){n._gradientTool&&t[0]==n._gradientTool&&CgsSubPub.publish("gradientAnalyze",[n._gradient]),n._profileTool&&t[0]==n._profileTool&&CgsSubPub.publish("profileAnalyze",[n._profileHeight]),n._slopeAspectTool&&t[0]==n._slopeAspectTool&&CgsSubPub.publish("slopeaspectAnalyze",[n._profileHeight])}),CgsSubPub.subscribe("toolActive",function(e,t,i){0==i&&t==n._gradientTool?(n._removeGradientPoint(),n._gradientTool.unsubscribe(),n._gradientTool=null):0==i&&t==n._profileTool?(n._removeProfilePoint(),n._profileTool.unsubscribe(),n._profileTool=null):0==i&&t==n._fillDigTool?n._fillDigTool=null:0==i&&t==n._floodTool?n._floodTool=null:0==i&&t==n._slopeAspectTool&&(n._removeSlopeAspectPoint(),n._slopeAspectTool.unsubscribe(),n._slopeAspectTool=null)}),CgsSubPub.subscribe("gradientPosition",function(e,t,i){var s,o,a;n._gradientTool&&i&&i===n._gradientTool&&(s=n._gradientAllPoint,Cesium.defined(s)&&0!==s.length&&(o=s[t],"[object Array]"==Object.prototype.toString.call(o)&&(n._gradientPoint?n._gradientPoint.setPosition(o):(a={position:o,heightReference:CgsPoint.CLAMP_TO_GROUND,fillColor:"rgba(0.0,255.0,255.0,1.0)",outlineWidth:0,pixelSize:3},n._gradientPoint=new CgsPoint3D(a),n._gradientPoint.setVisibleHeight([0,2e5]),n._gradientPoint.setSaveFlag(!1),n._viewer.addFeature(n._gradientPoint),n._state.labelList.push(n._gradientPoint)))))}),CgsSubPub.subscribe("profilePosition",function(e,t,i){var s,o,a;n._profileTool&&i&&i===n._profileTool&&(s=n._profileAllPoint,Cesium.defined(s)&&0!==s.length&&(o=s[t],"[object Array]"==Object.prototype.toString.call(o)&&(n._profilePoint?n._profilePoint.setPosition(o):(a={position:o,heightReference:CgsPoint.CLAMP_TO_GROUND,fillColor:"rgba(0.0,255.0,255.0,1.0)",outlineWidth:0,pixelSize:3},n._profilePoint=new CgsPoint3D(a),n._profilePoint.setVisibleHeight([0,2e6]),n._profilePoint.setSaveFlag(!1),n._viewer.addFeature(n._profilePoint),n._state.labelList.push(n._profilePoint)))))}),CgsSubPub.subscribe("slopeAspectPosition",function(e,t,i){var s,o,a;n._slopeAspectTool&&i&&i===n._slopeAspectTool&&(s=n._slopeAspectAllPoint,Cesium.defined(s)&&0!==s.length&&(o=s[t],"[object Array]"==Object.prototype.toString.call(o)&&(n._slopeAspectPoint?n._slopeAspectPoint.setPosition(o):(a={position:o,heightReference:CgsPoint.CLAMP_TO_GROUND,fillColor:"rgba(0.0,255.0,255.0,1.0)",outlineWidth:0,pixelSize:3},n._slopeAspectPoint=new CgsPoint3D(a),n._slopeAspectPoint.setVisibleHeight([0,2e5]),n._slopeAspectPoint.setSaveFlag(!1),n._viewer.addFeature(n._slopeAspectPoint),n._state.labelList.push(n._slopeAspectPoint)))))}),CgsSubPub.subscribe("fillDigSlider",function(e,t){n._baseHeight=t}),CgsSubPub.subscribe("floodSlider",function(e,t){n.baseWaterHeight=t}),CgsSubPub.subscribe("floodSlider",function(e,t,i){var s=n.floodInstance[n.floodInstance.length-1];if(i!=CgsAnalyze3D.STRATSIMULATE){if(i!=CgsAnalyze3D.STOPSIMULATE)return i==CgsAnalyze3D.RESIMULATE?(s._isSimulate=!0,void(s.waterHeight=s.waterMinHeight)):void 0;s._isSimulate=!1}else s._isSimulate=!0}))}),CgsAnalyze3D.prototype.remove=function(){for(var e=this,t=0;t<e._state.list.length;t++)e._viewer.removeFeature(e._state.list[t]);e._state.list=[];for(t=0;t<e._state.labelList.length;t++)e._viewer.removeFeature(e._state.labelList[t]);e._state.labelList=[];for(t=0;t<e._state.primitives.length;t++)e._viewer.scene.primitives.remove(e._state.primitives[t]);e._state.primitives=[];for(t=0;t<e._state.polygonAnalyzeLine.length;t++)e._viewer.scene.primitives.remove(e._state.polygonAnalyzeLine[t]);e._state.polygonAnalyzeLine=[],e.heightChangedEle&&(e._viewer.container.removeChild(e.heightChangedEle),e.heightChangedEle=void 0),e._removeGradientPoint();for(t=0;t<e._state.entities.length;t++)e._viewer.entities.remove(e._state.entities[t]);e._state.entities=[];for(t=0;t<e.floodInstance.length;t++)e.floodInstance[t].destruct();e.floodInstance=[],e.visibilityFrustum&&(e._viewer.scene.primitives.remove(e.visibilityFrustum),e.visibilityFrustum=void 0,e._viewer.scene.visibityMap=void 0)},CgsAnalyze3D.prototype._computeAllLinePosition=function(e,t){for(var i=[],s=this._computerCircle(e,t),o=Cesium.Math.toRadians(e[0]),a=Cesium.Math.toRadians(e[1]),n=new Cesium.Cartographic(o,a,0),r=s.length,l=0;l<r;++l)for(var u=this._computeDistanceInterpolation(n,s[l]),p=u.length,h=0;h<p;++h)i.push(u[h]);return i},CgsAnalyze3D.prototype.computeLineVisible=function(e,t,o){var i,s,a,n=this,r=Cesium.Math.toRadians(e[0]),l=Cesium.Math.toRadians(e[1]),u=new Cesium.Cartographic(r,l,0),p=Cesium.Math.toRadians(t[0]),h=Cesium.Math.toRadians(t[1]),c=new Cesium.Cartographic(p,h,0),g=n._computeDistanceInterpolation(u,c),d=(this._viewer.scene.globe,g.slice(0)),m=g.slice(0),f=n._viewer.getTerrain();n._viewer&&(f instanceof CgsTerrain3D||f instanceof CgsTileTerrain3D)?Cesium.when(Cesium.sampleTerrain(n._viewer.terrainProvider,f.level,m),function(e){var t,i,s=n._lineAnalyze(e,n);visibleDistance=s.visibleDistance,CgsSubPub.publish("lineVisibleAnalyze",[visibleDistance]),o instanceof Function&&(t=s.visiblePoints.map(function(e){return[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height]}),i=s.coveredPoints.map(function(e){return[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height]}),o({visibleDistance:visibleDistance,visiblePoints:t,coveredPoints:i}))}):(i=n._lineAnalyze(d,n),visibleDistance=i.visibleDistance,CgsSubPub.publish("lineVisibleAnalyze",[visibleDistance]),o instanceof Function&&(s=i.visiblePoints.map(function(e){return[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height]}),a=i.coveredPoints.map(function(e){return[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height]}),o({visibleDistance:visibleDistance,visiblePoints:s,coveredPoints:a})))},CgsAnalyze3D.prototype.computeLineVisibleHide=function(e,t,a){var i,s,o,n,r=this,l=Cesium.Math.toRadians(e[0]),u=Cesium.Math.toRadians(e[1]),p=new Cesium.Cartographic(l,u,0),h=Cesium.Math.toRadians(t[0]),c=Cesium.Math.toRadians(t[1]),g=new Cesium.Cartographic(h,c,0),d=r._computeDistanceInterpolation(p,g),m=(this._viewer.scene.globe,d.slice(0),d.slice(0)),f=r._viewer.getTerrain();r._viewer&&(f instanceof CgsTerrain3D||f instanceof CgsTileTerrain3D)?Cesium.when(Cesium.sampleTerrain(r._viewer.terrainProvider,f.level,m),function(e){var t,i,s=r._lineAnalyzeHide(e,r),o=s.visibleDistance;CgsSubPub.publish("computeVisibleAnalyze",[o]),a instanceof Function&&(t=s.visiblePoints.map(function(e){return[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height]}),i=s.coveredPoints.map(function(e){return[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height]}),a({visibleDistance:o,visiblePoints:t,coveredPoints:i}))}):(s=(i=r._lineAnalyzeHide(m,r)).visibleDistance,CgsSubPub.publish("computeVisibleAnalyze",[s]),a instanceof Function&&(o=i.visiblePoints.map(function(e){return[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height]}),n=i.coveredPoints.map(function(e){return[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height]}),a({visibleDistance:s,visiblePoints:o,coveredPoints:n})))},CgsAnalyze3D.prototype._lineAnalyzeHide=function(e,t){var i=t,s=e.slice(0),o=[],a=(i._computeVisiblePoint(s,o),s[0]),n=(Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude),a.height,(e.length-o[0])*i._sampleLength),r={visibleDistance:n,visiblePoints:o[2],coveredPoints:o[1]};return i._visibleDistance=n,r},CgsAnalyze3D.prototype._lineAnalyze=function(e,t){var i=t,s=e.slice(0),o=[],a=i._computeVisiblePoint(s,o),n=i._viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(e),width:2,followSurface:!1,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT,colors:a,colorsPerVertex:!0})}),appearance:new Cesium.PolylineColorAppearance({translucent:!0}),show:!0}));i._state.primitives.push(n);var r=s[0],l=Cesium.Math.toDegrees(r.longitude),u=Cesium.Math.toDegrees(r.latitude),p=r.height,h=(e.length-o[0])*i._sampleLength,c={visibleDistance:h,visiblePoints:o[2],coveredPoints:o[1]},g=void 0,g=1e3<(i._visibleDistance=h)?"可视距离 : "+(h/=1e3).toFixed(2)+"km":"可视距离 : "+h.toFixed(2)+"m";return createAnalyzeTooltip(i),i.analyzeTooltipElement.innerHTML=g,i.analyzeTooltip.setVisible(!0),i.analyzeTooltip.setPosition([l,u,p+50]),i._showPoint&&(i._drawPoint(s[0]),i._drawPoint(s[s.length-1])),c},CgsAnalyze3D.prototype._drawPoint=function(e){var t={position:[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height],fillColor:"rgba(255.0,255.0,0.0,1.0)",heightReference:CgsPoint.CLAMP_TO_GROUND,outlineWidth:0,pixelSize:2.5},i=new CgsPoint3D(t);i.setVisibleHeight([0,2e5]),i.setSaveFlag(!1),this._viewer.addFeature(i),this._state.labelList.push(i)},CgsAnalyze3D.prototype.computePolygonVisible=function(e,t){for(var i={longitude:e[0],latitude:e[1],radius:t},s=this._splitCircle2GeoPosition(i),o=(this._viewer.scene.globe,this._computerCircle([e[0],e[1]],[s[0],s[1]])),a=o.length,n=[],r=new Cesium.Cartographic(Cesium.Math.toRadians(e[0]),Cesium.Math.toRadians(e[1])),l=0;l<a;++l)var u=this._computeDistanceInterpolation(r,o[l]),n=n.concat(u);this._polygonAnalyze(n,a)},CgsAnalyze3D.prototype._polygonAnalyze=function(e,C){var y=this,t=e.slice(0),v=e.slice(0),i=y._viewer.getTerrain();if(y._viewer&&(i instanceof CgsTerrain3D||i instanceof CgsTileTerrain3D))Cesium.when(Cesium.sampleTerrain(y._viewer.terrainProvider,i.level,t),function(e){y._removeCircle(),y._drawCircle(v,C);var t=v.length/C,i=0;y.polygonAnalyzePoints=v.slice(0),y.polygonAnalyzeCount=C;for(var s,o,a,n,r,l,u=v.length,p=0;p<u;++p){(p+1)%t==0&&(s=((p+1)/t-1)*t,o=v.slice(s,s+t),a=[],n=y._computeVisiblePoint(o,a),i+=a[0],r=new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(o),width:2,followSurface:!1,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT,colors:n,colorsPerVertex:!0})}),l=y._viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:r,appearance:new Cesium.PolylineColorAppearance({translucent:!0}),show:!0,interleave:!0})),y._state.polygonAnalyzeLine.push(l))}var h=v[0],c=Cesium.Math.toDegrees(h.longitude),g=Cesium.Math.toDegrees(h.latitude),d=h.height,m=i/v.length*100;0;var f="遮挡率 : "+(y._coverRate=m).toFixed(2)+"%";createAnalyzeTooltip(y),y.analyzeTooltipElement.innerHTML=f,y.analyzeTooltip.setVisible(!0),y.analyzeTooltip.setPosition([c,g,d+50]),createHeightChangedEle(y),CgsSubPub.publish("polygonVisibleAnalyze",[m])});else{y._removeCircle(),y._drawCircle(v,C),y.polygonAnalyzePoints=v.slice(0),y.polygonAnalyzeCount=C;for(var s=[],o=v.length/C,a=0,n=0;n<C;++n){var r=n*o,l=v.slice(r,r+o),u=[],p=y._computeVisiblePoint(l,u);a+=u[0];var h=new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(l),width:2,followSurface:!1,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT,colors:p,colorsPerVertex:!0})}),c=y._viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:h,appearance:new Cesium.PolylineColorAppearance({translucent:!0}),show:!0}));y._state.polygonAnalyzeLine.push(c);var g=l[o-1],d=Cesium.Math.toDegrees(g.longitude),m=Cesium.Math.toDegrees(g.latitude),f=g.height;s.push([d,m,f])}var b=v[0],D=Cesium.Math.toDegrees(b.longitude),S=Cesium.Math.toDegrees(b.latitude),_=b.height,w=a/v.length*100,P="遮挡率 : "+w.toFixed(2)+"%";createAnalyzeTooltip(y),y.analyzeTooltipElement.innerHTML=P,y.analyzeTooltip.setVisible(!0),y.analyzeTooltip.setPosition([D,S,_+50]),createHeightChangedEle(y),CgsSubPub.publish("polygonVisibleAnalyze",[w])}},CgsAnalyze3D.prototype.setRIAHeight=function(e){if(this.polygonAnalyzePoints&&this.polygonAnalyzeCount){for(var t=this.polygonAnalyzePoints.slice(0),i=this.polygonAnalyzeCount,s=0;s<this._state.polygonAnalyzeLine.length;++s)this._viewer.scene.primitives.remove(this._state.polygonAnalyzeLine[s]);this._state.polygonAnalyzeLine=[];for(var o,a,n,r,l,u,p=t.length/i,h=0,c=t.length,s=0;s<c;++s){s%p==0&&(t[s]=Cesium.Cartographic.fromRadians(t[s].longitude,t[s].latitude,t[s].height+e)),(s+1)%p==0&&(o=((s+1)/p-1)*p,a=t.slice(o,o+p),n=[],r=this._computeVisiblePoint(a,n),h+=n[0],l=new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(a),width:2,followSurface:!1,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT,colors:r,colorsPerVertex:!0})}),u=this._viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:l,appearance:new Cesium.PolylineColorAppearance({translucent:!0}),show:!0,interleave:!0})),this._state.polygonAnalyzeLine.push(u))}var g=t[0],d=Cesium.Math.toDegrees(g.longitude),m=Cesium.Math.toDegrees(g.latitude),f=g.height,C=h/t.length*100;result=C;var y="遮挡率 : "+(this._coverRate=C).toFixed(2)+"%";this.analyzeTooltipElement&&this.analyzeTooltip&&(this.analyzeTooltipElement.innerHTML=y,this.analyzeTooltip.setVisible(!0),this.analyzeTooltip.setPosition([d,m,f+50])),CgsSubPub.publish("polygonVisibleAnalyze",[C])}},CgsAnalyze3D.prototype._removeCircle=function(){if(Cesium.defined(this._drawCircleObj)){for(var e=0;e<this._state.list.length;e++){if(this._state.list[e]==this._drawCircleObj){self._viewer.removeFeature(this._state.list[e]);break}}self._state.points=[],self._state.altitudes=[],self._state.entities=[],self._state.currentLength=0,self._drawCircleObj=void 0}},CgsAnalyze3D.prototype._drawCircle=function(e,t){for(var i=e.slice(0),s=i.length/t,o=[],a=[],n=0;n<t;++n)o.push(i[s*n+s-1]),a.push(Cesium.Color.fromCssColorString(this._fillColor));var r=new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(o),width:2,followSurface:!1,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT,colors:a,colorsPerVertex:!0})}),l=this._viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:r,appearance:new Cesium.PolylineColorAppearance({translucent:!0}),show:!0}));this._state.primitives.push(l)},CgsAnalyze3D.prototype._crossProduct=function(e,t){var i=new Cesium.Cartesian3;return i.x=e.y*t.z-e.z*t.y,i.y=e.z*t.x-e.x*t.z,i.z=e.x*t.y-e.y*t.x,i},CgsAnalyze3D.prototype._multify=function(e,t){var i=new Cesium.Cartesian3,s=new Cesium.Cartesian3(e.x,e.y,e.z),o=this._crossProduct(s,t),a=this._crossProduct(s,o);return Cesium.Cartesian3.multiplyByScalar(o,2*e.w,o),Cesium.Cartesian3.multiplyByScalar(a,2,a),Cesium.Cartesian3.add(i,t,i),Cesium.Cartesian3.add(i,o,i),Cesium.Cartesian3.add(i,a,i),i},CgsAnalyze3D.prototype._computerNormal=function(e){var t=Cesium.Cartesian3.fromDegrees(e[0],e[1],1e3),i=Cesium.Cartesian3.fromDegrees(e[0],e[1]);return Cesium.Cartesian3.subtract(i,t,i),Cesium.Cartesian3.normalize(i,i),i},CgsAnalyze3D.prototype._computerCircle=function(e,t,i){for(var s=30,s=Cesium.defined(i)?Math.floor(360/i):this._interval,o=[],a=Cesium.Cartesian3.fromDegrees(e[0],e[1]),n=Cesium.Cartesian3.fromDegrees(t[0],t[1]),r=this._computerNormal(e),l=2*Math.PI/s,u=new Cesium.Cartesian3,p=(new Cesium.Cartesian3,0);p<=s;++p){var h=p*l,c=Cesium.Quaternion.fromAxisAngle(r,h),u=Cesium.Cartesian3.subtract(n,a,u),g=this._multify(c,u),d=Cesium.Cartesian3.add(g,a,g),m=Cesium.Cartographic.fromCartesian(d),f=new Cesium.Cartographic(m.longitude,m.latitude);o.push(f)}return o},CgsAnalyze3D.prototype._splitCircle2GeoPosition=function(e){var t,i,s=e.longitude,o=e.latitude,a=e.radius,n=Cesium.Math.toRadians(o),r=Cesium.Math.toRadians(s),l=a/6378137,u=(Math.PI,0),p=[],h=null==e.angle?0:2*e.angle*Math.PI/360,c=Math.asin(Math.sin(n)*Math.cos(l)+Math.cos(n)*Math.sin(l)*Math.cos(h));return u=0==Math.cos(n)?r:(t=r-Math.asin(Math.sin(h)*Math.sin(l)/Math.cos(n))+Math.PI,i=2*Math.PI,t-parseInt(t/i)*i-Math.PI),u=Cesium.Math.toDegrees(u),c=Cesium.Math.toDegrees(c),p.push(u),p.push(c),p},CgsAnalyze3D.prototype.computeGradient=function(e,t){if(Array.isArray(e)&&Array.isArray(t)||2===e.length&&2===t.length){var i=this;i._removeGradientPoint();var s=Cesium.Cartographic.fromDegrees(e[0],e[1]),o=Cesium.Cartographic.fromDegrees(t[0],t[1]),a=i._computeDistanceInterpolation(s,o),n=i._viewer.getTerrain();return i._viewer&&(n instanceof CgsTerrain3D||n instanceof CgsTileTerrain3D)?(Cesium.when(Cesium.sampleTerrain(i._viewer.terrainProvider,n.level,a),function(e){i._gradientAnalyze(e,i),i._showGradient()}),!0):(i._gradientAnalyze(a,i),i._showGradient(),!1)}},CgsAnalyze3D.prototype.computeGradientHide=function(e,t,i){if(Array.isArray(e)&&Array.isArray(t)||2===e.length&&2===t.length){var s=this;s._removeGradientPoint();var o=Cesium.Cartographic.fromDegrees(e[0],e[1]),a=Cesium.Cartographic.fromDegrees(t[0],t[1]),n=s._computeDistanceInterpolation(o,a),r=s._viewer.getTerrain();if(!s._viewer||!(r instanceof CgsTerrain3D||r instanceof CgsTileTerrain3D))return i instanceof Function&&i(n),s._gradientAnalyzeHide(n,s);Cesium.when(Cesium.sampleTerrain(s._viewer.terrainProvider,r.level,n),function(e){var t=s._gradientAnalyzeHide(e,s);i instanceof Function&&i(t),CgsSubPub.publish("computeGradientAnalyze",[t,s]),console.log("computeGradientAnalyze:"+t)})}},CgsAnalyze3D.prototype.computeProfile=function(e){if(Array.isArray(e)){for(var t=this,i=[],s=0;s<e.length-1;++s)var o=e[s],a=e[s+1],n=t._computeDistanceInterpolation(o,a),i=i.concat(n);var r=t._viewer.getTerrain();return t._viewer&&(r instanceof CgsTerrain3D||r instanceof CgsTileTerrain3D)?Cesium.when(Cesium.sampleTerrain(t._viewer.terrainProvider,r.level,i),function(e){t._profileAnalyze(e,t),t._showProfile()}):(t._profileAnalyze(i,t),t._showProfile()),i}},CgsAnalyze3D.prototype.computeFillDig=function(e){if(Array.isArray(e)){var s=this;this.mDepth&&(this.mDepth=0),this.digVolume&&(this.digVolume=0),this.fillVolume&&(this.fillVolume=0),this.groundArea&&(this.groundArea=0),this._prism&&(this._prism=void 0),this._plane&&(this._plane=void 0),this.fillDigKeyPoint&&(this.fillDigKeyPoint=void 0),this.measureTooltip&&(this.measureTooltip=null),this.measureTooltipElement&&(this.measureTooltipElement=null),this.maxAltiPoint&&(this.maxAltiPoint=void 0),this.minAltiPoint&&(this.minAltiPoint=void 0),this.isCalculateDone&&(this.isCalculateDone=!1),null==e[0].longitude&&(e=e.map(function(e){return Cesium.Cartographic.fromDegrees(e[0],e[1])})),this.fillDigKeyPoint=e;for(var o=[],t=0;t<e.length-1;++t){var i=e[t],a=e[t+1],n=s._computeDistanceInterpolation(i,a);0<o.length&&o.pop(),o=o.concat(n)}i=e[e.length-1],a=e[0],n=s._computeDistanceInterpolation(i,a);0<o.length&&o.pop(),o=o.concat(n);var r=s._viewer.getTerrain();return s._viewer&&(r instanceof CgsTerrain3D||r instanceof CgsTileTerrain3D)?(s.calcuVolume(s.fillDigKeyPoint),setTimeout(function(){var e=Cesium.sampleTerrain(s._viewer.terrainProvider,r.level,o);Cesium.when(e,function(){var e,t,i;s._fillDigAnalyze(o,s),s.isCalculateDone&&(createAnalyzeTooltip(s),e="填方体积："+(s.fillVolume/CgsAnalyze3D.CUBICMETERSTOKILOMETERS).toFixed(4)+" km³",t="挖方体积："+(s.digVolume/CgsAnalyze3D.CUBICMETERSTOKILOMETERS).toFixed(4)+" km³",s.analyzeTooltipElement.innerHTML=e+"<br>"+t,i=CgsMath3D.getCenterPointFromCoordinates(s.fillDigKeyPoint),s.analyzeTooltip.setVisible(!0),s.analyzeTooltip.setPosition([Cesium.Math.toDegrees(i[0]),Cesium.Math.toDegrees(i[1]),s.mDepth+100]))})},50),o):(s._fillDigAnalyze(e,s),e)}},CgsAnalyze3D.prototype.computeFlood=function(e){if(Array.isArray(e)){var o=this;this.clock&&(clearInterval(this.clock),this.clock=void 0),this.floodSurfaceArea&&(this.floodSurfaceArea=0),this.floodVolume&&(this.floodVolume=0),this.waterAltitude&&(this.waterAltitude=0),this.minWaterHeight&&(this.minWaterHeight=0),this.maxWaterHeight&&(this.maxWaterHeight=0),this.baseWaterHeight&&(this.baseWaterHeight=0),this.maxAltiPoint&&(this.maxAltiPoint=void 0),this.minAltiPoint&&(this.minAltiPoint=void 0),this.isCalculateDone&&(this.isCalculateDone=!1),this.isFloodVolumeCalcu=!0,this.floodKeyPoint=e;var t=o._viewer.getTerrain();if(o._viewer&&(t instanceof CgsTerrain3D||t instanceof CgsTileTerrain3D)){for(var i=[],s=0;s<e.length-1;++s){var a=e[s],n=e[s+1],r=o._computeDistanceInterpolation(a,n);0<i.length&&i.pop(),i=i.concat(r)}a=e[e.length-1],n=e[0],r=o._computeDistanceInterpolation(a,n);return 0<i.length&&i.pop(),i=i.concat(r),o.isFloodVolumeCalcu&&(o.calcuVolume(o.floodKeyPoint),setTimeout(function(){Cesium.when(Cesium.sampleTerrain(o._viewer.terrainProvider,t.level,i),function(e){var t,i,s;o._isTerrain=!0,o._floodAnalyze(e,o),o.isCalculateDone&&(createAnalyzeTooltip(o),t="淹没体积："+(o.floodVolume/CgsAnalyze3D.CUBICMETERSTOKILOMETERS).toFixed(4)+" km³",i="淹没面积："+(o.floodSurfaceArea/CgsAnalyze3D.CUBICMETERSTOKILOMETERS).toFixed(4)+" km²",o.analyzeTooltipElement.innerHTML=t+"<br>"+i,s=CgsMath3D.getCenterPointFromCoordinates(o.floodKeyPoint),o.analyzeTooltip.setVisible(!0),o.analyzeTooltip.setPosition([Cesium.Math.toDegrees(s[0]),Cesium.Math.toDegrees(s[1]),o.waterAltitude+100]))})},50)),i}return o._floodAnalyze(e,o),o._isTerrain=!1,e}},CgsAnalyze3D.prototype._fillDigAnalyze=function(e,t){var i=t,s=i._viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(e),width:2,followSurface:!0,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color.fromCssColorString(i._fillColor))}}),appearance:new Cesium.PolylineColorAppearance({translucent:!0}),show:!0}));i._state.primitives.push(s);var o=Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(e),a=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(o)}),n=new Cesium.GeometryInstance({geometry:a,id:"filldigpolygon",attributes:{color:new Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString(i._groundColor))}}),r=new Cesium.GroundPrimitive({geometryInstances:n});i._viewer.scene.primitives.add(r),i._state.primitives.push(r),this._drawPlaneAndPrism()},CgsAnalyze3D.prototype._floodAnalyze=function(e,t){var i=t;this.baseWaterHeight=this.waterAltitude-this.minWaterHeight;for(var s=[],o=0;o<i.floodKeyPoint.length;++o)s.push(i.floodKeyPoint[o]);for(var a=[],n=0;n<s.length;++n){var r=Cesium.Math.toDegrees(s[n].longitude),l=Cesium.Math.toDegrees(s[n].latitude);a.push(r),a.push(l),a.push(s[n].height)}var u,p,h,c=Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(i.floodKeyPoint);i._isTerrain&&(u=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(c)}),p=new Cesium.GeometryInstance({geometry:u,id:"floodpolygon",attributes:{color:new Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString(i._prismColor))}}),h=new Cesium.GroundPrimitive({geometryInstances:p}),i._viewer.scene.primitives.add(h),i._state.primitives.push(h)),this.floodInstance.push(new drawWaterPlaneAndWaterPrism(this,this.minWaterHeight,this.maxWaterHeight,this._waterSpeed))},drawWaterPlaneAndWaterPrism.prototype.destruct=function(){},CgsAnalyze3D.prototype._drawPlaneAndPrism=function(){for(var e=this,t=[],i=[],s=0;s<e.fillDigKeyPoint.length;++s)i.push(e.fillDigKeyPoint[s]);for(var o=0;o<i.length;++o){var a=Cesium.Math.toDegrees(i[o].longitude),n=Cesium.Math.toDegrees(i[o].latitude),r=this.mDepth;t.push(a),t.push(n),t.push(r)}var l=e._viewer.entities.add({name:"prism",polygon:{hierarchy:Cesium.Cartesian3.fromDegreesArrayHeights(t),extrudedHeight:e.mMinAltiPointZ,perPositionHeight:!0,material:Cesium.Color.fromCssColorString(e._prismColor),outline:!0,outlineColor:Cesium.Color.fromCssColorString(e._fillColor)}});e._state.entities.push(l),e._prism=l;var u=e._viewer.entities.add({name:"plane",polygon:{hierarchy:Cesium.Cartesian3.fromDegreesArrayHeights(t),perPositionHeight:!0,material:Cesium.Color.fromCssColorString(e._baseColor),outline:!0,outlineColor:Cesium.Color.fromCssColorString(e._fillColor)}});e._state.entities.push(u),e._plane=u},CgsAnalyze3D.prototype._gradientAnalyze=function(e,t){var i=t;i._gradientAllPoint=[];for(var s=0;s<e.length;++s){var o=Cesium.Math.toDegrees(e[s].longitude),a=Cesium.Math.toDegrees(e[s].latitude),n=e[s].height;i._gradientAllPoint.push([o,a,n])}i._drawlineObj&&i._viewer.removeFeature(i._drawlineObj);var r=Cesium.Color.fromCssColorString(i._fillColor);[].push(r);var l=i._viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(e),width:2,followSurface:!0,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color.fromCssColorString(i._fillColor))}}),appearance:new Cesium.PolylineColorAppearance({translucent:!0}),show:!0}));i._state.primitives.push(l),i._gradient=[];for(var u=e.length,p=0;p<u-1;p++){var h=e[p],c=360*((e[p+1].height-h.height)/i._sampleLength)/Math.PI;i._gradient.push(parseFloat(c.toFixed(2)))}i._showPoint&&(i._drawPoint(e[0]),i._drawPoint(e[e.length-1])),i._state.points=[],i._state.altitudes=[],i._state.currentLength=0,i._drawlineObj=void 0},CgsAnalyze3D.prototype._gradientAnalyzeHide=function(e,t){var i=t;i._gradientAllPoint=[];for(var s=0;s<e.length;++s){var o=Cesium.Math.toDegrees(e[s].longitude),a=Cesium.Math.toDegrees(e[s].latitude),n=e[s].height;i._gradientAllPoint.push([o,a,n])}i._drawlineObj&&i._viewer.removeFeature(i._drawlineObj),i._gradient=[];for(var r=e.length,l=0;l<r-1;l++){var u=e[l],p=360*((e[l+1].height-u.height)/i._sampleLength)/Math.PI;i._gradient.push(parseFloat(p.toFixed(2)))}return i._gradient},CgsAnalyze3D.prototype._profileAnalyze=function(e,t){var i=t;i._profileAllPoint=[],i._profileHeight=[];for(var s=0;s<e.length;++s){var o=Cesium.Math.toDegrees(e[s].longitude),a=Cesium.Math.toDegrees(e[s].latitude),n=e[s].height;i._profileAllPoint.push([o,a,n]),i._profileHeight.push(n)}i._drawlineObj&&i._viewer.removeFeature(i._drawlineObj);var r=i._viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(e),width:2,followSurface:!0,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color.fromCssColorString(i._fillColor))}}),appearance:new Cesium.PolylineColorAppearance({translucent:!0}),show:!0}));i._state.primitives.push(r),i._state.points=[],i._state.altitudes=[],i._state.currentLength=0,i._drawlineObj=void 0},CgsAnalyze3D.prototype._slopeAspectAnalyze=function(e,t){var i=t;i._slopeAspectAllPoint=[];for(var s=0;s<e.length;++s){var o=Cesium.Math.toDegrees(e[s].longitude),a=Cesium.Math.toDegrees(e[s].latitude),n=e[s].height;i._slopeAspectAllPoint.push([o,a,n])}i._drawlineObj&&i._viewer.removeFeature(i._drawlineObj);var r=Cesium.Color.fromCssColorString(i._fillColor);[].push(r);var l=i._viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(e),width:2,followSurface:!0,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color.fromCssColorString(i._fillColor))}}),appearance:new Cesium.PolylineColorAppearance({translucent:!0}),show:!0}));i._state.primitives.push(l),i._slopeAspect=[];for(var u=0,p=i._slopeAspectAllPoint.length;u<p;u++){var h=i._slopeAspectAllPoint[u];CgsMath3D.calcuPositionSlopeAspect(h,.2,i._viewer,function(e){i._slopeAspect.push(e)})}i._showPoint&&(i._drawPoint(e[0]),i._drawPoint(e[e.length-1])),i._state.points=[],i._state.altitudes=[],i._state.currentLength=0,i._drawlineObj=void 0},CgsAnalyze3D.prototype._showGradient=function(){this._showGradientDlg&&!this._gradientTool&&(this._gradientTool=new CgsGradientTool3D(this._viewer),this._gradientTool.activate()),this._showGradientDlg&&this._gradientTool&&CgsSubPub.publish("gradientAnalyze",[this._gradient])},CgsAnalyze3D.prototype._showProfile=function(){this._showGradientDlg&&!this._profileTool&&(this._profileTool=new CgsProfileUI3D(this._viewer),this._profileTool.activate()),this._showGradientDlg&&this._profileTool&&CgsSubPub.publish("profileAnalyze",[this._profileHeight])},CgsAnalyze3D.prototype._showSlopeAspect=function(){this._showGradientDlg&&!this._slopeAspectTool&&(this._slopeAspectTool=new CgsSlopeAspectTool3D(this._viewer),this._slopeAspectTool.activate()),this._showGradientDlg&&this._slopeAspectTool&&CgsSubPub.publish("slopeaspectAnalyze",[this._slopeAspect])},CgsAnalyze3D.prototype._showFillDig=function(){var e,t=this;e=(t._fillDigTool&&t._fillDigTool.deactivate(),t._fillDigTool=new CgsFillDigUI3D(t._viewer),t._fillDigTool.activate(),(t.groundArea/1e4).toFixed(2)+" 万 m²"),t._fillDigTool.body.find("#fillDigArea").get(0).innerHTML=e,t._fillDigTool&&CgsSubPub.publish("fillDigAnalyze",[this.fillDigKeyPoint,t.maxHeight-t.minHeight])},CgsAnalyze3D.prototype._showFlood=function(){var e=this;e._floodTool&&e._floodTool.deactivate(),e._floodTool=new CgsFloodUI3D(e._viewer),e._floodTool.activate(),e._floodTool&&CgsSubPub.publish("floodAnalyze",[e.floodKeyPoint,e.maxWaterHeight-e.minWaterHeight,e.waterAltitude-e.minWaterHeight])},CgsAnalyze3D.prototype._removeGradientPoint=function(){if(this._gradientPoint){for(var e=0;e<this._state.labelList.length;e++){if(this._state.labelList[e].getId()==this._gradientPoint.getId()){this._state.labelList.splice(e,1);break}}this._viewer.removeFeature(this._gradientPoint),this._gradientPoint=void 0}},CgsAnalyze3D.prototype._removeSlopeAspectPoint=function(){if(this._slopeAspectPoint){for(var e=0;e<this._state.labelList.length;e++){if(this._state.labelList[e].getId()==this._slopeAspectPoint.getId()){this._state.labelList.splice(e,1);break}}this._viewer.removeFeature(this._slopeAspectPoint),this._slopeAspectPoint=void 0}},CgsAnalyze3D.prototype._removeProfilePoint=function(){if(this._profilePoint){for(var e=0;e<this._state.labelList.length;e++){if(this._state.labelList[e].getId()==this._profilePoint.getId()){this._state.labelList.splice(e,1);break}}this._viewer.removeFeature(this._profilePoint),this._profilePoint=void 0}},CgsAnalyze3D.prototype._approxAngularDistance=function(e,t,i,s){var o=i-e,a=s-t,n=Math.sin(Cesium.Math.toRadians(.5*o)),r=Math.sin(Cesium.Math.toRadians(.5*a)),l=r*r+Math.cos(Cesium.Math.toRadians(t))*Math.cos(Cesium.Math.toRadians(s))*n*n,u=Math.sqrt(l);return 2*Cesium.Math.toDegrees(Math.asin(1<u?1:u))},CgsAnalyze3D.prototype._computeVisiblePositions=function(e,t){if(Array.isArray(t)&&Cesium.defined(t)){for(var i=t.length,s=new Cesium.Cartographic(Cesium.Math.toRadians(e[0]),Cesium.Math.toRadians(e[1])),o=0;o<i;++o){var a=t[o],n=computeDistanceInterpolation(s,a).slice(0);this._computeTerrainAltitude(n)}return[]}},CgsAnalyze3D.prototype._computeVisiblePoint=function(e,t){if(Array.isArray(e)){var i=0,s=[],o=[],a=[],n=Cesium.Color.fromCssColorString(this._fillColor),r=Cesium.Color.fromCssColorString(this._coverColor);a.push(n);for(var l=e.length,u=e[0].height,p=e[1].height,h=1,c=void 0,c=1;c<l;++c){var g=e[c],d=(p-u)*c/h+u;g.height>=d?(p=g.height,h=c,a.push(n),s.push(g)):(a.push(r),o.push(g),i++)}return Cesium.defined(t)&&(t.push(i),t.push(o),t.push(s)),a}},CgsAnalyze3D.prototype._computeDistanceInterpolation=function(e,t){var i=[],s=new Cesium.EllipsoidGeodesic;s.setEndPoints(e,t);var o=this._sampleLength,a=s.surfaceDistance,n=Math.floor(a/o);5e3<n&&(o=n*this._sampleLength/5e3,n=Math.floor(a/o));for(var r=0;r<=n;++r){var l=new Cesium.Cartographic;s.interpolateUsingSurfaceDistance(r*this._sampleLength,l),i.push(l)}return n*o<a&&(l=new Cesium.Cartographic,s.interpolateUsingSurfaceDistance(a,l),i.push(l)),i},CgsAnalyze3D.prototype.calcuVolume=function(e,a){for(var n=this,t=[],i=0;i<e.length;++i)lon=Cesium.Math.toDegrees(e[i].longitude),lat=Cesium.Math.toDegrees(e[i].latitude),height=e[i].height,t.push(new Array(lon,lat,height));var s=[];if(CgsMath3D.triangulate(t,s)){for(var r=[],l=[],u=[],i=0;i<s.length;i+=3){var o=[];o.push(s[i+0]),o.push(s[i+1]),o.push(s[i+2]);var p=this.calcuInsetNum(o),h=[];0==p?(h[0]=o[0],h[1]=o[1],h[2]=o[2]):CgsMath3D.splitTriangle2GeoPosition(p,o,h);for(var c,g=0;g<h.length;++g)h[g]=Cesium.Cartographic.fromDegrees(h[g][0],h[g][1],h[g][2]);h.length<3||(r.push(h),c=[],0==p?(c[0]=0,c[1]=1,c[2]=2):CgsMath3D.splitTriang2Indices(p,c),l.push(c))}var d=this._viewer.getTerrain();if(this._viewer&&(d instanceof CgsTerrain3D||d instanceof CgsTileTerrain3D)){for(var m=[],i=0;i<r.length;++i)for(g=0;g<r[i].length;++g)m.push(r[i][g]);Cesium.when(Cesium.sampleTerrain(this._viewer.terrainProvider,d.level,m),function(e){for(var t=0;t<e.length;++t)0==t?(n.maxAltiPoint=e[t],n.minAltiPoint=e[t]):(n.maxAltiPoint.height<e[t].height&&(n.maxAltiPoint=e[t]),n.minAltiPoint.height>e[t].height&&(n.minAltiPoint=e[t]));for(var i=0;i<r.length;++i){var s=[];n.calcuAreas(r[i],l[i],s),u.push(s[0]),n.groundArea+=s[1]}if(n.isFloodVolumeCalcu){n.minWaterHeight=n.minAltiPoint.height,n.maxWaterHeight=n.maxAltiPoint.height,n.waterAltitude=(n.maxAltiPoint.height+n.minAltiPoint.height)/2;for(var o=0;o<r.length;++o)n.floodVolume+=n.calculateVolume(r[o],l[o],u[o],n.waterAltitude,!1);n.isFloodVolumeCalcu=!1}else{n.mDefaultDepth&&(n.mDepth=(n.maxAltiPoint.height+n.minAltiPoint.height)/2),n.mMinAltiPointZ=n.minAltiPoint.height,n.mMaxAltiPointZ=n.maxAltiPoint.height;for(o=0;o<r.length;++o)n.digVolume+=n.calculateVolume(r[o],l[o],u[o],n.mDepth,!0),n.fillVolume+=n.calculateVolume(r[o],l[o],u[o],n.mDepth,!1)}n.isCalculateDone=!0,a instanceof Function&&a({digVolume:n.digVolume,fillVolume:n.fillVolume,floodVolume:n.floodVolume,floodSurfaceArea:n.floodSurfaceArea})})}}},CgsAnalyze3D.prototype.calcuInsetNum=function(e){var t=CgsMath3D.lineProjectMeasure(e[0],e[1]),i=CgsMath3D.geoLineDistanceMeasure(e[0],e[1]),s=i<t?t:i,t=CgsMath3D.lineProjectMeasure(e[0],e[2]),o=(i=CgsMath3D.geoLineDistanceMeasure(e[0],e[2]))<t?t:i;if(s<o&&(s=o),t=CgsMath3D.lineProjectMeasure(e[1],e[2]),s<(o=(i=CgsMath3D.geoLineDistanceMeasure(e[1],e[2]))<t?t:i)&&(s=o),s<this._sampleInterval)return 0;var a=this._sampleInterval,n=Math.floor(s/a);return 1e3<n&&(a=n*this._sampleInterval/1e3,n=Math.floor(s/a)),n},CgsAnalyze3D.prototype.calcuAreas=function(e,t,i){i[0]=0;for(var s=[],o=i[1]=0;o<e.length;++o)s.push(Cesium.Cartographic.toCartesian(e[o]));for(var a=0;a<t.length;a+=3){var n=t[a+0],r=t[a+1],l=t[a+2];i[1]+=CgsMath3D.triangleAreaMeasure(s[n],s[r],s[l])}var u=s[t[0]],p=Cesium.Cartesian3.fromElements(s[t[1]].x,s[t[1]].y,s[t[0]].z),h=Cesium.Cartesian3.fromElements(s[t[2]].x,s[t[2]].y,s[t[0]].z);i[0]=CgsMath3D.triangleAreaMeasure(u,p,h)},CgsAnalyze3D.prototype.calculateVolume=function(e,t,i,s,o){if(0==i)return 0;for(var a,n=0,r=0;r<t.length;r+=3){var l,u,p,h,c=e[t[r+0]].height,g=e[t[r+1]].height;h=(p=e[t[r+2]].height)<(h=g<c?c:g)?h:p,a=(a=c<g?c:g)<p?a:p,o?s<=a?n+=i*((c+g+p-3*s)/3):s<h&&(n+=i*(l=h-s)*l*l/(u=h-a)/u/3):h<=s?(n+=i*((3*s-(c+g+p))/3),this.isFloodVolumeCalcu&&(this.floodSurfaceArea+=i)):a<s&&(n+=i*(l=s-a)*l*l/(u=h-a)/u/3,this.isFloodVolumeCalcu&&(this.floodSurfaceArea+=i*l*l/u/u/3))}return n},CgsAnalyze3D.prototype.visibilityAnalyze=function(e,t){var o=this,i=Cesium.Math.toRadians(e[0]),s=Cesium.Math.toRadians(e[1]),a=new Cesium.Cartographic(i,s,0),n=Cesium.Math.toRadians(t[0]),r=Cesium.Math.toRadians(t[1]),l=new Cesium.Cartographic(n,r,0),u=(this._viewer.scene.globe,[]);u.push(a),u.push(l);var p,h=o._viewer.getTerrain();o._viewer&&(h instanceof CgsTerrain3D||h instanceof CgsTileTerrain3D)?Cesium.when(Cesium.sampleTerrain(o._viewer.terrainProvider,h.level,u),function(e){var t=e[0],i=e[1],s=[[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude),t.height],[Cesium.Math.toDegrees(i.longitude),Cesium.Math.toDegrees(i.latitude),i.height]];o.visibilityFrustum&&(o.visibilityFrustum.setPosition(s),o.visibilityFrustum._visCamera&&(o._viewer.scene.visibityMap||(o._viewer.scene.visibityMap=new Cesium.FeVisibilityMap({lightCamera:o.visibilityFrustum._visCamera,context:o._viewer.scene.context}))))}):(p=[[e[0],e[1]],[t[0],t[1]]],this.visibilityFrustum&&(this.visibilityFrustum.setPosition(p),this.visibilityFrustum._visCamera&&(o._viewer.scene.visibityMap||(o._viewer.scene.visibityMap=new Cesium.FeVisibilityMap({lightCamera:this.visibilityFrustum._visCamera,context:o._viewer.scene.context})))))},CgsAnalyze3D.prototype.setVisibilityAPointHeight=function(e){var t,i,s,o;this.visibilityFrustum&&(t=this.visibilityFrustum._eyePosition,i=this.visibilityFrustum._targetPosition,t&&i&&(s=Cartographic.fromCartesian(t),o=[[Cesium.Math.toDegrees(s.longitude),Cesium.Math.toDegrees(s.latitude),s.height+e],i],this.visibilityFrustum.setPosition(o),this.visibilityFrustum._visCamera&&(self._viewer.scene.visibityMap||(self._viewer.scene.visibityMap=new Cesium.FeVisibilityMap({lightCamera:this.visibilityFrustum._visCamera,context:self._viewer.scene.context})))))},CgsAnalyze3D.prototype.calcuBoundaryAndSpan=function(e){for(var t=0;t<e.length;++t)this.slopeEast=Math.max(e[t][0],this.slopeEast),this.slopeWest=Math.min(e[t][0],this.slopeWest),this.slopeNorth=Math.max(e[t][1],this.slopeNorth),this.slopeSouth=Math.min(e[t][1],this.slopeSouth);var i=Cesium.Math.toRadians(this.slopeWest),s=Cesium.Math.toRadians(this.slopeNorth),o=new Cesium.Cartographic(i,s,0),a=this._viewer.getTerrain(),n=this;if(this._viewer&&(a instanceof CgsTerrain3D||a instanceof CgsTileTerrain3D))return Cesium.when(Cesium.sampleTerrain(this._viewer.terrainProvider,a.level,[o]),function(e){var t=e[0].height,i=CgsMath3D.EARTH_RADIUS+t,s=i*Math.cos(Math.abs((n.slopeNorth+n.slopeSouth)/2)*Math.PI/180);n.slopeSpanX=s*Math.PI*(n.slopeEast-n.slopeWest)/180,n.slopeSpanY=i*Math.PI*(n.slopeNorth-n.slopeSouth)/180})},CgsAnalyze3D.prototype.calcuSlopes=function(d){var e,t,i,s=this.slopeSpanX/this.slopeIntervalX,o=this.slopeSpanY/this.slopeIntervalY;if(!(s<1||o<1)){this.slopeInterpolationCountX=Math.ceil(s),this.slopeInterpolationCountY=Math.ceil(o),this.slopeDefaultCalcuMode&&(512<(e=this.slopeInterpolationCountX>this.slopeInterpolationCountY?this.slopeInterpolationCountX:this.slopeInterpolationCountY)?this.slopeInterpolationCountX>this.slopeInterpolationCountY?(this.slopeInterpolationCountX=512,this.slopeInterpolationCountY=Math.ceil(512*this.slopeInterpolationCountY/e)):(this.slopeInterpolationCountY=512,this.slopeInterpolationCountX=Math.ceil(512*this.slopeInterpolationCountX/e)):(t=this.slopeInterpolationCountX<this.slopeInterpolationCountY?this.slopeInterpolationCountX:this.slopeInterpolationCountY)<64&&(this.slopeInterpolationCountX<this.slopeInterpolationCountY?(this.slopeInterpolationCountX=64,this.slopeInterpolationCountY=Math.ceil(64*this.slopeInterpolationCountY/t)):(this.slopeInterpolationCountY=64,this.slopeInterpolationCountX=Math.ceil(64*this.slopeInterpolationCountX/t))),i=this.slopeSpanX/this.slopeInterpolationCountX>this.slopeSpanY/this.slopeInterpolationCountY?this.slopeSpanX/this.slopeInterpolationCountX:this.slopeSpanY/this.slopeInterpolationCountY,this.slopeIntervalX=this.slopeIntervalY=i);for(var a=(this.slopeEast-this.slopeWest)/(this.slopeInterpolationCountX-1),n=(this.slopeNorth-this.slopeSouth)/(this.slopeInterpolationCountY-1),r=[],l=-1;l<=this.slopeInterpolationCountY;++l)for(var u=-1;u<=this.slopeInterpolationCountX;++u){var p=this.slopeWest+u*a,h=this.slopeNorth-l*n,c=Cesium.Math.toRadians(p),g=Cesium.Math.toRadians(h),m=new Cesium.Cartographic(c,g,0);r.push(m)}var f=this._viewer.getTerrain(),C=this;return this._viewer&&(f instanceof CgsTerrain3D||f instanceof CgsTileTerrain3D)?Cesium.when(Cesium.sampleTerrain(this._viewer.terrainProvider,f.level,r),function(e){for(var t,i,s,o,a=C.slopeInterpolationCountX+2,n=[],r=0;r<e.length;r+=a){var l=e.slice(r,r+a);n.push(l)}C.meshNodes=n;for(var u=0,p=0;p<C.slopeInterpolationCountY;++p)for(var h=0;h<C.slopeInterpolationCountX;++h){t=p+1,i=h+1;var c=C.meshNodes[t][i],g=[Cesium.Math.toDegrees(c.longitude),Cesium.Math.toDegrees(c.latitude)];CgsMath3D.isInPolygon(d,g)?(s=(C.meshNodes[t+1][i-1].height+2*C.meshNodes[t][i-1].height+C.meshNodes[t-1][i-1].height-(C.meshNodes[t+1][i+1].height+2*C.meshNodes[t][i+1].height+C.meshNodes[t-1][i+1].height))/(8*C.slopeIntervalX),o=(C.meshNodes[t+1][i+1].height+2*C.meshNodes[t+1][i].height+C.meshNodes[t+1][i-1].height-(C.meshNodes[t-1][i+1].height+2*C.meshNodes[t-1][i].height+C.meshNodes[t-1][i-1].height))/(8*C.slopeIntervalY),C.slopeList.push(Cesium.Math.toDegrees(Math.atan(Math.sqrt(s*s+o*o)))),C.aspectList.push(CgsMath3D.calcuSlopeAspect(s,o)),C.slopeAspectPositionList.push(g)):(C.slopeList.push(-2),C.aspectList.push(-2)),C.slopePositionList[u++]=g}}):void 0}},CgsAnalyze3D.prototype.drawSlopeImage=function(){var e=this.slopeInterpolationCountX,t=this.slopeInterpolationCountY,i=document.createElement("canvas");i.width=e,i.height=t;for(var s=i.getContext("2d"),o=s.getImageData(0,0,e,t),a=o.data,n=0,r=0;r<t;++r)for(var l=0;l<e;++l){for(var u=this.slopeList[r*e+l],p=1;p<this.slopeDivisions.length;p++){if(u>=this.slopeDivisions[p-1]&&u<=this.slopeDivisions[p]){var h=(u-this.slopeDivisions[p-1])/(this.slopeDivisions[p]-this.slopeDivisions[p-1]),c=255*(this.slopeColors[p-1].red+h*(this.slopeColors[p].red-this.slopeColors[p-1].red)),g=255*(this.slopeColors[p-1].green+h*(this.slopeColors[p].green-this.slopeColors[p-1].green)),d=255*(this.slopeColors[p-1].blue+h*(this.slopeColors[p].blue-this.slopeColors[p-1].blue)),m=255*(this.slopeColors[p-1].alpha+h*(this.slopeColors[p].alpha-this.slopeColors[p-1].alpha));break}if(-2===u){c=255,g=255,d=255,m=0;break}}a[n]=c,a[n+1]=g,a[n+2]=d,a[n+3]=m,n+=4}s.putImageData(o,0,0);var f=new Image;return f.src=i.toDataURL("image/png"),f},CgsAnalyze3D.prototype.drawAspectImage=function(e){var a,t=(a=_asyncToGenerator(regeneratorRuntime.mark(function e(s,o,a,n,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){var i=new Image;i.src=s,i.onload=function(){l.drawImage(i,o,a,n,r),e()}}));case 1:case"end":return e.stop()}},e,this)})),function(e,t,i,s,o){return a.apply(this,arguments)}),i=this.slopeInterpolationCountX,s=this.slopeInterpolationCountY,o=i,n=s;s<i?(o=2048,n=Math.ceil(2048*s/i)):(n=2048,o=Math.ceil(2048*i/s));var r=document.createElement("canvas");r.width=o,r.height=n;var l=r.getContext("2d"),u=1,p=Math.ceil(i/u),h=Math.ceil(s/u);if(500<p*h&&(u=Math.ceil(Math.sqrt(i*s/500)+.5)),p*h<8&&(u=Math.ceil(Math.sqrt(i*s/8)+.5)),p=Math.floor(i/u+.5),h=Math.floor(s/u+.5),0<this.aspectList.length)for(var c=[],g=0;g<h;g++)for(var d=0;d<p;d++){for(var m=Math.ceil(o/p+.5),f=Math.ceil(n/h+.5),C=d*m,y=g*f,v=[0,0,0,0,0,0,0,0,0],b=g*u;b<g*u+u;b++)for(var D=d*u;D<d*u+u;D++){var S,_=b*i+D,w=-1,P=0;_<this.slopeList.length&&(S=this.slopeList[_],w=this.aspectList[_],P=S/90),0<=w&&w<22.5||337.5<=w&&w<=360?v[1]+=P:22.5<=w&&w<67.5?v[2]+=P:67.5<=w&&w<112.5?v[3]+=P:112.5<=w&&w<157.5?v[4]+=P:157.5<=w&&w<202.5?v[5]+=P:202.5<=w&&w<247.5?v[6]+=P:247.5<=w&&w<292.5?v[7]+=P:292.5<=w&&w<337.5?v[8]+=P:-1===w&&(v[0]+=P)}for(var T=0,M=1;M<9;++M)T=v[T]>=v[M]?T:M;switch(T){case 0:break;case 1:c.push(t(this.aspectImages[0],C,y,m,f));break;case 2:c.push(t(this.aspectImages[1],C,y,m,f));break;case 3:c.push(t(this.aspectImages[2],C,y,m,f));break;case 4:c.push(t(this.aspectImages[3],C,y,m,f));break;case 5:c.push(t(this.aspectImages[4],C,y,m,f));break;case 6:c.push(t(this.aspectImages[5],C,y,m,f));break;case 7:c.push(t(this.aspectImages[6],C,y,m,f));break;case 8:c.push(t(this.aspectImages[7],C,y,m,f))}}return Promise.all(c).then(function(){var e=new Image;return e.src=r.toDataURL("image/png"),e})},CgsAnalyze3D.prototype.showImage=function(e){var t=new Cesium.ImageMaterialProperty({image:e}),i={rectangle:{coordinates:Cesium.Rectangle.fromDegrees(this.slopeWest,this.slopeSouth,this.slopeEast,this.slopeNorth),material:t}},s=this._viewer.entities.add(i);this._state.entities.push(s)},CgsAnalyze3D.prototype.slopeAnalyze=function(t,i,s){this.resetSAParameter();var o=this,e=this.calcuBoundaryAndSpan(t);e&&e.then(function(){var e=o.calcuSlopes(t);e&&e.then(function(){var e;i&&(e=o.drawSlopeImage(),o.showImage(e)),"function"==typeof s&&s(o.slopeList)})})},CgsAnalyze3D.prototype.aspectAnalyze=function(t,i,s){this.resetSAParameter();var o=this,e=this.calcuBoundaryAndSpan(t);e&&e.then(function(){var e=o.calcuSlopes(t);e&&e.then(function(){var e;i?(e=o.drawAspectImage(t))&&e.then(function(e){o.showImage(e),"function"==typeof s&&s(o.aspectList)}):"function"==typeof s&&s(o.aspectList)})})},CgsAnalyze3D.prototype.resetSAParameter=function(){this.slopeEast=-180,this.slopeWest=180,this.slopeNorth=-90,this.slopeSouth=90,this.slopeSpanX=0,this.slopeSpanY=0,this.slopeInterpolationCountX=0,this.slopeInterpolationCountY=0,this.slopeIntervalX=100,this.slopeIntervalY=100,this.slopeList=[],this.aspectList=[],this.slopePositionList=[],this.slopeAspectPositionList=[]},CgsAnalyze3D.prototype.setFillColor=function(e){Cesium.defined(e)&&(this._fillColor=e)},CgsAnalyze3D.prototype.getFillColor=function(){return this._fillColor},CgsAnalyze3D.prototype.setGroundColor=function(e){Cesium.defined(e)&&(this._groundColor=e)},CgsAnalyze3D.prototype.getGroundColor=function(){return this._groundColor},CgsAnalyze3D.prototype.setBaseColor=function(e){Cesium.defined(e)&&(this._baseColor=e)},CgsAnalyze3D.prototype.getBaseColor=function(){return this._baseColor},CgsAnalyze3D.prototype.setCoverColor=function(e){Cesium.defined(e)&&(this._coverColor=e)},CgsAnalyze3D.prototype.getCoverColor=function(){return this._coverColor},CgsAnalyze3D.prototype.setLineColor=function(e){Cesium.defined(e)&&(this._lineColor=e)},CgsAnalyze3D.prototype.getLineColor=function(){return this._lineColor},CgsAnalyze3D.prototype.getSampleCount=function(){return this._interval},CgsAnalyze3D.prototype.setSampleCount=function(e){this._interval=e},CgsAnalyze3D.prototype.setSampleLength=function(e){this._sampleLength=e},CgsAnalyze3D.prototype.getSampleLength=function(){return this._sampleLength},CgsAnalyze3D.prototype.getGradient=function(){return this._gradient},CgsAnalyze3D.prototype.lineVisible=function(){},CgsAnalyze3D.prototype.computePolygonVisibleHide=function(e,t,l){for(var i={longitude:e[0],latitude:e[1],radius:t},s=this._splitCircle2GeoPosition(i),o=this._computerCircle([e[0],e[1]],[s[0],s[1]]),u=o.length,a=[],n=new Cesium.Cartographic(Cesium.Math.toRadians(e[0]),Cesium.Math.toRadians(e[1])),r=0;r<u;++r)var p=this._computeDistanceInterpolation(n,o[r]),a=a.concat(p);var h=this,c=a.slice(0),g=a.slice(0),d=this._viewer.getTerrain();if(this._viewer&&(d instanceof CgsTerrain3D||d instanceof CgsTileTerrain3D))Cesium.when(Cesium.sampleTerrain(h._viewer.terrainProvider,d.level,c),function(){for(var e,t,i,s=g.length/u,o=0,a=g.length,n=0;n<a;++n){(n+1)%s==0&&(e=((n+1)/s-1)*s,t=g.slice(e,e+s),i=[],h._computeVisiblePoint(t,i),o+=i[0])}var r=o/g.length*100;"function"==typeof l&&l(r)});else{for(var m=g.length/u,f=0,C=0;C<u;++C){var y=C*m,p=g.slice(y,y+m),v=[];h._computeVisiblePoint(p,v),f+=v[0]}var b=f/g.length*100;"function"==typeof l&&l(b)}},CgsAnalyze3D.prototype.computeFillDigHide=function(e,t){if(Array.isArray(e)){this.mDepth&&(this.mDepth=0),this.digVolume&&(this.digVolume=0),this.fillVolume&&(this.fillVolume=0),this.groundArea&&(this.groundArea=0),this._prism&&(this._prism=void 0),this._plane&&(this._plane=void 0),this.measureTooltip&&(this.measureTooltip=null),this.measureTooltipElement&&(this.measureTooltipElement=null),this.maxAltiPoint&&(this.maxAltiPoint=void 0),this.minAltiPoint&&(this.minAltiPoint=void 0),this.isCalculateDone&&(this.isCalculateDone=!1);for(var i=e=e.map(function(e){var t;return(t=Cesium.Cartographic).fromDegrees.apply(t,_toConsumableArray(e))}),s=[],o=0,a=e.length-1;o<a;++o){var n=e[o],r=e[o+1],l=this._computeDistanceInterpolation(n,r);s.pop(),s=s.concat(l)}n=e[e.length-1],r=e[0],l=this._computeDistanceInterpolation(n,r);s.pop(),s=s.concat(l);var u=this._viewer.getTerrain();this._viewer&&(u instanceof CgsTerrain3D||u instanceof CgsTileTerrain3D)?this.calcuVolume(i,function(e){"function"==typeof t&&t({fillVolume:e.fillVolume,digVolume:e.digVolume})}):"function"==typeof t&&t({fillVolume:null,digVolume:null})}},CgsAnalyze3D.prototype.computeFloodHide=function(e,t){if(Array.isArray(e)){this.clock&&(clearInterval(this.clock),this.clock=void 0),this.floodSurfaceArea&&(this.floodSurfaceArea=0),this.floodVolume&&(this.floodVolume=0),this.waterAltitude&&(this.waterAltitude=0),this.minWaterHeight&&(this.minWaterHeight=0),this.maxWaterHeight&&(this.maxWaterHeight=0),this.baseWaterHeight&&(this.baseWaterHeight=0),this.maxAltiPoint&&(this.maxAltiPoint=void 0),this.minAltiPoint&&(this.minAltiPoint=void 0),this.isCalculateDone&&(this.isCalculateDone=!1),this.isFloodVolumeCalcu=!0,e=e.map(function(e){var t;return(t=Cesium.Cartographic).fromDegrees.apply(t,_toConsumableArray(e))}),this.floodKeyPoint=e;var i=this._viewer.getTerrain();if(this._viewer&&(i instanceof CgsTerrain3D||i instanceof CgsTileTerrain3D)){for(var s=[],o=0;o<e.length-1;++o){var a=e[o],n=e[o+1],r=this._computeDistanceInterpolation(a,n);s.pop(),s=s.concat(r)}a=e[e.length-1],n=e[0],r=this._computeDistanceInterpolation(a,n);return s.pop(),s=s.concat(r),this.calcuVolume(this.floodKeyPoint,function(e){"function"==typeof t&&t({floodVolume:e.floodVolume,floodSurfaceArea:e.floodSurfaceArea})}),s}"function"==typeof t&&t({floodVolume:null,floodSurfaceArea:null})}},CgsAnalyze3D.prototype.computeProfileHide=function(e,i){if(Array.isArray(e)){e=e.map(function(e){var t;return(t=Cesium.Cartographic).fromDegrees.apply(t,_toConsumableArray(e))});for(var t=[],s=0;s<e.length-1;++s)var o=e[s],a=e[s+1],n=this._computeDistanceInterpolation(o,a),t=t.concat(n);var r,l=this._viewer.getTerrain();this._viewer&&(l instanceof CgsTerrain3D||l instanceof CgsTileTerrain3D)?Cesium.when(Cesium.sampleTerrain(this._viewer.terrainProvider,l.level,t),function(e){var t=e.map(function(e){return[180*e.longitude/Math.PI,180*e.latitude/Math.PI,e.height]});"function"==typeof i&&i(t)}):(r=t.map(function(e){return[180*e.longitude/Math.PI,180*e.latitude/Math.PI,0]}),"function"==typeof i&&i(r))}},CgsAnalyze3D.VISIBLE_LINE="visibleLine",CgsAnalyze3D.VISIBLE_POLYGON="visiblePolygon",CgsAnalyze3D.GRADIENT_ANALYZE="gradientAnalyze",CgsAnalyze3D.PROFILE_ANALYZE="profileAnalyze",CgsAnalyze3D.FILLDIG_ANALYZE="filldigAnalyze",CgsAnalyze3D.FLOOD_ANALYZE="floodAnalyze",CgsAnalyze3D.VISIBILITY_ANALYZE="VisibilityAnalyze",CgsAnalyze3D.CIRCLE_POINT_NUM=360,CgsAnalyze3D.STRATSIMULATE=0,CgsAnalyze3D.STOPSIMULATE=1,CgsAnalyze3D.RESIMULATE=2,CgsAnalyze3D.CUBICMETERSTOKILOMETERS=1e9,CgsAnalyze3D.SQUAREMETERSTOKILOMETERS=1e6,CgsAnalyzeTool3D=function(e){var t,T,D;function s(e){if(Cesium.defined(T._analyzeObj)){var t=e.screenSpaceEventHandler._element.index;if(null!=(p=0==t?T._pixelToLonLat(e.position):T.mv_pixelToLonLat(e.position,t-1))){var i,s,o,a,n,r,l,u,p,h=p[0],c=p[1];if(T.numOfLeftClick++,T._type==CgsAnalyze.VISIBLE_LINE)0==T._state.points.length?(T._state.points.push(h),T._state.points.push(c),T._drawPickPoint(e.position,t)):(2<T._state.points.length&&(T._state.points.pop(),T._state.points.pop()),T._state.points.push(h),T._state.points.push(c),T._drawPickPoint(e.position,t),n=T._state.points[0],r=T._state.points[1],l=T._state.points[2],u=T._state.points[3],new Cesium.Cartesian3.fromDegrees(n,r),new Cesium.Cartesian3.fromDegrees(l,u),T._analyzeObj.computeLineVisible([n,r],[l,u]),T._state.points=[]),2==T.numOfLeftClick&&(T.numOfLeftClick=0,T._deactivate(),D.find(".CgsMeasureTool__lineVisibleActive").removeClass("CgsMeasureTool__line_select"));else if(T._type==CgsAnalyze.VISIBLE_POLYGON){if(0==T._state.altitudes.length){var g=0==t?T._pixelToCartographic(e.position):T.mv_pixelToCartographic(e.position,t-1);T._state.altitudes.push(g),T._drawPickPoint(e.position,t)}else{var d=T._state.altitudes[0];if(!Cesium.defined(d))return;var m=Cesium.Math.toDegrees(d.longitude),f=Cesium.Math.toDegrees(d.latitude),C=(d.height,0==t?T._pixelToCartographic(e.position):T.mv_pixelToCartographic(e.position,t-1)),y=(Cesium.Math.toDegrees(C.longitude),Cesium.Math.toDegrees(C.latitude),new Cesium.EllipsoidGeodesic),v=Cesium.Cartographic.clone(d);y.setEndPoints(v,C);var b=y.surfaceDistance;4e4<b&&(b=4e4),T._drawCircleObj&&T._removeCircle(),T._analyzeObj.computePolygonVisible([m,f],b),T._state.altitudes=[]}2==T.numOfLeftClick&&(T.numOfLeftClick=0,T._deactivate(),D.find(".CgsMeasureTool__polygonVisibleActive").removeClass("CgsMeasureTool__line_select"))}else{T._type==CgsAnalyze.GRADIENT_ANALYZE?(0==T._state.altitudes.length?(g=0==t?T._pixelToCartographic(e.position):T.mv_pixelToCartographic(e.position,t-1),T._state.altitudes.push(g),T._drawPickPoint(e.position,t),T._analyzeObj._removeGradientPoint()):(1<T._state.altitudes.length&&T._state.altitudes.pop(),g=0==t?T._pixelToCartographic(e.position):T.mv_pixelToCartographic(e.position,t-1),T._state.altitudes.push(g),T._drawPickPoint(e.position,t),v=T._state.altitudes[0],i=Cesium.Math.toDegrees(v.longitude),s=Cesium.Math.toDegrees(v.latitude),v.height,C=T._state.altitudes[1],o=Cesium.Math.toDegrees(C.longitude),a=Cesium.Math.toDegrees(C.latitude),C.height,T._analyzeObj.computeGradient([i,s],[o,a]),T._state.altitudes=[]),2==T.numOfLeftClick&&(T.numOfLeftClick=0,T._deactivate(),D.find(".CgsMeasureTool__lineGradientActive").removeClass("CgsMeasureTool__line_select"))):T._type==CgsAnalyze.PROFILE_ANALYZE?(0==T._state.altitudes.length&&T._analyzeObj._removeProfilePoint(),g=0==t?T._pixelToCartographic(e.position):T.mv_pixelToCartographic(e.position,t-1),T._state.altitudes.push(g),T._drawPickPoint(e.position,t),this.profileLeftDown=!0):T._type==CgsAnalyze.FILLDIG_ANALYZE?(T._state.points.push(h),T._state.points.push(c),g=0==t?T._pixelToCartographic(e.position):T.mv_pixelToCartographic(e.position,t-1),T._state.altitudes.push(g),1<T._state.altitudes.length&&T._drawAssistantLine(T._state.altitudes),T._drawPickPoint(e.position,t),this.profileLeftDown=!0):T._type==CgsAnalyze.FLOOD_ANALYZE||T._type==CgsAnalyze.SLOPE_ANALYZE||T._type==CgsAnalyze.ASPECT_ANALYZE?(T._state.points.push(h),T._state.points.push(c),g=0==t?T._pixelToCartographic(e.position):T.mv_pixelToCartographic(e.position,t-1),T._state.altitudes.push(g),T._drawPickPoint(e.position,t),this.profileLeftDown=!0):T._type==CgsAnalyze.VISIBILITY_ANALYZE?(0==T._state.points.length?(T._state.points.push(h),T._state.points.push(c),T.isLeftClick=!0):T.isMoveMouse&&(2<T._state.points.length&&(T._state.points.pop(),T._state.points.pop()),T._state.points.push(h),T._state.points.push(c),n=T._state.points[0],r=T._state.points[1],l=T._state.points[2],u=T._state.points[3],T._analyzeObj.visibilityAnalyze([n,r],[l,u]),T._state.points=[],T.isLeftClick=!1,T.isMoveMouse=!1),2==T.numOfLeftClick&&(T.numOfLeftClick=0,T._deactivate(),D.find(".CgsMeasureTool__visibiltyActive").removeClass("CgsMeasureTool__line_select"))):T._type==CgsAnalyze.VIEWSHED_ANALYZE&&((p=Cesium.getCurrentMousePosition(T._viewer.scene,e.position))&&(T.viewshed.cameraPosition?T.viewshed.cameraPosition&&!T.viewshed.viewPosition&&(T.viewshed.viewPosition=p,T.viewshed._addToScene(),T.viewshed.calback&&T.viewshed.calback()):T.viewshed.cameraPosition=p),2==T.numOfLeftClick&&(T.numOfLeftClick=0,T._deactivate(),D.find(".CgsMeasureTool__viewshedActive").removeClass("CgsMeasureTool__line_select")))}}}}function o(e){var t=e.screenSpaceEventHandler._element.index;if(null!=(n=0==t?T._pixelToLonLat(e.endPosition):T.mv_pixelToLonLat(e.endPosition,t-1))){var i,s,o,a,n,r,l=n[0],u=n[1];if(T._type==CgsAnalyze.VISIBLE_LINE)0==T.numOfLeftClick?(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择第一个点",T.analyzeTooltip.setVisible(!0)):1==T.numOfLeftClick&&(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择结束点",T.analyzeTooltip.setVisible(!0));else if(T._type==CgsAnalyze.VISIBLE_POLYGON){if(0==T.numOfLeftClick?(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择一个视点",T.analyzeTooltip.setVisible(!0)):1==T.numOfLeftClick&&(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择结束点",T.analyzeTooltip.setVisible(!0)),0===T._state.altitudes.length)return;var p=T._state.altitudes[0],h=Cesium.Math.toDegrees(p.longitude),c=Cesium.Math.toDegrees(p.latitude),g=p.height,d=0==t?T._pixelToCartographic(e.endPosition):T.mv_pixelToCartographic(e.endPosition,t-1),m=Cesium.Math.toDegrees(d.longitude),f=Cesium.Math.toDegrees(d.latitude),C=new Cesium.EllipsoidGeodesic,y=Cesium.Cartographic.clone(p);if(C.setEndPoints(y,d),4e4<C.surfaceDistance)return void(T.analyzeTooltipElement.innerHTML="超出范围，请在范围内选择结束点");for(var v=[],b=T._viewer.scene.globe,D=T._analyzeObj._computerCircle([h,c],[m,f],12),S=D.length,_=0;_<S;++_){var w=Cesium.Math.toDegrees(D[_].longitude),P=Cesium.Math.toDegrees(D[_].latitude),g=b.getHeight(D[_]);v.push([w,P,g])}T._drawCircleObj?T._drawCircleObj.setPosition(v):(T._drawCircleObj=new CgsLine3D({positions:v,fillColor:T._analyzeObj.getFillColor(),name:" "}),T._drawCircleObj.setSaveFlag(!1),T._drawCircleObj._posUpdateCallback(!1),T._viewer.addFeature(T._drawCircleObj),T._drawCircleObj.getLabel().setSaveFlag(!1),T._state.list.push(T._drawCircleObj))}else if(T._type==CgsAnalyze.GRADIENT_ANALYZE)0==T.numOfLeftClick?(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择第一个点",T.analyzeTooltip.setVisible(!0)):1==T.numOfLeftClick&&(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择结束点",T.analyzeTooltip.setVisible(!0));else if(T._type==CgsAnalyze.PROFILE_ANALYZE)0==T.numOfLeftClick?(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择第一个点",T.analyzeTooltip.setVisible(!0)):1<=T.numOfLeftClick&&(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择下一个点或右键结束",T.analyzeTooltip.setVisible(!0));else if(T._type==CgsAnalyze.FILLDIG_ANALYZE||T._type==CgsAnalyze.FLOOD_ANALYZE||T._type==CgsAnalyze.SLOPE_ANALYZE||T._type==CgsAnalyze.ASPECT_ANALYZE){0==T.numOfLeftClick?(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择第一个点",T.analyzeTooltip.setVisible(!0)):1==T.numOfLeftClick?(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择第二个点",T.analyzeTooltip.setVisible(!0)):2<=T.numOfLeftClick&&(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择下一个点或右键结束",T.analyzeTooltip.setVisible(!0));S=T._state.altitudes.length;T._type==CgsAnalyze.FILLDIG_ANALYZE&&1<=S&&((v=T._state.altitudes.slice()).push(Cesium.Cartographic.fromDegrees(n[0],n[1],n[2])),T._drawAssistantLine(v))}else if(T._type==CgsAnalyze.VISIBILITY_ANALYZE){if(0==T.numOfLeftClick?(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择一个视点",T.analyzeTooltip.setVisible(!0)):1==T.numOfLeftClick&&(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择结束点",T.analyzeTooltip.setVisible(!0)),0==T._state.points.length)return;T.isLeftClick&&(2<T._state.points.length&&(T._state.points.pop(),T._state.points.pop()),T._state.points.push(l),T._state.points.push(u),i=T._state.points[0],s=T._state.points[1],o=T._state.points[2],a=T._state.points[3],T._analyzeObj.visibilityAnalyze([i,s],[o,a]),T.isMoveMouse=!0)}else{T._type==CgsAnalyze.VIEWSHED_ANALYZE&&(0==T.numOfLeftClick?(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择一个视点",T.analyzeTooltip.setVisible(!0)):1==T.numOfLeftClick&&(T.analyzeTooltip.setPosition(n),T.analyzeTooltipElement.innerHTML="请选择结束点",T.analyzeTooltip.setVisible(!0)),!(n=Cesium.getCurrentMousePosition(T._viewer.scene,e.endPosition))||(r=T.viewshed.cameraPosition)&&(T.viewshed.frustumQuaternion=T.viewshed.getFrustumQuaternion(r,n),T.viewshed.distance=Number(Cesium.Cartesian3.distance(r,n).toFixed(1))))}}}function a(e){var t=e.screenSpaceEventHandler._element.index,i=0==t?T._pixelToLonLat(e.position):T.mv_pixelToLonLat(e.position,t-1);if(null!=i){var s,o,a,n,r=i[0],l=i[1];if(T._type==CgsAnalyze.PROFILE_ANALYZE){if(!this.profileLeftDown)return;var u=0==t?T._pixelToCartographic(e.position):T.mv_pixelToCartographic(e.position,t-1);T._state.altitudes.push(u),T._drawPickPoint(e.position,t);for(var p=[],h=0;h<T._state.altitudes.length;++h)p.push(T._state.altitudes[h]);T._analyzeObj.computeProfile(p),T._state.altitudes=[],this.profileLeftDown=!1,0!=T.numOfLeftClick&&(T.numOfLeftClick=0,T._deactivate(),D.find(".CgsMeasureTool__lineProfileActive").removeClass("CgsMeasureTool__line_select"))}else if(T._type==CgsAnalyze.FILLDIG_ANALYZE){if(!this.profileLeftDown)return;if(T.numOfLeftClick<2)return;u=0==t?T._pixelToCartographic(e.position):T.mv_pixelToCartographic(e.position,t-1);T._state.altitudes.push(u),T._drawPickPoint(e.position,t);p=[];T._state.points.push(r),T._state.points.push(l);for(h=0;h<T._state.altitudes.length;++h)p.push(T._state.altitudes[h]);T._analyzeObj.computeFillDig(p),T.assistantLine&&(T.assistantLine._posUpdateCallback(!0),T._viewer.removeFeature(T.assistantLine),T.assistantLine=void 0),T._state.altitudes=[],T._state.points=[],this.profileLeftDown=!1,T.numOfLeftClick=0,T._deactivate(),D.find(".CgsMeasureTool__fillDigActive").removeClass("CgsMeasureTool__line_select")}else if(T._type==CgsAnalyze.FLOOD_ANALYZE||T._type==CgsAnalyze.SLOPE_ANALYZE||T._type==CgsAnalyze.ASPECT_ANALYZE){if(!this.profileLeftDown)return;if(T.numOfLeftClick<2)return;u=0==t?T._pixelToCartographic(e.position):T.mv_pixelToCartographic(e.position,t-1);T._state.altitudes.push(u);for(h=0;h<T._floodPoint.length;++h)T._viewer.removeFeature(T._floodPoint[h]);T._floodPoint=[];var p=[],c=[];T._state.points.push(r),T._state.points.push(l);for(h=0;h<T._state.altitudes.length;++h){p.push(T._state.altitudes[h]);var g=[Cesium.Math.toDegrees(T._state.altitudes[h].longitude),Cesium.Math.toDegrees(T._state.altitudes[h].latitude),T._state.altitudes[h].height];c.push(g)}T._type==CgsAnalyze.FLOOD_ANALYZE&&T._analyzeObj.computeFlood(p),T._type==CgsAnalyze.SLOPE_ANALYZE&&T._analyzeObj.slopeAnalyze(c,!0),T._type==CgsAnalyze.ASPECT_ANALYZE&&T._analyzeObj.aspectAnalyze(c,!0),T._state.altitudes=[],T._state.points=[],this.profileLeftDown=!1,T.numOfLeftClick=0,T._deactivate(),T._type==CgsAnalyze.FLOOD_ANALYZE&&D.find(".CgsMeasureTool__floodActive").removeClass("CgsMeasureTool__line_select"),T._type==CgsAnalyze.SLOPE_ANALYZE&&D.find(".CgsMeasureTool__slopeActive").removeClass("CgsMeasureTool__line_select"),T._type==CgsAnalyze.ASPECT_ANALYZE&&D.find(".CgsMeasureTool__aspectActive").removeClass("CgsMeasureTool__line_select")}else if(T._type==CgsAnalyze.VISIBILITY_ANALYZE){if(0==T._state.points.length)return;T.isMoveMouse&&(2<T._state.points.length&&(T._state.points.pop(),T._state.points.pop()),T._state.points.push(r),T._state.points.push(l),s=T._state.points[0],o=T._state.points[1],a=T._state.points[2],n=T._state.points[3],T._analyzeObj.visibilityAnalyze([s,o],[a,n]),T._state.points=[],T.isLeftClick=!1,T.isMoveMouse=!1),2==T.numOfLeftClick&&(T.numOfLeftClick=0,T._deactivate(),D.find(".CgsMeasureTool__visibiltyActive").removeClass("CgsMeasureTool__line_select"))}}}this._viewer=void 0,this.map=void 0,Cesium.defined(e.mapObject)&&(this.map=e.mapObject,this._viewer=e.mapObject.map3D,this.numOfLeftClick=0,this.options=e,this.analyzeTooltipElement=document.createElement("div"),this.analyzeTooltipElement.className="cgstooltip cgstooltip-analyze",this.analyzeTooltipElement.style.pointerEvents="none",this.analyzeTooltipElement.style.fontSize="12px",this.analyzeTooltip=new CgsOverlay3D({position:[0,0],element:this.analyzeTooltipElement,offset:[0,-6],positioning:"bottom-center",stopEvent:!1,distanceDisplayCondition:[0,2e5]}),this.analyzeTooltip.setVisible(!1),this._viewer.addFeature(this.analyzeTooltip),(t=this._viewer.canvas).onmouseover=function(){T.analyzeTooltip.getVisible()&&T.analyzeTooltip.setVisible(!0)},t.onmouseout=function(){T.analyzeTooltip.getVisible()&&T.analyzeTooltip.setVisible(!1)},Cesium.defined(e.type)?(this._type=e.type,(T=this)._drawCircleObj=void 0,this._analyzeObj=new CgsAnalyze3D({mapObject:T.map,showPoint:!1}),this.viewshed=new Cesium.ViewShed3D(this._viewer),this._state={points:[],list:[],labelList:[],altitudes:[]},this.lowPoint=void 0,this.highPoint=void 0,this._floodPoint=[],this.profileLeftDown=!1,this.isLeftClick=!1,this.isMoveMouse=!1,D=$$(e.mapObject.container),this.activate=function(){if(this._viewer.screenSpaceEventHandler.setInputAction(s,Cesium.ScreenSpaceEventType.LEFT_CLICK),this._viewer.screenSpaceEventHandler.setInputAction(o,Cesium.ScreenSpaceEventType.MOUSE_MOVE),this._viewer.screenSpaceEventHandler.setInputAction(a,Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._viewer.isMultiViewsMode)for(var e=this._viewer.cesiumWidget.allViewports.length,t=0;t<e;++t){var i=this._viewer.cesiumWidget.allViewports[t].screenSpaceEventHandler;i.setInputAction(s,Cesium.ScreenSpaceEventType.LEFT_CLICK),i.setInputAction(o,Cesium.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction(a,Cesium.ScreenSpaceEventType.RIGHT_CLICK)}this.viewshed&&(this.viewshed.radar&&this.viewshed.removeRadar(),this.viewshed.postProcess&&this._viewer.scene.postProcessStages.remove(this.viewshed.postProcess),this.viewshed.viewShadowMap=void 0)}):console.info("please select analyze type"))},CgsAnalyzeTool3D.prototype._deactivate=function(){if(this._viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this._viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),this._viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._viewer.isMultiViewsMode){for(var e=this._viewer.cesiumWidget.allViewports.length,t=0;t<e;++t){var i=this._viewer.cesiumWidget.allViewports[t].screenSpaceEventHandler;i.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),i.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),i.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)}this._viewer.handleMultiViewsEvent()}null!=this.analyzeTooltip&&this.analyzeTooltip.setVisible(!1),this.viewshed&&(this.viewshed.cameraPosition=void 0,this.viewshed.viewPosition=void 0),this._viewer.pickerActivate()},CgsAnalyzeTool3D.prototype.deactivate=function(){if(this._viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this._viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),this._viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._viewer.isMultiViewsMode){for(var e=this._viewer.cesiumWidget.allViewports.length,t=0;t<e;++t){var i=this._viewer.cesiumWidget.allViewports[t].screenSpaceEventHandler;i.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),i.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),i.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)}this._viewer.handleMultiViewsEvent()}null!=this.analyzeTooltip&&this.analyzeTooltip.setVisible(!1),this._analyzeObj&&Cesium.defined(this._analyzeObj._gradientTool)&&(this._analyzeObj._gradientTool.deactivate(),this._analyzeObj._removeGradientPoint()),this._analyzeObj&&Cesium.defined(this._analyzeObj._profileTool)&&(this._analyzeObj._profileTool.deactivate(),this._analyzeObj._removeProfilePoint()),this._analyzeObj&&Cesium.defined(this._analyzeObj._fillDigTool)&&this._analyzeObj._fillDigTool.deactivate(),this._analyzeObj&&Cesium.defined(this._analyzeObj._floodTool)&&this._analyzeObj._floodTool.deactivate(),this._viewer.pickerActivate()},CgsAnalyzeTool3D.prototype.remove=function(){null!=this.analyzeTooltip&&this._viewer.removeFeature(this.analyzeTooltip);for(var e=this,t=0;t<e._state.list.length;t++)e._viewer.removeFeature(e._state.list[t]);e._state.list=[];for(t=0;t<e._state.labelList.length;t++)e._viewer.removeFeature(e._state.labelList[t]);e._state.labelList=[],e._analyzeObj&&e._analyzeObj.remove(),this.viewshed&&this.viewshed.destroy()},CgsAnalyzeTool3D.prototype._removeCircle=function(){for(var e=0;e<this._state.list.length;e++){this._state.list[e]==this._drawCircleObj&&(this._state.list.splice(e,1),this._viewer.removeFeature(this._drawCircleObj),this._drawCircleObj=void 0)}},CgsAnalyzeTool3D.prototype.setType=function(e){this._type=e},CgsAnalyzeTool3D.prototype.getType=function(){return this._type},CgsAnalyzeTool3D.prototype._drawPickPoint=function(e,t){var o=this,i=0==t?o._viewer.scene._camera0.getPickRay(e):o._viewer.cesiumWidget.allViewports[t-1].camera.getPickRay(e),s=o._viewer.scene.globe.pick(i,o._viewer.scene),a=Cesium.Cartographic.fromCartesian(s),n=[];n.push(a);var r,l,u=o._viewer.getTerrain();o._viewer&&(u instanceof CgsTerrain3D||u instanceof CgsTileTerrain3D)?Cesium.when(Cesium.sampleTerrain(o._viewer.terrainProvider,u.level,n),function(e){var t=e[0],i={position:[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude),t.height],fillColor:"rgba(255.0,255.0,0.0,1.0)",heightReference:CgsPoint.CLAMP_TO_GROUND,outlineWidth:0,pixelSize:2.5},s=new CgsPoint3D(i);s.setVisibleHeight([0,2e5]),s.setSaveFlag(!1),o._viewer.addFeature(s),o._state.labelList.push(s),o.getType()!=CgsAnalyze.FLOOD_ANALYZE&&o.getType()!=CgsAnalyze.SLOPE_ANALYZE&&o.getType()!=CgsAnalyze.ASPECT_ANALYZE||o._floodPoint.push(s)}):(r={position:[Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude),a.height],fillColor:"rgba(255.0,255.0,0.0,1.0)",heightReference:CgsPoint.CLAMP_TO_GROUND,outlineWidth:0,pixelSize:2.5},(l=new CgsPoint3D(r)).setVisibleHeight([0,2e5]),l.setSaveFlag(!1),o._viewer.addFeature(l),o._state.labelList.push(l),o.getType()!=CgsAnalyze.FLOOD_ANALYZE&&o.getType()!=CgsAnalyze.SLOPE_ANALYZE&&o.getType()!=CgsAnalyze.ASPECT_ANALYZE||o._floodPoint.push(l))},CgsAnalyzeTool3D.prototype._drawAssistantLine=function(e){for(var t=e.length,i=[],s=0;s<t;++s){var o=e[s];i.push([Cesium.Math.toDegrees(o.longitude),Cesium.Math.toDegrees(o.latitude),o.height])}this.assistantLine?this.assistantLine.setPosition(i):(this.assistantLine=new CgsLine3D({positions:i,fillColor:"rgba(255,255,0,1.0)",width:3,clampToGround:!0}),this._viewer.addFeature(this.assistantLine),this.assistantLine._posUpdateCallback(!1))},CgsAnalyzeTool3D.prototype._pixelToLonLat=function(e){var t=this._viewer.scene._camera0.getPickRay(e),i=this._viewer.scene.globe.pick(t,this._viewer.scene);if(Cesium.defined(i)){var s=Cesium.Cartographic.fromCartesian(i);return[Cesium.Math.toDegrees(s.longitude),Cesium.Math.toDegrees(s.latitude),s.height]}},CgsAnalyzeTool3D.prototype.mv_pixelToLonLat=function(e,t){var i=this._viewer.cesiumWidget.allViewports[t].camera.getPickRay(e),s=this._viewer.scene.globe.pick(i,this._viewer.scene);if(Cesium.defined(s)){var o=Cesium.Cartographic.fromCartesian(s);return[Cesium.Math.toDegrees(o.longitude),Cesium.Math.toDegrees(o.latitude),o.height]}},CgsAnalyzeTool3D.prototype._pixelToCartographic=function(e){var t=this._viewer,i=t.scene._camera0.getPickRay(e),s=t.scene.globe.pick(i,t.scene);return Cesium.Cartographic.fromCartesian(s)},CgsAnalyzeTool3D.prototype.mv_pixelToCartographic=function(e,t){var i=this._viewer,s=i.cesiumWidget.allViewports[t].camera.getPickRay(e),o=i.scene.globe.pick(s,i.scene);return Cesium.Cartographic.fromCartesian(o)},CgsWFSLayer3D=function(l){l.text||(l.text=l.name),null==l.visible&&(l.visible=!0),null==l.isAddToLayerTree&&(l.isAddToLayerTree=!0),null==l.saveFlag&&(l.saveFlag=!0),l.font||(l.font="600 16px sans-serif"),l.color||(l.color="rgba(0,255,255,0.7)"),l.outlineColor||(l.outlineColor="rgba(0,0,0,0)"),l.strokeWidth||(l.strokeWidth=5),l.image||(l.image=""),l.featureType||(l.featureType="point");var u=l.mapObject.map3D;this._scene=u.scene,this._placeMark=null,this._placePoint=null;var p=this,h=CgsUtil.getProxyURL(l.proxy),c=l.filterName?l.filterName:"szname";"point"===l.featureType&&function(e){var t=e.visible;p._placeMark=p._scene.primitives.add(new Cesium.FeLodPlaceMark({map:u,show:t}));var i={level:e.level,name:e.name,minRange:e.minHeight,maxRange:e.maxHeight,font:e.font,style:l.style,outlineColor:Cesium.Color.fromCssColorString(e.outlineColor),strokeWidth:l.strokeWidth,fillColor:Cesium.Color.fromCssColorString(e.color),url:e.url,image:e.image?CGS_SDK_PATH+e.image:"",filterName:c,proxy:h};{var s,o,a,n;e.pixelOffset&&(s=e.pixelOffset.indexOf("["),o=e.pixelOffset.indexOf(","),a=e.pixelOffset.indexOf("]"),n=new Cesium.Cartesian2(parseFloat(e.pixelOffset.slice(s+1,o)),parseFloat(e.pixelOffset.slice(o+1,a))),i.pixelOffset=n)}p._placeMark.addDataSource(i);var r=e.id;null==r&&(r=CgsIds++);p.state={text:e.text,type:"WFS",featureType:e.featureType,url:e.url,visible:e.visible,font:e.font,level:e.level,minRange:e.minHeight,maxRange:e.maxHeight,color:e.color,map:u,name:e.name,image:e.image,id:"cgslayer_id_"+r,pId:e.pId,isAddToLayerTree:e.isAddToLayerTree,saveFlag:l.saveFlag,filterName:c}}(l)},CgsInherits(CgsWFSLayer3D,CgsLayer3D),CgsWFSLayer3D.prototype.remove=function(e){this._scene.primitives.contains(e)&&this._scene.primitives.remove(e)},CgsWFSLayer3D.prototype.setMap=function(e){this.state.map=e},CgsWFSLayer3D.prototype.getMap=function(){return this.state.map},CgsWFSLayer3D.prototype.setName=function(e){this.state.name=e},CgsWFSLayer3D.prototype.getName=function(){return this.state.name},CgsWFSLayer3D.prototype.setText=function(e){this.state.text=e},CgsWFSLayer3D.prototype.getText=function(){return this.state.text},CgsWFSLayer3D.prototype.setAddToLayerTree=function(e){this.state.isAddToLayerTree=e},CgsWFSLayer3D.prototype.getAddToLayerTree=function(){return this.state.isAddToLayerTree},CgsWFSLayer3D.prototype.getId=function(){return this.state.id},CgsWFSLayer3D.prototype.setPId=function(e){this.state.pId=e},CgsWFSLayer3D.prototype.setVisible=function(e){this._placeMark.show=e},CgsWFSLayer3D.prototype.getVisible=function(){return this._placeMark.show},CgsWFSLayer3D.prototype.getType=function(){return this.state.type},CgsWFSLayer3D.prototype.getFeatureType=function(){return this.state.featureType},CgsWFSLayer3D.prototype.getUrl=function(){return this.state.url},CgsWFSLayer3D.prototype.getFont=function(){return this.state.font},CgsWFSLayer3D.prototype.getLevel=function(){return this.state.level},CgsWFSLayer3D.prototype.getColor=function(){return this.state.color},CgsWFSLayer3D.prototype.getImage=function(){return this.state.image},CgsWFSLayer3D.prototype.getMinRange=function(){return this.state.minRange},CgsWFSLayer3D.prototype.getMaxRange=function(){return this.state.maxRange},CgsWFSLayer3D.prototype.getSaveFlag=function(){return this.state.saveFlag},CgsWFSLayer3D.prototype.setSaveFlag=function(e){return this.state.saveFlag=e},CgsGraticuleLayer3D=function(e){e.text||(e.text=e.name),null==e.visible&&(e.visible=!0),null==e.saveFlag&&(e.saveFlag=!0);var t=CgsIds++,D={map:e.mapObject.map3D,scene:e.mapObject.map3D.scene,camera:e.mapObject.map3D.scene.camera,ellipsoid:e.mapObject.map3D.scene.globe.ellipsoid,eventHandler:null,lines:{},labels:null,points:null,option:null,span:e.span,lineColor:e.lineColor,labelColor:e.labelColor,type:"Graticule",visible:e.visible,labelVisible:0!=e.labelVisible,name:e.name,id:"cgslayer_id_"+t,pId:e.pId,isAddToLayerTree:e.isAddToLayerTree,saveFlag:e.saveFlag,text:e.text};null==D.lineColor&&(D.lineColor="rgba(0,255,0,0.2)"),null==D.labelColor&&(D.labelColor="rgba(0,255,0,1)"),null==(this.state=D).span&&(D.span=30);var S=null,a=!1;function n(){D.lines.lng.removeAll(),D.lines.lat.removeAll(),D.labels.removeAll(),D.points.removeAll();var e=D.scene.globe._surface._debug.maxDepth;5<e&&e<10?--e:10<=e&&(e-=2),function(e){if(!D.visible)return;D.option=S[e];var t=D.option;if(t){var i=t.style.width;i=i&&0<i&&!isNaN(i)?Math.round(i):1;var s=function(){var e=D.camera.computeViewRectangle(D.scene.globe.ellipsoid);return{west:Cesium.Math.toDegrees(e.west),east:Cesium.Math.toDegrees(e.east),south:Cesium.Math.toDegrees(e.south),north:Cesium.Math.toDegrees(e.north)}}(),o=t.interval.lat,a=t.interval.lng,n=s.west,r=s.south,l=s.east,u=s.north;r=-(u=90),n=Math.floor(n/a)*a-a,l=Math.ceil(l/a)*a+a,r=Math.floor(-90/o)*o-a,u=Math.ceil(90/o)*o+o;l<n&&(l+=360);for(var p=n;p<=l;p+=a){var h=[];for(g=r;g<=u;g+=1)Math.abs(g)<=85&&h.push(p,g);0<h.length&&D.lines.lng.add({positions:Cesium.Cartesian3.fromDegreesArray(h),material:Cesium.Material.fromType("Color",{color:Cesium.Color.fromCssColorString(D.lineColor)}),width:i})}for(var c=0,g=r;g<=u;g+=o){h=[];for(c++,p=n;p<=l;p+=1)Math.abs(g)<=85&&h.push(p,g);0<h.length&&D.lines.lat.add({positions:Cesium.Cartesian3.fromDegreesArray(h),material:Cesium.Material.fromType("Color",{color:Cesium.Color.fromCssColorString(D.lineColor)}),width:i})}var d=function(e){var t=D.scene.canvas;return e=e||1,[D.camera.pickEllipsoid(new Cesium.Cartesian2(0,0),D.ellipsoid),D.camera.pickEllipsoid(new Cesium.Cartesian2(Math.ceil(t.width*e),0),D.ellipsoid),D.camera.pickEllipsoid(new Cesium.Cartesian2(0,Math.ceil(t.height*e)),D.ellipsoid),D.camera.pickEllipsoid(new Cesium.Cartesian2(Math.ceil(t.width*e),Math.ceil(t.height*e)),D.ellipsoid)]}(.85),m=0,f=0;void 0!==d[1]&&(b=Cesium.Cartographic.fromCartesian(d[1]),m=Cesium.Math.toDegrees(b.longitude)),void 0!==d[2]&&(y=Cesium.Cartographic.fromCartesian(d[2]),f=Cesium.Math.toDegrees(y.latitude));for(c=0;c<D.lines.lat.length;c++){var C=D.lines.lat.get(c),y=Cesium.Cartographic.fromCartesian(C.positions[0]),g=Cesium.Math.toDegrees(y.latitude);_(m,g,w(g,"lat"),!0,Cesium.Color.fromCssColorString(D.labelColor))}for(c=0;c<D.lines.lng.length;c++){var v=D.lines.lng.get(c),b=Cesium.Cartographic.fromCartesian(v.positions[0]),p=Cesium.Math.toDegrees(b.longitude);(!(D.span<25)||c%2==0)&&_(p,f,w(p,"lng"),!1,Cesium.Color.fromCssColorString(D.labelColor))}}}(e)}function _(e,t,i,s,o){D.scene.globe.ellipsoid;D.labels.add({position:Cesium.Cartesian3.fromDegrees(e,t),text:i+"",font:"14px  sans-serif",fillColor:o||Cesium.Color.fromBytes(255,255,255,255),outlineColor:o||Cesium.Color.fromBytes(255,255,255,255),style:Cesium.LabelStyle.FILL,scaleByDistance:new Cesium.NearFarScalar(1550,.8,55e6,1.5),horizontalOrigin:s?Cesium.VerticalOrigin.Left:Cesium.VerticalOrigin.RIGHT,verticalOrigin:s?Cesium.VerticalOrigin.TOP:Cesium.VerticalOrigin.BOTTOM,scale:1,show:D.labelVisible})}function w(e,t){var i="lng"===t?e<0?"W":"E":"lat"===t?e<0?"S":"N":"";e=Math.abs(e);var s=Math.floor(e),o=Math.floor(60*(e-s)),a=Math.round(3600*(e-s)%60);return 60==a&&(a=0,o++),60==o&&(o=0,s++),0==o&&0==a?i+s+"°":0==a?i+s+"°"+o+"'":i+s+"°"+o+"'"+a+'"'}this.setSpan=function(e){D.span=e,a&&(this.deactivate(),this.activate())},this.getSpan=function(e){return D.span},this.setLineColor=function(e){D.lineColor=e,a&&(this.deactivate(),this.activate())},this.setLabelColor=function(e){D.labelColor=e,a&&(this.deactivate(),this.activate())},this.setLablesVisible=function(e){D.labelVisible=e,a&&(this.deactivate(),this.activate())},this.activate=function(){if(a)return 0;a=!0;for(var e={},t=D.span,i=1;i<=30;i++){var s=Math.floor(16/i);3<s&&(s=3),s<1&&(s=1);var o={interval:{lat:t,lng:t},style:{width:s=1}},t=5<t?Math.round(10*t/2)/10:1<t?Math.round(100*t/2)/100:Math.round(1e4*t/2)/1e4;e[i]=o}S=e,D.lines.lng=D.scene.primitives.add(new Cesium.PolylineCollection),D.lines.lat=D.scene.primitives.add(new Cesium.PolylineCollection),D.points=D.scene.primitives.add(new Cesium.PointPrimitiveCollection),D.labels=D.scene.primitives.add(new Cesium.LabelCollection),n(),D.camera.changed.addEventListener(n)},this.deactivate=function(){D.camera.changed.removeEventListener(n),D.eventHandler=null,D.scene.primitives.remove(D.lines.lng),D.scene.primitives.remove(D.lines.lat),D.scene.primitives.remove(D.points),D.scene.primitives.remove(D.labels),D.lines={},D.points=null,D.labels=null,a=!1}},CgsInherits(CgsGraticuleLayer3D,CgsLayer3D),CgsGraticuleLayer3D.prototype.setMap=function(e){this.state.map=e},CgsGraticuleLayer3D.prototype.getMap=function(){return this.state.map},CgsGraticuleLayer3D.prototype.setName=function(e){this.state.name=e},CgsGraticuleLayer3D.prototype.getName=function(){return this.state.name},CgsGraticuleLayer3D.prototype.setText=function(e){this.state.text=e},CgsGraticuleLayer3D.prototype.getText=function(){return this.state.text},CgsGraticuleLayer3D.prototype.getId=function(){return this.state.id},CgsGraticuleLayer3D.prototype.setPId=function(e){this.state.pId=e},CgsGraticuleLayer3D.prototype.setPId=function(e){return this.state.pId},CgsGraticuleLayer3D.prototype.setVisible=function(e){this.state.visible!=e&&(this.state.visible=e,this.state.visible?this.activate():this.deactivate())},CgsGraticuleLayer3D.prototype.getVisible=function(){return this.state.visible},CgsGraticuleLayer3D.prototype.setLabelVisible=function(e){this.state.labelVisible!=e&&(this.state.labelVisible=e,this.setLablesVisible(e))},CgsGraticuleLayer3D.prototype.getLabelVisible=function(){return this.state.labelVisible},CgsGraticuleLayer3D.prototype.getType=function(){return this.state.type},CgsGraticuleLayer3D.prototype.getLineColor=function(){return this.state.lineColor},CgsGraticuleLayer3D.prototype.getLabelColor=function(){return this.state.labelColor},CgsGraticuleLayer3D.prototype.getSaveFlag=function(){return this.state.saveFlag},CgsGraticuleLayer3D.prototype.setSaveFlag=function(e){this.state.saveFlag=e},CgsParticle3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){if(this._position=Cesium.defaultValue(e.position,[-75,43,5e4]),this._rotate=Cesium.defaultValue(e.rotate,[0,0,0]),this._heading=this._rotate[0],this._pitch=this._rotate[1],this._roll=this._rotate[2],this._url=Cesium.defaultValue(e.url,void 0),!Cesium.defined(this._url))return"not explode url";var t=Cesium.defaultValue(e.bursts,void 0);if(this._bursts=t,!Cesium.defined(t)||Array.isArray(t)){if(this._bursts=[],Array.isArray(t))for(var i=t.length,s=0;s<i;++s){var o=t[s],a=o.time,n=o.minimum,r=o.maximum,l=new Cesium.ParticleBurst({time:a,minimum:n,maximum:r});this._bursts.push(l)}var u=this;this._rotation=Cesium.defaultValue(e.rotation,[0,0,0]),this._eHeading=this._rotation[0],this._ePitch=this._rotation[1],this._eRoll=this._rotation[2],this._translation=Cesium.defaultValue(e.translation,[0,0,0]),this._emitter=Cesium.defaultValue(e.emitter,CgsParticle3D.EMITTER_CIRCLE),this._startColor=Cesium.defaultValue(e.startColor,"rgba(255.0,255.0,255.0,1.0)"),this._endColor=Cesium.defaultValue(e.endColor,"rgba(255.0,255.0,255.0,1.0)"),this._rate=Cesium.defaultValue(e.rate,20),this._loop=Cesium.defaultValue(e.loop,!0),this._startScale=Cesium.defaultValue(e.startScale,1),this._endScale=Cesium.defaultValue(e.endScale,1),this._speed=Cesium.defaultValue(e.speed,void 0),this._minimumSpeed=Cesium.defaultValue(e.minSpeed,5),this._maximumSpeed=Cesium.defaultValue(e.maxSpeed,5),this._life=Cesium.defaultValue(e.life,void 0),this._minimumLife=Cesium.defaultValue(e.minLife,5),this._maximumLife=Cesium.defaultValue(e.maxLife,5),this._mass=Cesium.defaultValue(e.mass,void 0),this._minimumMass=Cesium.defaultValue(e.minMass,1),this._maximumMass=Cesium.defaultValue(e.maxMass,1),this._width=Cesium.defaultValue(e.width,void 0),this._minimumWidth=Cesium.defaultValue(e.minWidth,5),this._maximumWidth=Cesium.defaultValue(e.maxWidth,5),this._height=Cesium.defaultValue(e.height,void 0),this._minimumHeight=Cesium.defaultValue(e.minHeight,5),this._maximumHeight=Cesium.defaultValue(e.maxHeight,5),this._lifeTime=Cesium.defaultValue(e.lifeTime,16),this._radius=Cesium.defaultValue(e.radius,1),this._angle=Cesium.defaultValue(e.angle,30),this._dimensions=Cesium.defaultValue(e.dimensions,[1,1,1]),this._visibleDistance=Cesium.defaultValue(e.visibleDistance,[0,2e3]),this._scaleByDistance=Cesium.defaultValue(e.visibleDistance,[0,2e3]),this._translucencyByDistance=Cesium.defaultValue(e.visibleDistance,[0,2e3]);var p=void 0,h=void 0,c=void 0,c="[object Array]"==Object.prototype.toString.call(this._visibleDistance)?(p=new Cesium.DistanceDisplayCondition(this._visibleDistance[0],this._visibleDistance[1]),h=new Cesium.NearFarScalar(this._visibleDistance[0],1,this._visibleDistance[1],0),new Cesium.NearFarScalar(this._visibleDistance[0],1,this._visibleDistance[1],0)):(p=new Cesium.DistanceDisplayCondition(this._visibleDistance,Number.MAX_VALUE),h=new Cesium.NearFarScalar(this._visibleDistance,1,Number.MAX_VALUE,0),new Cesium.NearFarScalar(this._visibleDistance,1,Number.MAX_VALUE,0));this._modelMatrix=new Cesium.Matrix4;new Cesium.Matrix3;var g=Cesium.Cartesian3.fromDegrees(u._position[0],u._position[1],u._position[2]),d=Cesium.Matrix3.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(u._rotate[0],u._rotate[1],u._rotate[2]),new Cesium.Matrix3);u._modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(g,void 0,u._modelMatrix),this._modelMatrix=Cesium.Matrix4.multiplyByMatrix3(this._modelMatrix,d,new Cesium.Matrix4),this._emitterModelMatrix=new Cesium.Matrix4;var m=new Cesium.Cartesian3,f=new Cesium.Quaternion,C=new Cesium.HeadingPitchRoll,y=new Cesium.TranslationRotationScale,C=Cesium.HeadingPitchRoll.fromDegrees(u._eHeading-90,u._ePitch-90,u._eRoll,C);y.translation=Cesium.Cartesian3.fromElements(u._translation[0],u._translation[1],u._translation[2],m),y.rotation=Cesium.Quaternion.fromHeadingPitchRoll(C,f),Cesium.Matrix4.fromTranslationRotationScale(y,u._emitterModelMatrix),u._emitter==CgsParticle3D.EMITTER_BOX?this._emit=new Cesium.BoxEmitter(new Cesium.Cartesian3(u._dimensions[0],u._dimensions[1],u._dimensions[2])):u._emitter==CgsParticle3D.EMITTER_SPHERE?this._emit=new Cesium.SphereEmitter(u._radius):u._emitter==CgsParticle3D.EMITTER_CONE?this._emit=new Cesium.ConeEmitter(u._angle):this._emit=new Cesium.CircleEmitter(u._radius);var v,b,D,S,_,w,P,T,M,L,x,E,A,I,F,k,R,O;e.type===CgsParticleCollection3D.FIREWORKS&&(v=Cesium.defaultValue(e.xMin,-100),b=Cesium.defaultValue(e.xMax,100),D=Cesium.defaultValue(e.yMin,-80),S=Cesium.defaultValue(e.yMax,100),_=Cesium.defaultValue(e.zMin,-50),w=Cesium.defaultValue(e.zMax,50),this._xMin=v,this._xMax=b,this._yMin=D,this._yMax=S,this._zMin=_,this._zMax=w,P=Cesium.Math.randomBetween(v,b),T=Cesium.Math.randomBetween(D,S),M=Cesium.Math.randomBetween(_,w),L=new Cesium.Cartesian3(P,T,M),x=Cesium.defaultValue(e.emitterOffset,[0,0,0]),this._emitterOffset=x,E=new Cesium.Cartesian3(x[0],x[1],x[2]),A=new Cesium.Matrix4,I=Cesium.Cartesian3.add(E,L,new Cesium.Cartesian3),u._emitterModelMatrix=Cesium.Matrix4.fromTranslation(I,A),F=Cesium.Matrix4.multiply(u._modelMatrix,u._emitterModelMatrix,new Cesium.Matrix4),Cesium.Matrix4.inverseTransformation(F,F),k=Cesium.defaultValue(e.minExplosionSize,30),R=Cesium.defaultValue(e.maxExplosionSize,100),this._minExplosionSize=k,this._maxExplosionSize=R,O=(Cesium.Math.randomBetween(k,R)-k)/(R-k),u._life=O*(u._maximumLife-u._minimumLife)+u._minimumLife,new Cesium.Cartesian3,0);var V=Cesium.Cartesian2.fromArray([u._width,u._height]),G=Cesium.Cartesian2.fromArray([u._minimumWidth,u._minimumHeight]),B=Cesium.Cartesian2.fromArray([u._maximumWidth,u._maximumHeight]),H={show:u._show,emitter:u._emit,modelMatrix:u._modelMatrix,emitterModelMatrix:u._emitterModelMatrix,startColor:Cesium.Color.fromCssColorString(u._startColor),endColor:Cesium.Color.fromCssColorString(u._endColor),startScale:u._startScale,endScale:u._endScale,emissionRate:u._rate,loop:u._loop,speed:u._speed,minimumSpeed:u._minimumSpeed,maximumSpeed:u._maximumSpeed,particleLife:u._life,minimumParticleLife:u._minimumLife,maximumParticleLife:u._maximumLife,mass:u._mass,minimumMass:u._minimumMass,maximumMass:u._maximumMass,imageSize:V,minimumImageSize:G,maximumImageSize:B,lifetime:u._lifeTime,distanceDisplayCondition:p,translucencyByDistance:c,bursts:u._bursts};e.type!==CgsParticleCollection3D.EXPLODE&&e.type!==CgsParticleCollection3D.TAIL_FIRE||(H.image=CGS_SDK_PATH+u._url,H.scaleByDistance=h),e.type===CgsParticleCollection3D.TAIL_FIRE?H.realtime=!0:e.type===CgsParticleCollection3D.FIREWORKS&&(H.image=u._url),this._type=e.type,this._particle=new Cesium.CgsParticleSystem(H)}});var rtScratch=new Cesium.Matrix3,hprScratch=new Cesium.HeadingPitchRoll;CgsParticle3D.prototype._updatePositionRotate=function(){var e=Cesium.Cartesian3.fromDegrees(this._position[0],this._position[1],this._position[2]);return this._modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(e,void 0,this._modelMatrix),hprScratch=Cesium.Matrix3.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(this._heading),Cesium.Math.toRadians(this._pitch),Cesium.Math.toRadians(this._roll)),new Cesium.Matrix3),this._modelMatrix=Cesium.Matrix4.multiplyByMatrix3(this._modelMatrix,hprScratch,new Cesium.Matrix4),this._particle.modelMatrix=this._modelMatrix,this._modelMatrix};var translation=new Cesium.Cartesian3,rotation=new Cesium.Quaternion,ehpr=new Cesium.HeadingPitchRoll,etrs=new Cesium.TranslationRotationScale;CgsParticle3D.prototype._updateEmitterPositionRotate=function(){return ehpr=Cesium.HeadingPitchRoll.fromDegrees(this._eHeading-90,this._ePitch-90,this._eRoll,ehpr),etrs.translation=Cesium.Cartesian3.fromElements(this._translation[0],this._translation[1],this._translation[2],translation),etrs.rotation=Cesium.Quaternion.fromHeadingPitchRoll(ehpr,rotation),Cesium.Matrix4.fromTranslationRotationScale(etrs,this._emitterModelMatrix),this._particle.emitterModelMatrix=this._emitterModelMatrix,this._emitterModelMatrix},CgsParticle3D.prototype.setPosition=function(e){2==(this._position=e).length&&this._position.push(0),this._updatePositionRotate()},CgsParticle3D.prototype.getPosition=function(){return this._position},CgsParticle3D.prototype.setRotate=function(e){this._rotate=e,this._heading=this._rotate[0],this._pitch=this._rotate[1],this._roll=this._rotate[2],3==e.length&&this._updatePositionRotate()},CgsParticle3D.prototype.getRotate=function(){return this._rotate},CgsParticle3D.prototype.setHeading=function(e){this._heading=e,this._rotate[0]=e,this._updatePositionRotate()},CgsParticle3D.prototype.getHeading=function(){return this._heading},CgsParticle3D.prototype.setPitch=function(e){this._pitch=e,this._rotate[1]=e,this._updatePositionRotate()},CgsParticle3D.prototype.getPitch=function(){return this._pitch},CgsParticle3D.prototype.setRoll=function(e){this._roll=e,this._rotate[2]=e,this._updatePositionRotate()},CgsParticle3D.prototype.getRoll=function(){return this._roll},CgsParticle3D.prototype.setTranslation=function(e){this._translation=e,this._updateEmitterPositionRotate()},CgsParticle3D.prototype.getTranslation=function(){return this._translation},CgsParticle3D.prototype.setEmitterRotation=function(e){3==e.length&&(this._rotation=e,this._eHeading=e[0],this._ePitch=e[1],this._eRoll=e[2],this._updateEmitterPositionRotate())},CgsParticle3D.prototype.getEmitterRotation=function(){return this._rotation},CgsParticle3D.prototype._updateEmitter=function(){this._emitter==CgsParticle3D.EMITTER_BOX?this._emit=new Cesium.BoxEmitter(new Cesium.Cartesian3(this._dimensions[0],this._dimensions[1],this._dimensions[2])):this._emitter==CgsParticle3D.EMITTER_SPHERE?this._emit=new Cesium.SphereEmitter(this._radius):this._emitter==CgsParticle3D.EMITTER_CONE?this._emit=new Cesium.ConeEmitter(this._angle):this._emit=new Cesium.CircleEmitter(this._radius),this._particle.emitter=this._emit},CgsParticle3D.prototype.setEmitter=function(e){this._emitter=e,this._updateEmitter()},CgsParticle3D.prototype.getEmitter=function(){return this._emitter},CgsParticle3D.prototype.setDimensions=function(e){this._dimensions=e,this._updateEmitter()},CgsParticle3D.prototype.getDimensions=function(){return this._dimensions},CgsParticle3D.prototype.setAngle=function(e){this._angle=e,this._updateEmitter()},CgsParticle3D.prototype.getAngle=function(){return this._angle},CgsParticle3D.prototype.setRadius=function(e){this._radius=e,this._updateEmitter()},CgsParticle3D.prototype.getRadius=function(){return this._radius},CgsParticle3D.prototype.setStartColor=function(e){this._startColor=e,this._particle.startColor=Cesium.Color.fromCssColorString(this._startColor)},CgsParticle3D.prototype.getStartColor=function(){return this._startColor},CgsParticle3D.prototype.setEndColor=function(e){this._endColor=e,this._particle.endColor=Cesium.Color.fromCssColorString(this._endColor)},CgsParticle3D.prototype.getEndColor=function(){return this._endColor},CgsParticle3D.prototype.setStartScale=function(e){this._startScale=e,this._particle.startScale=this._startScale},CgsParticle3D.prototype.getStartScale=function(){return this._startScale},CgsParticle3D.prototype.setEndScale=function(e){this._endScale=e,this._particle.endScale=this._endScale},CgsParticle3D.prototype.getEndScale=function(){return this._endScale},CgsParticle3D.prototype.setRate=function(e){this._rate=e,this._particle.emissionRate=this._rate},CgsParticle3D.prototype.getRate=function(){return this._rate},CgsParticle3D.prototype.setLoop=function(e){this._loop=e,this._particle.loop=this._loop},CgsParticle3D.prototype.getLoop=function(){return this._loop},CgsParticle3D.prototype.setSpeed=function(e){this._speed=e,this._particle.speed=this._speed},CgsParticle3D.prototype.getSpeed=function(){return this._speed},CgsParticle3D.prototype.setMinSpeed=function(e){this._minimumSpeed=e,this._particle.minimumSpeed=this._minimumSpeed},CgsParticle3D.prototype.getMinSpeed=function(){return this._minimumSpeed},CgsParticle3D.prototype.setMaxSpeed=function(e){this._maximumSpeed=e,this._particle.maximumSpeed=this._maximumSpeed},CgsParticle3D.prototype.getMaxSpeed=function(){return this._maximumSpeed},CgsParticle3D.prototype.setLife=function(e){this._life=e,this._particle.particleLife=this._life},CgsParticle3D.prototype.getLife=function(){return this._life},CgsParticle3D.prototype.setMinLife=function(e){this._minimumLife=e,this._particle.minimumParticleLife=this._minimumLife},CgsParticle3D.prototype.getMinLife=function(){return this._minimumLife},CgsParticle3D.prototype.setMaxLife=function(e){this._maximumLife=e,this._particle.maximumParticleLife=this._maximumLife},CgsParticle3D.prototype.getMaxLife=function(){return this._maximumLife},CgsParticle3D.prototype.setMass=function(e){this._mass=e,this._particle.mass=this._mass},CgsParticle3D.prototype.getMass=function(){return this._mass},CgsParticle3D.prototype.setMinMass=function(e){this._minimumMass=e,this._particle.minimumMass=this._minimumMass},CgsParticle3D.prototype.getMinMass=function(){return this._minimumMass},CgsParticle3D.prototype.setMaxMass=function(e){this._maximumMass=e,this._particle.maximumMass=this._maximumMass},CgsParticle3D.prototype.getMaxMass=function(){return this._maximumMass},CgsParticle3D.prototype.setUrl=function(e){this._url=e,this._particle.image=this._url},CgsParticle3D.prototype.getUrl=function(){return this._url},CgsParticle3D.prototype.setWidth=function(e){this._width=e,this._particle.imageSize.x=this._width},CgsParticle3D.prototype.getWidth=function(){return this._width},CgsParticle3D.prototype.setMinWidth=function(e){this._minimumWidth=e,this._particle.minimumImageSize.x=this._minimumWidth},CgsParticle3D.prototype.getMinWidth=function(){return this._minimumWidth},CgsParticle3D.prototype.setMaxWidth=function(e){this._maximumWidth=e,this._particle.maximumImageSize.x=this._maximumWidth},CgsParticle3D.prototype.getMaxWidth=function(){return this._maximumWidth},CgsParticle3D.prototype.setHeight=function(e){this._height=e,this._particle.imageSize.y=this._height},CgsParticle3D.prototype.getHeight=function(){return this._height},CgsParticle3D.prototype.setMinHeight=function(e){this._minimumHeight=e,this._particle.minimumImageSize.y=this._minimumHeight},CgsParticle3D.prototype.getMinHeight=function(){return this._minimumHeight},CgsParticle3D.prototype.setMaxHeight=function(e){this._maximumHeight=e,this._particle.maximumImageSize.y=this._maximumHeight},CgsParticle3D.prototype.getMaxHeight=function(){return this._maximumHeight},CgsParticle3D.prototype.setLifeTime=function(e){this._lifeTime=e,this._particle.lifetime=this._lifeTime},CgsParticle3D.prototype.getLifeTime=function(){return this._lifeTime},CgsParticle3D.prototype.setVisibleHeight=function(e){this._visibleDistance=e,"[object Array]"==Object.prototype.toString.call(e)?(this._particle.distanceDisplayCondition=new Cesium.DistanceDisplayCondition(e[0],e[1]),this._particle.scaleByDistance=new Cesium.NearFarScalar(e[0],1,e[1],0),this._particle.translucencyByDistance=new Cesium.NearFarScalar(e[0],1,e[1],0)):(this._particle.distanceDisplayCondition=new Cesium.DistanceDisplayCondition(e),this._particle.scaleByDistance=new Cesium.NearFarScalar(e,1,Number.MAX_VALUE,0),this._particle.translucencyByDistance=new Cesium.NearFarScalar(e,1,Number.MAX_VALUE,0))},CgsParticle3D.prototype.getVisibleHeight=function(){return this._visibleDistance},CgsParticle3D.prototype.setVisible=function(e){this._particle.show=e},CgsParticle3D.EMITTER_BOX="box",CgsParticle3D.EMITTER_CIRCLE="circle",CgsParticle3D.EMITTER_CONE="cone",CgsParticle3D.EMITTER_SPHERE="sphere",CgsParticle3D.prototype.getBursts=function(e){return this._bursts},CgsParticle3D.prototype.getType=function(){return this._type},CgsParticle3D.prototype.getXMin=function(){return this._xMin},CgsParticle3D.prototype.getXMax=function(){return this._xMax},CgsParticle3D.prototype.getYMin=function(){return this._yMin},CgsParticle3D.prototype.getYMax=function(){return this._yMax},CgsParticle3D.prototype.getZMin=function(){return this._zMin},CgsParticle3D.prototype.getZMax=function(){return this._zMax},CgsParticle3D.prototype.getEmitterOffset=function(){return this._emitterOffset},CgsParticle3D.prototype.getMinExplosionSize=function(){return this._minExplosionSize},CgsParticle3D.prototype.getMaxExplosionSize=function(){return this._maxExplosionSize},CgsParticleCollection3D=function(e){this._show=Cesium.defaultValue(e.show,!0),this._particleCollection=new Cesium.PrimitiveCollection,this._map=void 0,this._type=void 0},CgsParticleCollection3D.prototype.getParticleCollection=function(){return this._particleCollection},CgsParticleCollection3D.prototype.setVisible=function(e){this._show=e,this._particleCollection.show=e},CgsParticleCollection3D.prototype.getVisible=function(){return this._show},CgsParticleCollection3D.prototype.setMap=function(e){this._map=e},CgsParticleCollection3D.prototype.getMap=function(){return this._map},CgsParticleCollection3D.prototype.get=function(e){return this._particleCollection.get(e)},CgsParticleCollection3D.prototype.getType=function(){return this._type},CgsParticleCollection3D.prototype.getId=function(){},CgsParticleCollection3D.EXPLODE="explode",CgsParticleCollection3D.FIREWORKS="fireworks",CgsParticleCollection3D.TAIL_FIRE="tailfire",CgsExplode3D=function(e){this._position=Cesium.defaultValue(e.position,[-75,43,5e4]),CgsParticleCollection3D.call(this,e),this._type="explode",this._show=Cesium.defaultValue(e.show,!0),this._saveFlag=Cesium.defaultValue(e.saveFlag,!0),this._particles=[];var t=e.particles;if(Cesium.defined(t)&&Array.isArray(t))for(var i=t.length,s=0;s<i;++s){var o=t[s];o.position=e.position,o.type=this._type;var a=new CgsParticle3D(o);this._particles.push(a),this._particleCollection.add(a._particle)}else console.info(" not defined particles")},CgsInherits(CgsExplode3D,CgsParticleCollection3D),CgsExplode3D.prototype.setPosition=function(e){2==(this._position=e).length&&this._position.push(0);for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setPosition(e)}},CgsExplode3D.prototype.getPosition=function(){return this._position},CgsExplode3D.prototype.getRotate=function(e){return void 0===e?this._particles[0].getEmitterRotation():e<=this._particles.length-1&&0<=e?this._particles[e].getEmitterRotation():void 0},CgsExplode3D.prototype.setTranslation=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setTranslation(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setTranslation(e)},CgsExplode3D.prototype.getTranslation=function(e){return void 0===e?this._particles[0].getTranslation():e<=this._particles.length-1&&0<=e?this._particles[e].getTranslation():void 0},CgsExplode3D.prototype.setRotation=function(e,t){if(3==e.length)if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setEmitterRotation(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setEmitterRotation(e)},CgsExplode3D.prototype.getRotation=function(e){return void 0===e?this._particles[0].getEmitterRotation():e<=this._particles.length-1&&0<=e?this._particles[e].getEmitterRotation():void 0},CgsExplode3D.prototype.setEmitter=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setEmitter(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setEmitter(e)},CgsExplode3D.prototype.getEmitter=function(e){return void 0===e?this._particles[0].getEmitter():e<=this._particles.length-1&&0<=e?this._particles[e].getEmitter():void 0},CgsExplode3D.prototype.setDimensions=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setDimensions(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setDimensions(e)},CgsExplode3D.prototype.getDimensions=function(e){return void 0===e?this._particles[0].getDimensions():e<=this._particles.length-1&&0<=e?this._particles[e].getDimensions():void 0},CgsExplode3D.prototype.setAngle=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setAngle(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setAngle(e)},CgsExplode3D.prototype.getAngle=function(e){return void 0===e?this._particles[0].getAngle():e<=this._particles.length-1&&0<=e?this._particles[e].getAngle():void 0},CgsExplode3D.prototype.setRadius=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setRadius(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setRadius(e)},CgsExplode3D.prototype.getRadius=function(e){return void 0===e?this._particles[0].getRadius():e<=this._particles.length-1&&0<=e?this._particles[e].getRadius():void 0},CgsExplode3D.prototype.setStartColor=function(e,t){if(this._startColor=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setStartColor(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setStartColor(e)},CgsExplode3D.prototype.getStartColor=function(e){return void 0===e?this._particles[0].getStartColor():e<=this._particles.length-1&&0<=e?this._particles[e].getStartColor():void 0},CgsExplode3D.prototype.setEndColor=function(e,t){if(this._endColor=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setEndColor(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setEndColor(e)},CgsExplode3D.prototype.getEndColor=function(e){return void 0===e?this._particles[0].getEndColor():e<=this._particles.length-1&&0<=e?this._particles[e].getEndColor():void 0},CgsExplode3D.prototype.setStartScale=function(e,t){if(this._startScale=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setStartScale(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setStartScale(e)},CgsExplode3D.prototype.getStartScale=function(e){return void 0===e?this._particles[0].getStartScale():e<=this._particles.length-1&&0<=e?this._particles[e].getStartScale():void 0},CgsExplode3D.prototype.setEndScale=function(e,t){if(this._endScale=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setEndScale(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setEndScale(e)},CgsExplode3D.prototype.getEndScale=function(e){return void 0===e?this._particles[0].getEndScale():e<=this._particles.length-1&&0<=e?this._particles[e].getEndScale():void 0},CgsExplode3D.prototype.setRate=function(e,t){if(this._rate=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setRate(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setRate(e)},CgsExplode3D.prototype.getRate=function(e){return void 0===e?this._particles[0].getRate():e<=this._particles.length-1&&0<=e?this._particles[e].getRate():void 0},CgsExplode3D.prototype.setLoop=function(e,t){if(this._loop=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setLoop(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setLoop(e)},CgsExplode3D.prototype.getLoop=function(e){return void 0===e?this._particles[0].getLoop():e<=this._particles.length-1&&0<=e?this._particles[e].getLoop():void 0},CgsExplode3D.prototype.setSpeed=function(e,t){if(this._speed=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setSpeed(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setSpeed(e)},CgsExplode3D.prototype.getSpeed=function(e){return void 0===e?this._particles[0].getSpeed():e<=this._particles.length-1&&0<=e?this._particles[e].getSpeed():void 0},CgsExplode3D.prototype.setMinSpeed=function(e,t){if(this._minimumSpeed=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMinSpeed(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMinSpeed(e)},CgsExplode3D.prototype.getMinSpeed=function(e){return void 0===e?this._particles[0].getMinSpeed():e<=this._particles.length-1&&0<=e?this._particles[e].getMinSpeed():void 0},CgsExplode3D.prototype.setMaxSpeed=function(e,t){if(this._maximumSpeed=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxSpeed(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMaxSpeed(e)},CgsExplode3D.prototype.getMaxSpeed=function(e){return void 0===e?this._particles[0].getMaxSpeed():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxSpeed():void 0},CgsExplode3D.prototype.setLife=function(e,t){if(this._life=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setLife(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setLife(e)},CgsExplode3D.prototype.getLife=function(e){return void 0===e?this._particles[0].getLife():e<=this._particles.length-1&&0<=e?this._particles[e].getLife():void 0},CgsExplode3D.prototype.setMinLife=function(e,t){if(this._minimumLife=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMinLife(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMinLife(e)},CgsExplode3D.prototype.getMinLife=function(e){return void 0===e?this._particles[0].getMinLife():e<=this._particles.length-1&&0<=e?this._particles[e].getMinLife():void 0},CgsExplode3D.prototype.setMaxLife=function(e,t){if(this._maximumLife=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxLife(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMaxLife(e)},CgsExplode3D.prototype.getMaxLife=function(e){return void 0===e?this._particles[0].getMaxLife():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxLife():void 0},CgsExplode3D.prototype.setMass=function(e,t){if(this._mass=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMass(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMass(e)},CgsExplode3D.prototype.getMass=function(e){return void 0===e?this._particles[0].getMass():e<=this._particles.length-1&&0<=e?this._particles[e].getMass():void 0},CgsExplode3D.prototype.setMinMass=function(e,t){if(this._minimumMass=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMinMass(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMinMass(e)},CgsExplode3D.prototype.getMinMass=function(e){return void 0===e?this._particles[0].getMinMass():e<=this._particles.length-1&&0<=e?this._particles[e].getMinMass():void 0},CgsExplode3D.prototype.setMaxMass=function(e,t){if(this._maximumLife=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxMass(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMaxMass(e)},CgsExplode3D.prototype.getMaxMass=function(e){return void 0===e?this._particles[0].getMaxMass():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxMass():void 0},CgsExplode3D.prototype.setImage=function(e,t){if(this._url=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setUrl(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setUrl(e)},CgsExplode3D.prototype.getImage=function(e){return void 0===e?this._particles[0].getUrl():e<=this._particles.length-1&&0<=e?this._particles[e].getUrl():void 0},CgsExplode3D.prototype.setWidth=function(e,t){if(this._width=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setWidth(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setWidth(e)},CgsExplode3D.prototype.getWidth=function(e){return void 0===e?this._particles[0].getWidth():e<=this._particles.length-1&&0<=e?this._particles[e].getWidth():void 0},CgsExplode3D.prototype.setMinWidth=function(e,t){if(this._minimumWidth=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMinWidth(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMinWidth(e)},CgsExplode3D.prototype.getMinWidth=function(e){return void 0===e?this._particles[0].getMinWidth():e<=this._particles.length-1&&0<=e?this._particles[e].getMinWidth():void 0},CgsExplode3D.prototype.setMaxWidth=function(e,t){if(this._maximumWidth=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxWidth(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMaxWidth(e)},CgsExplode3D.prototype.getMaxWidth=function(e){return void 0===e?this._particles[0].getMaxWidth():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxWidth():void 0},CgsExplode3D.prototype.setHeight=function(e,t){if(this._height=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setHeight(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setHeight(e)},CgsExplode3D.prototype.getHeight=function(e){return void 0===e?this._particles[0].getHeight():e<=this._particles.length-1&&0<=e?this._particles[e].getHeight():void 0},CgsExplode3D.prototype.setMinHeight=function(e,t){if(this._minimumHeight=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMinHeight(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMinHeight(e)},CgsExplode3D.prototype.getMinHeight=function(e){return void 0===e?this._particles[0].getMinHeight():e<=this._particles.length-1&&0<=e?this._particles[e].getMinHeight():void 0},CgsExplode3D.prototype.setMaxHeight=function(e,t){if(this._maximumHeight=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxHeight(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMaxHeight(e)},CgsExplode3D.prototype.getMaxHeight=function(e){return void 0===e?this._particles[0].getMaxHeight():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxHeight():void 0},CgsExplode3D.prototype.setLifeTime=function(e,t){if(this._lifeTime=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setLifeTime(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setLifeTime(e)},CgsExplode3D.prototype.getLifeTime=function(e){return void 0===e?this._particles[0].getLifeTime():e<=this._particles.length-1&&0<=e?this._particles[e].getLifeTime():void 0},CgsExplode3D.prototype.setVisibleHeight=function(e,t){if(this._visibleDistance=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setVisibleHeight(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setVisibleHeight(e)},CgsExplode3D.prototype.getVisibleHeight=function(e){return void 0===e?this._particles[0].getVisibleHeight():e<=this._particles.length-1&&0<=e?this._particles[e].getVisibleHeight():void 0},CgsExplode3D.prototype.setVisible=function(e){this._show=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setVisible(e)}},CgsExplode3D.prototype.getVisible=function(){return this._show},CgsExplode3D.prototype.getParticles=function(){return this._particles},CgsExplode3D.prototype.getBursts=function(e){return void 0===e?this._particles[0].getBursts():e<=this._particles.length-1&&0<=e?this._particles[e].getBursts():void 0},CgsExplode3D.prototype.getType=function(e){return void 0===e?this._particles[0].getType():e<=this._particles.length-1&&0<=e?this._particles[e].getType():void 0},CgsExplode3D.prototype.getXMin=function(e){return void 0===e?this._particles[0].getXMin():e<=this._particles.length-1&&0<=e?this._particles[e].getXMin():void 0},CgsExplode3D.prototype.getXMax=function(e){return void 0===e?this._particles[0].getXMax():e<=this._particles.length-1&&0<=e?this._particles[e].getXMax():void 0},CgsExplode3D.prototype.getYMin=function(e){return void 0===e?this._particles[0].getYMin():e<=this._particles.length-1&&0<=e?this._particles[e].getYMin():void 0},CgsExplode3D.prototype.getYMax=function(e){return void 0===e?this._particles[0].getYMax():e<=this._particles.length-1&&0<=e?this._particles[e].getYMax():void 0},CgsExplode3D.prototype.getZMin=function(e){return void 0===e?this._particles[0].getZMin():e<=this._particles.length-1&&0<=e?this._particles[e].getZMin():void 0},CgsExplode3D.prototype.getZMax=function(e){return void 0===e?this._particles[0].getZMax():e<=this._particles.length-1&&0<=e?this._particles[e].getZMax():void 0},CgsExplode3D.prototype.getEmitterOffset=function(e){return void 0===e?this._particles[0].getEmitterOffset():e<=this._particles.length-1&&0<=e?this._particles[e].getEmitterOffset():void 0},CgsExplode3D.prototype.getMinExplosionSize=function(e){return void 0===e?this._particles[0].getMinExplosionSize():e<=this._particles.length-1&&0<=e?this._particles[e].getMinExplosionSize():void 0},CgsExplode3D.prototype.getMaxExplosionSize=function(e){return void 0===e?this._particles[0].getMaxExplosionSize():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxExplosionSize():void 0},CgsExplode3D.prototype.getSelfType=function(){return"CgsExplode"},CgsExplode3D.prototype.getSaveFlag=function(){return this._saveFlag},CgsExplode3D.prototype.setSaveFlag=function(e){return this._saveFlag=e},Cgs3DTileset3D=function(e,t,i){var s;Cesium.defined(e.url)&&""!==e.url&&(i&&(this.specialAffectsData=i),this.specialAffectsState=Cesium.defaultValue(e.specialAffectsState,void 0),this.positionNew=Cesium.defaultValue(e.positionNew,void 0),this.id=Date.now(),this.newMap=t,this.attrName=e.attrName,this.url=Cesium.defaultValue(e.url,""),this.show=Cesium.defaultValue(e.show,!0),this.modelMatrix=Cesium.defaultValue(e.modelMatrix,Cesium.Matrix4.IDENTITY),this.shadow=Cesium.defaultValue(e.shadow,Cgs3DTileset.ShadowMode_ENABLED),this.showWire=Cesium.defaultValue(e.showWire,!1),this.showBounding=Cesium.defaultValue(e.showBounding,!1),this.selectColor=Cesium.defaultValue(e.selectColor,"rgba(0.0,255.0,255.0,1.0)"),this.highlightColor=Cesium.defaultValue(e.highlightColor,"rgba(255.0,255.0,0.0,1.0)"),this.locate=Cesium.defaultValue(e.locate,!1),this.success=!1,this.baseColor=Cesium.defaultValue(e.baseColor,"rgba(255.0,255.0,255.0,1.0)"),this.heightColorTable=Cesium.defaultValue(e.heightColorTable,[]),this.enableSelected=Cesium.defaultValue(e.enableSelected,!1),this.offsetHeight=Cesium.defaultValue(e.offsetHeight,0),this.saveFlag=Cesium.defaultValue(e.saveFlag,!0),this.maximumScreenSpaceError=Cesium.defaultValue(e.maximumScreenSpaceError,16),this.immediatelyLoadDesiredLevelOfDetail=Cesium.defaultValue(e.immediatelyLoadDesiredLevelOfDetail,!1),this.maximumMemoryUsage=Cesium.defaultValue(e.maximumMemoryUsage,512),this.cullWithChildrenBounds=Cesium.defaultValue(e.cullWithChildrenBounds,!0),this.dynamicScreenSpaceError=Cesium.defaultValue(e.dynamicScreenSpaceError,!1),this.skipLevelOfDetail=Cesium.defaultValue(e.skipLevelOfDetail,!0),this.skipLevels=Cesium.defaultValue(e.skipLevels,1),this.clippingPlanes=Cesium.defaultValue(e.clippingPlanes,void 0),this.type="3dTileset",this.selfType="Cgs3DTileset",this.curFeature=void 0,this.curHighlightFeature=void 0,this.map=void 0,this.proxy=CgsUtil.getProxyURL(e.proxy),this.proxy=this.proxy?new Cesium.DefaultProxy(this.proxy):null,this.analyzeStatus=Cesium.defaultValue(e.analyzeStatus,!1),this.analyzeTag=Cesium.defaultValue(e.analyzeTag,null),this.analyzeTagName=Cesium.defaultValue(e.analyzeTagName,null),this.analyzeNodeData=Cesium.defaultValue(e.analyzeNodeData,null),this.CallBackFun=Cesium.defaultValue(e.CallBackFun,null),this.CallBackTag=Cesium.defaultValue(e.CallBackTag,null),this.CallBackState=Cesium.defaultValue(e.CallBackState,!1),this.analyzePointArr=[],this.pointTagArr=[],this.specialAffects=e.specialAffects,s={url:new Cesium.Resource({url:this.url,proxy:this.proxy}),show:this.show,modelMatrix:this.modelMatrix,shadows:this.shadow,debugWireframe:this.showWire,debugShowBoundingVolume:this.showBounding,maximumScreenSpaceError:this.maximumScreenSpaceError,immediatelyLoadDesiredLevelOfDetail:this.immediatelyLoadDesiredLevelOfDetail,maximumMemoryUsage:this.maximumMemoryUsage,cullWithChildrenBounds:this.cullWithChildrenBounds,dynamicScreenSpaceError:this.dynamicScreenSpaceError,skipLevelOfDetail:this.skipLevelOfDetail,maximumNumberOfLoadedTiles:3e4,skipLevels:this.skipLevels,onError:e.onError},this.overlayDiv=void 0,this.tileset=new Cesium.Cesium3DTileset(s),this.tileset.id=this.id,null!=this.positionNew&&this.setPositionNew(this.positionNew),this.setBaseColor(this.baseColor))},Cgs3DTileset3D.prototype.setBaseColor=function(e){return this.tileset&&null!=e&&null!=e&&""!=e?(this.tileset.style=new Cesium.Cesium3DTileStyle({color:'color("'+e+'")'}),this.baseColor=e):void(this.tileset.style=new Cesium.Cesium3DTileStyle({color:'color("rgb(255, 255, 255)")'}))},Cgs3DTileset3D.prototype.changeMatrix=function(t){var i=0,s=0,o=0,a=0,n=setInterval(function(){var e;a<60?(a++,i-=.5,s--,o++,e=Cesium.Cartesian3.fromArray([i,s,o]),t.modelMatrix=Cesium.Matrix4.fromTranslation(e)):clearInterval(n)},5)},Cgs3DTileset3D.prototype.setCallBackStyle=function(e){var t,i="",s=[];for(t in this.CallBackTag)s.push(t);for(var o=0;o<s.length;o++)i=o==s.length-1?i+"${"+s[o]+"} ==='"+this.CallBackTag[s[o]]+"'":i+"${"+s[o]+"} ==='"+this.CallBackTag[s[o]]+"'||";this.tileset.style=new Cesium.Cesium3DTileStyle({color:{conditions:[[i,"rgb(122, 122, 122)"],["true","rgba(255, 255, 255,0.03)"]]}})},Cgs3DTileset3D.prototype.setAttrStyle=function(e){for(var t="",i=0;i<this.attrName.length;i++)var s=this.attrName[i],o=e[0].valueName,t=i==this.attrName.length-1?t+"${"+s+"} ==='"+o+"'":t+"${"+s+"} ==='"+o+"'||";null!=this.specialAffects&&0!=this.specialAffects&&null!=this.specialAffects&&""!=this.specialAffects?(this.tileset.style=new Cesium.Cesium3DTileStyle({show:{conditions:[[t,"false"],["true","true"]]},color:{conditions:[[t,"false"],["true","rgba(255,255,255,0.3)"]]}}),this.specialAffectsData&&(this.specialAffectsData.feature3D.tileset.style=new Cesium.Cesium3DTileStyle({show:{conditions:[[t,"true"],["true","false"]]},color:{conditions:[[t,"rgba(255,255,255,1)"],["true","false"]]}}),this.specialAffectsData.feature3D.tileset.show=!0,this.changeMatrix(this.specialAffectsData.feature3D.tileset))):this.enableSelected?this.tileset.style=new Cesium.Cesium3DTileStyle({color:{conditions:[[t,"color('"+this.selectColor+"')"],["true","rgba(255, 255, 255,0.03)"]]}}):this.tileset.style=new Cesium.Cesium3DTileStyle({color:{conditions:[[t,"rgb(255, 255, 255)"],["true","rgba(255, 255, 255,0.03)"]]}})},Cgs3DTileset3D.prototype._setEvents=function(){var y=this,v={feature:void 0,originalColor:new Cesium.Color},b={feature:void 0,originalColor:new Cesium.Color};this.mousemoveEvent=CgsSubPub.subscribe("mousemove",function(e,t){var i,s=y.map;Cesium.defined(s)&&y.success&&(y.enableSelected?(Cesium.defined(b.feature)&&(b.feature.color=b.originalColor,b.feature=void 0,y.curHighlightFeature=void 0),i=s.scene.pick(t),Cesium.defined(i)&&i instanceof Cesium.Cesium3DTileFeature&&i!==v.feature&&(b.feature=i,Cesium.Color.clone(i.color,b.originalColor),i.color=Cesium.Color.fromCssColorString(y.highlightColor),y.curHighlightFeature=i)):b.feature&&(b.feature.color=Cesium.Color.fromCssColorString("rgba(255,255,255,1.0)")))}),this.leftdownEvent=CgsSubPub.subscribe("leftdown",function(e,t){var i=y.map;if(null!=y.overlayDiv&&null!=y.overlayDiv&&""!=y.overlayDiv&&(y.newMap.removeOverlay(y.overlayDiv),y.setBaseColor(y.baseColor)),y.specialAffectsData&&(y.specialAffectsData.feature3D.tileset.style=new Cesium.Cesium3DTileStyle({show:{conditions:[["true","false"]]}})),Cesium.defined(i)&&y.success)if(y.enableSelected){var s=i.scene.pick(t);if(Cesium.defined(s)&&s instanceof Cesium.Cesium3DTileFeature){if(v.feature===s)return v.feature.color=v.originalColor,v.feature=void 0,void(y.curFeature=void 0);Cesium.defined(v.feature)&&(v.feature.color=v.originalColor,v.feature=void 0,y.curFeature=void 0),(v.feature=s)===b.feature?(Cesium.Color.clone(b.originalColor,v.originalColor),b.feature=void 0):Cesium.Color.clone(s.color,v.originalColor),s.color=Cesium.Color.fromCssColorString(y.selectColor);var o=(y.curFeature=s).getPropertyNames();if(y.analyzeStatus){if(o.includes(y.analyzeTag)&&s.getProperty(y.analyzeTag).includes(y.analyzeTagName)){positionNew=CgsUtil.getLonLatFromMousePosition(y.map,t,{format0Length:10});var a={position:[Number(positionNew.lon),Number(positionNew.lat),y.offsetHeight],particles:[{url:"assets/image/particle/water.png",startColor:"rgba(255.0,255.0,255.0,0.3)",endColor:"rgba(255.0,255.0,255.0,0.7)",rate:50,startScale:1,endScale:10,rotation:[0,100,0],width:20,height:20}]},n=new CgsExplode(a);n.setVisible(!0),y.newMap.addFeature(n),y.analyzePointArr.push(n);s.getProperty("id");for(var r="",l=0;l<s.content.featuresLength;l++){var u=s.content.getFeature(l).getProperty(y.analyzeTag);u.includes(y.analyzeTagName)&&(y.pointTagArr.includes(u)||y.pointTagArr.push(u))}for(var p=0;p<y.pointTagArr.length;p++)r=p==y.pointTagArr.length-1?r+"${"+y.analyzeTag+"} ==='"+y.pointTagArr[p]+"'":r+"${"+y.analyzeTag+"} ==='"+y.pointTagArr[p]+"'||";y.tileset.style=new Cesium.Cesium3DTileStyle({color:{conditions:[[r,"rgb(0, 0, 0)"],["true","rgba(255, 255, 255,1)"]]}})}}else{for(var h=[],c="<div class = 'infoPop'>",g=!1,d=0;d<o.length;d++){var m=o[d],f=s.getProperty(m);if(null!=f&&0!=f&&null!=f&&""!=f&&(c+="<div class='infoPop__line'><span>"+m+"："+f+"</span> </div>",null!=y.attrName&&0!=y.attrName&&null!=y.attrName&&""!=y.attrName))for(var C=0;C<y.attrName.length;C++)null!=y.attrName[C]&&""!=y.attrName[C]&&null!=y.attrName[C]&&m==y.attrName[C]&&h.push({element:m,valueName:f});d==o.length-1&&(c+="</div>",null!=y.attrName&&0!=y.attrName&&null!=y.attrName&&""!=y.attrName&&y.setAttrStyle(h))}y.CallBackState&&y.id===s.tileset.id&&(g=!0),positionNew=CgsUtil.windowCoordinateToLonLatAlt(y.newMap,t),g&&y.CallBackFun(s),y.CallBackState||(y.overlayDiv=new CgsOverlay({position:positionNew,positioning:"top-right",element:$$(c).get(0),offset:[0,0],draggable:!0,showLine:!0}),this.overlayDiv=y.overlayDiv,y.newMap.addOverlay(y.overlayDiv),y.specialAffectsData&&y.newMap.removeOverlay(y.overlayDiv))}}}else v.feature&&(v.feature.color=Cesium.Color.fromCssColorString("rgba(255,255,255,1.0)"))})},Cgs3DTileset3D.prototype._unsetEvents=function(){CgsSubPub.unsubscribe(this.mousemoveEvent),CgsSubPub.unsubscribe(this.leftdownEvent),CgsSubPub.unsubscribe(this.rightdownEvent)},Cgs3DTileset3D.prototype.setMap=function(e){this.map=e},Cgs3DTileset3D.prototype.getMap=function(){return this.map},Cgs3DTileset3D.prototype.getTileset=function(){return this.tileset},Cgs3DTileset3D.prototype.getLocateFlag=function(){return this.locate},Cgs3DTileset3D.prototype.getType=function(){return this.type},Cgs3DTileset3D.prototype.setSuccessFlag=function(e){this.success=e},Cgs3DTileset3D.prototype.getSuccessFlag=function(){return this.success},Cgs3DTileset3D.prototype.setVisible=function(e){this.show=e,this.tileset.show=e},Cgs3DTileset3D.prototype.getVisible=function(){return this.show},Cgs3DTileset3D.prototype.setShadow=function(e){this.shadow=e,this.tileset.shadows=e},Cgs3DTileset3D.prototype.getShadow=function(){return this.shadow},Cgs3DTileset3D.prototype.setVisibleWire=function(e){this.showWire=e,this.tileset.debugWireframe=e},Cgs3DTileset3D.prototype.getVisibleWire=function(){return this.showWire},Cgs3DTileset3D.prototype.setVisibleBounding=function(e){this.showBounding=e,this.tileset.debugShowBoundingVolume=e},Cgs3DTileset3D.prototype.getVisibleBounding=function(){return this.showBounding},Cgs3DTileset3D.prototype.setSelectColor=function(e){this.selectColor=e,this.curFeature&&(this.curFeature.color=Cesium.Color.fromCssColorString(e))},Cgs3DTileset3D.prototype.getSelectColor=function(){return this.selectColor},Cgs3DTileset3D.prototype.setHighlightColor=function(e){this.highlightColor=e,this.curHighlightFeature&&(this.curHighlightFeature.color=Cesium.Color.fromCssColorString(e))},Cgs3DTileset3D.prototype.getHighlightColor=function(){return this.highlightColor},Cgs3DTileset3D.prototype.setEnableSelected=function(e){this.enableSelected=e},Cgs3DTileset3D.prototype.getEnableSelected=function(){return this.enableSelected},Cgs3DTileset3D.prototype.setHeightColor=function(e){var t,i;Cesium.defined(e)?(this.heightColorTable=e,t=this.tileset.properties,this.success&&Cesium.defined(t)&&(Cesium.defined(t.height)?(i=this.hexToRgb(e,"height"),this.tileset.style=new Cesium.Cesium3DTileStyle({color:{conditions:i}})):Cesium.defined(t.Height)&&(i=this.hexToRgb(e,"Height"),this.tileset.style=new Cesium.Cesium3DTileStyle({color:{conditions:i}})))):this.tileset.style=new Cesium.Cesium3DTileStyle},Cgs3DTileset3D.prototype.getHeightColor=function(){return this.heightColorTable},Cgs3DTileset3D.prototype.setPosition=function(e){this.position=e},Cgs3DTileset3D.prototype.getPosition=function(){return this.positionNew},Cgs3DTileset3D.prototype.setPositionNew=function(e){var u=this;this.tileset.readyPromise.then(function(e){var t=Cesium.Matrix3.fromRotationX(Cesium.Math.toRadians(0)),i=Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(0)),s=Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(0)),o=Cesium.Matrix4.fromTranslation(t),a=Cesium.Matrix4.fromTranslation(i),n=Cesium.Matrix4.fromTranslation(s),r=Cesium.Cartesian3.fromDegrees(u.positionNew[0],u.positionNew[1],u.positionNew[2]),l=Cesium.Transforms.eastNorthUpToFixedFrame(r);Cesium.Matrix4.multiply(l,o,l),Cesium.Matrix4.multiply(l,a,l),Cesium.Matrix4.multiply(l,n,l),e._root.transform=l})},Cgs3DTileset3D.prototype.getPositionNew=function(){return this.positionNew},Cgs3DTileset3D.prototype.getOffsetHeight=function(){return this.offsetHeight},Cgs3DTileset3D.prototype.getId=function(){return this.id},Cgs3DTileset3D.prototype.setId=function(e){this.id=e},Cgs3DTileset3D.prototype.hexToRgb=function(e,t){var i=[];if("[object Array]"!=Object.prototype.toString.call(e)){var s=Cesium.Color.fromCssColorString(this.baseColor),o=[],a="true",n="color('#"+(c=(c=Cesium.Color.floatToByte(s.red).toString(16)).length<2?0+c:c)+(g=(g=Cesium.Color.floatToByte(s.green).toString(16)).length<2?0+g:g)+(d=(d=Cesium.Color.floatToByte(s.blue).toString(16)).length<2?0+d:d)+"',"+s.alpha+")";return o.push(a),o.push(n),i.push(o),i}for(var r=e.length,l=0;l<r;++l){var u=e[l],p=u.color,h=u.height,s=Cesium.Color.fromCssColorString(p),o=[],a="${"+t+"} >= "+h,n="color('#"+(c=(c=Cesium.Color.floatToByte(s.red).toString(16)).length<2?0+c:c)+(g=(g=Cesium.Color.floatToByte(s.green).toString(16)).length<2?0+g:g)+(d=(d=Cesium.Color.floatToByte(s.blue).toString(16)).length<2?0+d:d)+"',"+s.alpha+")";o.push(a),o.push(n),i.push(o)}var c,g,d,s=Cesium.Color.fromCssColorString(this.baseColor),o=[],a="true",n="color('#"+(c=(c=Cesium.Color.floatToByte(s.red).toString(16)).length<2?0+c:c)+(g=(g=Cesium.Color.floatToByte(s.green).toString(16)).length<2?0+g:g)+(d=(d=Cesium.Color.floatToByte(s.blue).toString(16)).length<2?0+d:d)+"',"+s.alpha+")";return o.push(a),o.push(n),i.push(o),i},Cgs3DTileset3D.Tileset="3dTileset",Cgs3DTileset3D.prototype.getBaseColor=function(){return this.baseColor},Cgs3DTileset3D.prototype.getProxy=function(){return this.proxy},Cgs3DTileset3D.prototype.getUrl=function(){return this.url},Cgs3DTileset3D.prototype.getSelfType=function(){return this.selfType},Cgs3DTileset3D.prototype.getSaveFlag=function(){return this.saveFlag},Cgs3DTileset3D.prototype.setZTranslation=function(e){0==e?this.tileset.root.transform=Matrix4.clone(Matrix4.IDENTITY):(5e3<e&&(e=5e3),e<-2e3&&(e=-2e3),this.tileset.root.transform=Cesium.Matrix4.fromTranslation(Cesium.Cartesian3.fromElements(0,0,e)))},Cgs3DTileset3D.prototype.setModelMatrix=function(e){this.modelMatrix=e,this.tileset.modelMatrix=e},Cgs3DTileset3D.prototype.setMaximumScreenSpaceError=function(e){this.maximumScreenSpaceError=e,this.tileset.maximumScreenSpaceError=e},Cgs3DTileset3D.prototype.setImmediatelyLoadDesiredLevelOfDetail=function(e){this.immediatelyLoadDesiredLevelOfDetail=e,this.tileset.immediatelyLoadDesiredLevelOfDetail=e},Cgs3DTileset3D.prototype.setMaximumMemoryUsage=function(e){this.maximumMemoryUsage=e,this.tileset.maximumMemoryUsage=e},Cgs3DTileset3D.prototype.setDynamicScreenSpaceError=function(e){this.dynamicScreenSpaceError=e,this.tileset.dynamicScreenSpaceError=e},Cgs3DTileset3D.prototype.setCullWithChildrenBounds=function(e){this.cullWithChildrenBounds=e,this.tileset.cullWithChildrenBounds=e},Cgs3DTileset3D.prototype.setSkipLevelOfDetail=function(e){this.skipLevelOfDetail=e,this.tileset.skipLevelOfDetail=e},Cgs3DTileset3D.prototype.setSkipLevels=function(e){this.skipLevels=e,this.tileset.skipLevels=e},Cgs3DTileset3D.prototype.setAnalyzeStatus=function(e){(this.analyzeStatus=e)||(this.analyzePointArr.forEach(function(e){map.removeFeature(e)}),this.tileset.style=void 0,this.analyzePointArr=[],this.pointTagArr=[],this.analyzeTag=null,this.analyzeTagName=null,this.analyzeNodeData=null)},Cgs3DTileset3D.prototype.setAnalyzeType=function(e,t){this.analyzeTag=e,this.analyzeTagName=t},Cgs3DTileset3D.prototype.setAnalyzeNodeData=function(e){this.analyzeNodeData=e},Cgs3DTileset3D.prototype.modelNodeCheck=function(e,t){this.NodeArrayData=e;var i=this;console.log(e),e.forEach(function(e){e.id==t||e.hasOwnProperty("children")&&i.modelNodeCheck(e.children,t)})},CgsStream3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t,i;Cesium.defined(e.url)&&""!==e.url&&(this.url=Cesium.defaultValue(e.url,""),this.show=Cesium.defaultValue(e.show,!0),this.type=Cesium.defaultValue(e.type,CgsStream3D.Ocean),this.speed=Cesium.defaultValue(e.speed,60),this.lineCount=Cesium.defaultValue(e.lineCount,1200),this.color=Cesium.defaultValue(e.color,"rgba(0.0,255.0,255.0,1.0)"),this.saveFlag=Cesium.defaultValue(e.saveFlag,!0),this.backgroundFlag=Cesium.defaultValue(e.backgroundFlag,!0),this._id=void 0,this.map=void 0,this.proxy=null,t=CgsUtil.getProxyURL(e.proxy),this.proxy=t?new Cesium.DefaultProxy(t):null,this.proxy&&(this.url=this.proxy.getURL(this.url)),this.streamType=0,this.type==CgsStream3D.Ocean?this.streamType=0:this.streamType=1,1==this.streamType&&(this.color="rgba(255.0,255.0,255.0,1.0)"),i={url:this.url,type:this.streamType,show:this.show,numCurrent:this.lineCount,speed:this.speed,color:this.color,showBackGround:this.backgroundFlag,onError:e.onError},this.featureType=CgsStream3D.Stream,this.stream=new Cesium.FeCurrentPrimitive(i))}),CgsStream3D.prototype.setMap=function(e){this.map=e},CgsStream3D.prototype.getMap=function(){return this.map},CgsStream3D.prototype.getStream=function(){return this.stream},CgsStream3D.prototype.setSpeed=function(e){this.speed=e,this.stream.speed=e},CgsStream3D.prototype.getSpeed=function(){return this.speed},CgsStream3D.prototype.setVisible=function(e){this.show=e,this.stream.show=e},CgsStream3D.prototype.getVisible=function(){return this.show},CgsStream3D.prototype.setColor=function(e){this.color=e,this.stream.color=e},CgsStream3D.prototype.getColor=function(){return this.color},CgsStream3D.prototype.getType=function(){return this.type},CgsStream3D.prototype.getBackgroundFlag=function(){return this.backgroundFlag},CgsStream3D.prototype.setBackgroundFlag=function(e){this.backgroundFlag=e,this.stream.showBackGround=e},CgsStream3D.prototype.getId=function(){return this._id},CgsStream3D.prototype.getUrl=function(){return this.url},CgsStream3D.prototype.getLineCount=function(){return this.lineCount},CgsStream3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsStream3D.prototype.setSaveFlag=function(e){return this.saveFlag=e},CgsStream3D.Stream="stream",CgsStream3D.Ocean="ocean",CgsStream3D.Air="air",CgsStream3D.prototype.getSelfType=function(){return"CgsStream"},CgsPrecipitation3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){this.saveFlag=Cesium.defaultValue(e.saveFlag,!0),this.show=Cesium.defaultValue(e.show,!0),this.type=Cesium.defaultValue(e.type,CgsPrecipitation3D.Snow),this.density=Cesium.defaultValue(e.density,.5),this.visibleHeight=Cesium.defaultValue(e.visibleHeight,1e3),this.angle=Cesium.defaultValue(e.angle,0),this.density=Cesium.Math.clamp(this.density,0,1),this.visibleHeight=Cesium.Math.clamp(this.visibleHeight,100,5e3),this.angle=Cesium.Math.clamp(this.angle,-90,90),this.map=void 0,this._id=void 0,this.precipitationType=0,this.type==CgsPrecipitation3D.Snow?this.precipitationType=0:this.precipitationType=1;var t={type:this.precipitationType,show:this.show,density:this.density,visibleHeight:this.visibleHeight,angle:this.angle};this.selfType="CgsPrecipitation",this.featureType=CgsPrecipitation3D.Precipitation,this.precipitation=new Cesium.FePrecipitation(t)}),CgsPrecipitation3D.prototype.setMap=function(e){this.map=e},CgsPrecipitation3D.prototype.getMap=function(){return this.map},CgsPrecipitation3D.prototype.getPrecipitation=function(){return this.precipitation},CgsPrecipitation3D.prototype.setDensity=function(e){this.density=Cesium.Math.clamp(e,0,1),this.precipitation.density=this.density},CgsPrecipitation3D.prototype.getDensity=function(){return this.density},CgsPrecipitation3D.prototype.setVisibleHeight=function(e){this.visibleHeight=Cesium.Math.clamp(e,100,5e3),this.precipitation.visibleHeight=this.visibleHeight},CgsPrecipitation3D.prototype.getVisibleHeight=function(){return this.visibleHeight},CgsPrecipitation3D.prototype.setVisible=function(e){this.show=e,this.precipitation.show=e},CgsPrecipitation3D.prototype.getVisible=function(){return this.show},CgsPrecipitation3D.prototype.getType=function(){return this.featureType},CgsPrecipitation3D.prototype.getId=function(){return this._id},CgsPrecipitation3D.prototype.getAngle=function(){return this.angle},CgsPrecipitation3D.prototype.getSelfType=function(){return this.selfType},CgsPrecipitation3D.prototype.getType=function(){return this.type},CgsPrecipitation3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsPrecipitation3D.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsPrecipitation3D.Precipitation="precipitation",CgsPrecipitation3D.Snow="snow",CgsPrecipitation3D.Rain="rain",CgsStreamLine3D=function(e){var t;!Cesium.defined(e.positions)&&2!==e.positions.length||(this.positions=e.positions,this.show=Cesium.defaultValue(e.show,!0),this.color=Cesium.defaultValue(e.color,"rgba(0.0,255.0,255.0,1.0)"),this.height=Cesium.defaultValue(e.height,void 0),this.fact=Cesium.defaultValue(e.fact,.5),this.pointNum=Cesium.defaultValue(e.pointNum,500),this.count=Cesium.defaultValue(e.count,100),this.speed=Cesium.defaultValue(e.speed,1),this.moveColor=Cesium.defaultValue(e.moveColor,"rgba(255.0,255.0,255.0,1.0)"),this.count=Math.min(this.pointNum,this.count),this.speed=Math.min(this.speed,this.count/2),this.times=Cesium.defaultValue(e.times,0),this.active=Cesium.defaultValue(e.active,!0),this.saveFlag=Cesium.defaultValue(e.saveFlag,!0),this.map=void 0,t={positions:this.positions,show:this.show,color:this.color,moveColor:this.moveColor,height:this.height,fact:this.fact,pointNum:this.pointNum,count:this.count,speed:this.speed,active:this.active,times:this.times},this.streamLine=new Cesium.FeStreamPrimitive(t),this.type="streamLine",this.selfType="CgsStreamLine")},CgsStreamLine3D.prototype.setMap=function(e){this.map=e},CgsStreamLine3D.prototype.getMap=function(){return this.map},CgsStreamLine3D.prototype.getStreamLine=function(){return this.streamLine},CgsStreamLine3D.prototype.getPosition=function(){return this.positions},CgsStreamLine3D.prototype.getType=function(){return this.type},CgsStreamLine3D.prototype.setVisible=function(e){this.show=e,this.streamLine.show=e},CgsStreamLine3D.prototype.getVisible=function(){return this.show},CgsStreamLine3D.prototype.setColor=function(e){var t=Cesium.Color.fromCssColorString(e);this.color=e,this.streamLine.color=t},CgsStreamLine3D.prototype.getColor=function(){return this.color},CgsStreamLine3D.prototype.setMoveColor=function(e){var t=Cesium.Color.fromCssColorString(e);this.moveColor=e,this.streamLine.moveColor=t},CgsStreamLine3D.prototype.getMoveColor=function(){return this.moveColor},CgsStreamLine3D.prototype.setSpeed=function(e){this.speed=e,this.speed=Math.min(this.speed,this.count/2),this.streamLine.speed=this.speed},CgsStreamLine3D.prototype.getSpeed=function(){return this.speed},CgsStreamLine3D.prototype.setTimes=function(e){this.times=e,this.streamLine.times=this.times},CgsStreamLine3D.prototype.getTimes=function(){return this.times},CgsStreamLine3D.prototype.activate=function(){this.active=!0,this.streamLine.active=!0},CgsStreamLine3D.prototype.deactivate=function(){this.active=!1,this.streamLine.active=!1},CgsStreamLine3D.StreamLine="streamLine",CgsStreamLine3D.prototype.getSelfType=function(){return this.selfType},CgsStreamLine3D.prototype.getHeight=function(){return this.height},CgsStreamLine3D.prototype.getFact=function(){return this.fact},CgsStreamLine3D.prototype.getPointNum=function(){return this.pointNum},CgsStreamLine3D.prototype.getCount=function(){return this.count},CgsStreamLine3D.prototype.getActive=function(){return this.active},CgsStreamLine3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsStreamLine3D.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsFireworks3D=function(i){this._position=Cesium.defaultValue(i.position,[-75,43,5e4]),CgsParticleCollection3D.call(this,i),this._type="fireworks",this._show=Cesium.defaultValue(i.show,!0),this._emitterOffset=Cesium.defaultValue(i.emitterOffset,[0,0,0]),this._countFireworks=Cesium.defaultValue(i.countFireworks,20);this._colorFireworks=Cesium.defaultValue(i.colorFireworks,void 0),this._colorFireworks;var e=Cesium.defaultValue(i.lifeTime,10),t=Cesium.defaultValue(i.burstSize,400);this._burstSize=t;var s=Cesium.defaultValue(i.canvasSize,20);this._canvasSize=s;var o=Cesium.defaultValue(i.drawRadius,8);this._drawRadius=o,this.saveFlag=Cesium.defaultValue(i.saveFlag,!0),this._particles=[];var a=i.particles;if(Cesium.defined(a)&&Array.isArray(a))for(var n=this,r=a[0],l=void 0,u=0;u<this._countFireworks;++u){for(var p=[],h=0;h<3;++h){var c={time:Cesium.Math.nextRandomNumber()*e,minimum:t,maximum:t};p.push(c)}!function(e){r.position=i.position,r.bursts=e,r.url=function(){{var e;Cesium.defined(l)||((l=document.createElement("canvas")).width=s,l.height=s,(e=l.getContext("2d")).beginPath(),e.arc(o,o,o,0,Cesium.Math.TWO_PI,!0),e.closePath(),e.fillStyle="rgba(255, 255, 255,1.0)",e.fill())}return l}(),r.type=n._type;var t=new CgsParticle3D(r);n._particles.push(t),n._particleCollection.add(t._particle)}(p)}else console.info(" not defined particles")},CgsInherits(CgsFireworks3D,CgsParticleCollection3D),CgsFireworks3D.prototype.setPosition=function(e){2==(this._position=e).length&&this._position.push(0);for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setPosition(e)}},CgsFireworks3D.prototype.getPosition=function(){return this._position},CgsFireworks3D.prototype.setTranslation=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setTranslation(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setTranslation(e)},CgsFireworks3D.prototype.getTranslation=function(e){return void 0===e?this._particles[0].getTranslation():e<=this._particles.length-1&&0<=e?this._particles[e].getTranslation():void 0},CgsFireworks3D.prototype.setRotation=function(e,t){if(3==e.length)if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setEmitterRotation(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setEmitterRotation(e)},CgsFireworks3D.prototype.getRotation=function(e){return void 0===e?this._particles[0].getEmitterRotation():e<=this._particles.length-1&&0<=e?this._particles[e].getEmitterRotation():void 0},CgsFireworks3D.prototype.setEmitter=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setEmitter(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setEmitter(e)},CgsFireworks3D.prototype.getEmitter=function(e){return void 0===e?this._particles[0].getEmitter():e<=this._particles.length-1&&0<=e?this._particles[e].getEmitter():void 0},CgsFireworks3D.prototype.setDimensions=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setDimensions(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setDimensions(e)},CgsFireworks3D.prototype.getDimensions=function(e){return void 0===e?this._particles[0].getDimensions():e<=this._particles.length-1&&0<=e?this._particles[e].getDimensions():void 0},CgsFireworks3D.prototype.setAngle=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setAngle(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setAngle(e)},CgsFireworks3D.prototype.getAngle=function(e){return void 0===e?this._particles[0].getAngle():e<=this._particles.length-1&&0<=e?this._particles[e].getAngle():void 0},CgsFireworks3D.prototype.setRadius=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setRadius(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setRadius(e)},CgsFireworks3D.prototype.getRadius=function(e){return void 0===e?this._particles[0].getRadius():e<=this._particles.length-1&&0<=e?this._particles[e].getRadius():void 0},CgsFireworks3D.prototype.setStartColor=function(e){this._startColor=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setStartColor(e)}},CgsFireworks3D.prototype.getStartColor=function(){return this._particles[0].getStartColor()},CgsFireworks3D.prototype.setEndColor=function(e){this._endColor=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setEndColor(e)}},CgsFireworks3D.prototype.getEndColor=function(){return this._particles[0].getEndColor()},CgsFireworks3D.prototype.setStartScale=function(e){this._startScale=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setStartScale(e)}},CgsFireworks3D.prototype.getStartScale=function(e){return this._particles[0].getStartScale()},CgsFireworks3D.prototype.setEndScale=function(e){this._endScale=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setEndScale(e)}},CgsFireworks3D.prototype.getEndScale=function(){return this._particles[0].getEndScale()},CgsFireworks3D.prototype.setRate=function(e){this._rate=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setRate(e)}},CgsFireworks3D.prototype.getRate=function(){return this._particles[0].getRate()},CgsFireworks3D.prototype.setLoop=function(e,t){if(this._loop=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setLoop(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setLoop(e)},CgsFireworks3D.prototype.getLoop=function(e){return void 0===e?this._particles[0].getLoop():e<=this._particles.length-1&&0<=e?this._particles[e].getLoop():void 0},CgsFireworks3D.prototype.setMinSpeed=function(e){this._minimumSpeed=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setMinSpeed(e)}},CgsFireworks3D.prototype.getMinSpeed=function(){return this._particles[0].getMinSpeed()},CgsFireworks3D.prototype.setMaxSpeed=function(e){this._maximumSpeed=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setMaxSpeed(e)}},CgsFireworks3D.prototype.getMaxSpeed=function(){return this._particles[0].getMaxSpeed()},CgsFireworks3D.prototype.setLife=function(e,t){if(this._life=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setLife(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setLife(e)},CgsFireworks3D.prototype.getLife=function(e){return void 0===e?this._particles[0].getLife():e<=this._particles.length-1&&0<=e?this._particles[e].getLife():void 0},CgsFireworks3D.prototype.setMinLife=function(e){this._minimumLife=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setMinLife(e)}},CgsFireworks3D.prototype.getMinLife=function(e){return this._particles[0].getMinLife()},CgsFireworks3D.prototype.setMaxLife=function(e){this._maximumLife=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setMaxLife(e)}},CgsFireworks3D.prototype.getMaxLife=function(e){return this._particles[0].getMaxLife()},CgsFireworks3D.prototype.setWidth=function(e){this._width=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setWidth(e)}},CgsFireworks3D.prototype.getWidth=function(){return this._particles[0].getWidth()},CgsFireworks3D.prototype.setMinWidth=function(e){this._minimumWidth=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setMinWidth(e)}},CgsFireworks3D.prototype.getMinWidth=function(e){return this._particles[0].getMinWidth()},CgsFireworks3D.prototype.setMaxWidth=function(e,t){this._maximumWidth=e;for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxWidth(e)}},CgsFireworks3D.prototype.getMaxWidth=function(e){return this._particles[0].getMaxWidth()},CgsFireworks3D.prototype.setHeight=function(e){this._height=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setHeight(e)}},CgsFireworks3D.prototype.getHeight=function(){return this._particles[0].getHeight()},CgsFireworks3D.prototype.setMinHeight=function(e){this._minimumHeight=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setMinHeight(e)}},CgsFireworks3D.prototype.getMinHeight=function(){return this._particles[0].getMinHeight()},CgsFireworks3D.prototype.setMaxHeight=function(e){for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setMaxHeight(e)}},CgsFireworks3D.prototype.getMaxHeight=function(){return this._particles[0].getMaxHeight()},CgsFireworks3D.prototype.setLifeTime=function(e){this._lifeTime=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setLifeTime(e)}},CgsFireworks3D.prototype.getLifeTime=function(){return this._particles[0].getLifeTime()},CgsFireworks3D.prototype.setVisibleHeight=function(e){this._visibleDistance=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setVisibleHeight(e)}},CgsFireworks3D.prototype.getVisibleHeight=function(){return this._particles[0].getVisibleHeight()},CgsFireworks3D.prototype.setVisible=function(e){this._show=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setVisible(e)}},CgsFireworks3D.prototype.getVisible=function(){return this._show},CgsFireworks3D.prototype.location=function(){var e=this._position;2===e.length&&e.push(0);var t,i,s,o,a,n=this._emitterOffset,r=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2])),l=this.getMap();l&&(t=l.scene.camera,i=new Cesium.Cartesian3(-300,0,0),t.lookAtTransform(r,i),t.lookAtTransform(Cesium.Matrix4.IDENTITY),s=new Cesium.Cartesian3(n[0],n[1],n[2]),o=Cesium.Cartesian3.subtract(s,i,new Cesium.Cartesian3),Cesium.Cartesian3.normalize(o,o),a=Cesium.Math.PI_OVER_TWO-Math.acos(Cesium.Cartesian3.dot(o,Cesium.Cartesian3.UNIT_Z)),t.lookUp(a))},CgsFireworks3D.prototype.getSelfType=function(){return"CgsFireworks"},CgsFireworks3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsFireworks3D.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsFireworks3D.prototype.getEmitterOffset=function(){return this._emitterOffset},CgsFireworks3D.prototype.getCountFireworks=function(){return this._countFireworks},CgsFireworks3D.prototype.getColorFireworks=function(){return this._colorFireworks},CgsFireworks3D.prototype.getBurstSize=function(){return this._burstSize},CgsFireworks3D.prototype.getCanvasSize=function(){return this._canvasSize},CgsFireworks3D.prototype.getDrawRadius=function(){return this._drawRadius},CgsFireworks3D.prototype.getParticles=function(){return this._particles},CgsTailFire3D=function(e){this._position=Cesium.defaultValue(e.position,[-75,43,5e4]),CgsParticleCollection3D.call(this,e),this._type="tailfire",this._show=Cesium.defaultValue(e.show,!0),this._saveFlag=Cesium.defaultValue(e.saveFlag,!0),this._particles=[];var t=e.particles;if(Cesium.defined(t)&&Array.isArray(t))for(var i=t.length,s=0;s<i;++s){var o=t[s];o.position=e.position,o.type=this._type;var a=new CgsParticle3D(o);this._particles.push(a),this._particleCollection.add(a._particle)}else console.info(" not defined particles")},CgsInherits(CgsTailFire3D,CgsParticleCollection3D),CgsTailFire3D.prototype.setPosition=function(e){2==(this._position=e).length&&this._position.push(0);for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setPosition(e)}},CgsTailFire3D.prototype.getPosition=function(){return this._position},CgsTailFire3D.prototype.setRotate=function(e,t){if(3==(this._rotate=e).length)if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setRotate(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setRotate(e)},CgsTailFire3D.prototype.getRotate=function(e){return void 0===e?this._particles[0].getRotate():e<=this._particles.length-1&&0<=e?this._particles[e].getRotate():void 0},CgsTailFire3D.prototype.setTranslation=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setTranslation(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setTranslation(e)},CgsTailFire3D.prototype.getTranslation=function(e){return void 0===e?this._particles[0].getTranslation():e<=this._particles.length-1&&0<=e?this._particles[e].getTranslation():void 0},CgsTailFire3D.prototype.setRotation=function(e,t){if(3==e.length)if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setEmitterRotation(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setEmitterRotation(e)},CgsTailFire3D.prototype.getRotation=function(e){return void 0===e?this._particles[0].getEmitterRotation():e<=this._particles.length-1&&0<=e?this._particles[e].getEmitterRotation():void 0},CgsTailFire3D.prototype.setEmitter=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setEmitter(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setEmitter(e)},CgsTailFire3D.prototype.getEmitter=function(e){return void 0===e?this._particles[0].getEmitter():e<=this._particles.length-1&&0<=e?this._particles[e].getEmitter():void 0},CgsTailFire3D.prototype.setDimensions=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setDimensions(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setDimensions(e)},CgsTailFire3D.prototype.getDimensions=function(e){return void 0===e?this._particles[0].getDimensions():e<=this._particles.length-1&&0<=e?this._particles[e].getDimensions():void 0},CgsTailFire3D.prototype.setAngle=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setAngle(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setAngle(e)},CgsTailFire3D.prototype.getAngle=function(e){return void 0===e?this._particles[0].getAngle():e<=this._particles.length-1&&0<=e?this._particles[e].getAngle():void 0},CgsTailFire3D.prototype.setRadius=function(e,t){if(void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setRadius(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setRadius(e)},CgsTailFire3D.prototype.getRadius=function(e){return void 0===e?this._particles[0].getRadius():e<=this._particles.length-1&&0<=e?this._particles[e].getRadius():void 0},CgsTailFire3D.prototype.setStartColor=function(e,t){if(this._startColor=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setStartColor(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setStartColor(e)},CgsTailFire3D.prototype.getStartColor=function(e){return void 0===e?this._particles[0].getStartColor():e<=this._particles.length-1&&0<=e?this._particles[e].getStartColor():void 0},CgsTailFire3D.prototype.setEndColor=function(e,t){if(this._endColor=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setEndColor(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setEndColor(e)},CgsTailFire3D.prototype.getEndColor=function(e){return void 0===e?this._particles[0].getEndColor():e<=this._particles.length-1&&0<=e?this._particles[e].getEndColor():void 0},CgsTailFire3D.prototype.setStartScale=function(e,t){if(this._startScale=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setStartScale(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setStartScale(e)},CgsTailFire3D.prototype.getStartScale=function(e){return void 0===e?this._particles[0].getStartScale():e<=this._particles.length-1&&0<=e?this._particles[e].getStartScale():void 0},CgsTailFire3D.prototype.setEndScale=function(e,t){if(this._endScale=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setEndScale(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setEndScale(e)},CgsTailFire3D.prototype.getEndScale=function(e){return void 0===e?this._particles[0].getEndScale():e<=this._particles.length-1&&0<=e?this._particles[e].getEndScale():void 0},CgsTailFire3D.prototype.setRate=function(e,t){if(this._rate=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setRate(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setRate(e)},CgsTailFire3D.prototype.getRate=function(e){return void 0===e?this._particles[0].getRate():e<=this._particles.length-1&&0<=e?this._particles[e].getRate():void 0},CgsTailFire3D.prototype.setLoop=function(e,t){if(this._loop=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setLoop(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setLoop(e)},CgsTailFire3D.prototype.getLoop=function(e){return void 0===e?this._particles[0].getLoop():e<=this._particles.length-1&&0<=e?this._particles[e].getLoop():void 0},CgsTailFire3D.prototype.setSpeed=function(e,t){if(this._speed=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setSpeed(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setSpeed(e)},CgsTailFire3D.prototype.getSpeed=function(e){return void 0===e?this._particles[0].getSpeed():e<=this._particles.length-1&&0<=e?this._particles[e].getSpeed():void 0},CgsTailFire3D.prototype.setMinSpeed=function(e,t){if(this._minimumSpeed=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMinSpeed(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMinSpeed(e)},CgsTailFire3D.prototype.getMinSpeed=function(e){return void 0===e?this._particles[0].getMinSpeed():e<=this._particles.length-1&&0<=e?this._particles[e].getMinSpeed():void 0},CgsTailFire3D.prototype.setMaxSpeed=function(e,t){if(this._maximumSpeed=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxSpeed(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMaxSpeed(e)},CgsTailFire3D.prototype.getMaxSpeed=function(e){return void 0===e?this._particles[0].getMaxSpeed():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxSpeed():void 0},CgsTailFire3D.prototype.setLife=function(e,t){if(this._life=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setLife(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setLife(e)},CgsTailFire3D.prototype.getLife=function(e){return void 0===e?this._particles[0].getLife():e<=this._particles.length-1&&0<=e?this._particles[e].getLife():void 0},CgsTailFire3D.prototype.setMinLife=function(e,t){if(this._minimumLife=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMinLife(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMinLife(e)},CgsTailFire3D.prototype.getMinLife=function(e){return void 0===e?this._particles[0].getMinLife():e<=this._particles.length-1&&0<=e?this._particles[e].getMinLife():void 0},CgsTailFire3D.prototype.setMaxLife=function(e,t){if(this._maximumLife=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxLife(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMaxLife(e)},CgsTailFire3D.prototype.getMaxLife=function(e){return void 0===e?this._particles[0].getMaxLife():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxLife():void 0},CgsTailFire3D.prototype.setMass=function(e,t){if(this._mass=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMass(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMass(e)},CgsTailFire3D.prototype.getMass=function(e){return void 0===e?this._particles[0].getMass():e<=this._particles.length-1&&0<=e?this._particles[e].getMass():void 0},CgsTailFire3D.prototype.setMinMass=function(e,t){if(this._minimumMass=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMinMass(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMinMass(e)},CgsTailFire3D.prototype.getMinMass=function(e){return void 0===e?this._particles[0].getMinMass():e<=this._particles.length-1&&0<=e?this._particles[e].getMinMass():void 0},CgsTailFire3D.prototype.setMaxMass=function(e,t){if(this._maximumLife=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxMass(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMaxMass(e)},CgsTailFire3D.prototype.getMaxMass=function(e){return void 0===e?this._particles[0].getMaxMass():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxMass():void 0},CgsTailFire3D.prototype.setImage=function(e,t){if(this._url=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setUrl(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setUrl(e)},CgsTailFire3D.prototype.getImage=function(e){return void 0===e?this._particles[0].getUrl():e<=this._particles.length-1&&0<=e?this._particles[e].getUrl():void 0},CgsTailFire3D.prototype.setWidth=function(e,t){if(this._width=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setWidth(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setWidth(e)},CgsTailFire3D.prototype.getWidth=function(e){return void 0===e?this._particles[0].getWidth():e<=this._particles.length-1&&0<=e?this._particles[e].getWidth():void 0},CgsTailFire3D.prototype.setMinWidth=function(e,t){if(this._minimumWidth=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMinWidth(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMinWidth(e)},CgsTailFire3D.prototype.getMinWidth=function(e){return void 0===e?this._particles[0].getMinWidth():e<=this._particles.length-1&&0<=e?this._particles[e].getMinWidth():void 0},CgsTailFire3D.prototype.setMaxWidth=function(e,t){if(this._maximumWidth=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxWidth(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMaxWidth(e)},CgsTailFire3D.prototype.getMaxWidth=function(e){return void 0===e?this._particles[0].getMaxWidth():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxWidth():void 0},CgsTailFire3D.prototype.setHeight=function(e,t){if(this._height=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setHeight(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setHeight(e)},CgsTailFire3D.prototype.getHeight=function(e){return void 0===e?this._particles[0].getHeight():e<=this._particles.length-1&&0<=e?this._particles[e].getHeight():void 0},CgsTailFire3D.prototype.setMinHeight=function(e,t){if(this._minimumHeight=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMinHeight(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMinHeight(e)},CgsTailFire3D.prototype.getMinHeight=function(e){return void 0===e?this._particles[0].getMinHeight():e<=this._particles.length-1&&0<=e?this._particles[e].getMinHeight():void 0},CgsTailFire3D.prototype.setMaxHeight=function(e,t){if(this._maximumHeight=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setMaxHeight(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setMaxHeight(e)},CgsTailFire3D.prototype.getMaxHeight=function(e){return void 0===e?this._particles[0].getMaxHeight():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxHeight():void 0},CgsTailFire3D.prototype.setLifeTime=function(e,t){if(this._lifeTime=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setLifeTime(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setLifeTime(e)},CgsTailFire3D.prototype.getLifeTime=function(e){return void 0===e?this._particles[0].getLifeTime():e<=this._particles.length-1&&0<=e?this._particles[e].getLifeTime():void 0},CgsTailFire3D.prototype.setVisibleHeight=function(e,t){if(this._visibleDistance=e,void 0===t||-1===t)for(var i=this._particles.length,s=0;s<i;++s){this._particles[s].setVisibleHeight(e)}else t<=(i=this._particles.length)-1&&0<=t&&this._particles[t].setVisibleHeight(e)},CgsTailFire3D.prototype.getVisibleHeight=function(e){return void 0===e?this._particles[0].getVisibleHeight():e<=this._particles.length-1&&0<=e?this._particles[e].getVisibleHeight():void 0},CgsTailFire3D.prototype.setVisible=function(e){this._show=e;for(var t=this._particles.length,i=0;i<t;++i){this._particles[i].setVisible(e)}},CgsTailFire3D.prototype.getVisible=function(){return this._show},CgsTailFire3D.prototype.getParticles=function(){return this._particles},CgsTailFire3D.prototype.getBursts=function(e){return void 0===e?this._particles[0].getBursts():e<=this._particles.length-1&&0<=e?this._particles[e].getBursts():void 0},CgsTailFire3D.prototype.getType=function(e){return void 0===e?this._particles[0].getType():e<=this._particles.length-1&&0<=e?this._particles[e].getType():void 0},CgsTailFire3D.prototype.getXMin=function(e){return void 0===e?this._particles[0].getXMin():e<=this._particles.length-1&&0<=e?this._particles[e].getXMin():void 0},CgsTailFire3D.prototype.getXMax=function(e){return void 0===e?this._particles[0].getXMax():e<=this._particles.length-1&&0<=e?this._particles[e].getXMax():void 0},CgsTailFire3D.prototype.getYMin=function(e){return void 0===e?this._particles[0].getYMin():e<=this._particles.length-1&&0<=e?this._particles[e].getYMin():void 0},CgsTailFire3D.prototype.getYMax=function(e){return void 0===e?this._particles[0].getYMax():e<=this._particles.length-1&&0<=e?this._particles[e].getYMax():void 0},CgsTailFire3D.prototype.getZMin=function(e){return void 0===e?this._particles[0].getZMin():e<=this._particles.length-1&&0<=e?this._particles[e].getZMin():void 0},CgsTailFire3D.prototype.getZMax=function(e){return void 0===e?this._particles[0].getZMax():e<=this._particles.length-1&&0<=e?this._particles[e].getZMax():void 0},CgsTailFire3D.prototype.getEmitterOffset=function(e){return void 0===e?this._particles[0].getEmitterOffset():e<=this._particles.length-1&&0<=e?this._particles[e].getEmitterOffset():void 0},CgsTailFire3D.prototype.getMinExplosionSize=function(e){return void 0===e?this._particles[0].getMinExplosionSize():e<=this._particles.length-1&&0<=e?this._particles[e].getMinExplosionSize():void 0},CgsTailFire3D.prototype.getMaxExplosionSize=function(e){return void 0===e?this._particles[0].getMaxExplosionSize():e<=this._particles.length-1&&0<=e?this._particles[e].getMaxExplosionSize():void 0},CgsTailFire3D.prototype.getSelfType=function(){return"CgsExplode"},CgsTailFire3D.prototype.getSaveFlag=function(){return this._saveFlag},CgsTailFire3D.prototype.setSaveFlag=function(e){return this._saveFlag=e},CgsSpreadEffect3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){if(this._position=Cesium.defaultValue(e.position,void 0),!Cesium.defined(this._position))return"not CgsSpreadEffect3D position";2==this._position.length&&this._position.push(0);this._radius=Cesium.defaultValue(e.radius,150),this._color=Cesium.defaultValue(e.color,"rgba(255.0,255.0,0.0,1.0)"),this._speed=Cesium.defaultValue(e.speed,.8),this._visible=Cesium.defaultValue(e.visible,!0),this._type=CgsSpreadEffect3D.EFFECT_TYPE,this.selfType="CgsSpreadEffect",this.map=void 0;var t={position:this._position,radius:this._radius,color:this._color,show:this._visible,moveFact:this._speed};this._primitive=new Cesium.FeLockPrimitive(t)}),CgsSpreadEffect3D.prototype.setMap=function(e){this.map=e},CgsSpreadEffect3D.prototype.getMap=function(){return this.map},CgsSpreadEffect3D.prototype.setPosition=function(e){2==(this._position=e).length&&this._position.push(0),this._primitive.position=this._position},CgsSpreadEffect3D.prototype.getPosition=function(){return this._position},CgsSpreadEffect3D.prototype.setRadius=function(e){this._radius=e,this._primitive.radius=this._radius},CgsSpreadEffect3D.prototype.getRadius=function(){return this._radius},CgsSpreadEffect3D.prototype.setSpeed=function(e){this._speed=e,this._primitive.moveFact=e},CgsSpreadEffect3D.prototype.getSpeed=function(){return this._speed},CgsSpreadEffect3D.prototype.setColor=function(e){this._color=e,this._primitive.color=this._color},CgsSpreadEffect3D.prototype.getColor=function(){return this._color},CgsSpreadEffect3D.prototype.setVisible=function(e){this._visible=e,this._primitive.show=this._visible},CgsSpreadEffect3D.prototype.getVisible=function(){return this._visible},CgsSpreadEffect3D.prototype.getType=function(){return this._type},CgsSpreadEffect3D.prototype.getPrimitive=function(){return this._primitive},CgsSpreadEffect3D.EFFECT_TYPE="CgsSpreadEffect3D",CgsImagerySplit3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){this.leftImagery=Cesium.defaultValue(e.leftImagery,"行政图"),this.rightImagery=Cesium.defaultValue(e.rightImagery,"全球影像"),this.mode=Cesium.defaultValue(e.mode,"automatic"),this.map=Cesium.defaultValue(e.map,void 0),this.isActive=Cesium.defaultValue(e.active,!1),this.color=Cesium.defaultValue(e.color,"rgba(255,255,255,0.5)"),this.alpha=Cesium.defaultValue(e.alpha,1),this.width=Cesium.defaultValue(e.width,2),this.left=Cesium.defaultValue(e.left,50),this.direction=Cesium.defaultValue(e.direction,CgsImagerySplit3D.LEFT),this.speed=Cesium.defaultValue(e.speed,.05),this.again=Cesium.defaultValue(e.again,!1),this.lastLayer=void 0,this.layersArr=[],this.lastTime=void 0,this.moveFlag=!1,this.speedDir=!0,this.curDir=!0,this.isInit=!1,this.handler=void 0,this.offset=0,this.hasRemoved=!0,this.isActive&&this.init()}),CgsImagerySplit3D.prototype.remove=function(){if(!this.hasRemoved){for(var e=!1,t=0;t<this.map.imageryLayers.length;++t){for(var i=0;i<this.layersArr.length;++i)if(this.map.imageryLayers.get(t)==this.layersArr[i]){e=!0;break}!e&&this.layersArr[t]?this.map.imageryLayers.remove(this.map.imageryLayers.get(t)):e=!1}for(i=0;i<this.layersArr.length;++i)this.map.imageryLayers.contains(this.layersArr[i])&&this.map.imageryLayers.raiseToTop(this.layersArr[i]);this.layersArr=[],this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOWN),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.PINCH_START),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.PINCH_MOVE),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_UP),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.PINCH_END),this.map.scene.preRender.removeEventListener(this.pre,this),this.slider.remove(),this.isActive=!1,this.left=50,this.direction=CgsImagerySplit3D.LEFT,this.speed=.05,this.again=!1,this.lastLayer=void 0,this.layersArr=[],this.lastTime=void 0,this.moveFlag=!1,this.speedDir=!0,this.curDir=!0,this.isInit=!1,this.handler=void 0,this.offset=0,this.hasRemoved=!0}},CgsImagerySplit3D.prototype.pre=function(){var e,t;this.mode!=CgsImagerySplit3D.MANUAL_MODE&&this.isActive&&(null!=this.lastTime?(e=Cesium.getTimestamp(),t=this.curDir?1:-1,this.left+=t*(e-this.lastTime)*100/(1e3/this.speed),this.map.container.clientWidth,this.slider.style.left=this.left+"%",this.map.scene.imagerySplitPosition=this.left/100,this.again?!this.curDir&&this.curDir||(this.left<0?(this.left=0,this.curDir=!0):100<this.left&&(this.left=100,this.curDir=!1)):this.curDir?(this.left<0||100<this.left)&&(this.left=0,this.curDir=!0):this.curDir||(this.left<0||100<this.left)&&(this.left=100,this.curDir=!1),this.lastTime=e):this.lastTime=Cesium.getTimestamp())},CgsImagerySplit3D.prototype.init=function(){this.map instanceof CgsMap?this.map=this.map.map3D:this.map instanceof CgsMap3D||alert("map error"),this.slider=document.createElement("div"),this.slider.hidden=!0,this.slider.setAttribute("class","imagerySplit_sliderDiv ui-widght-content"),this.slider.setAttribute("draggable","false"),this.slider.setAttribute("id","imagerySplit");for(var e=0;e<this.map.imageryLayers.length;++e)this.layersArr.push(this.map.imageryLayers.get(e));this.map.container.appendChild(this.slider);var o=this;this.rightImagery&&(this.rightLayer=this.map.getLayerByName(this.rightImagery),this.rightLayer instanceof Cesium.ImageryLayer&&this.map.imageryLayers.raiseToTop(this.rightLayer)),this.leftImagery&&(this.leftLayer=this.map.getLayerByName(this.leftImagery),this.leftLayer instanceof Cesium.ImageryLayer&&(this.map.imageryLayers.raiseToTop(this.leftLayer),this.leftLayer.setVisible(!0))),o.map.scene.imagerySplitPosition=o.left/100,o.map.scene.preRender.addEventListener(o.pre,this);var a=this.slider;this.handler=new Cesium.ScreenSpaceEventHandler(a);var n=!1;function t(e){var t,i,s;n&&(t=e.endPosition.x,i=a.offsetLeft,a.offsetLeft<0?i=0:a.offsetLeft>a.parentElement.offsetWidth-o.width&&(i=a.parentElement.offsetWidth-o.width),s=(i+t)/a.parentElement.offsetWidth,a.style.left=100*s+"%",o.left=100*s,o.map.scene.imagerySplitPosition=s)}this.handler.setInputAction(function(){o.mode!=CgsImagerySplit3D.AUTOMATIC_MODE&&(n=!0)},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction(function(){n=!0},Cesium.ScreenSpaceEventType.PINCH_START),this.handler.setInputAction(t,Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(t,Cesium.ScreenSpaceEventType.PINCH_MOVE),this.handler.setInputAction(function(){n=!1},Cesium.ScreenSpaceEventType.LEFT_UP),this.handler.setInputAction(function(){n=!1},Cesium.ScreenSpaceEventType.PINCH_END),this.hasRemoved=!1},CgsImagerySplit3D.prototype.addLayer=function(e){this.leftImagery!=e&&(this.leftLayer&&(this.leftLayer.owner?this.leftLayer.owner.setVisible(!1):this.leftLayer.setVisible(!1),this.leftLayer.splitDirection=Cesium.ImagerySplitDirection.NONE),this.leftImagery=e,this.leftLayer=this.map.getLayerByName(this.leftImagery),this.leftLayer instanceof Cesium.ImageryLayer&&(this.leftLayer.owner?(this.leftLayer.owner.setVisible(!0),this.leftLayer=this.map.getLayerByName(this.leftImagery)):this.leftLayer.setVisible(!0),this.map.imageryLayers.raiseToTop(this.leftLayer)),this.leftLayer.splitDirection=Cesium.ImagerySplitDirection.LEFT)},CgsImagerySplit3D.prototype.setLeftLayer=function(e){this.leftImagery!=e&&(this.leftLayer&&(this.leftLayer.owner?this.leftLayer.owner.setVisible(!1):this.leftLayer.setVisible(!1),this.leftLayer.splitDirection=Cesium.ImagerySplitDirection.NONE),this.leftImagery=e,this.leftLayer=this.map.getLayerByName(this.leftImagery),this.leftLayer instanceof Cesium.ImageryLayer&&(this.leftLayer.owner?(this.leftLayer.owner.setVisible(!0),this.leftLayer=this.map.getLayerByName(this.leftImagery)):this.leftLayer.setVisible(!0),this.map.imageryLayers.raiseToTop(this.leftLayer)),this.leftLayer.splitDirection=Cesium.ImagerySplitDirection.LEFT)},CgsImagerySplit3D.prototype.getLeftLayer=function(){return this.leftImagery},CgsImagerySplit3D.prototype.setRightLayer=function(e){this.rightImagery!=e&&(this.rightLayer&&(this.rightLayer.owner?this.rightLayer.owner.setVisible(!1):this.rightLayer.setVisible(!1)),this.rightImagery=e,this.rightLayer=this.map.getLayerByName(this.rightImagery),this.rightLayer instanceof Cesium.ImageryLayer&&(this.rightLayer.owner?(this.rightLayer.owner.setVisible(!0),this.rightLayer=this.map.getLayerByName(this.rightImagery)):this.rightLayer.setVisible(!0),this.map.imageryLayers.raiseToTop(this.rightLayer)),this.rightLayer.splitDirection=Cesium.ImagerySplitDirection.NONE,this.map.imageryLayers.raiseToTop(this.leftLayer))},CgsImagerySplit3D.prototype.getRightLayer=function(){return this.rightImagery},CgsImagerySplit3D.prototype.activate=function(){this.isActive=!0,this.isInit||(this.init(),this.isInit=!0),this.isActive&&null!=this.leftLayer?this.leftLayer.splitDirection=Cesium.ImagerySplitDirection.LEFT:this.isActive||null==this.leftLayer||(this.leftLayer.splitDirection=Cesium.ImagerySplitDirection.NONE),this.rightLayer.splitDirection=Cesium.ImagerySplitDirection.NONE,this.slider.hidden=!1},CgsImagerySplit3D.prototype.deactivate=function(){this.isActive=!1,this.slider.hidden=!0,null!=this.leftLayer&&(this.leftLayer.splitDirection=Cesium.ImagerySplitDirection.NONE),null!=this.rightLayer&&(this.rightLayer.splitDirection=Cesium.ImagerySplitDirection.NONE),this.remove()},CgsImagerySplit3D.prototype.setAgain=function(e){this.again&&!e&&(this.speedDir?this.curDir=!0:this.curDir=!1),this.again=e},CgsImagerySplit3D.prototype.getAgain=function(){return this.again},CgsImagerySplit3D.prototype.setWidth=function(e){this.width=e,this.slider.style.width=e+"px"},CgsImagerySplit3D.prototype.getWidth=function(){return this.width},CgsImagerySplit3D.prototype.setDirection=function(e){this.direction=e;this.map.imageryLayers.get(this.map.imageryLayers.length-1);this.direction==CgsImagerySplit3D.LEFT?(this.speedDir=!0,this.curDir=!0):this.direction==CgsImagerySplit3D.RIGHT&&(this.speedDir=!1,this.curDir=!1)},CgsImagerySplit3D.prototype.getDirection=function(){return this.direction},CgsImagerySplit3D.prototype.setColor=function(e){this.color=e,this.slider.style.backgroundColor=e},CgsImagerySplit3D.prototype.getColor=function(){return this.color},CgsImagerySplit3D.prototype.setSpeed=function(e){0==e?this.speed=0:0==this.speed?this.speed=e:this.speed=this.speed/Math.abs(this.speed)*e},CgsImagerySplit3D.prototype.getSpeed=function(){return this.speed},CgsImagerySplit3D.prototype.setAlpha=function(e){var t,i,s,o;this.alpha=e,"#"==this.color.charAt(0)?(t=this.color.substr(3,2),i="rgba("+parseInt(this.color.substr(1,2),16)+","+parseInt(t,16)+","+parseInt(this.color.substr(5,2),16)+","+e+")",this.color=i):(s=(o=this.color).lastIndexOf(","),o=o.substring(0,s+1),o+=this.alpha+")",this.setColor(o))},CgsImagerySplit3D.prototype.getAlpha=function(){return this.alpha},CgsImagerySplit3D.prototype.setMap=function(e){this.map=e},CgsImagerySplit3D.prototype.getMap=function(){return this.map},CgsImagerySplit3D.prototype.setMode=function(e){(this.mode=e)==CgsImagerySplit3D.MANUAL_MODE?(this.slider.style.cursor="e-resize",this.lastTime=void 0):e==CgsImagerySplit3D.AUTOMATIC_MODE?this.slider.style.cursor="default":alert("mode error")},CgsImagerySplit3D.prototype.getMode=function(){return this.mode},CgsImagerySplit3D.MANUAL_MODE="manual",CgsImagerySplit3D.AUTOMATIC_MODE="automatic",CgsImagerySplit3D.LEFT="left",CgsImagerySplit3D.RIGHT="right",CgsKilometerGrid3D=function(e){e=e||{};this.options={},this.options.lineColor=e.lineColor||"rgba(0,255,0,0.5)",this.options.lineWidth=e.lineWidth||1,this.options.showLabels=void 0===e.showLabels||e.showLabels,this.options.labelfont=e.labelfont||"12px Calibri,sans-serif",this.options.labelFillColor=e.labelFillColor||"rgba(0,255,0,1)",this.options.labelstroke=e.labelstroke||"rgba(255, 255, 255, 0)",this.options.labelstrokewidth=e.labelstrokewidth||2,this.options.xLabelTextBaseline=e.xLabelTextBaseline||"top",this.options.xLabelTextAlign=e.xLabelTextAlign||"center",this.options.yLabelTextBaseline=e.yLabelTextBaseline||"middle",this.options.yLabelTextAlign=e.yLabelTextAlign||"left",this.options.originX=e.originX||0,this.options.originY=e.originY||0,this.alignMap={top:Cesium.VerticalOrigin.TOP,middle:Cesium.VerticalOrigin.CENTER,bottom:Cesium.VerticalOrigin.BOTTOM,left:Cesium.HorizontalOrigin.LEFT,center:Cesium.HorizontalOrigin.CENTER,right:Cesium.HorizontalOrigin.RIGHT};var D=this,S=!1;function t(){for(var e,t=(e=D.map.map3D.camera.computeViewRectangle(D.map.map3D.scene.globe.ellipsoid),{west:Cesium.Math.toDegrees(e.west),east:Cesium.Math.toDegrees(e.east),south:Cesium.Math.toDegrees(e.south),north:Cesium.Math.toDegrees(e.north)}),i=CgsUtil.lonLatToStableGaussKruger([t.west,t.south]),s=CgsUtil.lonLatToStableGaussKruger([t.east,t.north]),o=function(e,t,i,s,o,a){var n=[],r=[],l=[],u=[],p=1e3*Math.round((i-e)/1e3)+e-2e3,h=Math.round((i-e)/1e3)%100-2;for(;p<o;)p+=1e3,n.push(p),h=98<h?0:h+1,u.push(h);var c=1e3*Math.round((s-t)/1e3)+t-2e3;h=Math.round((s-t)/1e3)%100-2;for(;c<a;)c+=1e3,r.push(c),h=98<h?0:h+1,l.push(h);return{lonArr:n,latArr:r,xLabels:l,yLabels:u}}(D.options.originX,D.options.originY,i[0],i[1],s[0],s[1]),a=o.lonArr,n=o.latArr,r=o.xLabels,l=o.yLabels,u=a[0],p=n[0],h=a.length,c=n.length,g=a[h-1],d=n[c-1],m=0;m<h;m++){var f=a[m],C=[],y=CgsUtil.stableGaussKrugerToLonLat([f,p]);C.push(y[0]),C.push(y[1]),y=CgsUtil.stableGaussKrugerToLonLat([f,d]),C.push(y[0]),C.push(y[1]),D.yLineCollection.add({positions:Cesium.Cartesian3.fromDegreesArray(C),material:Cesium.Material.fromType("Color",{color:Cesium.Color.fromCssColorString(D.options.lineColor)}),width:D.options.lineWidth})}for(m=0;m<c;m++){var v=n[m],C=[],y=CgsUtil.stableGaussKrugerToLonLat([u,v]);C.push(y[0]),C.push(y[1]),y=CgsUtil.stableGaussKrugerToLonLat([g,v]),C.push(y[0]),C.push(y[1]),D.xLineCollection.add({positions:Cesium.Cartesian3.fromDegreesArray(C),material:Cesium.Material.fromType("Color",{color:Cesium.Color.fromCssColorString(D.options.lineColor)}),width:D.options.lineWidth})}for(m=0;m<h;m+=2)for(var f=a[m],b=0;b<c;b+=2){v=n[b];_(y=CgsUtil.stableGaussKrugerToLonLat([f+500,v]),r[b],"x"),_(y=CgsUtil.stableGaussKrugerToLonLat([f,v+500]),l[m],"y")}S=!0}function _(e,t,i){D.xyLabelCollection.add({position:Cesium.Cartesian3.fromDegrees(e[0],e[1],2),text:t+"",fillColor:Cesium.Color.fromCssColorString(D.options.labelFillColor),font:D.options.labelfont,style:Cesium.LabelStyle.FILL_AND_OUTLINE,outlineColor:Cesium.Color.fromCssColorString(D.options.labelstroke),outlineWidth:D.options.labelstrokewidth,HorizontalOrigin:"x"===i?D.alignMap[D.options.xlabelTextBaseline]:D.alignMap[D.options.yLabelTextBaseline],verticalOrigin:"x"===i?D.alignMap[D.options.xLabelTextAlign]:D.alignMap[D.options.yLabelTextAlign]})}function i(){S&&(D.xLineCollection.removeAll(),D.yLineCollection.removeAll(),D.xyLabelCollection.removeAll(),S=!1)}this.onCameraChanged=function(){12<D.map.getZoom()&&30<Math.abs(D.map.getCameraInfo().rotation.pitch)?(i(),t()):i()},this.addGridLineAndLabels=function(){11<D.map.getZoom()&&30<Math.abs(D.map.getCameraInfo().rotation.pitch)&&t(),D.scene.camera.changed.addEventListener(D.onCameraChanged)}},CgsKilometerGrid3D.prototype.setMap=function(e){e?(this.map=e,this.scene=e.map3D.scene,this.xyLabelCollection=this.scene.primitives.add(new Cesium.LabelCollection),this.xLineCollection=this.scene.primitives.add(new Cesium.PolylineCollection),this.yLineCollection=this.scene.primitives.add(new Cesium.PolylineCollection),this.addGridLineAndLabels()):this.dispose()},CgsKilometerGrid3D.prototype.dispose=function(){this.map&&(this.scene.camera.changed.removeEventListener(this.onCameraChanged),this.scene.primitives.remove(this.xyLabelCollection),this.scene.primitives.remove(this.xLineCollection),this.scene.primitives.remove(this.yLineCollection),this.xyLabelCollection=null,this.xLineCollection=null,this.yLineCollection=null)},CgsKilometerGrid3D.prototype.setLineColor=function(e){this.options.lineColor=e,this.onCameraChanged()},CgsKilometerGrid3D.prototype.setLineWidth=function(e){this.options.lineWidth=e,this.onCameraChanged()},CgsKilometerGrid3D.prototype.setLabelFillColor=function(e){this.options.labelFillColor=e,this.onCameraChanged()},CgsKilometerGrid3D.prototype.setLabelStroke=function(e){this.options.labelstroke=e,this.onCameraChanged()},CgsKilometerGrid3D.prototype.setLabelStrokeWidth=function(e){this.options.labelstrokewidth=e,this.onCameraChanged()},CgsFlatCloud3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){this.show=Cesium.defaultValue(e.show,!0),this.cloudSpeed=Cesium.defaultValue(e.cloudSpeed,[0,1e-6]),this.saveFlag=Cesium.defaultValue(e.saveFlag,!0),this.type=CgsFlatCloud3D.FlatCloud,this.map=void 0;var t={show:this.show,cloudSpeed:this.cloudSpeed};this.flatCloud=new Cesium.FeFlatClound(t)}),CgsFlatCloud3D.prototype.setMap=function(e){this.map=e},CgsFlatCloud3D.prototype.getMap=function(){return this.map},CgsFlatCloud3D.prototype.getFlatCloud=function(){return this.flatCloud},CgsFlatCloud3D.prototype.setVisible=function(e){this.show=e,this.flatCloud.show=e},CgsFlatCloud3D.prototype.getVisible=function(){return this.show},CgsFlatCloud3D.prototype.setCloudSpeed=function(e){this.cloudSpeed=e,this.flatCloud.cloudSpeed=e},CgsFlatCloud3D.prototype.getCloudSpeed=function(){return this.cloudSpeed},CgsFlatCloud3D.prototype.getType=function(){return this.type},CgsFlatCloud3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsFlatCloud3D.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsFlatCloud3D.FlatCloud="CgsFlatCloud",CgsEarthWeak3D=function(e){this.show=Cesium.defaultValue(e.visible,!0),this.color=Cesium.defaultValue(e.color,"rgba(125,125,125,1.0)"),this.strokeColor=Cesium.defaultValue(e.strokeColor,"rgba(255,255,255,1.0)"),this.strokeWidth=Cesium.defaultValue(e.strokeWidth,1),this.showGrid=Cesium.defaultValue(e.gridVisible,!0),this.gridColor=Cesium.defaultValue(e.gridColor,"rgba(125,125,125,1.0)"),this.showInner=Cesium.defaultValue(e.countryStrokeVisible,!0),this.innerColor=this.strokeColor;var t=Cesium.defaultValue(e.mapObject,void 0);if(!Cesium.defined(t))return console.log(" please input map object!");this.strokeDataSource=void 0,this.strokeCountrisData=void 0,this.map=t.map3D;var i=this;Cesium.GeoJsonDataSource.load(CGS_SDK_PATH+"assets/earthWeak/countries.json").then(function(e){i.strokeCountrisData=e,i.updateCountriesStroke(),i.strokeCountrisData.show=i.showInner&&i.show,i.map.dataSources.add(e)}).otherwise(function(e){window.alert(e)}),Cesium.GeoJsonDataSource.load(CGS_SDK_PATH+"assets/earthWeak/earth-top.json").then(function(e){i.strokeDataSource=e,i.updateStroke(),i.strokeDataSource.show=i.show,i.map.dataSources.add(e)}).otherwise(function(e){window.alert(e)}),this.earthGrid=new Cesium.FeGridPrimitive({color:this.gridColor,show:this.showGrid}),this.map.scene.primitives.add(this.earthGrid),this.updateMaterial(this.show)},CgsEarthWeak3D.prototype.updateStroke=function(){if(this.strokeDataSource)for(var e=this.strokeDataSource.entities.values,t=e.length,i=0;i<t;i++){var s=e[i];s.polyline&&(s.polyline.width=this.strokeWidth,s.polyline.material=Cesium.Color.fromCssColorString(this.strokeColor))}},CgsEarthWeak3D.prototype.updateCountriesStroke=function(){if(this.strokeCountrisData)for(var e=this.strokeCountrisData.entities.values,t=e.length,i=0;i<t;i++){var s=e[i];s.polygon&&(s.polygon.fill=!1,s.polygon.outlineColor=Cesium.Color.fromCssColorString(this.innerColor))}},CgsEarthWeak3D.prototype.getColorRamp=function(){var e=document.createElement("canvas");e.width=100,e.height=1;var t=e.getContext("2d");return t.fillStyle=this.color,t.fillRect(0,0,100,1),e},CgsEarthWeak3D.prototype.updateMaterial=function(e){var t=Cesium.VERSION,i=t.lastIndexOf(".");if(parseInt(t.substr(i+1,t.length))<41)return console.log("Cesium version must be more than 1.41");var s={},o=void 0;(s=(o=Cesium.Material.fromType("ElevationRamp")).uniforms).minHeight=-414,s.maxHeight=8777,s.image=this.getColorRamp(),this.map.scene.globe.material=e?o:void 0},CgsEarthWeak3D.prototype.setVisible=function(e){this.show=e,this.updateMaterial(e),this.strokeDataSource&&(this.strokeDataSource.show=e),this.strokeCountrisData&&(this.strokeCountrisData.show=this.showInner&&e),this.earthGrid&&(this.earthGrid.show=this.showGrid&&e),!e&&this.map&&this.map.setDefaultTerrain(),CgsSubPub.publish("earthWeak",[e])},CgsEarthWeak3D.prototype.getVisible=function(){return this.show},CgsEarthWeak3D.prototype.setColor=function(e){this.color=e,this.show&&this.updateMaterial(!0)},CgsEarthWeak3D.prototype.getColor=function(){return this.color},CgsEarthWeak3D.prototype.setStrokeColor=function(e){this.strokeColor=e,this.updateStroke();var t=this;setTimeout(function(){t.updateStroke()},50),this.setCountryColor(e)},CgsEarthWeak3D.prototype.getStrokeColor=function(){return this.strokeColor},CgsEarthWeak3D.prototype.setStrokeWidth=function(e){this.strokeWidth=e,this.updateStroke()},CgsEarthWeak3D.prototype.getStrokeWidth=function(){return this.strokeWidth},CgsEarthWeak3D.prototype.setGridVisible=function(e){this.showGrid=e,this.earthGrid&&this.show&&(this.earthGrid.show=e)},CgsEarthWeak3D.prototype.getGridVisible=function(){return this.showGrid},CgsEarthWeak3D.prototype.setGridColor=function(e){this.gridColor=e,this.earthGrid&&(this.earthGrid.color=e)},CgsEarthWeak3D.prototype.getGridColor=function(){return this.gridColor},CgsEarthWeak3D.prototype.setCountryVisible=function(e){this.showInner=e,this.strokeCountrisData&&this.show&&(this.strokeCountrisData.show=e)},CgsEarthWeak3D.prototype.getCountryVisible=function(){return this.showInner},CgsEarthWeak3D.prototype.setCountryColor=function(e){this.innerColor=e,this.updateCountriesStroke();var t=this;setTimeout(function(){t.updateCountriesStroke()},50)},CgsEarthWeak3D.prototype.getCountryColor=function(){return this.innerColor},CgsEarthWeak3D.prototype.remove=function(){this.map&&this.strokeDataSource&&this.map.dataSources.contains(this.strokeDataSource)&&(this.map.dataSources.remove(this.strokeDataSource),this.strokeDataSource=void 0),this.map&&this.strokeCountrisData&&this.map.dataSources.contains(this.strokeCountrisData)&&(this.map.dataSources.remove(this.strokeCountrisData),this.strokeCountrisData=void 0),this.earthGrid&&this.map.scene.primitives.remove(this.earthGrid),this.setVisible(!1)},CgsTerrainColour3D=function(e){this.show=Cesium.defaultValue(e.visible,!0);this.rampColor=Cesium.defaultValue(e.rampColor,["rgba(0,0,125,1.0)","rgba(0,0,255,1.0)","rgba(0,125,255,1.0)","rgba(215,215,62,1.0)","rgba(32,159,0,1.0)","rgba(204,179,120,1.0)","rgba(125,125,125,1.0)","rgba(255,255,255,1.0)"]);this.ramp=Cesium.defaultValue(e.ramp,[0,.375,.5,.5031,.5625,.6625,.875,1]),this.minHeight=Cesium.defaultValue(e.minHeight,-1600),this.maxHeight=Cesium.defaultValue(e.maxHeight,2500);var t=Cesium.defaultValue(e.mapObject,void 0);if(!Cesium.defined(t))return console.log(" please input map object!");this.graticuleMode=Cesium.defaultValue(e.graticuleMode,!1),this.graticuleColor=Cesium.defaultValue(e.graticuleColor,"rgba(218,177,37,1.0)"),this.map=t.map3D},CgsTerrainColour3D.prototype.setGraticuleMode=function(e){this.graticuleMode=e,this.map.scene.globe._surface.tileProvider.graticuleMode=e},CgsTerrainColour3D.prototype.setGraticuleColor=function(e){this.graticuleColor=e,this.map.scene.globe._surface.tileProvider.graticuleColor=Cesium.Color.fromCssColorString(e)},CgsTerrainColour3D.prototype.getColorRamp=function(){var e=document.createElement("canvas");e.width=100,e.height=1;for(var t=e.getContext("2d"),i=t.createLinearGradient(0,0,100,0),s=this.ramp,o=this.rampColor,a=Math.min(s.length,o.length),n=0;n<a;++n)i.addColorStop(s[n],o[n]);return t.fillStyle=i,t.fillRect(0,0,100,1),e},CgsTerrainColour3D.prototype.updateMaterial=function(e){var t=Cesium.VERSION,i=t.lastIndexOf(".");if(parseInt(t.substr(i+1,t.length))<41)return console.log("Cesium version must be more than 1.41");var s=this.minHeight,o=this.maxHeight,a={},n=void 0;(a=(n=Cesium.Material.fromType("ElevationRamp")).uniforms).minimumHeight=s,a.maximumHeight=o,a.image=this.getColorRamp(),this.map.scene.globe.material=e?n:void 0},CgsTerrainColour3D.prototype.setVisible=function(e){this.show=e,this.updateMaterial(e),e||this.map.setDefaultTerrain(),CgsSubPub.publish("terrainColour",[e])},CgsTerrainColour3D.prototype.getVisible=function(){return this.show},CgsTerrainColour3D.prototype.setRampColor=function(e){this.rampColor=e,this.show&&this.updateMaterial(!0)},CgsTerrainColour3D.prototype.getRampColor=function(){return this.rampColor},CgsTerrainColour3D.prototype.setRamp=function(e){this.ramp=e,this.show&&this.updateMaterial(!0)},CgsTerrainColour3D.prototype.getRamp=function(){return this.ramp},CgsTerrainColour3D.prototype.setMinHeight=function(e){this.minHeight=e,this.show&&this.updateMaterial(!0)},CgsTerrainColour3D.prototype.getMinHeight=function(){return this.minHeight},CgsTerrainColour3D.prototype.setMaxHeight=function(e){this.maxHeight=e,this.show&&this.updateMaterial(!0)},CgsTerrainColour3D.prototype.getMaxHeight=function(){return this.maxHeight},CgsTerrainColour3D.prototype.remove=function(){this.setVisible(!1),this.setGraticuleMode(!1)},CgsStar3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){this.show=Cesium.defaultValue(e.show,!0),this.type=CgsStar3D.Star,this.map=void 0;var t={show:this.show};this.star=new Cesium.FeStarPrimitive(t)}),CgsStar3D.prototype.setMap=function(e){this.map=e},CgsStar3D.prototype.getMap=function(){return this.map},CgsStar3D.prototype.getStarrySky=function(){return this.star},CgsStar3D.prototype.setVisible=function(e){this.show=e,this.star.show=e},CgsStar3D.prototype.getVisible=function(){return this.show},CgsStar3D.prototype.getType=function(){return this.type},CgsStar3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsStar3D.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsStar3D.Star="CgsStar3D",CgsOcean3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){this.map=e.mapObject,this.type=CgsOcean3D.Ocean,this.show=Cesium.defaultValue(e.show,!1),this.blendColor=Cesium.defaultValue(e.blendColor,new Cesium.Color(25/255,42/255,90/255,.5)),this.specularMap=Cesium.defaultValue(e.specularMap,require.toUrl(CGS_SDK_PATH+"assets/oceanTexture/earthspec1k.jpg")),this.normalMap=Cesium.defaultValue(e.normalMap,require.toUrl(CGS_SDK_PATH+"assets/oceanTexture/waterNormals.jpg")),this.animationSpeed=Cesium.defaultValue(e.animationsSpeed,.0032),this.frequency=Cesium.defaultValue(e.frequency,8500),this.amplitude=Cesium.defaultValue(e.amplitude,20),this.specularIntensity=Cesium.defaultValue(e.specularIntensity,.2),this.distanceDisplayCondition=Cesium.defaultValue(e.distanceDisplayCondition,[5e4,15e5]);var t={type:"Water",uniforms:{blendColor:this.blendColor,specularMap:this.specularMap,normalMap:this.normalMap,frequency:this.frequency,animationSpeed:this.animationSpeed,amplitude:this.amplitude,specularIntensity:this.specularIntensity}};this.ocean=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.RectangleGeometry({rectangle:Cesium.Rectangle.fromDegrees(-180,-90,180,90),vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT})}),appearance:new Cesium.EllipsoidSurfaceAppearance({aboveGround:!1,material:new Cesium.Material({fabric:t})}),show:!1});var i=this;CgsSubPub.subscribe("postrender",function(){var e,t;i.map&&(e=i.map.getHeight(),i.map.getOceanVisible()?(2==(t=i.distanceDisplayCondition.length)&&(e>i.distanceDisplayCondition[0]&&e<i.distanceDisplayCondition[1]?i.ocean.show=!0:i.ocean.show=!1),1==t&&(e>i.distanceDisplayCondition[0]?i.ocean.show=!0:i.ocean.show=!1)):i.ocean.show=!1)})}),CgsOcean3D.prototype.setMap=function(e){this.map=e},CgsOcean3D.prototype.getMap=function(){return this.map},CgsOcean3D.prototype.getOcean=function(){return this.ocean},CgsOcean3D.prototype.setVisible=function(e){this.show=e},CgsOcean3D.prototype.getVisible=function(){return this.show},CgsOcean3D.prototype.getType=function(){return this.type},CgsOcean3D.prototype.setVisibleHeight=function(e){this.distanceDisplayCondition=CgsFeature.checkVisibleHeight(e)},CgsOcean3D.prototype.getVisibleHeight=function(){return this.distanceDisplayCondition},CgsOcean3D.Ocean="CgsOcean3D",CgsSatelineManager3D=function(e){var t,i,s,o,a,n;e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),Cesium.defined(e.mapObject)?(this.map=e.mapObject,t=Cesium.defaultValue(e.url,CGS_SDK_PATH+"assets/sateline/satelliteDateExp.xml"),i=Cesium.defaultValue(e.modelUrl,CGS_SDK_PATH+"assets/sateline/ldcxwx.gltf"),s=Cesium.defaultValue(e.imageUrl,CGS_SDK_PATH+"assets/sateline/1.png"),this.speed=Cesium.defaultValue(e.speed,1),o=Cesium.defaultValue(e.pastColor,"rgba(0,255,0,1.0)"),this.pastColor=Cesium.Color.fromCssColorString(o),a=Cesium.defaultValue(e.predictColor,"rgba(255,0,0,1.0)"),this.predictColor=Cesium.Color.fromCssColorString(a),this.width=Cesium.defaultValue(e.width,2),this.beginTime=Cesium.defaultValue(e.beginTime,void 0),this.endTime=Cesium.defaultValue(e.endTime,void 0),this.state=Cesium.defaultValue(e.state,0),this.labelFont=Cesium.defaultValue(e.labelFont,"24px 微软雅黑"),this.labelFillColor=Cesium.defaultValue(e.labelFillColor,"rgba(255,217,39,1.0)"),this.labelStrokeColor=Cesium.defaultValue(e.labelStrokeColor,"rgba(255,255,255,1.0)"),this.labelOutlineWidth=Cesium.defaultValue(e.labelOutlineWidth,1),this.labelPixelOffset=Cesium.defaultValue(e.labelPixelOffset,[30,30]),this.labelStyle=Cesium.defaultValue(e.labelStyle,0),this.map.map3D.scene.logarithmicDepthBuffer=!1,n={url:t,modelUrl:i,imageUrl:s,speed:this.speed,pastColor:this.pastColor,predictColor:this.predictColor,mapObject:this.map.map3D,width:this.width,state:this.state,labelFont:this.labelFont,labelFillColor:this.labelFillColor,labelStrokeColor:this.labelStrokeColor,labelOutlineWidth:this.labelOutlineWidth,labelPixelOffset:this.labelPixelOffset,labelStyle:this.labelStyle,beginTime:this.strTimeToDate(this.beginTime),endTime:this.strTimeToDate(this.endTime)},this.satelineManager=new Cesium.FeSatelliteManager(n),this._setEvents(),this.selectSateline=void 0,this.selectEffect=new CgsSelectEffect3D,this.selectEffect.setMap(this.map.map3D)):console.info("please input mapObject!!")},CgsSatelineManager3D.prototype.strTimeToDate=function(e){var t=e.substr(0,4),i=e.substr(5,2),s=e.substr(8,2),o=e.substr(11,2),a=e.substr(14,2),n=e.substr(17,2),r=new Date;return r.setFullYear(parseInt(t)),r.setMonth(parseInt(i)-1),r.setDate(parseInt(s)),r.setHours(parseInt(o)),r.setMinutes(parseInt(a)),r.setSeconds(parseInt(n)),r},CgsSatelineManager3D.prototype.getSatelineManager=function(){return this.satelineManager},CgsSatelineManager3D.prototype._setEvents=function(){var a=this.map.map3D,n=this;this.clickEvent=CgsSubPub.subscribe("leftdown",function(e,t){var i,s,o;a&&(!(i=a.scene.pick(t))||(o=(o=i.id)||i.primitive.id)&&(o.model||o.label)&&(s=n.getModelFromName(o.name),!n.selectEffect||n.selectEffect.getStartState()&&n.selectSateline==s||(n.selectEffect.setVisible(!1),n.selectEffect.startEffect()),n.selectSateline=s))}),this.preRender=CgsSubPub.subscribe("preRender",function(e){var t,i,s,o,a;n.selectSateline&&(t=n.selectSateline.position.getValue(Cesium.JulianDate.now()),i=Cesium.Cartographic.fromCartesian(t),s=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),a=i.height,n.selectEffect&&n.selectEffect.setPosition([s,o,a]))})},CgsSatelineManager3D.prototype._unsetEvents=function(){this.clickEvent&&CgsSubPub.unsubscribe(this.clickEvent),this.preRender&&CgsSubPub.unsubscribe(this.preRender)},CgsSatelineManager3D.prototype.getMap=function(){return this.map},CgsSatelineManager3D.prototype.setSpeed=function(e){this.speed=e,this.satelineManager.speed=e},CgsSatelineManager3D.prototype.getSpeed=function(){return this.speed},CgsSatelineManager3D.prototype.setPastColor=function(e){this.pastColor=e,this.satelineManager.pastColor=Cesium.Color.fromCssColorString(e)},CgsSatelineManager3D.prototype.getPastColor=function(){return this.pastColor},CgsSatelineManager3D.prototype.setPredictColor=function(e){this.predictColor=e,this.satelineManager.predictColor=Cesium.Color.fromCssColorString(e)},CgsSatelineManager3D.prototype.getPredictColor=function(){return this.predictColor},CgsSatelineManager3D.prototype.setWidth=function(e){this.width=e,this.satelineManager.width=e},CgsSatelineManager3D.prototype.getWidth=function(){return this.width},CgsSatelineManager3D.prototype.setBeginTime=function(e){this.beginTime=e,this.satelineManager.beginTime=this.strTimeToDate(e)},CgsSatelineManager3D.prototype.getBeginTime=function(){return this.beginTime},CgsSatelineManager3D.prototype.setEndTime=function(e){this.endTime=e,this.satelineManager.endTime=this.strTimeToDate(e)},CgsSatelineManager3D.prototype.getEndTime=function(){return this.endTime},CgsSatelineManager3D.prototype.addSatelite=function(e){this.satelineManager.addSatelite(e),this.satelineManager.dirty()},CgsSatelineManager3D.prototype.addAllSatelite=function(){this.satelineManager.addAllSatelite(),this.satelineManager.dirty()},CgsSatelineManager3D.prototype.setOrbitVisible=function(e,t){this.satelineManager.setOrbitVisible(e,t)},CgsSatelineManager3D.prototype.getOrbitVisible=function(e){return this.satelineManager.getOrbitVisible(e)},CgsSatelineManager3D.prototype.setState=function(e){this.satelineManager.state=e},CgsSatelineManager3D.prototype.getNameList=function(){return this.satelineManager.sateliteNameList},CgsSatelineManager3D.prototype.getNameToSatelineInfo=function(){return this.satelineManager.sateliteInfoMap},CgsSatelineManager3D.prototype.getModelFromName=function(e){return this.satelineManager.modelMap.has(e)?this.satelineManager.modelMap.get(e):void 0},CgsSatelineManager3D.prototype.clear=function(){this._unsetEvents(),this.satelineManager.state=2;var e=this;setTimeout(function(){e.map.map3D.scene.primitives.remove(e.satelineManager)},100),this.map.map3D.scene.logarithmicDepthBuffer=!0},CgsSatelineModel3D=function(e){this.satelineManage=e,this.name=void 0,this.selectModel=void 0},CgsSatelineModel3D.prototype.getPosition=function(){if(this.selectModel){var e=this.selectModel.position.getValue(Cesium.JulianDate.now()),t=Cesium.Cartographic.fromCartesian(e);return[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude),t.height]}},CgsSatelineModel3D.prototype.getEntity=function(){return this.selectModel=this.satelineManage.getModelFromName(this.name),this.selectModel},CgsSatelineModel3D.prototype.setVisible=function(e){this.selectModel.show=e},CgsSatelineModel3D.prototype.setName=function(e){this.name=e},CgsSatelineModel3D.prototype.getType=function(){return"CgsModel"},CgsSelectEffect3D=function(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.position=e.position,this.position&&"[object Array]"==Object.prototype.toString.call(this.position)&&2===this.position.length&&this.position.push(0),this.url=Cesium.defaultValue(e.url,CGS_SDK_PATH+"assets/sateline/GMobileSelectIcon.png"),this.times=Cesium.defaultValue(e.times,3),this.period=Cesium.defaultValue(e.period,2),this.minScale=Cesium.defaultValue(e.minScale,.1),this.maxScale=Cesium.defaultValue(e.maxScale,1),this.visible=Cesium.defaultValue(e.visible,!0),this.map=void 0,this.effect=void 0,this.timeStamp=void 0,this.curScale=this.minScale,this.curTimes=0,this.startState=!1},CgsSelectEffect3D.prototype.scaleCallback=function(e){var t;this.effect&&((t=this).effect.billboard.scale=e?new Cesium.CallbackProperty(function(){return t.curScale},!0):new Cesium.CallbackProperty(function(){return t.curScale},!1))},CgsSelectEffect3D.prototype.setMap=function(e){var t;this.map=e,this.map&&!Cesium.defined(this.effect)&&(t={show:this.visible,billboard:{image:this.url}},this.position&&(t.position=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2])),this.effect=this.map.entities.add(t),this._setEvents())},CgsSelectEffect3D.prototype.getMap=function(){return this.map},CgsSelectEffect3D.prototype.setPosition=function(e){2==(this.position=e).length&&this.position.push(0),Cesium.defined(this.map)&&Cesium.defined(this.effect)&&(this.effect.position=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2]))},CgsSelectEffect3D.prototype.getPosition=function(){return this.position},CgsSelectEffect3D.prototype.setVisible=function(e){this.visible=e,this.effect&&(this.effect.show=e)},CgsSelectEffect3D.prototype.getVisible=function(){return this.visible},CgsSelectEffect3D.prototype.startEffect=function(){this.startState=!0,this.curTimes=0,this.curScale=0,this.scaleCallback(!1),this.setVisible(!0)},CgsSelectEffect3D.prototype.getStartState=function(){return this.startState},CgsSelectEffect3D.prototype.setTimes=function(e){this.times=e},CgsSelectEffect3D.prototype.getTimes=function(){return this.times},CgsSelectEffect3D.prototype.setPeriod=function(e){this.period=e},CgsSelectEffect3D.prototype.getPeriod=function(){return this.period},CgsSelectEffect3D.prototype.setMinScale=function(e){this.minScale=e},CgsSelectEffect3D.prototype.getMinScale=function(){return this.minScale},CgsSelectEffect3D.prototype.setMaxScale=function(e){this.maxScale=e},CgsSelectEffect3D.prototype.getMaxScale=function(){return this.maxScale},CgsSelectEffect3D.prototype.remove=function(){this.map&&this.effect&&(this.scaleCallback(!0),this.map.entities.remove(this.effect),this.effect=void 0,this._unsetEvents())},CgsSelectEffect3D.prototype._setEvents=function(){var t=this;this.render=CgsSubPub.subscribe("postRender",function(e){t.visible&&t.startState&&(Cesium.defined(t.timeStamp)&&(t.curScale+=1/60/t.period,t.curScale>=t.maxScale&&(t.curScale=t.minScale,0<t.times&&t.curTimes++),0<t.times&&t.curTimes>=t.times&&(t.curScale=0,t.startState=!1)),t.timeStamp=e.timeStamp)})},CgsSelectEffect3D.prototype._unsetEvents=function(){this.render&&CgsSubPub.unsubscribe(this.render)},CgsWideLine3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){if(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.positions=Cesium.defaultValue(e.positions,void 0),!Cesium.defined(this.positions))return console.info("please input positions!!");if(this.show=Cesium.defaultValue(e.show,!0),this.color=Cesium.defaultValue(e.color,"rgba(0.0,255.0,255.0,1.0)"),this.xTexSpeed=Cesium.defaultValue(e.xTexSpeed,.001),this.yTexSpeed=Cesium.defaultValue(e.yTexSpeed,0),this.animation=Cesium.defaultValue(e.animation,!0),this.useTexColor=Cesium.defaultValue(e.useTexColor,!1),this.width=Cesium.defaultValue(e.width,1e3),this.lineType=Cesium.defaultValue(e.lineType,CgsWideLine.LINE_SOLID),this.wideLineType=Cesium.defaultValue(e.wideLineType,CgsWideLine.WIDELINE_DISTANCE),this.lengthTexUint=Cesium.defaultValue(e.lengthTexUint,5e3),this.url=Cesium.defaultValue(e.url,void 0),this.interpolationNum=Cesium.defaultValue(e.interpolationNum,0),this.interpolationNum=Cesium.defaultValue(e.interpolationNum,0),this.lineType===CgsWideLine.LINE_USER_DEFINE&&!Cesium.defined(this.url))return console.info("please input url");var t={show:this.show,color:this.color,interpolationNum:this.interpolationNum,url:this.url,xTexSpeed:this.xTexSpeed,yTexSpeed:this.yTexSpeed,animation:this.animation,useTexColor:this.useTexColor,width:this.width,lineType:this.lineType,type:this.wideLineType,lengthTexUint:this.lengthTexUint,positions:this.positions,followSurface:!1};this.type=CgsWideLine3D.WideLine,this.wideLine=new Cesium.FeWideLine(t),this.saveFlag=!0,this.map=void 0}),CgsWideLine3D.prototype.setMap=function(e){this.map=e},CgsWideLine3D.prototype.getMap=function(){return this.map},CgsWideLine3D.prototype.setPosition=function(e){this.positions=e,this.wideLine.positions=e},CgsWideLine3D.prototype.getPosition=function(){return this.positions},CgsWideLine3D.prototype.setColor=function(e){this.color=e,this.wideLine.color=e},CgsWideLine3D.prototype.getColor=function(){return this.color},CgsWideLine3D.prototype.setTexSpeedX=function(e){this.xTexSpeed=e,this.wideLine.xTexSpeed=e},CgsWideLine3D.prototype.getTexSpeedX=function(){return this.xTexSpeed},CgsWideLine3D.prototype.setTexSpeedY=function(e){this.yTexSpeed=e,this.wideLine.yTexSpeed=e},CgsWideLine3D.prototype.getTexSpeedY=function(){return this.yTexSpeed},CgsWideLine3D.prototype.enableAnimation=function(e){this.animation=e,this.wideLine.animation=e},CgsWideLine3D.prototype.setWidth=function(e){this.width=e,this.wideLine.width=e},CgsWideLine3D.prototype.getWidth=function(){return this.width},CgsWideLine3D.prototype.setLengthTexUint=function(e){this.lengthTexUint=e,this.wideLine.lengthTexUint=e},CgsWideLine3D.prototype.getLengthTexUint=function(){return this.lengthTexUint},CgsWideLine3D.prototype.getWideLine=function(){return Cesium.defined(this.wideLine)||this._updateGeometry(),this.wideLine},CgsWideLine3D.prototype.setWideLine=function(){this.wideLine=void 0},CgsWideLine3D.prototype.getType=function(){return this.type},CgsWideLine3D.prototype.setVisible=function(e){this.show=e,this.wideLine.show=e},CgsWideLine3D.prototype.getVisible=function(){return this.show},CgsWideLine3D.prototype._updateGeometry=function(){this.getVisible();var e=this.getMap();e instanceof CgsMap&&(e=e.map3D),Cesium.defined(e)&&e instanceof CgsMap3D&&e.scene.primitives.contains(this.wideline)&&(e.scene.primitives.remove(this.wideline),this.wideline=void 0);var t={show:this.show,url:this.url,color:this.color,xTexSpeed:this.xTexSpeed,yTexSpeed:this.yTexSpeed,animation:this.animation,useTexColor:this.useTexColor,width:this.width,lineType:this.lineType,type:this.wideLineType,lengthTexUint:this.lengthTexUint,positions:this.positions};this.wideLine=new Cesium.FeWideLine(t),Cesium.defined(e)&&e.scene.primitives.add(this.wideLine)},CgsWideLine3D.prototype.getSaveFlag=function(){return this.saveFlag},CgsWideLine3D.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsWideLine3D.WideLine="CgsWideLine",CgsTerrainClip3D=function(e){var t;e.type="CgsTerrainClip",this._show=Cesium.defaultValue(e.visible,!0),this._map=Cesium.defaultValue(e.mapObject,void 0),Cesium.defined(this._map)&&(t={show:this._show},this._terrainClip=new Cesium.FeTerrainClip(t),this._map.scene.primitives.add(this._terrainClip))},CgsTerrainClip3D.prototype.setRegion=function(e){this._terrainClip&&this._terrainClip.setRegion(e)},CgsTerrainClip3D.prototype.getRegions=function(){return this._terrainClip.regions()},CgsTerrainClip3D.prototype.setVisible=function(e){this._terrainClip.show=e},CgsTerrainClip3D.prototype.getVisible=function(){return this._terrainClip.show},CgsTerrainClip3D.prototype.deleteAllRegion=function(){return this._terrainClip.deleteAllRegion()},CgsTerrainClipTool3D=function(e){var c;function s(e){var t,i,s,o,a,n,r,l=e.screenSpaceEventHandler._element.index,u=0==l?c._pixelToLonLat(e.position):c.mv_pixelToLonLat(e.position,l-1);null!=u&&(t=u[0],i=u[1],c._state.positionList.push([t,i]),c._drawPickPoint(e.position,l),s=0==l?c._pixelToCartographic(e.position):c.mv_pixelToCartographic(e.position,l-1),c._state.positionlla.push(s),o=[],(o=c._state.positionlla.slice(0)).push(s),a=c._map.getTerrain(),c._map&&(a instanceof CgsTerrain3D||a instanceof CgsTileTerrain3D)?Cesium.when(Cesium.sampleTerrain(c._map.terrainProvider,a.level,o),function(e){for(var t=[],i=e.length,s=0;s<i;++s){var o=e[s],a=[Cesium.Math.toDegrees(o.longitude),Cesium.Math.toDegrees(o.latitude),o.height];t.push(a)}var n={positions:t,fillColor:c._fillColor,outline:!1};c._polygonObj?c._polygonObj.setPosition(t):(c._polygonObj=new CgsPolygon3D(n),c._map.addFeature(c._polygonObj),c._polygonObj._posUpdateCallback(!1))}):((n=c._state.positionList.slice(0)).push([t,i]),r={positions:n,fillColor:c._fillColor,outline:!1},c._polygonObj?c._polygonObj.setPosition(n):(c._polygonObj=new CgsPolygon3D(r),c._map.addFeature(c._polygonObj),c._polygonObj._posUpdateCallback(!1))))}function o(e,t){}function a(e){var t,i,s,o,a,n,r,l,u;c._state.positionList.length<2||null!=(i=0==(t=e.screenSpaceEventHandler._element.index)?c._pixelToLonLat(e.position):c.mv_pixelToLonLat(e.position,t-1))&&(s=i[0],o=i[1],c._drawPickPoint(e.position,t),a=0==t?c._pixelToCartographic(e.position):c.mv_pixelToCartographic(e.position,t-1),n=[],(n=c._state.positionlla.slice(0)).push(a),r=c._map.getTerrain(),c._map&&(r instanceof CgsTerrain3D||r instanceof CgsTileTerrain3D)?Cesium.when(Cesium.sampleTerrain(c._map.terrainProvider,r.level,n),function(e){for(var t=void 0,i=void 0,s=[],o=e.length,a=0;a<o;++a){var n=e[a],r=Cesium.Math.toDegrees(n.longitude),l=Cesium.Math.toDegrees(n.latitude),u=n.height,p=[r,l,u];s.push(p),void 0===t&&(t=u),t=Math.min(t,u),void 0===i&&(i=u),i=Math.max(i,u)}var h={positions:s,fillColor:c._fillColor,outline:!1};c._polygonObj?c._polygonObj.setPosition(s):(c._polygonObj=new CgsPolygon3D(h),c._map.addFeature(c._polygonObj)),c.remove(),c._terrainClip&&(h={positions:s,minAlt:t,maxAlt:i,terrainMode:c.getTerrainMode(),parameter:c.getParameter()},c._terrainClip.setRegion(h))}):(c._state.positionList.push([s,o]),l=c._state.positionList.slice(0),c._terrainClip&&(u={positions:l,terrainMode:c.getTerrainMode(),parameter:c.getParameter()},c._terrainClip.setRegion(u)),c._polygonObj&&(c._polygonObj.setPosition(l),c._polygonObj._posUpdateCallback(!0)),c.remove()))}this._map=Cesium.defaultValue(e.mapObject.map3D,void 0),Cesium.defined(this._map)&&(this._terrainClip=Cesium.defaultValue(e.terrainClip,void 0),Cesium.defined(this._terrainClip)&&(this._terrainMode=Cesium.defaultValue(e.terrainMode,0),this._parameter=Cesium.defaultValue(e.parameter,5e3),this._fillColor=Cesium.defaultValue(e.fillColor,"rgba(255.0,255.0,0.0,0.3)"),this._type=e.type,(c=this)._state={positionList:[],pointList:[],positionlla:[]},this._polygonObj=void 0,this.activate=function(){if(this._map.screenSpaceEventHandler.setInputAction(s,Cesium.ScreenSpaceEventType.LEFT_CLICK),this._map.screenSpaceEventHandler.setInputAction(o,Cesium.ScreenSpaceEventType.MOUSE_MOVE),this._map.screenSpaceEventHandler.setInputAction(a,Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._map.isMultiViewsMode)for(var e=this._map.scene.allViewports.length,t=0;t<e;++t){var i=this._map.scene.allViewports[t].screenSpaceEventHandler;i.setInputAction(s,Cesium.ScreenSpaceEventType.LEFT_CLICK),i.setInputAction(o,Cesium.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction(a,Cesium.ScreenSpaceEventType.RIGHT_CLICK)}}))},CgsTerrainClipTool3D.prototype.deactivate=function(){if(this._map.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this._map.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),this._map.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._map.pickerActivate(),this._map.isMultiViewsMode){for(var e=this._map.scene.allViewports.length,t=0;t<e;++t){var i=this._map.scene.allViewports[t].screenSpaceEventHandler;i.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),i.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),i.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)}this._map.handleMultiViewsEvent()}},CgsTerrainClipTool3D.prototype.remove=function(){for(var e=this,t=0;t<e._state.pointList.length;t++)e._map.removeFeature(e._state.pointList[t]);e._state.pointList=[],e._state.positionList=[],e._state.positionlla=[],e._polygonObj&&(e._polygonObj._posUpdateCallback(!0),e._map.removeFeature(e._polygonObj),e._polygonObj=void 0)},CgsTerrainClipTool3D.prototype._drawPickPoint=function(e,t){var o=this,i=0==t?o._map.scene._camera0.getPickRay(e):o._map.scene.allViewports[t-1].camera.getPickRay(e),s=o._map.scene.globe.pick(i,o._map.scene),a=Cesium.Cartographic.fromCartesian(s),n=[];n.push(a);var r,l,u=o._map.getTerrain();o._map&&(u instanceof CgsTerrain3D||u instanceof CgsTileTerrain3D)?Cesium.when(Cesium.sampleTerrain(o._map.terrainProvider,u.level,n),function(e){var t=e[0],i={position:[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude),t.height],fillColor:"rgba(255.0,255.0,0.0,1.0)",heightReference:CgsPoint.CLAMP_TO_GROUND,outlineWidth:0,pixelSize:2.5},s=new CgsPoint3D(i);s.setVisibleHeight([0,2e5]),s.setSaveFlag(!1),o._map.addFeature(s),o._state.pointList.push(s)}):(r={position:[Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude),a.height],fillColor:"rgba(255.0,255.0,0.0,1.0)",heightReference:CgsPoint.CLAMP_TO_GROUND,outlineWidth:0,pixelSize:2.5},(l=new CgsPoint3D(r)).setVisibleHeight([0,2e5]),l.setSaveFlag(!1),o._map.addFeature(l),o._state.pointList.push(l))},CgsTerrainClipTool3D.prototype._pixelToLonLat=function(e){var t=this._map.scene._camera0.getPickRay(e),i=this._map.scene.globe.pick(t,this._map.scene);if(Cesium.defined(i)){var s=Cesium.Cartographic.fromCartesian(i),o=Cesium.Math.toDegrees(s.longitude),a=Cesium.Math.toDegrees(s.latitude);s.height;return[o,a]}},CgsTerrainClipTool3D.prototype.mv_pixelToLonLat=function(e,t){var i=this._map.scene.allViewports[t].camera.getPickRay(e),s=this._map.scene.globe.pick(i,this._map.scene);if(Cesium.defined(s)){var o=Cesium.Cartographic.fromCartesian(s),a=Cesium.Math.toDegrees(o.longitude),n=Cesium.Math.toDegrees(o.latitude);o.height;return[a,n]}},CgsTerrainClipTool3D.prototype._pixelToCartographic=function(e){var t=this._map,i=t.scene._camera0.getPickRay(e),s=t.scene.globe.pick(i,t.scene);return Cesium.Cartographic.fromCartesian(s)},CgsTerrainClipTool3D.prototype.mv_pixelToCartographic=function(e,t){var i=this._map,s=i.scene.allViewports[t].camera.getPickRay(e),o=i.scene.globe.pick(s,i.scene);return Cesium.Cartographic.fromCartesian(o)},CgsTerrainClipTool3D.prototype.setTerrainMode=function(e){this._terrainMode=e},CgsTerrainClipTool3D.prototype.getTerrainMode=function(){return this._terrainMode},CgsTerrainClipTool3D.prototype.setParameter=function(e){this._parameter=e},CgsTerrainClipTool3D.prototype.getParameter=function(){return this._parameter},CgsTerrainClipTool3D.prototype.deleteAllRegion=function(){this._terrainClip&&this._terrainClip.deleteAllRegion()},CgsAircraftCockpit3D=function(e){this.show=Cesium.defaultValue(e.visible,!0),this.url=e.url,this.position=Cesium.defaultValue(e.position,[0,0,0]),this.dialShow=Cesium.defaultValue(e.dialVisible,!0),this.speed=Cesium.defaultValue(e.speed,200),this.cockpitHeight=Cesium.defaultValue(e.cockpitHeight,5e3),this.cockpitHeading=Cesium.defaultValue(e.cockpitHeading,0);var t=Cesium.defaultValue(e.mapObject,void 0);if(!Cesium.defined(t))return console.log(" please input map object!");this.map=t,this.entity=void 0,this.createCockpitModel()},CgsAircraftCockpit3D.prototype.createCockpitModel=function(){var e,t;Cesium.defined(this.entity)||(e=void 0,2===this.position.length?e=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],0):3===this.position.length&&(e=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2])),t={name:"座舱",position:e,model:{uri:this.url,plateVisible:this.dialShow,minimumPixelSize:128,maximumScale:2e4,cockpitSpeed:this.speed,cockpitHeight:this.cockpitHeight,cockpitHeading:this.cockpitHeading}},this.entity=new Cesium.Entity(t),this.map.entities.add(this.entity))},CgsAircraftCockpit3D.prototype.setVisible=function(e){this.entity&&(this.entity.show=e,this.show=e)},CgsAircraftCockpit3D.prototype.getVisible=function(){return this.show},CgsAircraftCockpit3D.prototype.setDialVisible=function(e){this.entity&&(this.entity.model.plateVisible=e,this.dialShow=e)},CgsAircraftCockpit3D.prototype.getDialVisible=function(){return this.dialShow},CgsAircraftCockpit3D.prototype.remove=function(){this.entity&&this.map&&(this.map.entities.remove(this.entity),this.entity=void 0)};var scratchCockpitPosition=new Cesium.Cartesian3;CgsAircraftCockpit3D.prototype.setPosition=function(e){var t;this.entity&&(this.position=e,this.map.manipulate.manipulteType===CgsManipulate3D.MANIPULATE_COCKPIT&&(2===this.position.length?scratchCockpitPosition=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],0):3===this.position.length&&(scratchCockpitPosition=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2])),this.entity.position=scratchCockpitPosition,t=0,e[2]&&(t=e[2]),this.cockpitHeight=t,this.entity.model.cockpitHeight=t))},CgsAircraftCockpit3D.prototype.getPosition=function(){return this.position};var scratchCockpitHpr=new Cesium.HeadingPitchRoll;CgsAircraftCockpit3D.prototype.setRotation=function(e){if(this.entity){this.rotation=e,2===this.position.length?scratchCockpitPosition=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],0):3===this.position.length&&(scratchCockpitPosition=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2]));for(var t=[0,0,0],i=0;i<this.rotation.length;i++)t[i]=Cesium.Math.toRadians(this.rotation[i]);scratchCockpitHpr.heading=t[0],scratchCockpitHpr.pitch=t[1],scratchCockpitHpr.roll=0;var s=Cesium.Transforms.headingPitchRollQuaternion(scratchCockpitPosition,scratchCockpitHpr);this.entity.orientation=s,this.cockpitHeading=e[0],this.entity.model.cockpitHeading=e[0]}},CgsAircraftCockpit3D.prototype.getRotation=function(){return this.rotation},CgsAircraftCockpit3D.prototype.setSpeed=function(e){this.entity&&(this.speed=e,this.entity.model.cockpitSpeed=e)},CgsAircraftCockpit3D.prototype.getSpeed=function(){return this.speed},CgsAircraftCockpit3D.prototype.getEntity=function(){return this.entity},CgsFlightLine3D=function(e){if(this.url=Cesium.defaultValue(e.url,""),this.show=Cesium.defaultValue(e.show,!0),this.warningLineVisible=Cesium.defaultValue(e.warningLineVisible,!1),this.verticalLineVisible=Cesium.defaultValue(e.verticalLineVisible,!1),this.positions=Cesium.defaultValue(e.positions,void 0),Cesium.defined(this.positions)){this.flightColor=Cesium.defaultValue(e.flightColor,"rgba(0.0,255,255.0,0.6)"),this.slopeColor=Cesium.defaultValue(e.slopeColor,"rgba(125.0,125.0,125.0,0.8)"),this.dangerLineColor=Cesium.defaultValue(e.dangerLineColor,"rgba(255.0,0.0,0.0,1.0)"),this.warningLineColor=Cesium.defaultValue(e.warningLineColor,"rgba(255.0,255.0,0.0,1.0)"),this.verticalLineColor=Cesium.defaultValue(e.verticalLineColor,"rgba(0.0,255,0.0,1.0)"),this.flightWidth=Cesium.defaultValue(e.flightWidth,5e3),this.verticalLineWidth=Cesium.defaultValue(e.verticalLineWidth,2),this.warningLineHeight=Cesium.defaultValue(e.warningLineHeight,5e3),this.dangerLineHeight=Cesium.defaultValue(e.dangerLineHeight,1e4),this.map=void 0,this.batchPrimitive;for(var t=new Cesium.PrimitiveCollection,i=this.positions,s=i.length,o=0,a=[],n=0;n<s;++n){var r=i[n],l=r.length;o+=r.length,a.push(r.slice(0));var u,p=!1;1e6<o&&(o=l,u={positions:a.slice(0,a.length-2),flightColor:this.flightColor,slopeColor:this.slopeColor,dangerLineColor:this.dangerLineColor,warningLineColor:this.warningLineColor,verticalLineColor:this.verticalLineColor,flightWidth:this.flightWidth,verticalLineWidth:this.verticalLineWidth,warningLineHeight:this.warningLineHeight,dangerLineHeight:this.dangerLineHeight,batchMaxNum:1e6,show:this.show},t.add(new Cesium.FeFlightLine(u)),u.show=this.verticalLineVisible,t.add(new Cesium.FeVerticalLine(u)),a=a.slice(a.length-2,a.length-1),p=!0),n!==s-1||p||(u={positions:a.slice(0),flightColor:this.flightColor,slopeColor:this.slopeColor,dangerLineColor:this.dangerLineColor,warningLineColor:this.warningLineColor,verticalLineColor:this.verticalLineColor,flightWidth:this.flightWidth,verticalLineWidth:this.verticalLineWidth,warningLineHeight:this.warningLineHeight,dangerLineHeight:this.dangerLineHeight,batchMaxNum:1e6,show:this.show},t.add(new Cesium.FeFlightLine(u)),u.show=this.verticalLineVisible,t.add(new Cesium.FeVerticalLine(u)))}this.batchPrimitive=t}},CgsFlightLine3D.prototype.setVisible=function(e){this.show=e;for(var t=this.batchPrimitive&&this.batchPrimitive.length,i=0;i<t;++i){this.batchPrimitive.get(i).show=e}},CgsFlightLine3D.prototype.getVisible=function(){return this.show},CgsFlightLine3D.prototype.setWarningLineVisible=function(e){this.warningLineVisible=e;for(var t=this.batchPrimitive&&this.batchPrimitive.length,i=0;i<t;++i){var s=this.batchPrimitive.get(i);s instanceof Cesium.FeFlightLine&&(s.warningLineVisible=e)}},CgsFlightLine3D.prototype.getWarningLineVisible=function(){return this.warningLineVisible},CgsFlightLine3D.prototype.setVerticalLineVisible=function(e){this.verticalLineVisible=e;for(var t=this.batchPrimitive&&this.batchPrimitive.length,i=0;i<t;++i){var s=this.batchPrimitive.get(i);s instanceof Cesium.FeVerticalLine&&(s.show=e)}},CgsFlightLine3D.prototype.getVerticalLineVisible=function(){return this.verticalLineVisible},CgsFlightLine3D.prototype.getPrimitive=function(){return this.batchPrimitive},CgsFlightLine3D.prototype.setFlightColor=function(e){for(var t=this.batchPrimitive&&this.batchPrimitive.length,i=0;i<t;++i){var s=this.batchPrimitive.get(i);s instanceof Cesium.FeFlightLine&&(s._flightColor=e)}this.flightColor=e},CgsFlightLine3D.prototype.getFlightColor=function(){return this.flightColor},CgsFlightLine3D.prototype.setSlopeColor=function(e){for(var t=this.batchPrimitive&&this.batchPrimitive.length,i=0;i<t;++i){var s=this.batchPrimitive.get(i);s instanceof Cesium.FeFlightLine&&(s.slopeColor=e)}this.slopeColor=e},CgsFlightLine3D.prototype.getSlopeColor=function(){return this.slopeColor},CgsFlightLine3D.prototype.setDangerLineColor=function(e){for(var t=this.batchPrimitive&&this.batchPrimitive.length,i=0;i<t;++i){var s=this.batchPrimitive.get(i);s instanceof Cesium.FeFlightLine&&(s.dangerLineColor=e)}this.dangerLineColor=e},CgsFlightLine3D.prototype.getDangerLineColor=function(){return this.dangerLineColor},CgsFlightLine3D.prototype.setWarningLineColor=function(e){for(var t=this.batchPrimitive&&this.batchPrimitive.length,i=0;i<t;++i){var s=this.batchPrimitive.get(i);s instanceof Cesium.FeFlightLine&&(s.warningLineColor=e)}this.warningLineColor=e},CgsFlightLine3D.prototype.getWarningLineColor=function(){return this.warningLineColor},CgsFlightLine3D.prototype.setVerticalLineColor=function(e){for(var t=this.batchPrimitive&&this.batchPrimitive.length,i=0;i<t;++i){var s=this.batchPrimitive.get(i);s instanceof Cesium.FeVerticalLine&&(s.verticalLineColor=e)}this.verticalLineColor=e},CgsFlightLine3D.prototype.getVerticalLineColor=function(){return this.verticalLineColor},CgsFlightLine3D.prototype.getType=function(){return CgsFlightLine3D.FlightLine},CgsFlightLine3D.prototype.setMap=function(e){this.map=e},CgsFlightLine3D.prototype.getMap=function(){return this.map},CgsFlightLine3D.FlightLine="flightline",CgsStreetMap3D=function(e){var t,i,s,o,a,n,r,l;this.map=void 0,this.imageurl=CGS_SDK_PATH+"assets/image/JieJing/050318081506300000136.jpg",Cesium.defined(e.mapObject)&&(this.map=e.mapObject.map3D,this.id=136,this.imageFilePath=Cesium.defaultValue(e.imageFilePath,this.imageurl),this.radius=Cesium.defaultValue(e.radius,100),this.show=Cesium.defaultValue(e.show,!1),this.iconFilePath=Cesium.defaultValue(e.iconFilePath,CGS_SDK_PATH+"assets/image/JieJing/camera.png"),this.position=Cesium.defaultValue(e.position,[116.35709,39.8978,100]),t=new Cesium.Material({fabric:{type:"Image",uniforms:{image:this.imageFilePath}}}),this._material=t,this.initPosition=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2]),this.camCenter=Cesium.Cartesian3.clone(this.initPosition),this.camHeading=0,this.camPitch=0,this.invModelMatrix=new Cesium.Matrix4,this.modelMatrix=new Cesium.Matrix4,i=Cesium.Matrix3.fromRotationX(Cesium.Math.toRadians(90)),this.modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this.initPosition),this.modelMatrix=Cesium.Matrix4.multiplyByMatrix3(this.modelMatrix,i,this.modelMatrix),s=Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(-90)),this.modelMatrix=Cesium.Matrix4.multiplyByMatrix3(this.modelMatrix,s,this.modelMatrix),this.invModelMatrix=Cesium.Matrix4.inverse(this.modelMatrix,this.invModelMatrix),this.initUp=new Cesium.Cartesian3,this.initUp=Cesium.Cartesian3.normalize(this.initPosition,this.initUp),this.up=new Cesium.Cartesian3,this.direction=new Cesium.Cartesian3,this.up=Cesium.Cartesian3.clone(this.initUp),this.direction=Cesium.Matrix4.multiplyByPointAsVector(this.modelMatrix,Cesium.Cartesian3.UNIT_X,this.direction),this.direction=Cesium.Cartesian3.negate(this.direction,this.direction),o={position:this.initPosition,radius:this.radius,show:this.show,material:this._material,modelMatrix:this.modelMatrix},this.primitive=new Cesium.FePanoramaPrimitive(o),this.map.scene.primitives.add(this.primitive),this.arrowPosition=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],60),a=new Cesium.Material({fabric:{type:"Image",uniforms:{image:CGS_SDK_PATH+"assets/image/JieJing/up.png"}}}),n=Cesium.Matrix3.fromRotationX(Cesium.Math.toRadians(14)),this.arrowModelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this.arrowPosition),this.arrowModelMatrix=Cesium.Matrix4.multiplyByMatrix3(this.arrowModelMatrix,n,this.arrowModelMatrix),r=this.createArrowGeometry(),l=this.createArrowFrame(),this.arrow=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:r}),appearance:new Cesium.MaterialAppearance({material:a}),modelMatrix:this.arrowModelMatrix,show:this.show,asynchronous:!1}),this.map.scene.primitives.add(this.arrow),this.arrowFrame=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:l}),appearance:new Cesium.MaterialAppearance({material:Cesium.Material.fromType("Color",{color:Cesium.Color.DARKGREY})}),modelMatrix:this.arrowModelMatrix,show:this.show,asynchronous:!1}),this.map.scene.primitives.add(this.arrowFrame))},CgsStreetMap3D.prototype.setImageUrl=function(e){this.imageurl=e},CgsStreetMap3D.prototype.createArrowGeometry=function(){var e=new Float64Array([-.02*this.radius,.83*this.radius,0,.02*this.radius,.75*this.radius,0,-.06*this.radius,.75*this.radius,0,0,.75*this.radius,0,0,.7*this.radius,0,-.04*this.radius,.7*this.radius,0,-.04*this.radius,.75*this.radius,0]),t=new Uint16Array([0,1,2,3,4,5,3,5,6]),i=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]),s=new Float32Array([.5,1,1,.5,0,.5,.75,.5,.75,0,.25,0,.25,.5]),o=new Cesium.GeometryAttributes;return o.position=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e}),o.normal=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:i}),o.st=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:s}),new Cesium.Geometry({attributes:o,indices:t,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO,this.radius)})},CgsStreetMap3D.prototype.createArrowFrame=function(){var e=new Float64Array([-.02*this.radius,.836*this.radius,0,-.02*this.radius,.83*this.radius,0,-.019*this.radius,.835*this.radius,0,.023*this.radius,.75*this.radius,0,.02*this.radius,.75*this.radius,0,.023*this.radius,.748*this.radius,0,.022*this.radius,.746*this.radius,0,.002*this.radius,.746*this.radius,0,0,.75*this.radius,0,.002*this.radius,.7*this.radius,0,0,.7*this.radius,0,.0015*this.radius,.697*this.radius,0,0,.696*this.radius,0,-.04*this.radius,.696*this.radius,0,-.04*this.radius,.7*this.radius,0,-.0415*this.radius,.6965*this.radius,0,-.042*this.radius,.7*this.radius,0,-.042*this.radius,.746*this.radius,0,-.04*this.radius,.75*this.radius,0,-.062*this.radius,.746*this.radius,0,-.06*this.radius,.75*this.radius,0,-.063*this.radius,.748*this.radius,0,-.063*this.radius,.75*this.radius,0,-.021*this.radius,.835*this.radius,0]),t=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]),i=new Uint16Array([0,1,2,2,1,3,3,1,4,3,4,5,5,4,6,6,4,7,7,4,8,7,8,9,9,8,10,9,10,11,11,10,12,12,10,14,12,14,13,13,14,15,15,14,16,16,14,18,16,18,17,17,18,19,19,18,20,19,20,21,21,20,22,22,20,23,23,20,1,23,1,0]),s=new Cesium.GeometryAttributes;return s.position=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e}),s.normal=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:t}),new Cesium.Geometry({attributes:s,indices:i,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO,this.radius)})},CgsStreetMap3D.prototype.setVisible=function(e){this.show=e,this.primitive.show=e,this.arrow.show=e,this.arrowFrame.show=e},CgsStreetMap3D.prototype.destroy=function(){this.map.scene.primitives.remove(this.primitive),this.map.scene.primitives.remove(this.arrow),this.map.scene.primitives.remove(this.arrowFrame)},CgsGroundMeasure3D=function(e){var t=this;t.map=Cesium.defaultValue(e&&e.map,window.map),t.measureManager={mouseHandler:void 0,allEntities:[],labelEntities:[],mouseClickPoints:[],mouseClickLines:[],mouseClickPolygon:[],mouseClickVolume:[],mouseMoveLines:[],mouseMovePolygon:[],mouseMoveVolume:[]},Object.defineProperties(t.measureState={},{groundMeasureCoordinate:{set:function(e){e&&t.removeAllGroundMeasure()}},groundMeasureHeight:{set:function(e){e&&t.removeAllGroundMeasure()}},groundMeasureDistance:{set:function(e){e&&t.removeAllGroundMeasure()}},groundMeasurePerimeter:{set:function(e){e&&t.removeAllGroundMeasure()}},groundMeasureArea:{set:function(e){e&&t.removeAllGroundMeasure()}},groundMeasureVolume:{set:function(e){e&&t.removeAllGroundMeasure()}}})},CgsGroundMeasure3D.prototype.groundMeasureCoordinate=function(c){var g=this;g.measureState.groundMeasureCoordinate=!0;var d=g.map.map3D,m=d.scene;m.globe.depthTestAgainstTerrain=!0,map.container.style.cursor="crosshair";var f=g.measureManager;f.mouseHandler=new Cesium.ScreenSpaceEventHandler(m.canvas),f.mouseHandler.setInputAction(function(e){var t,i,s,o,a,n,r,l,u,p,h;e.position&&(t=m.pickPosition(e.position),u={},Cesium.defined(t)&&(i=Cesium.Cartographic.fromCartesian(t),s=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),a=(new CgsSampleAltitude).sampleAltitude([s,o])[2],f.mouseClickPoints.push({lon:s,lat:o,alt:a}),n=f.mouseClickPoints[0].lon.toFixed(8),r=f.mouseClickPoints[0].lat.toFixed(8),l=f.mouseClickPoints[0].alt.toFixed(4),u={lon:parseFloat(n),lat:parseFloat(r),alt:parseFloat(l)},p="经度："+n+" 纬度："+r+" 高程："+l+"m",g.drawPoint(f.mouseClickPoints[0]),h=d.entities.add({position:Cesium.Cartesian3.fromDegrees(f.mouseClickPoints[0].lon,f.mouseClickPoints[0].lat,f.mouseClickPoints[0].alt+1),label:g.labelStyle(p)}),f.labelEntities.push(h),f.allEntities.push(h)),f.mouseHandler||(f.mouseHandler.destroy(),f.mouseHandler=null),d.entities.remove(f.mouseMoveLines[f.mouseMoveLines.length-1]),f.mouseClickPoints=[],c&&c(u))},Cesium.ScreenSpaceEventType.LEFT_CLICK)},CgsGroundMeasure3D.prototype.groundMeasureHeight=function(a){var g=this;g.measureState.groundMeasureHeight=!0;var d=g.map.map3D,m=d.scene;m.globe.depthTestAgainstTerrain=!0,map.container.style.cursor="crosshair";var f=0,C=new Map,y=g.measureManager;y.mouseHandler=new Cesium.ScreenSpaceEventHandler(m.canvas),y.mouseHandler.setInputAction(function(e){var t,i,s,o,a,n,r,l,u,p,h,c;e.position&&(t=void 0,i=e.position+"",C.has(i)?t=C.get(i):(t=m.pickPosition(e.position),C.set(i,t)),Cesium.defined(t)&&(s=Cesium.Cartographic.fromCartesian(t),o=Cesium.Math.toDegrees(s.longitude),a=Cesium.Math.toDegrees(s.latitude),n=(new CgsSampleAltitude).sampleAltitude([o,a])[2],y.mouseClickPoints.push({lon:o,lat:a,alt:n}),1===y.mouseClickPoints.length&&(g.drawPoint(y.mouseClickPoints[0]),r=d.entities.add({position:Cesium.Cartesian3.fromDegrees(y.mouseClickPoints[0].lon,y.mouseClickPoints[0].lat,y.mouseClickPoints[0].alt+1),label:g.labelStyle("起点")}),y.labelEntities.push(r),y.allEntities.push(r)),g.drawPoint(y.mouseClickPoints[y.mouseClickPoints.length-1]),1<y.mouseClickPoints.length&&(l=y.mouseClickPoints[y.mouseClickPoints.length-1],u=y.mouseClickPoints[y.mouseClickPoints.length-2],g.drawLine(u,l),p=(u.alt>l.alt?1:-1)*Math.abs(u.alt-l.alt),f+=p,h="",h=1e3<Math.abs(h)?"高差："+(p/1e3).toFixed(2)+" km":"高差："+p.toFixed(2)+" m",c=d.entities.add({position:Cesium.Cartesian3.fromDegrees(l.lon,l.lat,l.alt+1),label:g.labelStyle(h)}),y.labelEntities.push(c),y.allEntities.push(c))))},Cesium.ScreenSpaceEventType.LEFT_CLICK),y.mouseHandler.setInputAction(function(e){var t,i=m.pickPosition(e.endPosition);Cesium.defined(i)&&(t=new Cesium.Cartographic.fromCartesian(i),1<=y.mouseClickPoints.length&&(Cesium.Math.toDegrees(t.longitude).toFixed(5)===Cesium.Math.toDegrees(d.camera.positionCartographic.longitude).toFixed(5)&&Cesium.Math.toDegrees(t.latitude).toFixed(5)===Cesium.Math.toDegrees(d.camera.positionCartographic.latitude).toFixed(5)||(0!==y.mouseMoveLines.length&&(d.entities.remove(y.mouseMoveLines[y.mouseMoveLines.length-1]),y.mouseMoveLines.pop()),g.drawMouseMoveLine(y.mouseClickPoints[y.mouseClickPoints.length-1],{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}))))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),y.mouseHandler.setInputAction(function(){var e=y.mouseClickPoints[y.mouseClickPoints.length-1],t="",t=1e3<Math.abs(f)?"总高差："+(f/1e3).toFixed(2)+" km":"总高差："+f.toFixed(2)+" m",i=f.toFixed(2),s=y.labelEntities;g.map.map3D.entities.remove(s[s.length-1]),g.map.map3D.entities.remove(s[s.length-2]);var o=d.entities.add({position:Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt+1),label:g.labelStyle(t)});y.allEntities.push(o),f=0,y.mouseHandler||(y.mouseHandler.destroy(),y.mouseHandler=null),d.entities.remove(y.mouseMoveLines[y.mouseMoveLines.length-1]),y.mouseClickPoints=[],a&&a(i)},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},CgsGroundMeasure3D.prototype.groundMeasureDistance=function(a){var g=this;g.measureState.groundMeasureDistance=!0;var d=g.map.map3D,m=d.scene;m.globe.depthTestAgainstTerrain=!0,map.container.style.cursor="crosshair";var f=0,C=new Map,y=g.measureManager;y.mouseHandler=new Cesium.ScreenSpaceEventHandler(m.canvas),y.mouseHandler.setInputAction(function(e){var t,i,s,o,a,n,r,l,u,p,h,c;e.position&&(t={},i=e.position+"",C.has(i)?t=C.get(i):(t=m.pickPosition(e.position),C.set(i,t)),Cesium.defined(t)&&(s=Cesium.Cartographic.fromCartesian(t),o=Cesium.Math.toDegrees(s.longitude),a=Cesium.Math.toDegrees(s.latitude),n=(new CgsSampleAltitude).sampleAltitude([o,a])[2],y.mouseClickPoints.push({lon:o,lat:a,alt:n})),1===y.mouseClickPoints.length&&(g.drawPoint(y.mouseClickPoints[0]),r=d.entities.add({position:Cesium.Cartesian3.fromDegrees(y.mouseClickPoints[0].lon,y.mouseClickPoints[0].lat,y.mouseClickPoints[0].alt+1),label:g.labelStyle("起点")}),y.labelEntities.push(r),y.allEntities.push(r)),1<y.mouseClickPoints.length&&(l=y.mouseClickPoints[y.mouseClickPoints.length-1],u=y.mouseClickPoints[y.mouseClickPoints.length-2],g.drawPoint(l),g.drawLine(u,l),p=g.computeGroundDistance(l,u),f+=p,h="",h=1e3<p?"贴地距离："+(p/1e3).toFixed(2)+" km":"贴地距离："+p.toFixed(2)+" m",c=d.entities.add({position:Cesium.Cartesian3.fromDegrees(l.lon,l.lat,l.alt+1),label:g.labelStyle(h)}),y.labelEntities.push(c),y.allEntities.push(c)))},Cesium.ScreenSpaceEventType.LEFT_CLICK),y.mouseHandler.setInputAction(function(e){var t=m.pickPosition(e.endPosition);if(Cesium.defined(t)){var i=new Cesium.Cartographic.fromCartesian(t);if(y.mouseClickPoints.length<1)return;0!==y.mouseMoveLines.length&&(d.entities.remove(y.mouseMoveLines[y.mouseMoveLines.length-1]),y.mouseMoveLines.pop()),g.drawMouseMoveLine(y.mouseClickPoints[y.mouseClickPoints.length-1],{lon:Cesium.Math.toDegrees(i.longitude),lat:Cesium.Math.toDegrees(i.latitude),alt:i.height})}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),y.mouseHandler.setInputAction(function(){var e=y.mouseClickPoints[y.mouseClickPoints.length-1],t="",t=1e3<Math.abs(f)?"总距离："+(f/1e3).toFixed(2)+" km":"总距离："+f.toFixed(2)+" m",i=(f/1e3).toFixed(2),s=y.labelEntities;g.map.map3D.entities.remove(s[s.length-1]),g.map.map3D.entities.remove(s[s.length-2]);var o=d.entities.add({position:Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt+1),label:g.labelStyle(t)});y.allEntities.push(o),f=0,y.mouseHandler||(y.mouseHandler.destroy(),y.mouseHandler=null),d.entities.remove(y.mouseMoveLines[y.mouseMoveLines.length-1]),y.mouseClickPoints=[],a&&a(i)},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},CgsGroundMeasure3D.prototype.groundMeasurePerimeter=function(s){var v=this;v.measureState.groundMeasurePerimeter=!0;var b=v.map.map3D,D=b.scene;D.globe.depthTestAgainstTerrain=!0,map.container.style.cursor="crosshair";var o=void 0,S=v.measureManager;S.mouseHandler=new Cesium.ScreenSpaceEventHandler(D.canvas),S.mouseHandler.setInputAction(function(e){clearTimeout(o),o=setTimeout(function(){!function(e){if(!e.position)return;var t=D.pickPosition(e.position);{var i,s,o,a;Cesium.defined(t)&&(i=Cesium.Cartographic.fromCartesian(t),s=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),a=(new CgsSampleAltitude).sampleAltitude([s,o])[2],S.mouseClickPoints.push({lon:s,lat:o,alt:a}),v.drawPoint(S.mouseClickPoints[S.mouseClickPoints.length-1]),1<S.mouseClickPoints.length&&v.drawLine(S.mouseClickPoints[S.mouseClickPoints.length-2],S.mouseClickPoints[S.mouseClickPoints.length-1]))}}(e)},400)},Cesium.ScreenSpaceEventType.LEFT_CLICK),S.mouseHandler.setInputAction(function(e){var t,i=D.pickPosition(e.endPosition);Cesium.defined(i)&&(t=new Cesium.Cartographic.fromCartesian(i),1===S.mouseClickPoints.length&&(Cesium.Math.toDegrees(t.longitude).toFixed(5)===Cesium.Math.toDegrees(b.camera.positionCartographic.longitude).toFixed(5)&&Cesium.Math.toDegrees(t.latitude).toFixed(5)===Cesium.Math.toDegrees(b.camera.positionCartographic.latitude).toFixed(5)||(0!==S.mouseMoveLines.length&&(b.entities.remove(S.mouseMoveLines[S.mouseMoveLines.length-1]),S.mouseMoveLines.pop()),v.drawMouseMoveLine(S.mouseClickPoints[S.mouseClickPoints.length-1],{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}))),2<=S.mouseClickPoints.length&&(Cesium.Math.toDegrees(t.longitude).toFixed(5)===Cesium.Math.toDegrees(b.camera.positionCartographic.longitude).toFixed(5)&&Cesium.Math.toDegrees(t.latitude).toFixed(5)===Cesium.Math.toDegrees(b.camera.positionCartographic.latitude).toFixed(5)||(1===S.mouseMoveLines.length&&(b.entities.remove(S.mouseMoveLines[S.mouseMoveLines.length-1]),S.mouseMoveLines.pop()),1<S.mouseMoveLines.length&&(b.entities.remove(S.mouseMoveLines[S.mouseMoveLines.length-1]),b.entities.remove(S.mouseMoveLines[S.mouseMoveLines.length-2]),S.mouseMoveLines.pop(),S.mouseMoveLines.pop()),v.drawMouseMoveLine(S.mouseClickPoints[S.mouseClickPoints.length-1],{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}),v.drawMouseMoveLine(S.mouseClickPoints[0],{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}))))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),S.mouseHandler.setInputAction(function(e){var y=0,t=S.mouseMoveLines.length;if(0!==t){for(var i=0;i<t;i++)b.entities.remove(S.mouseMoveLines[i]);S.mouseMoveLines=[]}clearTimeout(o),function(e){S.mouseHandler||(S.mouseHandler.destroy(),S.mouseHandler=null);var t=D.pickPosition(e.position);{var i,s,o,a;Cesium.defined(t)&&(i=Cesium.Cartographic.fromCartesian(t),s=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),a=(new CgsSampleAltitude).sampleAltitude([s,o])[2]||D.globe.getHeight(i),S.mouseClickPoints.push({lon:s,lat:o,alt:a}))}if(S.mouseClickPoints.length<3){var n=[];S.mouseClickPoints.forEach(function(e){n.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat))});var r=v.computeCentroidOfPolygon(n),l=b.entities.add({position:Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+1),label:v.labelStyle("请至少绘制三个点")});S.labelEntities.push(l),S.allEntities.push(l)}else{v.drawLine(S.mouseClickPoints[0],S.mouseClickPoints[S.mouseClickPoints.length-1]);for(var u=0,p=0;p<S.mouseClickPoints.length;p++){var h=(p+1)%S.mouseClickPoints.length,c=S.mouseClickPoints[p],g=S.mouseClickPoints[h];u+=v.computeGroundDistance(c,g)}var d="";d=1e3<u?"贴地周长："+(u/1e3).toFixed(2)+" km":"贴地周长："+u.toFixed(2)+" m",y=u.toFixed(2);var m=[];S.mouseClickPoints.forEach(function(e){m.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat))});var f=v.computeCentroidOfPolygon(m),C=b.entities.add({position:Cesium.Cartesian3.fromRadians(f.longitude,f.latitude,f.height+1),label:v.labelStyle(d)});S.labelEntities.push(C),S.allEntities.push(C)}S.mouseClickPoints=[],S.mouseClickLines=[]}(e),s&&s(y)},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},CgsGroundMeasure3D.prototype.groundMeasureArea=function(s){var m=this;m.measureState.groundMeasureArea=!0;var f=m.map.map3D,C=f.scene;C.globe.depthTestAgainstTerrain=!0,map.container.style.cursor="crosshair";var o=void 0,y=m.measureManager;y.mouseHandler=new Cesium.ScreenSpaceEventHandler(C.canvas),y.mouseHandler.setInputAction(function(e){clearTimeout(o),o=setTimeout(function(){!function(e){if(!e.position)return;var t=C.pickPosition(e.position);{var i,s,o,a;Cesium.defined(t)&&(i=Cesium.Cartographic.fromCartesian(t),s=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),a=(new CgsSampleAltitude).sampleAltitude([s,o])[2],y.mouseClickPoints.push({lon:s,lat:o,alt:a}),m.drawPoint(y.mouseClickPoints[y.mouseClickPoints.length-1]),1<y.mouseClickPoints.length&&m.drawLine(y.mouseClickPoints[y.mouseClickPoints.length-2],y.mouseClickPoints[y.mouseClickPoints.length-1]))}}(e)},400)},Cesium.ScreenSpaceEventType.LEFT_CLICK),y.mouseHandler.setInputAction(function(e){var t,i,s=C.pickPosition(e.endPosition);Cesium.defined(s)&&(t=new Cesium.Cartographic.fromCartesian(s),1===y.mouseClickPoints.length&&(0!==y.mouseMoveLines.length&&(f.entities.remove(y.mouseMoveLines[y.mouseMoveLines.length-1]),y.mouseMoveLines.pop()),m.drawMouseMoveLine(y.mouseClickPoints[y.mouseClickPoints.length-1],{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height})),2<=y.mouseClickPoints.length&&(1===y.mouseMoveLines.length&&(f.entities.remove(y.mouseMoveLines[y.mouseMoveLines.length-1]),y.mouseMoveLines.pop()),1<y.mouseMoveLines.length&&(f.entities.remove(y.mouseMoveLines[y.mouseMoveLines.length-1]),f.entities.remove(y.mouseMoveLines[y.mouseMoveLines.length-2]),y.mouseMoveLines.pop(),y.mouseMoveLines.pop()),m.drawMouseMoveLine(y.mouseClickPoints[y.mouseClickPoints.length-1],{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}),m.drawMouseMoveLine(y.mouseClickPoints[0],{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}),0!==y.mouseMovePolygon.length&&(f.entities.remove(y.mouseMovePolygon[0]),y.mouseMovePolygon.pop()),i=[].concat(_toConsumableArray(y.mouseClickPoints),[{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}]),m.drawMouseMovePolygon(i)))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),y.mouseHandler.setInputAction(function(e){var d=0,t=y.mouseMoveLines.length;if(0!==t){for(var i=0;i<t;i++)f.entities.remove(y.mouseMoveLines[i]);y.mouseMoveLines=[]}clearTimeout(o),function(e){y.mouseHandler||(y.mouseHandler.destroy(),y.mouseHandler=null);var t=C.pickPosition(e.position);{var i,s,o,a;Cesium.defined(t)&&(i=Cesium.Cartographic.fromCartesian(t),s=Cesium.Math.toDegrees(i.longitude),o=Cesium.Math.toDegrees(i.latitude),a=(new CgsSampleAltitude).sampleAltitude([s,o])[2]||C.globe.getHeight(i),y.mouseClickPoints.push({lon:s,lat:o,alt:a}))}{var n,r,l,u,p,h,c,g;y.mouseClickPoints.length<3?(n=[],y.mouseClickPoints.forEach(function(e){n.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat))}),r=m.computeCentroidOfPolygon(n),l=f.entities.add({position:Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+1),label:m.labelStyle("请至少绘制三个点")}),y.labelEntities.push(l),y.allEntities.push(l)):(m.drawMouseMoveLine(y.mouseClickPoints[0],y.mouseClickPoints[y.mouseClickPoints.length-1]),0!==y.mouseMovePolygon.length&&(f.entities.remove(y.mouseMovePolygon[0]),y.mouseMovePolygon.pop()),m.drawPolygon(y.mouseClickPoints),u=0,u=function(){var e=1,t=[];y.mouseClickPoints.forEach(function(e){t.push([e.lon,e.lat])}),t.push(t[0]);var i=turf.polygon([t]),s=turf.area(i);5e3<s&&(e=1/Math.ceil(s/5e3));var o=0,a=Math.PI/Math.pow(2,11)/(500*e),n=[];y.mouseClickPoints.forEach(function(e){return n.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt))});for(var r=new Cesium.PolygonGeometry.fromPositions({positions:n,vertexFormat:Cesium.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,granularity:a}),l=new Cesium.PolygonGeometry.createGeometry(r),u=0;u<l.indices.length;u+=3)!function(e){var t=[],a=[];t.push(l.indices[e],l.indices[e+1],l.indices[e+2]),t.forEach(function(e){var t=new Cesium.Cartesian3(l.attributes.position.values[3*e],l.attributes.position.values[3*e+1],l.attributes.position.values[3*e+2]),i=Cesium.Cartographic.fromCartesian(t),s=m.map.map3D.scene.sampleHeight(i),o=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,s);a.push(o)}),m.drawTrangle(a),o+=m.computeAreaOfTriangle(a)}(u);return o}(),p="",p=1e6<u?"贴地面积："+(u/1e6).toFixed(2)+" km²":"贴地面积："+u.toFixed(2)+" m²",d=u.toFixed(2),h=[],y.mouseClickPoints.forEach(function(e){h.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat))}),c=m.computeCentroidOfPolygon(h),g=f.entities.add({position:Cesium.Cartesian3.fromRadians(c.longitude,c.latitude,c.height+1),label:m.labelStyle(p)}),y.labelEntities.push(g),y.allEntities.push(g))}y.mouseClickPoints=[],y.mouseClickLines=[]}(e),s&&s(d)},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},CgsGroundMeasure3D.prototype.groundMeasureVolume=function(p){var d=this;d.measureState.groundMeasureVolume=!0;var h=d.map.map3D,r=h.scene;r.globe.depthTestAgainstTerrain=!0,map.container.style.cursor="crosshair";var l=new Map,m=d.measureManager;m.mouseHandler=new Cesium.ScreenSpaceEventHandler(r.canvas),m.mouseHandler.setInputAction(function(e){var t,i,s,o,a,n;e.position&&(t={},i=e.position+"",l.has(i)?t=l.get(i):(t=r.pickPosition(e.position),l.set(i,t)),Cesium.defined(t)&&(s=Cesium.Cartographic.fromCartesian(t),o=Cesium.Math.toDegrees(s.longitude),a=Cesium.Math.toDegrees(s.latitude),n=(new CgsSampleAltitude).sampleAltitude([o,a])[2]||r.globe.getHeight(s),m.mouseClickPoints.push({lon:o,lat:a,alt:n}),d.drawPoint(m.mouseClickPoints[m.mouseClickPoints.length-1]),1<m.mouseClickPoints.length&&d.drawLine(m.mouseClickPoints[m.mouseClickPoints.length-2],m.mouseClickPoints[m.mouseClickPoints.length-1])))},Cesium.ScreenSpaceEventType.LEFT_CLICK),m.mouseHandler.setInputAction(function(e){var t,i,s=r.pickPosition(e.endPosition);Cesium.defined(s)&&(t=new Cesium.Cartographic.fromCartesian(s),1===m.mouseClickPoints.length&&(Cesium.Math.toDegrees(t.longitude).toFixed(5)===Cesium.Math.toDegrees(h.camera.positionCartographic.longitude).toFixed(5)&&Cesium.Math.toDegrees(t.latitude).toFixed(5)===Cesium.Math.toDegrees(h.camera.positionCartographic.latitude).toFixed(5)||(0!==m.mouseMoveLines.length&&(h.entities.remove(m.mouseMoveLines[m.mouseMoveLines.length-1]),m.mouseMoveLines.pop()),d.drawMouseMoveLine(m.mouseClickPoints[m.mouseClickPoints.length-1],{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}))),2<=m.mouseClickPoints.length&&(Cesium.Math.toDegrees(t.longitude).toFixed(5)===Cesium.Math.toDegrees(h.camera.positionCartographic.longitude).toFixed(5)&&Cesium.Math.toDegrees(t.latitude).toFixed(5)===Cesium.Math.toDegrees(h.camera.positionCartographic.latitude).toFixed(5)||(1===m.mouseMoveLines.length&&(h.entities.remove(m.mouseMoveLines[m.mouseMoveLines.length-1]),m.mouseMoveLines.pop()),1<m.mouseMoveLines.length&&(h.entities.remove(m.mouseMoveLines[m.mouseMoveLines.length-1]),h.entities.remove(m.mouseMoveLines[m.mouseMoveLines.length-2]),m.mouseMoveLines.pop(),m.mouseMoveLines.pop()),d.drawMouseMoveLine(m.mouseClickPoints[m.mouseClickPoints.length-1],{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}),d.drawMouseMoveLine(m.mouseClickPoints[0],{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}),0!==m.mouseMovePolygon.length&&(h.entities.remove(m.mouseMovePolygon[0]),m.mouseMovePolygon.pop()),i=[].concat(_toConsumableArray(m.mouseClickPoints),[{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}]),d.drawMouseMovePolygon(i))))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),m.mouseHandler.setInputAction(function(){var t,e,i,s,o,a,n,r,l,u=0;m.mouseHandler||(m.mouseHandler.destroy(),m.mouseHandler=null),m.mouseClickPoints.length<=3?(t=[],m.mouseClickPoints.forEach(function(e){t.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat))}),e=d.computeCentroidOfPolygon(t),i=h.entities.add({position:Cesium.Cartesian3.fromRadians(e.longitude,e.latitude,e.height+1),label:d.labelStyle("请至少绘制三个点")}),m.labelEntities.push(i),m.allEntities.push(i)):(s=0,cutVolumeArr=function(){var e=1,t=[];m.mouseClickPoints.forEach(function(e){t.push([e.lon,e.lat])}),t.push(t[0]);var i=turf.polygon([t]),s=turf.area(i);5e3<s&&(e=1/Math.ceil(s/5e3));var o=0,n=0,r=15e3;m.mouseClickPoints.forEach(function(e){r>e.alt&&(r=e.alt)});var l=0,u=0,a=Math.PI/Math.pow(2,11)/(10*e),p=[];m.mouseClickPoints.forEach(function(e){return p.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt))});for(var h=new Cesium.PolygonGeometry.fromPositions({positions:p,vertexFormat:Cesium.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,granularity:a}),c=new Cesium.PolygonGeometry.createGeometry(h),g=0;g<c.indices.length;g+=3)!function(e){var t=[],a=[];t.push(c.indices[e],c.indices[e+1],c.indices[e+2]),t.forEach(function(e){var t=new Cesium.Cartesian3(c.attributes.position.values[3*e],c.attributes.position.values[3*e+1],c.attributes.position.values[3*e+2]),i=Cesium.Cartographic.fromCartesian(t),s=d.map.map3D.scene.sampleHeight(i);u<s&&(u=s),n+=(s-r)/3;var o=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,s);a.push(o)}),o=d.computeAreaOfTriangle(a),l+=o*n}(g);return[l,u]}(),s=cutVolumeArr[0],o=cutVolumeArr[1],0!==m.mouseMovePolygon.length&&(h.entities.remove(m.mouseMovePolygon[0]),m.mouseMovePolygon.pop()),0!==m.mouseMoveLines.length&&m.mouseMoveLines.forEach(function(e){d.map.map3D.entities.remove(e)}),0!==m.mouseClickLines.length&&m.mouseClickLines.forEach(function(e){d.map.map3D.entities.remove(e)}),d.drawVolume(m.mouseClickPoints,o),a="",a=1e9<s?"体积："+(s/1e9).toFixed(2)+" km³":"体积："+s.toFixed(2)+" m³",u=s.toFixed(2),n=[],m.mouseClickPoints.forEach(function(e){n.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat))}),r=d.computeCentroidOfPolygon(n),l=h.entities.add({position:Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+1),label:d.labelStyle(a)}),m.labelEntities.push(l),m.allEntities.push(l)),m.mouseClickPoints=[],m.mouseClickLines=[],p&&p(u)},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},CgsGroundMeasure3D.prototype.drawPoint=function(e){var t=this.map.map3D.entities.add({position:Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt),point:{pixelSize:5,scaleByDistance:new Cesium.NearFarScalar(500,1,3e3,.3),disableDepthTestDistance:Number.POSITIVE_INFINITY,color:Cesium.Color.YELLOW}});this.measureManager.allEntities.push(t)},CgsGroundMeasure3D.prototype.drawLine=function(e,t){var i=this.map.map3D.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return[Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt),Cesium.Cartesian3.fromDegrees(t.lon,t.lat,t.alt)]},!0),material:Cesium.Color.fromCssColorString("rgba(0.0,255.0,255.0,0.8)"),clampToGround:!0,classificationType:Cesium.ClassificationType.BOTH,width:2}});this.measureManager.mouseClickLines.push(i),this.measureManager.allEntities.push(i)},CgsGroundMeasure3D.prototype.drawPolygon=function(e){var t=[];e.forEach(function(e){t.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt))});var i=this.map.map3D.entities.add({polygon:{hierarchy:new Cesium.CallbackProperty(function(){return t},!0),material:Cesium.Color.RED.withAlpha(.3)}});this.measureManager.mouseClickPolygon.push(i),this.measureManager.allEntities.push(i)},CgsGroundMeasure3D.prototype.drawVolume=function(e,t){var i,s=[];e.forEach(function(e){s.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt))});var o=this.map.map3D.entities.add({polygon:(_defineProperty(i={hierarchy:new Cesium.CallbackProperty(function(){return s},!0),material:Cesium.Color.RED.withAlpha(.3),extrudedHeight:t,closeTop:!1,closeBottom:!1},"material",Cesium.Color.RED.withAlpha(.3)),_defineProperty(i,"outline",!0),_defineProperty(i,"outlineColor",Cesium.Color.WHITE),_defineProperty(i,"outlineWidth",2),i)});this.measureManager.mouseClickVolume.push(o),this.measureManager.allEntities.push(o)},CgsGroundMeasure3D.prototype.drawMouseMoveLine=function(e,t){var i=this.map.map3D.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return[Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt),Cesium.Cartesian3.fromDegrees(t.lon,t.lat,t.alt)]},!0),material:Cesium.Color.fromCssColorString("rgba(0.0,255.0,255.0,0.8)"),clampToGround:!0,classificationType:Cesium.ClassificationType.BOTH,width:2}});this.measureManager.mouseMoveLines.push(i),this.measureManager.allEntities.push(i)},CgsGroundMeasure3D.prototype.drawMouseMovePolygon=function(e){var t=[];e.forEach(function(e){t.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt))});var i=this.map.map3D.entities.add({polygon:{hierarchy:new Cesium.CallbackProperty(function(){return t},!0),material:Cesium.Color.RED.withAlpha(.3)}});this.measureManager.mouseMovePolygon.push(i),this.measureManager.allEntities.push(i)},CgsGroundMeasure3D.prototype.drawMouseMoveVolume=function(e,t){var i,s=[];e.forEach(function(e){s.push(Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.alt))});var o=this.map.map3D.entities.add({polygon:(_defineProperty(i={hierarchy:new Cesium.CallbackProperty(function(){return s},!0),material:Cesium.Color.RED.withAlpha(.3),extrudedHeight:t,closeTop:!1,closeBottom:!1},"material",Cesium.Color.RED.withAlpha(.3)),_defineProperty(i,"outline",!0),_defineProperty(i,"outlineColor",Cesium.Color.WHITE),_defineProperty(i,"outlineWidth",2),i)});this.measureManager.mouseMoveVolume.push(o),this.measureManager.allEntities.push(o)},CgsGroundMeasure3D.prototype.drawTrangle=function(e){var i=[];e.forEach(function(e){var t=Cesium.Cartographic.fromCartesian(e);i.push({lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height})}),this.drawPoint(i[0]),this.drawPoint(i[1]),this.drawPoint(i[2]),this.drawLine(i[0],i[1]),this.drawLine(i[0],i[2]),this.drawLine(i[1],i[2])},CgsGroundMeasure3D.prototype.labelStyle=function(e){return{text:e,font:"16px sans-serif",showBackground:!0,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(-15,-15),disableDepthTestDistance:Number.POSITIVE_INFINITY,fillColor:Cesium.Color.WHITE}},CgsGroundMeasure3D.prototype.computeGroundDistance=function(e,t){for(var i=0,s=Cesium.Cartesian3.fromDegrees(e.lon,e.lat),o=Cesium.Cartesian3.fromDegrees(t.lon,t.lat),a=this.computeEuclideanDistance(e,t),n=0,n=a<100?Math.floor(a/.5):100<=a&&a<500?Math.floor(a/2):500<=a&&a<1e3?Math.floor(a/4):1e3<=a&&a<5e3?Math.floor(a/20):5e3<=a&&a<1e4?Math.floor(a/40):500,r=[Cesium.Cartographic.fromCartesian(s)],l=1;l<n;l++){var u=Cesium.Cartesian3.lerp(s,o,l/n,new Cesium.Cartesian3);r.push(Cesium.Cartographic.fromCartesian(u))}r.push(Cesium.Cartographic.fromCartesian(o));var p=[];p[0]=e.alt;for(var h=1;h<r.length;h++){var c=Cesium.Math.toDegrees(r[h].longitude),g=Cesium.Math.toDegrees(r[h].latitude);p[h]=(new CgsSampleAltitude).sampleAltitude([c,g]),p[h]||(p[h]=this.map.map3D.scene.globe.getHeight(r[h]),p[h]||(p[h]=p[h-1]))}for(var d=0;d<r.length-1;d++){var m={lon:Cesium.Math.toDegrees(r[d].longitude),lat:Cesium.Math.toDegrees(r[d].latitude),alt:r[d].height},f={lon:Cesium.Math.toDegrees(r[d+1].longitude),lat:Cesium.Math.toDegrees(r[1].latitude),alt:r[d+1].height};i+=this.computeEuclideanDistance(m,f)}return i},CgsGroundMeasure3D.prototype.computeEuclideanDistance=function(e,t){var i={lon:e.lon?e.lon:e.longitude,lat:e.lat?e.lat:e.latitude,alt:e.alt?e.alt:e.height},s={lon:t.lon?t.lon:t.longitude,lat:t.lat?t.lat:t.latitude,alt:t.alt?t.alt:t.height},o=Cesium.Cartesian3.fromDegrees(i.lon,i.lat,i.alt),a=Cesium.Cartesian3.fromDegrees(s.lon,s.lat,s.alt);return Cesium.Cartesian3.distance(o,a)},CgsGroundMeasure3D.prototype.computeAreaOfTriangle=function(e){var t=e[0],i=e[1],s=e[2],o=Cesium.Cartesian3.distance(t,i),a=Cesium.Cartesian3.distance(t,s),n=Cesium.Cartesian3.distance(i,s),r=(o+a+n)/2;return Math.sqrt(r*(r-o)*(r-a)*(r-n))},CgsGroundMeasure3D.prototype.computeCentroidOfPolygon=function(e){for(var t=[],s=[],o=0;o<e.length;o++){var a=Cesium.Cartographic.fromCartesian(e[o]);t.push(a.longitude),s.push(a.latitude)}var n,r=0,l=0,u=0,p=0,h=0,c=0,g=0;for(i=0;i<e.length;i++)r=t[i],l=s[i],h+=n=r*(p=i==e.length-1?(u=t[0],s[0]):(u=t[i+1],s[i+1]))-u*l,c+=(r+u)*n,g+=(l+p)*n;c/=6*(h*=.5),g/=6*h;var d=0,m=0;for(i=0;i<e.length;i++)(r=t[i])<c&&d++,(l=s[i])<g&&m++;if(0===d||d==e.length||0==m||m==e.length){for(i=g=c=0;i<e.length;i++)c+=r=t[i],g+=l=s[i];c/=e.length,g/=e.length}var f=this.map.map3D.scene.sampleHeight(new Cesium.Cartographic(c,g));return new Cesium.Cartographic(c,g,f)},CgsGroundMeasure3D.prototype.removeAllGroundMeasure=function(e){var t=this,i=this.measureManager;i.mouseHandler&&(i.mouseHandler.destroy(),i.mouseHandler=null),map.container.style.cursor="default",i.allEntities.forEach(function(e){t.map.map3D.entities.remove(e)}),i={mouseHandler:void 0,allEntities:[],labelEntities:[],mouseClickPoints:[],mouseClickLines:[],mouseClickPolygon:[],mouseClickVolume:[],mouseMoveLines:[],mouseMovePolygon:[],mouseMoveVolume:[]},e&&e()},CgsPointAggregation3D=function(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.url=Cesium.defaultValue(e.url,"assets/data/weibo.geojson"),this.fillColor=Cesium.defaultValue(e.fillColor,"rgba(255, 250, 250, 0.9)"),this.intensity=Cesium.defaultValue(e.intensity,1),this.bigDataStyle=Cesium.defaultValue(e.bigDataStyle,"Point"),this.pixelSize=Cesium.defaultValue(e.pixelSize,.5),this.animation=Cesium.defaultValue(e.animation,!1),this.stepsRange=Cesium.defaultValue(e.stepsRange,{start:0,end:10}),this.trails=Cesium.defaultValue(e.trails,1),this.duration=Cesium.defaultValue(e.duration,6),this.type="PointAggregationDataSource",Cesium.CgsGeoJsonDataSource.call(this),this.show=Cesium.defaultValue(e.visible,!0);var t=this;this.load(t.url,{fillColor:Cesium.Color.fromCssColorString(t.fillColor),bigDataStyle:t.bigDataStyle,pixelSize:t.pixelSize,animation:t.animation,stepsRange:t.stepsRange,trails:t.trails,duration:t.duration}).then(function(){t.name=Cesium.defaultValue(e.name,"微博用户分布数据")},function(e){CgsSubPub.publish("datasourceloaderror")})},CgsInherits(CgsPointAggregation3D,Cesium.CgsGeoJsonDataSource),CgsPointAggregation3D.prototype.getName=function(){return this.name},CgsPointAggregation3D.prototype.setName=function(e){this.name=e},CgsPointAggregation3D.prototype.setVisible=function(e){this.show=e},CgsPointAggregation3D.prototype.getVisible=function(){return this.show};var Cgs_GetScreenDPI_=function(){var e,t=[];return null!=window.screen.deviceXDPI?(t[0]=window.screen.deviceXDPI,t[1]=window.screen.deviceYDPI):((e=document.createElement("div")).style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;visible:hidden;",document.body.appendChild(e),t[0]=parseInt(e.offsetWidth),t[1]=parseInt(e.offsetHeight),document.body.removeChild(e)),t},self1;function PlottingAppTool(e){this.map=e}function SceneEventListener(e,t){this.map=e,this.jmpInit=t}CGS_DOTS_PER_INCH=72,CGS_INCHES_PER_METER=39.37,CGS_HEIGHT_TO_SCALE=.3,CGS_METERS_PER_DEGREE=111319.49079327358,CgsMap=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t=this,i=this,s=Cgs_GetScreenDPI_();2==s.length&&0<s[0]&&(CGS_DOTS_PER_INCH=s[0]);var o=document.getElementById(e.target);o||console.error("无法找到地图挂载的dom元素"),o.style.overflow="hidden";var a=document.createElement("div");this.div2DContainerId="CgsMapContainer2D"+(new Date).valueOf(),a.id=this.div2DContainerId,a.style.width="100%",a.style.height="100%",a.style.top="0px",a.style.left="0px",a.style.visibility="visible",a.style.position="absolute",o.appendChild(a);var n=document.createElement("div");n.id="CgsMapContainer3D",n.style.width="100%",n.style.height="100%",n.style.top="0px",n.style.left="0px",n.style.visibility="hidden",n.style.position="absolute",o.appendChild(n),1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG||CgsMap.checkEquipment()||"3D"!=e.mode||(e.mode="2D",console.warn("当前设备不支持WebGL,无法启动三维")),this.target=e.target,this.container=o,this.projection=e.projection,ol.CGS_CURRENT_PROJECTION=e.projection,this.center=e.center,this.zoom=e.zoom,this.featuresDrawedByMouse=[],this.featuresMeasureByMouse=[],this.overlayMeasureByMouse=[],this.allFeatures=[],this.allSymbols=[],this.symbolGroups=[],this.allMapNotes=[],this.featureGroups=[],this.layerGroups=[],this.labeldragFeatureGroup=[],this.mode="3D"==e.mode?"3D":"2D",this.dblClickZoom2D=!1,this.isCesium2D=!!e.isCesium2D,this.threeFlag=0!=e.threeFlag,this.jmpFlag=!!e.jmpFlag,this.jmpLoadingLock=!1,this.jmpLoadingSymbols=[],this.allLayers=[],this.allToponys=[],this.testCanvas=null,this._layerCache={},this.bigDataVLayers=[],this._modelDrawTool=null,this.toolbarState={},this.hitTolerance=1,this.earthWeakObj=void 0,this.terrainColour=void 0,this.starrySky=void 0,this.terrainClip=void 0,this.tempCaptain={flag:!1,flag2:!0,flag3:!0,flag4:!1,arr:[]},this.verifyFlag=e.verifyFlag||!1,this.ocean=void 0,this.MVManipulates=[],this.allDataSources=[];var r=navigator.userAgent;-1<r.indexOf("Firefox")?this.browerType="Firefox":-1<r.indexOf("Chrome")&&(this.browerType="Chrome"),this.homeCenter=[107.5,34],this.homeZoom=5,this.homeHeight=77e5,this.modelPluggInfo=null,this.toolbarPlugg=null,!(this.treeNodes=[])!==e.isRestrictedExtent&&(e.isRestrictedExtent=!0),2==window.WGMODEFLAG&&(this.threeFlag=!1,this.mode="2D"),this.isCesium2D||(this.map2D=new CgsMap2D({target:a.id,projection:e.projection,center:e.center,zoom:e.zoom,extent:e.restrictedExtent,isRestrictedExtent:e.isRestrictedExtent,pinchRotate:e.pinchRotate||!0}),(this.map2D.owner=this).map2D.container=a),this.threeFlag?(this._shouldAnimate=void 0===e.shouldAnimate||e.shouldAnimate,this._requestRenderMode=void 0!==e.requestRenderMode&&e.requestRenderMode,this.map3D=new CgsMap3D({target:n.id,orderIndependentTranslucency:e.orderIndependentTranslucency,webglAlpha:e.webglAlpha,shouldAnimate:this._shouldAnimate,requestRenderMode:this._requestRenderMode}),this.map3D.scene.highDynamicRange=!1,"3D"==this.mode?(a.style.visibility="hidden",n.style.visibility="visible"):"2D"==this.mode&&this.isCesium2D&&(a.style.visibility="hidden",n.style.visibility="visible",this.map3D.scene.morphTo2D(0)),this.map3D.owner=this):(this.mode="2D",this.isCesium2D&&!this.map3D&&(this.map3D=new CgsMap3D({target:n.id,orderIndependentTranslucency:e.orderIndependentTranslucency,webglAlpha:e.webglAlpha}),"2D"==this.mode&&(a.style.visibility="hidden",n.style.visibility="visible",this.map3D.scene.morphTo2D(0)),this.map3D.owner=this)),void 0===e.minZoom&&(e.minZoom=4),this.isCesium2D||this.setMinZoom(e.minZoom),this.registEvent_();var l=this;l.effectManager||(l.effectManager=new CgsEffectManager({mapObject:l,projection:l.projection})),this.overlays=[],this.mobileManager=new CgsMobileManager(this),l.map3D&&(l.manipulate=new CgsManipulate3D(l.map3D),l.map3D.manipulate=l.manipulate),CgsMap.instance=l,CgsSubPub.publish(CgsEvent.eMapInstanceCreated,[l]),Promise.all([new Promise(function(t,e){CgsConfigLoader.loadJSONFile(CGS_SDK_PATH+"configFile/mapConfig.json").then(function(e){i.allPropertiesConfigs=e,CgsSubPub.publish(CgsEvent.eMapConfigReady,[l]),t()})}),new Promise(function(i,e){CgsSubPub.subscribe(CgsEvent.eMapConfigReady,function(e,t){i(t)})}),new Promise(function(i,e){CgsSubPub.subscribe(CgsEvent.eUIReady,function(e,t){i(t)})}),new Promise(function(e,t){riot.compile(function(){CgsSubPub.publish(CgsEvent.eUIReady,[l]),e()})})]).then(function(){CgsSubPub.publish(CgsEvent.eMapReady,[l])}),l.allJsLoad=[!1,!1,!1,!1,!1];var u=CgsSubPub.subscribe("initmapcomplete",function(e,t){l.jmpFlag&&l.loadJmpFileAndInit(),u&&CgsSubPub.unsubscribe(u),u=null});CgsUtil&&(CgsUtil.map=this),CgsSubPub.subscribe(CgsEvent.ePostrender,function(e,t){if("3D"==t.mode)for(var i=0;i<t.labeldragFeatureGroup.length;i++){var s=t.labeldragFeatureGroup[i];if(CgsUtil.checkViewer(s)){s.labelLine.setVisible(!0);var o=s.feature3D.label.getPixelOffset();if(o){if(Math.abs(o[0])+Math.abs(o[1])<29){s.labelLine.setVisible(!1);continue}s.labelLine.setVisible(!0);var a=s.feature3D.label.getPosition();CgsUtil.isArray(a[0])&&(a=a[0]),CgsUtil.isArray(a[0])||3!=a.length||a.pop();var n=t.lonLatToPixel(a);if(!n)continue;var r=[o[0]+n[0],o[1]+n[1]],l=5.5*s.feature3D.label.getText().length;o[0]<=0&&o[1]<=0?(r[0]=r[0]+l,r[1]=r[1]+10):0<=o[0]&&o[1]<=0?(r[0]=r[0]-l,r[1]=r[1]+10):o[0]<=0&&0<=o[1]?(r[0]=r[0]+l,r[1]=r[1]-10):0<=o[0]&&0<=o[1]&&(r[0]=r[0]-l,r[1]=r[1]-10);var u=t.pixelToLonLat(r);a&&u&&s.labelLine&&s.getVisible()?(s.labelLine.setVisible(!0),s.labelLine.setPosition([a,u])):a&&u||!s.labelLine||s.labelLine.setVisible(!1),s.getVisible()||s.labelLine.setVisible(!1)}}else s.labelLine.setVisible(!1)}});var p=document.onkeydown;document.onkeydown=function(e){CgsSubPub.publish("CgsKeyBoardClickEvent",e.keyCode),p&&p(e)},this.deleteSymbolByKD=!0,requestAnimationFrame(function(){var e=t.getMapMode();"2D"!==e||t.isCesium2D||t._switchRequestRenderMode(e)})}),CgsMap.prototype.setMobileSomHeight=function(s){return CgsSubPub.subscribe("zoomchanged",function(e,t){if(t.getHeight()<s&&0<t.mobileManager.objs.length)for(var i=0;i<t.mobileManager.objs.length;i++)t.mobileManager.objs[i].sommthFly||t.mobileManager.objs[i].setSommthFly(!0);else if(t.getHeight()>s&&0<t.mobileManager.objs.length)for(i=0;i<t.mobileManager.objs.length;i++)t.mobileManager.objs[i].sommthFly&&t.mobileManager.objs[i].setSommthFly(!1)})},CgsMap.prototype.loadJmpFileAndInit=function(){var t;function i(){}this.jmpApi||this.jmpLoadingLock||(this.jmpLoadingLock=!0,this.jmpFlag=!0,t=this,"undefined"==typeof Module&&(Module={}),Module.locateFile=function(e,t){return window.CGS_SDK_PATH+"nkjbkit/"+e},$$.when($$.getJSON(CGS_SDK_PATH+"configFile/jmpConfig.json"),$$.getScript(window.CGS_SDK_PATH+"nkjbkit/nkjb-client.js")).done(function(e){t.jmpPropertiesConfigs=e[0],Module.onRuntimeInitialized=i}).fail(function(){t.jmpLoadingLock=!1,console.error("nkjbkit load failed")}))},CgsMap.prototype.setRestrictedExtent=function(r,i){var l=this,s=null;this.map2D.on("precompose",function(){var e,t,i,s,o,a,n;"2D"==l.mode&&(e=l.map2D.viewport_.clientWidth,t=l.map2D.viewport_.clientHeight,r=r||[-180,-85,180,85],i=l.map2D.getPixelFromLonLat([r[0],r[3]]),s=l.map2D.getPixelFromLonLat([r[2],r[3]]),o=l.map2D.getPixelFromLonLat([r[0],r[1]]),a=l.map2D.getPixelFromLonLat([r[2],r[1]]),n=l.map2D.getPixelFromLonLat(l.map2D.getCenter()),0<i[0]?(bflag=!0,n[0]+=i[0],l.setCenter(l.map2D.getLonLatFromPixel(n))):0<i[1]&&(bflag=!0,n[1]+=i[1],l.setCenter(l.map2D.getLonLatFromPixel(n))),s[0]<e?(bflag=!0,n[0]+=s[0]-e,l.setCenter(l.map2D.getLonLatFromPixel(n))):0<s[1]&&(bflag=!0,n[1]+=s[1],l.setCenter(l.map2D.getLonLatFromPixel(n))),0<o[0]?(bflag=!0,n[0]+=o[0],l.setCenter(l.map2D.getLonLatFromPixel(n))):o[1]<t&&(bflag=!0,n[1]+=o[1]-t,l.setCenter(l.map2D.getLonLatFromPixel(n))),a[0]<e?(bflag=!0,n[0]+=a[0]-e,l.setCenter(l.map2D.getLonLatFromPixel(n))):a[1]<t&&(bflag=!0,n[1]+=a[1]-t,l.setCenter(l.map2D.getLonLatFromPixel(n))),n=l.getCenter())}),i=i||4,CgsSubPub.subscribe("zoomchanged",function(e,t){"2D"==l.mode&&(l.getZoom()<=i&&(l.setZoom(i),s&&l.setCenter(s)),s=l.getCenter())}),CgsSubPub.subscribe("moveend",function(e,t){s=l.getCenter()})},CgsMap.prototype.visibleHeightContral=function(){window.visibleHeightContralHandler=new Cesium.ScreenSpaceEventHandler(this.map3D.canvas);var i=this;visibleHeightContralHandler.setInputAction(function(e){for(var t=0;t<i.allFeatures.length;t++)i.allFeatures[t].visibleHeightConByRoller&&(i.allFeatures[t].visibleHeightConByRoller[0]>i.getHeight()||i.allFeatures[t].visibleHeightConByRoller[1]<i.getHeight()?i.allFeatures[t].getVisible()&&i.allFeatures[t].setVisible(!1):i.allFeatures[t].getVisible()||i.allFeatures[t].setVisible(!0)),i.allFeatures[t].feature3D.label&&i.allFeatures[t].feature3D.label.visibleHeightConByRoller&&(i.allFeatures[t].feature3D.label.visibleHeightConByRoller[0]>i.getHeight()||i.allFeatures[t].feature3D.label.visibleHeightConByRoller[1]<i.getHeight()?i.allFeatures[t].feature3D.label.getVisibled()&&(i.allFeatures[t].setLabelVisible(!1),i.allFeatures[t].feature3D.label.setVisibled(!1),i.allFeatures[t].feature3D.label.setVisible(!1)):i.allFeatures[t].feature3D.label.getVisibled()||(i.allFeatures[t].setLabelVisible(!0),i.allFeatures[t].feature3D.label.setVisibled(!0),i.allFeatures[t].feature3D.label.setVisible(!0)))},Cesium.ScreenSpaceEventType.WHEEL)},CgsMap.prototype.setBlankFlag=function(e){"boolean"==typeof this.map3D.blankFlag?this.map3D.blankFlag=e:console.info("传入参数非boolean类型")},CgsMap.prototype.getBlankFlag=function(){return this.map3D.blankFlag},CgsMap.prototype.registEvent_=function(){var e,o,l=this;this.map2DInitInterval=setInterval(function(){CgsMap.initMap2DComplete&&(CgsSubPub.publish("initmap2dcomplete",[l]),clearInterval(l.map2DInitInterval))},1e3),this.map3DInitInterval=setInterval(function(){CgsMap.initMap3DComplete&&(CgsSubPub.publish("initmap3dcomplete",[l]),clearInterval(l.map3DInitInterval))},1e3),this.mapInitInterval=setInterval(function(){l.threeFlag||(CgsMap.initMap3DComplete=!0),l.isCesium2D&&(CgsMap.initMap2DComplete=!0),CgsMap.initMap3DComplete&&(CgsSubPub.publish("initmapcomplete",[l]),CgsMap.initMapComplete=!0,clearInterval(l.mapInitInterval))},1e3),this.isCesium2D||((e=this.map2D.view).on("change:resolution",function(){CgsSubPub.publish("zoomchanged2d",[l]),CgsSubPub.publish("zoomchanged",[l]),CgsSubPub.publish("move",[l])}),e.on("change:center",function(){CgsSubPub.publish("move2d",[l]),CgsSubPub.publish("move",[l]),CgsSubPub.publish("aerialView",[l])}),e.on("change:rotation",function(){CgsSubPub.publish("move2d",[l]),CgsSubPub.publish("move",[l])}),this.map2D.on("moveend",function(){CgsSubPub.publish("moveend2d",[l]),l.threeflag||CgsSubPub.publish("moveend",[l])}),this.map2D.on("postrender",function(){CgsSubPub.publish("postrender2d",[l]),l.threeflag||CgsSubPub.publish("postrender",[l])})),this.featureSelect=new CgsSelect2D({clickCall:function(e,t){var i,s;0<e.length&&!(e[0]instanceof CgsFeature2D)&&e[0]instanceof ol.Feature?(i=CgsUtil.getFeaturesByOlFeature(e),CgsSubPub.publish("featureclick",[i,t])):0!=(s=CgsUtil.getFeaturesByPickedRetFor2D(e)).length&&CgsSubPub.publish("featureclick",[CgsUtil.compositorFeature(s),t,s])},clickOutCall:function(e,t){0!=e.length?CgsSubPub.publish("featureclickout",[e[0].parentFeature,t,l]):CgsSubPub.publish("featureclickout",[null,t,l])},hoverCall:function(e,t){var i,s;e[0]&&e[0].isKML?(i={name:e[0].values_.name},CgsSubPub.publish(CgsEvent.eKMLFeatureHover,[i,t,e])):0<e.length&&!(e[0]instanceof CgsFeature2D)&&e[0]instanceof ol.Feature?(s=CgsUtil.getFeaturesByOlFeature(e),CgsSubPub.publish("featurehover",[s,t])):(e=CgsUtil.getFeaturesByPickedRetFor2D(e),CgsSubPub.publish("featurehover",[e[e.length-1],t,e]))},leaveCall:function(e,t){var i,s;e[0]&&e[0].isKML?(i={name:e[0].values_.name},CgsSubPub.publish(CgsEvent.eKMLFeatureLeave,[i,t,e])):0<e.length&&!(e[0]instanceof CgsFeature2D)&&e[0]instanceof ol.Feature?(s=CgsUtil.getFeaturesByOlFeature(e),CgsSubPub.publish("featureleave",[s,t])):(e=CgsUtil.getFeaturesByPickedRetFor2D(e),CgsSubPub.publish("featureleave",[e[e.length-1],t,e]))},doubleclickCall:function(e,t){var i;0<e.length&&!(e[0]instanceof CgsFeature2D)&&e[0]instanceof ol.Feature?(i=CgsUtil.getFeaturesByOlFeature(e),CgsSubPub.publish("featuredoubleclick",[i,t])):CgsSubPub.publish("featuredoubleclick",[e[0].parentFeature,t])},doubleclickOutCall:function(e,t){var i,s;0!=e.length?CgsSubPub.publish("featuredoubleclickout",[e[0].parentFeature,t]):(CgsSubPub.publish("featuredoubleclickout",[null,t]),l.dblClickZoom2D&&(i=l.map2D.view.getMaxZoom(),(s=l.map2D.view.getZoom())<=i&&l.map2D.view.animate({zoom:s+2})))},mapObject:this.map2D,draggable:!1,hitTolerance:this.hitTolerance}),this.isCesium2D||(this.featureSelect.activate(),o=null,this.map2D.container.oncontextmenu=function(e){e.preventDefault();var t=[];t[0]=e.offsetX||e.layerX,t[1]=e.offsetY||e.layerY;for(var i=e.target;i!=e.currentTarget&&null!=i;)t[0]+=i.offsetLeft,t[1]+=i.offsetTop,i=i.offsetParent;var s=[];l.map2D.forEachFeatureAtPixel(t,function(e,t){o=!(e instanceof CgsFeature2D)&&e instanceof ol.Feature?CgsUtil.getFeaturesByOlFeature([e]):e.parentFeature,s.push(o)},{hitTolerance:l.hitTolerance}),0===s.length?(CgsSubPub.publish("featurerightclickout",[o,t]),o=null):CgsSubPub.publish("featurerightclick",[o,t,s])}),this.threeFlag&&(CgsSubPub.subscribe("featureSelected",function(e,t,i,s,o){if("3D"==l.mode){if(t instanceof CgsFeature)return void CgsSubPub.publish("featureclick",[t,[i.x,i.y]]);var a=new Set;_.each(o,function(e,t){e instanceof CgsLabel3D&&(o[t]=e.feature||e),o[t].parentFeature&&a.add(o[t].parentFeature)}),0!=a.size&&CgsSubPub.publish("featureclick",[a.values().next().value,[i.x,i.y],Array.from(a)])}}),CgsSubPub.subscribe("ctrl_featureSelected",function(e,t,i,s,o){if("3D"==l.mode){if(t instanceof CgsFeature)return void CgsSubPub.publish("ctrl_featureclick",[t,[i.x,i.y]]);var a=[];_.each(o,function(e,t){e instanceof CgsLabel3D&&(o[t]=e.feature||e),o[t].parentFeature&&a.push(o[t].parentFeature)}),0!=a.length&&CgsSubPub.publish("ctrl_featureclick",[a[0],[i.x,i.y],a])}}),CgsSubPub.subscribe("clickspace",function(e,t,i,s,o){"3D"==l.mode&&(null!=t?(t instanceof CgsLabel3D&&(t=t.feature||t),CgsSubPub.publish("featureclickout",[t.parentFeature,[i.x,i.y],l,o])):CgsSubPub.publish("featureclickout",[null,[i.x,i.y],l,o]))}),CgsSubPub.subscribe("featureEnter",function(e,t,i,s){if("3D"==l.mode){if(t&&t.kml){var o={name:t.name};return void CgsSubPub.publish(CgsEvent.eKMLFeatureHover,[o,[i.x,i.y]])}t instanceof CgsLabel3D&&(t=t.feature||t),CgsSubPub.publish("featurehover",[t.parentFeature,[i.x,i.y]])}}),CgsSubPub.subscribe("featureLeave",function(e,t,i,s){if("3D"==l.mode){if(t&&t.kml){var o={name:t.name};return void CgsSubPub.publish(CgsEvent.eKMLFeatureLeave,[o,[i.x,i.y]])}t instanceof CgsLabel3D&&(t=t.feature||t),CgsSubPub.publish("featureleave",[t.parentFeature,[i.x,i.y]])}}),CgsSubPub.subscribe("featurerightclickSelected",function(e,t,i,s,o){if("3D"==l.mode){if(t instanceof CgsFeature)return void CgsSubPub.publish("featurerightclick",[t,[i.x,i.y]]);var a=new Set;_.each(o,function(e,t){e instanceof CgsLabel3D&&(o[t]=e.feature||e),o[t].parentFeature&&a.add(o[t].parentFeature)}),0!=a.size&&CgsSubPub.publish("featurerightclick",[a.values().next().value,[i.x,i.y],Array.from(a)])}}),CgsSubPub.subscribe("rightclickspace",function(e,t,i,s){"3D"==l.mode&&(null!=t?(t instanceof CgsLabel3D&&(t=t.feature||t),CgsSubPub.publish("featurerightclickout",[t.parentFeature,[i.x,i.y]])):CgsSubPub.publish("featurerightclickout",[null,[i.x,i.y]]))}),CgsSubPub.subscribe("featuredbclickSelected",function(e,t,i,s){if("3D"==l.mode){if(t instanceof CgsFeature)return void CgsSubPub.publish("featuredoubleclick",[t,[i.x,i.y]]);t instanceof CgsLabel3D&&(t=t.feature||t),CgsSubPub.publish("featuredoubleclick",[t.parentFeature,[i.x,i.y]])}}),CgsSubPub.subscribe("dbclickspace",function(e,t,i,s){"3D"==l.mode&&(null!=t?(t instanceof CgsLabel3D&&(t=t.feature||t),CgsSubPub.publish("featuredoubleclickout",[t.parentFeature,[i.x,i.y]])):CgsSubPub.publish("featuredoubleclickout",[null,[i.x,i.y]]))}),CgsSubPub.subscribe("elementMoveStart",function(e,t,i,s){var o,a;i==l.map3D&&(o=s.parentFeature?s.parentFeature:s,l.draggingFeature=o,a=t.endPosition,CgsSubPub.publish("featuredragstart",[o,[a.x,a.y]]))}),CgsSubPub.subscribe("elementMove",function(e,t,i,s){var o,a;t==l.map3D&&s&&(o=l.draggingFeature,a=t.mousePos,CgsSubPub.publish("featuredrag",[o,[a.x,a.y]]))}),CgsSubPub.subscribe("elementHeight",function(e,t,i){var s,o;i==l.map3D&&(s=l.draggingFeature,o=i.mousePos,CgsSubPub.publish("featuredrag",[s,[o.x,o.y]]))}),CgsSubPub.subscribe("elementMoveFinish",function(e,t,i,s){var o,a,n,r;s==l.map3D&&(o=l.draggingFeature,a=t,n=i.getPosition(),o instanceof CgsLabel3D||o.labelDraggable||(o instanceof CgsArc?(r=n.length-1,i.parentFeature.setPosition([n[0],n[r]])):o instanceof CgsSector?(r=n[0].length,i.parentFeature.setPosition(n[0][r-1])):i.parentFeature.setPosition(n)),l.draggingFeature=null,CgsSubPub.publish("featuredragend",[o,[a.x,a.y]]))}),CgsSubPub.subscribe("kmlfeatureSelected3d",function(e,t,i,s){"3D"==l.mode&&CgsSubPub.publish("kmlfeatureSelected",[t,i,map.map3D.owner])}),$$(l.container).mousemove(function(e){for(var t=[e.offsetX,e.offsetY],i=e.target;i!=e.currentTarget&&null!=i;)t[0]=t[0]+i.offsetLeft,t[1]=t[1]+i.offsetTop,i=i.offsetParent;l.lastMousePos=t})),this.map3D&&(this.map3D.scene.postRender.addEventListener(function(){CgsSubPub.publish("postrender",[l])}),this.map3D.camera.moveStart.addEventListener(function(){CgsSubPub.publish("movestart3d",[l])}),this.map3D.camera.moveEnd.addEventListener(function(){CgsSubPub.publish("moveend3d",[l]),CgsSubPub.publish("moveend",[l])}),this.map3D.camera.changed.addEventListener(function(){CgsSubPub.publish("move3d",[l]),CgsSubPub.publish("move",[l])})),this.threeFlag&&CgsSubPub.subscribe("moveend3d",this.moveend3DCallback_)},CgsMap.prototype.zoomchanged2DCallback_=function(e,t){var i,s,o;"2D"!=t.mode||t.isCesium2D||(i=t.map2D.getResolution()*CGS_DOTS_PER_INCH*CGS_INCHES_PER_METER,s=t.map2D.getCenter(),o=i*CGS_HEIGHT_TO_SCALE,t.map3D&&(t.map3D.setHeight(o),t.map3D.setCenter(s)))},CgsMap.prototype.moveend2DCallback_=function(e,t){var i,s,o;"2D"!=t.mode||t.isCesium2D||(i=t.map2D.getResolution()*CGS_DOTS_PER_INCH*CGS_INCHES_PER_METER,s=t.map2D.getCenter(),o=i*CGS_HEIGHT_TO_SCALE,t.map3D&&(t.map3D.setHeight(o),t.map3D.setCenter(s)))},CgsMap.prototype.moveend3DCallback_=function(e,t){var i,s,o,a;"3D"!=t.mode||t.isCesium2D||null!=(i=t.map3D.getHeight())&&(s=i/CGS_HEIGHT_TO_SCALE,o="EPSG:4326"==this.projection?s/CGS_INCHES_PER_METER/CGS_DOTS_PER_INCH/CGS_METERS_PER_DEGREE:s/CGS_INCHES_PER_METER/CGS_DOTS_PER_INCH,a=t.map2D.view.constraints_.resolution(o,0,0),t.startRes!=a&&(t.startRes=a,CgsSubPub.publish("zoomchanged",[t])))},CgsMap.prototype.loadConfig=function(e){new CgsConfigLoader(this).load(e)},CgsMap.prototype._switchRequestRenderMode=function(e){this.map3D&&("2D"!==e||this.isCesium2D?(this.map3D.scene.requestRenderMode=this._requestRenderMode,this.map3D.clockViewModel.shouldAnimate=this._shouldAnimate):(this.map3D.scene.requestRenderMode=!0,this.map3D.clockViewModel.shouldAnimate=!1))},CgsMap.prototype.setCesium2DMode=function(e){this.isCesium2D!=e&&("2D"==this.mode?(this.setMapMode("3D"),this.isCesium2D=e,this.setMapMode("2D")):this.isCesium2D=e)},CgsMap.prototype.setMapMode=function(e){var t=this;if(this.mode!=e){this._switchRequestRenderMode(e),this.mode=e,1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG||(p=CgsMap.checkEquipment())||"3D"!=e||(e="2D",this.mode="2D",console.warn("当前设备不支持WebGL,无法启动三维")),this.showNavigation(),this.showPlotScale();var i=document.getElementById(this.div2DContainerId),s=document.getElementById("CgsMapContainer3D"),o=document.getElementById("ol-feature-popup"),a=document.getElementById("cesium-feature-popup");this.moveListener2D_&&(CgsSubPub.unsubscribe(this.moveListener2D_),CgsSubPub.unsubscribe(this.moveListener3D_));var n,r,l,u,p=!0;if(this.moveListener2D_=CgsSubPub.subscribe(CgsEvent.eMove,function(e){p||(CgsSubPub.unsubscribe(t.moveListener2D_),CgsSubPub.unsubscribe(t.moveListener3D_),t.moveListener_=null,t.lastDestination_=null),p=!1}),this.moveListener3D_=CgsSubPub.subscribe("movestart3d",function(e){p||(CgsSubPub.unsubscribe(t.moveListener2D_),CgsSubPub.unsubscribe(t.moveListener3D_),t.moveListener_=null,t.lastDestination_=null),p=!1}),"2D"!=e||this.isCesium2D)if("2D"==e&&this.isCesium2D)this.map3D&&this.map3D.scene.morphTo2D(2);else if("3D"!=e||this.isCesium2D)"3D"==e&&this.isCesium2D?this.map3D&&this.map3D.scene.morphTo3D(2):"2.5D"==e&&this.isCesium2D&&this.map3D.scene.morphToColumbusView(2);else{if(i.style.visibility="hidden",s.style.visibility="visible",o&&(o.style.visibility="hidden"),a&&(a.style.visibility="visible"),this.overlays)for(h=this.overlays.length-1;0<=h;h--){c=this.overlays[h].overlay2D.getVisible();this.map2D.removeOverlay(this.overlays[h].overlay2D),this.overlays[h].overlay2D=null;g=this.overlays[h];this.overlays.splice(h,1),this.addOverlay(g),g.overlay3D.setVisible(c)}this.lastDestination_?u=(n=Cesium.Rectangle).fromDegrees.apply(n,_toConsumableArray(this.lastDestination_)):(l=this.map2D.getExtent(),u=(r=Cesium.Rectangle).fromDegrees.apply(r,_toConsumableArray(l)),this.lastDestination_=l),this.map3D.camera.setView({destination:u}),this.map3D.scene.mode=Cesium.SceneMode.SCENE3D}else{if(i.style.visibility="visible",s.style.visibility="hidden",a&&(a.style.visibility="hidden"),o&&(o.style.visibility="visible"),this.overlays)for(var h=this.overlays.length-1;0<=h;h--){var c=this.overlays[h].overlay3D.getVisible();this.map3D.removeFeature(this.overlays[h].overlay3D),this.overlays[h].overlay3D=null;var g=this.overlays[h];this.overlays.splice(h,1),this.addOverlay(g),g.overlay2D.setVisible(c)}var d,m,f,C,y=this.map3D.camera.computeViewRectangle(),v=y.south,b=y.east,D=y.west,S=y.north,v=Cesium.Math.toDegrees(v),S=Cesium.Math.toDegrees(S),b=Cesium.Math.toDegrees(b),D=Cesium.Math.toDegrees(D);v<=-85||85<=S||D<=-170||170<=b?(d=this.map3D.getHeight(),null!=(m=this.map3D.getCenter())&&null!=d&&(f=d/CGS_HEIGHT_TO_SCALE,C="EPSG:4326"==this.projection?f/CGS_INCHES_PER_METER/CGS_DOTS_PER_INCH/CGS_METERS_PER_DEGREE:f/CGS_INCHES_PER_METER/CGS_DOTS_PER_INCH,this.map2D.setResolution(C),this.map2D.setCenter(m))):this.lastDestination_?this.map2D.setExtent(this.lastDestination_):(this.map2D.setExtent([D,v,b,S]),this.lastDestination_=[D,v,b,S]),this.map2D.renderSync()}CgsSubPub.publish("modechanged",[e,this])}},CgsMap.prototype.modeChangedHandler=function(){var e=!0;this.moveListener_||(this.moveListener_=CgsSubPub.subscribe(CgsEvent.eMoveEnd,function(){e||(CgsSubPub.unsubscribe(this.moveListener_),this.moveListener_=null,this.lastDestination_=null),e=!1})),this.lastDestination_={}},CgsMap.prototype.getMapMode=function(){return this.mode},CgsMap.prototype.is2d=function(){return"2D"===this.mode},CgsMap.prototype.is3d=function(){return"3D"===this.mode},CgsMap.prototype.getCesium2DMode=function(){return this.isCesium2D},CgsMap.prototype._addFeatureLayer=function(e){var t,i;e&&(t=e.getType(),i=e.getId(),this._layerCache[t]||(this._layerCache[t]={}),Object(this._layerCache[t]).hasOwnProperty(i)||(e._onAdd(this),this._layerCache[t][i]=e,this.allLayers.push(e),CgsSubPub.publish("layeradded",[this,e])))},CgsMap.prototype._removeFeatureLayer=function(e){var t,i;e&&(t=e.getType(),i=e.getId(),Object(this._layerCache[t]).hasOwnProperty(i)&&(e._onRemove(this),delete this._layerCache[t][i],this.allLayers.splice(this.allLayers.indexOf(e),1),CgsSubPub.publish("layerremoved",[this,e])))},CgsMap.prototype.addLayer=function(e,t){if(e instanceof CgsFeatureLayer)this._addFeatureLayer(e);else{for(var i=!1,s=0;s<this.allLayers.length;s++)this.allLayers[s]==e&&(i=!0,console.info("the layer has been added to map"));if(!i){if((e.map=this).allLayers.push(e),e instanceof CgsWFSLayer||2!==WGMODEFLAG&&e instanceof CgsGraticuleLayer||!this.isCesium2D&&e.layer2D&&this.map2D.addLayer(e.layer2D),this.map3D&&this.map3D.addLayer(e.layer3D),null!=t&&e.getIndex()>t&&0<=t)for(var o=e.getIndex();t<o;)this.lowerLayer(e),o--;CgsSubPub.publish("layeradded",[this,e])}}},CgsMap.prototype.removeLayer=function(e){var t;e instanceof CgsFeatureLayer?this._removeFeatureLayer(e):-1!=this.allLayers.indexOf(e)&&(e.layer2D&&this.map2D.removeLayer(e.layer2D),this.map3D&&this.map3D.removeLayer(e.layer3D),this.allLayers.splice(this.allLayers.indexOf(e),1),e.getGroup()&&(t=this.getLayerGroupByName(e.getGroup())).array.splice(t.array.indexOf(e),1),CgsSubPub.publish("layerremoved",[this,e]))},CgsMap.prototype.removeAllLayers=function(){for(var e=this.getLayers(),t=e.length-1;-1<t;t--)this.removeLayer(e[t])},CgsMap.prototype.getLayers=function(){return this.allLayers},CgsMap.prototype.getLayerById=function(e){for(var t=0;t<this.allLayers.length;t++)if(this.allLayers[t].getId()==e)return this.allLayers[t]},CgsMap.prototype.getLayerByText=function(e){for(var t=0;t<this.allLayers.length;t++)if(this.allLayers[t].getText()==e)return this.allLayers[t]},CgsMap.prototype.getLayerIndexByText=function(e){for(var t=0;t<this.allLayers.length;t++)if(this.allLayers[t].getText()==e)return t},CgsMap.prototype.getLayerIndexById=function(e){var t=this.getLayerById(e);return t?this.allLayers.indexOf(t):(console.info("layer not found"),null)},CgsMap.prototype.addThing=function(e){this.map3D.addThing(e)},CgsMap.prototype.addLayerGroup=function(e){null==this.getLayerGroupByName(e.name)?this.layerGroups.push(e):console.info("the name of added featureGroup has been used,please rename it")},CgsMap.prototype.removeLayerGroup=function(e){if(e instanceof CgsLayerGroup){for(var t=e.array.length-1;0<=t;t--)this.removeLayer(e.array[t]);this.layerGroups.splice(this.layerGroups.indexOf(e),1)}},CgsMap.prototype.getLayerGroupByName=function(e){for(var t=0;t<this.layerGroups.length;t++)if(this.layerGroups[t].name==e)return this.layerGroups[t]},CgsMap.prototype.raiseLayer=function(e){var t,i,s;!e.getMap()||e instanceof CgsFeatureLayer||(i=(t=this.getLayers()).indexOf(e))<t.length&&(s=t[i+1],t[i+1]=t[i],t[i]=s,e instanceof CgsWFSLayer||2!==WGMODEFLAG&&e instanceof CgsGraticuleLayer?this.map3D&&this.map3D.raiseLayer(e.layer3D):(this.map3D&&this.map3D.raiseLayer(e.layer3D),s instanceof CgsWFSLayer||2!==WGMODEFLAG&&s instanceof CgsGraticuleLayer||this.map2D.raiseLayer(e.layer2D)))},CgsMap.prototype.lowerLayer=function(e){var t,i,s;!e.getMap()||e instanceof CgsFeatureLayer||(i=(t=this.getLayers()).indexOf(e))<t.length&&(s=t[i-1],t[i-1]=t[i],t[i]=s,e instanceof CgsWFSLayer||2!==WGMODEFLAG&&e instanceof CgsGraticuleLayer?this.map3D&&this.map3D.lowerLayer(e.layer3D):(this.map3D&&this.map3D.lowerLayer(e.layer3D),s instanceof CgsWFSLayer||2!==WGMODEFLAG&&s instanceof CgsGraticuleLayer||this.map2D.lowerLayer(e.layer2D)))},CgsMap.prototype.pixelToLonLat=function(e){return"3D"==this.mode?this.map3D.pixelToLonLat(e):"2D"!=this.mode||this.isCesium2D?"2D"==this.mode&&this.isCesium2D?this.map3D.pixelToLonLat(e):void 0:this.map2D.getLonLatFromPixel(e)},CgsMap.prototype.lonLatToPixel=function(e){return"3D"==this.mode?this.map3D.lonLatToPixel(e):"2D"!=this.mode||this.isCesium2D?"2D"==this.mode&&this.isCesium2D?this.map3D.lonLatToPixel(pixel):void 0:this.map2D.getPixelFromLonLat(e)},CgsMap.prototype.initJmp=function(e){var t;this.symbolTool||(this.tempCaptain.flag=!0,e&&this.tempCaptain.arr.push(e),this.symbolTool=new CgsSymbolTool(this),this.symbolTool.activate(null,!0),0<(t=document.getElementsByClassName("CgsToolBone")).length&&(t[t.length-1].style.display="none"),CgsSubPub.subscribe("jmpinitcomplete",function(e,t){t.tempCaptain.flag=!1,t.jmpHasInit=!0}))},CgsMap.prototype.addSymbol=function(e){this.jmpManage||new CgsJmpManage(map),this.jmpManage.addSymbol(e)},CgsMap.prototype.removeSymbol=function(e){this.jmpManage.removeSymbol(e)},CgsMap.prototype.removeSymbolGroup=function(e){for(var t=e.array.length-1;0<=t;t--)this.removeSymbol(e.array[t]),e.removeSymbol(e.array[t]);e.destory()},CgsMap.prototype.getSymbolByUid=function(e){for(var t=this.allSymbols.length-1;0<=t;t--)if(this.allSymbols[t].uid==e)return this.allSymbols[t];return!1},CgsMap.prototype.removeAllSymbols=function(){this.jmpManage.removeAllSymbols()},CgsMap.prototype.getAllSymbols=function(){return this.allSymbols},CgsMap.prototype.getAllSymbolGroups=function(){return this.symbolGroups},CgsMap.prototype.addSymbolGroup=function(e){this.getSymbolGroupByName(e.name)?console.info("the name of added symbolGroup has been used,please rename it"):this.symbolGroups.push(e)},CgsMap.prototype.getSymbolGroupByName=function(e){for(var t=0;t<this.symbolGroups.length;t++)if(this.symbolGroups[t].name==e)return this.symbolGroups[t]},CgsMap.prototype.addFeature=function(e){if(e){if(1==window.WGMODEFLAG||3==window.WGMODEFLAG){if(e instanceof CgsFlyMark)e.setMap(this);else if(e instanceof CgsCurve)e.feature.map=this,e.setMap(this),this.map2D.addEffect(e.feature),this.allFeatures.push(e),CgsSubPub.publish("featureadded",[e]);else if(e instanceof CgsCircleAnimation){var t;(e.map=this).addOverlay(e.overlay),this.effectManager.effectObjects.push(e),1==this.effectManager.effectObjects.length&&this.effectManager.startRender(),this.map3D&&this.map3D.isMultiViewsMode&&(this.map3D.twoViewsMode||this.map3D.pip)&&((t=new CgsCircleAnimation({position:e.position,radius:e.radius,fillColor:e.fillColor,duration:e.duration})).parent=e,t.map=this,e.clones.push(t),this.addOverlay(t.overlay),t.overlay.overlay3D.parent=e.overlay.overlay3D,this.effectManager.effectObjects.push(t)),this.allFeatures.push(e),CgsSubPub.publish("featureadded",[e])}else if(e instanceof CgsWaterNormals)e.map=this.map3D,this.map3D.addFeature(e.feature3D);else if(e instanceof CgsDynamicRiver)e.map=this.map3D,this.map3D.addFeature(e.feature3D);else if(e instanceof CgsRoad)e.map=this.map3D,this.map3D.addFeature(e.feature3D);else if(e instanceof CgsPolylinePrimitive)e.setMap(this),this.map3D.addFeature(e.feature3D);else if(e.getMap()!=this){if(e.setMap(this),e instanceof CgsParabola||e instanceof CgsRadar||e instanceof CgsExplode||e instanceof Cgs3DTileset||e instanceof CgsPrecipitation||e instanceof CgsStreamLine||e instanceof CgsLineAnimation||e instanceof CgsFireworks||e instanceof CgsTailFire||e instanceof CgsSpreadEffect||e instanceof CgsPlaneRadar||e instanceof CgsLayerRadar||e instanceof CgsPlaneScanRadar||e instanceof CgsDynTransmit||e instanceof CgsGlowFlyLine||e instanceof CgsFlightLine||e instanceof CgsLightCone||e instanceof CgsScrollWall||e instanceof CgsDiffuseWall||e instanceof CgsPit||e instanceof CgsWindLayer||e instanceof CgsCanvasWindLayer||e instanceof CgsEchartsLayer||e instanceof CgsThreeLayer)this.map3D&&this.map3D.addFeature(e.feature3D);else if(e instanceof CgsFlyLine){for(var i=0;i<e.entities.length;i++)this.map2D.addFeature(e.entities[i].feature2D),this.map3D&&this.map3D.addFeature(e.entities[i].feature3D);e.start()}else e instanceof CgsImageFlyLine?this.map3D&&this.map3D.entities.add(e.entity):e instanceof CgsSlope||e instanceof CgsRibbon?this.map3D.addFeature(e):e instanceof CgsRectangleEntity?this.map3D&&this.map3D.addFeature(e):e instanceof CgsStream?(e.feature2D.start(),this.map3D&&this.map3D.addFeature(e.feature3D)):(this.map3D&&e.feature3D&&this.map3D.addFeature(e.feature3D),e.feature2D&&!this.isCesium2D&&(e.feature2DHelper&&this.map2D.addFeature(e.feature2DHelper),this.map2D.addFeature(e.feature2D)));this.allFeatures.push(e),CgsSubPub.publish("featureadded",[e])}}else e instanceof CgsCurve?(e.feature.map=this,e.setMap(this),this.map2D.addEffect(e.feature),this.allFeatures.push(e),CgsSubPub.publish("featureadded",[e])):e instanceof CgsCircleAnimation?((e.map=this).addOverlay(e.overlay),this.effectManager.effectObjects.push(e),1==this.effectManager.effectObjects.length&&this.effectManager.startRender(),this.allFeatures.push(e),CgsSubPub.publish("featureadded",[e])):e.feature2D&&(e.map=this,e.feature2DHelper&&this.map2D.addFeature(e.feature2DHelper),this.map2D.addFeature(e.feature2D)),this.allFeatures.push(e),CgsSubPub.publish("featureadded",[e]);"3D"==this.mode&&(e instanceof CgsMark||e instanceof CgsLine)&&e.feature2D&&e.feature2D.group&&e.feature2D.group.setFeatureVisible_(e.feature2D,!1)}},CgsMap.prototype.getFeatureById=function(e){for(var t=0;t<this.allFeatures.length;t++)if(this.allFeatures[t].getId&&this.allFeatures[t].getId()==e)return this.allFeatures[t]},CgsMap.prototype.getAllFeatures=function(){return this.allFeatures},CgsMap.prototype.removeFeature=function(e){if(1==window.WGMODEFLAG||3==window.WGMODEFLAG)if(e.getMap()){if(e.setMap(null),e instanceof CgsCurve)this.map2D.removeEffect(e.feature.CgsEffectObj,e.feature.id);else if(e instanceof CgsWaterNormals)this.map3D.removeFeature(e.feature3D);else if(e instanceof CgsParabola||e instanceof CgsRadar||e instanceof CgsExplode||e instanceof CgsTailFire||e instanceof CgsSpreadEffect||e instanceof CgsPlaneRadar||e instanceof CgsLayerRadar||e instanceof CgsPlaneScanRadar||e instanceof CgsDynTransmit||e instanceof CgsGlowFlyLine||e instanceof CgsWideLine||e instanceof CgsFlightLine||e instanceof CgsLightCone||e instanceof CgsScrollWall||e instanceof CgsPit||e instanceof CgsDynamicRiver||e instanceof CgsRoad||e instanceof CgsDiffuseWall||e instanceof CgsCanvasWindLayer||e instanceof CgsWindLayer||e instanceof CgsEchartsLayer||e instanceof CgsThreeLayer||e instanceof CgsPolylinePrimitive)this.map3D&&this.map3D.removeFeature(e.feature3D);else if(e instanceof CgsFlyLine){clearInterval(e.timer);for(var t=0;t<e.entities.length;t++)this.map2D&&this.map2D.removeFeature(e.entities[t].feature2D),this.map3D&&this.map3D.removeFeature(e.entities[t].feature3D)}else if(e instanceof CgsImageFlyLine)this.map3D&&this.map3D.removeFeature(e);else if(e instanceof CgsSlope)this.map3D&&this.map3D.removeFeature(e);else if(e instanceof CgsRibbon)this.map3D&&this.map3D.removeFeature(e);else if(e instanceof CgsRectangleEntity)this.map3D&&this.map3D.removeFeature(e.entity);else if(e instanceof CgsStream)e.feature2D.stop(),this.map3D&&this.map3D.removeFeature(e.feature3D);else if(e instanceof CgsCircleAnimation){this.removeOverlay(e.overlay),this.effectManager.effectObjects.splice(this.effectManager.effectObjects.indexOf(e),1),0==this.effectManager.effectObjects.length&&this.effectManager.stopRender();for(t=0;t<e.clones.length;++t){var i=e.clones[t];this.removeFeature(i)}}else e&&e.feature2D&&(this.map2D.removeFeature(e.feature2D),e.feature2DHelper&&this.map2D.removeFeature(e.feature2DHelper)),this.map3D&&e.feature3D&&this.map3D.removeFeature(e.feature3D);this.allFeatures.splice(this.allFeatures.indexOf(e),1),(s=this.getFeatureGroupByName(e.groupName))&&s.array&&s.array.splice(s.array.indexOf(e),1),CgsSubPub.publish("featureremoved",[e])}else console.info("map of feature is null");else if(e.getMap()){if(e.setMap(null),e instanceof CgsCurve)this.map2D.removeEffect(e.feature.CgsEffectObj,e.feature.id);else if(e instanceof CgsParabola||e instanceof CgsExplode||e instanceof CgsSpreadEffect||e instanceof CgsDynTransmit||e instanceof CgsGlowFlyLine||e instanceof CgsWideLine||e instanceof CgsFlightLine)this.map3D&&this.map3D.removeFeature(e.feature3D);else if(e instanceof CgsFlyLine){clearInterval(e.timer);for(t=0;t<e.entities.length;t++)this.map2D&&this.map2D.removeFeature(e.entities[t].feature2D),this.map3D&&this.map3D.removeFeature(e.entities[t].feature3D)}else e instanceof CgsImageFlyLine||e instanceof CgsSlope?this.map3D&&this.map3D.removeFeature(e):e instanceof CgsStream?(e.feature2D.stop(),this.map3D&&this.map3D.removeFeature(e.feature3D)):e instanceof CgsCircleAnimation?(this.removeOverlay(e.overlay),this.effectManager.effectObjects.splice(this.effectManager.effectObjects.indexOf(e),1),0==this.effectManager.effectObjects.length&&this.effectManager.stopRender()):(e&&e.feature2D?(e.feature2D.remove(),e.feature2DHelper&&e.feature2DHelper.remove()):console.info("feature/feature.feature2d is null"),this.map3D&&e.feature3D&&this.map3D.removeFeature(e.feature3D));var s;this.allFeatures.splice(this.allFeatures.indexOf(e),1),(s=this.getFeatureGroupByName(e.groupName))&&s.array&&s.array.splice(s.array.indexOf(e),1),CgsSubPub.publish("featureremoved",[e])}else console.info("map of feature is null");e.labelLine&&(this.labeldragFeatureGroup.splice(this.labeldragFeatureGroup.indexOf(e),1),this.removeFeature(e.labelLine))},CgsMap.prototype.removeAllEffect=function(e){this.map2D.removeAllEffect(e.obj)},CgsMap.prototype.removeAllFeatures=function(){for(var e=this.allFeatures.length-1;-1<e;e--)this.removeFeature(this.allFeatures[e]);this.allFeatures=[]},CgsMap.prototype.addFeatureGroup=function(e){null==this.getFeatureGroupByName(e.name)?this.featureGroups.push(e):console.info("the name of added featureGroup has been used,please rename it")},CgsMap.prototype.removeFeatureGroup=function(e){this.featureGroups.splice(this.featureGroups.indexOf(e),1);for(var t=e.array.length-1;0<=t;t--)e.array[t].getMap()==this&&this.removeFeature(e.array[t])},CgsMap.prototype.getFeatureGroupByName=function(e){for(var t=0;t<this.featureGroups.length;t++)if(this.featureGroups[t].name==e)return this.featureGroups[t]},CgsMap.prototype.setModelPluggInfo=function(e){this.modelPluggInfo=e},CgsMap.prototype.getModelPluggInfo=function(){return this.modelPluggInfo},CgsMap.prototype.addOverlay=function(e){var t;e.setMap(this),"2D"!=this.mode||this.isCesium2D?(e.overlay3D=new CgsOverlay3D(e.options),this.map3D.addFeature(e.overlay3D),this.map3D&&this.map3D.isMultiViewsMode&&(this.map3D.twoViewsMode||this.map3D.pip)&&e.cloneMode&&((t=e.options).element=$$(t.element).clone()[0],e.cloneOverlay3D=new CgsOverlay3D(t),e.cloneOverlay3D.parent=e.overlay3D,e.overlay3D.clones.push(e.cloneOverlay3D),this.map3D.addFeature(e.cloneOverlay3D)),this.overlays.push(e)):(e.overlay2D=new CgsOverlay2D(e.options),this.map2D.addOverlay(e.overlay2D),this.overlays.push(e),this.map2D.render())},CgsMap.prototype.getOverlayById=function(e){if("3D"==this.mode){for(var t=0;t<this.overlays.length;t++)if(this.overlays[t].overlay3D.dom.id==e)return this.overlays[t]}else if("2D"==this.mode)for(t=0;t<this.overlays.length;t++)if(this.overlays[t].overlay2D.element.id==e)return this.overlays[t];return!1},CgsMap.prototype.removeOverlay=function(e){"2D"==this.mode&&!this.isCesium2D&&e.overlay2D?this.map2D.removeOverlay(e.overlay2D):this.map3D.removeFeature(e.overlay3D),e&&(e.map=null,this.overlays.splice(this.overlays.indexOf(e),1))},CgsMap.prototype.removeAllOverlays=function(){for(var e=this.overlays.length-1;-1<e;e--)this.removeOverlay(this.overlays[e]);this.overlays=[]},CgsMap.prototype.removeAllFeatureByMouse=function(){if(0<this.featuresDrawedByMouse.length){for(var e=0;e<this.featuresDrawedByMouse.length;e++)this.removeFeature(this.featuresDrawedByMouse[e]),this.featuresDrawedByMouse[e].editOverlay&&this.removeOverlay(this.featuresDrawedByMouse[e].editOverlay);this.featuresDrawedByMouse=[]}},CgsMap.prototype.removeAllMeasureFeature=function(){if(0<this.featuresMeasureByMouse.length){for(var e=0;e<this.featuresMeasureByMouse.length;e++)this.removeFeature(this.featuresMeasureByMouse[e]);for(e=0;e<this.overlayMeasureByMouse.length;e++)this.removeOverlay(this.overlayMeasureByMouse[e]);this.featuresMeasureByMouse=[],this.overlayMeasureByMouse=[]}},CgsMap.prototype.setSkyAtmosphereVisible=function(e){this.threeFlag&&this.map3D.setSkyAtmosphereVisible(e)},CgsMap.prototype.getSkyAtmosphereVisible=function(){if(this.threeFlag)return this.map3D.getSkyAtmosphereVisible()},CgsMap.prototype.fullScreen=function(e){var t,i,s,o,a=document.getElementById(this.target),n=document.getElementById("CgsMapContainer3D"),r=document.getElementById(this.div2DContainerId);e?(this.toolbarState.toolbar=this.toolbar.visible,a.style.top="0px",a.style.left="0px",a.style.position="absolute",a.style.width="100%",a.style.height="100%",n.style.zIndex="9999",r.style.zIndex="9999",this.toolbar&&(t=this.toolbar.mapEarth.container,(i=document.getElementById("toolDiv"))&&t.removeChild(i)),this.symbolTool&&this.symbolTool.deactivate(),this.toolbarPlugg&&this.toolbarPlugg.deactivate(),this.map3D&&this.map3D.hideNavigation(),void 0!==(o=(s=document.documentElement).requestFullScreen||s.webkitRequestFullScreen||s.mozRequestFullScreen||s.msRequestFullScreen)&&o&&o.call(s)):(a.style.top="",a.style.left="",a.style.position="",a.style.width="",a.style.height="",n.style.zIndex="",r.style.zIndex="",1==this.toolbar.visible&&this.toolbar.show(),this.toolbarState.Navigation&&this.showNavigation(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen())},CgsMap.prototype.syncDom=function(){for(var e=0;e<this.allMapNotes.length;e++)this.allMapNotes[e].updateOverlay3dom()},CgsMap.prototype.addDataSource=function(e){this.map2D&&(e instanceof CgsGeoJSON?this.map2D.addGroupVector(e.json2DVectorLayer):e instanceof CgsKml?this.map2D.addKmlVector(e.kml2D):e instanceof CgsCSV&&this.map2D.addGroupVector(e.csvLayer2D)),this.map3D&&(e instanceof CgsGeoJSON?this.map3D.addFeatureGroup(e.json3DVectorLayer):e instanceof CgsKml?this.map3D.addDataSource(e.kml3D):e instanceof CgsCzml?this.map3D.addDataSource(e.czml3D):e instanceof CgsPointAggregation?this.map3D.addDataSource(e.geoJson3D):e instanceof CgsCSV&&this.map3D.addFeatureGroup(e.csvLayer3D)),this.allDataSources.push(e),CgsSubPub.publish("datasourceadded",[this,e])},CgsMap.prototype.getDataSourceByName=function(e){if(this.map3D)return this.map3D.getDataSourceByName(e).parent},CgsMap.prototype.getDataSourceById=function(e){for(var t=this.getAllDataSources(),i=0;i<t.length;i++)if(t[i].getId()==e)return t[i]},CgsMap.prototype.removeDataSource=function(e){this.map2D&&(e instanceof CgsGeoJSON?this.map2D.removeGroupVector(e.json2DVectorLayer):e instanceof CgsKml?this.map2D.removeKmlVector(e.kml2D):e instanceof CgsCSV&&this.map2D.removeGroupVector(e.csvLayer2D)),this.map3D&&(e instanceof CgsGeoJSON?this.map3D.removeFeatureGroup(e.json3DVectorLayer):e instanceof CgsKml?this.map3D.removeDataSource(e.kml3D):e instanceof CgsCzml?this.map3D.removeDataSource(e.czml3D):e instanceof CgsPointAggregation?this.map3D.removeDataSource(e.geoJson3D):e instanceof CgsCSV&&this.map3D.removeFeatureGroup(e.csvLayer3D)),this.allDataSources.splice(this.allDataSources.indexOf(e),1),CgsSubPub.publish("datasourceremoved",[this,e])},CgsMap.prototype.removeAllDataSources=function(){for(var e=0;e<this.allDataSources.length;e++)this.removeDataSource(this.allDataSources[e])},CgsMap.prototype.getAllDataSources=function(){return this.allDataSources},CgsMap.prototype.setLightingVisible=function(e){this.threeFlag&&this.map3D.setLightingVisible(e)},CgsMap.prototype.getLightingVisible=function(){if(this.threeFlag)return this.map3D.getLightingVisible()},CgsMap.prototype.setFogVisible=function(e){this.threeFlag&&this.map3D.setFogVisible(e)},CgsMap.prototype.getFogVisible=function(){if(this.threeFlag)return this.map3D.getFogVisible()},CgsMap.prototype.setTerrain=function(e){(e instanceof CgsTerrain||e instanceof CgsTileTerrain||e instanceof CgsTimeDynamicTerrain)&&this.map3D.setTerrain(e.terrain3D)},CgsMap.prototype.getTerrain=function(){return this.map3D.getTerrain()},CgsMap.prototype.setDefaultTerrain=function(){return this.map3D.setDefaultTerrain()},CgsMap.prototype.setPickColor=function(e){this.map3D.setPickColor(e)},CgsMap.prototype.getPickColor=function(){return this.map3D.getPickColor()},CgsMap.prototype.setCenter=function(e){"2D"==this.mode?this.map2D.setCenter(e):"3D"==this.mode&&this.map3D.setCenter(e)},CgsMap.prototype.getCenter=function(){return"2D"==this.mode?this.map2D.getCenter():"3D"==this.mode?this.map3D.getCenter():void 0},CgsMap.prototype.autoRotate=function(e){"3D"==this.mode&&this.map3D.autoRotate(e)},CgsMap.prototype.flyHome=function(){"2D"==this.mode?(this.map2D.setCenter([107.5,34]),this.map2D.setZoom(5)):"3D"==this.mode&&this.map3D.flyToPosition({destination:[107.5,34,77e5]})},CgsMap.prototype.lookAt=function(e){"3D"==this.mode&&this.map3D.lookAt(e)},CgsMap.prototype.flyToNorse=function(){"3D"==this.mode&&this.map3D.flyToNorse()},CgsMap.prototype.flyBack=function(){this.flyTo({destination:this.homeCenter})},CgsMap.prototype.leftRotate=function(e){var t,i=this;null==this.map3D||this.leftRotateActive||(this.leftRotateActive=!this.leftRotateActive,this.rightRotateActive=!1,this.map3D.leftRotate(e)),this.leftRotateEvent||(t=180*this.map2D.view.getRotation()/Math.PI,this.leftRotateEvent=setInterval(function(){"2D"==i.mode&&(t--,i.map2D.view.setRotation(t*Math.PI/180))},50))},CgsMap.prototype.flyToFeature=function(e,t){if(!e)return console.error("参数未定义");if(this.map3D){var i=[];if(Array.isArray(e)){var s=!0,o=!1,a=void 0;try{for(var n,r=e[Symbol.iterator]();!(s=(n=r.next()).done);s=!0){var l=n.value;i.push(l.getEntity())}}catch(e){o=!0,a=e}finally{try{!s&&r.return&&r.return()}finally{if(o)throw a}}}else if(e instanceof CgsKml)i=e.kml3D.entities;else if(e instanceof CgsGeoJSON){var u=!0,p=!1,h=void 0;try{for(var c,g=e.features[Symbol.iterator]();!(u=(c=g.next()).done);u=!0){var d=c.value;i.push(d.getEntity())}}catch(e){p=!0,h=e}finally{try{!u&&g.return&&g.return()}finally{if(p)throw h}}}else e instanceof CgsFeature&&(i=e.getEntity());return this.map3D.flyTo(i,t)}console.error("参数错误，定位失败")},CgsMap.prototype.rightRotate=function(e){var t,i=this;null==this.map3D||this.rightRotateActive||(this.rightRotateActive=!this.rightRotateActive,this.leftRotateActive=!1,this.map3D.rightRotate(e)),this.rightRotateEvent||(t=180*this.map2D.view.getRotation()/Math.PI,this.rightRotateEvent=setInterval(function(){"2D"==i.mode&&(t++,i.map2D.view.setRotation(t*Math.PI/180))},50))},CgsMap.prototype.cancelRotate=function(){null!=this.map3D&&(this.leftRotateActive=!1,this.rightRotateActive=!1,this.map3D.cancelRotate()),this.leftRotateEvent&&(window.clearInterval(this.leftRotateEvent),this.leftRotateEvent=null),this.rightRotateEvent&&(window.clearInterval(this.rightRotateEvent),this.rightRotateEvent=null)},CgsMap.prototype.setHeight=function(e){"3D"==this.mode&&this.map3D.setHeight(e)},CgsMap.prototype.zoomIn=function(){var e;"2D"==this.mode?this.map2D.setZoom(this.map2D.getZoom()+1):"3D"==this.mode&&(e=this.map3D.getHeight(),this.map3D.zoomIn(e/2))},CgsMap.prototype.zoomOut=function(){var e;"2D"==this.mode?0<this.map2D.getZoom()?this.map2D.setZoom(this.map2D.getZoom()-1):this.map2D.setZoom(0):"3D"==this.mode&&(e=this.map3D.getHeight(),this.map3D.zoomOut(2*e))},CgsMap.prototype.localZoomIn=function(){var n,r;this.selectRegion||(this.selectRegion=new CgsSelectRegion({mapObject:this,type:"RECT"}),n=this,r=CgsSubPub.subscribe("selectend",function(e,t){var i=Math.min(t[0][0],t[2][0]),s=Math.max(t[0][0],t[2][0]),o=Math.min(t[0][1],t[2][1]),a=Math.max(t[0][1],t[2][1]);n.flyTo({destination:[i,o,s,a]}),n.selectRegion.deactivate(),CgsSubPub.unsubscribe(r),n.selectRegion=null}),this.selectRegion.activate())},CgsMap.prototype.setZoom=function(e){var t;"2D"==this.mode?this.map2D.setZoom(e):"3D"==this.mode&&(t=this.map2D.getResolutionByZoom(e)*CGS_DOTS_PER_INCH*CGS_INCHES_PER_METER*CGS_HEIGHT_TO_SCALE,this.map3D.setHeight(t))},CgsMap.prototype.getZoom=function(){if("2D"==this.mode)return this.map2D.getZoom();if("3D"==this.mode){var e=this.map3D.getHeight();if(null!=e){var t=e/CGS_HEIGHT_TO_SCALE/CGS_INCHES_PER_METER/CGS_DOTS_PER_INCH;return this.map2D.getZoomByResolution(t)}}},CgsMap.prototype.getZoomByResolution=function(e){this.map2D&&this.map2D.getZoomByResolution(e)},CgsMap.prototype.setMinZoom=function(e){this.map2D.setMinZoom(e)},CgsMap.prototype.setMaxZoom=function(e){this.map2D.setMaxZoom(e)},CgsMap.prototype.getResolution=function(){if("2D"==this.mode)return this.map2D.getResolution();if("3D"==this.mode){var e=this.map3D.getHeight();if(null!=e)return e/CGS_HEIGHT_TO_SCALE/CGS_INCHES_PER_METER/CGS_DOTS_PER_INCH}},CgsMap.prototype.getHeight=function(){return"3D"==this.mode?this.map3D.getHeight():this.map2D.view.get("resolution")*CGS_INCHES_PER_METER*CGS_DOTS_PER_INCH*CGS_HEIGHT_TO_SCALE},CgsMap.prototype.lockScreen=function(e,t){!1!==t&&(this.lockFlag=e),null!=this.map2D&&this.map2D.lockScreen(e),null!=this.map3D&&this.map3D.lockScreen(e)},CgsMap.prototype.screenToRect=function(){for(var e,t=this.container,i=t.scrollWidth,s=t.scrollHeight,o=180,a=-180,n=90,r=-90,l=[[0,0],[0,s],[i,s],[i,0]],u=0;u<4;u++){if(!(e=this.pixelToLonLat(l[u])))return;o>e[0]&&(o=e[0]),a<e[0]&&(a=e[0]),n>e[1]&&(n=e[1]),r<e[1]&&(r=e[1])}return[[o,n],[a,r]]},CgsMap.prototype.saveMapInExtentAndLevelAsImage=function(e){var t=(t=e.level)||this.getZoom(),i=e.extent,s=ol.proj.transform([i[0],i[1]],"EPSG:4326",this.projection),o=ol.proj.transform([i[2],i[3]],"EPSG:4326",this.projection),i=[s[0],s[1],o[0],o[1]],a=this.map2D.frameState_.viewState.projection,n=this.map2D.values_.layergroup.values_.layers.array_,r={};r[t]={};for(var l=0,u=0,p=0,h=0;h<n.length;h++){(b=(v=n[h]).values_.rectangle)&&(b[2]<e.extent[0]||b[3]<e.extent[1]||b[0]>e.extent[2]||b[1]>e.extent[3])||v instanceof CgsLayerTile2D&&v.getVisible()&&p++}for(var c=0,h=0;h<n.length;h++){if((v=n[h])instanceof CgsLayerTile2D){c=v.values_.source.resolutions;break}}var g=(i[2]-i[0])/c[t],d=(i[3]-i[1])/c[t];if(2e3<p*(g/256)*(d/256))console.info("所选区域或者指定的级别过大");else{var m=document.createElement("canvas"),f=m.getContext("2d");m.width=g,m.height=d;var C=0,y=0;f.globalCompositeOperation="source-over";for(var v,b,h=0;h<n.length;h++){if((!(b=(v=n[h]).values_.rectangle)||!(b[2]<e.extent[0]||b[3]<e.extent[1]||b[0]>e.extent[2]||b[1]>e.extent[3]))&&(v instanceof CgsLayerTile2D&&v.getVisible())){var D,S,_,w,P,T=v.getSource(),M=(function(e,t,i){}(T,a,r),T.getTileGridForProjection(a)),L=M.getResolution(t),x=M.getTileRangeForExtentAndZ(i,t);0==h&&(D=M.getOrigin(t),S=i[0],_=i[1],w=256*x.minX*L+D[0],P=D[1]-256*-x.minY*L,C=(S-w)/L,y=(_-P)/L);v.getUseInterimTilesOnError();for(var E,A,I,F=x.minX,k=0;F<=x.maxX;++F,k++)for(A=x.minY,I=0;A<=x.maxY;++A,I++){E=T.getTile(t,F,A,1,a);var R=new Image;R.n=I,R.m=k,R.onload=function(){f.drawImage(this,256*this.m-C,m.height-256*this.n-256+y,256,256),l++,O(x)},R.onerror=function(){u++,O(x)},R.crossOrigin="anonymous",R.src=E.src_}}}}function O(e){var t,i,s;l+u==p*(e.maxX-e.minX+1)*(e.maxY-e.minY+1)&&(t=$$("<a>"),i=function(e,t){for(var i=window.atob(e.split(",")[1]),s=new Uint8Array(i.length),o=0;o<i.length;o++)s[o]=i.charCodeAt(o);return new File([s],{type:"image/"+t})}(m.toDataURL("image/png",.1),"png"),t.attr("href",URL.createObjectURL(i)),t.attr("download","test"+(new Date).getTime()+".png"),"Chrome"==this.browerType?t.get(0).click():((s=document.createEvent("MouseEvents")).initEvent("click",!0,!0),t.get(0).dispatchEvent(s)))}},CgsMap.prototype.addSkyBox=function(){this.three||(this.three=new CgsThree),this.container.style.display="none",this.three.container.style.display="block",this.three.startAnimate(),this.mesh=this.three.addSkybox(),this.three.addEvent()},CgsMap.prototype.removeSkyBox=function(){this.three.removeMesh(this.mesh),this.mesh=null,this.three.removeEvent(),this.three.stopAnimate(),this.three.container.style.display="none",this.container.style.display="block"},CgsMap.prototype.showToolBar=function(){null==this.toolbar&&(this.toolbar=new CgsToolBar({mapObject:this}),this.toolbar.visible=!0)},CgsMap.prototype.hideToolBar=function(){this.toolbar&&(this.toolbar.hide(),this.toolbar=null)},CgsMap.prototype.showViewInfo=function(){null==this.viewifo?this.viewifo=new CgsViewInfo(this):this.viewifo.show()},CgsMap.prototype.hideViewInfo=function(){this.viewifo&&this.viewifo.hide()},CgsMap.prototype.showAerialView=function(){null==this.aerialView?this.aerialView=new CgsAerialView(this):this.aerialView.show()},CgsMap.prototype.hideAerialView=function(){this.aerialView&&this.aerialView.hide()},CgsMap.prototype.getPlotScale=function(){return parseFloat((this.getHeight()/.38265245).toFixed(8))},CgsMap.prototype.addNavigation=function(e){this.map3D&&(this.map3D.addNavigation(e),this.showNavigation())},CgsMap.prototype.removeNavigation=function(){this.map3D&&this.map3D.removeNavigation()},CgsMap.prototype.showNavigation=function(){"3D"==this.mode?this.map3D.showNavigation():this.map3D&&this.map3D.hideNavigation(),this.toolbarState.Navigation=!0},CgsMap.prototype.hideNavigation=function(){this.map3D&&this.map3D.hideNavigation(),this.toolbarState.Navigation=!1},CgsMap.prototype.addPlotScale=function(){this.plotScale||(this.plotScale=new CgsScaleLine({map:this,minWidth:64}),this.plotScale.show(),this.plotScaleFlag=!0)},CgsMap.prototype.removePlotScale=function(){this.plotScale&&(this.plotScale.destroy(),this.plotScale=null,this.plotScaleFlag=!1)},CgsMap.prototype.showPlotScale=function(){this.plotScale&&(this.plotScale.show(),this.plotScaleFlag=!0)},CgsMap.prototype.hidePlotScale=function(){this.plotScale&&(this.plotScale.hide(),this.plotScaleFlag=!1)},CgsMap.prototype.setFlatCloudVisible=function(e){this.threeFlag&&this.map3D.setFlatCloudVisible(e)},CgsMap.prototype.getFlatCloudVisible=function(){if(this.threeFlag)return this.map3D.getFlatCloudVisible()},CgsMap.prototype.setStarVisible=function(e){var t,i;this.threeFlag&&(this.starrySky?this.starrySky.setVisible(e):(t={show:e,colors:["rgb(255,177,140)","rgb(38,60,200)","rgb(255,251,68)","rgb(246,185,20)","rgb(235,96,10)","rgb(125,125,125)"]},this.starrySky=new CgsStar(t),i=this.map3D.scene,Cesium.defined(i)&&(i.primitives.add(this.starrySky.feature3D.getStarrySky()),this.starrySky.feature3D.setMap(this))),this.map3D.scene.skyBox.show=!1)},CgsMap.prototype.getStarVisible=function(){if(this.threeFlag)return!!this.starrySky&&this.starrySky.getVisible()},CgsMap.prototype.setOceanVisible=function(e){var t,i;this.threeFlag&&(this.ocean?this.ocean.setVisible(e):(t={mapObject:this},this.ocean=new CgsOcean(t),i=this.map3D.scene,Cesium.defined(i)&&(i.primitives.add(this.ocean.ocean3D.getOcean()),this.ocean.setMap(this),this.ocean.setVisible(e))))},CgsMap.prototype.getOceanVisible=function(){if(this.threeFlag)return!!this.ocean&&this.ocean.getVisible()},CgsMap.prototype.getEarthWeak=function(){var e;return this.earthWeakObj||(e={visible:!1,mapObject:this,strokeColor:"rgba(255,255,255,1.0)",strokeWidth:1,gridVisible:!1,color:"rgba(48,48,48,1.0)",gridColor:"rgba(61,61,61,1.0)",countryStrokeVisible:!1},this.earthWeakObj=new CgsEarthWeak(e)),this.earthWeakObj},CgsMap.prototype.getTerrainColour=function(){var e;return this.terrainColour||(e={visible:!1,mapObject:this},this.terrainColour=new CgsTerrainColour(e)),this.terrainColour},CgsMap.prototype.getTerrainColourAndGrid=function(){var e;return this.terrainColourAndGrid||(e={visible:!1,mapObject:this,rampColor:["rgba(251,125,0,1.0)","rgba(236,118,0,1.0)","rgba(221,111,0,1.0)","rgba(191,96,0,1.0)","rgba(170,80,0,1.0)","rgba(147,73,0,1.0)","rgba(125,63,0,1.0)"],ramp:[0,.25,.4,.6,.75,.9,1],maxHeight:5e3},this.terrainColourAndGrid=new CgsTerrainColour(e)),this.terrainColourAndGrid},CgsMap.prototype.getTerrainClip=function(){var e;return!this.terrainClip&&this.map3D&&(e={mapObject:this.map3D},this.terrainClip=new CgsTerrainClip(e)),this.terrainClip},CgsMap.prototype.flyTo=function(e){var t,i,s,o,a,n,r,l,u,p,h;"2D"!=this.mode||this.isCesium2D?("2D"==this.mode&&this.isCesium2D||"3D"==this.mode)&&this.map3D.flyToPosition(e):(2==(t=e.destination).length?this.map2D.setCenter(t):3==t.length?(this.map2D.setCenter([t[0],t[1]]),i=(p=t[2]/CGS_HEIGHT_TO_SCALE)/CGS_INCHES_PER_METER/CGS_DOTS_PER_INCH,h=this.map2D.getZoomByResolution(i),this.map2D.setZoom(h)):4==t.length&&(s=this.map2D.getPixelFromLonLat([t[0],t[3]]),a=[((o=this.map2D.getPixelFromLonLat([t[2],t[1]]))[0]+s[0])/2,(o[1]+s[1])/2],n=this.map2D.getCoordinateFromPixel(a),r=this.map2D.get(ol.MapProperty.SIZE),l=o[1]-s[1],u=o[0]-s[0],p=r[1]/l,r[0]/u<p&&(p=r[0]/u),p=Math.floor(Math.log2(p)),(h=this.getZoom()+p)<1&&(h=1),this.setZoom(h),this.map2D.view.setCenter(n)),e.completeCallback&&e.completeCallback())},CgsMap.prototype.getExtent=function(){return this.map2D.getExtent()},CgsMap.prototype.setExtent=function(e){CgsUtil.isArray(e)&&4==e.length||console.error("地图显示范围有误"),this.map2D.setExtent(e)},CgsMap.prototype.clearSymbolScene=function(){if(!this.jmpApi)return console.error("gJMP is not initialized yet!"),"";this.jmpManage.removeAllSymbols()},CgsMap.prototype.saveSymbolScene=function(){return this.jmpApi?this.jmpApi.exportAsString():(console.error("gJMP is not initialized yet!"),"")},CgsMap.prototype.saveAfferentSymbolsScene=function(e){if(!this.jmpApi)return console.error("gJMP is not initialized yet!"),"";if(!e||0===e.length)return"";var t=[];return e.forEach(function(e){e&&e.uid&&t.push(e.uid)}),this.jmpApi.exportSegmentAsString(t)},CgsMap.prototype.loadSymbolScene=function(e,t){if(!this.jmpApi)return console.error("gJMP is not initialized yet!"),"";this.plotting._tool_manager.switch_creating(),this.jmpApi.importByString(e,void 0,t),this.plotting._tool_manager.switch_editing()},CgsMap.prototype.loadSymbolString=function(e,t,i){if(!this.jmpApi)return console.error("gJMP is not initialized yet!"),"";this.plotting._tool_manager.switch_creating(),this.jmpApi.importByString(e,t,i),this.plotting._tool_manager.switch_editing()},CgsMap.prototype.loadSymbolScenes=function(t,i){var s,o,a;CgsUtil.isArray(t)?(s=t.length-1,o=0,a=this,function e(){if(s<o)return i&&i(),1;a.loadSymbolScene(t[o],function(){o++,e()})}()):console.warn("非法参数输入：请传入sml字符串数组")},CgsMap.prototype.setSymbolEditable=function(e){this.jmpScene?this.jmpScene.setEditable(e):console.warn("symbol scene does not exist!")},CgsMap.prototype.getSymbolEditable=function(){if(this.jmpScene)return!!this.jmpScene.getEditable();console.warn("symbol scene does not exist!")},CgsMap.prototype.setAgainstTerrain=function(e){this.map3D.scene.globe.depthTestAgainstTerrain=e},CgsMap.prototype.getAgainstTerrain=function(){return this.map3D.scene.globe.depthTestAgainstTerrain},CgsMap.prototype.getManipulate=function(){return this.manipulate},CgsMap.prototype.getMVManipulate=function(e){return this.MVManipulates[e-1]||(this.MVManipulates[e-1]=new CgsManipulate3D(this.map3D,e)),this.MVManipulates[e-1]},CgsMap.prototype.setShadowVisible=function(e){this.map3D.shadows=e},CgsMap.prototype.getShadowVisible=function(){return this.map3D.shadows},CgsMap.prototype.setRightDownIconVisible=function(e){this.map3D.isIconVisible=e},CgsMap.prototype.setZoomIconVisible=function(e){this.map3D.scene.screenSpaceCameraController._isZoomIconVisible=e},CgsMap.prototype.setMultiplier=function(e){this.map3D.setMultiplier(e)},CgsMap.prototype.getMultiplier=function(){return this.map3D.getMultiplier()},CgsMap.prototype.setCurrentTime=function(e){this.map3D.setCurrentTime(e)},CgsMap.prototype.getCurrentTime=function(){return this.map3D.getCurrentTime()},CgsMap.prototype.leftAndRightViews=function(){"3D"==this.mode&&(this.map3D.leftAndRightViews(),this.adaptingMultiViews())},CgsMap.prototype.upAndDownViews=function(){"3D"==this.mode&&(this.map3D.upAndDownViews(),this.adaptingMultiViews())},CgsMap.prototype.fourViews=function(){"3D"==this.mode&&this.map3D.fourViews()},CgsMap.prototype.openMultiViews=function(e){"top-bottom"==e?this.upAndDownViews():"left-right"==e?this.leftAndRightViews():"four-screen"==e&&this.fourViews()},CgsMap.prototype.disableMultiViews=function(){"3D"==this.mode&&this.map3D.disableMultiViews();for(var e=0;e<this.map3D.overlays.length;++e){var t=this.map3D.overlays[e];if(!t.parentOverlay){for(var i=0;i<t.clones.length;++i){var s=t.clones[i];this.map3D.removeFeature(s)}t.clones=[]}}for(var o=0;o<this.overlays.length;++o){var a=this.overlays[o];a.cloneOverlay3D&&this.map3D.removeFeature(a.cloneOverlay3D),a.cloneOverlay3D=void 0,a.overlay3D.clones=[]}for(var n=this.effectManager.effectObjects.length,r=0;r<n;++r){var l=this.effectManager.effectObjects[r];if(l)for(o=0;o<l.clones.length;++o){var u=l.clones[o];u&&this.removeFeature(u)}}},CgsMap.prototype.createPiP=function(e){"3D"==this.mode&&this.map3D.createPiP(e)},CgsMap.prototype.deletePiP=function(){"3D"==this.mode&&(this.map3D.isMultiViewsMode&&this.MVManipulates[0]&&(this.MVManipulates[0].setLocateFlag(!1),this.MVManipulates[0].setManipulateType(1),this.MVManipulates[0]=void 0),this.map3D.deletePiP())},CgsMap.prototype.adaptingMultiViews=function(){for(var e=0;e<this.map3D.overlays.length;++e){var t,i,s,o=this.map3D.overlays[e];o.parentOverlay||o.parent||(t=o.options,i=o.dom,t.element=$$(i).clone()[0],((s=new CgsOverlay3D(t)).parent=o).clones.push(s),s.setPosition(o.getPosition()),this.map3D.addFeature(s),s.setVisible(o.getVisible()))}for(var a=0;a<this.overlays.length;++a){var n=this.overlays[a];n.cloneOverlay3D=CgsOverlay.clone(n),n.cloneOverlay3D&&(this.map3D.addFeature(n.cloneOverlay3D),n.cloneOverlay3D.setVisible(n.getVisible()))}for(var r=this.effectManager.effectObjects.length,l=0;l<r;++l){var u=this.effectManager.effectObjects[l],p=new CgsCircleAnimation({position:u.position,radius:u.radius,fillColor:u.fillColor,duration:u.duration});p.parent=u,p.map=this,u.clones.push(p),this.addOverlay(p.overlay),p.overlay.overlay3D.parent=u.overlay.overlay3D,this.effectManager.effectObjects.push(p)}},CgsMap.prototype.setTranslucentMode=function(e,t){"3D"==this.mode&&(e?(this.preBaseColor=this.map3D.scene.globe.baseColor,this.map3D.scene.globe.translucentMode=e,this.setSkyAtmosphereVisible(!e),map.map3D.scene.globe.baseColor=t?new Cesium.Color.fromCssColorString(t):new Cesium.Color(0,0,0,0)):(this.map3D.scene.globe.translucentMode=e,this.setSkyAtmosphereVisible(!e),this.preBaseColor&&(map.map3D.scene.globe.baseColor=this.preBaseColor)))},CgsMap.prototype.getTranslucentMode=function(){return this.map3D.scene.globe.translucentMode},CgsMap.prototype.getCameraInfo=function(){var e,t,i,s={position:{lan:0,lot:0,height:0},rotation:{heading:0,pitch:0,roll:0}};return"3D"==this.mode&&(e=this.map3D.camera,t=Cesium.Math.toDegrees,i=Cesium.Cartographic.fromCartesian(e.position),s.position={lon:t(i.longitude),lat:t(i.latitude),height:i.height},s.rotation={heading:t(e.heading),pitch:t(e.pitch),roll:t(e.roll)}),s},CgsMap.prototype.getOverlayByUid=function(e){for(var t=0;t<this.overlays.length;t++)if(this.overlays[t].uid==e)return this.overlays[t]},CgsMap.prototype.setCameraInfo=function(e){var t=this.getCameraInfo();t.duration=1.5;var i=_.merge(t,e);"3D"==this.mode&&this.map3D.camera.flyTo({duration:i.duration,destination:Cesium.Cartesian3.fromDegrees(i.position.lon,i.position.lat,i.position.height),orientation:{heading:Cesium.Math.toRadians(i.rotation.heading),pitch:Cesium.Math.toRadians(i.rotation.pitch),roll:Cesium.Math.toRadians(i.rotation.roll)},complete:i.completeCallback}),e.position&&e.position.height&&this.featuresHandleObj&&this.featuresHandleObj.refresh(e.position.height)},CgsMap.prototype.setHitTolerance=function(e){this.hitTolerance=e,this.featureSelect.setHitTolerance(e),this.map3D&&this.map3D.setHitTolerance(e)},CgsMap.prototype.getHitTolerance=function(){return this.hitTolerance},CgsMap.prototype.infoBoxDbCreate=function(){var i=this,e={};return(this.InfoBoxDb=e).showState=!1,e.infoBox=null,e.createInfoBoxDivAndAddToMap=function(){var e=$$('                                                                                                                                                                                                                      <div class="cesium-infoBox" style="background-color: rgb(5, 48, 103);z-index: 999;">                                                                                      <div class="cesium-infoBox-title InfoBox__Title">默认信息</div>                                                                                                        <button type="button" class="cesium-infoBox-close InfoBox__CloseBtn">×</button>                                                                                                                           <div class="InfoBox__Content">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </div>                                                                                                                                                                                                                                  </div>                                                                                                                                                                                                                                      ');$$(i.map3D.container).find(".cesium-viewer").append(e);var t={dom:e,content:$$($$(e).find(".InfoBox__Content")[0]),title:$$($$(e).find(".InfoBox__Title")[0]),closeBtn:$$($$(e).find(".InfoBox__CloseBtn")[0])};return t.closeBtn.click(function(){i.hideInfoBox()}),t},e},CgsSubPub.subscribe(CgsEvent.eMapInstanceCreated,function(e,t){!_.get(t,"InfoBoxDb.infoBox")&&t.map3D&&(t.infoBoxDbCreate(),t.InfoBoxDb.infoBox=t.InfoBoxDb.createInfoBoxDivAndAddToMap())}),CgsMap.prototype.showInfoBox=function(e){var t=this,i={title:"默认标题",content:"默认内容",timeOut:2e3,timer:null,onHideFn:function(){}};_.assign(i,e);var s,o=this.InfoBoxDb;o&&(o.showState=!0,(s=o.infoBox).showOpts=i,s.title.html(i.title),s.content.html(i.content),s.dom.addClass("cesium-infoBox-visible"),0!==i.timeOut&&(i.timer=setTimeout(function(){t.hideInfoBox()},i.timeOut)))},CgsMap.prototype.hideInfoBox=function(){var e,t=this.InfoBoxDb;t&&(!t.showState||(e=t.infoBox).showOpts&&(e.showOpts.timer&&window.clearTimeout(e.showOpts.timer),e.showOpts.onHideFn(),e.dom.removeClass("cesium-infoBox-visible"),t.showState=!1))},CgsMap.prototype.changeCoorToGeo=function(e){return ol.proj.transform(e,"EPSG:4326",this.projection)},CgsMap.prototype.changeGeoToCoor=function(e){return ol.proj.transform(e,this.projection,"EPSG:4326")},CgsMap.prototype.setDblClickZoom2D=function(e){this.dblClickZoom2D=e},CgsMap.prototype.getRotation2D=function(){if(this.map2D){var e=180*this.map2D.view.getRotation()/Math.PI;return Number(e.toFixed(2))}},CgsMap.prototype.getAzimuthByCoor=function(e,t){var i=ol.proj.transform(e,"EPSG:4326",this.projection),s=ol.proj.transform(t,"EPSG:4326",this.projection),o=s[0]-i[0],a=s[1]-i[1],n=180*Math.atan(o/a)/Math.PI;return a<0?n+=180:0<=a&&o<0&&(n+=360),n},CgsMap.prototype.screenShot=function(o){var e,a=document.getElementsByClassName("cesium-infoBox");0<a.length&&(a[0].style.display="none"),(o=o||{}).flag=0!=o.flag||o.flag,o.name||(e=new Date,o.name="screenShot"+e.getFullYear()+(e.getMonth()+1)+e.getDate()+e.getHours()+e.getMinutes()+e.getSeconds()),document.getElementById("navigationDiv")&&(document.getElementById("navigationDiv").style.visibility="hidden");var t,i,s,n,r,l,u=void 0,u="2D"==this.mode?document.getElementById(this.div2DContainerId):document.getElementById("CgsMapContainer3D"),p={useCORS:!0,scrollX:o.scrollX||0,scrollY:o.scrollY||0,scale:o.scale||1};o.extent&&(t=this.lonLatToPixel([o.extent[0],o.extent[1]]),i=this.lonLatToPixel([o.extent[2],o.extent[3]]),s=t[0],n=i[1],r=i[0]-t[0],l=t[1]-i[1],p.x=s,p.y=n,p.width=r,p.height=l),o.scale&&(p.scale=o.scale),html2canvas(u,p).then(function(e){var t,i=e.toDataURL("image/jpeg");o.flag&&((t=document.createElement("img")).style.position="absolute",t.style.pointerEvents=null,t.style.top="0px",t.style.width="100%",t.style.height="100%",u.appendChild(t),t.style.transformOrigin="left bottom 0px",t.style.transition="all 0.1s ease-out",setTimeout(function(){t.style.backgroundColor="rgba(255,255,255,0.4)"},0),setTimeout(function(){t.src=i,t.style.transition="all 1s ease-out",t.style.transform="scale(0.1)"},200),setTimeout(function(){u.removeChild(t),0<a.length&&(a[0].style.display="block")},2e3));var s=document.createElement("a");s.download=o.name,s.href=i,s.click(),document.getElementById("navigationDiv")&&(document.getElementById("navigationDiv").style.visibility="visible")})},CgsMap.prototype.screenShotToBase64=function(e){var i=document.getElementsByClassName("cesium-infoBox");0<i.length&&(i[0].style.display="none"),document.getElementById("navigationDiv")&&(document.getElementById("navigationDiv").style.visibility="hidden");var t,s,o,a,n,r,l=void 0,l="2D"==this.mode?document.getElementById(this.div2DContainerId):document.getElementById("CgsMapContainer3D"),u={useCORS:!0,scrollX:e.scrollX||0,scrollY:e.scrollY||0,scale:e.scale||1};return e.extent&&(t=this.lonLatToPixel([e.extent[0],e.extent[1]]),s=this.lonLatToPixel([e.extent[2],e.extent[3]]),o=t[0],a=s[1],n=s[0]-t[0],r=t[1]-s[1],u.x=o,u.y=a,u.width=n,u.height=r),html2canvas(l,u).then(function(e){var t=e.toDataURL("image/jpeg");return 0<i.length&&(i[0].style.display="block"),document.getElementById("navigationDiv")&&(document.getElementById("navigationDiv").style.visibility="visible"),t})},CgsMap.prototype.addBDVLayer=function(e){for(var t=!1,i=0;i<this.bigDataVLayers.length;i++)this.bigDataVLayers[i]==e&&(t=!0,console.info("the layer has been added to map"));if(!t){if(!(e instanceof CgsBigDataV))return;(e.viewer=this).bigDataVLayers.push(e),e.layer3D||e.create3D(),e.layer2D}},CgsMap.prototype.removeBDVLayer=function(e){e instanceof CgsBigDataV&&(e.viewer=void 0,this.bigDataVLayers.splice(this.bigDataVLayers.indexOf(e),1),e.destroy())},CgsMap.prototype.removeAllBDVLayers=function(){for(var e=this.getBDVLayers(),t=e.length-1;-1<t;t--)this.removeBDVLayer(e[t])},CgsMap.prototype.getBDVLayers=function(){return this.bigDataVLayers},CgsMap.checkEquipment=function(){this.testCanvas||(this.testCanvas=document.createElement("canvas"));var e,t={};return t.alpha=CgsUtil.defaultValue(t.alpha,!1),t.stencil=CgsUtil.defaultValue(t.stencil,!0),e=this.testCanvas.getContext("webgl",t)||this.testCanvas.getContext("experimental-webgl",t)||void 0,!!Cesium.defined(e)||(console.info("当前浏览器不支持webgl,请重新刷或更换高版本浏览器！！"),!1)},CgsMap.prototype.setBackgroundColor=function(e){e&&this.map3D.setBackgroundColor(e)},CgsMap.prototype.getBackgroundColor=function(){return this.map3D.getBackgroundColor()},CgsMap.prototype.disposeSubPub=function(){var t,i,s=["mapinstancecreated","esymbolinitfinised"];CgsSubPub&&(t={},Object.keys(CgsSubPub._callbacks).map(function(e){s.includes(e)&&(t[e]=CgsSubPub._callbacks[e])}),i={},Object.keys(CgsSubPub.idMap).map(function(e){s.includes(CgsSubPub.idMap[e])&&(i[e]=CgsSubPub.idMap[e])}),CgsSubPub.idMap=i,CgsSubPub._callbacks=t)},CgsMap.prototype.getMeterPerPixel=function(){var e=this.map3D.scene,t=e.canvas.clientWidth,i=e.canvas.clientHeight,s=e.camera.getPickRay(new Cesium.Cartesian2(t/2|0,(i-1)/2)),o=e.camera.getPickRay(new Cesium.Cartesian2(1+t/2|0,(i-1)/2)),a=e.globe.pick(s,e),n=e.globe.pick(o,e);return null==a||null==n?0:Cesium.Cartesian3.distance(a,n)},CgsMap.prototype.lockZoom=function(){this.map3D.lockZoom(),this.map2D.lockZoom()},CgsMap.prototype.unlockZoom=function(){this.map3D.unlockZoom(),this.map2D.unlockZoom()},CgsMap.prototype.zoomToScale=function(e){var t,i,s,o;e&&(t=this.getCenter(),"2D"==this.mode?(i="EPSG:4326"==this.projection?e/CGS_INCHES_PER_METER/CGS_DOTS_PER_INCH/CGS_METERS_PER_DEGREE:e/CGS_INCHES_PER_METER/CGS_DOTS_PER_INCH,s=ol.proj.transform(t,"EPSG:4326","EPSG:3857"),i*=ol.math.cosh(s[1]/CgsUtil.EPSG3857_RADIUS),this.map2D.view.setResolution(i),this.map2D.setCenter(t)):(o=.38265245*e,this.map3D&&(this.map3D.setHeight(o),this.map3D.setCenter(t),this.map3D.scene.mode=Cesium.SceneMode.SCENE3D)))},CgsMap.prototype.scaleToHeight=function(e){return e*CGS_HEIGHT_TO_SCALE},CgsMap.prototype.heightToScale=function(e){return e/CGS_HEIGHT_TO_SCALE},CgsMap.prototype.addOverviewMap=function(e){e&&e.control_&&this.map2D.addControl(e.control_)},CgsMap.prototype.removeOverviewMap=function(e){e&&e.control_&&(this.map2D.addControl(e.control_),e.destroy())},CgsMap.prototype.setDeleteSymbolByKB=function(e){return this.deleteSymbolByKD=e},CgsMap.prototype.getDeleteSymbolByKB=function(){return this.deleteSymbolByKD},CgsMap.prototype.setDebuggerFramesPerSecondVisible=function(e){this.map3D&&(this.map3D.scene.debugShowFramesPerSecond=e)},CgsMap.versionProperty={version:"2.3",companyName:"中电28所共性产品中心显示室",description:""},CgsMapNote=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){var i,s=this,e=t.map,o=$$;t.document?(i=t.document,s.document=t.document,e.currentIframeDocument=t.document):(s.document=window.document,i=window.document),e.allMapNotes||(e.allMapNotes=[]),e.allMapNotes.push(this),s.map=e,s.imgFlag=t.imgFlag,s.imgNum=t.imgNum||3,s.noteLineColor=t.noteLineColor||"rgba(6,17,39,0.6)",s.noteOutLineColor=t.noteOutLineColor||"rgba(6,17,39,0.6)",s.noteTextColor=t.noteTextColor||"rgba(6,16,56,0.5)",s.font=t.font||"100 12px MicrosoftYaHei",s.fontColor=t.fontColor||"rgba(152,186,229,1)",s.minHeight=null,s.saveButtonFlag=t.saveButton,s.textClickFlag=!1,0==s.imgNum&&(s.imgFlag=!1),s.imgFlag||(s.imgNum=0);var a=t.position,n=$$('\n\t\t<div style="width:100px,height:100px;backgroundColor:white;pointer-events:none">\n\t\t\t<canvas width="100px" height="100px"></canvas>\n\t\t</div>    \n        ').get(0);s.lineOverlay=new CgsOverlay({position:a,positioning:"bottom-right",element:n,draggable:!1,showLine:!1,offset:[0,0]}),e.addOverlay(s.lineOverlay),s.lineOverlay.mapNote=s,$$(n).parent().css("pointer-events","none");var r=CgsUtil.generateRandomNumber(10);$$(n.children[0]).attr("id",r),s.lineOverlay.flag=!0,s.lineOverlay.canvasId=r;n=i.createElement("div");(s.div=n).className="draggable-popup",s.divId=CgsUtil.generateRandomNumber(15),$$(n).attr("id",s.divId),$$(n).css("background-color",s.noteOutLineColor);var l=i.createElement("div");$$(n).append(l);var l=$$("\n\t<div>\t\n\t\t</div>\n        ").get(0),u=$$('\n\t<div class="popopu-leftBox">\t\n\t\t</div>\n        ').get(0),p=CgsUtil.generateRandomNumber(15);s.leftContentId=p,$$(u).attr("id",p);var h=$$('\n\t\t<textarea class="popopu-textarea" onchange="this.value=this.value.substring(0,5000)" onkeyup="this.value=this.value.substring(0,5000)"  onkeydown="this.value=this.value.substring(0,5000)" style="margin-left: 4px;margin-top: 4px;width:240px;height:95px;border:0px;" cols="2" rows="20"/>\n        ').get(0);$$(l).css("border","0px"),$$(n).append(l),$$(l).append(u),t.text&&$$(h).val(t.text),t.textWidth&&$$(h).css("width",t.textWidth),t.textHeight&&$$(h).css("height",t.textHeight),$$(l).append(h),$$(h).css("background-color",s.noteTextColor),$$(h).css("font",s.font),$$(h).css("color",s.fontColor),t.imgSrc&&0<t.imgSrc.length&&(s.imgNum=t.imgSrc.length);var c=[];s.imgArr=c,s.imgIdArr=[];for(var g=1,d=0;d<5;d++){var m=o('\n\t\t\t\t<img class="popopu-image" style="display:none;float:left;"/>\n\t\t\t\t').get(0),f=o('\n\t\t\t\t<img class="popopu-image"  style="display:block;float:left;"></img>\n\t\t\t\t').get(0),C=o('\n\t\t\t\t<input class="popopu-image" style="left:11px;border: 0px solid black;opacity:0;position:absolute;" type="file" name="file" accept=".png,.jpg" onchange="CgsMapNote.imgPreview(this,map)"/> \n\t\t\t\t').get(0),y=o('\n\t\t\t\t<div class="popopu-leftBox-delImg" style="border: 0px solid black;position:absolute;display:none;"></div> \n\t\t\t\t').get(0);$$(u).append(m),$$(u).append(f),$$(u).append(C),$$(u).append(y);var v=i.createElement("a");(s.imgCloser=v).className="cesium-feature-popup-add",v.href="javascript:;",$$(f).append(v);var b=CgsUtil.generateRandomNumber(15),D=b+1,S=b+3,_=b+4;$$(u.children[4*d+0]).attr("id",b),$$(u.children[4*d+1]).attr("id",S),$$(u.children[4*d+2]).attr("id",D),$$(u.children[4*d+3]).attr("id",_),0==d?($$(u.children[4*d+2]).css("top","11px"),$$(u.children[4*d+3]).css("top","82px")):($$(u.children[4*d+2]).css("top",11+80*d+"px"),$$(u.children[4*d+3]).css("top",80*(d+1)-20+21+"px")),s.imgIdArr.push(b),$$(u.children[4*d+1]).attr("src",CGS_SDK_PATH+"assets/image/dc.png"),d>=s.imgNum?(c.push(b),$$(u.children[4*d+0]).css("display","none"),$$(u.children[4*d+1]).css("display","none"),$$(u.children[4*d+2]).css("display","none")):($$(h).css("height",79*g+"px"),$$(h).css("min-height",79*g+"px"),g++)}s.imgFlag||t.textWidth||$$(h).css("width","175px");var w=o('\n\t\t<div style="height:4px;width:76px;float:left"></div> \n\t\t').get(0);$$(u).append(w);var P,T,M=CgsUtil.generateRandomNumber(15);s.textareaId=M,$$(l.children[1]).attr("id",M),s.saveButtonFlag&&(P=i.createElement("a"),(s.saveButton=P).className="cesium-feature-popup-save",P.href="javascript:;",T=CgsUtil.generateRandomNumber(15),s.saveButtonId=T,$$(P).attr("id",T),$$(P).attr("title","保存按钮"),$$(n).append(P));var L=i.createElement("a");(s.closer=L).className="cesium-feature-popup-closer",L.href="javascript:;",$$(n).append(L);var x=CgsUtil.generateRandomNumber(15);s.closerId=x,$$(L).attr("id",x),$$(L).attr("title","关闭");var E=i.createElement("a");(s.smaller=E).className="cesium-feature-popup-smaller",E.href="javascript:;",$$(n).append(E);var A=CgsUtil.generateRandomNumber(15);s.smallerId=A,$$(E).attr("id",A),$$(E).attr("title","缩小"),s.noteOverlay=new CgsOverlay({position:a,positioning:"top-left",element:n,draggable:!0,showLine:!1,offset:[-33,-95]}),e.addOverlay(s.noteOverlay),s.noteOverlay.lineOverlay=s.lineOverlay,s.noteOverlay.noteLineColor=s.noteLineColor,CgsMapNote.move([-33,-95],2,s.noteOverlay,s.lineOverlay,s.noteLineColor);var I=i.createElement("a");(s.adder=I).className="cesium-feature-popup-adder",I.href="javascript:;",$$(n).append(I);var F=CgsUtil.generateRandomNumber(15);s.adderId=F,$$(I).attr("id",F),$$(I).attr("title","添加图片");n=o('\n\t\t<div class="cesium-feature-popup-star">\n\t\t</div>    \n        ').get(0);s.smallOverlay=new CgsOverlay({position:a,positioning:"top-left",element:n,draggable:!1,showLine:!1,offset:[0,0]}),e.addOverlay(s.smallOverlay);var k=CgsUtil.generateRandomNumber(10);return s.smallId=k,$$(n).attr("id",k),s.smallOverlay.setVisible(!1),setTimeout(function(){if(s.imgNum,t.imgSrc&&0<t.imgSrc.length)for(var e=0;e<t.imgSrc.length;e++)$$(i.getElementById(s.imgIdArr[e])).css("display","block"),$$(i.getElementById(s.imgIdArr[e])).attr("src",t.imgSrc[e]),$$(i.getElementById(s.imgIdArr[e]+3)).css("display","none"),$$(i.getElementById(s.imgIdArr[e]+1)).css("display","none"),$$(i.getElementById(s.imgIdArr[e]+4)).css("display","none");s.imgFlag||$$(i.getElementById(p)).css("display","none"),t.offset&&s.setMapNotePixOffset(t.offset)},10),this.setDomEvent(),this}),CgsMapNote.prototype.setDomEvent=function(){var l=this;$$(document.getElementById(l.textareaId+"")).bind("input propertychange",".notifyDetail",function(){l.map.map3D.isMultiViewsMode&&l.updateOverlay3dom()}),$$(l.imgCloser).on("click",function(){l.map.removeOverlay(l.noteOverlay),l.map.removeOverlay(l.lineOverlay),l.updateOverlay3dom()}),$$(l.saveButton).on("click",function(){var e,t,i,s,o,a,n,r;CgsSubPub.publish("mapnotesave",[l,l.divId]),options.callBack&&(e=document.getElementById(l.textareaId).style.font,t=document.getElementById(l.textareaId).style.color,document.getElementById(l.textareaId).style.fontSize,i=document.getElementById(l.textareaId).style.backgroundColor,s=document.getElementById(l.divId).style.backgroundColor,o=l.noteOverlay.noteLineColor,a=document.getElementById(l.textareaId).style.width,n=document.getElementById(l.textareaId).style.height,r={position:l.noteOverlay.getPosition(),noteLineColor:o,noteOutLineColor:s,noteTextColor:i,font:e,fontColor:t,text:$$(document.getElementById(l.textareaId)).val(),imgSrc:l.getImgsSrc(),textWidth:a,textHeight:n,offset:l.noteOverlay.getPixelOffset()},options.callBack(r)),l.updateOverlay3dom()}),$$(l.closer).on("click",function(){l.map.removeOverlay(l.noteOverlay),l.map.removeOverlay(l.lineOverlay),l.map.removeOverlay(l.smallOverlay),l.map.allMapNotes.splice(l.map.allMapNotes.indexOf(l),1)}),$$(l.smaller).on("click",function(){l.minHeight=l.div.style.minHeight,$$(l.div).css("min-height","0px"),l.noteOverlay.setVisible(!1),l.lineOverlay.setVisible(!1),l.smallOverlay.setVisible(!0),l.noteOverlay.cloneOverlay3D&&(l.noteOverlay.cloneOverlay3D.setVisible(!1),l.lineOverlay.cloneOverlay3D.setVisible(!1),l.smallOverlay.cloneOverlay3D.setVisible(!0)),l.updateOverlay3dom()}),$$(l.adder).on("click",function(){if(0!=l.imgArr.length){$$(document.getElementById(l.leftContentId)).css("display","block"),$$(document.getElementById(l.imgArr[0]+1)).css("display","block"),$$(document.getElementById(l.imgArr[0]+3)).css("display","block");var e=l.imgArr.splice(0,1)[0];$$(document.getElementById(l.textareaId)).css("height",79*(5-l.imgArr.length)-6+"px"),$$(document.getElementById(l.textareaId)).css("min-height",79*(5-l.imgArr.length)-6+"px"),CgsMapNote.reBuild(l.imgIdArr,l.imgArr,map);for(var t=[],i=0;i<l.imgIdArr.length;i++)-1==l.imgArr.indexOf(l.imgIdArr[i])&&t.push(l.imgIdArr[i]);if(1!=t.length){for(var s=t.indexOf(e),o=t.length-s+1-1,i=0;i<o&&(!$$(document.getElementById(t[s+1]))[0]||""!=$$(document.getElementById(t[s+1]))[0].src)&&(!$$(document.getElementById(t[s+1]))[0]||$$(document.getElementById(t[s+1]))[0].src)&&(!$$(document.getElementById(t[s+1]))[0]||-1==$$(document.getElementById(t[s+1]))[0].src.indexOf("http"))&&!(t.length<=s+1);i++){var a=$$(document.getElementById(t[s+1]))[0].src;$$(document.getElementById(t[s])).attr("src",a),$$(document.getElementById(t[s+1])).attr("src",""),$$(document.getElementById(parseInt(t[s])+"")).css("display","block"),$$(document.getElementById(parseInt(t[s])+1+"")).attr("type","text"),$$(document.getElementById(parseInt(t[s])+1+"")).css("display","none"),$$(document.getElementById(parseInt(t[s])+3+"")).css("display","none"),$$(document.getElementById(parseInt(t[s])+1+"")).attr("type","file"),$$(document.getElementById(parseInt(t[s+1])+"")).css("display","none"),$$(document.getElementById(parseInt(t[s+1]+1)+"")).css("display","block"),$$(document.getElementById(parseInt(t[s+1]+3)+"")).css("display","block"),s++}setTimeout(function(){l.updateOverlay3dom()},300)}}});for(var e=0;e<5;e++){document.getElementById(l.imgIdArr[e]).userId=e,$$(document.getElementById(l.imgIdArr[e])).on("click",function(e){for(var t=e.currentTarget.parentElement.children,i=0;i<t.length&&t[i].id!=e.currentTarget.id;i++);var s,o=$('\n\t\t\t\t\t<div style="\n\t\t\t\t\t\twidth: 1590px;\n\t\t\t\t\t\theight: 930px;\n\t\t\t\t\t\tfloat: left;\n\t\t\t\t\t\tmargin-left: 270px;\n\t\t\t\t\t\tmargin-top: -970px;\n\t\t\t\t\t\tz-index: 9999;\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\tborder: solid 50px;\n\t\t\t\t\t\tborder-color: rgba(0,0,0,0.5);\n\t\t\t\t\t\tborder-radius: 10px;">\n\t\t\t\t\t<img style="width:100%;height:100%"> </img>\n\t\t\t\t\t</div>\n\t\t\t\t\t').get(0),a=$$(document.getElementsByClassName("cesium-widget")[0]);s=0==i?0:i/4,$$(a).css("right","-30px"),$$(o.children[0]).attr("src",document.getElementById(l.imgIdArr[s]).src),$$(a).append(o);var n=document.createElement("a");n.className="cesium-feature-popup-bigimgcloser",n.href="javascript:;",$$(o).append(n),$$(n).on("click",function(){$$(o).remove()});var r=CgsSubPub.subscribe(CgsEvent.eFeatureRightClickOut,function(e,t){l.textareaId&&$$(document.getElementById(l.textareaId)).blur(),$$(o).remove(),CgsSubPub.unsubscribe(r)});l.updateOverlay3dom()}),$$(document.getElementById(l.imgIdArr[e]+4)).on("click",function(e){var t=e.currentTarget.id-4;l.imgIdArr.length-l.imgArr.length!=0&&(l.imgIdArr.length-l.imgArr.length==1?($$(document.getElementById(l.leftContentId)).css("display","none"),$$(document.getElementById(l.textareaId)).css("width","170px"),$$(document.getElementById(t)).css("display","none"),$$(document.getElementById(t)).attr("src",""),$$(document.getElementById(1+t)).css("display","none"),$$(document.getElementById(3+t)).css("display","none"),$$(document.getElementById(4+t)).css("display","none"),l.imgArr.unshift(t)):($$(document.getElementById(t)).css("display","none"),$$(document.getElementById(t)).attr("src",""),$$(document.getElementById(1+t)).css("display","none"),$$(document.getElementById(3+t)).css("display","none"),$$(document.getElementById(4+t)).css("display","none"),l.imgArr.unshift(t),$$(document.getElementById(l.textareaId)).css("height",79*(5-l.imgArr.length)-6+"px"),$$(document.getElementById(l.textareaId)).css("min-height",79*(5-l.imgArr.length)-6+"px"),CgsMapNote.reBuild(l.imgIdArr,l.imgArr,map),l.moveChange(1)),l.imgArr.length,setTimeout(function(){l.updateOverlay3dom()},300))}),$$(document.getElementById(l.imgIdArr[e])).on("mouseover",function(e){var t=e.currentTarget.id;$$(document.getElementById(parseInt(t)+4)).css("display","block"),l.updateOverlay3dom()}),$$(document.getElementById(l.imgIdArr[e])).on("mouseout",function(e){var t=e.currentTarget.id;e.toElement&&parseInt(e.toElement.id)!=parseInt(e.target.id)+4&&$$(document.getElementById(parseInt(t)+4)).css("display","none"),l.updateOverlay3dom()}),$$(document.getElementById(l.imgIdArr[e]+4)).on("mouseout",function(e){var t=e.currentTarget.id;if(!e.toElement||parseInt(e.toElement.id)!=l.leftContentId&&parseInt(e.toElement.id)!=l.textareaId){if(e.target.id!=t+4)for(i=0;i<l.imgIdArr.length;i++)$$(document.getElementById(l.imgIdArr[i]+4)).css("display","none")}else for(var i=0;i<l.imgIdArr.length;i++)$$(document.getElementById(l.imgIdArr[i]+4)).css("display","none");l.updateOverlay3dom()}),$$(document.getElementById(l.imgIdArr[e]+1)).on("mouseover",function(e){var t=e.currentTarget.id;$$(document.getElementById(parseInt(t)+3)).css("display","block"),l.updateOverlay3dom()}),$$(document.getElementById(l.imgIdArr[e]+1)).on("mouseout",function(e){var t=e.currentTarget.id;e.toElement&&parseInt(e.toElement.id)!=parseInt(e.target.id)+3&&$$(document.getElementById(parseInt(t)+3)).css("display","none"),l.updateOverlay3dom()})}$$(document.getElementById(l.smallId+"")).on("click",function(){$$(l.div).css("min-height",l.minHeight),l.noteOverlay.setVisible(!0),l.lineOverlay.setVisible(!0),l.smallOverlay.setVisible(!1),l.noteOverlay.cloneOverlay3D&&(l.noteOverlay.cloneOverlay3D.setVisible(!0),l.lineOverlay.cloneOverlay3D.setVisible(!0),l.smallOverlay.cloneOverlay3D.setVisible(!1)),l.updateOverlay3dom()}),"Chrome"==l.map.browerType?($$(document.getElementById(l.textareaId+"")).on("mousedown",function(){l.noteOverlay.setDraggable(!1),l.textareaInputFlag=!0,l.updateOverlay3dom()}),$$($$($$(document.getElementById(l.textareaId)).parent()).parent()).on("mousedown",function(){l.map.currentMapNote&&l.map.currentMapNote!=l&&($$(document.getElementById(l.map.currentMapNote.divId)).css("border","0px"),$$(document.getElementById(l.map.currentMapNote.adderId)).css("display","none"),$$(document.getElementById(l.map.currentMapNote.smallerId)).css("display","none"),$$(document.getElementById(l.map.currentMapNote.closerId)).css("display","none"),l.map.currentMapNote.saveButton&&$$(document.getElementById(l.map.currentMapNote.saveButtonId)).css("display","none")),l.map.currentMapNote=l,$$(document.getElementById(l.divId)).css("border","2px solid #cccccc"),$$(document.getElementById(l.adderId)).css("display","block"),$$(document.getElementById(l.smallerId)).css("display","block"),$$(document.getElementById(l.closerId)).css("display","block"),l.map.currentMapNote.saveButton&&$$(document.getElementById(l.map.currentMapNote.saveButtonId)).css("display","block"),CgsSubPub.publish("mapNoteSelect",[l.divId,l.textareaId,l]),l.noteOverlay.getDraggable()||l.textareaInputFlag||l.noteOverlay.setDraggable(!0),l.textareaInputFlag?(document.getElementById(l.textareaId+"").blur(),document.getElementById(l.textareaId+"").focus()):$$(document.getElementById(l.textareaId)).blur(),l.textareaInputFlag=!1,l.updateOverlay3dom()})):($$(document.getElementById(l.textareaId+"")).on("mousedown",function(){l.textareaInputFlag=!0,document.getElementById(l.textareaId+"").blur(),document.getElementById(l.textareaId+"").focus(),l.noteOverlay.getDraggable()&&l.noteOverlay.setDraggable(!1)}),$$($$($$(document.getElementById(l.textareaId)).parent()).parent()).on("mousedown",function(){setTimeout(function(){l.map.mapNoteEditTool&&map.mapNoteEditTool.getVisible()&&l.map.currentMapNote&&l.map.currentMapNote!=l&&$$(document.getElementById(l.map.currentMapNote.divId)).css("border","0px"),(l.map.currentMapNote=l).map.mapNoteEditTool&&map.mapNoteEditTool.getVisible()&&$$(document.getElementById(l.divId)).css("border","2px solid #cccccc"),CgsSubPub.publish("mapNoteSelect",[l.divId,l.textareaId,l]),l.noteOverlay.getDraggable()||l.textareaInputFlag||l.noteOverlay.setDraggable(!0),l.textareaInputFlag&&(document.getElementById(l.textareaId+"").blur(),document.getElementById(l.textareaId+"").focus()),l.textareaInputFlag=!1},100),l.updateOverlay3dom()})),l.updateOverlay3dom()},CgsMapNote.move=function(e,t,i,s,o,a){var n,r;i&&i.getMap().currentIframeDocument?i.getMap().currentIframeDocument:window.document,r=i.overlay3D?(n=i.overlay3D.dom.offsetHeight,i.overlay3D.dom.offsetWidth):(n=i.overlay2D.element.offsetHeight,i.overlay2D.element.offsetWidth);var l=this.getDomById("canvas",s.canvasId),u=l[0],p=l[1];u&&(CgsMapNote.moveCanvas(u,e,r,n,o,a,t,s,i),p&&CgsMapNote.moveCanvas(p,e,r,n,o,a,t,s,i))},CgsMapNote.moveCanvas=function(e,t,i,s,o,a,n,r,l){var u,p=e.getContext("2d"),h=Math.abs(t[0]),c=Math.abs(t[1]);a=a||0,1==n?("bottom-right"!=r.getPositioning()&&r.setPositioning("bottom-right"),CgsMapNote.setContextAttr(e,[0,0],[20,0],[h-20,c-s],h-20,c-s-2,a,1)):2==n?("bottom-left"!=r.getPositioning()&&r.setPositioning("bottom-left"),CgsMapNote.setContextAttr(e,[t[0]+20,0],[t[0]+40,0],[0,c-s],h+40,c-s,a,2)):3==n?("top-left"!=r.getPositioning()&&r.setPositioning("top-left"),CgsMapNote.setContextAttr(e,[t[0]+20,c+2],[t[0]+40,c+2],[0,0],h+40,c+2,a,3)):4==n?("top-right"!=r.getPositioning()&&r.setPositioning("top-right"),CgsMapNote.setContextAttr(e,[0,c+2],[20,c+2],[h-20,0],h-20,c+2,a,4)):1.5==n?("bottom-center"!=r.getPositioning()&&r.setPositioning("bottom-center"),CgsMapNote.setContextAttr(e,[60-h,0],[40-h,0],[20,c-s],40,c-s,a,1.5)):2.5==n?("center-left"!=r.getPositioning()&&r.setPositioning("center-left"),u=t[1]+s,t[1]+s<0&&(u=0),20<t[1]+s&&(u=20),CgsMapNote.setContextAttr(e,[h+2,u+2],[h+2,u+15],[0,20],h,40,a,2.5)):3.5==n?("top-center"!=r.getPositioning()&&r.setPositioning("top-center"),CgsMapNote.setContextAttr(e,[60-h,c],[40-h,c],[20,0],40,c,a,3.5)):4.5==n?("center-right"!=r.getPositioning()&&r.setPositioning("center-right"),u=t[1]+s,t[1]+s<0&&(u=0),20<t[1]+s&&(u=20),CgsMapNote.setContextAttr(e,[0,u+2],[0,u+15],[h-i,20],h-i,40,a,4.5)):1.2==n?("bottom-right"!=r.getPositioning()&&r.setPositioning("bottom-right"),CgsMapNote.setContextAttr(e,[0,0],[20,0],[h-i+40,c-s],h-i+40,c-s-3)):1.3==n?("bottom-left"!=r.getPositioning()&&r.setPositioning("bottom-left"),CgsMapNote.setContextAttr(e,[0,c-s],[i-h-40,0],[i-h-20,0],i-h-20,c-s-3)):1.51==n?("bottom-center"!=r.getPositioning()&&r.setPositioning("bottom-center"),CgsMapNote.setContextAttr(e,[20,c-s],[i-20-h,0],[i-h,0],40,c-s-3)):4.2==n?("top-right"!=r.getPositioning()&&r.setPositioning("top-right"),CgsMapNote.setContextAttr(e,[h-i+40,0],[0,c+2],[20,c+2],h-i+39,c+2)):4.3==n?("top-left"!=r.getPositioning()&&r.setPositioning("top-left"),CgsMapNote.setContextAttr(e,[0,0],[i-h-40,c],[i-h-20,c],i-h-20,c)):4.51==n&&("top-center"!=r.getPositioning()&&r.setPositioning("top-center"),CgsMapNote.setContextAttr(e,[20,0],[i-20-h,c],[i-h,c],40,c)),p.fillStyle=o,p.fill(),p.lineWidth=1,p.strokeStyle="rgb(255,0,0,0)",p.stroke()},CgsMapNote.setContextAttr=function(e,t,i,s,o,a,n,r){r<2.1||(n=0),e.width=o,e.height=a+50*n;var l=e.getContext("2d");l.moveTo(t[0],t[1]),l.lineTo(i[0],i[1]),l.lineTo(s[0],s[1]+50*n)},CgsMapNote.imgPreview=function(t,i){var s,e,o;s=i&&i.currentIframeDocument?i.currentIframeDocument:window.document,window.FileReader?(e=new FileReader,o=t.files[0],/^image\//.test(o.type)?(e.onload=function(e){$$(s.getElementById(t.id-1+"")).css("display","block"),s.getElementById(t.id-1+"").src=e.target.result,$$(s.getElementById(t.id+"")).attr("type","text"),$$(s.getElementById(t.id+"")).css("display","none"),$$(s.getElementById(parseInt(t.id)+2+"")).css("display","none"),$$(s.getElementById(t.id+"")).attr("type","file"),i.syncDom()},e.readAsDataURL(o)):console.log("选择图片")):console.log("不支持")},CgsMapNote.reBuild=function(e,t,i){var s;(s=i&&i.currentIframeDocument?i.currentIframeDocument:window.document)||retuen;for(var o=[],a=0;a<e.length;a++)-1==t.indexOf(e[a])&&o.push(e[a]);for(a=0;a<o.length;a++)0==a?($$(s.getElementById(o[a]+1+"")).css("top","25px"),$$(s.getElementById(o[a]+4+"")).css("top","66px")):($$(s.getElementById(o[a]+1+"")).css("top",25+76*a+"px"),$$(s.getElementById(o[a]+4+"")).css("top",80*(a+1)-20+5+"px"))},CgsMapNote.prototype.getLineType=function(e){var t,i,s,e=e;return i=this.noteOverlay.overlay3D?(t=this.noteOverlay.overlay3D.dom.offsetHeight,this.noteOverlay.overlay3D.dom.offsetWidth):(t=this.noteOverlay.overlay2D.element.offsetHeight,this.noteOverlay.overlay2D.element.offsetWidth),e[0]<0&&0<e[1]+t&&e[1]<0?s=4.5:-20<e[0]&&0<e[1]?s=3:e[0]<-40&&0<e[1]?s=e[0]+i<40&&20<e[0]+i?4.51:e[0]<=-1*(i-40)?4.2:e[0]>=-1*i&&e[0]<i/2*-1?4.3:4:e[0]<-40&&e[1]<0?s=e[0]+i<40&&20<e[0]+i?1.51:e[0]<=-1*(i-40)?1.2:e[0]>=-1*i&&e[0]<i/2*-1?1.3:1:-20<e[0]&&e[1]<0&&e[1]+t<0?s=2:e[0]<-20&&-40<e[0]&&e[1]<0?s=1.5:0<e[0]&&0<e[1]+t&&e[1]<0?s=2.5:e[0]<=-20&&-40<=e[0]&&0<e[1]&&(s=3.5),s},CgsMapNote.prototype.moveChange=function(e){var t,i,s=this.noteOverlay.getPixelOffset();this.noteOverlay.overlay3D?(t=this.noteOverlay.overlay3D.dom.offsetHeight,this.noteOverlay.overlay3D.dom.offsetWidth):(t=this.noteOverlay.overlay2D.element.offsetHeight,this.noteOverlay.overlay2D.element.offsetWidth),s[0]<0&&0<s[1]+t&&s[1]<0?i=4.5:-20<s[0]&&0<s[1]?i=3:s[0]<-40&&0<s[1]?i=4:s[0]<-40&&s[1]<0?i=1:-20<s[0]&&s[1]<0&&s[1]+t<0?i=2:s[0]<-20&&-40<s[0]&&s[1]<0?i=1.5:0<s[0]&&0<s[1]+t&&s[1]<0?i=2.5:s[0]<=-20&&-40<=s[0]&&0<s[1]&&(i=3.5),CgsMapNote.move(s,i,this.noteOverlay,this.lineOverlay,this.noteLineColor,e)},CgsMapNote.prototype.setPosition=function(e){this.noteOverlay.setPosition(e),this.lineOverlay.setPosition(e),this.smallOverlay.setPosition(e)},CgsMapNote.prototype.dispose=function(){this.map.removeOverlay(this.noteOverlay),this.map.removeOverlay(this.lineOverlay),this.map.removeOverlay(this.smallOverlay),this.map.allMapNotes.splice(this.map.allMapNotes.indexOf(this),1),this.featureClickOutEvent&&CgsSubPub.unsubscribe(this.featureClickOutEvent)},CgsMapNote.prototype.getPosition=function(){return this.noteOverlay.getPosition()},CgsMapNote.prototype.getOverlay=function(){return this.noteOverlay},CgsMapNote.prototype.addNoteToMobileObj=function(e){e.addPartner(this.noteOverlay),e.addPartner(this.lineOverlay),e.addPartner(this.smallOverlay)},CgsMapNote.prototype.removeNoteFromMobileObj=function(e){e.removePartner(this.noteOverlay),e.removePartner(this.lineOverlay),e.removePartner(this.smallOverlay)},CgsMapNote.prototype.getImgsSrc=function(){for(var e=[],t=0;t<this.imgIdArr.length;t++){var i=this.document.getElementById(this.imgIdArr[t]).src;i&&e.push(i)}return e},CgsMapNote.prototype.getText=function(){return $$(this.document.getElementById(this.textareaId)).val()},CgsMapNote.prototype.setText=function(e){$$(this.document.getElementById(this.textareaId)).val(e)},CgsMapNote.prototype.getTextSize=function(){return{width:$$(this.document.getElementById(this.textareaId))[0].style.width,heightr:$$(this.document.getElementById(this.textareaId))[0].style.height,minHeight:$$(this.document.getElementById(this.textareaId))[0].style.minHeight}},CgsMapNote.prototype.setTextSize=function(e){var t;t=this.map&&this.map.currentIframeDocument?this.map.currentIframeDocument:window.document,e.height&&$$(t.getElementById(this.textareaId)).css("height",e.height),e.height&&$$(t.getElementById(this.textareaId)).css("width",e.width),e.height&&$$(t.getElementById(this.textareaId)).css("min-height",e.minHeight)},CgsMapNote.prototype.setMapNotePixOffset=function(e){this.noteOverlay.setPixelOffset(e),CgsMapNote.move(e,this.getLineType(e),this.noteOverlay,this.lineOverlay,this.noteLineColor)},CgsMapNote.prototype.getMapNotePixOffset=function(){return this.noteOverlay.getPixelOffset()},CgsMapNote.prototype.getId=function(){return this.divId},CgsMapNote.prototype.setVisible=function(e){this.noteOverlay.setVisible(e),this.lineOverlay.setVisible(e)},CgsMapNote.prototype.getVisible=function(){return this.noteOverlay.getVisible()},CgsMapNote.getDomById=function(e,t){for(var i=document.getElementsByTagName(e),s=[],o=0;o<i.length;o++)t==i[o].id&&s.push(i[o]);return s},CgsMapNote.setDomEventById=function(e,t,i,s){for(var o=document.getElementsByTagName(e),a=0;a<o.length;a++)t==o[a].id&&arr2.push(o[a])},CgsMapNote.prototype.updateOverlay3dom=function(){this.noteOverlay.overlay3D&&0<this.noteOverlay.overlay3D.clones.length&&(CgsOverlay.clone(this.noteOverlay),this.map.map3D.removeFeature(this.noteOverlay.overlay3D.clones[0]),this.noteOverlay.overlay3D.clones.shift(),this.map.map3D.addFeature(this.noteOverlay.overlay3D.clones[0])),this.lineOverlay.overlay3D&&0<this.lineOverlay.overlay3D.clones.length&&(CgsOverlay.clone(this.lineOverlay),this.map.map3D.removeFeature(this.lineOverlay.overlay3D.clones[0]),this.lineOverlay.overlay3D.clones.shift(),this.map.map3D.addFeature(this.lineOverlay.overlay3D.clones[0]))},CgsToolBar=function(i){var s=this;this.visible=!1,(this.opts=i)&&(i instanceof CgsMap?this.mapEarth=i:this.mapEarth=i.mapObject,this.mapEarth.allPropertiesConfigs&&this.mapEarth.allPropertiesConfigs.dmssUrl&&(this.dmssUrl=this.mapEarth.allPropertiesConfigs.dmssUrl),i.tools||(this.mapEarth.allPropertiesConfigs?i.tools=this.mapEarth.allPropertiesConfigs.toolbar.tools.map(function(e){if(!e.is3DOnly||2!==window.WGMODEFLAG)return e.name}):CgsSubPub.subscribe(CgsEvent.eMapConfigReady,function(e,t){i.tools=t.allPropertiesConfigs.toolbar.tools.map(function(e){if(!e.is3DOnly||2!==window.WGMODEFLAG)return e.name})})),this.uiToolBar(this.mapEarth),this.modelProtractActive=!1,this.markToolActive=!1,this.modelToolActive=!1,this.propertyToolActive=!1,this.saveToolActive=!1,CgsSubPub.subscribe("modechanged",function(e,t){s.measureTool&&(s.measureToolActive=!1,s.measureTool.deactivate(),s.measureTool=null,document.getElementById("cl").setAttribute("class","tool_normalDiv")),s.drawFeatureByMouseTool&&(s.drawFeatureByMouseToolActive=!1,s.drawFeatureByMouseTool.deactivate(),s.drawFeatureByMouseTool=null,document.getElementById("hzty").setAttribute("class","tool_normalDiv"))}))},CgsToolBar.prototype.uiToolBar=function(a){var e=this,n=this,t=a.container,i=document.getElementById("toolDiv");i&&t.removeChild(document.getElementById("toolDiv"));var s=[["tc","图层"],["bh","标绘"],["cl","测量"],["qh","二三维切换"],["dw","默认视角"],["fd","放大"],["sx","缩小"],["gz","光照"],["dqc","大气层"],["gx","归心"],["zx","左旋"],["yx","右旋"],["pdw","定位"],["yyt","鹰眼图"],["sdxx","视点信息"],["hzty","绘制图元"],["dmss","地名搜索"],["tyhz","基本图元绘制"],["jtgj","截图工具"]],o=n.opts.tools;if(this.sztoolBar=[],o)for(var r=_.keyBy(n.opts.tools),l=0;l<s.length;l++){var u=s[l],p=u[0];r[c=u[1]]&&this.sztoolBar.push(u)}else this.sztoolBar=s;(i=document.createElement("div")).setAttribute("id","toolDiv"),i.setAttribute("class","cgstoolBarDiv"),i.style.zIndex="900",i.style.visibility="visible";for(var h,c,g,d,l=0;l<this.sztoolBar.length;l++){h=e.sztoolBar[l],p=h[0],c=h[1],(g=document.createElement("div")).setAttribute("class","tool_normalDiv"),g.style.zIndex="901",g.setAttribute("title",c),g.setAttribute("id",p),(d=document.createElement("div")).setAttribute("class","toolbar_itemImageDiv "+p),g.onclick=function(e){var t,i;if(document.getElementById(this.id).setAttribute("class","tool_pressDiv"),"bh"==this.id)n.markToolActive?(n.symbolTool.deactivate(),a.symbolAttr&&a.symbolAttr.deactivate()):(n.makeSureToolRight(),a.symbolTool||new CgsSymbolTool(a),n.symbolTool||(n.symbolTool=a.symbolTool),n.symbolTool.activate(),n.markToolActive=!0,(t=document.getElementById("bh"))&&t.setAttribute("class","tool_pressDiv"));else if("tc"==this.id){a.layerToolActive?(a.layerTool.deactivate(),a.layerToolActive=!1,document.getElementById("tc").setAttribute("class","tool_hoverDiv")):(a.layerTool||(a.layerTool=new CgsLayerPlugg(a)),a.layerTool.activate(),a.layerToolActive=!0,(i=document.getElementsByClassName("layerBox_new"))[0]&&(i[0].parentNode.nextSibling.style.display="none"),document.getElementById("tc").setAttribute("class","tool_pressDiv"))}else if("pq"!=this.id)if("mx"==this.id)n.modelProtractActive?(n.modelDrawTool.deactivate(),a.modelTree&&(a.modelTree=null),n.modelProtractActive=!1,document.getElementById("mx").setAttribute("class","tool_hoverDiv")):(a.modelDrawTool||new CgsModelTool(a),n.modelDrawTool||(n.modelDrawTool=a.modelDrawTool),n.modelDrawTool.activate(),n.modelProtractActive=!0,document.getElementById("mx").setAttribute("class","tool_pressDiv"));else if("dmss"==this.id)n.toponymyPluggToolActive?(n.toponymyPluggTool.deactivate(),n.toponymyPluggToolActive=!1,document.getElementById("dmss").setAttribute("class","tool_hoverDiv")):(n.makeSureToolRight(),n.toponymyPluggTool||(n.toponymyPluggTool=new CgsToponymyPlugg(a)),n.toponymyPluggTool.activate(),n.toponymyPluggToolActive=!0,document.getElementById("dmss").setAttribute("class","tool_pressDiv"));else if("bc"==this.id)n.saveToolActive?(n.saveTool.deactivateSave(),n.saveToolActive=!1,document.getElementById("bc").setAttribute("class","tool_hoverDiv")):(n.saveTool||n.loadTool?n.saveTool||(n.saveTool=n.loadTool):n.saveTool=new CgsMapFile(a),n.saveTool.activateSave(),n.saveToolActive=!0,document.getElementById("bc").setAttribute("class","tool_pressDiv"));else if("dk"==this.id)n.loadTool||n.saveTool?n.loadTool||(n.loadTool=n.saveTool):n.loadTool=new CgsMapFile(a),n.loadTool.activateLoad();else if("cl"==this.id)n.measureTool||(n.measureTool=new CgsMeasureTool({mapObject:a})),n.measureToolActive?(n.measureToolActive=!1,n.measureTool.deactivate(),document.getElementById("cl").setAttribute("class","tool_hoverDiv")):(n.makeSureToolRight(),n.measureToolActive=!0,n.measureTool.activate(),document.getElementById("cl").setAttribute("class","tool_pressDiv"));else if("qh"==this.id)a.threeFlag&&("2D"==a.mode?a.setMapMode("3D"):a.setMapMode("2D"));else if("dw"==this.id)a.flyHome(),a.map2D.view.setRotation(0);else if("fd"==this.id)a.zoomIn();else if("sx"==this.id)a.zoomOut();else if("gz"==this.id){if("2D"==a.mode)return;var s=a.getLightingVisible();a.setLightingVisible(!s)}else if("dqc"==this.id){if("2D"==a.mode)return;var o=a.getSkyAtmosphereVisible();a.setSkyAtmosphereVisible(!o)}else"wq"==this.id?a.threeFlag&&(n.modelToolActive?(n.modelTool.deactivate(),n.modelToolActive=!1,document.getElementById("wq").setAttribute("class","tool_hoverDiv")):(n.makeSureToolRight(),n.modelTool||(n.modelTool=new CgsModelPlugg(a)),n.modelTool.activate(),n.modelToolActive=!0,document.getElementById("wq").setAttribute("class","tool_pressDiv"))):"dtzs"==this.id?a.threeFlag&&(n.mapNoteEditActive?(n.mapNoteEdit.deactivate(),n.mapNoteEditActive=!1,document.getElementById("dtzs").setAttribute("class","tool_hoverDiv")):(n.makeSureToolRight(),n.mapNoteEdit||(n.mapNoteEdit=new CgsMapNoteEdit(a)),n.mapNoteEdit.activate(),n.mapNoteEditActive=!0,document.getElementById("dtzs").setAttribute("class","tool_pressDiv"))):"gx"==this.id?a.flyBack():"jbfd"==this.id?(n.makeSureToolRight(),a.localZoomIn()):"zx"==this.id?a.leftRotateActive?(a.cancelRotate(),n.rotateActive=!1,document.getElementById("zx").setAttribute("class","tool_hoverDiv")):(a.leftRotate({}),n.rotateActive=!0,document.getElementById("yx").setAttribute("class","tool_normalDiv")):"yx"==this.id?a.rightRotateActive?(a.cancelRotate(),n.rotateActive=!1,document.getElementById("yx").setAttribute("class","tool_hoverDiv")):(a.rightRotate({}),n.rotateActive=!0,document.getElementById("zx").setAttribute("class","tool_normalDiv")):"pdw"==this.id?(n.locateTool||(n.locateTool=new CgsLocateTool(a)),n.locateToolActive?(n.locateToolActive=!1,n.locateTool.deactivate(),document.getElementById("pdw").setAttribute("class","tool_hoverDiv")):(n.locateToolActive=!0,n.locateTool.activate())):"jbjt"==this.id?(n.saveAsImageTool||(n.saveAsImageTool=new CgsSaveAsImageTool(a)),n.saveAsImageToolActive?(n.saveAsImageToolActive=!1,n.saveAsImageTool.deactivate(),document.getElementById("jbjt").setAttribute("class","tool_hoverDiv")):(n.makeSureToolRight(),n.saveAsImageToolActive=!0,n.saveAsImageTool.activate())):"tyhz"==this.id?n.drawTool?n.drawTool.drawEndEvent?n.drawTool.deactivate():n.drawTool.activate():n.drawTool=new CgsDrawTool({map:a}):"jtgj"==this.id?a.screenShot():"yyt"==this.id?n.aerialViewActive?(n.aerialViewActive=!1,a.hideAerialView(),document.getElementById("yyt").setAttribute("class","tool_hoverDiv")):(n.aerialViewActive=!0,a.showAerialView(),document.getElementById("yyt").setAttribute("class","tool_pressDiv")):"sdxx"==this.id?n.viewinfoActive?(n.viewinfoActive=!1,a.hideViewInfo(),document.getElementById("sdxx").setAttribute("class","tool_hoverDiv")):(n.viewinfoActive=!0,a.showViewInfo(),document.getElementById("sdxx").setAttribute("class","tool_pressDiv")):"sxk"==this.id||("hzty"==this.id?(n.drawFeatureByMouseTool||(n.drawFeatureByMouseTool=new CgsDrawFeatureByMouseTool({mapObject:a})),n.drawFeatureByMouseToolActive?(n.drawFeatureByMouseToolActive=!1,n.drawFeatureByMouseTool.deactivate(),document.getElementById("hzty").setAttribute("class","tool_hoverDiv")):(n.makeSureToolRight(),n.drawFeatureByMouseToolActive=!0,n.drawFeatureByMouseTool.activate(),document.getElementById("hzty").setAttribute("class","tool_pressDiv"))):"tykz"==this.id&&(n.satelliteTool||(n.satelliteTool=new CgsSatellitePlugg({mapObject:a})),n.satelliteToolActive?(n.satelliteToolActive=!1,document.getElementsByClassName("CgsToolBone CgsSatelliteTool_bone")[0].style.display="none",document.getElementById("tykz").setAttribute("class","tool_hoverDiv")):(n.satelliteTool.activate(),n.satelliteToolActive=!0,document.getElementsByClassName("CgsToolBone CgsSatelliteTool_bone")[0].style.display="block",document.getElementById("tykz").setAttribute("class","tool_pressDiv"))));self1=n},g.onmousedown=function(e){document.getElementById(this.id).setAttribute("class","tool_pressDiv")},g.onmouseup=function(e){m(this.id,"onmouseup")},g.onmouseleave=function(e){m(this.id,"onmouseleave")},g.onmouseenter=function(e){m(this.id,"onmouseenter")},g.appendChild(d),i.appendChild(g)}function m(e,t){var i=!1;"tc"==e?i=a.layerToolActive:"bh"==e?i=n.markToolActive:"mx"==e?i=n.modelProtractActive:"wq"==e?i=n.modelToolActive:"cl"==e?i=n.measureToolActive:"zx"==e?i=a.leftRotateActive:"yx"==e?i=a.rightRotateActive:"pdw"==e?i=n.locateToolActive:"jbjt"==e?i=n.saveAsImageToolActive:"yyt"==e?i=n.aerialViewActive:"sdxx"==e?i=n.viewinfoActive:"sxk"==e?i=n.propertyToolActive:"gc"==e?i=n.terrainActive:"bc"==e?i=n.saveToolActive:"hzty"==e?i=n.drawFeatureByMouseToolActive:"tykz"==e?i=n.satelliteToolActive:"dmss"==e&&(i=n.toponymyPluggToolActive);var s=document.getElementById(e);"onmouseleave"==t?i?s.setAttribute("class","tool_pressDiv"):s.setAttribute("class","tool_normalDiv"):"onmouseup"!=t&&"onmouseenter"!=t||(i?s.setAttribute("class","tool_pressDiv"):s.setAttribute("class","tool_hoverDiv"))}t.appendChild(i),CgsSubPub.subscribe("toolActive",function(e,t,i){t==a.layerTool?(i?document.getElementById("tc").setAttribute("class","tool_pressDiv"):document.getElementById("tc").setAttribute("class","tool_normalDiv"),a.layerToolActive=i):t==n.modelDrawTool?(i?document.getElementById("mx").setAttribute("class","tool_pressDiv"):document.getElementById("mx").setAttribute("class","tool_normalDiv"),n.modelProtractActive=i):t==n.modelTool?(i?document.getElementById("wq").setAttribute("class","tool_pressDiv"):document.getElementById("wq").setAttribute("class","tool_normalDiv"),n.modelToolActive=i):t==n.markTool?(i?document.getElementById("bh").setAttribute("class","tool_pressDiv"):document.getElementById("bh").setAttribute("class","tool_normalDiv"),n.markToolActive=i):t==n.propertyTool?(i?document.getElementById("sxk").setAttribute("class","tool_pressDiv"):document.getElementById("sxk").setAttribute("class","tool_normalDiv"),n.propertyToolActive=i):t==n.saveTool?(i?document.getElementById("bc").setAttribute("class","tool_pressDiv"):document.getElementById("bc").setAttribute("class","tool_normalDiv"),n.saveToolActive=i):t==n.toponymyPluggTool?(i?document.getElementById("dmss").setAttribute("class","tool_pressDiv"):document.getElementById("dmss").setAttribute("class","tool_normalDiv"),n.toponymyPluggToolActive=i):t==n.satelliteTool&&(i?document.getElementById("tykz").setAttribute("class","tool_pressDiv"):document.getElementById("tykz").setAttribute("class","tool_normalDiv"),n.satelliteToolActive=i)})},CgsToolBar.prototype.makeSureToolRight=function(){this.markToolActive&&(this.markToolActive=!1,this.symbolTool.deactivate(),document.getElementById("bh").setAttribute("class","tool_normalDiv")),this.measureToolActive&&(this.measureToolActive=!1,this.measureTool.deactivate(),document.getElementById("cl").setAttribute("class","tool_normalDiv")),this.drawFeatureByMouseToolActive&&(this.drawFeatureByMouseToolActive=!1,this.drawFeatureByMouseTool.deactivate(),document.getElementById("hzty").setAttribute("class","tool_normalDiv")),this.modelToolActive&&(this.modelTool.deactivate(),this.modelToolActive=!1,document.getElementById("wq").setAttribute("class","tool_normalDiv")),this.saveAsImageToolActive&&(this.saveAsImageToolActive=!1,this.saveAsImageTool.deactivate(),document.getElementById("jbjt").setAttribute("class","tool_normalDiv"))},CgsToolBar.prototype.show=function(){this.visible=!0,document.getElementById("toolDiv")||this.uiToolBar(this.mapEarth)},CgsToolBar.prototype.hide=function(){this.visible=!1;var e,t,i=this.mapEarth.container,s=document.getElementById("toolDiv");s&&(map.layerToolActive&&(map.layerTool.deactivate(),map.layerToolActive=!1,document.getElementById("tc").setAttribute("class","tool_hoverDiv")),null!=self1&&(self1.measureToolActive&&(self1.measureToolActive=!1,self1.measureTool.deactivate(),document.getElementById("cl").setAttribute("class","tool_hoverDiv")),e=map.getLightingVisible(),map.setLightingVisible(!e),t=map.getSkyAtmosphereVisible(),map.setSkyAtmosphereVisible(!t),map.cancelRotate(),self1.rotateActive=!1,document.getElementById("zx").setAttribute("class","tool_hoverDiv"),map.cancelRotate(),self1.rotateActive=!1,document.getElementById("yx").setAttribute("class","tool_hoverDiv"),self1.locateToolActive&&(self1.locateToolActive=!1,self1.locateTool.deactivate(),document.getElementById("pdw").setAttribute("class","tool_hoverDiv")),self1.aerialViewActive&&(self1.aerialViewActive=!1,map.hideAerialView(),document.getElementById("yyt").setAttribute("class","tool_hoverDiv")),self1.viewinfoActive&&(self1.viewinfoActive=!1,map.hideViewInfo(),document.getElementById("sdxx").setAttribute("class","tool_hoverDiv")),self1.drawFeatureByMouseToolActive&&(self1.drawFeatureByMouseToolActive=!1,self1.drawFeatureByMouseTool.deactivate(),document.getElementById("hzty").setAttribute("class","tool_hoverDiv")),self1.toponymyPluggToolActive&&(self1.toponymyPluggTool.deactivate(),self1.toponymyPluggToolActive=!1,document.getElementById("dmss").setAttribute("class","tool_hoverDiv")),self1.drawTool&&self1.drawTool.drawEndEvent&&self1.drawTool.deactivate()),i.removeChild(s))},CgsJmpInit=function(c){var e,g=this,d=(c=c).map3D;function m(e){d.scene.screenSpaceCameraController.enableRotate=e,d.scene.screenSpaceCameraController.enableTranslate=e,d.scene.screenSpaceCameraController.enableZoom=e,d.scene.screenSpaceCameraController.enableTilt=e,d.scene.screenSpaceCameraController.enableLook=e}function t(e){g.leftClick=!0,downButton=1,c.jmpApi.setLastMouseEvent(CgsJmp.LEFT_CLICK)}function i(e){g.leftClick=!1,c.gJMP.dblTimeout?(clearTimeout(c.gJMP.dblTimeout),c.gJMP.dblTimeout=null):c.gJMP.dblTimeout=setTimeout(function(){c.gJMP.dblTimeout=null},150),downButton=0}function s(e){g.leftClick=!1;c.gJMP.dblTimeout?(clearTimeout(c.gJMP.dblTimeout),c.gJMP.dblTimeout=null):c.gJMP.dblTimeout=setTimeout(function(){!function(e,t,i,s,o){gEvent=gEvent||new Module.JUIEvent;var a=gEvent;a.set_type(e),a.set_x(i),a.set_y(s),a.set_wheel(0),a.set_button(t),a.set_status(o),a.set_ch(0),a.set_key(0)}(2,0,e.position.x,e.position.y,16);c.gJMP.dblTimeout=null},150),downButton=0}function o(e){g.leftClick=!0,downButton=1}function a(e){c.gJMP.dblTimeout&&(clearTimeout(c.gJMP.dblTimeout),c.gJMP.dblTimeout=null),e.position?(e.position.x,e.position.y):(e.pixel[0],e.pixel[1]),c.jmpApi.setLastMouseEvent(CgsJmp.LEFT_DOUBLE_CLICK),c.jmpApi.publishNodeClickEvent(),downButton=0}function n(e){e.position.x,e.position.y;c.gJMP.dblTimeout&&(clearTimeout(c.gJMP.dblTimeout),c.gJMP.dblTimeout=null),c.jmpApi.setLastMouseEvent(CgsJmp.RIGHT_CLICK),downButton=0}function r(e){var t,i,s,o;g.draggable&&g.leftClick&&c.jmpApi.lastSelectedNode&&c.jmpApi.lastSelectedNode.id&&c.getSymbolByUid(c.jmpApi.lastSelectedNode.id)&&(i=(t=c.getSymbolByUid(c.jmpApi.lastSelectedNode.id).getPosition()).x?t:t[0],(s=g.lastSymbolPos.x?g.lastSymbolPos:g.lastSymbolPos[0]).x==i.x&&s.y==i.y||(o=c.jmpApi.lastSelectedNode.id,CgsSubPub.publish("pullsymbol",[o,c.getSymbolByUid(o)])),g.lastSymbolPos=t)}gEvent=null,downButton=0,modifer=0,gContext3D=null,gViewControl=null,this.draggable=!1,g.leftClick=!1,this.lastSymbolPos=[{x:0,y:0}],this.initJmp=function(){c.jmpApi||(function(){var e=new Module.JMPApp;{var t,i;GBK.init(),e.initialize("dat/","dat/"),nkJB.init(e,c),nkJB.math.init(),nkJB.utils.init(),nkJB.predefined.init(),nkJB.Animating.init(c),nkJB.shaderFont.init(THREE),nkJB.utils.PIXEL_RATIO=window.devicePixelRatio,d&&(nkJB.thresium.init(d,Cesium,THREE),t=nkJB.thresium.create(d.cesiumWidget,d.scene.logarithmicDepthBuffer),nkJB.init3D(THREE,c),i=nkJB.createRenderDevice3D(t),c.ThreeCesium=t,c.RenderDevice3D=i)}nkJB.olcanvas.init(ol),nkJB.DEVICE_PIXEL_RATIO=ol.has.DEVICE_PIXEL_RATIO,nkJB.init2D(c);var s=new nkJB.olcanvas.PlottingLayer({});c.map2D.addLayer(s),s.setMap(c.map2D);var o=new nkJB.olcanvas.PlottingInteraction(s);c.map2D.addInteraction(o),c.plottingInteraction=o,s.iteraction=o,c.plottingLayer=s,c.RenderDevice2D=s.renderDevice,c.symbolLibs={};var a,n=c.jmpPropertiesConfigs.symbolLibs;for(a in n){var r=n[a],l=e.getSymbolManager().importSymbolLib(r);c.symbolLibs[a]=l}e.symbolListener=function(){var t=new Module.JSymbolEventListener;return t.Lib=0,t.Set=0,t.Symbol=0,t.onSelectSymbolLib=function(e){c.Lib=e},t.onSelectSymbolSet=function(e){c.Set=e},t.onSelectSymbol=function(e){t.Symbol=e},t.onSelectNoSymbol=function(){c.Lib=c.Set=c.Symbol=0},t}(),e.registerSymbolEventListener(e.symbolListener);var u=new PlottingAppTool(c),p=new SceneEventListener(c,g);document.scene_event_listener=p,c.plotting=new nkJB.Plotting("scene1",c),new CgsJmpManage(c).createJmpLayer(),c.RenderDevice2D.plottings.push(c.plotting),c.map3D&&(c.RenderDevice3D.plottings.push(c.plotting),c.RenderDevice3D.switchEventEnable=m);c.plotting._tool_manager=u,c.gJMP=e;var h=new CgsJmp(c);c.jmpApi=h,c.jmpLoadingLock=!1,c.jmpLoadingSymbols.map(function(e){c.jmpManage||new CgsJmpManage(c),c.jmpManage.addSymbol(e)})}(),function(){if(c.map2D.on("dblclick",a),c.map2D.container.onmousedown=function(e){var t=e.button;"2D"==c.mode&&0===t&&(g.leftClick=!0)},c.map2D.container.onmouseup=function(e){var t=e.button;"2D"==c.mode&&0===t&&(g.leftClick=!1)},c.map2D.container.onmousemove=function(e){var t,i,s;g.draggable&&g.leftClick&&"2D"==c.mode&&c.jmpApi.lastSelectedNode&&c.getSymbolByUid(c.jmpApi.lastSelectedNode.id)&&(i=(t=c.getSymbolByUid(c.jmpApi.lastSelectedNode.id).getPosition()).x?t:t[0],g.lastSymbolPos.x==i.x&&g.lastSymbolPos.y==i.y||(s=c.jmpApi.lastSelectedNode.id,CgsSubPub.publish("pullsymbol",[s,c.getSymbolByUid(s)])),g.lastSymbolPos=t)},0==c.threeFlag)return;(e=new Cesium.ScreenSpaceEventHandler(c.map3D.canvas)).setInputAction(t,Cesium.ScreenSpaceEventType.LEFT_DOWN),e.setInputAction(o,Cesium.ScreenSpaceEventType.LEFT_DOWN,1),e.setInputAction(i,Cesium.ScreenSpaceEventType.LEFT_UP),e.setInputAction(s,Cesium.ScreenSpaceEventType.LEFT_UP,1),e.setInputAction(r,Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(a,Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),e.setInputAction(n,Cesium.ScreenSpaceEventType.RIGHT_CLICK)}())}},CgsJmpManage=function(e){if(e.jmpManage)return e.jmpManage;this.map=e,this.jbsByLibAndId={},this.allJbsInfoByLibAndId=[],this.isSymbolLibAnalysised=!1,e.jmpApi||e.jmpLoadingLock||e.loadJmpFileAndInit(),e.jmpManage=this},CgsJmpManage.prototype.getAllJbsInfoByLibAndId=function(){return this.isSymbolLibAnalysised||this.analysisJbLib(),this.allJbsInfoByLibAndId},CgsJmpManage.prototype.getConfigFileInfo=function(){return this.map.jmpPropertiesConfigs},CgsJmpManage.prototype.getAllSymbolInfo=function(){return this.isSymbolLibAnalysised||this.analysisJbLib(),this.jbsByLibAndId},CgsJmpManage.prototype.getAllSymbolInfoFromConfigFile=function(){return this.map.jmpApi.jbsByLibAndId},CgsJmpManage.prototype.findJbsByString=function(t){return this.isSymbolLibAnalysised||this.analysisJbLib(),_.filter(this.jbsByLibAndId,function(e){return 0<=e.name.indexOf(t)})},CgsJmpManage.prototype.getNodeId=function(e){return e.id},CgsJmpManage.prototype.findJbsById=function(t){return this.isSymbolLibAnalysised||this.analysisJbLib(),_.filter(this.jbsByLibAndId,function(e){return e.id==t})},CgsJmpManage.prototype.findJbsByLibAndId=function(e){return this.isSymbolLibAnalysised||this.analysisJbLib(),this.jbsByLibAndId[e]},CgsJmpManage.prototype.drawJbSymbolByName=function(t){this.isSymbolLibAnalysised||this.analysisJbLib();var e,i,s,o=_.filter(this.jbsByLibAndId,function(e){return e.name===t});0<o.length&&(e=o[0],this.map.jmpApi.jmpState.createType=1,this.map.jmpApi.jmpState.isDrawingByMouse=!0,i=e.libId.substring(3,e.libId.length),s=this.map.gJMP.getSymbolManager().getObjectById(i).getSymbolByID(e.id),this.map.gJMP.getSymbolManager().selectSymbol(s),this.map.plotting._tool_manager.switch_creating())},CgsJmpManage.prototype.drawJbSymbolById=function(t){this.isSymbolLibAnalysised||this.analysisJbLib();var e,i,s,o=_.filter(this.jbsByLibAndId,function(e){return e.id==t});0<o.length&&(e=o[0],this.map.jmpApi.jmpState.createType=1,this.map.jmpApi.jmpState.isDrawingByMouse=!0,i=e.libId.substring(3,e.libId.length),s=this.map.gJMP.getSymbolManager().getObjectById(i).getSymbolByID(e.id),this.map.gJMP.getSymbolManager().selectSymbol(s),this.map.plotting._tool_manager.switch_creating())},CgsJmpManage.prototype.drawJbSymbolByLibAndId=function(e){this.isSymbolLibAnalysised||this.analysisJbLib();var t,i,s=this.jbsByLibAndId[e];s?(this.map.jmpApi.jmpState.createType=1,this.map.jmpApi.jmpState.isDrawingByMouse=!0,t=s.libId.substring(3,s.libId.length),i=this.map.gJMP.getSymbolManager().getObjectById(t).getSymbolByID(s.id),this.map.gJMP.getSymbolManager().selectSymbol(i),this.map.plotting._tool_manager.switch_creating()):console.warn("库中不存在军标:"+e)},CgsJmpManage.prototype.analysisJbLib=function(){var l=this;if(!this.isSymbolLibAnalysised){this.isSymbolLibAnalysised=!0;var u,e=[],t=this.map.symbolLibs;for(u in t){var p={};e.push(p);var h=t[u],i=CGS_SDK_PATH+"assets/image/symbols_icon/";"lib10"!==u&&(i+=u+"/"),p.libID=h.getLibID(),p.libName=GBK.gbkToUTF8(h.getLibName()),p.symbolLib=h;var s=[];p.symbolSetList=s;for(var o=h.getObjectCount(),a=0;a<o;++a){var n={};s.push(n);var r=h.getObjectByIdx(a);n.name=GBK.gbkToUTF8(r.getSymbolSetName()),n.id=r.getSymbolSetID();var c=[],g=(n.symbolSet=r).getChildrenSetCount();if(0<g){n.childSet=c;for(var d=0;d<g;++d){var m={};c.push(m);var f=r.getChildSet(d);m.name=GBK.gbkToUTF8(f.getSymbolSetName()),m.id=f.getSymbolSetID(),C(m.childSet=f,m,i)}}else C(r,n,i)}}this.allJbsInfoByLibAndId=e}function C(e,t,i){var s=e.getObjectCount(),o=[];t.symbolList=o;for(var a=0;a<s;++a){var n={};o.push(n);var r=e.getObjectByIdx(a);n.symbol=r,n.name=GBK.gbkToUTF8(r.getSymbolName()),n.id=r.getSymbolID(),n.type=r.getSymbolType(),n.libId=u,n.symbolLib=h,n.icon=i+p.libID+n.id+".PNG",l.jbsByLibAndId[n.libId+"_"+n.id]=n}}},CgsJmpManage.prototype.addSymbol=function(e){var t=this.map;if(t.jmpApi){t.plotting._tool_manager.switch_creating();for(var i=e.options.lib.substring(3,e.options.lib.length),s=t.gJMP.getSymbolManager().getObjectById(i).getSymbolByID(e.options.id),o=t.plotting.getLayerById(e.layerId||t.plotting.activeLayer.id),a=[],n=0;n<e.options.pos.length;n++)a.push(e.options.pos[n].x,e.options.pos[n].y,e.options.pos[n].z?e.options.pos[n].y:0);var r=e.options.scale;t.jmpApi.lastNodeOriginType="INTERFACE";var l=t.plotting.createNodeWithParam(s,o,a,r),u=(l.cgsSymbol=e).options;u!={}&&t.jmpApi.setNodeAttrs(l,u),e.node=l,e.uid=l.id,e.map=this.map,CgsSubPub.publish(CgsEvent.eSymbolAdd,[e]),t.allSymbols.push(e)}else t.jmpLoadingSymbols.push(e)},CgsJmpManage.prototype.removeSymbol=function(e){var t,i,s,o=this.map.allSymbols.indexOf(e);-1!=o&&(this.map.allSymbols.splice(o,1),s=(i=(t=e.node).layer).getNodeById(t.id),i.remove(s),CgsSubPub.publish(CgsEvent.eSymbolDelete,[e.node.name]),map.map2D.render(),e=null)},CgsJmpManage.prototype.removeSymbolGroup=function(e){for(var t=e.array.length-1;0<=t;t--)this.removeSymbol(e.array[t]),e.removeSymbol(e.array[t]);e.destory()},CgsJmpManage.prototype.getSymbolByUid=function(e){for(var t=this.map.allSymbols.length-1;0<=t;t--)if(this.map.allSymbols[t].uid==e)return this.map.allSymbols[t]},CgsJmpManage.prototype.removeAllSymbols=function(){for(var e=this.map.allSymbols.length-1;0<=e;e--)this.removeSymbol(this.map.allSymbols[e]),this.map.allSymbols.splice(e,1)},CgsJmpManage.prototype.getAllSymbols=function(){return this.map.allSymbols},CgsJmpManage.prototype.getAllSymbolGroups=function(){return this.map.symbolGroups},CgsJmpManage.prototype.addSymbolGroup=function(e){this.getSymbolGroupByName(e.name)?console.info("the name of added symbolGroup has been used,please rename it"):this.map.symbolGroups.push(e)},CgsJmpManage.prototype.getSymbolGroupByName=function(e){for(var t=0;t<this.map.symbolGroups.length;t++)if(this.map.symbolGroups[t].name==e)return this.map.symbolGroups[t]},CgsJmpManage.prototype.getIconUrlByLibAndId=function(e,t){if(this.map.jmpApi){var i=this.map.jmpApi.treeData;return this._getIconUrlByLibAndId(e,t,i)}},CgsJmpManage.prototype._getIconUrlByLibAndId=function(e,t,i){for(var s=void 0,o=0;o<i.length&&!(i[o].children&&i[o]._symbolLib&&i[o]._symbolLib==e&&(s=this._getIconUrlByLibAndId(e,t,i[o].children)));o++)if(i[o]._jbs)for(var a=0;a<i[o]._jbs.length;a++){var n=i[o]._jbs[a];if(n.id==t&&n.libId==e){s=n.icon;break}}return s},CgsJmpManage.prototype._setPosition=function(e,t){var i=e.geometryAttrib;if("[object Array]"==Object.prototype.toString.call(t))for(var s=0,o=t.length;s<o;s++)if(t[s].x)i.SetPoint(s,t[s].x*Math.PI/180,t[s].y*Math.PI/180);else{if("number"==typeof t[0])return void i.SetPoint(s,t[0]*Math.PI/180,t[1]*Math.PI/180);"[object Array]"==Object.prototype.toString.call(t[0])&&i.SetPoint(s,t[s][0]*Math.PI/180,t[s][1]*Math.PI/180)}else i.SetPoint(0,t.x*Math.PI/180,t.y*Math.PI/180)},CgsJmpManage.prototype.serializeJB=function(e){var t=e.getNode().name;return this.map.gJMP.serializeJB(t)},CgsJmpManage.prototype.deserializeJB=function(e){this.map.gJMP.deserializeJB(e)},CgsJmpManage.prototype.setSymbolLayerEditable=function(e){this.map.jmpApi&&this.map.jmpApi.scene.setEditable(e)},CgsJmpManage.prototype.createJmpLayer=function(e){var t=this.map;return t.plotting.newLayer("图层-"+t.plotting.layers.length),"图层-"+(t.plotting.layers.length-1)},CgsJmpManage.prototype.getActiveLayerId=function(){return this.map.plotting.activeLayer.id},CgsJmpManage.prototype.setActiveLayerById=function(e){var t=this.map,i=t.plotting.getLayerById(e);return!!i&&(t.plotting.activeLayer=i,!0)},CgsJmpManage.prototype.setLayerNameById=function(e,t){var i=this.map.plotting.getLayerById(e);return!!i&&(i._name=t,!0)},CgsJmpManage.prototype.getLayerNameById=function(e){var t=this.map.plotting.getLayerById(e);if(t)return t.name},CgsJmpManage.prototype.getSymbolsByLayerId=function(e){var t=this.map.plotting.getLayerById(e);return t?t.nodes.map(function(e){return e.cgsSymbol}):[]},CgsJmpManage.prototype.getAllLayerIds=function(){for(var e=this.map.plotting.layers,t=[],i=0;i<e.length;i++)e[i]&&t.push(e[i].id);return t},CgsJmpManage.prototype.deleteLayerById=function(e){var t,i=this.map.plotting.layers.filter(function(e){return null!=e});i.length<2?console.warn("至少有一个图层"):(t=this.map.plotting.getLayerById(e))&&(this.map.plotting.remove(t),this.setActiveLayerById(i[0].id))},CgsJmp=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t=this;if(e.jmpApi)return e.jmpApi;var y=this;this.map=e,this.gJMP=e.gJMP,this.jbsByLibAndId={},this.config=e.jmpPropertiesConfigs.symbol,this.config.default_size=1,this.treeData=this.config.clazzes,this.defaultJbClazz=null,this.lastSelectedNode=null,this.lastCopyNode=null,this.lastSelectSymbol={node:null,size:[],angle:0},this.ui=null,this.domParser=new DOMParser,this.domSerializer=new XMLSerializer,this.symbolManager=this.gJMP.getSymbolManager(),this.jmpState={lastMouseEvent:CgsJmp.LEFT_CLICK,isDrawingByMouse:!1,createType:0},_.merge(CgsJmp.symbolIgnored,this.config.ignoredSymbols);var i=[];_.each(this.treeData,function(e){"customizeClazz"===e._clazzType?i.push(e):e.children?_.each(e.children,function(e){"customizeClazz"===e._clazzType?i.push(e):e.children?_.each(e.children,function(e){e._jbs=t.resolveOneClazz(e.text,e)}):e._jbs=t.resolveOneClazz(e.text,e)}):e.name&&(e._jbs=t.resolveOneClazz(e.name,e))}),_.each(i,function(e){e._jbs=_.map(e._content,function(e){return t.jbsByLibAndId[e._symbolLib+"_"+e.id]})}),function(){var m=y.map,f=(y.gJMP,!1);{var C;document.onkeydown?(C=document.onkeydown,document.onkeydown=function(e){C(e);var t,i,s=e||window.event||arguments.callee.caller.arguments[0];if(s&&46===s.keyCode){if(!m.deleteSymbolByKD)return;(o=m.plotting.editingNode)&&(CgsSubPub.publish(CgsEvent.eSymbolDelete,[m.plotting.editingNode.name]),y.deleteLastNode())}else if(s&&67==s.keyCode&&s.ctrlKey){(o=m.plotting.editingNode)&&(f=!0,t=(n=o.layer).getNodeById(o.id),l=new PlottingSerializer(m.plotting,m),a=(i=nkJB.utils.createXmlDocument()).createElement("GOBJ"),i.append(a),a.setAttribute("JBID",t.id),l.scene_doc=i,l.formatNode(t,a),m.plotting.copied_node=i,y.lastCopyNode=o)}else if(s&&86==s.keyCode&&s.ctrlKey&&f){y.jmpState.createType=3;var o,a,n=(o=y.lastCopyNode).layer,r="node_"+m.plotting._node_name_indicator++;(a=m.plotting.copied_node.documentElement).setAttribute("JBID",r);for(var l,u=a.children[1],p=u.children.length,h=0;h<p;h++){var c,g,d=u.children[h];"PX"==d.nodeName?(c=+d.textContent,d.textContent=.1+c):"PY"==d.nodeName&&(g=+d.textContent,d.textContent=.1+g)}(l=new PlottingSerializer(m.plotting,m)).scene_obj=m.plotting,l.deserializeNode(n,m.plotting.copied_node.documentElement)}}):document.onkeydown=function(e){var t,i,s=e||window.event||arguments.callee.caller.arguments[0];if(s&&46===s.keyCode){if(!m.deleteSymbolByKD)return;(o=m.plotting.editingNode)&&(CgsSubPub.publish(CgsEvent.eSymbolDelete,[m.plotting.editingNode.name]),y.deleteLastNode())}else if(s&&67==s.keyCode&&s.ctrlKey){(o=m.plotting.editingNode)&&(f=!0,t=(n=o.layer).getNodeById(o.id),l=new PlottingSerializer(m.plotting,m),a=(i=nkJB.utils.createXmlDocument()).createElement("GOBJ"),i.append(a),a.setAttribute("JBID",t.id),l.scene_doc=i,l.formatNode(t,a),m.plotting.copied_node=i,y.lastCopyNode=o)}else if(s&&86==s.keyCode&&s.ctrlKey&&f){y.jmpState.createType=3;var o,a,n=(o=y.lastCopyNode).layer,r="node_"+m.plotting._node_name_indicator++;(a=m.plotting.copied_node.documentElement).setAttribute("JBID",r);for(var l,u=a.children[1],p=u.children.length,h=0;h<p;h++){var c,g,d=u.children[h];"PX"==d.nodeName?(c=+d.textContent,d.textContent=.1+c):"PY"==d.nodeName&&(g=+d.textContent,d.textContent=.1+g)}(l=new PlottingSerializer(m.plotting,m)).scene_obj=m.plotting,l.deserializeNode(n,m.plotting.copied_node.documentElement)}}}}()}),CgsJmp.symbolIgnored={lib0_19:!0,lib0_28:!0,lib0_22:!0,lib0_732003:!0,lib10_25205:!0,lib10_25208:!0,lib10_26600:!0,lib10_26601:!0},CgsJmp.prototype.resolveOneClazz=function(e,t){var i=t._symbolLib,s=this.map.symbolLibs[i];if(s)for(var o=s.getSymbolSetByName(GBK.utf8ToGBK(e)),a=o.getObjectCount(),n=[],r=0;r<a;r++){var l=o.getObjectByIdx(r),u=GBK.gbkToUTF8(l.getSymbolName()),p=l.getSymbolID(),h=l.getSymbolType(),c={symbol:l,name:u,symbolLib:s,id:p,libId:i,type:h,icon:CGS_SDK_PATH+"assets/image/symbols_icon/"+i.substr(3)+"/"+p+".png"};CgsJmp.symbolIgnored[c.libId+"_"+c.id]||(this.jbsByLibAndId[i+"_"+p]=c,n.push(c))}return n},CgsJmp.prototype.findJbsByString=function(t){return _.filter(this.jbsByLibAndId,function(e){return 0<=String(e.name).indexOf(t)})},CgsJmp.prototype.findJbsByLibAndId=function(e,t){var i=CgsUtil.defaultValue(e,"")+"_"+CgsUtil.defaultValue(t,"");return _.filter(this.jbsByLibAndId,function(e){return 0<=(e.libId+"_"+e.id).indexOf(i)})},CgsJmp.prototype.clearSymbolScene=function(){this.map.plotting.clear(),this.map.ol_map.render()},CgsJmp.prototype.deleteLastNode=function(){var e=this.map.plotting.editingNode;e&&(e.layer.remove(e),this.map.map2D.render())},CgsJmp.prototype.importByString=function(e,t,i){var s=new PlottingSerializer(this.map.plotting,this.map,t);return s.parseXML_Str(e),i&&i(),s.scene_obj},CgsJmp.prototype.exportAsString=function(e){var t=new PlottingSerializer(this.map.plotting,this.map,e);t.formatXML();var i=t.scene_doc;return(new XMLSerializer).serializeToString(i)},CgsJmp.prototype.exportAsFormatString=function(e){var t=new PlottingSerializer(this.map.plotting,this.map,e);t.formatXML();var i=t.scene_doc,s=(new XMLSerializer).serializeToString(i);return s=CgsUtil.formatXml(s)},CgsJmp.prototype.exportSegmentAsString=function(e,t){var i=new PlottingSerializer(this.map.plotting,this.map,t);i.formatXML(e);var s=i.scene_doc;return(new XMLSerializer).serializeToString(s)},CgsJmp.prototype.getNodeAttrs=function(e,t){var i={name:"",type:0,uid:-1,width:0,height:0,angle:0,color:0,opacity:100,lineWidth:0,lineType:0,mirror:0,groundMode:0,groundOffset:.01,hasOutline:!1,foilLine:!0,outLineColor:0,outLineTran:100,outLineWidth:0,hasFill:!0,fill:!1,fillColor:0,fillColorAlpha:100,fillStyle:0,fadeMode:0,fadeColor0:0,fadeColor1:0,fadeOpacity0:100,fadeOpacity1:100,inlineText:[],fontName:"",textColor:0,geoData:[],scale:[],annoText:"",annoVisibility:!0,annoPosition:0,annoAlign:0,showBackground:!1,backgroundColor:0,annoTextColor:0,annoTextSize:0,annoTextOffSet:[0,0],annoFontName:"",annoBold:!1,annoItalic:!1,annoOffsetScreenPosX:0,annoOffsetScreenPosY:0,annoOffsetGeomPosLon:0,annoOffsetGeomPosLat:0,annotLineVisibility:!0,annoLineColor:0,symbolId:0,visibility:!0,detectable:!0,editable:!0,moveable:!0};t?i={}:t=i;var s=e.symbolAttrib;if(null!=t.name&&(i.name=s.GetName()),null!=t.type&&(i.type=s.GetSymbolType()),null!=t.uid&&(i.uid=e.id),null!=t.geoData){var o=e.geometryAttrib;CTypeValue.New||(CTypeValue.New=function(e,t){return new CTypeValue(e,t)});var a=CTypeValue.New("f64",4);o.GetBound(a.getPTR64(0),a.getPTR64(1),a.getPTR64(2),a.getPTR64(3));for(var n=o.GetPointCount(),r=[],l=0;l<n;l++)r.push([_.ceil(o.GetPoint(l).x,4),_.ceil(o.GetPoint(l).y,4)]);i.geoData=r}if(null!=t.scale){for(var u=[],p=(o=e.geometryAttrib).GetScaleCount(),l=0;l<p;l++)u.push(o.GetScale(l));i.scale=u}var h=e.drawingAttrib;if(null!=t.width&&(i.width=h.GetWidth()),null!=t.height&&(i.height=h.GetHeight()),null!=t.angle&&(i.angle=h.angle),null!=t.color&&(i.color=CgsUtil.jmpColorToRGBA(h.GetColor(),h.GetOpacity())),null!=t.opacity&&(i.opacity=h.opacity),null!=t.lineWidth&&(i.lineWidth=h.lineWidth),null!=t.lineType&&(i.lineType=h.lineType),null!=t.mirror&&(i.mirror=h.GetMirror()),null!=t.groundMode&&(i.groundMode=h.zmode),null!=t.groundOffset&&(i.groundOffset=h.zoffset),null!=t.hasOutline&&(i.hasOutline=h.GetHasOutline()),null!=t.foilLine&&(i.foilLine=1==h.outline),null!=t.outLineColor&&(i.outLineColor=CgsUtil.jmpColorToRGBA(h.outlineColor,h.outlineOpacity)),null!=t.outLineTran&&(i.outLineTran=h.outlineOpacity),null!=t.outLineWidth&&(i.outLineWidth=h.outlineWidth),null!=t.hasFill&&(i.hasFill=h.GetHasFill()),null!=t.fill&&(i.fill=h.GetFillAttr()),null!=t.fillColor&&(i.fillColor=CgsUtil.jmpColorToRGBA(h.GetFillColor(),h.GetFillTran())),null!=t.fillColorAlpha&&(i.fillColorAlpha=h.GetFillTran()),null!=t.fillStyle&&(i.fillStyle=h.fillType),null!=t.fadeMode&&(i.fadeMode=h.fadeType),null!=t.fadeColor0&&(i.fadeColor0=CgsUtil.jmpColorToRGBA(h.fadeColor0,h.fadeOpacity0)),null!=t.fadeColor1&&(i.fadeColor1=CgsUtil.jmpColorToRGBA(h.fadeColor1,h.fadeOpacity1)),null!=t.fadeOpacity0&&(i.fadeOpacity0=h.fadeOpacity0),null!=t.fadeOpacity1&&(i.fadeOpacity1=h.fadeOpacity1),null!=t.inlineText){u=[];if(0<h.GetInlineTextNum())for(n=h.GetInlineTextNum(),l=0;l<n;l++){var c=h.GetInlineText(l);u.push(c)}var g=s.GetLibID(),d=s.GetCodeID();(10===g&&25702===d||10===g&&25703===d||10===g&&25704===d||10===g&&25705===d||10===g&&28e3===d||32===g&&29900===d)&&(u=[]),i.inlineText=u}null!=t.fontName&&0<h.GetInlineTextNum()&&(i.fontName=h.GetFontName()),null!=t.textColor&&0<h.GetInlineTextNum()&&(i.textColor=h.GetTextColor());var m=e.annotationAttrib;null!=t.annoText&&(i.annoText=m.text),null!=t.annoVisibility&&(i.annoVisibility=m.visibility),null!=t.annoPosition&&(i.annoPosition=m.position),null!=t.annoAlign&&(i.annoAlign=m.align),null!=t.showBackground&&(i.showBackground=m.backgroundVisibility),null!=t.backgroundColor&&(i.backgroundColor=CgsUtil.jmpColorToRGBA(m.backgroundColor,100)),null!=t.annoTextColor&&(i.annoTextColor=CgsUtil.jmpColorToRGBA(m.GetTextColor())),null!=t.annoTextSize&&(i.annoTextSize=m.GetFontH()),null!=t.annoTextOffSet&&(0===i.type?i.annoTextOffSet=[m.GetOffsetScreenPosX(),m.GetOffsetScreenPosY()]:i.annoTextOffSet=[m.GetOffsetGeomPosLon(),m.GetOffsetGeomPosLat()]),null!=t.annoFontName&&(i.annoFontName=m.fontName),null!=t.annoBold&&(i.annoBold=m.fontBold),null!=t.annoItalic&&(i.annoItalic=m.fontItalic),null!=t.annoOffsetScreenPosX&&(i.annoOffsetScreenPosX=m.voffsetX.toFixed(0)),null!=t.annoOffsetScreenPosY&&(i.annoOffsetScreenPosY=m.voffsetY.toFixed(0)),null!=t.annoOffsetGeomPosLon&&(i.annoOffsetGeomPosLon=m.goffsetX.toFixed(4)),null!=t.annoOffsetGeomPosLat&&(i.annoOffsetGeomPosLat=m.goffsetY.toFixed(4)),null!=t.annotLineVisibility&&(i.annotLineVisibility=m.GetShowLinkLine()),null!=t.annoLineColor&&(i.annoLineColor=CgsUtil.jmpColorToRGBA(m.GetLinkLineColor()));s=e.symbolAttrib;return null!=t.symbolId&&(i.symbolId=s.codeID),null!=t.visibility&&(i.visibility=s.visibility),null!=t.detectable&&(i.detectable=s.detectable),null!=t.editable&&(i.editable=s.editable),null!=t.moveable&&(i.moveable=s.moveable),i},CgsJmp.prototype.setNodeAttrs=function(e,t){var n=e.symbolAttrib,r=e.drawingAttrib,l=e.geometryAttrib,u=e.annotationAttrib;_.each(t,function(e,t){var i,s,o,a;"width"===t?r.SetWidth(e):"height"===t?r.SetHeight(e):"angle"===t?r.angle=e:"color"===t?(a=CgsUtil.RGBATojmpColor(e),r.SetColor(a),e.a=e.a?e.a:1,r.SetOpacity(100*e.a)):"opacity"===t?r.opacity=e:"lineWidth"===t?r.lineWidth=e:"lineType"===t?r.lineType=e:"mirror"===t?r.SetMirror(e):"groundMode"===t?r.SetGroundMode(+e):"groundOffset"===t?r.SetGroundOffset(+e):"foilLine"===t?r.SetFoilLine(e):"outLineColor"===t?(a=CgsUtil.RGBATojmpColor(e),r.SetOutLineColor(a),e.a=e.a?e.a:1,r.SetOutLineTran(100*e.a)):"outLineTran"===t?r.outLineTran=e:"outLineWidth"===t?r.SetOutLineWidth(+e):"fill"===t?r.SetFillAttr(e):"fillColor"===t?e?(r.fillType=1,s=CgsUtil.RGBATojmpColor(e),r.SetFillColor(s),e.a=e.a?e.a:1,r.SetFillTran(100*e.a)):r.fillType=0:"fillColorAlpha"===t?r.SetFillTran(100*e):"fillStyle"===t?r.SetFillStyle(+e):"fadeMode"===t?r.fadeType=e:"fadeColor0"===t?(a=CgsUtil.RGBATojmpColor(e),r.fadeColor0=a,e.a=e.a?e.a:1,r.fadeOpacity0=100*e.a):"fadeColor1"===t?(a=CgsUtil.RGBATojmpColor(e),r.fadeColor1=a,e.a=e.a?e.a:1,r.fadeOpacity1=100*e.a):"fadeOpacity0"===t?r.fadeOpacity0=e:"fadeOpacity1"===t?r.fadeOpacity1=e:0<=t.indexOf("inlineText")?(i=Number(t.split("_")[1]),r.SetInlineText(i,e)):"fontName"===t?r.inlineTextFontName=e:"textColor"===t?(a=CgsUtil.RGBATojmpColor(e),r.SetTextColor(a)):0<=t.indexOf("geoPos")?(i=Number(t.split("_")[1]),0<t.indexOf("Lon")?l.SetPoint(i,e,l.GetPoint(i).y,0):l.SetPoint(i,l.GetPoint(i).x,e,0)):0<=t.indexOf("scale")?(i=Number(t.split("_")[1]),l.SetScale(i,e)):"annoText"===t?u.SetAnnoText(e):"annoVisibility"===t?u.SetVisibility(e):"annoPosition"===t?u.position=e:"annoAlign"===t?u.align=e:"showBackground"===t?u.backgroundVisibility=e:"backgroundColor"===t?(a=CgsUtil.RGBATojmpColor(e),u.backgroundColor=a):"annoTextSize"===t?u.SetFontH(e):"annoTextOffSet"===t?0===n.GetSymbolType()?(u.SetOffsetScreenPosX(+e[0]),u.SetOffsetScreenPosY(+e[1])):(u.SetOffsetGeomPosLon(+e[0]),u.SetOffsetGeomPosLat(+e[1])):"annoTextColor"===t?u.SetTextColor(CgsUtil.RGBATojmpColor(e)):"annoFontName"===t?u.fontName=e:"annoBold"===t?u.fontBold=e:"annoItalic"===t?u.fontItalic=e:"annoOffsetScreenPosX"===t?u.SetOffsetScreenPosX(+e):"annoOffsetScreenPosY"===t?u.SetOffsetScreenPosY(+e):"annoOffsetGeomPosLon"===t?u.SetOffsetGeomPosLon(+e):"annoOffsetGeomPosLat"===t?u.SetOffsetGeomPosLat(+e):"annotLineVisibility"===t?u.SetShowLinkLine(e):"annoLineColor"===t?u.SetLinkLineColor(CgsUtil.RGBATojmpColor(e)):"visibility"===t?n.visibility=e:"detectable"===t?n.detectable=e:"editable"===t?n.editable=e:"moveable"===t?n.moveable=e:"changeColor1"===t||"changeColor2"===t?t?(r.SetFadeMode(1),s=CgsUtil.RGBATojmpColor(e[0]),o=CgsUtil.RGBATojmpColor(e[2]),r.fadeColor0=s,r.fadeColor1=o):r.SetFadeMode(0):"changeColorDir"===t?r.SetFadeDir(e):"fillColor"===t&&(a=CgsUtil.RGBATojmpColor(e),r.SetFillColor(a))})},CgsJmp.prototype.setCustomAttribute=function(e,t,i){e.customAttrs[t]=i},CgsJmp.prototype.getCustomAttributes=function(e,t){return e.customAttrs[t]},CgsJmp.prototype.geNodeId=function(e){return e.id},CgsJmp.prototype.addCustomEdit=function(e){this.ui.addCustomEdit(e)},CgsJmp.prototype.setLastMouseEvent=function(e){this.jmpState.lastMouseEvent=e},CgsJmp.prototype.ev_onSelectNodeByID=function(e,t){if(!t)return!1;var i=this.map;i.lockScreen(!0,!1),this.gJMP.locked=!0,this.lastSelectedNode=e;var s=i.getSymbolByUid(e.id);s&&(this.lastSelectSymbol.node=e,this.lastSelectSymbol.size=s.getSize(),this.lastSelectSymbol.angle=s.getAngle(),this.lastSelectSymbol.position=s.getPosition()),this.ui&&(this.ui.currentNode=e),this.symbolAttrui&&this.symbolAttrui.updateAttributes(e);var o=[t.x,t.y];0===t.button?(CgsSubPub.publish(CgsEvent.eSymbolNodeClick,[e,o]),CgsSubPub.publish(CgsEvent.eSymbolClick,[s,o])):2===t.button&&(CgsSubPub.publish(CgsEvent.eSymbolNodeRightClick,[e,o]),CgsSubPub.publish(CgsEvent.eSymbolRightClick,[s,o]))},CgsJmp.prototype.ev_onSelectNothing=function(){this.lastSelectedNode&&(this.lastSelectedNode=null,this.symbolAttrui&&this.symbolAttrui.updateAttributes(null))},CgsJmp.prototype.ev_onNodeGraphicsUpdated=function(){this.lastSelectedNode&&this.symbolAttrui&&this.symbolAttrui&&this.symbolAttrui.updateSizeAndGeo(this.lastSelectedNode)},CgsJmp.prototype.ev_onClearScene=function(){this.lastSelectedNode&&(this.lastSelectedNode=null,this.symbolAttrui.updateAttributes(null))},CgsJmp.prototype.ev_onAddNode=function(e,t){var i=this.jmpState.createType;this.jmpState.isDrawingByMouse&&(this.jmpState.isDrawingByMouse=!1);var s,o,a=this.map.plotting.getLayerById(e).getNodeById(t),n=this.getNodeAttrs(a);a.defaultAttrs||(o=2==i?(s=n.width,n.height):(s=n.width*this.config.default_size,n.height*this.config.default_size),0===n.type&&1!==this.config.default_size&&(n.width=s,n.height=o,this.setNodeAttrs(a,{width:s,height:o})),a.defaultAttrs={width:s,height:o},a.customAttrs=a.customAttrs||{})},CgsJmp.prototype.publishNodeClickEvent=function(e){var t=this.jmpState.lastMouseEvent,i=this.lastSelectedNode;if(!this.jmpState.isDrawingByMouse&&i){for(var s=null,o=0;o<this.map.allSymbols.length;o++)if(this.map.allSymbols[o].node.id===i.id){s=this.map.allSymbols[o];break}t===CgsJmp.LEFT_CLICK?(CgsSubPub.publish(CgsEvent.eSymbolNodeClick,[i,e]),CgsSubPub.publish(CgsEvent.eSymbolClick,[s,e])):t===CgsJmp.RIGHT_CLICK?(CgsSubPub.publish(CgsEvent.eSymbolNodeRightClick,[i,e]),CgsSubPub.publish(CgsEvent.eSymbolRightClick,[s,e])):t===CgsJmp.LEFT_DOUBLE_CLICK&&(CgsSubPub.publish(CgsEvent.eSymbolNodeDbClick,[i,e]),CgsSubPub.publish(CgsEvent.eSymbolDbClick,[s,e]))}else{this.jmpState.isDrawingByMouse&&t===CgsJmp.RIGHT_CLICK&&(function(e,t,i,s,o){if(!gEvent){if(!Module.JUIEvent)return;gEvent=new Module.JUIEvent}var a=gEvent;a.set_type(e),a.set_x(i),a.set_y(s),a.set_wheel(0),a.set_button(t),a.set_status(o),a.set_ch(0),a.set_key(0)}(2,1,400,400,0),map.jmpApi.setLastMouseEvent(CgsJmp.LEFT_DOUBLE_CLICK),downButton=0)}},CgsJmp.LEFT_CLICK=1,CgsJmp.RIGHT_CLICK=2,CgsJmp.LEFT_DOUBLE_CLICK=3,PlottingAppTool.prototype.switch_creating=function(){var e=this.map,t=new nkJB.CreatingUIEventHandler(e.RenderDevice2D,e.plotting);e.plottingLayer.uihandler&&e.plottingLayer.uihandler.close(),e.plottingLayer.uihandler=t;t=new nkJB.CreatingUIEventHandler(e.RenderDevice3D,e.plotting);e.uihandler&&(e.uihandler.close(),e.ThreeCesium&&e.ThreeCesium.uiEventX.uninstall()),e.ThreeCesium&&e.ThreeCesium.uiEventX.install(t),e.uihandler=t},PlottingAppTool.prototype.switch_editing=function(){var e=this.map,t=new nkJB.EditingUIEventHandler(e,e.RenderDevice2D,e.plotting);e.plottingLayer.uihandler&&e.plottingLayer.uihandler.close(),e.plottingLayer.uihandler=t,e.map3D&&(t=new nkJB.EditingUIEventHandler(e,e.RenderDevice3D,e.plotting),e.uihandler&&(e.uihandler.close(),e.ThreeCesium&&e.ThreeCesium.uiEventX.uninstall()),e.ThreeCesium&&e.ThreeCesium.uiEventX.install(t)),e.uihandler=t},PlottingAppTool.prototype.switch_none=function(){var e=this.map;e.plottingLayer.uihandler&&e.plottingLayer.uihandler.close(),e.plottingLayer.uihandler=void 0,e.uihandler&&(e.uihandler.close(),e.ThreeCesium&&e.ThreeCesium.uiEventX.uninstall()),e.uihandler=void 0},SceneEventListener.prototype.onCreateScene=function(e){},SceneEventListener.prototype.onDeleteScene=function(e){},SceneEventListener.prototype.onSelectScene=function(e){},SceneEventListener.prototype.onClearScene=function(e){},SceneEventListener.prototype.onAddLayer=function(e,t){CgsSubPub.publish(CgsEvent.eSymbolLayerAdd,[t])},SceneEventListener.prototype.onDeleteLayer=function(e){CgsSubPub.publish(CgsEvent.eSymbolLayerDeleted,[e])},SceneEventListener.prototype.onSetLayerVisible=function(e,t){},SceneEventListener.prototype.onSetLayerEditable=function(e,t){},SceneEventListener.prototype.onSelectLayer=function(e){this.jmpInit.draggable=!1},SceneEventListener.prototype.onClearLayer=function(e){},SceneEventListener.prototype.onAddNode=function(e,t){var s=this.map;s.jmpApi.ev_onAddNode(e,t);var i=null;s.jmpApi.lastSelectedNode&&(i=s.getSymbolByUid(s.jmpApi.lastSelectedNode.id));var o,a,n,r,l,u=s.plotting,p=null;!u||(o=u.getLayerById(e))&&(p=o.getNodeById(t)),p&&("INTERFACE"!=s.jmpApi.lastNodeOriginType?(n={lib:"lib"+(a=s.plotting.getLayerById(e).getNodeById(t)).symbolAttrib.GetLibID(),id:a.symbolAttrib.GetCodeID(),layerId:e},(r=new CgsSymbol(n)).node=p,r.map=s,r.originType="UI",r.uid=p.id,i&&(r.inward=i.getInwardText(),i.getName()&&r.setName(i.getName())),p.cgsSymbol=r,s.allSymbols.push(r),CgsSubPub.publish(CgsEvent.eSymbolAdd,[r]),s.jmpSequenceDraw?setTimeout(function(){var e=s.gJMP.lastDrawSymbolLib,t=s.gJMP.lastDrawSymbolId,i=s.jmpApi.jbsByLibAndId[e+"_"+t];s.jmpApi.symbolManager.selectSymbol(i.symbol),s.plotting._tool_manager.switch_creating()}):((l=$$("#"+s.target).children()).find(".CgsSymbolTool__tool_active").removeClass("CgsSymbolTool__tool_active"),$$(l[0]).css("cursor",""),$$(l[1]).css("cursor",""),s.symbolAttr&&s.symbolAttr.ui.updateAttributes(p))):(s.jmpApi.lastNodeOriginType=null,s.gJMP.getSymbolManager().selectNothing(),s.plotting._tool_manager.switch_editing())),this.map.map2D.render()},SceneEventListener.prototype.onDeleteNode=function(e){CgsSubPub.publish(CgsEvent.eSymbolDelete,[e]);for(var t=this.map,i=t.symbolGroups.length-1;0<=i;i--)if(t.symbolGroups[i].getSymbolByUid(e)){t.symbolGroups[i].removeSymbol(t.getSymbolByUid(e));break}for(i=t.allSymbols.length-1;0<=i;i--)if(t.allSymbols[i].node.id==e){t.allSymbols.splice(i,1);break}t.getSymbolByUid(e)&&(t.getSymbolByUid(e).map=null,t.getSymbolByUid(e).uid=null,t.getSymbolByUid(e).node=null,t.getSymbolByUid(e).group=null,t.getSymbolByUid(e).options=null,t.getSymbolByUid(e).attrs=null,t.getSymbolByUid(e).self=null,t.getSymbolByUid(e).map=null,t.getSymbolByUid(e).originType=null),this.map.plotting.selectedNodes.length=0,this.map.map2D.render()},SceneEventListener.prototype.onSetNodeVisible=function(e,t){this.jmpInit.draggable=!0},SceneEventListener.prototype.onSetNodeEditable=function(e,t){},SceneEventListener.prototype.onSelectNodeByID=function(e,t,i){var s=map.plotting.getLayerById(t).getNodeById(i);null!=s&&this.map.jmpApi.ev_onSelectNodeByID(s)},SceneEventListener.prototype.onSelectNode=function(e,t){null!=e&&(this.jmpInit.draggable=!0,this.map.jmpApi.ev_onSelectNodeByID(e,t))},SceneEventListener.prototype.onSelectNothing=function(){this.jmpInit.draggable=!1,this.map.jmpApi.ev_onSelectNothing(),this.map.lockScreen(this.map.lockFlag,!1)},SceneEventListener.prototype.onSceneUpdated=function(e,t){},SceneEventListener.prototype.onLayerUpdated=function(e,t){},SceneEventListener.prototype.onNodeUpdated=function(e,t){},SceneEventListener.prototype.onNodeAttrChanged=function(e,t){this.map.jmpApi.ev_onNodeGraphicsUpdated()},SceneEventListener.prototype.onNodeGraphicsUpdated=function(e,t){this.map.jmpApi.ev_onNodeGraphicsUpdated()},SceneEventListener.prototype.onEditHandle=function(e){e==nkJB.EHT.NODE_HANDLE?document.body.style.cursor="pointer":e==nkJB.EHT.SCALE_X_HANDLE?document.body.style.cursor="e-resize":e==nkJB.EHT.SCALE_Y_HANDLE?document.body.style.cursor="n-resize":e==nkJB.EHT.SCALE_XY_HANDLE?document.body.style.cursor="move":e==nkJB.EHT.ROTATE_HANDLE?document.body.style.cursor="crosshair":e==nkJB.EHT.LABEL_CHANGE_HANDLE?document.body.style.cursor="text":document.body.style.cursor=""},SceneEventListener.prototype.constructor=SceneEventListener,CgsPlotScale=function(c){this.map=c,this.createScaleDiv(c),1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG||CgsSubPub.subscribe("postrender",function(){var e,t,i,s,o,a,n,r,l,u,p,h;c&&c.plotScaleFlag&&(c.map3D&&0!=c.map3D.scene.viewIndex||(e=c.container,(t=[]).push(30),t.push(e.clientHeight-30),t.push(130),t.push(e.clientHeight-30),(i=c.pixelToLonLat([t[0],t[1]]))?(s=Cesium.Cartesian3.fromDegrees(i[0],i[1]),(o=c.pixelToLonLat([t[2],t[3]]))?(a=Cesium.Cartesian3.fromDegrees(o[0],o[1]),n=Cesium.Cartesian3.distance(s,a),!(r=document.getElementById("plotScaleDivText"))||n<1||(u=null,u=1e3<=(l=parseInt(n))?(l/=1e3," km"):" m",p=l<10?l.toFixed(1):l.toFixed(0),r.innerHTML="比例尺 : "+p+u,(h=document.getElementById("plotScaleDiv"))&&(h.style.visibility="visible"))):(h=document.getElementById("plotScaleDiv"))&&(h.style.visibility="hidden")):(h=document.getElementById("plotScaleDiv"))&&(h.style.visibility="hidden")))})},CgsPlotScale.prototype.createScaleDiv=function(e){var t=CGS_SDK_PATH+"assets/image/CgsViewInfo/",i=document.createElement("div");i.style.position="absolute",i.setAttribute("id","plotScaleDiv"),i.style.width="auto",i.style.height="0px",i.style.left="30px",i.style.bottom="30px";var s=document.createElement("div");s.style.position="relative",s.style.width="100px",s.style.height="0px",s.style.left="0px",s.style.bottom="0px",s.style.borderTop="solid rgba(255,255,255,1.0) 2px",s.style.pointerEvents="none",i.appendChild(s);var o=document.createElement("div");o.style.position="absolute",o.style.width="2px",o.style.height="0px",o.style.left="0px",o.style.bottom="0px",o.style.borderTop="solid rgb(0,0,0) 2px",o.style.pointerEvents="none",o.style.borderColor="rgba(255,255,255,1.0)",i.appendChild(o);var a='<img class="aa-plotScaleDiv-bg" src="'+t+'bg3.png">';$$(i).append(a);var n=document.createElement("div");n.style.position="absolute",n.style.width="2px",n.style.height="0px",n.style.left="98px",n.style.bottom="0px",n.style.borderTop="solid rgb(0,0,0) 2px",n.style.pointerEvents="none",n.style.borderColor="rgba(255,255,255,1.0)",i.appendChild(n);var r=document.createElement("div");r.setAttribute("id","plotScaleDivText"),r.style.position="relative",r.style.color="rgba(255,255,255,1.0)",r.innerHTML="比例尺",r.style.bottom="40px",r.style.fontFamily="微软雅黑",r.style.fontSize="14px",i.appendChild(r),i.style.visibility="hidden",e.container.appendChild(i)},CgsToolBone=function(e){var i=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$;this.element=null,this.tools=[];var s=this;this.element=i("<div class='CgsToolBone'><div class='CgsToolBone__title'><div class='CgsToolBone__closeDiv'><div class='CgsToolBone__closeBtn'>+</div></div></div><div class='CgsToolBone__container'><div class='CgsToolBone__toolContainer'></div><div class='CgsToolBone__bottom'></div></div></div>"),i(e.container).append(this.element);var t=this.element;this.element.resizable({minHeight:200,minWidth:150,resize:function(){CgsSubPub.publish("toolResize",[s.tools,e])},onResize:function(){CgsSubPub.publish("toolResize",[s.tools,e])},onStopResize:function(){CgsSubPub.publish("toolStopResize",[s.tools,e])}}),this.element.draggable({handle:i(t).find(".CgsToolBone__title")}),this.element.removeClass("ui-draggable"),this.element.find(".CgsToolBone__closeBtn").click(function(e){for(var t=0;t<s.tools.length;t++)s.tools[t].deactivate();i("#cgs-layers-popup").css("display","none")})},CgsToolBone.prototype.destroy=function(){this.element.remove()},CgsToolBone.prototype.addTool=function(e){for(var t=0;t<this.tools.length;++t)this.tools[t].setFocus(!1);var i=this.element.find(".CgsToolBone__closeDiv");0<this.tools.length&&i.before($$("<div class='CgsToolBone__split'></div>")),i.before(e.title),this.element.find(".CgsToolBone__toolContainer").append(e.body),e.setFocus(!0),e.title.show(),this.tools.push(e),e.bone=this},CgsToolBone.prototype.removeTool=function(e){if(0!=this.tools.length){for(var t,i=0;i<this.tools.length&&this.tools[i]!=e;++i);this.tools[i]==e&&(t=this.element.find(".CgsToolBone__split").last(),e.title.detach(),e.body.detach(),t.remove(),e.bone=null,this.tools.splice(i,1),0!=this.tools.length?(--i<0&&(i=0),e.focus&&this.tools[i].setFocus(!0)):this.destroy())}},CgsToolBone.prototype.setPosition=function(e){e.left&&(this.element.css("right","none"),this.element.css("left",e.left)),e.top&&(this.element.css("bottom","none"),this.element.css("top",e.top)),e.right&&(this.element.css("left","none"),this.element.css("right",e.right)),e.bottom&&(this.element.css("top","none"),this.element.css("bottom",e.bottom))},CgsTool=function(e,t,i){this.map=e,this.title=t,this.body=i,t||(this.root=i,this.title=$$(i).find(".CgsTool__title").eq(0),this.body=$$(i).find(".CgsTool__content").eq(0))},CgsTool.prototype.setFocus=function(e){0==e?(this.title.removeClass("CgsTool__title_focused"),this.body.hide()):(this.title.addClass("CgsTool__title_focused"),this.body.show())},CgsTool.prototype.activate=function(){this.bone||(this.bone=new CgsToolBone(this.map),this.bone.addTool(this),1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG||(this instanceof CgsLayerTool?this.bone.element.addClass("CgsLayerTool_bone"):this instanceof CgsMarkTool?this.bone.element.addClass("CgsMarkTool_bone"):(this instanceof CgsGradientTool3D||this instanceof CgsProfileUI3D)&&this.bone.element.addClass("CgsGradientTool_bone"))),this.bone.element.show(),this.title.show(),this.body.show(),CgsSubPub.publish("toolActive",[this,!0])},CgsTool.prototype.deactivate=function(){this.title.hide(),this.body.hide(),this.bone&&this.bone.removeTool(this),this.bone=null,CgsSubPub.publish("toolActive",[this,!1])},CgsLayerTool=function(s){this.title=null,this.body=null,this.opacityToolVisible=!1,this.selectLayer=null,this.selectLayerId=null,this.opacityRecords={},this.$sliderPlgg=null;var n=this;this.createLayersPopup=function(){0!=$$("#cgs-layers-popup").length&&$$("#cgs-layers-popup").remove();var e=$("<div id='cgs-layers-popup'></div>");e.appendTo($$("#"+s.target)),e.prepend($$("\n\t\t\t<div class='layers-popup-title'>\n\t\t\t\t<span>当前图层：未选中图层</span>\n\t\t\t\t<div class='close-btn'></div>\n\t\t\t</div>\n\t\t\t<div class='layers-popup-body'>\n\t\t\t\t<div class='opacity-title-name'>透明度</div>\n\t\t\t\t<div id='cgs-opacity-slider'>\n\t\t\t\t\t<div class='slider-bar'></div>\n\t\t\t\t\t<div class='slider-mask'></div>\n\t\t\t\t</div>\n\t\t\t\t<span class='slider-number'>100%</span>\n\t\t\t</div>")),$$("#cgs-layers-popup .layers-popup-title .close-btn").on("click",function(){$$("#cgs-layers-popup").css("display","none")});var t=e.find("#cgs-opacity-slider"),i=(this.$sliderPlgg=t).children()[0],a=t.next();i.onmousedown=function(e){var s=(e=e||window.event).clientX-this.offsetLeft,o=this;document.onmousemove=function(e){e=e||window.event;o.style.left=e.clientX-s+"px";var t=parseInt(o.style.left),i=void 0;t<10?(o.style.left="10px",i=0,a.text("0%"),n.opacityRecords[n.selectLayerId]=0):10<t&&t<115?(i=(t-10)/105,a.text(parseInt((t-10)/105*100)+"%"),n.opacityRecords[n.selectLayerId]=t):115<t&&(i=1,o.style.left="115px",a.text("100%"),n.opacityRecords[n.selectLayerId]=115),n.selectLayer&&n.selectLayer.setAlpha(i),window.getSelection?window.getSelection().removeAllRanges():document.getSelection.empty()},document.onmouseup=function(){document.onmousemove=null}}},CgsTool.call(this,s,this.title,this.body),this.createTool(this.map),CgsSubPub.subscribe("layerAdded",function(){n.reDraw(n.map)}),CgsSubPub.subscribe("layerRemoved",function(){n.reDraw(n.map)}),CgsSubPub.subscribe("layerGroupChanged",function(){n.reDraw(n.map)}),CgsSubPub.subscribe("toolActive",function(e,t,i){t==n&&0==i&&($$(".CgsLayerWindow").remove(),n.window=null,n.body.find(".CgsLayerTool__addLayer").parent().removeClass("CgsBottomTool__pressed"))})},CgsInherits(CgsLayerTool,CgsTool),CgsLayerTool.prototype.createTool=function(e){var t=CGS_SDK_PATH+"assets/image/ablum.png",i=$$(e.container);this.title=$$("<div class='CgsLayerTool__title CgsTool__title'><img class='CgsLayerTool__titleImg' ><span class='CgsLayerTool__titleText'>图层</span><div class='CgsLayerTool__closeButton'></div></div>"),this.body=$$("<div class='CgsLayerTool' style='display:none;'><div id='CgsLayerTool_container_id' class='ztree'></div></div>"),i.append(this.body),this.title.hide(),this.body.hide(),this.title.find(".CgsLayerTool__titleImg").attr("src",t),this.createLayersPopup(),this.reDraw(e)},CgsLayerTool.prototype.reDraw=function(u){for(var e=[],t=u.treeNodes.layerGroup,i=0;i<t.length;i++){var s=t[i],o={name:s.name,id:s.id,pId:s.pId,open:!1,children:[]};if("null"==s.pId)e.push(o);else for(var a=0;a<e.length;a++)e[a].id==s.pId&&e[a].children.push(o)}var n,r,l,p,h,c,g=this,d={check:{enable:!0},view:{dblClickExpand:!0,showLine:!0,selectedMulti:!1,showIcon:!0},data:{simpleData:{enable:!0},keep:{parent:!0,leaf:!0}},callback:{onCheck:function e(t,i,s){if(null!=s.children)for(var o=0;o<s.children.length;o++)e(t,i,s.children[o]);else{var a=s.id;CgsSubPub.publish("layerSetVisible",[a,s.checked]),u.getLayerById(a).setVisible(s.checked)}},onClick:function(e,t,i){var s,o,a,n,r,l;i.children||(g.opacityToolVisible&&"block"!==$$("#cgs-layers-popup").css("display")&&$$("#cgs-layers-popup").css("display","block"),s=i.id,o=u.getLayerById(s),g.selectLayerId=s,o instanceof CgsTileLayer&&(a=(g.selectLayer=o).getText(),n=g.opacityRecords[s]||115,r=g.$sliderPlgg.children()[0],l=g.$sliderPlgg.next(),r.style.left=n+"px",10==n?l.text("0%"):115==n?l.text("100%"):l.text(parseInt((n-10)/105*100)+"%"),$$("#cgs-layers-popup .layers-popup-title span").text("当前图层："+a)))}}},m=u.getLayers(),f=function e(t,i){for(var s=0;s<t.length;s++){var o=t[s];if(o.id==i)return o;if(o.children&&0<o.children.length){var a=e(o.children,i);if(null!=a)return a}}return null};for(i in m)1==m[i].getAddToLayerTree()&&(n=m[i],h=p=l=r=void 0,null==n.getPId()?((r={checked:n.getVisible()}).name=n.getText(),r.id=n.getId(),r.pId=n.getPId(),r.children=[],e.push(r)):(l=n.getPId(),null!=(p=f(e,l))?((h={checked:n.getVisible()}).name=n.getText(),h.id=n.getId(),h.pId=n.getPId(),p.children.push(h)):console.info("the pId of layer is not correct")));function C(e){return c.apply(this,arguments)}checkStatus=(c=function(e){if(this.visible=!0,e.children&&0<e.children.length)for(var t=e.children,i=0;i<t.length;i++){var s=t[i];this.visible=checkStatus(s)&&this.visible}else this.visible=this.visible&&e.checked;return e.checked=this.visible,this.visible},C.toString=function(){return c.toString()},C);for(a=0;a<e.length;a++)checkStatus(e[a]);$$.fn.zTree.init($$(".ztree"),d,e)},CgsLayerTool.prototype.setOpacityToolVisible=function(e){this.opacityToolVisible=!!e,$$("#cgs-layers-popup").css("display",e?"block":"none")},CgsLayerTool.prototype.getOpacityToolVisible=function(){return this.opacityToolVisible},CgsMarkTool=function(e){this.title=$$("<div class='CgsMarkTool__title CgsTool__title'><img class='CgsMarkTool__titleImg' ><span class='CgsMarkTool__titleText'>军标</span><div class='CgsMarkTool__closeButton'></div></div>"),this.body=$$("<div class='CgsMarkTool' style='display:none;'><div class='CgsMarkTool__top'><div class='CgsMarkTool__switchTab'><div class='CgsMarkTool__currentClass'><p class='CgsMarkTool__currentClassText'></p></div><div class='CgsMarkTool__classContainer'></div></div></div><div class='CgsMarkTool__container'></div><div class='CgsMarkTool__bottom'><div class='CgsMarkTool__bottomTool'><div title='删除军标' class='CgsMarkTool__removeAll'></div></div></div></div>"),this.data={toolkits:[{name:"常用",id:"common",tools:[{title:"点",id:"D-27-100",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/D-27-100.png"},{title:"空降兵",id:"KJB",type:"mark",positioning:"bottom-center",url:"assets/image/JB_Image/KJB.png"},{title:"炮瞄雷达",id:"PMLD-13500-10",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/PMLD-13500-10.png"},{title:"指挥所",id:"ZHS",type:"mark",positioning:"bottom-left",url:"assets/image/JB_Image/ZHS.png"}]},{name:"空军符号",id:"airforce",tools:[{title:"空军",id:"KJ",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/KJ.png"},{title:"空降兵",id:"KJB",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/KJB.png"},{title:"指挥所",id:"ZHS",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/ZHS.png"}]},{name:"雷达",id:"radar",tools:[{title:"炮瞄雷达",id:"PMLD-13500-10",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/PMLD-13500-10.png"},{title:"空基预警雷达",id:"KJYJLD-13400-10",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/KJYJLD-13400-10.png"},{title:"雷达情报站",id:"LDQBZ-13800-10",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/LDQBZ-13800-10.png"},{title:"陆基常规对空情报雷达",id:"LJCGDKQBLD-13300-10",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/LJCGDKQBLD-13300-10.png"}]},{name:"地导",id:"didao",tools:[{title:"地面导弹技术阵地",id:"52501--DMDDJSZD",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/52501--DMDDJSZD.png"},{title:"地下导弹技术阵地",id:"52500--DXDDJSZD",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/52500--DXDDJSZD.png"},{title:"陆基弹道式近程核导弹",id:"5900--LJDDSJCHDD",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/5900--LJDDSJCHDD.png"},{title:"海基弹道式近程导弹",id:"6100--HJDDSJCDD",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/6100--HJDDSJCDD.png"},{title:"空基巡航式近程导弹",id:"6300--KJXHSJCDD",type:"mark",positioning:"center-center",url:"assets/image/JB_Image/6300--KJXHSJCDD.png"}]},{name:"基本图元",id:"basic",tools:[{title:"点",id:"D-27-100",type:"mark",positioning:"bottom-center",url:"assets/image/JB_Image/D-27-100.png"},{title:"图钉记号",id:"TDJH-29-100",type:"mark",positioning:"bottom-center",url:"assets/image/JB_Image/TDJH-29-100.png"},{title:"十字记",id:"SZJ-30-100",type:"mark",positioning:"bottom-center",url:"assets/image/JB_Image/SZJ-30-100.png"},{title:"指北符",id:"ZBF-32-100",type:"mark",positioning:"bottom-center",url:"assets/image/JB_Image/ZBF-32-100.png"}]}]};var t=CGS_SDK_PATH+"assets/image/tool/marktool/marktooltitle.png";CgsTool.call(this,e,this.title,this.body),this.title.find(".CgsMarkTool__titleImg").attr("src",t);var u=this;this.onload=function(e){var t,i=(u.data=e).toolkits,s=u.body.find(".CgsMarkTool__classContainer");for(t in s.hide(),i){var o=i[t].name,a=$$("<p class='CgsMarkTool__class'>"+o+"</p>");s.append(a);var n,r=$$("<div class='CgsMarkTool__toolContainer'></div>");for(n in i[t].tools){var l=$$("<div class='CgsMarkTool__tool'><img class='CgsMarkTool__toolImage'/></div>");l.attr("data-type",i[t].tools[n].type),l.attr("title",i[t].tools[n].title),l.attr("data-positioning",i[t].tools[n].positioning),l.find("img").attr("src",CGS_SDK_PATH+i[t].tools[n].url),r.append(l),r.hide()}u.body.find(".CgsMarkTool__container").append(r),0==t&&(this.body.find(".CgsMarkTool__currentClassText").text(o),r.show())}},this.error=function(e){alert("error!",e)},this.onload(this.data),this.body.find(".CgsMarkTool__switchTab").click(function(){var e=$$(this);e.toggleClass("CgsMarkTool__switchTab_selected"),e.hasClass("CgsMarkTool__switchTab_selected")?u.body.find(".CgsMarkTool__classContainer").show():u.body.find(".CgsMarkTool__classContainer").hide()}),this.body.find(".CgsMarkTool__class").click(function(){var e=$$(this).index(),t=u.body.find(".CgsMarkTool__toolContainer");console.info(t),t.each(function(){$$(this).hide()}),u.body.find(".CgsMarkTool__currentClassText").text($$(this).text()),$$(t.get(e)).show()}),this.body.find(".CgsMarkTool__removeAll").click(function(){u.map.removeAllFeatureByMouse()}),this.body.delegate(".CgsMarkTool__tool","click",function(){var e=$$(this).children().attr("src");if(u.body.find(".CgsMarkTool__tool").removeClass("CgsMarkTool__tool_active"),u.drawTool){var t=u.drawTool.options.url;if(console.info(e,t),u.drawTool.deactivate(),u.drawTool=null,t==e)return}var i={mapObject:u.map,url:e,type:"MARK",positioning:$$(this).attr("data-positioning")};u.drawTool=new CgsDrawFeatureByMouse(i),u.drawTool.activate(),$$(this).addClass("CgsMarkTool__tool_active")})},CgsInherits(CgsMarkTool,CgsTool),CgsMeasureTool=function(e){this.map=e.mapObject;var t=this,i=void 0,i="3D"==e.mapObject.mode?"<div class='CgsMeasureTool'><div class='CgsMeasureTool__line CgsMeasureTool__lineActive'><span>距离测量</span></div><div class='CgsMeasureTool__line CgsMeasureTool__polygonActive'><span>面积测量</span></div><div class='CgsMeasureTool__line CgsMeasureTool__angleActive'><span>角度测量</span></div><div class='CgsMeasureTool__line CgsMeasureTool__lineVisibleActive'><span>两点通视</span></div><div class='CgsMeasureTool__line CgsMeasureTool__lineGradientActive'><span>两点坡度</span></div><div class='CgsMeasureTool__line CgsMeasureTool__polygonVisibleActive'><span>区域通视</span></div><div class='CgsMeasureTool__line CgsMeasureTool__lineProfileActive'><span>剖面分析</span></div><div class='CgsMeasureTool__line CgsMeasureTool__fillDigActive'><span>填挖方分析</span></div><div class='CgsMeasureTool__line CgsMeasureTool__floodActive'><span>淹没分析</span></div><div class='CgsMeasureTool__line CgsMeasureTool__visibiltyActive'><span>可视域分析</span></div><div class='CgsMeasureTool__line CgsMeasureTool__tileVisibiltyActive'><span>3Dtile可视域分析</span></div><div class='CgsMeasureTool__line CgsMeasureTool__slopeActive'><span>区域坡度分析</span></div><div class='CgsMeasureTool__line CgsMeasureTool__aspectActive'><span>区域坡向分析</span></div><div class='CgsMeasureTool__line CgsMeasureTool__lineDeactive'><span>停止测量</span></div><div class='CgsMeasureTool__line CgsMeasureTool__delete'><span>移除测量结果</span></div></div>":"<div class='CgsMeasureTool'><div class='CgsMeasureTool__line CgsMeasureTool__lineActive'><span>距离测量</span></div><div class='CgsMeasureTool__line CgsMeasureTool__polygonActive'><span>面积测量</span></div><div class='CgsMeasureTool__line CgsMeasureTool__angleActive'><span>角度测量</span></div><div class='CgsMeasureTool__line CgsMeasureTool__lineDeactive'><span>停止测量</span></div><div class='CgsMeasureTool__line CgsMeasureTool__delete'><span>移除测量结果</span></div></div>";this.body=$$(i);var s=$$(this.map.container),o=s.find(".cl").parent().get(0).offsetLeft+s.find(".cgstoolBarDiv").get(0).offsetLeft;s.append(this.body),this.body.css("left",o+3+"px"),this.body.find(".CgsMeasureTool__lineActive").click(function(e){$$("#cl").click(),t.AnalyzeTool&&(t.AnalyzeTool.deactivate(),t.AnalyzeTool.remove(),t.AnalyzeTool=null,t.cancelActive()),t.tool&&"LINE"==t.tool.getType()||(t.tool&&(t.tool.deactivate(),t.tool=null,t.cancelActive()),t.tool&&t.map.removeAllMeasureFeature(),t.tool=new CgsMeasure({mapObject:t.map,type:"LINE",mode:void 0}),t.tool.activate(),t.map.map3D&&(t.map.map3D.scene.globe.depthTestAgainstTerrain=!1),$$(this).addClass("CgsMeasureTool__line_select"))}),this.body.find(".CgsMeasureTool__polygonActive").click(function(e){$$("#cl").click(),t.AnalyzeTool&&(t.AnalyzeTool.deactivate(),t.AnalyzeTool.remove(),t.AnalyzeTool=null,t.cancelActive()),t.tool&&"POLYGON"==t.tool.getType()||(t.tool&&(t.tool.deactivate(),t.tool=null,t.cancelActive()),t.tool=new CgsMeasure({mapObject:t.map,type:"POLYGON"}),t.tool.activate(),t.map.map3D&&(t.map.map3D.scene.globe.depthTestAgainstTerrain=!1),$$(this).addClass("CgsMeasureTool__line_select"))}),this.body.find(".CgsMeasureTool__angleActive").click(function(e){$$("#cl").click(),t.AnalyzeTool&&(t.AnalyzeTool.deactivate(),t.AnalyzeTool.remove(),t.AnalyzeTool=null,t.cancelActive()),t.tool&&"ANGLE"==t.tool.getType()||(t.tool&&(t.tool.deactivate(),t.tool=null,t.cancelActive()),t.tool=new CgsMeasure({mapObject:t.map,type:"ANGLE"}),t.tool.activate(),t.map.map3D&&(t.map.map3D.scene.globe.depthTestAgainstTerrain=!1),$$(this).addClass("CgsMeasureTool__line_select"))}),this.body.find(".CgsMeasureTool__lineVisibleActive").click(function(e){$$("#cl").click(),t.tool&&(t.tool.deactivate(),t.map.removeAllMeasureFeature(),t.tool=null,t.cancelActive()),t.AnalyzeTool&&t.AnalyzeTool.getType()!==CgsAnalyze.VISIBLE_LINE&&t.AnalyzeTool.setType(CgsAnalyze.VISIBLE_LINE),t.AnalyzeTool?(t.cancelActive(),t.AnalyzeTool.deactivate()):t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.VISIBLE_LINE}),t.AnalyzeTool.activate(),t.map.map3D.scene.globe.depthTestAgainstTerrain=!0,$$(this).addClass("CgsMeasureTool__line_select")}),this.body.find(".CgsMeasureTool__lineGradientActive").click(function(e){$$("#cl").click(),t.tool&&(t.tool.deactivate(),t.map.removeAllMeasureFeature(),t.tool=null,t.cancelActive()),t.AnalyzeTool&&t.AnalyzeTool.getType()!==CgsAnalyze.GRADIENT_ANALYZE&&t.AnalyzeTool.setType(CgsAnalyze.GRADIENT_ANALYZE),t.AnalyzeTool?(t.cancelActive(),t.AnalyzeTool.deactivate()):t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.GRADIENT_ANALYZE}),t.AnalyzeTool.activate(),t.map.map3D.scene.globe.depthTestAgainstTerrain=!0,$$(this).addClass("CgsMeasureTool__line_select")}),this.body.find(".CgsMeasureTool__polygonVisibleActive").click(function(e){$$("#cl").click(),t.tool&&(t.tool.deactivate(),t.map.removeAllMeasureFeature(),t.tool=null,t.cancelActive()),t.AnalyzeTool&&t.AnalyzeTool.getType()!==CgsAnalyze.VISIBLE_POLYGON&&t.AnalyzeTool.setType(CgsAnalyze.VISIBLE_POLYGON),t.AnalyzeTool?(t.cancelActive(),t.AnalyzeTool.deactivate()):t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.VISIBLE_POLYGON}),t.AnalyzeTool.activate(),t.map.map3D.scene.globe.depthTestAgainstTerrain=!0,$$(this).addClass("CgsMeasureTool__line_select")}),this.body.find(".CgsMeasureTool__lineProfileActive").click(function(e){$$("#cl").click(),t.tool&&(t.tool.deactivate(),t.map.removeAllMeasureFeature(),t.tool=null,t.cancelActive()),t.AnalyzeTool&&t.AnalyzeTool.getType()!==CgsAnalyze.PROFILE_ANALYZE&&t.AnalyzeTool.setType(CgsAnalyze.PROFILE_ANALYZE),t.AnalyzeTool?(t.cancelActive(),t.AnalyzeTool.deactivate()):t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.PROFILE_ANALYZE}),t.AnalyzeTool.activate(),t.map.map3D.scene.globe.depthTestAgainstTerrain=!0,$$(this).addClass("CgsMeasureTool__line_select")}),this.body.find(".CgsMeasureTool__fillDigActive").click(function(e){$$("#cl").click(),t.tool&&(t.tool.deactivate(),t.map.removeAllMeasureFeature(),t.tool=null,t.cancelActive()),t.AnalyzeTool&&t.AnalyzeTool.getType()!==CgsAnalyze.FILLDIG_ANALYZE&&t.AnalyzeTool.setType(CgsAnalyze.FILLDIG_ANALYZE),t.AnalyzeTool?(t.cancelActive(),t.AnalyzeTool.deactivate()):t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.FILLDIG_ANALYZE}),t.AnalyzeTool.activate(),t.map.map3D.scene.globe.depthTestAgainstTerrain=!0,$$(this).addClass("CgsMeasureTool__line_select")}),this.body.find(".CgsMeasureTool__slopeActive").click(function(e){$$("#cl").click(),t.tool&&(t.tool.deactivate(),t.map.removeAllMeasureFeature(),t.tool=null,t.cancelActive()),t.AnalyzeTool&&t.AnalyzeTool.getType()!==CgsAnalyze.SLOPE_ANALYZE&&t.AnalyzeTool.setType(CgsAnalyze.SLOPE_ANALYZE),t.AnalyzeTool?(t.cancelActive(),t.AnalyzeTool.deactivate()):t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.SLOPE_ANALYZE}),t.AnalyzeTool.activate(),t.map.map3D.scene.globe.depthTestAgainstTerrain=!0,$$(this).addClass("CgsMeasureTool__line_select")}),this.body.find(".CgsMeasureTool__aspectActive").click(function(e){$$("#cl").click(),t.tool&&(t.tool.deactivate(),t.map.removeAllMeasureFeature(),t.tool=null,t.cancelActive()),t.AnalyzeTool&&t.AnalyzeTool.getType()!==CgsAnalyze.ASPECT_ANALYZE&&t.AnalyzeTool.setType(CgsAnalyze.ASPECT_ANALYZE),t.AnalyzeTool?(t.cancelActive(),t.AnalyzeTool.deactivate()):t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.ASPECT_ANALYZE}),t.AnalyzeTool.activate(),t.map.map3D.scene.globe.depthTestAgainstTerrain=!0,$$(this).addClass("CgsMeasureTool__line_select")}),this.body.find(".CgsMeasureTool__floodActive").click(function(e){$$("#cl").click(),t.tool&&(t.tool.deactivate(),t.map.removeAllMeasureFeature(),t.tool=null,t.cancelActive()),t.AnalyzeTool&&t.AnalyzeTool.getType()!==CgsAnalyze.FLOOD_ANALYZE&&t.AnalyzeTool.setType(CgsAnalyze.FLOOD_ANALYZE),t.AnalyzeTool?(t.cancelActive(),t.AnalyzeTool.deactivate()):t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.FLOOD_ANALYZE}),t.AnalyzeTool.activate(),t.map.map3D.scene.globe.depthTestAgainstTerrain=!0,$$(this).addClass("CgsMeasureTool__line_select")}),this.body.find(".CgsMeasureTool__visibiltyActive").click(function(e){$$("#cl").click(),t.tool&&(t.tool.deactivate(),t.map.removeAllMeasureFeature(),t.tool=null,t.cancelActive()),t.AnalyzeTool&&t.AnalyzeTool.getType()!==CgsAnalyze.VISIBILITY_ANALYZE&&t.AnalyzeTool.setType(CgsAnalyze.VISIBILITY_ANALYZE),t.AnalyzeTool?(t.cancelActive(),t.AnalyzeTool.deactivate()):t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.VISIBILITY_ANALYZE}),t.AnalyzeTool.activate(),t.map.map3D.scene.globe.depthTestAgainstTerrain=!0,$$(this).addClass("CgsMeasureTool__line_select")}),this.body.find(".CgsMeasureTool__tileVisibiltyActive").click(function(e){$$("#cl").click(),t.tool&&(t.tool.deactivate(),t.map.removeAllMeasureFeature(),t.tool=null,t.cancelActive()),t.AnalyzeTool&&t.AnalyzeTool.getType()!==CgsAnalyze.VIEWSHED_ANALYZE&&t.AnalyzeTool.setType(CgsAnalyze.VIEWSHED_ANALYZE),t.AnalyzeTool?(t.cancelActive(),t.AnalyzeTool.deactivate()):t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.VIEWSHED_ANALYZE}),t.AnalyzeTool.activate(),t.map.map3D.scene.globe.depthTestAgainstTerrain=!0,$$(this).addClass("CgsMeasureTool__line_select")}),this.body.find(".CgsMeasureTool__lineDeactive").click(function(e){$$("#cl").click(),t.tool&&t.tool.deactivate(),t.AnalyzeTool&&t.AnalyzeTool.deactivate(),t.tool=null,t.cancelActive()}),this.body.find(".CgsMeasureTool__delete").click(function(e){$$("#cl").click(),t.map.removeAllMeasureFeature(),t.AnalyzeTool&&(t.AnalyzeTool.deactivate(),t.AnalyzeTool.remove(),t.AnalyzeTool=null),t.cancelActive(),t.body.find(".CgsMeasureTool__lineActive").removeClass("CgsMeasureTool__line_select")}),"3D"==t.map.mode&&(t.AnalyzeTool=new CgsAnalyze({mapObject:t.map,type:CgsAnalyze.PROFILE_ANALYZE}),t.AnalyzeTool.analyzeTool3D._analyzeObj._gradientTool=new CgsGradientTool3D(t.map),t.AnalyzeTool.analyzeTool3D._analyzeObj._gradientTool.activate(),CgsSubPub.publish("gradientAnalyze",[[100]]))},CgsMeasureTool.prototype.cancelActive=function(){this.body.find(".CgsMeasureTool__lineActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__polygonActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__angleActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__lineVisibleActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__lineGradientActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__polygonVisibleActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__lineProfileActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__fillDigActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__floodActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__visibiltyActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__slopeActive").removeClass("CgsMeasureTool__line_select"),this.body.find(".CgsMeasureTool__aspectActive").removeClass("CgsMeasureTool__line_select")},CgsMeasureTool.prototype.deactivate=function(){this.body.hide(),this.tool&&this.tool.deactivate(),this.AnalyzeTool&&this.AnalyzeTool.deactivate(),this.cancelActive()},CgsMeasureTool.prototype.activate=function(){this.body.show()},CgsDrawFeatureByMouseTool=function(e){this.map=e.mapObject;var i=this;this.body=$$("<div class='CgsDrawFeatureByMouseTool'><div class='CgsDrawFeatureByMouseTool__row' id='CgsDrawFeatureByMouseTool__point'>绘制点</div><div class='CgsDrawFeatureByMouseTool__row' id='CgsDrawFeatureByMouseTool__line'>绘制线</div><div class='CgsDrawFeatureByMouseTool__row' id='CgsDrawFeatureByMouseTool__rect'>绘制矩形</div><div class='CgsDrawFeatureByMouseTool__row' id='CgsDrawFeatureByMouseTool__circle'>绘制圆</div><div class='CgsDrawFeatureByMouseTool__row' id='CgsDrawFeatureByMouseTool__polygon'>绘制多边形</div><div class='CgsDrawFeatureByMouseTool__row' id='CgsDrawFeatureByMouseTool__deactivate'>停止绘制</div><div class='CgsDrawFeatureByMouseTool__row' id='CgsDrawFeatureByMouseTool__delete'>移除所有绘制结果</div></div>");var t=$$(this.map.container),s=t.find(".hzty").parent().get(0).offsetLeft+t.find(".cgstoolBarDiv").get(0).offsetLeft;t.append(this.body),this.body.hide(),this.body.css("left",s+3+"px"),this.tool=null,this.body.click(function(e){var t="";switch(e.target.id){case"CgsDrawFeatureByMouseTool__point":i.tool&&i.tool.deactivate(),t="POINT";break;case"CgsDrawFeatureByMouseTool__line":i.tool&&i.tool.deactivate(),t="LINE";break;case"CgsDrawFeatureByMouseTool__rect":i.tool&&i.tool.deactivate(),t="RECT";break;case"CgsDrawFeatureByMouseTool__circle":i.tool&&i.tool.deactivate(),t="CIRCLE";break;case"CgsDrawFeatureByMouseTool__polygon":i.tool&&i.tool.deactivate(),t="POLYGON";break;case"CgsDrawFeatureByMouseTool__deactivate":i.tool&&i.tool.deactivate();break;case"CgsDrawFeatureByMouseTool__delete":i.map.removeAllFeatureByMouse()}""!=t?(i.tool=new CgsDrawFeatureByMouse({type:t,mapObject:i.map}),i.tool.activate(),i.body.find(".CgsDrawFeatureByMouseTool__row_select").removeClass("CgsDrawFeatureByMouseTool__row_select"),$$(e.target).addClass("CgsDrawFeatureByMouseTool__row_select")):i.body.find(".CgsDrawFeatureByMouseTool__row_select").removeClass("CgsDrawFeatureByMouseTool__row_select")})},CgsDrawFeatureByMouseTool.prototype.deactivate=function(){this.body.hide(),this.tool&&(this.tool.deactivate(),this.body.find(".CgsDrawFeatureByMouseTool__row_select").removeClass("CgsDrawFeatureByMouseTool__row_select"))},CgsDrawFeatureByMouseTool.prototype.activate=function(){this.body.show()},CgsLocateTool=function(l){this.map=l;var u=this;this.body=$$("<div class='CgsLocateTool'><div class='CgsLocateTool_label' >经度</div><input class='CgsLocateTool_value' type = 'text' id = 'lonLocate' value = '116.496'></input><div class='CgsLocateTool_label' >纬度</div><input class='CgsLocateTool_value' type = 'text' id = 'latLocate' value = '39.890'></input><div class='CgsLocateTool_label' >级别</div><input class='CgsLocateTool_value' type = 'text' id = 'heiLocate' value = '5'></input><button class='CgsLocateTool__btn CgsLocateTool__btnActive'>确定</button></div>");var e=$$(l.container),t=t||e.find(".pdw").parent().get(0).offsetLeft+e.find(".cgstoolBarDiv").get(0).offsetLeft-300;this.body.css("left",t+"px"),e.append(this.body),this.body.find(".CgsLocateTool__btnActive").click(function(e){var t,i,s,o,a,n,r;u.tool||(t=document.getElementById("lonLocate").value,i=document.getElementById("latLocate").value,s=document.getElementById("heiLocate").value,o=parseFloat(t),a=parseFloat(i),n=parseFloat(s),!t||isNaN(o)||o<-180||180<o||!i||isNaN(a)||a<-90||90<a||s&&isNaN(n)||(r=l.map2D.getResolutionByZoom(n)*CGS_DOTS_PER_INCH*CGS_INCHES_PER_METER*CGS_HEIGHT_TO_SCALE,l.flyTo({destination:[o,a,r]})))})},CgsLocateTool.prototype.deactivate=function(){CgsUtil.defined(this.body)&&this.body.hide()},CgsLocateTool.prototype.activate=function(){CgsUtil.defined(this.body)&&this.body.show()},CgsSaveAsImageTool=function(r){this.map=r;this.body=$$("<div class='CgsLocateTool'><div class='CgsLocateTool_label' >级别</div><input class='CgsLocateTool_value' type = 'text' id = 'heiSaveAsImage' value = '5'></input><button class='CgsLocateTool__btn CgsLocateTool__btnActive CgsSaveAsImageTool__btnActive'>开始选择区域</button></div>");var e=$$(r.container),t=e.find(".jbjt").parent().get(0).offsetLeft+e.find(".cgstoolBarDiv").get(0).offsetLeft;e.append(this.body),this.body.css("left",t+"px");var l=this;this.body.find(".CgsSaveAsImageTool__btnActive").click(function(e){l.selectRegion&&l.deactivateSelect(),l.selectRegion=new CgsSelectRegion({mapObject:l.map,type:"RECT"}),l.eventId=CgsSubPub.subscribe("selectend",function(e,t){var i=Math.min(t[0][0],t[2][0]),s=Math.max(t[0][0],t[2][0]),o=Math.min(t[0][1],t[2][1]),a=Math.max(t[0][1],t[2][1]),n=document.getElementById("heiSaveAsImage").value;n&&isNaN(parseInt(n))||r.saveMapInExtentAndLevelAsImage({extent:[i,o,s,a],level:parseInt(n)}),l.deactivateSelect()}),l.selectRegion.activate()})},CgsSaveAsImageTool.prototype.deactivateSelect=function(){this.selectRegion.deactivate(),CgsSubPub.unsubscribe(this.eventId),this.selectRegion=null},CgsSaveAsImageTool.prototype.deactivate=function(){CgsUtil.defined(this.body)&&this.body.hide()},CgsSaveAsImageTool.prototype.activate=function(){CgsUtil.defined(this.body)&&this.body.show()},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/drawTool/drawTool.css"/>'),CgsDrawTool=function(e){this.map=e.map,this.hitTolerance=map.getHitTolerance(),this.offset=e.offset?e.offset:[1030,583],this.draggable=!e.draggable||e.draggable,this.selectFeature=null,this.eventList=[];this.body=$$('\n\t\t<div class = \'CgsDrawTool_body\'>\n\t\t\t\t<div class=\'CgsDrawTool_topbox\'>\n\t\t\t\t\t<div class = "CgsDrawTool_topbox_outImg">\n\t\t\t\t\t\t<div id="CGS_POINT_BIAOZHU_ID" class = "CgsDrawTool_topbox_pointButton"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="CgsDrawTool_topbox_outLineImg">\n\t\t\t\t\t\t<div id="CGS_LINE_BIAOZHU_ID" class = "CgsDrawTool_topbox_lineButton"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="CgsDrawTool_topbox_outLineImg">\n\t\t\t\t\t\t<div id="CGS_POLYGON_BIAOZHU_ID" class = "CgsDrawTool_topbox_mianButton"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="CgsDrawTool_topbox_outLineImg">\n\t\t\t\t\t\t<div id="CGS_RECT_BIAOZHU_ID" class = "CgsDrawTool_topbox_rectButton"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="CgsDrawTool_topbox_outLineImg">\n\t\t\t\t\t\t<div id="CGS_CIRCLE_BIAOZHU_ID" class = "CgsDrawTool_topbox_circleButton"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class = "CgsDrawTool_topbox_textButtonBox">\n\t\t\t\t\t\t\t<div class="CgsDrawTool_topbox_outTextImg">\n\t\t\t\t\t\t\t\t<div id="CGS_TEXT_BIAOZHU_ID" class = "CgsDrawTool_topbox_textButton"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t<div class = "CgsDrawTool_topbox_labelBox">\t\n\t\t\t\t\t\t<div class = "CgsDrawTool_topbox_pointLabelbutton">点</div>\n\t\t\t\t\t\t<div class = "CgsDrawTool_topbox_labelbutton">线</div>\n\t\t\t\t\t\t<div class = "CgsDrawTool_topbox_labelbutton">面</div>\n\t\t\t\t\t\t<div class = "CgsDrawTool_topbox_labelbutton">矩形</div>\n\t\t\t\t\t\t<div class = "CgsDrawTool_topbox_labelbutton">圆</div>\n\t\t\t\t\t\t<div class = "CgsDrawTool_topbox_textLabelbutton">文本</div>\n\t\t\t\t\t\t<div class = "CgsDrawTool_topbox_buttonLine"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\'CgsDrawTool_bottombox\'>\n\t\t\t\t\t<div id="CGS_POSITION_ID" class = "CgsDrawTool_bottombox_handle">位置编辑</div>\n\t\t\t\t\t<div id="CGS_ATTRIBUTE_ID" class = "CgsDrawTool_bottombox_handle">属性编辑</div>\n\t\t\t\t\t<div id="CGS_IMPORT_ID" class = "CgsDrawTool_bottombox_handle">导入</div>\n\t\t\t\t\t<div id="CGS_EXPORT_ID" class = "CgsDrawTool_bottombox_handle">导出</div>\n\t\t\t\t\t<div id="CGS_CLEAR_ID" class = "CgsDrawTool_bottombox_handle">清除</div>\n\t\t\t\t</div>\n\t\t</div>    \n        '),$$(map.container).append(this.body),this.draggable&&this.body.draggable();var a=this;this.offset&&(this.body[0].style.left=this.offset[0]+"px",this.body[0].style.top=this.offset[1]+"px"),this.dfbm=new CgsDrawByMouse({map:map,createOptions:{fillColor:"rgba(200,200,200,0.5)",width:4},editPointStyle:{pixelSize:10,labelfont:"10px 微软雅黑"}}),$$(document.getElementById("CGS_CLEAR_ID")).click(function(e){a.tool&&a.tool.deactivate(),a.event&&(CgsSubPub.unsubscribe(a.event1),a.event1=null),a.closeAttributeEdit(),a.closePositionEdit(),a.map.allFeatures.slice().forEach(function(e){e._drawByFeatureTool&&a.map.removeFeature(e)})});var t=document.onkeydown;document.onkeydown=function(e){46==e.keyCode&&a.selectedFeature&&(map.removeFeature(a.selectedFeature),a.selectedFeature=null),t&&t(e)},setTimeout(function(){a.drawEndEvent=CgsSubPub.subscribe("featuredrawnbymouse",function(e,t){a.overlay&&(a.map.removeOverlay(a.overlay),a.overlay=null),t instanceof CgsLine||a.setNameToCenter(t),t.setPickColorFlag(!1)});for(var e=a.body[0].children[0].children,t=a.body[0].children[1].children,i=0;i<e.length-1;i++)$$(e[i].children[0]).click(function(e){a.domClickEvent(e)});$$(e[e.length-2].children[0].children[0]).click(function(e){a.domClickEvent(e)});for(var s=0;s<t.length-1;s++)$$(t[s]).click(function(e){a.domClickEvent(e)});var o=new FileReader;o.onload=function(){this.result;var e=this.result,t=JSON.parse(e);a.importJsonFile(t)},inputF=$$(t[2]),inputF.change(function(){var e=this.files[0];o.readAsText(e)})},400)},CgsDrawTool.prototype.domClickEvent=function(e){var t=e.currentTarget.id,i="",a=this,s={mapObject:a.map};switch("CGS_POSITION_ID"!==t&&"CGS_ATTRIBUTE_ID"!==t&&(this.closeAttributeEdit(),this.closePositionEdit()),t){case"CGS_POINT_BIAOZHU_ID":a.tool&&a.tool.deactivate(),i="POINT",s.fillColor="rgba(71,199,207,0.2)",s.pixelSize=5,s.outlineColor="rgba(71,203,212,1)",s.outlineWidth=2;break;case"CGS_TEXT_BIAOZHU_ID":a.tool&&a.tool.deactivate(),i="TEXT";break;case"CGS_LINE_BIAOZHU_ID":a.tool&&a.tool.deactivate(),i="LINE",s.fillColor="rgba(71,203,212,1)",s.width=2,s.outlineWidth=2,s.outlineColor="rgba(255,255,0,1)";break;case"CGS_POLYGON_BIAOZHU_ID":a.tool&&a.tool.deactivate(),i="POLYGON",s.fillColor="rgba(71,199,207,0.2)",s.outlineWidth=1,s.outlineColor="rgba(71,203,212,1)";break;case"CGS_RECT_BIAOZHU_ID":a.tool&&a.tool.deactivate(),i="RECT",s.fillColor="rgba(71,199,207,0.2)",s.outlineWidth=1,s.outlineColor="rgba(71,203,212,1)";break;case"CGS_CIRCLE_BIAOZHU_ID":a.tool&&a.tool.deactivate(),i="CIRCLE",s.fillColor="rgba(71,199,207,0.2)",s.outlineWidth=1,s.outlineColor="rgba(71,203,212,1)";break;case"CGS_POSITION_ID":a.tool&&a.tool.deactivate(),"CgsDrawTool_bottombox_handle"==$$("#CGS_POSITION_ID")[0].className?(a.closeAttributeEdit(),a.openPositionEdit()):a.closePositionEdit();break;case"CGS_ATTRIBUTE_ID":a.tool&&a.tool.deactivate(),"CgsDrawTool_bottombox_handle"==$$("#CGS_ATTRIBUTE_ID")[0].className?(a.closePositionEdit(),a.openAttributeEdit()):a.closeAttributeEdit();break;case"CGS_IMPORT_ID":a.importJsonFileString();break;case"CGS_EXPORT_ID":a.tool&&a.tool.deactivate(),a.saveAsJson();break;case"CGS_CLEAR_ID":a.tool&&a.tool.deactivate(),a.event&&(CgsSubPub.unsubscribe(a.event1),a.event1=null),a.map.removeAllFeatures()}if(""!=(s.type=i)){if("TEXT"==i)return a.tool&&a.tool.deactivate(),void(a.textDrawEvent=CgsSubPub.subscribe(CgsEvent.eFeatureClickOut,function(e,t,i){var s={position:a.map.pixelToLonLat(i),name:"",labelfont:"22px 微软雅黑 ",labelfill:"rgba(255,255,255,1.0)",labeloffset:[0,-15]},o=new CgsLabel(s);a.map.addFeature(o),o.isDrawToolFeature=!0,a.setNote(o),CgsSubPub.unsubscribe(a.textDrawEvent)}));s.assistantCoordinateShow=!0,s.processAssistantFlag=!0,s.once=!0,s.drawEndCallback=function(e,t){t._drawByFeatureTool=!0},a.tool=new CgsDrawFeatureByMouse(s),a.tool.activate()}},CgsDrawTool.prototype.openPositionEdit=function(){var n=this;$$("#CGS_POSITION_ID")[0].className="CgsDrawTool_bottombox_handle_selected",this.editFeatures=map.featuresDrawedByMouse?map.featuresDrawedByMouse:[];var e=!0,t=!1,i=void 0;try{for(var s,o=this.editFeatures[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){var a=s.value;CgsDrawByMouse.addFeatureToTool(this.dfbm,a)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this.dfbm.setEnableEditMode({enable:!0}),this.eventList.push(CgsSubPub.subscribe("elementMoveStart",function(e,t,i,s){s instanceof CgsPoint3D&&s.setFillColor("rgba(0,0,0,1)");var o=s.getPosition(),a={pixelSize:6,labelfont:"10px 微软雅黑",fillColor:"rgba(0,255,0,1)",position:[o[0],o[1]]};n.point=new CgsPoint(a),n.map.addFeature(n.point)})),this.eventList.push(CgsSubPub.subscribe("elementMoveFinish",function(e,t,i){i.setFillColor("rgba(0,255,0,1)"),n.point&&(n.map.removeFeature(n.point),n.point=null)}))},CgsDrawTool.prototype.openAttributeEdit=function(){var o=this;$$("#CGS_ATTRIBUTE_ID")[0].className="CgsDrawTool_bottombox_handle_selected",this.editFeatures=map.featuresDrawedByMouse?map.featuresDrawedByMouse:[],this.eventList.push(CgsSubPub.subscribe("featureclick",function(e,t){if(o.lastTime){var i=(new Date).getTime();console.log(i-o.lastTime);var s=i-o.lastTime;if(o.lastTime=i,s<500){if(!(t instanceof CgsLabel)&&-1==o.editFeatures.indexOf(t))return;t!=o.selectedFeature&&o.selectedFeature&&o.selectedFeature.editOverlay&&CgsUtil.removeAttributeEdit(o.selectedFeature),(o.selectedFeature=t).editOverlay||CgsUtil.addAttributeEdit(t)}}else o.lastTime=(new Date).getTime()}))},CgsDrawTool.prototype.closePositionEdit=function(e){$$("#CGS_POSITION_ID")[0].className="CgsDrawTool_bottombox_handle",this.dfbm.setEnableEditMode({enable:!1})},CgsDrawTool.prototype.closeAttributeEdit=function(e){$$("#CGS_ATTRIBUTE_ID")[0].className="CgsDrawTool_bottombox_handle",this.selectedFeature&&(CgsUtil.removeAttributeEdit(this.selectedFeature),this.selectedFeature=null);var t=!0,i=!1,s=void 0;try{for(var o,a=this.eventList[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var n=o.value;CgsSubPub.unsubscribe(n)}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}this.eventList=[]},CgsDrawTool.prototype.saveAsJson=function(){var e=CgsUtil.exportAsString(this.map.allFeatures),t=new Blob([e]);saveAs(t,"feature"+(new Date).getTime()+".json")},CgsDrawTool.prototype.importJsonFileString=function(){var s=this;CgsUtil.openLoadFileWindow({accept:".json"}).then(function(e){try{var t=e.result,i=CgsUtil.importStringFile(t);s.map.featuresDrawedByMouse=[].concat(_toConsumableArray(map.featuresDrawedByMouse),_toConsumableArray(i))}catch(e){console.log(e)}})},CgsDrawTool.prototype.setNote=function(i){!i||!i.setLabelFillColor||i instanceof CgsLabel||i.setLabelFillColor("rgba(255,255,255,1.0)");var s=this;i.isDrawToolFeature=!0,i.appendExplain="";var e=$('\n\t\t<div class = \'CgsDrawTool_infoBox\'>\n\t\t\t\t<div class=\'CgsDrawTool_infoBox_top\'>\n\t\t\t\t\t<div class = "CgsDrawTool_infoBox_top_title">标注</div>\n\t\t\t\t\t<div class="CgsDrawTool_infoBox_top_close"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\'CgsDrawTool_infoBox_body\'>\n\t\t\t\t\t<div class=\'CgsDrawTool_infoBox_center\'>\n\t\t\t\t\t\t<div class = "CgsDrawTool_infoBox_center_title">注记文本</div>\n\t\t\t\t\t\t<input class = "CgsDrawTool_infoBox_center_input"></input>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\'CgsDrawTool_infoBox_botton\'>\n\t\t\t\t\t\t<div class = "CgsDrawTool_infoBox_center_title_textarea">附加说明</div>\n\t\t\t\t\t\t<textarea class = "CgsDrawTool_infoBox_botton_textarea"></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\'CgsDrawTool_infoBox_fundus\'>\n\t\t\t\t\t\t<div title="保存" class = "CgsDrawTool_infoBox_fundus_save"></div>\n\t\t\t\t\t\t<div title="清空" class = "CgsDrawTool_infoBox_fundus_clear"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t</div>    \n        ').get(0),t=0;if((r=i.getPosition())[0]instanceof Array&&1==r.length&&(t=(r=r[0]).length),r[0]instanceof Array){for(var o=90,a=0,n=0;n<t;n++)r[n][1]<o&&(o=r[n][1],a=n);var r=r[a]}s.overlay=new CgsOverlay({position:r,positioning:"top-left",element:e,offset:[15,15],draggable:!0,showLine:!0}),this.map.addOverlay(s.overlay);var l=e.children[0].children[1],u=e.children[1].children[2].children[0],p=e.children[1].children[2].children[1],h=e.children[1].children[0].children[1],c=e.children[1].children[1].children[1],g=e.children[0].children[0];$$(l).click(function(e){s.map.removeOverlay(s.overlay),s.overlay=null}),$$(u).click(function(e){var t=$$(h).val();i.setName(t),i instanceof CgsLabel||(i.setLabelScale(.8),i.setLabelOffset([0,20]),i.showLine(!0),i.setLabelDraggable(!0)),i._drawByFeatureTool=!0,i.appendExplain=$$(c).val(),s.map.removeOverlay(s.overlay)}),$$(p).click(function(e){$$(h).val(""),$$(c).val("")}),$$(h).click(function(e){s.overlay.setDraggable(!1),$$(h).focus()}),$$(c).click(function(e){s.overlay.setDraggable(!1),$$(c).focus()}),$$(g).mousedown(function(e){s.overlay.setDraggable(!0),$$(c).blur(),$$(h).blur()}),setTimeout(function(){$$(h).focus()},400)},CgsDrawTool.prototype.saveAsObject=function(){for(var e=[],t=0;t<this.map.allFeatures.length;t++){var i,s=this.map.allFeatures[t];s.isDrawToolFeature&&(i={position:this.arrToString(s.getPosition()),name:s.getName(),appendExplain:s.appendExplain,Radius:s.getRadius?s.getRadius():void 0,type:s.getType()},e.push(i))}return{features:e}},CgsDrawTool.prototype.importJsonFile=function(e){$$(document.getElementById("CGS_INPUT_ID")).attr("type","text"),$$(document.getElementById("CGS_INPUT_ID")).attr("type","file");for(var t,i,s=this.map,e=e.features,o=0;o<e.length;o++){"CgsPoint"==e[o].type?(t={name:e[o].name,position:this.stringToArr(e[o].position),fillColor:"rgba(71,199,207,0.2)",pixelSize:5,outlineColor:"rgba(71,203,212,1)",outlineWidth:2},i=new CgsPoint(t),s.addFeature(i),i.setFont("24px 微软雅黑"),i.setLabelFillColor("rgba(255,255,255,1.0)")):"CgsLabel"==e[o].type?(t={position:this.stringToArr(e[o].position),name:e[o].name,labelfont:"22px 微软雅黑 ",labelfill:"rgba(255,255,255,1.0)",labeloffset:[0,-15]},i=new CgsLabel(t),s.addFeature(i)):"CgsLine"==e[o].type?(t=_defineProperty({name:e[o].name,positions:this.stringToArr(e[o].position),followSurface:!1,width:1,fillColor:"rgba(71,203,212,1)"},"width",2),i=new CgsLine(t),s.addFeature(i)):"CgsPolygon"==e[o].type?(t={name:e[o].name,positions:this.stringToArr(e[o].position),fillColor:"rgba(71,199,207,0.2)",outlineWidth:1,outlineColor:"rgba(71,203,212,1)"},i=new CgsPolygon(t),s.addFeature(i),this.setNameToCenter(i)):"CgsRect"==e[o].type?(t={name:e[o].name,positions:this.stringToArr(e[o].position),fillColor:"rgba(71,199,207,0.2)",outlineWidth:1,outlineColor:"rgba(71,203,212,1)"},i=new CgsRect(t),s.addFeature(i),this.setNameToCenter(i)):"CgsCircle"==e[o].type&&(t={position:this.stringToArr(e[o].position),name:e[o].name,radius:parseFloat(e[o].Radius),fillColor:"rgba(71,199,207,0.2)",outlineWidth:1,outlineColor:"rgba(71,203,212,1)"},i=new CgsCircle(t),s.addFeature(i)),i instanceof CgsLabel||i.setLabelFillColor("rgba(255,255,255,1.0)"),e[o]&&e[o].appendExplain&&(i.appendExplain=e[o].appendExplain),i.isDrawToolFeature=!0,i.setLabelDraggable(!0),i.showLine(!0),i.setPickColorFlag(!1)}},CgsDrawTool.prototype.arrToString=function(e){var t="";if(e[0]instanceof Array){e[0][0]instanceof Array&&(e=e[0]);for(var i=0;i<e.length;i++)t=i==e.length-1?t+e[i][0]+","+e[i][1]:t+e[i][0]+","+e[i][1]+","}else t=e[0]+","+e[1];return t},CgsDrawTool.prototype.stringToArr=function(e){var t=e.split(","),i=[];if(2==t.length)i=[parseFloat(t[0]),parseFloat(t[1])];else if(3!=t.length||t[0]instanceof Array)for(var s=0;s<t.length;s+=2)i.push([parseFloat(t[s]),parseFloat(t[s+1])]);else i=[parseFloat(t[0]),parseFloat(t[1])];return i},CgsDrawTool.prototype.removeFeature=function(){for(var e=this.map.allFeatures.length-1;-1<e;e--){var t=this.map.allFeatures[e];t.isDrawToolFeature&&this.map.removeFeature(t)}this.overlay&&(this.map.removeOverlay(this.overlay),this.overlay=null)},CgsDrawTool.prototype.selectFeature=function(){var o=this;this.event1?(CgsSubPub.unsubscribe(this.event1),this.event1=null,o.selectedFeature instanceof CgsLabel||o.selectedFeature&&o.selectedFeature.setLabelOutlineColor("rgba(255,255,255,1.0)"),o.selectedFeature&&o.selectedFeature.setOutlineColor("rgba(71,203,212,1)"),o.selectedFeature instanceof CgsLine&&o.selectedFeature.setFillColor("rgba(71,203,212,1)")):this.event1=CgsSubPub.subscribe(CgsEvent.eFeatureClick,function(e,t,i,s){if(t.isDrawToolFeature)switch(o.selectedFeature&&o.selectedFeature!=t&&(o.selectedFeature instanceof CgsLabel||o.selectedFeature&&o.selectedFeature.setLabelOutlineColor("rgba(255,255,255,1.0)"),o.selectedFeature&&o.selectedFeature.setOutlineColor("rgba(71,203,212,1)"),o.selectedFeature instanceof CgsLine&&o.selectedFeature.setFillColor("rgba(71,203,212,1)")),t.getType()){case"CgsPoint":(o.selectedFeature=t).setOutlineColor("rgba(255,255,0,1)"),t.setLabelOutlineColor("rgba(255,255,0,1)");break;case"CgsLabel":(o.selectedFeature=t).setOutlineColor("rgba(255,255,0,1)");break;case"CgsLine":(o.selectedFeature=t).setFillColor("rgba(255,255,0,1)"),t.setLabelOutlineColor("rgba(255,255,0,1)");break;case"CgsPolygon":case"CgsRect":case"CgsCircle":(o.selectedFeature=t).setOutlineColor("rgba(255,255,0,1)"),t.setLabelOutlineColor("rgba(255,255,0,1)")}})},CgsDrawTool.prototype.setNameToCenter=function(e){var t=e.getPosition();if(t[0]instanceof Array){var i=0,s=0;if(t[0]instanceof Array&&1==t.length&&(t=t[0]),t[0]instanceof Array)for(var o=0;o<t.length;o++)i+=t[o][0],s+=t[o][1];i/=t.length,s/=t.length,e.setNamePosition([i,s]),e.setLabelOffset([-1,1])}},CgsDrawTool.prototype.setFeatureStyle=function(e){switch(e.getType()){case"CgsPoint":break;case"CgsLabel":(this.selectedFeature=e).setOutlineWidth(2),e.setOutlineColor("rgba(255,255,0,1)");break;case"CgsLine":(this.selectedFeature=e).setWidth(2),e.setFillColor("rgba(255,255,0,1)");break;case"CgsPolygon":(this.selectedFeature=e).setFillColor("rgba(0,0,255,0.05)"),e.setOutlineColor("rgba(0,255,0,1)");break;case"CgsRect":(this.selectedFeature=e).setFillColor("rgba(0,0,255,0.05)"),e.setOutlineColor("rgba(0,255,0,1)"),e.showLine(!0),e.setLabelDraggable(!0);break;case"CgsCircle":(this.selectedFeature=e).setOutlineWidth(2),e.setOutlineColor("rgba(255,255,0,1)")}},CgsDrawTool.prototype.deactivate=function(){CgsUtil.defined(this.body)&&this.body.hide(),this.drawEndEvent&&(CgsSubPub.unsubscribe(this.drawEndEvent),this.drawEndEvent=null),map.setHitTolerance(this.hitTolerance)},CgsDrawTool.prototype.activate=function(){var i=this;CgsUtil.defined(this.body)&&this.body.show(),setTimeout(function(){i.drawEndEvent||(i.drawEndEvent=CgsSubPub.subscribe("featuredrawnbymouse",function(e,t){i.tool.deactivate()}))},600),map.setHitTolerance(5)},CgsPropertyPlugg=null,CgsSymbolTool=function(t){if(t.symbolTool)return t.symbolTool;var i=this,s=null;t.symbolTool=this,t.jmpApi||t.loadJmpFileAndInit(),this.map=t,this.body=$$("<div></div>"),this.ui=riot.mount(this.body[0],"jbpanel",{map:t})[0],CgsTool.call(this,t,null,this.body);var o=this.activate;this.activate=function(e){t.jmpApi?t.symbolTool._activate(e):s=s||CgsSubPub.subscribe(CgsEvent.eSymbolInitFinished,function(){CgsSubPub.unsubscribe(s),s=null,i._activate(e)})},this._activate=function(e){o.call(this),e?i.bone.element.css(e):i.bone.element.css({height:"710px",left:"13px",top:"40px",width:"299px"}),t.jmpApi.ui=i.ui}},CgsInherits(CgsSymbolTool,CgsTool),CgsSymbolTool.prototype.deactivate=function(){this.ui.map.jmpSequenceDraw&&this.ui.toggleSequenceDraw(),this.ui.map.toolbar&&(this.ui.map.toolbar.markToolActive=!1),this.title.hide(),this.body.hide(),this.bone&&this.bone.removeTool(this),this.bone=null;var e=document.getElementById("bh");e&&e.setAttribute("class","tool_hoverDiv"),CgsSubPub.publish("toolActive",[this,!1])},CgsSymbolLayer_=function(t){if(t.symbolLyer)return t.symbolLyer;var i=this,s=null;t.symbolLyer=this,t.jmpApi||t.loadJmpFileAndInit(),this.map=t,this.body=$$("<div></div>"),this.ui=riot.mount(this.body[0],"jbsymboltree",{map:t})[0],CgsTool.call(this,t,null,this.body);var o=this.activate;this.activate=function(e){t.jmpApi?t.symbolLyer._activate(e):s=s||CgsSubPub.subscribe(CgsEvent.eSymbolInitFinished,function(){CgsSubPub.unsubscribe(s),s=null,i._activate(e)})},this._activate=function(e){o.call(this),e?i.bone.element.css(e):i.bone.element.css({height:"300px",left:"325px",top:"3px",width:"299px"}),t.jmpApi.symbolLyerui=i.ui}},CgsInherits(CgsSymbolLayer_,CgsTool),CgsSymbolAttr=function(t){if(t.symbolAttr)return t.symbolAttr;var i=this,s=null;t.symbolAttr=this,t.jmpApi||t.loadJmpFileAndInit(),this.map=t,this.body=$$("<div></div>"),this.ui=riot.mount(this.body[0],"jbsymbolattr",{map:t})[0],CgsTool.call(this,t,null,this.body);var o=this.activate;this.activate=function(e){t.jmpApi?t.symbolAttr._activate(e):s=s||CgsSubPub.subscribe(CgsEvent.eSymbolInitFinished,function(){CgsSubPub.unsubscribe(s),s=null,i._activate(e)})},this._activate=function(e){o.call(this),e?i.bone.element.css(e):i.bone.element.css({height:"710px",left:"auto",right:"100px",top:"72px",width:"299px"}),t.jmpApi.symbolAttrui=i.ui}},CgsInherits(CgsSymbolAttr,CgsTool),CgsModelTool=function(o,e){if(o||console.error("必须传入地图实例对象"),o.modelDrawTool)return o.modelDrawTool;var a=this;this.map=o,(e=e||{}).url?this.configUrl=e.url:this.configUrl=o.allPropertiesConfigs.modelDrawUrl,(o.modelDrawTool=this).layers=[],this.label=null,this.activeLayerId=null,this.activeModel=null,this.operationLayer=null,this.rotatePoint=null,this.zoomPoint=null,this.circle=null,this.oprationOption={radius:120,position:[116,41],angle:-180},this.radius=120,this.scaleRadiusRatio=2e4,this.tooltipOverlay=null,this.body=$$("<div></div>"),this.mxpanel=riot.mount(this.body[0],"mxpanel",{map:o})[0],CgsTool.call(this,o,null,this.body);var t=this.activate;this.activate=function(s){$$.ajax({url:a.configUrl,type:"get",dataType:"text",success:function(e){var t=e.replace(/[\r\n]/g,""),i=JSON.parse(t);o.modelTree=i,a._activate(s)},error:function(e){console.error("模型树初始化请求数据失败",e)}})},this._activate=function(e){t.call(this),e?a.bone.element.css(e):a.bone.element.css({height:"710px",left:"13px",top:"40px",width:"294px"})},o.setAgainstTerrain(!1),this.createOverlay(),this._createOperationLayer(),this.createEventListener()},CgsInherits(CgsModelTool,CgsTool),CgsModelTool.prototype._createOperationLayer=function(){if(this.operationLayer)return this.operationLayer;var e=new CgsVectorLayer("controlModelLayer");this.operationLayer=e;var t={position:this._getPointPosition(this.oprationOption),name:"rotatePoint",fillColor:"#00ffff",outlineColor:"#00ffff",pixelSize:10,outlineWidth:1},i=new CgsPoint(t);i.setLabelVisible(!1),i.setAttribute({isFromModelTool:!0}),e.addFeature(i),this.rotatePoint=i;var s={position:this._getPointPosition(this.oprationOption),name:"scalePoint",fillColor:"#ffffff",outlineColor:"#ffffff",pixelSize:10,outlineWidth:1},o=new CgsPoint(s);o.setLabelVisible(!1),o.setAttribute({isFromModelTool:!0}),e.addFeature(o),this.zoomPoint=o;var a={position:this.oprationOption.position,name:"圆",fill:!1,outlineColor:"#ffff00",radius:this.oprationOption.radius,outline:!0},n=new CgsCircle(a);return n.setLabelVisible(!1),e.addFeature(n),this.circle=n,this.map.addLayer(e),e.setVisible(!1),e},CgsModelTool.prototype._getPointPosition=function(e){return new CgsAnalyze3D(this.map)._splitCircle2GeoPosition({longitude:e.position[0],latitude:e.position[1],radius:e.radius,angle:e.angle})},CgsModelTool.prototype.createModelLayer=function(e){var t=new CgsVectorLayer(e);t.setAttr({name:e}),this.map.addLayer(t),this.layers.push(t),this.activeLayerId=t._id,this.map.layertree.createLayerTree()},CgsModelTool.prototype.createEventListener=function(){var R=this.map,O=this,V=!1,G=null,B=null,H=[],N=this.map.map3D,c=N.scene;N.screenSpaceEventHandler.setInputAction(function(e){G=N.scene.pick(e.position),V=!0,B=e.position,O.activeModel&&(H=O.activeModel.getRotation());{var t;G&&((t=G.id.feature)&&t instanceof CgsModel3D&&(t.setSilhouetteColor("yellow"),t.setSilhouetteSize(1)),setTimeout(function(){N.scene.screenSpaceCameraController.enableRotate=!1,N.scene.screenSpaceCameraController.enableInputs=!1}))}},Cesium.ScreenSpaceEventType.LEFT_DOWN),N.screenSpaceEventHandler.setInputAction(function(e){{var t;V=!1,B=null,G&&((t=G.id.feature)&&t instanceof CgsModel3D&&t.setSilhouetteSize(0),G=null,N.scene.screenSpaceCameraController.enableRotate=!0,N.scene.screenSpaceCameraController.enableInputs=!0)}},Cesium.ScreenSpaceEventType.LEFT_UP),N.screenSpaceEventHandler.setInputAction(function(e){var t=null,i=N.scene.pick(e.endPosition);{var s,o,a,n;i?(s=(t=i.id.feature).getAttribute())&&s.isFromModelTool&&!V&&(o=O.map.pixelToLonLat([e.endPosition.x,e.endPosition.y]),a=$$("<span class='modelLabelStyle'></span>").get(0),t instanceof CgsModel3D?(O.activeModel&&O.activeModel.getId()==t.getId()?(n=t.getDragEnable(),a.innerText=n?"拖动模型更改坐标":"修改可移动属性后可移动模型"):a.innerText="点击模型进行编辑",O.tooltipOverlay.updateDom(a),O.tooltipOverlay.setPosition(o),O.tooltipOverlay.setVisible(!0)):t instanceof CgsPoint3D&&("scalePoint"==t.name?(a.innerText="拖动缩放模型",O.tooltipOverlay.updateDom(a),O.tooltipOverlay.setPosition(o),O.tooltipOverlay.setVisible(!0)):"rotatePoint"==t.name&&(a.innerText="拖动旋转模型",O.tooltipOverlay.updateDom(a),O.tooltipOverlay.setPosition(o),O.tooltipOverlay.setVisible(!0)))):O.tooltipOverlay.setVisible(!1)}{var r,l,u,p,h,c,g,d,m,f,C,y,v,b,D,S,_,w,P,T,M,L,x,E,A,I,F,k;G&&1==V&&(r=G.id.feature,l=r.getDragEnable(),r instanceof CgsModel3D&&O.activeModel&&O.activeModel.getId()==r.getId()&&l&&(u=N.camera.getPickRay(e.endPosition),p=N.scene.globe.pick(u,N.scene),G.id.position=p,h=O.map.pixelToLonLat([e.endPosition.x,e.endPosition.y]),r.setPosition(h.map(function(e){return Number(e.toFixed(3))})),O.moveCirclePoint(r),R.modelAttr&&R.modelAttr.modelAttrLayer.refs.mxgeometryAttributeCon.updateAttributes()),r instanceof CgsPoint3D&&(c=O.circle,g=c.getPosition(),d=Cesium.Cartesian3.fromDegrees(g[0],g[1]),m=N.camera.getPickRay(e.endPosition),f=N.scene.globe.pick(m,N.scene),C=R.lonLatToPixel(g.slice(0,2)),"scalePoint"==r.name?(y=Cesium.Cartesian3.distance(d,f),O.radius=y,v=new Cesium.CallbackProperty(function(e,t){return y},!1),c.feature3D&&(c.feature3D.radius=v,c.feature3D.entity.ellipse.semiMinorAxis=v,c.feature3D.entity.ellipse.semiMajorAxis=v),b=O.map.pixelToLonLat([e.endPosition.x,e.endPosition.y]),O.zoomPoint.setPosition(b),D=O.activeModel.getRotation()[0],S=O._getPointPosition({position:g,radius:y,angle:-D}),O.rotatePoint.setPosition(S),_=y/O.scaleRadiusRatio,O.activeModel.setScale(Number(_.toFixed(3))),R.modelAttr&&R.modelAttr.modelAttrLayer.refs.mxdrawingAttributeCon.updateAttributes()):"rotatePoint"==r.name&&(w=B.x-C[0],P=B.y-C[1],T=e.endPosition.x-C[0],M=e.endPosition.y-C[1],L=w*T+P*M,x=w*M-T*P,E=Math.atan2(x,L)/Math.PI*180,A=JSON.parse(JSON.stringify(H)),I=A[0],A.splice(0,1,Number((I+E).toFixed(3))),O.activeModel.setRotation(A),F="object"!==_typeof(O.circle.getRadius())?O.circle.getRadius():O.circle.getRadius().getValue(),k=O._getPointPosition({position:g,radius:F,angle:-Number((I+E).toFixed(3))}),O.rotatePoint.setPosition(k),R.modelAttr&&R.modelAttr.modelAttrLayer.refs.mxdrawingAttributeCon.updateAttributes())))}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),CgsSubPub.subscribe(CgsEvent.eFeatureClickOut,function(e,t,i,s,o){var a,n,r,l,u=R.currentDrawModel,p=new Cesium.Cartesian2(i[0],i[1]),h=void 0;h=o&&c.pickPositionSupported?(c.pick(p),c.pickPosition(p)):c.mode===Cesium.SceneMode.SCENE3D?(a=c._camera0.getPickRay(p),c.globe.pick(a,c)):c._camera0.pickEllipsoid(p,c.globe.ellipsoid),Cesium.defined(h)&&(n=Cesium.Cartographic.fromCartesian(h),r=[Cesium.Math.toDegrees(n.longitude),Cesium.Math.toDegrees(n.latitude),n.height],R.mxSequenceDraw?u&&""!==O.activeLayerId&&O.drawModel(u,r):R.modelDrawStatu&&(R.modelDrawStatu=!1,u&&""!==O.activeLayerId&&O.drawModel(u,r),(l=$$("#"+R.target).children()).find(".CgsModelTool__tool_active").removeClass("CgsModelTool__tool_active"),$$(l[0]).css("cursor",""),$$(l[1]).css("cursor",""),R.currentDrawModel=null),O.moveCircleVisible(!1),O.activeModel=null)}),CgsSubPub.subscribe(CgsEvent.eFeatureClick,function(e,t,i){var s=t.getAttribute();t instanceof CgsModel&&s&&s.isFromModelTool&&(R.modelAttr&&R.modelAttr.modelAttrLayer.updateAttributes(t),O.activeModel=t,O.moveCircleVisible(!0),O.moveCirclePoint(t),O.operationLayer.setVisible(!0))})},CgsModelTool.prototype.createOverlay=function(){if(this.tooltipOverlay)return this.tooltipOverlay;var e=$$("<span class='modelLabelStyle'></span>").get(0),t=new CgsOverlay({position:[0,0],positioning:"bottom-center",element:e,offset:[0,-20],draggable:!1,showLine:!1});return this.map.addOverlay(t),this.tooltipOverlay=t,this.tooltipOverlay},CgsModelTool.prototype.drawModel=function(e,t){var i=this,s={position:[Number(t[0].toFixed(3)),Number(t[1].toFixed(3))],name:e.text,rotation:[-180,0,0],scale:e.scale?e.scale:1,minimumScale:e.min_height?e.min_height:100,maximumScale:e.max_height?e.max_height:6e3,url:e.modelUrl,autoScale:!!e.canscale&&e.canscale},o=new CgsModel(s);o.setLabelVisible(!1),o.setLabelFillColor("#00ffff"),o.setLabelOffset([0,130]),o.setFont("20px 微软雅黑"),o.setDragEnable(!0),o.setAttribute({isFromModelTool:!0,modelType:e.model_type}),this.layers.find(function(e){return e._id==i.activeLayerId}).addFeature(o),this.map.flyTo({destination:[Number(t[0].toFixed(3)),Number(t[1].toFixed(3)),6e4],noFlyHigher:!1,rotation:[0,-90,0],duration:1}),this.map.layertree.createLayerTree()},CgsModelTool.prototype.moveCircleVisible=function(e){this.operationLayer.setVisible(e)},CgsModelTool.prototype.moveCirclePoint=function(e){this.map;var t=e.getScale(),i=e.getRotation()[0],s=this.radius,o=this.scaleRadiusRatio;s/t!==o&&(s=t*o);var a=e.getPosition().slice(0,2);this.circle.setPosition(a),this.circle.setRadius(s);var n=this._getPointPosition({position:a.slice(0,2),radius:s,angle:-i});this.rotatePoint.setPosition(n);var r=this._getPointPosition({position:a.slice(0,2),radius:s,angle:-90});this.zoomPoint.setPosition(r)},CgsModelTool.prototype.deactive=function(){},CgsModelAttr=function(t){if(t.modelAttr)return t.modelAttr;var i=this;(t.modelAttr=this).map=t,this.body=$$("<div></div>"),this.modelAttrLayer=riot.mount(this.body[0],"mxprotractattr",{map:t})[0],t.modelDrawTool.activeModel&&i.modelAttrLayer.updateAttributes(t.modelDrawTool.activeModel),CgsTool.call(this,t,null,this.body);var s=this.activate;this.activate=function(e){t.modelAttr._activate(e)},this._activate=function(e){s.call(this),e?i.bone.element.css(e):i.bone.element.css({height:"710px",left:"auto",right:"100px",top:"72px",width:"299px"})}},CgsInherits(CgsModelAttr,CgsTool),CgsModelEditLayer=function(t){if(t.modelEditLayer)return t.modelEditLayer;var i=this;(t.modelEditLayer=this).map=t,this.body=$$("<div></div>"),riot.mount(this.body[0],"mxeditlayer",{map:t})[0],CgsTool.call(this,t,null,this.body);var s=this.activate;this.activate=function(e){t.modelEditLayer._activate(e)},this._activate=function(e){s.call(this),e?i.bone.element.css(e):i.bone.element.css({height:"150px",left:"325px",top:"40px",width:"299px"})}},CgsInherits(CgsModelEditLayer,CgsTool),CgsAnalyzeTool=function(e){this.analyzeTool3D=new CgsAnalyzeTool3D(e)},CgsAnalyzeTool.prototype.activate=function(){this.analyzeTool3D&&this.analyzeTool3D.activate()},CgsAnalyzeTool.prototype.deactivate=function(){this.analyzeTool3D&&this.analyzeTool3D.deactivate()},CgsAnalyzeTool.prototype.remove=function(){this.analyzeTool3D&&this.analyzeTool3D.remove()},CgsAnalyzeTool.prototype.setType=function(e){this.analyzeTool3D&&this.analyzeTool3D.setType(e)},CgsAnalyzeTool.prototype.getType=function(){if(this.analyzeTool3D)return this.analyzeTool3D.getType()},CgsGradientTool3D=function(e){this.title=null,this.body=null,CgsTool.call(this,e,this.title,this.body);var p=this;this.createTool(this.map);var h=void 0;this.eventID=CgsSubPub.subscribe("gradientAnalyze",function(e,t){var i=p.body.children(".CgsGradientTool__container");i.children().remove();var s=i[0];p.bone&&p.bone.element&&(1==t.length&&100==t[0]?p.bone.element[0].hidden=!0:p.bone.element[0].hidden=!1);var o=t.slice(0),a=t.length,n=a/20;0===(n=parseInt(n/10))?n=5:n*=10;for(var r=[],l=0;l<a;++l){var u=[];u.push(l),u.push(o[l]),r.push(u)}h=echarts.init(s),option={backgroundColor:"rgba(0,0,0,0.0)",title:{text:"两点之间坡度变化",x:"center",textStyle:{fontSize:18,fontFamily:"微软雅黑",fontStyle:" italic",color:"#fff"}},tooltip:{show:!0,trigger:"axis",backgroundColor:"rgba(0,0,0,0.0)",textStyle:{fontSize:12,fontFamily:"微软雅黑",color:"#ff0"},axisPointer:{show:!0,type:"cross",crossStyle:{color:"rgba(255,255,0,0.8)",width:1,type:"dashed"}},formatter:function(){return""},position:function(e){return[e[0]-35,e[1]-20]}},toolbox:{show:!1,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,grid:{backgroundColor:"rgba(0,0,0,1.0)",borderWidth:2,borderColor:"#0f0",x:40,y:35,x2:20,y2:25},xAxis:[{type:"value",scale:!0,boundaryGap:[0,0],axisLabel:{formatter:"{value} ",textStyle:{fontSize:12,fontFamily:"Times New Roman",color:"#fff"}},splitLine:{show:!1,lineStyle:{color:["#000"],width:1,type:"solid"}},axisLine:{show:!1,lineStyle:{color:["#000"],width:2,type:"solid"}},splitArea:{show:!1},axisTick:{show:!1}}],yAxis:[{type:"value",axisLabel:{formatter:"{value} °",textStyle:{fontSize:12,fontFamily:"Times New Roman",color:"#fff"}},splitLine:{show:!1,lineStyle:{color:["#000"],width:1,type:"solid"}},axisLine:{show:!1,lineStyle:{color:["#000"],width:2,type:"solid"}},splitArea:{show:!1}}],series:[{name:"",type:"line",symbol:"null",symbolSize:0,showAllSymbol:!1,smooth:!0,data:r,itemStyle:{normal:{color:"white"}}}]},h.setOption(option),h.on(CgsEventType.mouseMove,function(e){if(null==_typeof(e.seriesIndex))return;idEvent=CgsSubPub.publish("gradientPosition",[e.dataIndex,p])})})},CgsInherits(CgsGradientTool3D,CgsTool),CgsGradientTool3D.prototype.createTool=function(e){var t=CGS_SDK_PATH+"assets/image/ablum.png",i=$$(e.container);this.title=$$("<div class='CgsGradientTool__title CgsTool__title'><img class='CgsGradientTool__titleImg' ><span class='CgsGradientTool__titleText'>坡度分析</span><div class='CgsGradientTool__closeButton'></div></div>"),this.body=$$("<div class='CgsGradientTool' style='display:none;'><div class='CgsGradientTool__container'></div></div>"),i.append(this.body),this.title.find(".CgsGradientTool__titleImg").attr("src",t),this.reDraw(e)},CgsGradientTool3D.prototype.reDraw=function(e){this.body.children(".CgsGradientTool__container").children().remove()},CgsGradientTool3D.prototype.unsubscribe=function(){this.eventID&&(CgsSubPub.unsubscribe(this.eventID),this.eventID=void 0)},CgsProfileUI3D=function(e){this.title=null,this.body=null,CgsTool.call(this,e,this.title,this.body);var u=this;this.createTool(this.map);var p=void 0;this.eventID=CgsSubPub.subscribe("profileAnalyze",function(e,t){var i=u.body.children(".CgsProfileTool__container");i.children().remove();var s=i[0];u.bone.element&&(1==t.length&&1e3==t[0]?u.bone.element[0].hidden=!0:u.bone.element[0].hidden=!1);for(var o=t.slice(0),a=t.length,n=[],r=0;r<a;++r){var l=[];l.push(r),l.push(o[r]/1e3),n.push(l)}p=echarts.init(s),option={backgroundColor:"rgba(0,0,0,0.0)",title:{text:"剖面高程变化",x:"center",textStyle:{fontSize:18,fontFamily:"微软雅黑",fontStyle:" italic",color:"#fff"}},tooltip:{show:!0,trigger:"axis",backgroundColor:"rgba(0,0,0,0.0)",textStyle:{fontSize:12,fontFamily:"微软雅黑",color:"#ff0"},axisPointer:{show:!0,type:"cross",crossStyle:{color:"rgba(255,255,0,0.8)",width:1,type:"dashed"}},formatter:function(){return""},position:function(e){return[e[0]-35,e[1]-20]}},toolbox:{show:!1,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,grid:{backgroundColor:"rgba(0,0,0,1.0)",borderWidth:2,borderColor:"#0f0",x:40,y:35,x2:20,y2:25},xAxis:[{type:"value",scale:!0,boundaryGap:[0,0],axisLabel:{formatter:"{value} ",textStyle:{fontSize:12,fontFamily:"Times New Roman",color:"#fff"}},splitLine:{show:!1,lineStyle:{color:["#000"],width:1,type:"solid"}},axisLine:{show:!1,lineStyle:{color:["#000"],width:2,type:"solid"}},splitArea:{show:!1},axisTick:{show:!1}}],yAxis:[{type:"value",axisLabel:{formatter:"{value}km",textStyle:{fontSize:12,fontFamily:"Times New Roman",color:"#fff"}},splitLine:{show:!1,lineStyle:{color:["#000"],width:1,type:"solid"}},axisLine:{show:!1,lineStyle:{color:["#000"],width:2,type:"solid"}},splitArea:{show:!1}}],series:[{name:"",type:"line",symbol:"null",symbolSize:0,showAllSymbol:!1,smooth:!0,data:n,itemStyle:{normal:{color:"white"}}}]},p.setOption(option),p.on(CgsEventType.mouseMove,function(e){if(null==_typeof(e.seriesIndex))return;idEvent=CgsSubPub.publish("profilePosition",[e.dataIndex,u])})})},CgsInherits(CgsProfileUI3D,CgsTool),CgsProfileUI3D.prototype.createTool=function(e){var t=CGS_SDK_PATH+"assets/image/ablum.png",i=$$(e.container);this.title=$$("<div class='CgsGradientTool__title CgsTool__title'><img class='CgsGradientTool__titleImg' ><span class='CgsGradientTool__titleText'>剖面分析</span><div class='CgsGradientTool__closeButton'></div></div>"),this.body=$$("<div class='CgsGradientTool' style='display:none;'><div class='CgsProfileTool__container'></div></div>"),i.append(this.body),this.title.find(".CgsGradientTool__titleImg").attr("src",t),this.reDraw(e)},CgsProfileUI3D.prototype.reDraw=function(e){this.body.children(".CgsProfileTool__container").children().remove()},CgsProfileUI3D.prototype.unsubscribe=function(){CgsSubPub.unsubscribe(this.eventID)},CgsFillDigUI3D=function(e){this.title=null,this.body=null,CgsTool.call(this,e,this.title,this.body);var s=this;this.createTool(this.map);CgsSubPub.subscribe("fillDigAnalyze",function(e,t,i){s.body.find("#baseHeight").get(0).max=i})},CgsInherits(CgsFillDigUI3D,CgsTool),CgsFillDigUI3D.prototype.createTool=function(e){var t=CGS_SDK_PATH+"assets/image/ablum.png",i=this,s=$$(e.container);this.title=$$("<div class='CgsGradientTool__title CgsTool__title'><img class='CgsGradientTool__titleImg' ><span class='CgsGradientTool__titleText'>填挖方分析</span><div class='CgsGradientTool__closeButton'></div></div>"),this.body=$$("<div class='CgsGradientTool' ><div class='CgsFillDigTool__container'><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>最高点</label></div><div id='maxHeight' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText'>0m</label></div></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>最低点</label></div><div id='minHeight' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText'>0m</label></div></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>填方量</label></div><div id='fillAmount' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText'>0m³</label></div></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>挖方量</label></div><div id='digAmount' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText'>0m³</label></div></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>填挖方总量</label></div><div id='fillDigAmount' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText'>0m³</label></div></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>填方区域面积</label></div><div id='fillArea' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText'>0m²</label></div></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>挖方区域面积</label></div><div id='digArea' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText'>0m²</label></div></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>区域面积量</label></div><div id='fillDigArea' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText'>0m²</label></div></div><div class='CgsFillDigTool__Text'></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left25'><label class='CgsFillDigTool__colText'>基准面高度</label></div><div class='CgsFillDigTool__SliderDiv'><input class='CgsFillDigTool__range' id='baseHeight' type='range' min='0' max='5000' step='10' value='0'></div><div  class='CgsFillDigTool__Text_Left25'><input class='demoPanel__input demoPanel__input_inrange' id='HeightInput' value='0'><label class='CgsFillDigTool__colText'>m</label></div><div id='analyze' class='CgsFillDigTool__Text_Right20'><input type='button' class='CgsFillDigTool__ButtonAnalyze' value='分析'></div></div></div></div>"),s.append(this.body),this.title.find(".CgsGradientTool__titleImg").attr("src",t);var o=this.body.find("#baseHeight").get(0);o.onchange=function(e){var t=parseFloat(o.value);CgsSubPub.publish("fillDigSlider",[t]);i.body.find("#HeightInput").get(0).value=t}},CgsFillDigUI3D.prototype.reDraw=function(e){this.body.children(".CgsFillDigTool__container").children().remove()},CgsFloodUI3D=function(e){this.title=null,this.body=null,CgsTool.call(this,e,this.title,this.body);var a=this;this.createTool(this.map);CgsSubPub.subscribe("floodAnalyze",function(e,t,i,s){var o=a.body.find("#waterspeed").get(0);o.max=i,o.defaultValue=Math.round(s),a.body.find("#speedInput").get(0).defaultValue=Math.round(s)})},CgsInherits(CgsFloodUI3D,CgsTool),CgsFloodUI3D.prototype.createTool=function(e){var t=CGS_SDK_PATH+"assets/image/ablum.png",i=this,s=$$(e.container);this.title=$$("<div class='CgsGradientTool__title CgsTool__title'><img class='CgsGradientTool__titleImg' ><span class='CgsGradientTool__titleText'>淹没分析</span><div class='CgsGradientTool__closeButton'></div></div>"),this.body=$$("<div class='CgsGradientTool' ><div class='CgsFillDigTool__container'><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>淹没区域面积</label></div><div id='fillArea' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText'>0m²</label></div></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>区域面积</label></div><div id='fillDigArea' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText'>0m²</label></div></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left'><label class='CgsFillDigTool__colText'>水面海拔</label></div><div id='fillDigArea' class='CgsFillDigTool__Text_Right'><label class='CgsFillDigTool__colText' id='waterHeightLabel'>0m</label></div></div><div class='CgsFillDigTool__Text'><div id='analyze' class='CgsFillDigTool__Text_Right20'><input type='button' class='CgsFillDigTool__ButtonAnalyze' value='分析'></div></div><div class='CgsFillDigTool__Text'></div><div class='CgsFillDigTool__Text'><div class='CgsFillDigTool__Text_Left25'><label class='CgsFillDigTool__colText'>水面高度</label></div><div class='CgsFillDigTool__SliderDiv'><input class='CgsFillDigTool__range' id='waterspeed' type='range' min='0' max='5000' step='10'></div><div  class='CgsFillDigTool__Text_Left25'><input class='demoPanel__input demoPanel__input_inrange' id='speedInput' ><label class='CgsFillDigTool__colText'>m</label></div></div><div class='CgsFillDigTool__Text'><div id='analyze' class='CgsFillDigTool__Text_Right20'><input type='button' class='CgsFillDigTool__ButtonAnalyze' id='stopSimulate' value='暂停模拟'></div><div id='analyze' class='CgsFillDigTool__Text_Right20'><input type='button' class='CgsFillDigTool__ButtonAnalyze' id='startSimulate' value='开始模拟'></div><div id='analyze' class='CgsFillDigTool__Text_Right20'><input type='button' class='CgsFillDigTool__ButtonAnalyze' id='reSimulate' value='重新模拟'></div></div></div></div>"),s.append(this.body),this.title.find(".CgsGradientTool__titleImg").attr("src",t);var o=this.body.find("#waterspeed").get(0);o.onchange=function(e){var t=parseFloat(o.value);CgsSubPub.publish("floodSlider",[t]);i.body.find("#speedInput").get(0).value=t};var a=this.body.find("#speedInput").get(0);a.onchange=function(e){var t=parseFloat(a.value);CgsSubPub.publish("floodSlider",[t]);i.body.find("#waterspeed").get(0).value=t},this.body.find("#startSimulate").get(0).onclick=function(e){var t=i.body.find("#waterspeed").get(0).value;CgsSubPub.publish("floodSlider",[t,CgsFloodUI3D.STRATSIMULATE])},this.body.find("#stopSimulate").get(0).onclick=function(e){CgsSubPub.publish("floodSlider",[0,CgsFloodUI3D.STOPSIMULATE])},this.body.find("#reSimulate").get(0).onclick=function(e){var t=i.body.find("#waterspeed").get(0).value;CgsSubPub.publish("floodSlider",[t,CgsFloodUI3D.RESIMULATE])}},CgsFloodUI3D.prototype.reDraw=function(e){this.body.children(".CgsFillDigTool__container").children().remove()},CgsFloodUI3D.STRATSIMULATE=0,CgsFloodUI3D.STOPSIMULATE=1,CgsFloodUI3D.RESIMULATE=2,CgsIndoorRoaming3D=function(e){var t,i,o,s,a,n,r;this.url=Cesium.defaultValue(e.url,CGS_SDK_PATH+"SDK/assets/indoorRoaming/shinei.gltf"),Cesium.defined(this.url)?(t=Cesium.defaultValue(e.position,void 0),Cesium.defined(t)?(this.position=t.slice(0),2===this.position.length&&(this.position[2]=0),i=Cesium.defaultValue(e.mapObject,void 0),Cesium.defined(i)?(this.map=i.map3D,this.manipulate=this.map.manipulate,this.rotation=Cesium.defaultValue(e.rotation,[0,0,0]),this.invModelMatrix=new Cesium.Matrix4,this.modelMatrix=new Cesium.Matrix4,this.octreeTriangleSelector=void 0,this.initPosition=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2]+2),this.camCenter=Cesium.Cartesian3.clone(this.initPosition),this.isRoaming=!1,this.speedRate=.05,this.slidingSpeed=.02,this.moveJump=new Cesium.Cartesian3(0,0,.2),this.gravity=new Cesium.Cartesian3(0,0,-.08),this.radius=new Cesium.Cartesian3(.2,.2,.8),this.localCenter=new Cesium.Cartesian3,this.hitPosition=new Cesium.Cartesian3,this.velocity=new Cesium.Cartesian3,this.jumpStep=0,this.jumpDoing=!1,this.needJump=!1,this.heightOffset=.08,this.jumpOffset=-.16,this.dirRate=.1,this.forwardDir=new Cesium.Cartesian3(0,1,0),this.backDir=new Cesium.Cartesian3(0,-1,0),this.rightDir=new Cesium.Cartesian3(1,0,0),this.leftDir=new Cesium.Cartesian3(-1,0,0),this.eyePos=new Cesium.Cartesian3(0,0,0),this.camheading=0,this.camPitch=0,o=this.map.scene,s=this.map.canvas,this.flags={looking:!1,moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,moveJump:!1},this.deltaX=0,this.deltaY=0,n=!1,(a=this).looking=!1,this.zoomRate=0,this.doubleClick=!1,this.pickPosition=void 0,this.deltaVertical=0,this.deltaHorizontal=0,this.beginCameraHeight=0,(r=new Cesium.ScreenSpaceEventHandler(s)).setInputAction(function(){a.doubleClick&&(a.doubleClick=!1)},Cesium.ScreenSpaceEventType.LEFT_CLICK),r.setInputAction(function(e){var t,i,s;a.isRoaming&&(a.doubleClick=!0,a.pickPosition=o.pickPosition(e.position),t=Cesium.Matrix4.multiplyByPoint(a.invModelMatrix,a.map.camera.position,new Cesium.Cartesian3),i=Cesium.Matrix4.multiplyByPoint(a.invModelMatrix,a.pickPosition,new Cesium.Cartesian3),a.deltaVertical=i.z-t.z,0<a.deltaVertical?a.deltaVertical-=.1:a.deltaVertical+=.1,s=Cesium.Cartesian3.clone(i),a.deltaHorizontal=Cesium.Cartesian3.distance(t,s),a.beginCameraHeight=t.z,a.azimuth())},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),r.setInputAction(function(e){n=!0,a.deltaX=0,a.deltaY=0},Cesium.ScreenSpaceEventType.LEFT_DOWN),r.setInputAction(function(e){n&&!a.doubleClick&&(a.deltaX=e.startPosition.x-e.endPosition.x,a.deltaY=e.endPosition.y-e.startPosition.y,a.looking=!0)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),r.setInputAction(function(e){a.zoomRate=e},Cesium.ScreenSpaceEventType.WHEEL),r.setInputAction(function(e){n=!1,a.looking=!1},Cesium.ScreenSpaceEventType.LEFT_UP),s.setAttribute("tabindex","0"),s.onclick=function(){s.focus()}):console.info("mapObject is undefined !!")):console.info("position is undefined !!")):console.info("url is undefined !!")};var scratchRotMatrix=new Cesium.Matrix3,scratchQuat=Cesium.Quaternion(),scratchHpr=new Cesium.HeadingPitchRoll;CgsIndoorRoaming3D.prototype.azimuth=function(){var e=this.map.camera,t=Cesium.Cartesian3.clone(e.position),i=Cesium.Cartographic.fromCartesian(t),s=Cesium.Cartesian3.clone(this.pickPosition),o=Cesium.Cartographic.fromCartesian(s),a=Math.cos(o.latitude),n=Math.sin(i.longitude-o.longitude)*a,r=Math.cos(i.latitude)*Math.sin(o.latitude)-Math.sin(i.latitude)*a*Math.cos(i.longitude-o.longitude),l=Math.atan2(n,r);l<0&&(l+=2*Math.PI),l=2*Math.PI-l,this.camheading=Cesium.Math.toDegrees(l);var u=o.height-i.height,p=Cesium.Cartesian3.distance(t,s);this.camPitch=Cesium.Math.toDegrees(Math.asin(u/p)),this.updateLookDir()},CgsIndoorRoaming3D.prototype.startIndoorRoaming=function(){var e=Cesium.Math.toRadians(this.rotation[0]),t=Cesium.Math.toRadians(this.rotation[1]),i=Cesium.Math.toRadians(this.rotation[2]),s=new Cesium.HeadingPitchRoll(e,t,i),o=Cesium.Transforms.localFrameToFixedFrameGenerator("east","north"),a=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2]),n=Cesium.Transforms.headingPitchRollToFixedFrame(a,s,Cesium.Ellipsoid.WGS84,o);this.indoorModel=this.map.scene.primitives.add(Cesium.Model.fromGltf({url:this.url,modelMatrix:n,insideModel:!0}));var r=this;this.indoorModel.readyPromise.then(function(e){var t=e.rendererResources,i=t.triangles,s=i.size,o=t.max,a=t.min;r.modelMatrix=Cesium.Matrix4.clone(e._runtime.rootNodes[0].computedMatrix,r.modelMatrix),r.invModelMatrix=Cesium.Matrix4.inverse(r.modelMatrix,r.invModelMatrix);var n={totalTriangleCount:s,max:o,min:a,triangleList:i,minimalPolysPerNode:100};r.octreeTriangleSelector=new Cesium.FeOctreeTriangleSelector(n),r.octreeTriangleSelector.ConstructTriangleOctree(),r.enterIndoorRoaming()})},CgsIndoorRoaming3D.prototype.resetCamera=function(){var e=this.map.camera;this.forwardDir=new Cesium.Cartesian3(0,1,0),this.backDir=new Cesium.Cartesian3(0,-1,0),this.rightDir=new Cesium.Cartesian3(1,0,0),this.leftDir=new Cesium.Cartesian3(-1,0,0),this.camheading=0,this.camPitch=0,(this.manipulate.indoorRoaming=this).manipulate.setManipulateType(CgsManipulate3D.MANIPULATE_INDOOR);var t=Cesium.Transforms.eastNorthUpToFixedFrame(this.initPosition);e.lookAtTransform(t,new Cesium.HeadingPitchRange(Cesium.Math.toRadians(this.rotation[0]),Cesium.Math.toRadians(this.rotation[1]),Cesium.Math.EPSILON20)),e.lookAtTransform(Cesium.Matrix4.IDENTITY),this.camCenter=Cesium.Cartesian3.clone(this.initPosition)},CgsIndoorRoaming3D.prototype.enterIndoorRoaming=function(){this.octreeTriangleSelector&&(this.isRoaming=!0,this.map.scene.screenSpaceCameraController.enableInputs=!1,this.map.scene.logarithmicDepthBuffer=!1,this.resetCamera())},CgsIndoorRoaming3D.prototype.leaveIndoorRoaming=function(){this.octreeTriangleSelector&&this.isIndoorRoaming()&&(this.isRoaming=!1,this.map.scene.screenSpaceCameraController.enableInputs=!0,this.map.scene.logarithmicDepthBuffer=!0,this.map.flyHome(0))},CgsIndoorRoaming3D.prototype.isIndoorRoaming=function(){return this.isRoaming},CgsIndoorRoaming3D.prototype.stopIndoorRoaming=function(){this.indoorModel&&(this.map.scene.primitives.remove(this.indoorModel),this.indoorModel=null),this.leaveIndoorRoaming(),this.octreeTriangleSelector&&this.octreeTriangleSelector.destroy(),this.manipulate.indoorRoaming=null},CgsIndoorRoaming3D.prototype.setNeedJump=function(e){this.needJump=e},CgsIndoorRoaming3D.prototype.getNeedJump=function(e){return this.needJump};var scratchHeadingPitchRoll=new Cesium.HeadingPitchRoll,scratchRotationMatrix=new Cesium.Matrix3,scratchNorth=new Cesium.Cartesian3(0,1,0),scratchSideDir=new Cesium.Cartesian3(1,0,0);CgsIndoorRoaming3D.prototype.updateLookDir=function(){this.camheading+=this.deltaX*this.dirRate,this.camPitch+=this.deltaY*this.dirRate,360<=this.camheading&&(this.camheading-=360),this.camheading<=-360&&(this.camheading+=360),89<=this.camPitch&&(this.camPitch=89),this.camPitch<=-89&&(this.camPitch=-89);var e=scratchHeadingPitchRoll;e.heading=Cesium.Math.toRadians(this.camheading),e.pitch=Cesium.Math.toRadians(this.camPitch),e.roll=0,Cesium.Matrix3.fromHeadingPitchRoll(e,scratchRotationMatrix),Cesium.Matrix3.multiplyByVector(scratchRotationMatrix,scratchSideDir,this.rightDir),Cesium.Cartesian3.normalize(this.rightDir,this.rightDir),Cesium.Cartesian3.negate(this.rightDir,this.leftDir),Cesium.Matrix3.multiplyByVector(scratchRotationMatrix,scratchNorth,this.forwardDir),Cesium.Cartesian3.normalize(this.forwardDir,this.forwardDir),Cesium.Cartesian3.negate(this.forwardDir,this.backDir)};var curCamDirection=new Cesium.Cartesian3,curCamRight=new Cesium.Cartesian3,moveScratchJump=new Cesium.Cartesian3,zoomScratchJump=new Cesium.Cartesian3,featureScratchPosition=new Cesium.Cartesian3,destScratchPosition=new Cesium.Cartesian3,reserveOpt={foundCollision:!1,outFalling:!1},outTriangle={p0:new Cesium.Cartesian3,p1:new Cesium.Cartesian3,p2:new Cesium.Cartesian3},pro;function twoDigits(e){return e<10?"0"+e.toString():e.toString()}CgsIndoorRoaming3D.prototype.updateCameraWithModel=function(e){this.looking&&this.updateLookDir();var t,i,s,o,a=this.map&&this.map.camera;Cesium.defined(a)&&(Cesium.Cartesian3.clone(Cesium.Cartesian3.ZERO,curCamDirection),Cesium.Cartesian3.clone(Cesium.Cartesian3.ZERO,curCamRight),Cesium.Cartesian3.clone(Cesium.Cartesian3.ZERO,moveScratchJump),Cesium.Cartesian3.clone(Cesium.Cartesian3.ZERO,zoomScratchJump),e.moveForward&&Cesium.Cartesian3.add(curCamDirection,this.forwardDir,curCamDirection),e.moveBackward&&Cesium.Cartesian3.add(curCamDirection,this.backDir,curCamDirection),e.moveLeft&&Cesium.Cartesian3.add(curCamRight,this.leftDir,curCamRight),e.moveRight&&Cesium.Cartesian3.add(curCamRight,this.rightDir,curCamRight),Cesium.Cartesian3.add(curCamDirection,curCamRight,this.velocity),0<Cesium.Cartesian3.magnitude(this.velocity)&&Cesium.Cartesian3.normalize(this.velocity,this.velocity),0<Math.abs(this.zoomRate)?(Cesium.Cartesian3.multiplyByScalar(this.forwardDir,this.zoomRate,zoomScratchJump),Cesium.Cartesian3.normalize(zoomScratchJump,zoomScratchJump),Cesium.Cartesian3.multiplyByScalar(zoomScratchJump,5*this.speedRate,this.velocity),this.zoomRate=0):Cesium.Cartesian3.multiplyByScalar(this.velocity,this.speedRate,this.velocity),this.camCenter=Cesium.Cartesian3.clone(a.position,this.camCenter),this.localCenter=Cesium.Matrix4.multiplyByPoint(this.invModelMatrix,this.camCenter,this.localCenter),this.eyePos=Cesium.Cartesian3.clone(this.localCenter,this.eyePos),this.needJump&&(this.jumpStep=5,Cesium.Cartesian3.add(this.velocity,this.moveJump,this.velocity),this.needJump=!1),0<this.jumpStep&&reserveOpt.outFalling&&(Cesium.Cartesian3.add(this.velocity,this.moveJump,this.velocity),this.jumpStep--,this.jumpDoing=!0),reserveOpt.foundCollision=!1,this.octreeTriangleSelector&&!this.doubleClick&&0<Cesium.Cartesian3.magnitude(this.velocity)&&(Cesium.Cartesian3.clone(Cesium.Cartesian3.ZERO,this.hitPosition),Cesium.Cartesian3.clone(Cesium.Cartesian3.ZERO,outTriangle.p0),Cesium.Cartesian3.clone(Cesium.Cartesian3.ZERO,outTriangle.p1),Cesium.Cartesian3.clone(Cesium.Cartesian3.ZERO,outTriangle.p2),this.localCenter=this.octreeTriangleSelector.getCollisionResultPositionWithModel(this.localCenter,this.radius,this.velocity,outTriangle,this.hitPosition,this.slidingSpeed,this.gravity,reserveOpt),reserveOpt.foundCollision&&(this.jumpStep=0),this.eyePos=Cesium.Cartesian3.clone(this.localCenter),this.jumpDoing&&0<=this.jumpStep?(this.eyePos.z=this.eyePos.z+this.jumpOffset,0==this.jumpStep&&(this.jumpDoing=!1)):this.eyePos.z=this.eyePos.z+this.heightOffset,0===this.jumpStep&&(reserveOpt.outFalling=!1)),this.octreeTriangleSelector&&this.doubleClick&&(Cesium.Cartesian3.clone(Cesium.Cartesian3.ZERO,curCamDirection),Cesium.Cartesian3.multiplyByScalar(this.forwardDir,.03,curCamDirection),Cesium.Cartesian3.add(this.localCenter,curCamDirection,this.eyePos),t=Cesium.Matrix4.multiplyByPoint(this.invModelMatrix,this.pickPosition,destScratchPosition),s=(1-(i=Cesium.Cartesian3.distance(this.eyePos,t))/this.deltaHorizontal)*this.deltaVertical,this.eyePos.z=this.beginCameraHeight+s,i<=1&&(this.doubleClick=!1,this.deltaVertical=0,this.deltaHorizontal=0,this.beginCameraHeight=0)),this.deltaX=0,this.deltaY=0,this.camCenter=Cesium.Matrix4.multiplyByPoint(this.modelMatrix,this.eyePos,this.camCenter),o=Cesium.Transforms.eastNorthUpToFixedFrame(this.camCenter),a.lookAtTransform(o,new Cesium.HeadingPitchRange(Cesium.Math.toRadians(this.camheading),Cesium.Math.toRadians(this.camPitch),Cesium.Math.EPSILON20)),a.lookAtTransform(Cesium.Matrix4.IDENTITY))},CgsMouseIcon3D=function(){},CgsMouseIcon3D.showTiltPositionIcon=function(e){var t,i=document.getElementById("tiltPositionIcon");i?(i.style.visibility="visible",i.style.top=e.y+"px",i.style.left=e.x+"px"):((i=document.createElement("div")).setAttribute("id","tiltPositionIcon"),i.style.position="absolute",t="url("+CGS_SDK_PATH+"assets/image/mouseIcon/tiltIcon16.png)",i.style.backgroundImage=t,i.style.width="16px",i.style.height="16px",i.style.top=e.y+"px",i.style.left=e.x+"px",i.style.visibility="visible",document.getElementById("CgsMapContainer3D").appendChild(i))},CgsMouseIcon3D.hideTiltPositionIcon=function(){var e=document.getElementById("tiltPositionIcon");e&&(e.style.visibility="hidden")},CgsMouseIcon3D.showZoomPositionIcon=function(e){var t,i=document.getElementById("zoomPositionIcon");i?(i.style.visibility="visible",i.style.top=e.y+"px",i.style.left=e.x+"px"):((i=document.createElement("div")).setAttribute("id","zoomPositionIcon"),i.style.position="absolute",t="url("+CGS_SDK_PATH+"assets/image/mouseIcon/zoomIcon64.png)",i.style.backgroundImage=t,i.style.width="64px",i.style.height="64px",i.style.top=e.y+"px",i.style.left=e.x+"px",i.style.visibility="visible",document.getElementById("CgsMapContainer3D").appendChild(i)),setTimeout(function(){CgsMouseIcon3D.hideZoomPositionIcon()},100)},CgsMouseIcon3D.hideZoomPositionIcon=function(){var e=document.getElementById("zoomPositionIcon");e&&(e.style.visibility="hidden")},CgsTimeDynamicTileLayer3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(u){var p=null;u.proxy=void 0===u.proxy||u.proxy,p="string"==typeof u.proxy?u.proxy:u.proxy?CGS_SDK_PATH+"proxy/proxy.jsp?address=":null,this.timesUrl=u.timesUrl?u.timesUrl:u.url.split("?",1)[0]+"?level=0&col=0&row=0",this.startDate=Cesium.JulianDate.totalDays(Cesium.JulianDate.fromIso8601("1970-01-01"))*Cesium.TimeConstants.SECONDS_PER_DAY,this.levelTimes=new Map,this.clock=new Cesium.Clock,this.mouseDownFlag=!1,this.steps=7,this.ready=!1;var h=this;function c(e,t){return e-t}$$.ajax({async:!1,url:h.timesUrl,type:"get",dataType:"json",success:function(e){if(0!=e.length){var t=e.sort(c);h.levelTimes.has("0_0_0")||h.levelTimes.set("0_0_0",t),h.times=h.calculateTimes(t),h.key="0_0_0";var i=Cesium.JulianDate.fromIso8601(h.start),s=Cesium.JulianDate.fromIso8601(h.stop);h.clock.startTime=i,h.clock.stopTime=s,h.clock.currentTime=i,h.clock.shouldAnimate=!0,h.clock.clockRange=Cesium.ClockRange.LOOP_STOP,h.currentTimeSeconds=h.startSeconds,h.ready=!0;var o={name:u.name,type:"WMTS",url:u.url,layer:u.layer,rectangle:u.rectangle,level:u.level,text:u.text,pId:u.pId,visible:1==u.visible,format:u.format,style:u.style,tileMatrixSetID:u.tileMatrixSetID,tileMatrixLabels:u.tileMatrixLabels,tileWidth:u.tileWidth,tileHeight:u.tileHeight,minimumLevel:u.minimumLevel,maximumLevel:u.maximumLevel,minVisLevel:u.minVisLevel,maxVisLevel:u.maxVisLevel,numberOfLevelZeroTilesXY:u.numberOfLevelZeroTilesXY,projection:u.projection,isAddToLayerTree:1==u.isAddToLayerTree,proxy:p};if(null==(h.state=o).maximumLevel&&(o.maximumLevel=u.level),null==o.layer&&(o.layer=u.name),null==o.text&&(o.text=u.layer),null==o.style&&(o.style="default"),null==o.tileMatrixSetID&&(o.tileMatrixSetID="OGC_WebMercator"),null==o.minimumLevel&&(o.minimumLevel=0),null==o.format&&(o.format="image/png"),null==o.tileMatrixLabels){for(var a=[],n=o.minimumLevel;n<o.maximumLevel;n++)o.numberOfLevelZeroTilesXY&&10===o.numberOfLevelZeroTilesXY[0]&&5===o.numberOfLevelZeroTilesXY[1]&&"OGC_WGS84"===o.tileMatrixSetID?a.push(n-4):a.push(n+1);o.tileMatrixLabels=a}null==o.maxVisLevel&&(null==o.tileMatrixLabels?o.maxVisLevel=u.level:o.maxVisLevel=o.tileMatrixLabels.length),null==o.tileWidth&&(o.tileWidth=256),null==o.tileHeight&&(o.tileHeight=256),null==o.rectangle&&(o.rectangle=[-180,-180,180,180]);var r=Cesium.Rectangle.fromDegrees(o.rectangle[0],o.rectangle[1],o.rectangle[2],o.rectangle[3]);null==o.projection||CgsTimeDynamicTileLayer3D.MERCATOR==o.projection?o.numberOfLevelZeroTilesXY?o.tilingScheme=new Cesium.WebMercatorTilingScheme({numberOfLevelZeroTilesX:o.numberOfLevelZeroTilesXY[0],numberOfLevelZeroTilesY:o.numberOfLevelZeroTilesXY[1],rectangle:r}):o.tilingScheme=new Cesium.WebMercatorTilingScheme({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,rectangle:r}):CgsTimeDynamicTileLayer3D.WGS84==o.projection&&(o.numberOfLevelZeroTilesXY?o.tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:o.numberOfLevelZeroTilesXY[0],numberOfLevelZeroTilesY:o.numberOfLevelZeroTilesXY[1],rectangle:r}):o.tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,rectangle:r}));var l=new Cesium.WebMapTileServiceImageryProvider(_defineProperty({format:o.format,url:o.url,layer:o.layer,style:o.style,tileMatrixSetID:o.tileMatrixSetID,tileMatrixLabels:o.tileMatrixLabels,maximumLevel:o.maximumLevel,minimumLevel:o.minimumLevel,tileWidth:o.tileWidth,tileHeight:o.tileHeight,ellipsoid:Cesium.Ellipsoid.WGS84,tilingScheme:o.tilingScheme,proxy:o.proxy?new Cesium.DefaultProxy(o.proxy):null,clock:h.clock,times:h.times,levelTimes:h.levelTimes,timesUrl:h.timesUrl,key:h.key},"layer",h));pro=l,CgsLayer3D.call(h,l,o),o.maxHeight&&h.setMaxHeight(o.maxHeight),o.minHeight&&h.setMinHeight(o.minHeight),h.imageryProvider.timesChanged.addEventListener(h.updateFromTimes,h)}else console.log("时间包无数据！")},error:function(){h.ready=!1}})}),CgsTimeDynamicTileLayer3D.MERCATOR="EPSG:102113",CgsTimeDynamicTileLayer3D.WGS84="EPSG:4326",CgsInherits(CgsTimeDynamicTileLayer3D,CgsLayer3D),CgsTimeDynamicTileLayer3D.prototype.calculateTimes=function(e){var t=[],i=[];this.secondsTimes=e;for(var s=0;s<e.length;++s)0==s?(i.push(e[s]-(e[s+1]-e[s])/2),i.push(e[s]+(e[s+1]-e[s])/2)):s==e.length-1?i.push(e[s]+(e[s]-e[s-1])/2):i.push(e[s]+(e[s+1]-e[s])/2);this.timeBarSecondsSpan=i[i.length-1]-i[0],this.startSeconds=i[0],this.stopSeconds=i[i.length-1];for(var o=0;o<i.length;++o){var a=(this.startDate+i[o])/Cesium.TimeConstants.SECONDS_PER_DAY,n=(this.startDate+i[o])%Cesium.TimeConstants.SECONDS_PER_DAY,r=new Cesium.JulianDate(parseInt(a),n),l=Cesium.JulianDate.toIso8601(r);t.push(l)}this.start=t[0],this.stop=t[t.length-1],this.JulianDateTimes=t;for(var u=[],p=0;p<e.length;++p){var h=new Cesium.TimeInterval({start:Cesium.JulianDate.fromIso8601(t[p]),stop:Cesium.JulianDate.fromIso8601(t[p+1]),isStartIncluded:!0,isStopIncluded:!1,data:{Time:e[p]}});u.push(h)}return new Cesium.TimeIntervalCollection(u)},CgsTimeDynamicTileLayer3D.prototype.setClockCurrentTime=function(e){this.clock.currentTime=this.imageryProvider.clock.currentTime=Cesium.JulianDate.addSeconds(Cesium.JulianDate.fromIso8601(this.start),e,new Cesium.JulianDate);var t=this.makeLabel(this.clock.currentTime);t+='<div class="timeline-triangle"></div>',this.currentTimeElement.innerHTML=t,this.currentTimeElement.style.left=this.scrubElement.offsetLeft-this.currentTimeElement.offsetWidth/2+this.scrubElement.offsetWidth/2+"px",this.currentTimeSeconds=this.startSeconds+e,this.imageryProvider.clock.tick()},CgsTimeDynamicTileLayer3D.prototype.createTimeLine=function(){var e=this.state.name;this.body=$$(" \n\t<div class=\"timeline-title\">\n\t\t<div class=\"timeline-titleLabel\"></div>\n\t\t<button id=\"close\"  type='button'  class='timeline-closeButton'></button>\n\t</div>   \n\t<div class='timeline_body'>\n\t\t<button id=\"back\"  type='button'  class='timeline-backButton'></button>\n\t\t<div class='timeline_bar'>\n\t\t</div>\n\t\t<button id=\"forward\"  type='button'  class='timeline-forwardButton'</button>\n\t</div>\n\t<span class=\"timeline-ruler\"></span>\t       \n\t"),this.timeBarEle=this.body[2].children[1],this.backButtonEle=this.body[2].children[0],this.forwardButtonEle=this.body[2].children[2],this.rulerEle=this.body[4],this.titleLabelEle=this.body[0].children[0],this.closeButtonEle=this.body[0].children[1],this.closeButtonEle.style.display="none",this.titleLabelEle.innerHTML=e;var n=this;function t(e){var t,i;n.mouseDownFlag&&(t=Math.round(e.clientX-n.timeBarEle.getBoundingClientRect().left),i=$$(n.timeBarEle).width(),t<0?t=0:i<t&&(t=i),n.scrubElement&&(n.scrubElement.style="left:"+(t-5.5)+"px"),n.setClockCurrentTime(t*n.timeBarSecondsSpan/i)),e.preventDefault()}this.backButtonEle.onclick=function(){for(var e,t=$$(n.timeBarEle).width(),i=n.secondsTimes.length,s=0;s<i;++s){var o=n.currentTimeSeconds-n.secondsTimes[s];0==s&&o<=0?e=0:(s==i-1&&0<o||0<o&&n.currentTimeSeconds-n.secondsTimes[s+1]<=0)&&(e=n.secondsTimes[s]-n.startSeconds)}var a=Math.round(e/n.timeBarSecondsSpan*t);n.scrubElement&&(n.scrubElement.style="left:"+(a-5.5)+"px"),n.setClockCurrentTime(e)},this.forwardButtonEle.onclick=function(){for(var e,t=$$(n.timeBarEle).width(),i=n.secondsTimes.length,s=0;s<i;++s){var o=n.currentTimeSeconds-n.secondsTimes[s];0==s&&o<0?e=n.secondsTimes[s]-n.startSeconds:s==i-1&&0<=o?e=n.stopSeconds-n.startSeconds:o<0&&0<=n.currentTimeSeconds-n.secondsTimes[s-1]&&(e=n.secondsTimes[s]-n.startSeconds)}var a=Math.round(e/n.timeBarSecondsSpan*t);n.scrubElement&&(n.scrubElement.style="left:"+(a-5.5)+"px"),n.setClockCurrentTime(e)},document.addEventListener("mousemove",t,!1),this.timeBarEle.addEventListener("mousedown",function(e){0==e.button&&(n.mouseDownFlag=!0,t(e)),e.preventDefault()},!1),document.addEventListener("mouseup",function(e){0==e.button&&(n.mouseDownFlag=!1),e.preventDefault()},!1)},CgsTimeDynamicTileLayer3D.prototype.makeLabel=function(e){var t=Cesium.JulianDate.toGregorianDate(e),i=t.millisecond,s=" UTC";if(0<i&&this.timeBarSecondsSpan<3600){for(s=Math.floor(i).toString();s.length<3;)s="0"+s;s="."+s}return t.year+"/"+t.month+"/"+t.day},CgsTimeDynamicTileLayer3D.prototype.makeTics=function(){var e=this.timeBarEle,t=$$(this.timeBarEle).width(),i=this.currentTimeSeconds-this.startSeconds,s="";s+='<span class="timeline-icon" style="left:'+(Math.round(i*t/this.timeBarSecondsSpan)-6)+'px;"></span>';var o=this.makeLabel(Cesium.JulianDate.fromIso8601(this.start));this.rulerEle.innerHTML=o;var a=this.rulerEle.offsetWidth,n=0-(a/2-1);s+='<span class="timeline-ticLabel" style="left: '+n.toString()+'px;">'+o+"</span>";var r=this.secondsTimes.length;s+='<span class="timeline-ticLabel" id = mTime style="left:'+(t/2-a/2)+'px; top: -20px; display: none;">'+o+"</span>";var p=this;function l(e){var t=e.currentTarget,i=t.offsetLeft,s=document.getElementById("mTime"),o=Number(t.id.slice(-1)),a=(p.startDate+p.secondsTimes[o])/Cesium.TimeConstants.SECONDS_PER_DAY,n=(p.startDate+p.secondsTimes[o])%Cesium.TimeConstants.SECONDS_PER_DAY,r=new Cesium.JulianDate(parseInt(a),n),l=p.makeLabel(r);p.rulerEle.innerHTML=l;var u=i-p.rulerEle.offsetWidth/2;s.innerHTML=l,s.style.left=u+"px",s.style.display="block"}function u(e){document.getElementById("mTime").style.display="none"}for(var h=0;h<r;++h){i=this.secondsTimes[h]-this.startSeconds;var c=Math.round(i*t/this.timeBarSecondsSpan);s+='<span class="timeline-ticTiny" id = ticTiny'+h.toString()+' style="left: '+c.toString()+'px;"></span>'}o=this.makeLabel(Cesium.JulianDate.fromIso8601(this.stop)),this.rulerEle.innerHTML=o,s+='<span class="timeline-ticLabel" style="left: '+(n=t-this.rulerEle.offsetWidth/2).toString()+'px;">'+o+"</span>",o=this.makeLabel(this.clock.currentTime),s+='<span class="timeline-label" style="left: '+(n=-31).toString()+'px;">'+o+'<div class="timeline-triangle"></div></span>',e.innerHTML=s,this.scrubElement=e.firstChild,this.currentTimeElement=e.lastChild;for(var g=0;g<r;++g){var d=document.getElementById("ticTiny"+g);d.addEventListener("mouseover",l,!1),d.addEventListener("mouseout",u,!1)}},CgsTimeDynamicTileLayer3D.prototype.updateFromTimes=function(){var e,t,i,s=this.imageryProvider.levelTimes,o=this.imageryProvider.key;this.levelTimes.get(this.key).toString()!=s.get(o).toString()?(this.key=o,e=this.levelTimes.get(this.key),this.times=this.calculateTimes(e),t=Cesium.JulianDate.fromIso8601(this.start),i=Cesium.JulianDate.fromIso8601(this.stop),this.clock.startTime=this.imageryProvider.clock.startTime=t,this.clock.stopTime=this.imageryProvider.clock.stopTime=i,this.currentTimeSeconds<this.startSeconds&&(this.clock.currentTime=this.imageryProvider.clock.currentTime=t,this.currentTimeSeconds=this.startSeconds),this.currentTimeSeconds>this.stopSeconds&&(this.clock.currentTime=this.imageryProvider.clock.currentTime=i,this.currentTimeSeconds=this.stopSeconds),this.makeTics(),this.imageryProvider.times=this.times):this.key=o},Cgs3DTilesetLayer3D=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t=null;e.proxy=void 0===e.proxy||e.proxy,t="string"==typeof e.proxy?e.proxy:e.proxy?CGS_SDK_PATH+"proxy/proxy.jsp?address=":null;var i={name:e.name,type:"WMTS",url:e.url,layer:e.layer,rectangle:e.rectangle,level:e.level,text:e.text,pId:e.pId,visible:1==e.visible,format:e.format,style:e.style,tileMatrixSetID:e.tileMatrixSetID,tileMatrixLabels:e.tileMatrixLabels,tileWidth:e.tileWidth,tileHeight:e.tileHeight,minimumLevel:e.minimumLevel,maximumLevel:e.maximumLevel,minVisLevel:e.minVisLevel,maxVisLevel:e.maxVisLevel,numberOfLevelZeroTilesXY:e.numberOfLevelZeroTilesXY,projection:e.projection,isAddToLayerTree:1==e.isAddToLayerTree,proxy:t};if(null==(this.state=i).maximumLevel&&(i.maximumLevel=e.level),null==i.layer&&(i.layer=e.name),null==i.text&&(i.text=e.layer),null==i.style&&(i.style="default"),null==i.tileMatrixSetID&&(i.tileMatrixSetID="OGC_WebMercator"),null==i.minimumLevel&&(i.minimumLevel=0),null==i.format&&(i.format="image/png"),null==i.tileMatrixLabels){for(var s=[],o=i.minimumLevel;o<i.maximumLevel;o++)i.numberOfLevelZeroTilesXY&&10===i.numberOfLevelZeroTilesXY[0]&&5===i.numberOfLevelZeroTilesXY[1]&&"OGC_WGS84"===i.tileMatrixSetID?s.push(o-4):s.push(o+1);i.tileMatrixLabels=s}null==i.maxVisLevel&&(null==i.tileMatrixLabels?i.maxVisLevel=e.level:i.maxVisLevel=i.tileMatrixLabels.length),null==i.tileWidth&&(i.tileWidth=256),null==i.tileHeight&&(i.tileHeight=256),null==i.rectangle&&(i.rectangle=[-180,-180,180,180]);var a=Cesium.Rectangle.fromDegrees(i.rectangle[0],i.rectangle[1],i.rectangle[2],i.rectangle[3]);null==i.projection||Cgs3DTilesetLayer3D.MERCATOR==i.projection?i.numberOfLevelZeroTilesXY?i.tilingScheme=new Cesium.WebMercatorTilingScheme({numberOfLevelZeroTilesX:i.numberOfLevelZeroTilesXY[0],numberOfLevelZeroTilesY:i.numberOfLevelZeroTilesXY[1],rectangle:a}):i.tilingScheme=new Cesium.WebMercatorTilingScheme({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,rectangle:a}):Cgs3DTilesetLayer3D.WGS84==i.projection&&(i.numberOfLevelZeroTilesXY?i.tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:i.numberOfLevelZeroTilesXY[0],numberOfLevelZeroTilesY:i.numberOfLevelZeroTilesXY[1],rectangle:a}):i.tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,rectangle:a}));var n=new Cesium.WebMapTileServiceImageryProvider(_defineProperty({format:i.format,url:i.url,layer:i.layer,style:i.style,tileMatrixSetID:i.tileMatrixSetID,tileMatrixLabels:i.tileMatrixLabels,maximumLevel:i.maximumLevel,minimumLevel:i.minimumLevel,tileWidth:i.tileWidth,tileHeight:i.tileHeight,ellipsoid:Cesium.Ellipsoid.WGS84,tilingScheme:i.tilingScheme,proxy:i.proxy?new Cesium.DefaultProxy(i.proxy):null,clock:this.clock,times:this.times,levelTimes:this.levelTimes,timesUrl:this.timesUrl,key:this.key},"layer",this));this.pro=n,this.tilesetList=[],this.tilesetKeyCache=[],this.limitLevel=Cesium.defaultValue(e.limitLevel,15),this.heightOffset=Cesium.defaultValue(e.heightOffset,-138),CgsLayer3D.call(this,n,i),i.maxHeight&&this.setMaxHeight(i.maxHeight),i.minHeight&&this.setMinHeight(i.minHeight)}),Cgs3DTilesetLayer3D.MERCATOR="EPSG:102113",Cgs3DTilesetLayer3D.WGS84="EPSG:4326",CgsInherits(Cgs3DTilesetLayer3D,CgsLayer3D),Cgs3DTilesetLayer3D.prototype.setLimitLevel=function(e){this.limitLevel=e},Cgs3DTilesetLayer3D.prototype.getLimitLevel=function(){return this.limitLevel},CgsPhaseArrayRadar3D=function(e){var t,i,s;this.position=Cesium.defaultValue(e.position,[120,40,5e3]),this.headingPitchRoll=Cesium.defaultValue(e.headingPitchRoll,[90,0,0]),this.radius=Cesium.defaultValue(e.radius,1e5),this.xAngle=Cesium.defaultValue(e.xAngle,100),this.yAngle=Cesium.defaultValue(e.yAngle,100),this.surfaceColor=Cesium.defaultValue(e.surfaceColor,"rgba(0,255,255,0.4)"),this.lineColor=Cesium.defaultValue(e.lineColor,"rgba(0,255,255,1.0)"),this.showDomeSurfaces=Cesium.defaultValue(e.showDomeSurfaces,!0),this.showDomeLines=Cesium.defaultValue(e.showDomeLines,!0),this.showLateralSurfaces=Cesium.defaultValue(e.showLateralSurfaces,!0),this.showLateralLines=Cesium.defaultValue(e.showLateralLines,!0),this.showScanPlane=Cesium.defaultValue(e.showScanPlane,!0),this.scanPlaneColor=Cesium.defaultValue(e.scanPlaneColor,"rgba(0,255,255,1.0)"),this.scanPlaneMode=Cesium.defaultValue(e.scanPlaneMode,"vertical"),this.scanPlaneRate=Cesium.defaultValue(e.scanPlaneRate,3),this.showThroughEllipsoid=Cesium.defaultValue(e.showThroughEllipsoid,!1),this.show=Cesium.defaultValue(e.show,!0),this.position&&(2==this.position.length&&(this.position[2]=0),t=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2]),i=new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(this.headingPitchRoll[0]),Cesium.Math.toRadians(this.headingPitchRoll[1]),Cesium.Math.toRadians(this.headingPitchRoll[2])),s={show:this.show,position:t,orientation:Cesium.Transforms.headingPitchRollQuaternion(t,i),rectangularSensor:new Cesium.RectangularSensorGraphics({radius:this.radius,xHalfAngle:Cesium.Math.toRadians(this.xAngle/2),yHalfAngle:Cesium.Math.toRadians(this.yAngle/2),material:Cesium.Color.fromCssColorString(this.surfaceColor),lineColor:Cesium.Color.fromCssColorString(this.lineColor),showDomeSurfaces:this.showDomeSurfaces,showDomeLines:this.showDomeLines,showLateralSurfaces:this.showLateralSurfaces,showLateralLines:this.showLateralLines,showScanPlane:this.showScanPlane,scanPlaneColor:Cesium.Color.fromCssColorString(this.scanPlaneColor),scanPlaneMode:this.scanPlaneMode,scanPlaneRate:this.scanPlaneRate,showThroughEllipsoid:this.showThroughEllipsoid})},CgsRadar3D.call(this,e),this._primitive=new Cesium.Entity(s),this._type=CgsRadar3D.PHASEARRAY_RADAR)},CgsInherits(CgsPhaseArrayRadar3D,CgsRadar3D),CgsPhaseArrayRadar3D.prototype.getBoundingSphere=function(){var e=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2]),t=this.radius;return new Cesium.BoundingSphere(e,t)},CgsPhaseArrayRadar3D.prototype.setVisible=function(e){this.show=e,this._primitive.show=e},CgsPhaseArrayRadar3D.prototype.getVisible=function(){return this._primitive.show},CgsPhaseArrayRadar3D.prototype.setSurfaceColor=function(e){this.surfaceColor=e,this._primitive.rectangularSensor.material=Cesium.Color.fromCssColorString(e)},CgsPhaseArrayRadar3D.prototype.getSurfaceColor=function(){return this.surfaceColor},CgsPhaseArrayRadar3D.prototype.setLineColor=function(e){this.lineColor=e,this._primitive.rectangularSensor.lineColor=Cesium.Color.fromCssColorString(e)},CgsPhaseArrayRadar3D.prototype.getLineColor=function(){return this.lineColor},CgsPhaseArrayRadar3D.prototype.setScanPlaneColor=function(e){this.scanPlaneColor=e,this._primitive.rectangularSensor.scanPlaneColor=Cesium.Color.fromCssColorString(e)},CgsPhaseArrayRadar3D.prototype.getScanPlaneColor=function(){return this.scanPlaneColor},CgsPhaseArrayRadar3D.prototype.setDomeSurfacesVisible=function(e){this.showDomeSurfaces=e,this._primitive.rectangularSensor.showDomeSurfaces=e},CgsPhaseArrayRadar3D.prototype.getDomeSurfacesVisible=function(){return this.showDomeSurfaces},CgsPhaseArrayRadar3D.prototype.setDomeLinesVisible=function(e){this.showDomeLines=e,this._primitive.rectangularSensor.showDomeLines=e},CgsPhaseArrayRadar3D.prototype.getDomeLinesVisible=function(){return this.showDomeLines},CgsPhaseArrayRadar3D.prototype.setLateralSurfacesVisible=function(e){this.showLateralSurfaces=e,this._primitive.rectangularSensor.showLateralSurfaces=e},CgsPhaseArrayRadar3D.prototype.getLateralSurfacesVisible=function(){return this.showLateralSurfaces},CgsPhaseArrayRadar3D.prototype.setLateralLinesVisible=function(e){this.showLateralLines=e,this._primitive.rectangularSensor.showLateralLines=e},CgsPhaseArrayRadar3D.prototype.getLateralLinesVisible=function(){return this.showLateralLines},CgsPhaseArrayRadar3D.prototype.setScanPlaneVisible=function(e){this.showScanPlane=e,this._primitive.rectangularSensor.showScanPlane=e},CgsPhaseArrayRadar3D.prototype.getScanPlaneVisible=function(){return this.showScanPlane},CgsPhaseArrayRadar3D.prototype.setScanPlaneMode=function(e){this.scanPlaneMode=e,this._primitive.rectangularSensor.scanPlaneMode=e},CgsPhaseArrayRadar3D.prototype.getScanPlaneMode=function(){return this.scanPlaneMode},CgsPhaseArrayRadar3D.prototype.setScanPlaneRate=function(e){this.scanPlaneRate=e,this._primitive.rectangularSensor.scanPlaneRate=e},CgsPhaseArrayRadar3D.prototype.getScanPlaneRate=function(){return this.scanPlaneRate},CgsPhaseArrayRadar3D.prototype.setThroughEllipsoidVisible=function(e){this.showThroughEllipsoid=e,this._primitive.rectangularSensor.showThroughEllipsoid=e},CgsPhaseArrayRadar3D.prototype.getThroughEllipsoidVisible=function(){return this.showThroughEllipsoid},CgsPhaseArrayRadar3D.prototype.setXAngle=function(e){this.xAngle=e,this._primitive.rectangularSensor.xHalfAngle=Cesium.Math.toRadians(e/2)},CgsPhaseArrayRadar3D.prototype.getXAngle=function(){return this.xAngle},CgsPhaseArrayRadar3D.prototype.setYAngle=function(e){this.yAngle=e,this._primitive.rectangularSensor.yHalfAngle=Cesium.Math.toRadians(e/2)},CgsPhaseArrayRadar3D.prototype.getYAngle=function(){return this.yAngle},CgsPhaseArrayRadar3D.prototype.setPosition=function(e){this.position=e,this._primitive.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2])},CgsPhaseArrayRadar3D.prototype.getPosition=function(){return this.position},CgsPhaseArrayRadar3D.prototype.setRadius=function(e){this.radius=e,this._primitive.rectangularSensor.radius=e},CgsPhaseArrayRadar3D.prototype.getRadius=function(){return this.radius},CgsPhaseArrayRadar3D.prototype.setHeading=function(e){this.headingPitchRoll[0]=e,this.setHeadingPitchRoll()},CgsPhaseArrayRadar3D.prototype.getHeading=function(){return this.headingPitchRoll[0]},CgsPhaseArrayRadar3D.prototype.setPitch=function(e){this.headingPitchRoll[1]=e,this.setHeadingPitchRoll()},CgsPhaseArrayRadar3D.prototype.getPitch=function(){return this.headingPitchRoll[1]},CgsPhaseArrayRadar3D.prototype.setRoll=function(e){this.headingPitchRoll[2]=e,this.setHeadingPitchRoll()},CgsPhaseArrayRadar3D.prototype.getRoll=function(){return this.headingPitchRoll[2]},CgsPhaseArrayRadar3D.prototype.setHeadingPitchRoll=function(){var e=Cesium.Cartesian3.fromDegrees(this.position[0],this.position[1],this.position[2]),t=new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(this.headingPitchRoll[0]),Cesium.Math.toRadians(this.headingPitchRoll[1]),Cesium.Math.toRadians(this.headingPitchRoll[2]));this._primitive.orientation=Cesium.Transforms.headingPitchRollQuaternion(e,t)},CgsLayer=function(e){this.isAddToLayerTree=1==e.isAddToLayerTree},CgsLayer.prototype.setName=function(e){this.layer3D&&this.layer3D.setName(e),this.layer2D&&this.layer2D.setName(e)},CgsLayer.prototype.getName=function(){return this.layer3D?this.layer3D.getName():this.layer2D?this.layer2D.getName():void 0},CgsLayer.prototype.getId=function(){return this.layer3D?this.layer3D.getId():this.layer2D?this.layer2D.getId():void 0},CgsLayer.prototype.setText=function(e){this.layer3D&&this.layer3D.setText(e),this.layer2D&&this.layer2D.setText(e)},CgsLayer.prototype.getText=function(){return this.layer3D?this.layer3D.getText():this.layer2D?this.layer2D.getText():void 0},CgsLayer.prototype.setGroup=function(e){this.groupName=e.name,e.array.push(this)},CgsLayer.prototype.getGroup=function(){return this.groupName},CgsLayer.prototype.setVisible=function(e){this.getVisible()!=e&&(this.layer3D&&this.layer3D.setVisible(e),this.layer2D&&this.layer2D.setVisible(e),CgsSubPub.publish("layervisiblechanged",[this,e]))},CgsLayer.prototype.getVisible=function(){return this.layer3D?this.layer3D.getVisible():this.layer2D?this.layer2D.getVisible():void 0},CgsLayer.prototype.setMap=function(e){this.map=e},CgsLayer.prototype.getMap=function(){return this.map},CgsLayer.prototype.getIndex=function(){var e;if(e=this.getMap())return e.allLayers.indexOf(this)},CgsLayer.prototype.getType=function(){return this.layer3D?this.layer3D.getType():this.layer2D?this.layer2D.getType():void 0},CgsLayer.prototype.setPId=function(e){this.layer3D&&this.layer3D.setPId(e),this.layer2D&&this.layer2D.setPId(e)},CgsLayer.prototype.getPId=function(){return this.layer3D?this.layer3D.getPId():this.layer2D?this.layer2D.getPId():void 0},CgsLayer.prototype.setAddToLayerTree=function(e){this.isAddToLayerTree=e,CgsSubPub.publish("layerGroupChanged",[this])},CgsLayer.prototype.getAddToLayerTree=function(){return this.isAddToLayerTree},CgsLayer.prototype.moveUp=function(){if(this.layer3D&&this.layer3D.moveUp(),this.layer2D){for(var e=this.map.map2D.getLayerGroup().getLayers().array_,t=0;t<e.length-1;t++)if(e[t]==this.layer2D){var i=e[t+1];e[t]=i,e[t+1]=this.layer2D,this.map.map2D.render();break}for(e=this.getMap().allLayers,t=0;t<e.length-1;t++)if(e[t]==this&&t+1<e.length-1){i=e[t+1];e[t+1]=e[t],e[t]=i;break}}},CgsLayer.prototype.moveDown=function(){if(this.layer3D.moveDown(),this.layer2D){for(var e=this.map.map2D.getLayerGroup().getLayers().array_,t=1;t<e.length;t++)if(e[t]==this.layer2D){var i=e[t-1];e[t]=i,e[t-1]=this.layer2D,this.map.map2D.render();break}for(e=this.getMap().allLayers,t=0;t<e.length-1;t++)if(e[t]==this&&0<t-1){i=e[t-1];e[t-1]=e[t],e[t]=i;break}}},CgsLayer.prototype.setZindex=function(e){if(this.layer3D){e>this.map.allLayers.length-1&&(e=this.map.allLayers.length-1);var t=this.getZindex();if(t<e)for(var i=0;i<e-t;i++)this.moveUp();else if(e<t)for(var s=0;s<t-e;s++)this.moveDown()}},CgsLayer.prototype.getZindex=function(e){if(this.layer3D)return this.layer3D._layerIndex},CgsLayer.prototype.moveToTop=function(){if(this.layer3D&&this.layer3D.moveToTop(),this.layer2D){for(var e=this.map.map2D.getLayerGroup().getLayers().array_,t=[],i=0;i<e.length;i++)e[i]!=this.layer2D&&t.push(e[i]);t.push(this.layer2D),this.map.map2D.getLayerGroup().getLayers().array_=t,this.map.map2D.render()}},CgsLayer.prototype.moveToBottom=function(){if(this.layer3D&&this.layer3D.moveToBottom(),this.layer2D){var e=this.map.map2D.getLayerGroup().getLayers().array_,t=[];t.push(this.layer2D);for(var i=0;i<e.length;i++)e[i]!=this.layer2D&&t.push(e[i]);this.map.map2D.getLayerGroup().getLayers().array_=t,this.map.map2D.render()}},CgsLayer.prototype.getMaxHeight=function(){if(this.layer3D)return this.layer3D.getMaxHeight()},CgsLayer.prototype.getMinHeight=function(){if(this.layer3D)return this.layer3D.getMinHeight()},CgsLayer.prototype.setMaxHeight=function(e){this.layer3D&&this.layer3D.setMaxHeight(e)},CgsLayer.prototype.setMinHeight=function(e){this.layer3D&&this.layer3D.setMinHeight(e)},CgsLayer.prototype.setBrightness=function(e){this.layer3D&&this.layer3D.setBrightness(e)},CgsLayer.prototype.getUrl=function(){if(this.layer3D)return this.layer3D.getUrl()},CgsLayer.prototype.getLevel=function(){if(this.layer3D)return this.layer3D.getLevel()},CgsLayer.prototype.getProjection=function(){if(this.layer3D)return this.layer3D.getProjection()},CgsLayer.prototype.getVersion=function(){if(this.layer3D)return this.layer3D.getVersion()},CgsLayer.prototype.getExtent=function(){if(this.layer3D)return this.layer3D.getExtent()},CgsLayer.prototype.getBrightness=function(){if(this.layer3D)return this.layer3D.getBrightness()},CgsLayer.prototype.setAlpha=function(e){this.layer3D&&this.layer3D.setAlpha(e),this.layer2D&&this instanceof CgsTileLayer&&this.layer2D.setOpacity(e)},CgsLayer.prototype.getAlpha=function(){if(this.layer3D)return this.layer3D.getAlpha()},CgsLayer.prototype.setContrast=function(e){this.layer3D&&this.layer3D.setContrast(e)},CgsLayer.prototype.getContrast=function(){this.layer3D&&this.layer3D.getContrast()},CgsLayer.prototype.setHue=function(e){this.layer3D&&this.layer3D.setHue(e)},CgsLayer.prototype.getHue=function(){this.layer3D&&this.layer3D.getHue()},CgsLayer.prototype.setSaturation=function(e){this.layer3D&&this.layer3D.setSaturation(e)},CgsLayer.prototype.getSaturation=function(){this.layer3D&&this.layer3D.getSaturation()},CgsLayer.prototype.setGamma=function(e){this.layer3D&&this.layer3D.setGamma(e)},CgsLayer.prototype.getGamma=function(){this.layer3D&&this.layer3D.getGamma()},CgsLayer.prototype.setCustomColor=function(e,t,i){this.layer3D&&this.layer3D.setCustomColor(e,t,i)},CgsLayer.prototype.getCustomColor=function(){if(this.layer3D)return this.layer3D.getCustomColor()},CgsLayer.prototype.setSaveFlag=function(e){this.layer3D&&this.layer3D.setSaveFlag(e)},CgsLayer.prototype.getSaveFlag=function(){if(this.layer3D)return this.layer3D.getSaveFlag()},CgsLayer.prototype.getMaxVisLevel=function(){if(this.layer3D)return this.layer3D.getMaxVisLevel()},CgsLayer.prototype.getMinVisLevel=function(){if(this.layer3D)return this.layer3D.getMinVisLevel()},CgsImageLayer=function(e){CgsLayer.call(this,e),CgsFeature.call(this,e),1==window.WGMODEFLAG?(this.layer2D=new CgsImageLayer2D(e),this.layer3D=new CgsImageLayer3D(e)):2==window.WGMODEFLAG?this.layer2D=new CgsImageLayer2D(e):3==window.WGMODEFLAG&&(this.layer3D=new CgsImageLayer3D(e))},CgsInherits(CgsImageLayer,CgsLayer),CgsImageLayer.prototype.save=function(){return{type:"Image",name:this.getName(),url:this.getUrl(),rec:this.getExtent(),isAddToLayerTree:this.getAddToLayerTree(),text:this.getText(),visible:this.getVisible(),pId:this.getPId()}},CgsImageLayer.load=function(e,t){var i=new CgsImageLayer(t);e.addLayer(i)},CgsMobileHandle=function(){this.map=map,this.interval=null,this.mobileArr=[],this.idList=0},CgsMobileHandle.prototype.measureDistance=function(e,t,i,s){return this.scaleDistance(e,t,i,s)},CgsMobileHandle.prototype.scaleDistance=function(e,t,i,s){var o=e.model?e.model:e.mark,a=t.model?t.model:t.mark,n=o.getPosition(),r=a.getPosition(),l=i;"none"!=s&&(s||(s=new CgsLine({name:"",positions:[n,r],followSurface:!1,width:1,fillColor:"rgba(0,153,225,1)"})),map.addFeature(s));var u=document.createElement("div");u.className="cgstooltip cgstooltip-measure",u.style.pointerEvents="none";var p=new CgsOverlay({position:[0,0],element:u,offset:[0,-6],positioning:"bottom-center",stopEvent:!1});p.setPosition(n),map.addOverlay(p);var h,c={mobileA:e,mobileB:t,objA:o,objB:a,posA:n,posB:r,callBack:l,line:s,overlay:p,el:u,id:this.idList};return this.idList++,this.mobileArr.push(c),this.interval||((h=this).interval=setInterval(function(){for(var e,t,i=0;i<h.mobileArr.length;i++){"3D"==this.map.mode&&(h.mobileArr[i].objA.getPosition()==h.mobileArr[i].posA&&h.mobileArr[i].objB.getPosition()==h.mobileArr[i].posB||(e=this.map.getAzimuthByCoor(h.mobileArr[i].objA.getPosition(),h.mobileArr[i].objB.getPosition()),t=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(h.mobileArr[i].objA.getPosition()[0],h.mobileArr[i].objA.getPosition()[1],h.mobileArr[i].objA.getPosition()[2]),Cesium.Cartesian3.fromDegrees(h.mobileArr[i].objB.getPosition()[0],h.mobileArr[i].objB.getPosition()[1],h.mobileArr[i].objB.getPosition()[2])),h.mobileArr[i].el.innerHTML="距离："+(t/1e3).toFixed(2)+"km<br>方向角："+e.toFixed(2)+"度",h.mobileArr[i].overlay.setPosition(h.mobileArr[i].objA.getPosition()),"none"!=h.mobileArr[i].line&&h.mobileArr[i].line.setPosition([h.mobileArr[i].objB.getPosition(),h.mobileArr[i].objA.getPosition()]),h.mobileArr[i].callBack&&h.mobileArr[i].callBack(t,e)),h.mobileArr[i].posA=h.mobileArr[i].objA.getPosition(),h.mobileArr[i].posB=h.mobileArr[i].objB.getPosition()),"2D"==this.map.mode&&(h.mobileArr[i].mobileA.mark.feature2D.getPosition()==h.mobileArr[i].posA&&h.mobileArr[i].mobileB.mark.feature2D.getPosition()==h.mobileArr[i].posB||(e=this.map.getAzimuthByCoor(h.mobileArr[i].mobileA.mark.feature2D.getPosition(),h.mobileArr[i].mobileB.mark.feature2D.getPosition()),t=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(h.mobileArr[i].mobileA.mark.feature2D.getPosition()[0],h.mobileArr[i].mobileA.mark.feature2D.getPosition()[1],h.mobileArr[i].mobileA.mark.feature2D.getPosition()[2]),Cesium.Cartesian3.fromDegrees(h.mobileArr[i].mobileB.mark.feature2D.getPosition()[0],h.mobileArr[i].mobileB.mark.feature2D.getPosition()[1],h.mobileArr[i].mobileB.mark.feature2D.getPosition()[2])),h.mobileArr[i].el.innerHTML="距离："+(t/1e3).toFixed(2)+"km<br>方向角："+e.toFixed(2)+"度",h.mobileArr[i].overlay.setPosition(h.mobileArr[i].mobileA.mark.feature2D.getPosition()),"none"!=h.mobileArr[i].line&&h.mobileArr[i].line.setPosition([h.mobileArr[i].mobileA.mark.feature2D.getPosition(),h.mobileArr[i].mobileB.mark.feature2D.getPosition()]),h.mobileArr[i].callBack&&h.mobileArr[i].callBack(t,e)),h.mobileArr[i].posA=h.mobileArr[i].mobileA.mark.feature2D.getPosition(),h.mobileArr[i].posB=h.mobileArr[i].mobileB.mark.feature2D.getPosition())}},10)),this.idList-1},CgsMobileHandle.prototype.dispose=function(e){for(var t=0;t<this.mobileArr.length;t++)this.mobileArr[t].id==e&&(this.map.removeFeature(this.mobileArr[t].line),this.map.removeOverlay(this.mobileArr[t].overlay),this.mobileArr[t].objA.scaleDistanceCallBack=null,this.mobileArr[t].objB.scaleDistanceCallBack=null,this.mobileArr[t]=null,this.mobileArr.splice(t,1))},CgsMobileHandle.prototype.getOverlay=function(e){for(var t=0;t<this.mobileArr.length;t++)if(this.mobileArr[t].id==e)return this.mobileArr[t].overlay},CgsMobileHandle.prototype.getLine=function(e){for(var t=0;t<this.mobileArr.length;t++)if(this.mobileArr[t].id==e)return this.mobileArr[t].line},CgsSymbolGroup=function(e,t){this.name=e,this.array=[],this.state=null,this.map=t},CgsSymbolGroup.prototype.addSymbol=function(e){return null==e.getGroup()?(e.group=this.name,this.array.push(e),this.array.length):0},CgsSymbolGroup.prototype.removeAllSymbols=function(){for(var e=this.array.length-1;0<=e;e--)this.array[e].group=null;this.array=[]},CgsSymbolGroup.prototype.removeSymbol=function(e){for(var t=0;t<this.array.length;++t)e==this.array[t]&&this.array.splice(t,1);e&&(e.group=null)},CgsSymbolGroup.prototype.getSymbolByUid=function(e){for(var t=0;t<this.array.length;t++)if(this.array[t].node&&this.array[t].getUid()==e)return this.array[t]},CgsSymbolGroup.prototype.getAllSymbols=function(){return this.array},CgsSymbolGroup.prototype.setState=function(e){this.state=e},CgsSymbolGroup.prototype.getState=function(){return this.state},CgsSymbolGroup.prototype.getName=function(){return this.name},CgsSymbolGroup.prototype.destory=function(){for(var e=0;e<this.map.symbolGroups.length;e++)this.map.symbolGroups[e].name==this.name&&this.map.symbolGroups.splice(e,1);for(e=this.array.length-1;0<=e;e--)this.array[e].group=null,this.array.splice(e,1);this.array=[],this.name=null,this.state=null},CgsSymbolLayer=function(e,t){this.id=CgsUtil.generateRandomNumber(8),this.name=e,this.symbolArray=[],this.state=null,this.map=t,this.Visible=!0,this.Editable=!0},CgsSymbolLayer.prototype.addSymbol=function(e){e.layer||(e.setVisible(this.Visible),e.setDectectable(this.Editable),this.symbolArray.push(e),e.layer=this)},CgsSymbolLayer.prototype.removeSymbol=function(e){this.symbolArray.splice(this.symbolArray.indexOf(e),1)},CgsSymbolLayer.prototype.getName=function(){return this.name},CgsSymbolLayer.prototype.setName=function(e){this.name=e},CgsSymbolLayer.prototype.getId=function(e){return this.id},CgsSymbolLayer.prototype.setVisible=function(e){for(var t=0;t<this.symbolArray.length;t++)this.symbolArray[t].setVisible(e);this.Visible=e},CgsSymbolLayer.prototype.setEditable=function(e){for(var t=0;t<this.symbolArray.length;t++)this.symbolArray[t].setDectectable(e);this.Editable=e},CgsSymbolLayer.prototype.exportSymbolsScene=function(e){return map.saveAfferentSymbolsScene(this.symbolArray)},CgsSymbol=function(e){this.uid=null,this.node=null,this.group=null,this.options=e,this.map=null,this.originType=null,this.layerId=e.layerId,this.visible=0!=e.visible},CgsSymbol.prototype.getNodeAttrs=function(e){return this.map.jmpApi.getNodeAttrs(this.node,e)},CgsSymbol.prototype.setNodeAttrs=function(e){this.map.jmpApi.setNodeAttrs(this.node,e)},CgsSymbol.prototype.setPosition=function(e){if(CgsUtil.verifyLonLat(e)){if(this.node){var t=this.node.geometryAttrib;if("[object Array]"==Object.prototype.toString.call(e))for(var i=0,s=e.length;i<s;i++)if(e[i].x)t.SetPoint(i,e[i].x,e[i].y,e[i].z?e[i].z:0);else{if("number"==typeof e[0])return void t.SetPoint(i,e[0],e[1],3==e.length?e[2]:0);"[object Array]"==Object.prototype.toString.call(e[0])&&t.SetPoint(i,e[i][0],e[i][1],3==e[i].length?e[i][2]:0)}else t.SetPoint(0,e.x,e.y,e.z?e[i].z:0)}}else console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsSymbol.prototype.getPosition=function(){if(this.node){var e=null,t=this.node.geometryAttrib,i=t.GetPointCount();if(1==i)e={x:(o=t.GetPoint(0)).x,y:o.y};else{e=[];for(var s=0;s<i;s++){var o=t.GetPoint(s);e.push({x:o.x,y:o.y})}}return e}},CgsSymbol.prototype.getUid=function(){if(this.node)return this.node.id},CgsSymbol.prototype.getNodeName=function(){if(this.node)return this.node.name},CgsSymbol.prototype.getGroup=function(){return this.group},CgsSymbol.prototype.setName=function(e){this.node&&this.setNodeAttrs({annoText:e})},CgsSymbol.prototype.getName=function(){if(this.node)return this.getNodeAttrs({annoText:""}).annoText},CgsSymbol.prototype.setNameSize=function(e){this.node&&this.setNodeAttrs({annoTextSize:e})},CgsSymbol.prototype.getNameSize=function(){if(this.node)return this.getNodeAttrs({annoTextSize:""}).annoTextSize},CgsSymbol.prototype.setNameOffSet=function(e){this.node&&this.setNodeAttrs({annoTextOffSet:e})},CgsSymbol.prototype.getNameOffSet=function(){if(this.node)return this.getNodeAttrs({annoTextOffSet:""}).annoTextOffSet},CgsSymbol.prototype.setNameVisible=function(e){this.node&&this.setNodeAttrs({annoVisibility:e})},CgsSymbol.prototype.getNameVisible=function(){if(this.node)return 1==this.getNodeAttrs({annoVisibility:""}).annoVisibility},CgsSymbol.prototype.setSize=function(e){this.node&&this.setNodeAttrs({width:e[0],height:e[1]})},CgsSymbol.prototype.getSize=function(){if(this.node)return[this.getNodeAttrs({width:""}).width,this.getNodeAttrs({height:""}).height]},CgsSymbol.prototype.setColor=function(e){this.node&&this.setNodeAttrs({color:e})},CgsSymbol.prototype.getColor=function(){if(this.node)return this.getNodeAttrs({color:""}).color},CgsSymbol.prototype.setNameColor=function(e){this.node&&this.setNodeAttrs({annoTextColor:e})},CgsSymbol.prototype.getNameColor=function(){if(this.node)return this.getNodeAttrs({annoTextColor:""}).annoTextColor},CgsSymbol.prototype.setLineColor=function(e){this.node&&this.setNodeAttrs({annoLineColor:e})},CgsSymbol.prototype.getLineColor=function(){if(this.node)return this.getNodeAttrs({annoLineColor:""}).annoLineColor},CgsSymbol.prototype.setInwardText=function(e){var t;!this.node||0<(t=this.node.drawingAttrib).GetInlineTextNum()&&t.SetInlineText(0,e)},CgsSymbol.prototype.getInwardText=function(){if(this.node){var e=this.node.drawingAttrib;if(0<e.GetInlineTextNum())return e.GetInlineText(0)}},CgsSymbol.prototype.setLineVisible=function(e){this.node&&this.setNodeAttrs({annotLineVisibility:e})},CgsSymbol.prototype.getLineVisible=function(){if(this.node)return 1==this.getNodeAttrs({annotLineVisibility:""}).annotLineVisibility},CgsSymbol.prototype.setFill=function(e){this.node&&this.setNodeAttrs({fill:e})},CgsSymbol.prototype.getFill=function(){if(this.node)return this.getNodeAttrs({fill:""}).fill},CgsSymbol.prototype.setFillColor=function(e){this.node&&this.setNodeAttrs({fillColor:e})},CgsSymbol.prototype.getFillColor=function(){if(this.node)return this.getNodeAttrs({fillColor:""}).fillColor},CgsSymbol.prototype.setAngle=function(e){this.node&&this.node.drawingAttrib.SetAngle(e)},CgsSymbol.prototype.getAngle=function(){if(this.node)return this.node.drawingAttrib.GetAngle()},CgsSymbol.prototype.setDragEnable=function(e){this.node.symbolAttrib.SetMoveable(e)},CgsSymbol.prototype.setEditable=function(e){this.node.symbolAttrib.SetEditable(e)},CgsSymbol.prototype.setDectectable=function(e){this.node.symbolAttrib.SetDetectable(e)},CgsSymbol.prototype.setVisible=function(e){this.node.symbolAttrib.SetVisibility(e)},CgsSymbol.prototype.getVisible=function(){if(this.node)return this.node.symbolAttrib.GetVisibility()},CgsSymbol.prototype.setAnnoMoveable=function(e){this.node.symbolAttrib.SetMoveable(e)},CgsSymbol.prototype.getAnnoMoveable=function(){return this.node.symbolAttrib.GetMoveable()},CgsSymbol.prototype.getSymbolId=function(){return this.node.symbolAttrib.GetCodeID()},CgsSymbol.prototype.getSymbolLib=function(){return"lib"+this.node.symbolAttrib.GetLibID()},CgsSymbol.prototype.getNode=function(){if(this.node)return this.node},CgsSymbol.prototype.setUiMode=function(e){this.node&&this.node.symbolAttrib.SetUiHandleType(e)},CgsSymbol.prototype.getUiMode=function(){if(this.node)return this.node.symbolAttrib.GetUiHandleType()},CgsSymbol.prototype.setFadeMode=function(e){this.node&&(e=e?1:0,this.node.drawingAttrib.SetFadeMode(e))},CgsSymbol.prototype.getFadeMode=function(){if(this.node)return!!this.node.drawingAttrib.GetFadeMode()},CgsSymbol.prototype.setFadeColor=function(e,t){var i,s,o,a,n,r,l;this.node&&(i=this.node.drawingAttrib,s=Object.assign({},e),o=Object.assign({},t),null==s.a&&(s.a=1),null==o.a&&(o.a=1),a=s.b,s.b=s.r,s.r=a,n=o.b,o.b=o.r,o.r=n,r=CgsUtil.RGBATojmpColor(s),l=CgsUtil.RGBATojmpColor(o),i.fadeColor0=r,i.fadeColor1=l,i.fadeOpacity0=100*s.a,i.fadeOpacity1=100*o.a)},CgsSymbol.prototype.setScale=function(e){if(this.node)for(var t=e.length,i=this.map.gJMP.getNodeGeoAttrib(this.node),s=0;s<t;s++)i.SetScale(s,e[s])},CgsSymbol.prototype.getScale=function(){if(this.node){for(var e=this.node.geometryAttrib,t=[],i=e.GetScaleCount(),s=0;s<i;s++)t.push(e.GetScale(s));return t}},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/toolbarPlugg/zoolonToolbarPlugg.css"/>'),CgsSymbolSituation=function(e){var n=this;this.jsonObj=e.jsonObj?e.jsonObj:null;var r,l={buttonOptions:[{iconUrl:"assets/image/plugg/toolbar/zoomIn.png",showText:"暂停",id:"pause"},{iconUrl:"assets/image/plugg/toolbar/zoomOut.png",showText:"加速",id:"speedUp"},{iconUrl:"assets/image/plugg/toolbar/viewHome.png",showText:"播放",id:"speedDown"},{iconUrl:"assets/image/plugg/toolbar/dimensionSwitch.png",showText:"导入",id:"impot"}],pluggOptions:{open:!0,right:"110px",top:"22px"}};function u(e,t){var i=$$("<div></div>");i.addClass("toolbar_buttonBox"),i.attr("data-btID",t.id),i.attr("title",t.showText),i.mouseover(function(e){$$(this).addClass("toolbar_buttonBox_hover")}),i.mouseout(function(e){var t=$$(this).attr("data-btID");$$(this).removeClass("toolbar_buttonBox_hover"),$$(this).hasClass("toolbar_buttonBox_selected")&&("rotateLeft"!=t&&"rotateRight"!=t||n.rotateCancelFlag)&&$$(this).removeClass("toolbar_buttonBox_selected")}),i.click(function(e){var t=$$(this).attr("data-btID");switch($$(this).hasClass("toolbar_buttonBox_selected")?"rotateLeft"!=t&&"rotateRight"!=t||(n.rotateCancelFlag=!0):($$(this).addClass("toolbar_buttonBox_selected"),n.rotateCancelFlag=!1),t){case"pause":n.stop();break;case"speedUp":n.speedUp();break;case"speedDown":n.speedDown();break;case"impot":n.import()}});var s=$$("<div></div>");return s.addClass("toolbar_buttonPic"),s.css("background-image","url("+CGS_SDK_PATH+t.iconUrl+")"),s.appendTo(i),console.log(i),i}null==(r=null==l.pluggOptions?{openFlag:!0}:{openFlag:l.pluggOptions.open,right:l.pluggOptions.right,top:l.pluggOptions.top}).openFlag&&(r.openFlag=!0),this.firstTime=!0,this.setVisible=function(e){e?this.body.show():this.body.hide()},function(){var i=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$,e=i("<div></div>");e.addClass("toolbar_container"),r.right&&e.css("right",r.right),r.top&&e.css("top",r.top);var t=i("<div></div>");t.addClass("toolbar_folder_open"),r.openFlag||t.addClass("toolbar_folder_close"),t.click(function(e){var t;i(this).hasClass("toolbar_folder_close")?(i(this).removeClass("toolbar_folder_close"),t=i(n.body).position().left-216+"px",i(n.body).animate({width:n.width,left:t},200,function(){i(n.body).find(".toolbar_content").eq(0).show()})):(i(this).addClass("toolbar_folder_close"),i(n.body).find(".toolbar_content").eq(0).hide(),t=i(n.body).position().left+216+"px",i(n.body).animate({width:"30px",left:t},200))});var s=i("<div></div>");s.addClass("toolbar_content");var o=l.buttonOptions;if(o){n.width=36*o.length+30+"px",e.css("width",n.width);for(var a=0;a<o.length;a++){new u(0,o[a]).appendTo(s)}}t.appendTo(e),s.appendTo(e),map.container.appendChild(e[0]),n.body=e,n.body.draggable({handle:n.body})}(),this.map=e.map,this.symbolOptions=e;var t=new CgsMapNoteEdit(map);this.usualExample=t.usualExample,this.jmpManage=new CgsJmpManage(map),this.scriptArr=[],this.alternation=50;n=this;this.currentTime=0,this.CameraInfo=null,this.stopFlag=!0,this.timeEvent=setInterval(function(){if(!n.stopFlag){if(0<n.scriptArr.length)for(var e=0;e<n.scriptArr.length;e++)n.timeGroup(e);n.currentTime=n.currentTime+50}n.maxDelay&&n.maxDelay<n.currentTime&&(window.clearInterval(n.timeEvent),n.timeEvent=null)},this.alternation),this.timeGroup=function(e){var t=this.scriptArr[e];if(t.delay[0]<=this.currentTime){if(0<t.num){for(var i=0;i<t.delay.length;i++)if(this.currentTime<t.delay[i]){var s=i;break}if(t.feature.setVisible(!0),"[object Array]"==Object.prototype.toString.call(t.positions[0][0])){for(var o=[],e=0;e<t.positions.length;e++)o.push(t.positions[e][0]),t.positions[e].shift();t.feature.setPosition(o),t.options.mapNote&&n.setMapNote(t.feature,o[0],t.options.mapNote,s)}else t.options.mapNote&&n.setMapNote(t.feature,t.positions[0],t.options.mapNote,s),t.feature.setPosition(t.positions[0]),t.positions.shift()}t.num--,t.num<=0&&(t.options.endShow||t.feature.setVisible(!1),t.feature.mapNote&&t.feature.mapNote.setVisible(!1),t.delay[0]=99999999)}n.CameraInfo&&n.CameraInfo.delay[0]<=this.currentTime&&(n.map.setCameraInfo(n.CameraInfo.CameraInfo[0]),n.CameraInfo.CameraInfo.shift(),n.CameraInfo.delay.shift(),0==n.CameraInfo.delay.length&&(n.CameraInfo.delay=[99999999])),n.SituationInfo&&n.SituationInfo.delay[0]==this.currentTime&&(CgsSubPub.publish("CgsSymbolSituationInfo",[n.SituationInfo.info[0],n.SituationInfo.delay[0]]),n.SituationInfo.info.shift(),n.SituationInfo.delay.shift(),0==n.SituationInfo.delay.length&&(n.SituationInfo.delay=[99999999]))}},CgsSymbolSituation.prototype.active=function(){var n=this;n.stopFlag=!1;var e=this.symbolOptions.url?this.symbolOptions.url:"http://localhost:8080/CgsEarth2.2.0.20/WebRoot/assets/config/wujiang.json";function t(a){setTimeout(function(){var e,t=a.symbol,i=-1;for(e in n.CameraInfo=a.Camera,n.SituationInfo=a.SituationInfo,t){for(var s=t[parseFloat(e)],o=0;o<map.allSymbols.length;o++)map.allSymbols[o].getName()==s.name&&(n.runScript(map.allSymbols[o],s.positions,s.delay,s),map.allSymbols[o].setVisible(!1),0==s.nameVisible&&map.allSymbols[o].setNameVisible(!1));s.delay[s.delay.length-1]>i&&(i=s.delay[s.delay.length-1])}n.maxDelay=i},300)}n.jsonObj?t(JSON.parse(n.jsonObj)):$$.ajax({url:e,type:"get",dataType:"json",success:function(e){t(e)},error:function(){console.error("请求失败")}})},CgsSymbolSituation.prototype.deactivate=function(){window.clearInterval(this.timeGroup)},CgsSymbolSituation.prototype.inciseAnticipate=function(e,t,i){for(var s=[],i=i,o=0;o<i;o++){var a=(o+1)/i;1<a&&(a=1);var n=[(1-a)*e[0]+a*t[0],(1-a)*e[1]+a*t[1]];s.push(n)}return s},CgsSymbolSituation.prototype.runScript=function(e,t,i,s){if("[object Array]"==Object.prototype.toString.call(i))var o=i.length,a=i;else for(var o=t.length,a=[],n=0;n<o;n++)a.push(i);if("[object Array]"==Object.prototype.toString.call(t[0][0])){for(var r=[],l=[],u=t[0].length,p=0,n=1;n<a.length;n++){for(var h=(a[n]-a[n-1])/50,c=0;c<u;c++)r=this.inciseAnticipate(t[n-1][c],t[n][c],h-1),l.length<u?l.push(r):l[c]=l[c].concat(r);p=p+h-1}var g={positions:l,delay:a,feature:e,num:p,options:s}}else{for(r=[],p=0,n=1;n<a.length;n++){h=(a[n]-a[n-1])/this.alternation;r=r.concat(this.inciseAnticipate(t[n-1],t[n],h-1)),p=p+h-1}g={positions:r,delay:a,feature:e,num:p,options:s}}this.scriptArr.push(g)},CgsSymbolSituation.prototype.setMapNote=function(e,t,i,s){if(s){var o=i.scriptPos[s].text,a=i.scriptPos[s].offset;if(e.mapNote&&"CGS_hideMapNote"==o)e.mapNote.setVisible(!1);else if(e.mapNote&&-1!=o.indexOf("CGS_showMapNote")){e.mapNote.setVisible(!0),e.mapNote.setPosition(t);o=o.slice(0,o.indexOf("CGS_showMapNote"));e.mapNote.setText(o)}else if(e.mapNote)e.mapNote.setPosition(t),e.mapNote.setText(o);else{"default"==i.type&&(i.type="常用模板(默认)");for(s=0;s<this.usualExample.length;s++)if(this.usualExample[s].name==i.type){var n=this.usualExample[s];break}n.map=this.map,n.position=t,n.text=o,n.textWidth=i.width?i.width:"110px",n.textHeight=i.height?i.height:"67px",n.offset=a;var r=new CgsMapNote(n);e.mapNote=r}}else e.mapNote&&e.mapNote.setVisible(!1)},CgsSymbolSituation.prototype.getIntervalTime=function(){return this.currentTime},CgsSymbolSituation.prototype.stop=function(){this.stopFlag?this.stopFlag=null:this.stopFlag=!0},CgsSymbolSituation.prototype.setSpeedNum=function(e){var t=this;this.alternation=50/e,window.clearInterval(this.timeEvent),this.timeEvent=setInterval(function(){if(!t.stopFlag){if(0<t.scriptArr.length)for(var e=0;e<t.scriptArr.length;e++)t.timeGroup(e);t.currentTime=t.currentTime+50}t.maxDelay&&t.maxDelay<t.currentTime&&(window.clearInterval(t.timeEvent),t.timeEvent=null)},this.alternation)},CgsSymbolSituation.prototype.speedUp=function(){var t=this;this.alternation=this.alternation-10,window.clearInterval(this.timeEvent),this.timeEvent=setInterval(function(){if(!t.stopFlag){if(0<t.scriptArr.length)for(var e=0;e<t.scriptArr.length;e++)t.timeGroup(e);t.currentTime=t.currentTime+50}t.maxDelay&&t.maxDelay<t.currentTime&&(window.clearInterval(t.timeEvent),t.timeEvent=null)},this.alternation)},CgsSymbolSituation.prototype.speedDown=function(){var t=this;this.alternation=this.alternation+10,window.clearInterval(this.timeEvent),this.timeEvent=setInterval(function(){if(!t.stopFlag){if(0<t.scriptArr.length)for(var e=0;e<t.scriptArr.length;e++)t.timeGroup(e);t.currentTime=t.currentTime+50}t.maxDelay&&t.maxDelay<t.currentTime&&(window.clearInterval(t.timeEvent),t.timeEvent=null)},this.alternation)},CgsSymbolSituation.prototype.import=function(){var t=this;this.alternation=this.alternation+10,window.clearInterval(this.timeEvent),this.timeEvent=setInterval(function(){if(!t.stopFlag){if(0<t.scriptArr.length)for(var e=0;e<t.scriptArr.length;e++)t.timeGroup(e);t.currentTime=t.currentTime+50}t.maxDelay&&t.maxDelay<t.currentTime&&(window.clearInterval(t.timeEvent),t.timeEvent=null)},this.alternation)},CgsSymbolSituation.prototype.dispose=function(){window.clearInterval(this.timeEvent),self.timeEvent=null},CgsFeaturesHandle=function(e){var s=this;function o(e){for(var t=0;t<s.featuresArr[e].length;t++)for(var i=0;i<s.featuresArr[e].length;i++)s.featuresArr[e][i].getVisible()&&s.featuresArr[e][i].setVisible(!1)}function a(e){for(var t=0;t<s.labelsArr[e].length;t++)for(var i=0;i<s.labelsArr[e].length;i++)s.labelsArr[e][i].getLabelVisible&&s.labelsArr[e][i].getLabelVisible()&&s.labelsArr[e][i].setLabelVisible(!1)}s.map=e,s.featuresArr=[],s.featuresScope=[],s.featuresVisable=[],s.labelsArr=[],s.labelsScope=[],s.labelsVisable=[],s.BlinkGroup=[],s.BlinkInterval=null,s.blink=!1,window.visibleHeightContralHandler=new Cesium.ScreenSpaceEventHandler(s.map.map3D.canvas),s.map.featuresHandleObj=this,visibleHeightContralHandler.setInputAction(function(e){setTimeout(function(){for(var e=s.map.getHeight(),t=0;t<s.featuresScope.length;t++)s.featuresScope[t][0]>e&&s.featuresArr[t][0].getVisible()||s.featuresScope[t][1]<e&&s.featuresArr[t][0].getVisible()?o(t):s.featuresScope[t][0]<e&&s.featuresScope[t][1]>s.map.getHeight()&&(s.featuresArr[t][0].getVisible()||function(e){for(var t=0;t<s.featuresArr[e].length;t++)for(var i=0;i<s.featuresArr[e].length;i++)s.featuresArr[e][i].getVisible()||s.featuresArr[e][i].setVisible(!0)}(t));for(var i=0;i<s.labelsScope.length;i++)s.labelsScope[i][0]>e&&s.labelsArr[i][0].getLabelVisible&&s.labelsArr[i][0].getLabelVisible()||s.labelsScope[i][1]<e&&s.labelsArr[i][0].getLabelVisible&&s.labelsArr[i][0].getLabelVisible()?a(i):s.labelsScope[i][0]<e&&s.labelsScope[i][1]>s.map.getHeight()&&s.labelsArr[i][0].getLabelVisible&&s.labelsArr[i][0].getLabelVisible&&!s.labelsArr[i][0].getLabelVisible()&&function(e){for(var t=0;t<s.labelsArr[e].length;t++)for(var i=0;i<s.labelsArr[e].length;i++)s.labelsArr[e][i].getLabelVisible&&!s.labelsArr[e][i].getLabelVisible()&&s.labelsArr[e][i].setLabelVisible(!0)}(i)},10)},Cesium.ScreenSpaceEventType.WHEEL),this.clearInterval=setInterval(function(){if(s.featuresArr.length)for(var e=s.featuresArr.length-1;0<=e;e--)if(s.featuresArr[e].length)for(var t=s.featuresArr[e].length-1;0<=t;t--)-1==s.map.allFeatures.indexOf(s.featuresArr[e][t])&&(s.featuresArr[e][t]=null,s.featuresArr[e].splice(t,1)),0==s.featuresArr[e].length&&(s.featuresArr.splice(e,1),s.featuresScope.splice(e,1));else s.featuresArr.splice(e,1),s.featuresScope.splice(e,1);if(s.labelsArr.length)for(e=s.labelsArr.length-1;0<=e;e--)if(t<s.labelsArr[e].length)for(t=s.labelsArr[e].length-1;0<=t;t--)-1==s.map.allFeatures.indexOf(s.labelsArr[e][t])&&(s.labelsArr[e][t]=null,s.labelsArr[e].splice(t,1)),0==s.labelsArr[e].length&&(s.labelsArr.splice(e,1),s.labelsScope.splice(e,1));else s.labelsArr.splice(e,1),s.labelsScope.splice(e,1)},3e4)},CgsFeaturesHandle.prototype.clearDust=function(e,t){var i=this;if(i.featuresArr.length)for(var s=i.featuresArr.length-1;0<=s;s--)if(i.featuresArr[s].length)for(var o=i.featuresArr[s].length-1;0<=o;o--)-1==i.map.allFeatures.indexOf(i.featuresArr[s][o])&&(i.featuresArr[s][o]=null,i.featuresArr[s].splice(o,1)),0==i.featuresArr[s].length&&(i.featuresArr.splice(s,1),i.featuresScope.splice(s,1));else i.featuresArr.splice(s,1),i.featuresScope.splice(s,1);if(i.labelsArr.length)for(s=i.labelsArr.length-1;0<=s;s--)if(o<i.labelsArr[s].length)for(o=i.labelsArr[s].length-1;0<=o;o--)-1==i.map.allFeatures.indexOf(i.labelsArr[s][o])&&(i.labelsArr[s][o]=null,i.labelsArr[s].splice(o,1)),0==i.labelsArr[s].length&&(i.labelsArr.splice(s,1),i.labelsScope.splice(s,1));else i.labelsArr.splice(s,1),i.labelsScope.splice(s,1)},CgsFeaturesHandle.prototype.removeFeature=function(e){for(var t=this,i=t.featuresArr.length-1;0<=i;i--){-1!=(s=t.featuresArr[i].indexOf(e))&&t.featuresArr[i].splice(s,1),0==t.featuresArr[i].length&&(t.featuresArr.splice(i,1),t.featuresScope.splice(i,1))}for(var s,i=t.labelsArr.length-1;0<=i;i--){-1!=(s=t.labelsArr[i].indexOf(e))&&t.labelsArr[i].splice(s,1),0==t.labelsArr[i].length&&(t.labelsArr.splice(i,1),t.labelsScope.splice(i,1))}},CgsFeaturesHandle.prototype.addFeature=function(e,t,i){for(var s=this,o=0;o<s.featuresArr.length;o++)if(-1!=s.featuresArr[o].indexOf(e)){this.removeFeature(e);break}var a=!1;if((t[0]>s.map.getHeight()||t[1]<s.map.getHeight())&&e.getVisible()&&e.setVisible(!1),0==s.featuresScope.length&&(s.featuresScope.push(t),s.featuresArr.push([e]),a=!0),0==s.labelsScope.length&&i&&(s.labelsScope.push(i),s.labelsArr.push([e]),a=!0,(i[0]>s.map.getHeight()||i[1]<s.map.getHeight())&&e.getVisible()&&e.setLabelVisible(!1)),!a){for(var n=!0,r=0,l=0;l<s.featuresScope.length;l++)s.featuresScope[l][0]==t[0]&&s.featuresScope[l][1]==t[1]&&(n=!1,r=l);if(n?(s.featuresScope.push(t),s.featuresArr.push([e])):s.featuresArr[r].push(e),i){if((i[0]>s.map.getHeight()||i[1]<s.map.getHeight())&&e.getVisible()&&e.setLabelVisible(!1),0==s.labelsScope.length)return s.labelsScope.push(i),void s.labelsArr.push([e]);for(var u=!0,p=0,l=0;l<s.labelsScope.length;l++)s.labelsScope[l][0]==i[0]&&s.labelsScope[l][1]==i[1]&&(u=!1,p=l);u?(s.labelsScope.push(i),s.labelsArr.push([e])):s.labelsArr[p].push(e)}}},CgsFeaturesHandle.prototype.addLabel=function(e,t){var i=this;if((t[0]>i.map.getHeight()||t[1]<i.map.getHeight())&&e.getVisible()&&(e.setVisibled(!1),e.setVisible(!1)),0==i.labelsScope.length)return i.labelsScope.push(t),void i.labelsArr.push([e]);for(var s=!0,o=0;o<i.labelsScope.length;o++)i.labelsScope[o][0]==t[0]&&i.labelsScope[o][1]==t[1]&&(s=!1,0);s?(i.labelsScope.push(t),i.labelsArr.push([e])):i.labelsArr[o].push(e)},CgsFeaturesHandle.prototype.addBlinkGroup=function(e){var i=this;0==i.BlinkGroup.length?(i.BlinkGroup.push(e),i.BlinkInterval=setInterval(function(){for(var e=0,t=i.BlinkGroup.length;e<t;e++)-1==i.map.allFeatures.indexOf(i.BlinkGroup[e])?i.BlinkGroup.splice(e,1):"CgsMark"==i.BlinkGroup[e].getType()?i.BlinkGroup[e].setScale(i.blink?1.5:1):"CgsPoint"==i.BlinkGroup[e].getType()&&(i.blink?(i.BlinkGroup[e].setPixelSize(15),i.BlinkGroup[e].setOutlineWidth(2)):(i.BlinkGroup[e].setPixelSize(2),i.BlinkGroup[e].setOutlineWidth(.25)));0==i.BlinkGroup.length&&i.BlinkInterval&&(window.clearInterval(i.BlinkInterval),i.BlinkInterval=null),i.blink=!i.blink},1e3)):i.BlinkGroup.push(e)},CgsFeaturesHandle.prototype.removeBlink=function(e){-1!=this.BlinkGroup.indexOf(e)&&this.BlinkGroup.splice(this.BlinkGroup.indexOf(e),1)},CgsFeaturesHandle.prototype.refresh=function(e){var t;t=e||this.map.getHeight();for(var i=0;i<this.featuresScope.length;i++)this.featuresScope[i][0]>t&&this.featuresArr[i][0].getVisible()||this.featuresScope[i][1]<t&&this.featuresArr[i][0].getVisible()?this.setFeaturesUnVisable(i):this.featuresScope[i][0]<t&&this.featuresScope[i][1]>this.map.getHeight()&&this.featuresArr[i][0].getVisible&&!this.featuresArr[i][0].getVisible()&&this.setFeaturesVisable(i);for(var s=0;s<this.labelsScope.length;s++)this.labelsScope[s][0]>t&&this.labelsArr[s][0].getLabelVisible&&this.labelsArr[s][0].getLabelVisible()||this.labelsScope[s][1]<t&&this.labelsArr[s][0].getLabelVisible&&this.labelsArr[s][0].getLabelVisible()?this.setLabelsUnVisable(s):this.labelsScope[s][0]<t&&this.labelsScope[s][1]>this.map.getHeight()&&this.labelsArr[s][0].getLabelVisible&&!this.labelsArr[s][0].getLabelVisible()&&this.setLabelsVisable(s)},CgsFeaturesHandle.prototype.setFeaturesVisable=function(e){for(var t=0;t<this.featuresArr[e].length;t++)for(var i=0;i<this.featuresArr[e].length;i++)this.featuresArr[e][i].getVisible()||this.featuresArr[e][i].setVisible(!0)},CgsFeaturesHandle.prototype.setFeaturesUnVisable=function(e){for(var t=0;t<this.featuresArr[e].length;t++)for(var i=0;i<this.featuresArr[e].length;i++)this.featuresArr[e][i].getVisible()&&this.featuresArr[e][i].setVisible(!1)},CgsFeaturesHandle.prototype.setLabelsVisable=function(e){for(var t=0;t<this.labelsArr[e].length;t++)for(var i=0;i<this.labelsArr[e].length;i++)this.labelsArr[e][i].getLabelVisible&&!this.labelsArr[e][i].getLabelVisible()&&this.labelsArr[e][i].setLabelVisible(!0)},CgsFeaturesHandle.prototype.setLabelsUnVisable=function(e){for(var t=0;t<this.labelsArr[e].length;t++)for(var i=0;i<this.labelsArr[e].length;i++)this.labelsArr[e][i].getLabelVisible&&this.labelsArr[e][i].getLabelVisible()&&this.labelsArr[e][i].setLabelVisible(!1)},CgsDrawJmp=function(e){this.map=e},CgsDrawJmp.prototype.drawJmpSymbol=function(e,t){var i,s=e.dbEnd,o=e.angle,a=e.pos,n=e.lib,r=e.id,t=t,l=this;null==s&&(s=!1),null==o&&(o=0),2<a.length&&e.dbEnd&&a.push({x:120,y:30}),window.jmpHasInit||(l.map.symbolTool=new CgsSymbolTool(l.map),l.map.symbolTool.activate(),0<(i=document.getElementsByClassName("CgsToolBone")).length&&(i[0].style.display="none"),setTimeout(function(){l.map.symbolTool.deactivate()},10),window.jmpHasInit=!0);var u=l.map.jmpApi.jbsByLibAndId[n+"_"+r];if(l.map.jmpApi.jmpState.createType=1,l.map.jmpApi.jmpState.isDrawingByMouse=!0,l.map.jmpApi.symbolManager.selectSymbol(u.symbol),1==a.length)C(c={position:{x:(h=l.map.lonLatToPixel([a[0].x,a[0].y]))[0],y:h[1]}});else for(var p=0;p<a.length;p++){var h,c={position:{x:(h=l.map.lonLatToPixel([a[p].x,a[p].y]))[0],y:h[1]}};p<a.length-1||!s?C(c):l.map.gJMP.mapMouseDblClick(c)}var g=l.map.jmpApi.lastSelectedNode,d=l.map.gJMP.getNodeDrawAttrib(g);d&&o&&d.SetAngle(o),t&&jmpFunctionTag.map.jmpApi.setNodeAttrs(g,t);var m,f=l.map.gJMP.getNodeGeoAttrib(g);function C(e){var t;l.map.gJMP.mapMouseLeftDown(e),l.map.gJMP.dblTimeout?(clearTimeout(map.gJMP.dblTimeout),map.gJMP.dblTimeout=null):(t=l.map.gJMP.createMouseEvent(2,0,e.position.x,e.position.y,0,modifer),l.map.gJMP.dblTimeout=null,l.map.gJMP.fireUIEvent(t),mapMoving=!1,downButton=0)}1<a.length&&s&&f.DeletePoint(a.length-1),null==t.inwardText||0<(m=l.map.gJMP.getNodeDrawAttrib(l.map.gJMP.LastNode)).GetInlineTextNum()&&(stringBuf=GBK.New(t.inwardText),m.SetInlineText(0,stringBuf.ptr),stringBuf.free()),g.setEditable(!1)},CgsDataSource=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){this.id="CgsDataSource_"+CgsDataSource.idUsed++,this.isAddToLayerTree=0!=e.isAddToLayerTree,this.pId=e.pId}),CgsDataSource.idUsed=0,CgsDataSource.prototype.getId=function(){return this.id},CgsDataSource.prototype.getPId=function(){return this.pId},CgsDataSource.prototype.setPId=function(e){"string"==typeof e&&(this.pId=e)},CgsDataSource.prototype.getIsAddToLayerTree=function(){return this.isAddToLayerTree},CgsDataSource.prototype.setIsAddToLayerTree=function(e){this.isAddToLayerTree=!!e},CgsLayerGroup=function(e){this.name=e,this.array=[]},CgsLayerGroup.prototype.getName=function(){return this.name},CgsLayerGroup.prototype.addLayer=function(e){return null==e.getGroup()&&e.setGroup(this),0},CgsLayerGroup.prototype.getLayerById=function(e){for(var t=0;t<this.array.length;t++)if(this.array[t].getId()==e)return this.array[t]},CgsLayerGroup.prototype.getAllLayers=function(){return this.array},CgsLayerGroup.prototype.setVisible=function(e){for(var t=0;t<this.array.length;t++){this.array[t].setVisible(e)}},CgsLayerGroup.prototype.removeLayer=function(e){for(var t=0;t<this.array.length;++t)e==this.array[t]&&this.array.splice(t,1)},CgsLayerGroup.prototype.removeAllLayers=function(){this.array=[]},CgsTileLayer=function(e){var t,i,s;CgsLayer.call(this,e),null==e.layer&&(e.layer=e.name),e.no2D||(t=new CgsSourceWMTS2D({url:e.url,origin:e.origin,layername:e.layer,projection:e.projection,matrixSet:e.tileMatrixSetID,matrixIds:e.tileMatrixLabels,resolutions:e.resolutions,tileWidth:e.tileWidth,requestEncoding:e.requestEncoding,proxy:CgsUtil.getProxyURL(e.proxy),wrapX:e.wrapX}),i={opacity:e.opacity,source:t,rectangle:e.rectangle,minVisLevel:e.minVisLevel,maxVisLevel:e.maxVisLevel,options:e},s=Object.assign(i,e),this.layer2D=new CgsLayerTile2D(s)),1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG||(this.layer3D=new CgsTileLayer3D(e)),0==e.visible&&this.setVisible(e.visible)},CgsInherits(CgsTileLayer,CgsLayer),CgsTileLayer.prototype.getLayer=function(){if(1==window.WGMODEFLAG||3==window.WGMODEFLAG)return this.layer3D.getLayer()},CgsTileLayer.prototype.save=function(){var e=this;return{type:"WMTS",url:e.getUrl(),layer:e.getLayer(),rectangle:e.getExtent(),level:e.getLevel(),text:e.getText(),pId:e.getPId(),visible:e.getVisible(),isAddToLayerTree:e.getAddToLayerTree(),minVisLevel:e.getMinVisLevel(),maxVisLevel:e.getMaxVisLevel()}},CgsTileLayer.load=function(e,t){var i=new CgsTileLayer(t);e.addLayer(i)},CgsWMSLayer=function(e){CgsLayer.call(this,e);var t=CgsUtil.getProxyURL(e.proxy),i=CgsIds++,s={format:e.format,enablePickFeatures:e.enablePickFeatures,projection:e.projection,url:e.url,id:"cgslayer_id_"+i,proxy:t,version:e.version,level:e.level,rec:e.rec,layers:e.layers||e.layer,name:e.name,text:e.text,serverType:e.serverType,opacity:e.opacity,pId:e.pId,isAddToLayerTree:e.isAddToLayerTree},o={format:e.format,enablePickFeatures:e.enablePickFeatures,projection:e.projection,url:e.url,proxy:t,version:e.version,level:e.level,rectangle:e.rec,layers:e.layers,name:e.name,text:e.text,serverType:e.serverType,opacity:e.opacity,pId:e.pId,isAddToLayerTree:e.isAddToLayerTree,minVisLevel:e.minVisLevel,maxVisLevel:e.maxVisLevel};1==window.WGMODEFLAG?(this.layer3D=new CgsWebMapLayer3D(o),this.layer2D=new CgsWMSLayer2D(s)):2==window.WGMODEFLAG?this.layer2D=new CgsWMSLayer2D(s):3==window.WGMODEFLAG&&(this.layer3D=new CgsWebMapLayer3D(o)),0==e.visible&&this.setVisible(e.visible)},CgsInherits(CgsWMSLayer,CgsLayer),CgsWMSLayer.prototype.getLayers=function(){return this.layer3D?this.layer3D.getLayers():this.layer2D?this.layer2D.getLayers():void 0},CgsWMSLayer.prototype.save=function(){var e=this;return{url:e.getUrl(),layers:e.getLayers(),text:e.getText(),projection:e.getProjection(),version:e.getVersion(),visible:e.getVisible(),isAddToLayerTree:e.getAddToLayerTree(),pId:e.getPId(),rec:e.getExtent(),type:"WMS",minVisLevel:e.getMinVisLevel(),maxVisLevel:e.getMaxVisLevel()}},CgsWMSLayer.load=function(e,t){var i=new CgsWMSLayer(t);e.addLayer(i)},CgsImageWMSLayer=function(e){CgsLayer.call(this,e);var t={url:e.url,params:{LAYERS:e.layers},serverType:void 0!==e.serverType?e.serverType:"mapserver"};e.ratio&&(t.FORMAT=e.ratio),e.format&&(t.params.FORMAT=e.format),e.version&&(t.params.VERSION=e.version),e.exceptions&&(t.params.exceptions=e.exceptions),this.layer2D=new ol.layer.Image({opacity:1,source:new ol.source.ImageWMS(t),visible:e.visible});var i={format:e.format,enablePickFeatures:e.enablePickFeatures,projection:e.projection,url:e.url,proxy:e.proxy,version:e.version,level:e.level,rectangle:e.rec,layers:e.layers,name:e.name,text:e.text,serverType:e.serverType,opacity:e.opacity,pId:e.pId,isAddToLayerTree:e.isAddToLayerTree,minVisLevel:e.minVisLevel,maxVisLevel:e.maxVisLevel};this.layer3D=new CgsWebMapLayer3D(i),0==e.visible&&this.setVisible(e.visible)},CgsInherits(CgsImageWMSLayer,CgsLayer),CgsXYZLayer=function(e){CgsLayer.call(this,e);var t=new CgsSourceXYZ2D(e);this.layer2D=new CgsLayerTile2D({source:t}),this.layer3D=new CgsXYZLayer3D(e)},CgsInherits(CgsXYZLayer,CgsLayer);var FEATURE_NUM=0;function getObject_(e){if("string"!=typeof e)return null!==e?e:null;var t=JSON.parse(e);return t||null}CgsFeature=function(e){var t=e||{};t.parentFeature=this,t.position||t.positions||(this.noPosition=!0),this.groupName=null,this.map=null,FEATURE_NUM++;this.useDefaultSelectEffect=!0,this.children=[]},CgsFeature.prototype.getId=function(){return 1==window.WGMODEFLAG||3==window.WGMODEFLAG?this.feature3D.getId():2==window.WGMODEFLAG?this.feature2D.getId():void 0},CgsFeature.prototype.setMap=function(e){this.map=e},CgsFeature.prototype.getMap=function(){return this.map},CgsFeature.prototype.setGroup=function(e){e&&e.addFeature(this)},CgsFeature.prototype.getGroup=function(){return this.groupName},CgsFeature.prototype.setName=function(e){var t=this.getName()==e;this.name=e,0!=this.labelVisible&&(this.feature2D&&this.feature2D.setName(this.name),this.feature3D&&this.feature3D.setName(this.name)),t||CgsSubPub.publish("featurepropertychange",[this,"name"])},CgsFeature.prototype.getName=function(){return null!=this.name?this.name:this.feature3D?this.feature3D.getName():this.feature2D?this.feature2D.getName():void 0},CgsFeature.prototype.getType=function(){if(this.feature3D)return this.feature3D.getType()},CgsFeature.prototype.setVisible=function(e,t){var i=this.getVisible();i!=e||this.mobileObj?(1==window.WGMODEFLAG||3==window.WGMODEFLAG?this instanceof CgsFlyLine||this instanceof CgsParabola||this instanceof CgsRadar||this instanceof CgsModel||this instanceof CgsExplode||this instanceof CgsLineAnimation||(this.feature2D&&this.feature2D.setVisible(e),this.feature2DHelper&&this.feature2DHelper.setVisible(e)):2==window.WGMODEFLAG&&(this instanceof CgsFlyLine||this instanceof CgsParabola||this instanceof CgsExplode||this instanceof CgsLineAnimation||(this.feature2D&&this.feature2D.setVisible(e),this.feature2DHelper&&this.feature2DHelper.setVisible(e))),this.feature3D&&this.feature3D.setVisible(e),i!=e&&0!=t&&CgsSubPub.publish("featurevisiblechange",[this]),this.mobileObj&&(this.realVisibleFlag=e)):this instanceof CgsMark&&this.feature2D&&this.feature2D.setVisible(e)},CgsFeature.prototype.getVisible=function(){return this.feature3D?this.feature3D.getVisible():this.feature2D.getVisible()},CgsFeature.prototype.blink=function(e){var t;(isNaN(e)||e<=0)&&(e=1e3),this.getVisible()&&(this.blinkInterval&&(clearInterval(this.blinkInterval),this.blinkInterval=null),(t=this).blinkInterval=setInterval(function(){t.setVisible(!t.getVisible(),!1)},e))},CgsFeature.prototype.stopBlink=function(){this.blinkInterval&&(clearInterval(this.blinkInterval),this.setVisible(!0,!1)),this.blinkInterval=null},CgsFeature.prototype.getZIndex=function(){if(this.feature2D)return this.feature2D.getZIndex()},CgsFeature.prototype.setZIndex=function(e){this.feature2D&&this.feature2D.setZIndex(e)},CgsFeature.prototype.setFont=function(e){this.feature2D&&this.feature2D.setFont(e),this.feature3D&&this.feature3D.label.setFont(e)},CgsFeature.prototype.getFont=function(){if(this.feature3D)return this.feature3D.label.getFont()},CgsFeature.prototype.setVisibleHeightConByRoller=function(e){this.map&&(e[0]>this.map.getHeight()||e[1]<this.map.getHeight()?this.getVisible()&&this.setVisible(!1):this.getVisible()||this.setVisible(!0)),"[object Array]"!=Object.prototype.toString.call(e)&&!$$.isArray(e)||(this.visibleHeightConByRoller=e)},CgsFeature.prototype.setLabelVisible=function(e){null==this.name&&(this.name=this.getName()),(this.labelVisible=e)?(this.feature2D&&this.feature2D.setName(this.name),this.feature3D&&this.feature3D.setName(this.name)):(this.feature2D&&this.feature2D.setName(""),this.feature3D&&this.feature3D.setName(""))},CgsFeature.prototype.getLabelVisible=function(){return 0!=this.labelVisible},CgsFeature.prototype.setLabelOutlineColor=function(e){var t;this.feature2D&&(t=ol.color.asString(e),this.feature2D.setLabelOutlineColor(t)),this.feature3D&&this.feature3D.label&&this.feature3D.label.setOutlineColor(e)},CgsFeature.prototype.setLabelFillColor=function(e){var t;this.feature2D&&(t=ol.color.asString(e),this.feature2D.setLabelFillColor(t)),this.feature3D&&this.feature3D.label.setFillColor(e)},CgsFeature.prototype.setLabelEyeOffset=function(e){this.feature3D&&this.feature3D.label.setEyeOffset(e)},CgsFeature.prototype.getLabelFillColor=function(){if(this.feature3D&&this.feature3D.label)return this.feature3D.label.getFillColor()},CgsFeature.prototype.setLabelOutlineWidth=function(e){this.feature2D&&this.feature2D.setLabelOutlineWidth(e),this.feature3D&&this.feature3D.label.setOutlineWidth(e)},CgsFeature.prototype.getLabelOutlineWidth=function(){if(this.feature3D)return this.feature3D.label.getOutlineWidth()},CgsFeature.prototype.setLabelScale=function(e){this.feature2D&&this.feature2D.setLabelScale(e),this.feature3D&&this.feature3D.label.setScale(e)},CgsFeature.prototype.getLabelScale=function(){if(this.feature3D&&this.feature3D.label)return this.feature3D.label.getScale()},CgsFeature.prototype.setLabelOffset=function(e){this.feature2D&&this.feature2D.setLabelOffset(e),this.feature3D&&this.feature3D.label.setPixelOffset(e)},CgsFeature.prototype.getLabelOffset=function(){if(this.feature3D)return this.feature3D.label.getPixelOffset()},CgsFeature.prototype.setLabelPixelOffset=function(e){this.feature2D&&this.feature2D.setLabelOffset(e),this.feature3D&&this.feature3D.label.setPixelOffset(e)},CgsFeature.prototype.getLabelPixelOffset=function(){if(this.feature3D)return this.feature3D.label.getPixelOffset()},CgsFeature.prototype.getLabelBackgroundColor=function(){if(this.feature3D)return this.feature3D.label.getLabelBackgroundColor()},CgsFeature.prototype.setLabelBackgroundColor=function(e){this.feature3D&&(this.feature3D.label?this.feature3D.label.setLabelBackgroundColor(e):this.feature3D instanceof CgsLabel3D&&this.feature3D.setLabelBackgroundColor(e)),this.feature2D&&this.feature2D.setLabelBackgroundColor(e)},CgsFeature.prototype.getLabelShowBackground=function(){if(this.feature3D)return this.feature3D.label.getShowLabelBackground()},CgsFeature.prototype.setLabelShowBackground=function(e){this.feature3D&&this.feature3D.label.setShowLabelBackground(e),this.feature2D&&this.feature2D.setShowLabelBackground(e)},CgsFeature.prototype.getLabelBackgroundPadding=function(){if(this.feature3D)return this.feature3D.label.getBackgroundPadding()},CgsFeature.prototype.setLabelBackgroundPadding=function(e){this.feature3D&&this.feature3D.label.setLabelBackgroundPadding(e),this.feature2D&&this.feature2D.setLabelBackgroundPadding(e)},CgsFeature.prototype.setAttribute=function(e){this.feature2D&&this.feature2D.setAttribute(e),this.feature3D&&this.feature3D.setAttribute(e)},CgsFeature.prototype.getAttribute=function(){if(this.feature3D)return this.feature3D.getAttribute()},CgsFeature.prototype.setProperties=function(e){var i=this;this.feature2D&&_.each(e,function(e,t){"position"===t?i.feature2D.setPosition(e):"fillColor"===t?i.feature2D.setFillColor(e):"labelfont"===t?i.feature2D.setFont(e):"labeloffset"===t?i.feature2D.setLabelOffset(e):"name"===t?i.feature2D.setName(e):"outlineColor"===t?i.feature2D.setOutlineColor(e):"radiusX"===t?i.feature2D.setRadiusX(e):"radiusY"===t?i.feature2D.setRadiusY(e):"outline"===t?i.feature2D.setOutline(e):"outlineWidth"===t?i.feature2D.setOutlineWidth(e):"pixelSize"===t?i.feature2D.setPixelSize(e):"visible"===t&&i.feature2D.setVisible(e)})},CgsFeature.prototype.getProperties=function(){if(this.feature2D)return this.feature2D.getProperties()},CgsFeature.prototype.getEntity=function(){if(this.feature3D)return this.feature3D.getEntity()},CgsFeature.prototype.setDragEnable=function(e){this.feature3D&&this.feature3D.setDragEnable(e),this.feature2D&&(this.feature2D instanceof CgsPoint2D||this.feature2D instanceof CgsMark2D)&&this.feature2D.setDragEnable(e)},CgsFeature.prototype.getDragEnable=function(){if(this.feature3D)return this.feature3D.getDragEnable()},CgsFeature.prototype.setSaveFlag=function(e){this.feature3D&&this.feature3D.setSaveFlag(e)},CgsFeature.prototype.getSaveFlag=function(){if(this.feature3D)return this.feature3D.getSaveFlag()},CgsFeature.prototype.setUseDefaultSelectEffect=function(e){this.useDefaultSelectEffect=e},CgsFeature.prototype.getUseDefaultSelectEffect=function(){return this.useDefaultSelectEffect},CgsFeature.prototype.setNamePosition=function(e){$.isArray(e)&&(2==e.length&&e.push(0),e.length<2||(e.forEach(function(e){Number(e)}),this&&this.feature3D&&this.feature3D.label&&this.feature3D.label.setPosition(e)))},CgsFeature.prototype.setDisableDepthTestDistance=function(e){var t;this.feature3D&&((t=this.feature3D.getEntity()).billboard&&(t.billboard.disableDepthTestDistance=e),t.label&&(t.label.disableDepthTestDistance=e))},CgsFeature.updateColor=function(e,t,i){var s=Cesium.Color.fromCssColorString(e+""),o=255*s.red,a=255*s.green,n=255*s.blue,r=s.alpha,l="rgba(";switch(i){case 0:l=l+t+","+a+","+n+","+r;break;case 1:l=l+o+","+t+","+n+","+r;break;case 2:l=l+o+","+a+","+t+","+r;break;case 3:l=l+o+","+a+","+n+","+t}return l+=")"},CgsFeature.colorStrToArr=function(e){var t=Cesium.Color.fromCssColorString(e);return[255*t.red,255*t.green,255*t.blue,t.alpha]},CgsFeature.traverse=function(e){var t="",i="[";if(!CgsUtil.isArray(e))return t;for(var s=0;s<e.length;++s)0!==s&&(i+=","),CgsUtil.isArray(e[0])&&CgsUtil.isArray(e[0][0])?i+=CgsFeature.traverse(e[s]):i+="["+e[s]+"]";return t=i+="]"},CgsFeature.checkRectExent=function(e){var t,i=e[0][0]%180,s=e[0][1]%90,o=e[1][0]%180,a=e[1][1]%90;return o<i&&(t=i,i=o,o=t),a<s&&(t=s,s=a,a=t),[[i,s],[o,a]]},CgsFeature.switchRectToPolygonPos=function(e){var t,i,s,o=CgsUtil.isArray(e[0])?(t=e[0][0],i=e[0][1],s=e[1][0],e[1][1]):(t=e[0],i=e[1],s=e[2],e[3]);return[t,o,t,i,s,i,s,o]},CgsFeature.checkDistanceDisplayCondition=function(e){var t;return 1==e.length?t=new Cesium.DistanceDisplayCondition(e[0]):2==e.length&&(t=new Cesium.DistanceDisplayCondition(e[0],e[1])),t},CgsFeature.checkVisibleHeight=function(e){var t=[];return CgsUtil.isArray(e)?2==e.length?e[0]>e[1]?(t[0]=e[1],t[1]=e[0]):(t[0]=e[0],t[1]=e[1]):1==e.length&&(t[0]=e[0]):t[0]=e,t},CgsFeature.checkPosition=function(e){var t=e;return 2==t.length&&(t[2]=0),t},CgsFeature.checkPolygonPositions=function(e){var t=e,i=!1,s=new Array,o=(new Array,new Array);if(CgsUtil.isArray(t[0])){var a=t[0];if("[object Array]"==Object.prototype.toString.call(a[0])){for(var n=t[0],r=0;r<n.length;r++){3==n[r].length&&(i=!0);for(var l=n[r],u=0;u<l.length;u++)s.push(l[u])}for(var p=1;p<t.length;p++){for(var h={positions:null},c=new Array,g=t[p],r=0;r<g.length;r++){3==g[r].length&&(i=!0);for(var d=g[r],u=0;u<d.length;u++)c.push(d[u])}h.positions=i?Cesium.Cartesian3.fromDegreesArrayHeights(c):Cesium.Cartesian3.fromDegreesArray(c),o.push(h)}}else for(r=0;r<t.length;r++){3==t[r].length&&(i=!0);for(d=t[r],u=0;u<d.length;u++)s.push(d[u])}}else s=t;return[i,s,o]},CgsFeature.prototype.setLabelDraggable=function(e){var t;this.setDragEnable(e),this.labelDraggable=e,this.feature3D.label||(t=new CgsLabel({feature2D:this.feature2D.label,feature3D:this.feature3D.label}),this.feature3D.label=t),this.feature3D.setLabelDraggable(e)},CgsFeature.prototype.getLabelDraggable=function(){if(this.feature3D)return this.feature3D.labelDraggable=flag},CgsFeature.prototype.showLine=function(e){(this.showLineFlag=e)&&-1==this.map.labeldragFeatureGroup.indexOf(this)&&(this.labelLine=new CgsLine({positions:[[9,9],[10,10]],width:1,fillColor:"rgba(255,255,255,1.0)"}),this.map.addFeature(this.labelLine),this.map.labeldragFeatureGroup.push(this)),e||-1==this.map.labeldragFeatureGroup.indexOf(this)||(this.map.removeFeature(this.labelLine),this.labelLine=null,this.map.labeldragFeatureGroup.splice(this.map.labeldragFeatureGroup.indexOf(this)))},CgsFeature.prototype.setPickColorFlag=function(e){this.feature3D&&(this.feature3D.pickColorFlag=e)},CgsFeatureGroup=function(e,t){this.name=e,this.array=[],this.visible=!0,this.zIndex=t},CgsFeatureGroup.prototype.addFeature=function(e){return null==e.getGroup()?(e.groupName=this.name,e.feature2D&&void 0!==this.zIndex&&(e.feature2D.style_.zIndex_=this.zIndex,e.feature2D.setStyle(e.feature2D.style_)),e.getVisible()!=this.getVisible()&&e.setVisible(this.getVisible()),this.array.push(e),this.array.length):0},CgsFeatureGroup.prototype.removeAllFeatures=function(){this.array=[]},CgsFeatureGroup.prototype.removeFeature=function(e){for(var t=0;t<this.array.length;++t)e==this.array[t]&&this.array.splice(t,1)},CgsFeatureGroup.prototype.getFeatureById=function(e){for(var t=0;t<this.array.length;t++)if(this.array[t].getId()===e)return this.array[t]},CgsFeatureGroup.prototype.getAllFeatures=function(){return this.array},CgsFeatureGroup.prototype.save=function(){},CgsFeatureGroup.prototype.setVisible=function(e){if(e!=this.visible){for(var t=0;t<this.array.length;t++){this.array[t].setVisible(e)}this.visible=e}},CgsFeatureGroup.prototype.getVisible=function(){return this.visible},CgsBox=function(e){CgsFeature.call(this,e),this.feature3D=new CgsBox3D(e)},CgsInherits(CgsBox,CgsFeature),CgsBox.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+this.getPosition())},CgsBox.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsBox.prototype.setDimensions=function(e){this.feature3D.setDimensions(e)},CgsBox.prototype.getDimensions=function(){return this.feature3D.getDimensions()},CgsBox.prototype.setFill=function(e){this.feature3D.setFill(e)},CgsBox.prototype.getFill=function(){return this.feature3D.getFill()},CgsBox.prototype.setMaterial=function(e){this.feature3D.setMaterial(e)},CgsBox.prototype.getMaterial=function(){return this.feature3D.getMaterial()},CgsBox.prototype.setOutline=function(e){this.feature3D.setOutline(e)},CgsBox.prototype.getOutline=function(){return this.feature3D.getOutline()},CgsBox.prototype.setOutlineColor=function(e){this.feature3D.setOutlineColor(e)},CgsBox.prototype.getOutlineColor=function(){return this.feature3D.getOutlineColor()},CgsBox.prototype.setOutlineWidth=function(e){this.feature3D.setOutlineWidth(e)},CgsBox.prototype.getOutlineWidth=function(){return this.feature3D.getOutlineWidth()},CgsBox.prototype.setShadows=function(e){this.feature3D.setShadows(e)},CgsBox.prototype.getShadows=function(){return this.feature3D.getShadows()},CgsBox.prototype.setFillColor=function(e){this.feature3D.setFillColor(e)},CgsBox.prototype.getFillColor=function(){return this.feature3D.getFillColor()},CgsBox.getPositionInCartesian3=function(e){return this.feature3D.getPositionInCartesian3(e)},CgsBox.prototype.setVisibleHeight=function(e){this.feature3D.setVisibleHeight(e)},CgsBox.prototype.getVisibleHeight=function(){return this.feature3D.getVisibleHeight()},CgsBox.prototype.setProperty=function(name,value){var self=this,pp;if("name"==name)self.setName(value);else if("show"==name)self.setVisible(value);else if("drag"==name)self.setDragEnable(value);else if("position"==name)self.setPosition(value);else if("fill"==name)self.setFill(value);else if("dimensionsX"==name){var pp=self.getDimensions();pp[0]=parseFloat(value),self.setDimensions(pp)}else if("dimensionsY"==name){var pp=self.getDimensions();pp[1]=parseFloat(value),self.setDimensions(pp)}else if("dimensionsZ"==name){var pp=self.getDimensions();pp[2]=parseFloat(value),self.setDimensions(pp)}else if("outline"==name)self.setOutline(value);else if("fillColor"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("visibleHeight"==name){try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsBox.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示ʾ",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"长方体/立方体"},{type:"hline"},{type:"cesiumPosition",label:"位置",name:"position",minusLngLatStepLen:1,plusLngLatStepLen:2,minusHeightStepLen:2e3,plusHeightStepLen:3e3,data:e.getPosition()},{type:"hline"},{type:"inputTypeNum",label:"x轴长度",name:"dimensionsX",value:e.getDimensions()[0]},{type:"inputTypeNum",label:"y轴长度",name:"dimensionsY",value:e.getDimensions()[0]},{type:"inputTypeNum",label:"z轴长度",name:"dimensionsZ",value:e.getDimensions()[0]},{type:"hline"},{type:"checkbox",label:"填充",name:"fill",value:e.getFill()},{type:"cesiumColor",label:"填充颜色",name:"fillColor",data:e.getFillColor()},{type:"hline"},{type:"checkbox",label:"边框",name:"outline",value:e.getOutline()},{type:"cesiumColor",label:"边框颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"hline"},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsBox.prototype.save=function(){var e=this;return{type:e.getType(),name:e.getName(),position:e.getPosition(),fill:e.getFill(),fillColor:e.getFillColor(),outline:e.getOutline(),outlineColor:e.getOutlineColor(),outlineWidth:e.getOutlineWidth(),dimensions:e.getDimensions(),shadows:e.getShadows()}},CgsBox.load=function(e,t){var i=new CgsBox(t);e.addFeature(i)},CgsCorridor=function(e){CgsFeature.call(this,e),this.feature3D=new CgsCorridor3D(e)},CgsInherits(CgsCorridor,CgsFeature),CgsCorridor.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsCorridor.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsCorridor.prototype.setWidth=function(e){this.feature3D.setWidth(e)},CgsCorridor.prototype.getWidth=function(){return this.feature3D.getWidth()},CgsCorridor.prototype.setCornerType=function(e){this.feature3D.setCornerType(e)},CgsCorridor.prototype.getCornerType=function(){return this.feature3D.getCornerType()},CgsCorridor.prototype.setHeight=function(e){this.feature3D.setHeight(e)},CgsCorridor.prototype.getHeight=function(){return this.feature3D.getHeight()},CgsCorridor.prototype.setExtrudedHeight=function(e){this.feature3D.setExtrudedHeight(e)},CgsCorridor.prototype.getExtrudedHeight=function(){return this.feature3D.getExtrudedHeight()},CgsCorridor.prototype.setFill=function(e){this.feature3D.setFill(e)},CgsCorridor.prototype.getFill=function(){return this.feature3D.getFill()},CgsCorridor.prototype.setFillColor=function(e){this.feature3D.setFillColor(e)},CgsCorridor.prototype.getFillColor=function(){return this.feature3D.getFillColor()},CgsCorridor.prototype.setOutline=function(e){this.feature3D.setOutline(e)},CgsCorridor.prototype.getOutline=function(){return this.feature3D.getOutline()},CgsCorridor.prototype.setOutlineColor=function(e){this.feature3D.setOutlineColor(e)},CgsCorridor.prototype.getOutlineColor=function(){return this.feature3D.getOutlineColor()},CgsCorridor.prototype.setOutlineWidth=function(e){this.feature3D.setOutlineWidth(e)},CgsCorridor.prototype.getOutlineWidth=function(){return this.feature3D.getOutlineWidth()},CgsCorridor.prototype.setShadows=function(e){this.feature3D.setShadows(e)},CgsCorridor.prototype.getShadows=function(){return this.feature3D.getShadows()},CgsCorridor.prototype.setVisibleHeight=function(e){this.feature3D.setVisibleHeight(e)},CgsCorridor.prototype.getVisibleHeight=function(){return this.feature3D.getVisibleHeight()},CgsCorridor.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name){var pp=[];try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setPosition(pp)}else if("fill"==name)this.setFill(value);else if("outline"==name)this.setOutline(value);else if("width"==name)this.setWidth(parseFloat(value));else if("height"==name)this.setHeight(parseFloat(value));else if("extrudedHeight"==name)this.setExtrudedHeight(parseFloat(value));else if("cornerType"==name){var re=null;switch(value){case"斜切角":re="BEVELED";break;case"斜接角":re="MITERED";break;case"圆形角":re="ROUNDED"}this.setCornerType(re)}else if("fillColor"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsCorridor.prototype.getPropertyString=function(){var e=this,t=e.getCornerType();switch(t){case"BEVELED":t="斜切角";break;case"MITERED":t="斜接角";break;case"ROUNDED":t="圆形角"}var i=[];return i.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"走廊"},{type:"hline"},{type:"input",label:"位置",name:"position",value:CgsFeature.traverse(e.getPosition())},{type:"inputTypeNum",label:"宽度",name:"width",value:e.getWidth()},{type:"inputTypeNum",label:"高度",name:"height",value:e.getHeight()},{type:"inputTypeNum",label:"距地高度",name:"extrudedHeight",value:e.getExtrudedHeight()},{type:"dropdown",label:"拐角类型",name:"cornerType",defaultValue:t,data:[{value:0,label:"斜切角"},{value:1,label:"斜接角"},{value:2,label:"圆形角"}]},{type:"hline"},{type:"checkbox",label:"填充",name:"fill",value:e.getFill()},{type:"cesiumColor",label:"填充颜色",name:"fillColor",data:e.getFillColor()},{type:"hline"},{type:"checkbox",label:"轮廓线",name:"outline",value:e.getOutline()},{type:"cesiumColor",label:"轮廓线颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),i},CgsCorridor.prototype.save=function(){var e=this;return{type:e.getType(),name:e.getName(),position:e.getPosition(),fill:e.getFill(),fillColor:e.getFillColor(),outline:e.getOutline(),outlineColor:e.getOutlineColor(),outlineWidth:e.getOutlineWidth(),extrudeHeight:e.getExtrudedHeight(),shadows:e.getShadows(),width:e.getWidth(),height:e.getHeight(),cornerType:e.getCornerType()}},CgsCorridor.load=function(e,t){var i=new CgsCorridor(t);e.addFeature(i)},CgsEllipse=function(e){CgsFeature.call(this,e),1==window.WGMODEFLAG?(this.feature3D=new CgsEllipse3D(e),this.feature2D=new CgsEllipse2D(e)):2==window.WGMODEFLAG?this.feature2D=new CgsEllipse2D(e):3==window.WGMODEFLAG&&(this.feature3D=new CgsEllipse3D(e))},CgsInherits(CgsEllipse,CgsFeature),CgsEllipse.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.feature3D&&this.feature3D.setPosition(e),this.feature2D&&this.feature2D.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsEllipse.prototype.getPosition=function(){return this.feature3D?this.feature3D.getPosition():this.feature2D?this.feature2D.getPosition():void 0},CgsEllipse.prototype.setRadiusX=function(e){this.feature3D&&this.feature3D.setRadiusX(e),this.feature2D&&this.feature2D.setRadiusX(e)},CgsEllipse.prototype.getRadiusX=function(){return this.feature3D?this.feature3D.getRadiusX():this.feature2D?this.feature2D.getRadiusX():void 0},CgsEllipse.prototype.setRadiusY=function(e){this.feature3D&&this.feature3D.setRadiusY(e),this.feature2D&&this.feature2D.setRadiusY(e)},CgsEllipse.prototype.getRadiusY=function(){return this.feature3D?this.feature3D.getRadiusY():this.feature2D?this.feature2D.getRadiusY():void 0},CgsEllipse.prototype.setRotation=function(e){this.feature3D&&this.feature3D.setRotation(e),this.feature2D&&this.feature2D.setRotation(e)},CgsEllipse.prototype.getRotation=function(){return this.feature3D?this.feature3D.getRotation():this.feature2D?this.feature2D.getRotation():void 0},CgsEllipse.prototype.setFillColor=function(e){this.feature3D&&this.feature3D.setFillColor(e),this.feature2D&&this.feature2D.setFillColor(e)},CgsEllipse.prototype.getFillColor=function(){return this.feature3D?this.feature3D.getFillColor():this.feature2D?this.feature2D.getFillColor():void 0},CgsEllipse.prototype.setFill=function(e){this.feature3D&&this.feature3D.setFill(e),this.feature2D&&this.feature2D.setFill(e)},CgsEllipse.prototype.getFill=function(){return this.feature3D?this.feature3D.getFill():this.feature2D?this.feature2D.getFill():void 0},CgsEllipse.prototype.setOutlineColor=function(e){this.feature3D&&this.feature3D.setOutlineColor(e),this.feature2D&&this.feature2D.setOutlineColor(e)},CgsEllipse.prototype.getOutlineColor=function(){return this.feature3D?this.feature3D.getOutlineColor():this.feature2D?this.feature2D.getOutlineColor():void 0},CgsEllipse.prototype.setOutlineWidth=function(e){this.feature3D&&this.feature3D.setOutlineWidth(e),this.feature2D&&this.feature2D.setOutlineWidth(e)},CgsEllipse.prototype.getOutlineWidth=function(){return this.feature3D?this.feature3D.getOutlineWidth():this.feature2D?this.feature2D.getOutlineWidth():void 0},CgsEllipse.prototype.getOutlineDash=function(){if(this.feature2D)return this.feature2D.getOutlineDash()},CgsEllipse.prototype.setOutlineDash=function(e){this.feature2D&&this.feature2D.setOutlineDash(e)},CgsEllipse.prototype.setOutline=function(e){this.feature3D&&this.feature3D.setOutline(e),this.feature2D&&this.feature2D.setOutline(e)},CgsEllipse.prototype.getOutline=function(){return this.feature3D?this.feature3D.getOutline():this.feature2D?this.feature2D.getOutline():void 0},CgsEllipse.prototype.setHeight=function(e){this.feature3D&&this.feature3D.setHeight(e)},CgsEllipse.prototype.getHeight=function(){if(this.feature3D)return this.feature3D.getHeight()},CgsEllipse.prototype.setExtrudedHeight=function(e){this.feature3D&&this.feature3D.setExtrudedHeight(e)},CgsEllipse.prototype.getExtrudedHeight=function(){if(this.feature3D)return this.feature3D.getExtrudedHeight()},CgsEllipse.prototype.setStRotation=function(e){this.feature3D&&this.feature3D.setStRotation(e)},CgsEllipse.prototype.getStRotation=function(){if(this.feature3D)return this.feature3D.getStRotation()},CgsEllipse.prototype.setVisibleHeight=function(e){this.feature3D&&this.feature3D.setVisibleHeight(e)},CgsEllipse.prototype.getVisibleHeight=function(){if(this.feature3D)return this.feature3D.getVisibleHeight()},CgsEllipse.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name)this.setPosition(value);else if("fill"==name)this.setFill(value);else if("fillColor"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("outline"==name)this.setOutline(value);else if("radiusX"==name){var temp=parseFloat(value),radiusY=this.getRadiusY();if(temp<radiusY)return void CgsTipsWindow.showLog("长半轴长度不能小于短半轴，请重新输入！！！");this.setRadiusX(temp)}else if("radiusY"==name){var temp=parseFloat(value),radiusX=this.getRadiusX();if(radiusX<temp)return void CgsTipsWindow.showLog("短半轴长度不能大于长半轴，请重新输入！！！");this.setRadiusY(temp)}else if("height"==name)this.setHeight(parseFloat(value));else if("extrudedHeight"==name)this.setExtrudedHeight(parseFloat(value));else if("rotation"==name){var re=parseFloat(value)*Math.PI/180;this.setRotation(re)}else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsEllipse.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"椭圆"},{type:"hline"},{type:"cesiumPosition",label:"位置",name:"position",minusLngLatStepLen:1,plusLngLatStepLen:2,minusHeightStepLen:2e3,plusHeightStepLen:3e3,data:e.getPosition()},{type:"hline"},{type:"inputTypeNum",label:"长半轴长度",name:"radiusX",value:e.getRadiusX()},{type:"inputTypeNum",label:"短半轴长度",name:"radiusY",value:e.getRadiusY()},{type:"inputTypeNum",label:"拉伸高度",name:"extrudedHeight",value:e.getExtrudedHeight()},{type:"slider",label:"旋转角度",name:"rotation",max:360,min:0,defaultValue:e.getRotation(),fixedNumber:0},{type:"hline"},{type:"checkbox",label:"填充",name:"fill",value:e.getFill()},{type:"cesiumColor",label:"填充颜色",name:"fillColor",data:e.getFillColor()},{type:"hline"},{type:"checkbox",label:"轮廓线",name:"outline",value:e.getOutline()},{type:"cesiumColor",label:"轮廓线颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsEllipse.prototype.save=function(){var e=this;return{type:e.getType(),name:e.getName(),position:e.getPosition(),fill:e.getFill(),fillColor:e.getFillColor(),outline:e.getOutline(),outlineColor:e.getOutlineColor(),outlineWidth:e.getOutlineWidth(),radiusX:e.getRadiusX(),radiusY:e.getRadiusY(),height:e.getHeight(),extrudedHeight:e.getExtrudedHeight(),rotation:e.getRotation()}},CgsEllipse.load=function(e,t){var i=new CgsEllipse(t);e.addFeature(i)},CgsEllipsoid=function(e){CgsFeature.call(this,e),this.feature3D=new CgsEllipsoid3D(e)},CgsInherits(CgsEllipsoid,CgsFeature),CgsEllipsoid.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsEllipsoid.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsEllipsoid.prototype.setRadii=function(e){this.feature3D.setRadii(e)},CgsEllipsoid.prototype.getRadii=function(){return this.feature3D.getRadii()},CgsEllipsoid.prototype.setFill=function(e){this.feature3D.setFill(e)},CgsEllipsoid.prototype.getFill=function(){return this.feature3D.getFill()},CgsEllipsoid.prototype.setFillColor=function(e){this.feature3D.setFillColor(e)},CgsEllipsoid.prototype.getFillColor=function(){return this.feature3D.getFillColor()},CgsEllipsoid.prototype.setOutline=function(e){this.feature3D.setOutline(e)},CgsEllipsoid.prototype.getOutline=function(){return this.feature3D.getOutline()},CgsEllipsoid.prototype.setOutlineColor=function(e){this.feature3D.setOutlineColor(e)},CgsEllipsoid.prototype.getOutlineColor=function(){return this.feature3D.getOutlineColor()},CgsEllipsoid.prototype.setOutlineWidth=function(e){this.feature3D.setOutlineWidth(e)},CgsEllipsoid.prototype.getOutlineWidth=function(){return this.feature3D.getOutlineWidth()},CgsEllipsoid.prototype.setSubdivisions=function(e){this.feature3D.setSubdivisions(e)},CgsEllipsoid.prototype.getSubdivisions=function(){return this.feature3D.getSubdivisions()},CgsEllipsoid.prototype.setSlicePartitions=function(e){this.feature3D.setSlicePartitions(e)},CgsEllipsoid.prototype.getSlicePartitions=function(){return this.feature3D.getSlicePartitions()},CgsEllipsoid.prototype.setStackPartitions=function(e){this.feature3D.setStackPartitions(e)},CgsEllipsoid.prototype.getStackPartitions=function(){return this.feature3D.getStackPartitions()},CgsEllipsoid.prototype.setShadows=function(e){this.feature3D.setShadows(e)},CgsEllipsoid.prototype.getShadows=function(){return this.feature3D.getShadows()},CgsEllipsoid.prototype.setVisibleHeight=function(e){this.feature3D.setVisibleHeight(e)},CgsEllipsoid.prototype.getVisibleHeight=function(){return this.feature3D.getVisibleHeight()},CgsEllipsoid.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("position"==name)this.setPosition(value);else if("drag"==name)this.setDragEnable(value);else if("fill"==name)this.setFill(value);else if("outline"==name)this.setOutline(value);else if("subdivisions"==name)this.setSubdivisions(parseFloat(value));else if("stackPartitions"==name)this.setStackPartitions(parseFloat(value));else if("slicePartitions"==name)this.setSlicePartitions(parseFloat(value));else if("fillColor"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("radiiX"==name){var pp=this.getRadii();pp[0]=parseFloat(value),this.setRadii(pp)}else if("radiiY"==name){var pp=this.getRadii();pp[1]=parseFloat(value),this.setRadii(pp)}else if("radiiZ"==name){var pp=this.getRadii();pp[2]=parseFloat(value),this.setRadii(pp)}else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsEllipsoid.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"球/椭球"},{type:"hline"},{type:"cesiumPosition",label:"位置",name:"position",minusLngLatStepLen:1,plusLngLatStepLen:2,minusHeightStepLen:2e3,plusHeightStepLen:3e3,data:e.getPosition()},{type:"hline"},{type:"inputTypeNum",label:"x轴半径长度",name:"radiiX",value:e.getRadii()[0]},{type:"inputTypeNum",label:"y轴半径长度",name:"radiiY",value:e.getRadii()[1]},{type:"inputTypeNum",label:"z轴半径长度",name:"radiiZ",value:e.getRadii()[2]},{type:"hline"},{type:"slider",label:"曲率",name:"subdivisions",min:32,max:256,defaultValue:e.getSubdivisions(),fixedNumber:0},{type:"slider",label:"纬向切片数量",name:"stackPartitions",min:8,max:128,defaultValue:e.getStackPartitions(),fixedNumber:0},{type:"slider",label:"经向切片数量",name:"slicePartitions",min:8,max:128,defaultValue:e.getSlicePartitions(),fixedNumber:0},{type:"hline"},{type:"checkbox",label:"填充",name:"fill",value:e.getFill()},{type:"cesiumColor",label:"填充颜色",name:"fillColor",data:e.getFillColor()},{type:"hline"},{type:"checkbox",label:"轮廓线",name:"outline",value:e.getOutline()},{type:"cesiumColor",label:"轮廓线颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsEllipsoid.prototype.save=function(){var e=this;return{type:e.getType(),name:e.getName(),position:e.getPosition(),fill:e.getFill(),fillColor:e.getFillColor(),outline:e.getOutline(),outlineColor:e.getOutlineColor(),outlineWidth:e.getOutlineWidth(),shadows:e.getShadows(),subdivisions:e.getSubdivisions(),stackPartitions:e.getStackPartitions(),slicePartitions:e.getSlicePartitions()}},CgsEllipsoid.load=function(e,t){var i=new CgsEllipsoid(t);e.addFeature(i)},CgsEllipsoid.SHADOWS={DISABLED:Cesium.ShadowMode.DISABLED,CAST_ONLY:Cesium.ShadowMode.CAST_ONLY,ENABLED:Cesium.ShadowMode.ENABLED,RECEIVE_ONLY:Cesium.ShadowMode.RECEIVE_ONLY},CgsPolylineVolume=function(e){CgsFeature.call(this,e),this.feature3D=new CgsPolylineVolume3D(e)},CgsInherits(CgsPolylineVolume,CgsFeature),CgsPolylineVolume.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsPolylineVolume.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsPolylineVolume.prototype.setFill=function(e){this.feature3D.setFill(e)},CgsPolylineVolume.prototype.getFill=function(){return this.feature3D.getFill()},CgsPolylineVolume.prototype.setFillColor=function(e){this.feature3D.setFillColor(e)},CgsPolylineVolume.prototype.getFillColor=function(){return this.feature3D.getFillColor()},CgsPolylineVolume.prototype.setOutline=function(e){this.feature3D.setOutline(e)},CgsPolylineVolume.prototype.getOutline=function(){return this.feature3D.getOutline()},CgsPolylineVolume.prototype.setOutlineColor=function(e){this.feature3D.setOutlineColor(e)},CgsPolylineVolume.prototype.getOutlineColor=function(){return this.feature3D.getOutlineColor()},CgsPolylineVolume.prototype.setOutlineWidth=function(e){this.feature3D.setOutlineWidth(e)},CgsPolylineVolume.prototype.getOutlineWidth=function(){return this.feature3D.getOutlineWidth()},CgsPolylineVolume.prototype.setShape=function(e){this.feature3D.setShape(e)},CgsPolylineVolume.prototype.getShape=function(){return this.feature3D.getShape()},CgsPolylineVolume.prototype.setShadows=function(e){this.feature3D.setShadows(e)},CgsPolylineVolume.prototype.getShadows=function(){return this.feature3D.getShadows()},CgsPolylineVolume.prototype.setCornerType=function(e){this.feature3D.setCornerType(e)},CgsPolylineVolume.prototype.getCornerType=function(){return this.feature3D.getCornerType()},CgsPolylineVolume.prototype.setVisibleHeight=function(e){this.feature3D.setVisibleHeight(e)},CgsPolylineVolume.prototype.getVisibleHeight=function(){return this.feature3D.getVisibleHeight()},CgsPolylineVolume.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name){var pp=[];try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setPosition(pp)}else if("fill"==name)this.setFill(value);else if("shape"==name){var pp=[];try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setShape(pp)}else if("cornerType"==name){var re=null;switch(value){case"斜切角":re="BEVELED";break;case"斜接角":re="MITERED";break;case"圆形角":re="ROUNDED"}this.setCornerType(re)}else if("fillColor"==name)this.setFillColor(value);else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsPolylineVolume.prototype.getPropertyString=function(){var e=this,t=e.getCornerType();switch(t){case"BEVELED":t="斜切角";break;case"MITERED":t="斜接角";break;case"ROUNDED":t="圆形角"}var i=[];return i.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"管道"},{type:"hline"},{type:"input",label:"位置",name:"position",value:CgsFeature.traverse(e.getPosition())},{type:"input",label:"切面形状",name:"shape",value:CgsFeature.traverse(e.getShape())},{type:"hline"},{type:"dropdown",label:"拐角类型",name:"cornerType",defaultValue:t,data:[{value:0,label:"斜切角"},{value:1,label:"斜接角"},{value:2,label:"圆形角"}]},{type:"checkbox",label:"填充",name:"fill",value:e.getFill()},{type:"cesiumColor",label:"填充颜色",name:"fillColor",data:e.getFillColor()},{type:"hline"},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),i},CgsPolylineVolume.prototype.save=function(){var e=this;return{type:e.getType(),name:e.getName(),positions:e.getPosition(),fill:e.getFill(),fillColor:e.getFillColor(),outline:e.getOutline(),outlineColor:e.getOutlineColor(),outlineWidth:e.getOutlineWidth(),shadows:e.getShadows(),shape:e.getShape(),cornerType:e.getCornerType()}},CgsPolylineVolume.load=function(e,t){var i=new CgsPolylineVolume(t);e.addFeature(i)},CgsPolylineVolume.SHADOWS={DISABLED:Cesium.ShadowMode.DISABLED,CAST_ONLY:Cesium.ShadowMode.CAST_ONLY,ENABLED:Cesium.ShadowMode.ENABLED,RECEIVE_ONLY:Cesium.ShadowMode.RECEIVE_ONLY},CgsPolylineVolume.CORNERTYPE={BEVELED:Cesium.CornerType.BEVELED,MITERED:Cesium.CornerType.MITERED,ROUNDED:Cesium.CornerType.ROUNDED},CgsWall=function(e){CgsFeature.call(this,e),this.feature3D=new CgsWall3D(e)},CgsInherits(CgsWall,CgsFeature),CgsWall.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsWall.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsWall.prototype.setFill=function(e){this.feature3D.setFill(e)},CgsWall.prototype.getFill=function(){return this.feature3D.getFill()},CgsWall.prototype.setFillColor=function(e){this.feature3D.setFillColor(e)},CgsWall.prototype.getFillColor=function(){return this.feature3D.getFillColor()},CgsWall.prototype.setOutline=function(e){this.feature3D.setOutline(e)},CgsWall.prototype.getOutline=function(){return this.feature3D.getOutline()},CgsWall.prototype.setOutlineColor=function(e){this.feature3D.setOutlineColor(e)},CgsWall.prototype.getOutlineColor=function(){return this.feature3D.getOutlineColor()},CgsWall.prototype.setOutlineWidth=function(e){this.feature3D.setOutlineWidth(e)},CgsWall.prototype.getOutlineWidth=function(){return this.feature3D.getOutlineWidth()},CgsWall.prototype.setShadows=function(e){this.feature3D.setShadows(e)},CgsWall.prototype.getShadows=function(){return this.feature3D.getShadows()},CgsWall.prototype.setVisibleHeight=function(e){this.feature3D.setVisibleHeight(e)},CgsWall.prototype.getVisibleHeight=function(){return this.feature3D.getVisibleHeight()},CgsWall.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setPosition(pp)}else if("fill"==name)this.setFill(value);else if("outline"==name)this.setOutline(value);else if("fillColor"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsWall.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"墙"},{type:"hline"},{type:"input",label:"位置",name:"position",value:CgsFeature.traverse(e.getPosition())},{type:"hline"},{type:"checkbox",label:"填充",name:"fill",value:e.getFill()},{type:"cesiumColor",label:"填充颜色",name:"fillColor",data:e.getFillColor()},{type:"hline"},{type:"checkbox",label:"轮廓线",name:"outline",value:e.getOutline()},{type:"cesiumColor",label:"轮廓线颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"hline"},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsWall.prototype.save=function(){return{type:this.getType(),name:this.getName(),positions:this.getPosition(),fill:this.getFill(),fillColor:this.getFillColor(),outline:this.getOutline(),outlineColor:this.getOutlineColor(),outlineWidth:this.getOutlineWidth(),shadows:this.getShadows()}},CgsWall.load=function(e,t){var i=new CgsWall(t);e.addFeature(i)},CgsPoint=function(e){CgsFeature.call(this,e),1==window.WGMODEFLAG?(this.feature2D=new CgsPoint2D(e),this.feature3D=new CgsPoint3D(e)):2==window.WGMODEFLAG?this.feature2D=new CgsPoint2D(e):3==window.WGMODEFLAG&&(this.feature3D=new CgsPoint3D(e))},CgsInherits(CgsPoint,CgsFeature),CgsPoint.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.feature2D&&this.feature2D.setPosition(e),this.feature3D&&this.feature3D.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsPoint.prototype.getPosition=function(){return this.feature3D?this.feature3D.getPosition():this.feature2D?this.feature2D.getPosition():void 0},CgsPoint.prototype.setPixelSize=function(e){this.feature2D&&this.feature2D.setPixelSize(e),this.feature3D&&this.feature3D.setPixelSize(e)},CgsPoint.prototype.getPixelSize=function(){return this.feature3D?this.feature3D.getPixelSize():this.feature2D?this.feature2D.getPixelSize():void 0},CgsPoint.prototype.setFillColor=function(e){var t;this.feature2D&&(t=ol.color.asString(e),this.feature2D.setFillColor(t)),this.feature3D&&this.feature3D.setFillColor(e)},CgsPoint.prototype.getFillColor=function(){return this.feature3D?this.feature3D.getFillColor():this.feature2D?this.feature2D.getFillColor():void 0},CgsPoint.prototype.setOutlineColor=function(e){var t;this.feature2D&&(t=ol.color.asString(e),this.feature2D.setOutlineColor(t)),this.feature3D&&this.feature3D.setOutlineColor(e)},CgsPoint.prototype.setColor=function(e){var t;this.feature2D&&(t=ol.color.asString(e),this.feature2D.setColor(t)),this.feature3D&&this.feature3D.setColor(e)},CgsPoint.prototype.getOutlineColor=function(){return this.feature3D?this.feature3D.getOutlineColor():this.feature2D?this.feature2D.getOutlineColor():void 0},CgsPoint.prototype.setOutlineWidth=function(e){this.feature2D&&this.feature2D.setOutlineWidth(e),this.feature3D&&this.feature3D.setOutlineWidth(e)},CgsPoint.prototype.getOutlineWidth=function(){return this.feature3D?this.feature3D.getOutlineWidth():this.feature2D?this.feature2D.getOutlineWidth():void 0},CgsPoint.prototype.setVisibleHeight=function(e){var t;this.feature3D&&("[object Array]"==Object.prototype.toString.call(e)&&e[0]>e[1]&&(t=e[0],e[0]=e[1],e[1]=t),this.feature3D.setVisibleHeight(e))},CgsPoint.prototype.getVisibleHeight=function(){if(this.feature3D)return this.feature3D.getVisibleHeight()},CgsPoint.prototype.setHeightReference=function(e){this.feature3D&&this.feature3D.setHeightReference(e)},CgsPoint.prototype.getHeightReference=function(){if(this.feature3D)return this.feature3D.getHeightReference()},CgsPoint.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name)this.setPosition(value);else if("pixelSize"==name)this.setPixelSize(parseInt(value));else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}else"fillColor"==name?this.setFillColor(value):"outlineColor"==name?this.setOutlineColor(value):"outlineWidth"==name&&this.setOutlineWidth(parseFloat(value))},CgsPoint.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"点"},{type:"hline"},{type:"cesiumPosition",label:"位置",name:"position",minusLngLatStepLen:1,plusLngLatStepLen:2,minusHeightStepLen:2e3,plusHeightStepLen:3e3,data:e.getPosition()},{type:"hline"},{type:"inputTypeNum",label:"大小(像素)",name:"pixelSize",value:e.getPixelSize()},{type:"cesiumColor",label:"填充颜色",name:"fillColor",data:e.getFillColor()},{type:"hline"},{type:"inputTypeNum",label:"轮廓线宽度(像素)",name:"outlineWidth",value:e.getOutlineWidth()},{type:"cesiumColor",label:"轮廓线颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"hline"},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsPoint.prototype.save=function(){return{type:this.getType(),name:this.getName(),position:this.getPosition(),fillColor:this.getFillColor(),outlineColor:this.getOutlineColor(),outlineWidth:this.getOutlineWidth(),pixelSize:this.getPixelSize(),visibleHeight:this.getVisibleHeight()}},CgsPoint.load=function(e,t){var i=new CgsPoint(t);e.addFeature(i),i.setVisibleHeight(t.visibleHeight)},CgsLine=function(e){CgsFeature.call(this,e),1==window.WGMODEFLAG?(this instanceof CgsLineAnimation||(this.feature2D=new CgsLine2D(e)),this.feature3D=new CgsLine3D(e)):2==window.WGMODEFLAG?this instanceof CgsLineAnimation||(this.feature2D=new CgsLine2D(e)):3==window.WGMODEFLAG&&(this.feature3D=new CgsLine3D(e))},CgsInherits(CgsLine,CgsFeature),CgsLine.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.feature3D&&this.feature3D.setPosition(e),this.feature2D&&this.feature2D.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsLine.prototype.getPosition=function(){return this.feature3D?this.feature3D.getPosition():this.feature2D?this.feature2D.getPosition():void 0},CgsLine.prototype.setFillColor=function(e){var t;this.feature2D&&(t=ol.color.asString(e),this.feature2D.setFillColor(t)),this.feature3D&&this.feature3D.setFillColor(e)},CgsLine.prototype.getFillColor=function(){return this.feature3D?this.feature3D.getFillColor():this.feature2D?this.feature2D.getFillColor():void 0},CgsLine.prototype.setWidth=function(e){this.feature3D&&this.feature3D.setWidth(e),this.feature2D&&this.feature2D.setWidth(e)},CgsLine.prototype.getWidth=function(){return this.feature3D?this.feature3D.getWidth():this.feature2D?this.feature2D.getWidth():void 0},CgsLine.prototype.setGlowPower=function(e){this.feature3D&&this.feature3D.setGlowPower(e)},CgsLine.prototype.getGlowPower=function(){if(this.feature3D)return this.feature3D.getGlowPower()},CgsLine.prototype.setOutlineColor=function(e){this.feature3D&&this.feature3D.setOutlineColor(e)},CgsLine.prototype.getOutlineColor=function(){if(this.feature3D)return this.feature3D.getOutlineColor()},CgsLine.prototype.setOutlineWidth=function(e){this.feature3D&&this.feature3D.setOutlineWidth(e)},CgsLine.prototype.getOutlineWidth=function(){if(this.feature3D)return this.feature3D.getOutlineWidth()},CgsLine.prototype.getLineType=function(){if(this.feature3D)return this.feature3D.getLineType()},CgsLine.prototype.setFollowSurface=function(e){this.feature3D&&this.feature3D.setFollowSurface(e)},CgsLine.prototype.getFollowSurface=function(){if(this.feature3D)return this.feature3D.getFollowSurface()},CgsLine.prototype.getPointInLine=function(e){if(this.feature3D)return this.feature3D.getPointInLine(e)},CgsLine.prototype.setVisibleHeight=function(e){this.feature3D&&this.feature3D.setVisibleHeight(e)},CgsLine.prototype.getVisibleHeight=function(){if(this.feature3D)return this.feature3D.getVisibleHeight()},CgsLine.prototype.setPositionByCenterRadiusAngle=function(e,t,i){var s=[e,CgsUtil.createPositionByAngle(e,t,i)];this.setPosition(s)},CgsLine.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name){var pp=[];try{pp=eval(value)}catch(e){CgsTipsWindow.showLog("输入格式错误，请重新输入！")}this.setPosition(pp)}else if("fillColor"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("followSurface"==name)this.setFollowSurface(value);else if("width"==name)this.setWidth(parseFloat(value));else if("glowPower"==name)this.setGlowPower(parseFloat(value));else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsLine.prototype.getPropertyString=function(){var e=this,t=[];t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"线"},{type:"hline"},{type:"checkbox",label:"贴地",name:"followSurface",value:e.getFollowSurface()},{type:"input",label:"位置",name:"position",value:CgsFeature.traverse(e.getPosition())},{type:"slider",label:"宽度",name:"width",min:1,max:72,defaultValue:e.getWidth(),fixedNumber:2},{type:"hline"},{type:"cesiumColor",label:"颜色",name:"fillColor",data:e.getFillColor()},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()});var i=e.getLineType();return i==CgsLine3D.LINT_TYPE_1?t.push({type:"hline"},{type:"slider",label:"渐变度",name:"glowPower",min:0,max:1,defaultValue:e.getGlowPower(),fixedNumber:2},{type:"input",label:"线形",name:"lineType",value:"发光线",readonly:!0}):i==CgsLine3D.LINT_TYPE_2?t.push({type:"hline"},{type:"cesiumColor",label:"轮廓线颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"input",label:"线形",name:"lineType",value:"轮廓线",readonly:!0}):i==CgsLine3D.LINT_TYPE_3?t.push({type:"input",label:"线形",name:"lineType",value:"箭头线",readonly:!0}):i==CgsLine3D.LINT_TYPE_4||i==CgsLine3D.LINT_TYPE_5?t.push({type:"input",label:"线形",name:"lineType",value:"虚线",readonly:!0}):t.push({type:"input",label:"线形",name:"lineType",value:"一般线",readonly:!0}),t},CgsLine.prototype.save=function(){var e=this;return e.getLineType()==CgsLine3D.LINT_GLOW?{type:e.getType(),name:e.getName(),show:e.getVisible(),positions:e.getPosition(),fillColor:e.getFillColor(),followSurface:e.getFollowSurface(),width:e.getWidth(),glowPower:e.getGlowPower(),lineType:CgsLine3D.LINT_GLOW}:e.getLineType()==CgsLine3D.LINT_OUTLINE?{type:e.getType(),name:e.getName(),show:e.getVisible(),positions:e.getPosition(),fillColor:e.getFillColor(),followSurface:e.getFollowSurface(),width:e.getWidth(),outlineWidth:e.getOutlineWidth(),outlineColor:e.getOutlineColor(),lineType:CgsLine3D.LINT_OUTLINE}:e.getLineType()==CgsLine3D.LINT_ARROW?{type:e.getType(),name:e.getName(),show:e.getVisible(),positions:e.getPosition(),fillColor:e.getFillColor(),followSurface:e.getFollowSurface(),width:e.getWidth(),lineType:CgsLine3D.LINT_ARROW}:e.getLineType()==CgsLine3D.LINT_DASHED?{type:e.getType(),name:e.getName(),show:e.getVisible(),positions:e.getPosition(),fillColor:e.getFillColor(),followSurface:e.getFollowSurface(),width:e.getWidth(),lineType:CgsLine3D.LINT_DASHED}:{type:e.getType(),name:e.getName(),show:e.getVisible(),positions:e.getPosition(),fillColor:e.getFillColor(),followSurface:e.getFollowSurface(),width:e.getWidth()}},CgsLine.load=function(e,t){var i=new(t.lineType==CgsLine3D.LINT_DASHED?CgsDashLine:CgsLine)(t);e.addFeature(i)},CgsPolygon=function(e){CgsFeature.call(this,e),1==window.WGMODEFLAG?(this.feature3D=new CgsPolygon3D(e),this.feature2D=new CgsPolygon2D(e)):2==window.WGMODEFLAG?this.feature2D=new CgsPolygon2D(e):3==window.WGMODEFLAG&&(this.feature3D=new CgsPolygon3D(e))},CgsInherits(CgsPolygon,CgsFeature),CgsPolygon.prototype.setPosition=function(e){"[object Array]"!=Object.prototype.toString.call(e[0][0])&&(e=[e]),CgsUtil.verifyLonLat(e)?(this.feature2D&&this.feature2D.setPosition(e),this.feature3D&&this.feature3D.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsPolygon.prototype.getPosition=function(){return this.feature3D?this.feature3D.getPosition():this.feature2D?this.feature2D.getPosition():void 0},CgsPolygon.prototype.setFillColor=function(e){var t;this.feature2D&&(t=ol.color.asString(e),this.feature2D.setFillColor(t)),this.feature3D&&this.feature3D.setFillColor(e)},CgsPolygon.prototype.getFillColor=function(){return this.feature3D?this.feature3D.getFillColor():this.feature2D?this.feature2D.getFillColor():void 0},CgsPolygon.prototype.setOutlineColor=function(e){var t;this.feature2D&&(t=ol.color.asString(e),this.feature2D.setOutlineColor(t)),this.feature3D&&this.feature3D.setOutlineColor(e)},CgsPolygon.prototype.getOutlineColor=function(){return this.feature3D?this.feature3D.getOutlineColor():this.feature2D?this.feature2D.getOutlineColor():void 0},CgsPolygon.prototype.setOutlineWidth=function(e){this.feature2D&&this.feature2D.setOutlineWidth(e),this.feature3D&&this.feature3D.setOutlineWidth(e)},CgsPolygon.prototype.getOutlineWidth=function(){return this.feature3D?this.feature3D.getOutlineWidth():this.feature2D?this.feature2D.getOutlineWidth():void 0},CgsPolygon.prototype.setExtrudedHeight=function(e){this.feature3D&&this.feature3D.setExtrudedHeight(e)},CgsPolygon.prototype.getExtrudedHeight=function(){if(this.feature3D)return this.feature3D.getExtrudedHeight()},CgsPolygon.prototype.setHeight=function(e){this.feature3D&&this.feature3D.setHeight(e)},CgsPolygon.prototype.getHeight=function(){if(this.feature3D)return this.feature3D.getHeight()},CgsPolygon.prototype.setCloseTop=function(e){this.feature3D&&this.feature3D.setCloseTop(e)},CgsPolygon.prototype.getCloseTop=function(){if(this.feature3D)return this.feature3D.getCloseTop()},CgsPolygon.prototype.setCloseBottom=function(e){this.feature3D&&this.feature3D.setCloseBottom(e)},CgsPolygon.prototype.getCloseBottom=function(){if(this.feature3D)return this.feature3D.getCloseBottom()},CgsPolygon.prototype.setOutline=function(e){this.feature3D&&this.feature3D.setOutline(e),this.feature2D&&this.feature2D.setOutline(e)},CgsPolygon.prototype.getOutline=function(){return this.feature3D?this.feature3D.getOutline():this.feature2D?this.feature2D.getOutline():void 0},CgsPolygon.prototype.setFill=function(e){this.feature3D&&this.feature3D.setFill(e),this.feature2D&&this.feature2D.setFill(e)},CgsPolygon.prototype.getFill=function(){return this.feature3D?this.feature3D.getFill():this.feature2D?this.feature2D.getFill():void 0},CgsPolygon.prototype.setVisibleHeight=function(e){this.feature3D&&this.feature3D.setVisibleHeight(e)},CgsPolygon.prototype.getVisibleHeight=function(){if(this.feature3D)return this.feature3D.getVisibleHeight()},CgsPolygon.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name){var pp=[];try{pp=eval(value)}catch(e){console.log("输入格式错误，请重新输入！！！")}this.setPosition(pp)}else if("outlineColor"==name)this.setOutlineColor(value);else if("outline"==name)this.setOutline(value);else if("surfaceHeight"==name)this.setHeight(parseFloat(value));else if("rotation"==name)this.setRotation(parseFloat(value));else if("extrudedHeight"==name)this.setExtrudedHeight(parseFloat(value));else if("fillFlag"==name)this.setFill(value);else if("closeTop"==name)this.setCloseTop(value);else if("closeBottom"==name)this.setCloseBottom(value);else if("fill"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void console.log("输入格式错误！")}this.setVisibleHeight(pp)}},CgsPolygon.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"多边形"},{type:"hline"},{type:"input",label:"位置",name:"position",value:CgsFeature.traverse(e.getPosition())},{type:"checkbox",label:"顶部可见",name:"closeTop",value:e.getCloseTop()},{type:"checkbox",label:"底部可见",name:"closeBottom",value:e.getCloseBottom()},{type:"inputTypeNum",label:"距地高度",name:"surfaceHeight",value:e.getHeight()},{type:"inputTypeNum",label:"拉伸高度",name:"extrudedHeight",value:e.getExtrudedHeight()},{type:"hline"},{type:"checkbox",label:"填充",name:"fillFlag",value:e.getFill()},{type:"cesiumColor",label:"填充颜色",name:"fill",data:e.getFillColor()},{type:"hline"},{type:"checkbox",label:"轮廓线",name:"outline",value:e.getOutline()},{type:"cesiumColor",label:"轮廓线颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"hline"},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsPolygon.prototype.save=function(){var e=this;return{type:e.getType(),name:e.getName(),positions:e.getPosition(),fill:e.getFill(),fillColor:e.getFillColor(),outline:e.getOutline(),outlineColor:e.getOutlineColor(),outlineWidth:e.getOutlineWidth(),closeTop:e.getCloseTop(),closeBottom:e.getCloseBottom(),height:e.getHeight(),extrudedHeight:e.getExtrudedHeight()}},CgsPolygon.load=function(e,t){var i=new CgsPolygon(t);e.addFeature(i)},CgsRect=function(e){CgsFeature.call(this,e),1==window.WGMODEFLAG?(this.feature2D=new CgsRect2D(e),this.feature3D=new CgsRect3D(e)):2==window.WGMODEFLAG?this.feature2D=new CgsRect2D(e):3==window.WGMODEFLAG&&(this.feature3D=new CgsRect3D(e))},CgsInherits(CgsRect,CgsFeature),CgsRect.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.feature2D&&this.feature2D.setPosition(e),this.feature3D&&this.feature3D.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsRect.prototype.getPosition=function(){return this.feature3D?this.feature3D.getPosition():this.feature2D?this.feature2D.getPosition():void 0},CgsRect.prototype.setFill=function(e){this.feature3D?this.feature3D.setFill(e):this.feature2D&&this.feature2D.setFill(e)},CgsRect.prototype.getFill=function(){return this.feature3D.getFill()},CgsRect.prototype.setFillColor=function(e){this.feature2D.setFillColor(e),this.feature3D.setFillColor(e)},CgsRect.prototype.getFillColor=function(){return this.feature3D.getFillColor()},CgsRect.prototype.setOutline=function(e){this.feature2D.setOutline(e),this.feature3D.setOutline(e)},CgsRect.prototype.getOutline=function(){return this.feature3D.getOutline()},CgsRect.prototype.setOutlineColor=function(e){this.feature2D.setOutlineColor(e),this.feature3D.setOutlineColor(e)},CgsRect.prototype.getOutlineColor=function(){return this.feature3D.getOutlineColor()},CgsRect.prototype.setOutlineWidth=function(e){this.feature2D.setOutlineWidth(e),this.feature3D.setOutlineWidth(e)},CgsRect.prototype.getOutlineWidth=function(){return this.feature3D.getOutlineWidth()},CgsRect.prototype.getOutlineDash=function(){return this.feature2D.getOutlineDash()},CgsRect.prototype.setOutlineDash=function(e){this.feature2D.setOutlineDash(e)},CgsRect.prototype.setExtrudedHeight=function(e){this.feature3D.setExtrudedHeight(e)},CgsRect.prototype.getExtrudedHeight=function(){return this.feature3D.getExtrudedHeight()},CgsRect.prototype.setHeight=function(e){this.feature3D.setHeight(e)},CgsRect.prototype.getHeight=function(){return this.feature3D.getHeight()},CgsRect.prototype.setVisibleHeight=function(e){this.feature3D.setVisibleHeight(e)},CgsRect.prototype.getVisibleHeight=function(){return this.feature3D.getVisibleHeight()},CgsRect.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name){var pp=[];try{pp=eval(value)}catch(e){alert("输入格式错误！")}this.setPosition(pp)}else if("outline"==name)this.setOutline(value);else if("surfaceHeight"==name)this.setHeight(parseFloat(value));else if("extrudedHeight"==name)this.setExtrudedHeight(parseFloat(value));else if("fillColor"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void console.log("输入格式错误！")}this.setVisibleHeight(pp)}},CgsRect.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"矩形"},{type:"hline"},{type:"input",label:"位置",name:"position",value:CgsFeature.traverse(e.getPosition())},{type:"inputTypeNum",label:"距地高度",name:"surfaceHeight",value:e.getHeight()},{type:"inputTypeNum",label:"拉伸高度",name:"extrudedHeight",value:e.getExtrudedHeight()},{type:"hline"},{type:"checkbox",label:"轮廓线",name:"outline",value:e.getOutline()},{type:"cesiumColor",label:"轮廓线颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"hline"},{type:"cesiumColor",label:"填充颜色",name:"fillColor",data:e.getFillColor()},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsRect.prototype.save=function(){return{type:this.getType(),name:this.getName(),positions:this.getPosition(),fillColor:this.getFillColor(),outline:this.getOutline(),outlineColor:this.getOutlineColor(),outlineWidth:this.getOutlineWidth(),height:this.getHeight(),extrudedHeight:this.getExtrudedHeight()}},CgsRect.load=function(e,t){var i=new CgsRect(t);e.addFeature(i)},CgsMark=function(e){CgsFeature.call(this,e),null==e.name&&(e.name=""),1==window.WGMODEFLAG?(this.feature3D=new CgsMark3D(e),this.feature2D=new CgsMark2D(e)):2==window.WGMODEFLAG?this.feature2D=new CgsMark2D(e):3==window.WGMODEFLAG&&(this.feature3D=new CgsMark3D(e))},CgsInherits(CgsMark,CgsFeature),CgsMark.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.feature3D&&this.feature3D.setPosition(e),this.feature2D&&this.feature2D.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsMark.prototype.getPosition=function(){return this.feature3D?this.feature3D.getPosition():this.feature2D?this.feature2D.getPosition():void 0},CgsMark.prototype.setUrl=function(e,t){this.feature3D&&this.feature3D.setUrl(e),this.feature2D&&this.feature2D.setUrl(e,t)},CgsMark.prototype.getUrl=function(){return this.feature3D?this.feature3D.getUrl():this.feature2D?this.feature2D.getUrl():void 0},CgsMark.prototype.setScale=function(e){this.feature3D&&this.feature3D.setScale(e),this.feature2D&&this.feature2D.setIconScale(e)},CgsMark.prototype.getScale=function(){if(this.feature3D)return this.feature3D.getScale()},CgsMark.prototype.setRotation=function(e){this.feature3D&&this.feature3D.setRotation(e),this.feature2D&&this.feature2D.setRotation(e)},CgsMark.prototype.getRotation=function(){return this.feature3D?this.feature3D.getRotation():this.feature2D?this.feature2D.getRotation():void 0},CgsMark.prototype.setPositioning=function(e){this.feature3D&&this.feature3D.setPositioning(e),this.feature2D&&this.feature2D.setPositioning(e)},CgsMark.prototype.getPositioning=function(){if(this.feature3D)return this.feature3D.getPositioning()},CgsMark.prototype.setPixelOffset=function(e){this.feature3D&&this.feature3D.setPixelOffset(e),this.feature2D&&this.feature2D.setPixelOffset(e)},CgsMark.prototype.getPixelOffset=function(){return this.feature3D?this.feature3D.getPixelOffset():this.feature2D?this.feature2D.getPixelOffset():void 0},CgsMark.prototype.setColor=function(e){this.feature2D&&this.feature2D.setColor(e),this.feature3D&&this.feature3D.setColor(e)},CgsMark.prototype.getColor=function(){if(this.feature3D)return this.feature3D.getColor()},CgsMark.prototype.setVisibleHeight=function(e){this.feature3D&&this.feature3D.setVisibleHeight(e)},CgsMark.prototype.getVisibleHeight=function(){if(this.feature3D)return this.feature3D.getVisibleHeight()},CgsMark.prototype.setRotationByVector=function(e){this.feature3D&&this.feature3D.setRotationByVector(e),this.feature2D&&this.feature2D.setRotationByVector(e)},CgsMark.prototype.stopAutoRotation=function(){this.feature3D&&this.feature3D.stopAutoRotation(),this.setRotation(this.getRotation())},CgsMark.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name)this.setPosition(value);else if("scale"==name)this.setScale(value);else if("rotation"==name)this.setRotation(value);else if("positioning"==name){var re=null;switch(value){case"左上":re=CgsMark.positioning_TOPLEFT;break;case"中上":re=CgsMark.positioning_TOPCENTER;break;case"右上":re=CgsMark.positioning_TOPRIGHT;break;case"左中":re=CgsMark.positioning_CENTERLEFT;break;case"中心":re=CgsMark.positioning_CENTER;break;case"右中":re=CgsMark.positioning_CENTERRIGHT;break;case"左下":re=CgsMark.positioning_BOTTOMLEFT;break;case"中下":re=CgsMark.positioning_BOTTOMCENTER;break;case"右下":re=CgsMark.positioning_BOTTOMRIGHT}this.setPositioning(re)}else if("offsetX"==name){var pp=this.getPixelOffset();pp[0]=parseFloat(value),this.setPixelOffset(pp)}else if("offsetY"==name){var pp=this.getPixelOffset();pp[1]=parseFloat(value),this.setPixelOffset(pp)}else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void console.log("输入格式错误！")}this.setVisibleHeight(pp)}else"url"==name&&this.setUrl(value)},CgsMark.prototype.getPropertyString=function(){var e=this,t=[],i=e.getPositioning();switch(i){case"top-left":i="左上";break;case"top-center":i="中上";break;case"top-right":i="右上";break;case"center-left":i="左中";break;case"center-center":i="中心";break;case"center-right":i="右中";break;case"bottom-left":i="左下";break;case"bottom-center":i="中下";break;case"bottom-right":i="右下"}return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"标记"},{type:"hline"},{type:"cesiumPosition",label:"位置",name:"position",minusLngLatStepLen:1,plusLngLatStepLen:2,minusHeightStepLen:2e3,plusHeightStepLen:3e3,data:e.getPosition()},{type:"hline"},{type:"dropdown",label:"对齐方式",name:"positioning",defaultValue:i,data:[{value:0,label:"左上"},{value:1,label:"中上"},{value:2,label:"右上"},{value:3,label:"左中"},{value:4,label:"中心"},{value:5,label:"右中"},{value:6,label:"左下"},{value:7,label:"中下"},{value:8,label:"右下"}]},{type:"inputTypeNum",label:"偏移量x(像素)",name:"offsetX",value:e.getPixelOffset()[0]},{type:"inputTypeNum",label:"偏移量y(像素)",name:"offsetY",value:e.getPixelOffset()[1]},{type:"inputTypeNum",label:"缩放",name:"scale",value:e.getScale()},{type:"hline"},{type:"slider",label:"旋转角度",name:"rotation",min:0,max:360,defaultValue:e.getRotation()},{type:"input",label:"资源路径",name:"url",value:e.getUrl()},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsMark.prototype.save=function(){var e=this;return{type:e.getType(),name:e.getName(),position:e.getPosition(),scale:e.getScale(),rotation:e.getRotation(),positioning:e.getPositioning(),pixelOffset:"["+e.getPixelOffset()+"]",fillColor:e.getColor(),visibleHeight:e.getVisibleHeight(),url:e.getUrl()}},CgsMark.load=function(map,options){options.pixelOffset=eval(options.pixelOffset);var mark=new CgsMark(options);map.addFeature(mark),mark.setVisibleHeight(options.visibleHeight)},CgsMark.positioning_TOPLEFT="top-left",CgsMark.positioning_TOPCENTER="top-center",CgsMark.positioning_TOPRIGHT="top-right",CgsMark.positioning_CENTERLEFT="center-left",CgsMark.positioning_CENTER="center-center",CgsMark.positioning_CENTERRIGHT="center-right",CgsMark.positioning_BOTTOMLEFT="bottom-left",CgsMark.positioning_BOTTOMCENTER="bottom-center",CgsMark.positioning_BOTTOMRIGHT="bottom-right",CgsMarkCollection=function(e){this.feature3D=new CgsMark3DCollection(e)},CgsInherits(CgsMarkCollection,CgsFeature),CgsCircle=function(e){CgsFeature.call(this,e),1==window.WGMODEFLAG?(this.feature3D=new CgsCircle3D(e),this.feature2D=new CgsCircle2D(e)):2==window.WGMODEFLAG?this.feature2D=new CgsCircle2D(e):3==window.WGMODEFLAG&&(this.feature3D=new CgsCircle3D(e))},CgsInherits(CgsCircle,CgsFeature),CgsCircle.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.feature3D&&this.feature3D.setPosition(e),this.feature2D&&this.feature2D.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsCircle.prototype.getPosition=function(){return this.feature3D?this.feature3D.getPosition():this.feature2D?this.feature2D.getPosition():void 0},CgsCircle.prototype.setRadius=function(e){this.feature3D&&this.feature3D.setRadius(e),this.feature2D&&this.feature2D.setRadius(e)},CgsCircle.prototype.getRadius=function(){return this.feature3D?this.feature3D.getRadius():this.feature2D?this.feature2D.getRadius():void 0},CgsCircle.prototype.setFill=function(e){this.feature3D&&this.feature3D.setFill(e),this.feature2D&&this.feature2D.setFill(e)},CgsCircle.prototype.getFill=function(){return this.feature3D?this.feature3D.getFill():this.feature2D?this.feature2D.getFill():void 0},CgsCircle.prototype.setFillColor=function(e){var t;this.feature3D&&this.feature3D.setFillColor(e),this.feature2D&&(t=ol.color.asString(e),this.feature2D.setFillColor(t))},CgsCircle.prototype.getFillColor=function(){return this.feature3D?this.feature3D.getFillColor():this.feature2D?this.feature2D.getFillColor():void 0},CgsCircle.prototype.setOutlineColor=function(e){var t;this.feature3D&&this.feature3D.setOutlineColor(e),this.feature2D&&(t=ol.color.asString(e),this.feature2D.setOutlineColor(t))},CgsCircle.prototype.getOutlineColor=function(){return this.feature3D?this.feature3D.getOutlineColor():this.feature2D?this.feature2D.getOutlineColor():void 0},CgsCircle.prototype.setOutlineWidth=function(e){this.feature3D&&this.feature3D.setOutlineWidth(e),this.feature2D&&this.feature2D.setOutlineWidth(e)},CgsCircle.prototype.getOutlineWidth=function(){return this.feature3D?this.feature3D.getOutlineWidth():this.feature2D?this.feature2D.getOutlineWidth():void 0},CgsCircle.prototype.getOutlineDash=function(){if(this.feature2D)return this.feature2D.getOutlineWidth()},CgsCircle.prototype.setOutlineDash=function(e){this.feature2D&&this.feature2D.setOutlineDash(e)},CgsCircle.prototype.setOutline=function(e){this.feature3D&&this.feature3D.setOutline(e),this.feature2D&&this.feature2D.setOutline(e)},CgsCircle.prototype.getOutline=function(){return this.feature3D?this.feature3D.getOutline():this.feature2D?this.feature2D.getOutline():void 0},CgsCircle.prototype.setHeight=function(e){this.feature3D&&this.feature3D.setHeight(e)},CgsCircle.prototype.getHeight=function(){if(this.feature3D)return this.feature3D.getHeight()},CgsCircle.prototype.setVisibleHeight=function(e){this.feature3D&&this.feature3D.setVisibleHeight(e)},CgsCircle.prototype.getVisibleHeight=function(){if(this.feature3D)return this.feature3D.getVisibleHeight()},CgsCircle.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name)this.setPosition(value);else if("fillColor"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("outline"==name)this.setOutline(value);else if("radius"==name)this.setRadius(parseFloat(value));else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsCircle.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"圆"},{type:"hline"},{type:"cesiumPosition",label:"位置",name:"position",minusLngLatStepLen:1,plusLngLatStepLen:2,minusHeightStepLen:2e3,plusHeightStepLen:3e3,data:e.getPosition()},{type:"hline"},{type:"inputTypeNum",label:"半径",name:"radius",value:e.getRadius()},{type:"cesiumColor",label:"颜色",name:"fillColor",data:e.getFillColor()},{type:"hline"},{type:"checkbox",label:"轮廓线",name:"outline",value:e.getOutline()},{type:"cesiumColor",label:"轮廓线颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"hline"},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsCircle.prototype.save=function(){var e=this;return{type:e.getType(),name:e.getName(),position:e.getPosition(),fill:e.getFill(),fillColor:e.getFillColor(),outline:e.getOutline(),outlineColor:e.getOutlineColor(),outlineWidth:e.getOutlineWidth(),radius:e.getRadius(),height:e.getHeight()}},CgsCircle.load=function(e,t){var i=new CgsCircle(t);e.addFeature(i)},CgsSector=function(e){null==e.position&&null==e.center?this.position=[116,40,0]:(this.position=e.center||e.position,2==this.position.length&&(this.position[2]=0)),null==e.fillColor?this.fillColor="rgba(255,255,255,0.4)":this.fillColor=e.fillColor,null==e.outlineColor?this.outlineColor="rgba(0,153,255,1.0)":this.outlineColor=e.outlineColor,null==e.outlineWidth?this.outlineWidth=1:this.outlineWidth=e.outlineWidth,null==e.name?this.name="":this.name=e.name,null==e.extrudedHeight?this.extrudedHeight=0:this.extrudedHeight=e.extrudedHeight,null==e.height?this.height=0:this.height=e.height,null==e.outline?this.outline=!0:this.outline=e.outline,null==e.fill?this.fill=!0:this.fill=e.fill,this.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0,this.rotation=void 0===e.rotation?0:e.rotation,this.angle=void 0===e.angle?60:e.angle,this.radius=void 0===e.radius?3e5:e.radius,this.coordinate=ol.proj.transform(this.position,"EPSG:4326","EPSG:102113"),this.radiusOfInnerUints=this.getRadiusOfInnerUints_(this.radius),e.positions=this.createPositions_(),CgsFeature.call(this,e),CgsFeature.call(this,e),1==window.WGMODEFLAG?(this.feature3D=new CgsPolygon3D(e),this.feature2D=new CgsPolygon2D(e)):2==window.WGMODEFLAG?this.feature2D=new CgsPolygon2D(e):3==window.WGMODEFLAG&&(this.feature3D=new CgsPolygon3D(e))},CgsInherits(CgsSector,CgsFeature),CgsSector.prototype.createPositions_=function(){this.coordinates=[[]];for(var e=0;e<=this.angle;e++){var t=this.radiusOfInnerUints*Math.cos(e/180*Math.PI),i=this.radiusOfInnerUints*Math.sin(e/180*Math.PI),s=Math.cos(this.rotation/180*Math.PI)*t-Math.sin(this.rotation/180*Math.PI)*i,o=Math.cos(this.rotation/180*Math.PI)*i+Math.sin(this.rotation/180*Math.PI)*t;s+=this.coordinate[0],o+=this.coordinate[1];var a=ol.proj.transform([s,o],"EPSG:102113","EPSG:4326");this.coordinates[0].push(a)}return this.coordinates[0].push([this.position[0],this.position[1]]),this.coordinates},CgsSector.prototype.getRadiusOfInnerUints_=function(e){var t=CgsUtil.EPSG3857_RADIUS,i=e/t,s=Math.sqrt(2*t*t*(1-Math.cos(i))),o=Math.cos(this.position[1]/180*Math.PI)*t,a=Math.acos((2*o*o-s*s)/(2*o*o)),n=[this.position[0]+a/Math.PI*180,this.position[1]],r=ol.proj.transform(n,"EPSG:4326","EPSG:102113"),l=ol.proj.transform(this.position,"EPSG:4326","EPSG:102113");return r[0]-l[0]},CgsSector.prototype.setPosition=function(e){var t;CgsUtil.verifyLonLat(e)?(this.position=e,this.coordinate=ol.proj.transform(this.position,"EPSG:4326","EPSG:102113"),t=this.createPositions_(),this.feature3D&&this.feature3D.setPosition(t),this.feature2D&&this.feature2D.setPosition(t)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsSector.prototype.getPosition=function(){return this.position},CgsSector.prototype.setRadius=function(e){this.radius=e,this.radiusOfInnerUints=this.getRadiusOfInnerUints_(this.radius);var t=this.createPositions_();this.feature3D&&this.feature3D.setPosition(t),this.feature2D&&this.feature2D.setPosition(t)},CgsSector.prototype.getRadius=function(){return this.radius},CgsSector.prototype.setAngle=function(e){this.angle=e;var t=this.createPositions_();this.feature3D&&this.feature3D.setPosition(t),this.feature2D&&this.feature2D.setPosition(t)},CgsSector.prototype.getAngle=function(){return this.angle},CgsSector.prototype.setRotation=function(e){this.rotation=e;var t=this.createPositions_();this.feature3D&&this.feature3D.setPosition(t),this.feature2D&&this.feature2D.setPosition(t)},CgsSector.prototype.getRotation=function(){return this.rotation},CgsSector.prototype.setFillColor=function(e){this.feature3D&&this.feature3D.setFillColor(e),this.feature2D&&this.feature2D.setFillColor(e)},CgsSector.prototype.getFillColor=function(){return this.feature3D?this.feature3D.getFillColor():this.feature2D?this.feature2D.getFillColor():void 0},CgsSector.prototype.setFill=function(e){this.feature3D&&this.feature3D.setFill(e),this.feature2D&&this.feature2D.setFill(e)},CgsSector.prototype.getFill=function(){return this.feature3D?this.feature3D.getFill():this.feature2D?this.feature2D.getFill():void 0},CgsSector.prototype.setOutlineColor=function(e){this.feature3D&&this.feature3D.setOutlineColor(e),this.feature2D&&this.feature2D.setOutlineColor(e)},CgsSector.prototype.getOutlineColor=function(){return this.feature3D?this.feature3D.getOutlineColor():this.feature2D?this.feature2D.getOutlineColor():void 0},CgsSector.prototype.setOutlineWidth=function(e){this.feature3D&&this.feature3D.setOutlineWidth(e),this.feature2D&&this.feature2D.setOutlineWidth(e)},CgsSector.prototype.getOutlineWidth=function(){return this.feature3D?this.feature3D.getOutlineWidth():this.feature2D?this.feature2D.getOutlineWidth():void 0},CgsSector.prototype.getOutlineDash=function(){if(this.feature2D)return this.feature2D.getOutlineDash()},CgsSector.prototype.setOutlineDash=function(e){this.feature2D&&this.feature2D.setOutlineDash(e)},CgsSector.prototype.setOutline=function(e){this.feature3D&&this.feature3D.setOutline(e),this.feature2D&&this.feature2D.setOutline(e)},CgsSector.prototype.getOutline=function(){return this.feature3D?this.feature3D.getOutline():this.feature2D?this.feature2D.getOutline():void 0},CgsSector.prototype.setExtrudedHeight=function(e){this.feature3D&&this.feature3D.setExtrudedHeight(e)},CgsSector.prototype.getExtrudedHeight=function(){if(this.feature3D)return this.feature3D.getExtrudedHeight()},CgsSector.prototype.setHeight=function(e){this.feature3D&&this.feature3D.setHeight(e)},CgsSector.prototype.getHeight=function(){if(this.feature3D)return this.feature3D.getHeight()},CgsSector.prototype.setVisibleHeight=function(e){this.feature3D&&this.feature3D.setVisibleHeight(e)},CgsSector.prototype.getVisibleHeight=function(){if(this.feature3D)return this.feature3D.getVisibleHeight()},CgsParabola=function(e){CgsLine.call(this,e),1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG||(this.feature3D=new CgsParabola3D(e))},CgsInherits(CgsParabola,CgsLine),CgsParabola.prototype.setFillColor=function(e){this.feature3D&&this.feature3D.setFillColor(e)},CgsParabola.prototype.getFillColor=function(){if(this.feature3D)return this.feature3D.getFillColor()},CgsParabola.prototype.setStart=function(e,t){this.feature3D&&this.feature3D.setStart(e,t)},CgsParabola.prototype.getStart=function(){if(this.feature3D)return this.feature3D.getStart()},CgsParabola.prototype.setEnd=function(e,t){this.feature3D&&this.feature3D.setEnd(e,t)},CgsParabola.prototype.getEnd=function(){if(this.feature3D)return this.feature3D.getEnd()},CgsParabola.prototype.getHeight=function(){if(this.feature3D)return this.feature3D.getHeight()},CgsParabola.prototype.getFact=function(){if(this.feature3D)return this.feature3D.getFact()},CgsParabola.prototype.getRotation=function(){if(this.feature3D)return this.feature3D.getRotation()},CgsParabola.prototype.getWidth=function(){if(this.feature3D)return this.feature3D.getWidth()},CgsParabola.prototype.getType=function(){if(this.feature3D)return this.feature3D.getType()},CgsParabola.prototype.getPositions=function(){if(this.feature3D)return this.feature3D.getPositions()},CgsParabola.prototype.setPositions=function(e){if(CgsUtil.verifyLonLat(e))return this.feature3D?this.feature3D.setPositions(e):void 0;console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsParabola.prototype.getExtrudedHeight=function(){if(this.feature3D)return this.feature3D.getExtrudedHeight()},CgsParabola.prototype.setExtrudedHeight=function(e){this.feature3D&&this.feature3D.setExtrudedHeight(e)},CgsParabola.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("start"==name){var pp;try{pp=eval(value)}catch(e){CgsTipsWindow.showLog("输入格式错误，请重新输入！")}this.setStart(pp,!1)}else if("end"==name){var pp;try{pp=eval(value)}catch(e){CgsTipsWindow.showLog("输入格式错误，请重新输入！")}this.setEnd(pp,!1)}else if("extrudedHeight"==name)this.setExtrudedHeight(parseFloat(value));else if("fillColor"==name)this.setFillColor(value);else if("width"==name)this.setWidth(parseFloat(value));else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsParabola.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"抛物线"},{type:"hline"},{type:"input",label:"起始位置",name:"start",value:"["+e.getStart()+"]"},{type:"input",label:"结束位置",name:"end",value:"["+e.getEnd()+"]"},{type:"inputTypeNum",label:"距地高度",name:"extrudedHeight",value:e.getExtrudedHeight()},{type:"slider",label:"宽度",name:"width",min:1,max:72,defaultValue:e.getWidth(),fixedNumber:2},{type:"hline"},{type:"cesiumColor",label:"颜色",name:"fillColor",data:e.getFillColor()},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsParabola.prototype.save=function(){return{type:this.getType(),name:this.getName(),show:this.getVisible(),positions:this.getPositions(),height:this.getHeight(),fact:this.getFact(),rotation:this.getRotation(),fillColor:this.getFillColor(),width:this.getWidth()}},CgsParabola.load=function(e,t){var i=new CgsParabola(t);e.addFeature(i)},CgsModel=function(e){var t;CgsFeature.call(this,e),this.feature3D=new CgsModel3D(e),e.markUrl&&((t=Object.assign(e)).url=e.markUrl,t.rotation=e.markRotation||0,this.feature2D=new CgsMark2D(t))},CgsInherits(CgsModel,CgsFeature),CgsModel.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.feature3D.setPosition(e),this.feature2D&&this.feature2D.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsModel.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsModel.prototype.setScale=function(e){this.feature3D.setScale(e)},CgsModel.prototype.setMarkScale=function(e){this.feature2D&&this.feature2D.setIconScale(e)},CgsModel.prototype.getScale=function(){return this.feature3D.getScale()},CgsModel.prototype.getMarkScale=function(){if(this.feature2D)return this.feature2D.getIconScale()},CgsModel.prototype.setRotation=function(e){this.feature3D.setRotation(e)},CgsModel.prototype.setMarkRotation=function(e){this.feature2D&&this.feature2D.setRotation(e)},CgsModel.prototype.getRotation=function(){return this.feature3D.getRotation()},CgsModel.prototype.getMarkRotation=function(){if(this.feature2D)return this.feature2D.getRotation()},CgsModel.prototype.setUrl=function(e){this.feature3D.setUrl(e)},CgsModel.prototype.setMarkUrl=function(e){this.feature2D&&this.feature2D.setUrl(e)},CgsModel.prototype.getUrl=function(){return this.feature3D.getUrl()},CgsModel.prototype.getMarkUrl=function(){if(this.feature2D)return this.feature2D.getUrl()},CgsModel.prototype.setPixelSize=function(e){this.feature3D.setPixelSize(e)},CgsModel.prototype.getPixelSize=function(){return this.feature3D.getPixelSize()},CgsModel.prototype.setAutoMaxScale=function(e){this.feature3D.setAutoMaxScale(e)},CgsModel.prototype.getAutoMaxScale=function(){return this.feature3D.getAutoMaxScale()},CgsModel.prototype.setAutoMinScale=function(e){this.feature3D.setAutoMinScale(e)},CgsModel.prototype.getAutoMinScale=function(){return this.feature3D.getAutoMinScale()},CgsModel.prototype.setAutoScale=function(e){this.feature3D.setAutoScale(e)},CgsModel.prototype.getAutoScale=function(){return this.feature3D.getAutoScale()},CgsModel.prototype.setSilhouetteColor=function(e){this.feature3D.setSilhouetteColor(e)},CgsModel.prototype.getSilhouetteColor=function(){return this.feature3D.getSilhouetteColor()},CgsModel.prototype.setSilhouetteSize=function(e){this.feature3D.setSilhouetteSize(e)},CgsModel.prototype.getSilhouetteSize=function(){return this.feature3D.getSilhouetteSize()},CgsModel.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsModel.prototype.getColor=function(){return this.feature3D.getColor()},CgsModel.prototype.setColorBlendAmount=function(e){this.feature3D.setColorBlendAmount(e)},CgsModel.prototype.getColorBlendAmount=function(){return this.feature3D.getColorBlendAmount()},CgsModel.prototype.setVisibleHeight=function(e){this.feature3D.setVisibleHeight(e)},CgsModel.prototype.getVisibleHeight=function(){return this.feature3D.getVisibleHeight()},CgsModel.prototype.setColorBlendMode=function(e){this.feature3D.setColorBlendMode(e)},CgsModel.prototype.getBoundingSphere=function(){return this.feature3D.getBoundingSphere()},CgsModel.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name)this.setPosition(value);else if("scale"==name)this.setScale(value);else if("blend"==name)this.setColorBlendAmount(parseFloat(value));else if("fillColor"==name)this.setColor(value);else if("url"==name)this.setUrl(value);else if("silhouette"==name)this.setSilhouetteColor(value);else if("silhouetteSize"==name)this.setSilhouetteSize(parseFloat(value));else if("minPixel"==name)this.setPixelSize(parseFloat(value));else if("maxScale"==name)this.setAutoMaxScale(parseFloat(value));else if("heading"==name){var pp=this.getRotation();pp[0]=parseFloat(value),this.setRotation(pp)}else if("pitch"==name){var pp=this.getRotation();pp[1]=parseFloat(value),this.setRotation(pp)}else if("roll"==name){var pp=this.getRotation();pp[2]=parseFloat(value),this.setRotation(pp)}else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsModel.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"模型"},{type:"hline"},{type:"cesiumPosition",label:"位置",name:"position",minusLngLatStepLen:1,plusLngLatStepLen:2,minusHeightStepLen:2e3,plusHeightStepLen:3e3,data:e.getPosition()},{type:"hline"},{type:"cesiumOrientation",data:e.getRotation()},{type:"hline"},{type:"inputTypeNum",label:"缩放",name:"scale",value:e.getScale()},{type:"inputTypeNum",label:"最小自动缩放量",name:"minPixel",value:e.getPixelSize()},{type:"inputTypeNum",label:"最大自动缩放量",name:"maxScale",value:e.getAutoMaxScale()},{type:"hline"},{type:"slider",label:"融合度",name:"blend",min:0,max:1,fixedNumber:2,defaultValue:e.getColorBlendAmount()},{type:"cesiumColor",label:"填充颜色",name:"fillColor",data:e.getColor()},{type:"hline"},{type:"inputTypeNum",label:"轮廓线宽度(像素)",name:"silhouetteSize",value:e.getSilhouetteSize()},{type:"cesiumColor",label:"轮廓颜色",name:"silhouette",data:e.getSilhouetteColor()},{type:"hline"},{type:"input",label:"资源路径",name:"url",value:e.getUrl()},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsModel.prototype.save=function(){var e=this;return{type:e.getType(),name:e.getName(),position:e.getPosition(),scale:e.getScale(),rotation:e.getRotation(),color:e.getColor(),colorBlendAmount:e.getColorBlendAmount(),silhouetteColor:e.getSilhouetteColor(),silhouetteSize:e.getSilhouetteSize(),minimumPixelSize:e.getPixelSize(),maxmumScale:e.getAutoMaxScale(),visibleHeight:e.getVisibleHeight(),url:e.getUrl()}},CgsModel.load=function(e,t){var i=new CgsModel(t);e.addFeature(i),i.setVisibleHeight(t.visibleHeight)},CgsModel.HIGHLIGHT=0,CgsModel.REPLACE=1,CgsModel.MIX=2,CgsDrawFeatureByMouse=function(e){e.type=e.type?e.type.toUpperCase():"LINE",this.type=e.type,this.options=e,this.isActive=!1;var t=new CgsStyleStroke2D({color:void 0===e.fill?"rgba(0,153,255,1.0)":e.fill,width:void 0===e.width?1:e.width,lineDash:[e.dash]}),i=new CgsStyleStroke2D({color:void 0===e.fill?"rgba(255,255,255,0.4)":e.fill}),s=this;e.once&&(this.onceEvent=CgsSubPub.subscribe("drawend",function(){setTimeout(function(){s.deactivate()})}));var o=null;switch(this.type){case"POINT":o={image:new CgsStylePoint2D({fill:i,stroke:t,radius:e.pixelSize}),stroke:null,fill:null,text:null};break;case"LINE":o={image:null,stroke:t,fill:null,text:null};break;case"POLYGON":case"RECT":case"CIRCLE":o={image:null,stroke:t,fill:i,text:null};break;case"MARK":var a={src:void 0===e.url?"":e.url,anchor:void 0===e.pixelOffset?[0,0]:e.pixelOffset,opacity:void 0===e.iconOpacity?.5:e.iconOpacity,rotation:void 0===e.rotation?0:e.rotation,scale:void 0===e.scale?1:e.scale};o={image:new CgsStyleIcon2D(a),stroke:null,fill:null,text:null};break;default:return void console.info("the type of drawfeaturebymouse is not surpported")}e.style=new CgsStyle2D(o),this.options.mapObject.threeFlag&&(this.drawfeaturebymouse3D=new CgsDrawFeatureByMouse3D(e)),this.options.mapObject.isCesium2D||(this.drawfeaturebymouse2D=new CgsDrawFeatureByMouse2D(e))},CgsDrawFeatureByMouse.prototype.activate=function(){this.isActive=!0,"2D"!=this.options.mapObject.mode||this.options.mapObject.isCesium2D?this.drawfeaturebymouse3D.activate():(this.options.mapObject.featureSelect.deactivate(),this.drawfeaturebymouse2D.activate());var m=this;this.changeModeId=CgsSubPub.subscribe("modechanged",function(e,t){"3D"!=t||m.options.mapObject.isCesium2D?m.drawfeaturebymouse3D.deactivate():m.drawfeaturebymouse2D.deactivate()}),this.subscribeId2D=CgsSubPub.subscribe("featuredrawend2d",function(e,t,i){for(var s=t.getGeometry(),o=s.flatCoordinates,a=[],n=0;n<o.length;n+=2){var r=[];r[0]=o[n],r[1]=o[n+1],r=ol.proj.transform(r,m.options.mapObject.map2D.projection,"EPSG:4326"),a.push(r)}var l,u=null;switch(m.type){case"POINT":m.options.position=a[0],u=new CgsPoint(m.options);break;case"LINE":m.options.positions=a,u=new CgsLine(m.options);break;case"POLYGON":m.options.positions=[a],u=new CgsPolygon(m.options);break;case"RECT":var p=Math.min(a[0][0],a[2][0]),h=Math.max(a[0][0],a[2][0]),c=Math.min(a[0][1],a[2][1]),g=Math.max(a[0][1],a[2][1]);m.options.positions=[[p,c],[h,g]],u=new CgsRect(m.options),m.options.positions=[a];break;case"CIRCLE":var d=s.getCenter();m.options.center=ol.proj.transform(d,m.options.mapObject.map2D.projection,"EPSG:4326"),m.options.radius=s.getRadius(),u=new CgsCircle(m.options);break;case"MARK":m.options.position=a[0],u=new CgsMark(m.options)}m.options.mapObject.addFeature(u),m.options.mapObject.featuresDrawedByMouse.push(u),m.options.drawEndCallback&&(l=m.options.position?m.options.position:m.options.positions,m.options.drawEndCallback(l,u)),CgsSubPub.publish("drawend",[a,m.type]),CgsSubPub.publish("featuredrawnbymouse",[u,m,m.options.mapObject])}),this.subscribeId3D=CgsSubPub.subscribe("featureDrawnByMouse",function(e,t,i){var s,o,a=t.getPosition(),n=null;switch(m.type){case"POINT":m.options.position=a,n=new CgsPoint(m.options);break;case"LINE":m.options.positions=a,n=new CgsLine(m.options);break;case"POLYGON":"[object Array]"==Object.prototype.toString.call(a[0])&&(s=a[0],"[object Array]"!=Object.prototype.toString.call(s[0])&&(m.options.positions=[a])),n=new CgsPolygon(m.options);break;case"RECT":m.options.positions=a,n=new CgsRect(m.options);for(var r=t.labelList,l=0;l<r.length;l++)m.options.mapObject.map3D.removeFeature(r[l]);break;case"CIRCLE":var u=t.getRadius();m.options.radius=u,n=new CgsCircle(m.options);for(r=t.labelList,l=0;l<r.length;l++)m.options.mapObject.map3D.removeFeature(r[l]);break;case"MARK":m.options.position=a,n=new CgsMark(m.options)}m.options.mapObject.map3D.removeFeature(t),m.options.mapObject.addFeature(n),m.options.mapObject.featuresDrawedByMouse.push(n),m.options.drawEndCallback&&(o=m.options.position?m.options.position:m.options.positions,m.options.drawEndCallback(o,n)),CgsSubPub.publish("drawend",[a,m.type]),CgsSubPub.publish("featuredrawnbymouse",[n,m,m.options.mapObject])})},CgsDrawFeatureByMouse.prototype.deactivate=function(){this.isActive=!1,"2D"!=this.options.mapObject.mode||this.options.mapObject.isCesium2D?this.drawfeaturebymouse3D.deactivate():(this.options.mapObject.featureSelect.activate(),this.drawfeaturebymouse2D.deactivate()),this.subscribeId3D&&CgsSubPub.unsubscribe(this.subscribeId3D),this.changeModeId&&CgsSubPub.unsubscribe(this.changeModeId),this.subscribeId2D&&CgsSubPub.unsubscribe(this.subscribeId2D),this.onceEvent&&CgsSubPub.unsubscribe(this.onceEvent)},CgsDrawFeatureByMouse.prototype.getActive=function(){return this.isActive},CgsDrawFeatureByMouse.exportAsJson=function(e){var t=[];if(e.featuresDrawedByMouse&&0<e.featuresDrawedByMouse.length){for(var i=0;i<e.featuresDrawedByMouse.length;i++){var s=e.featuresDrawedByMouse[i],o={position:CgsDrawFeatureByMouse.arrToString(s.getPosition()),name:s.getName(),appendExplain:s.appendExplain,Radius:s.getRadius?s.getRadius():void 0,pixelSize:s.getPixelSize?s.getPixelSize():void 0,fillColor:s.getFillColor?s.getFillColor():void 0,outlineColor:s.getOutlineColor?s.getOutlineColor():void 0,outlineWidth:s.getOutlineWidth?s.getOutlineWidth():void 0,type:s.getType()};t.push(o)}var a={features:t};return JSON.stringify(a)}},CgsDrawFeatureByMouse.importJsonFile=function(e,t){for(var i,s,o=JSON.parse(e).features,a=0;a<o.length;a++){"CgsPoint"==o[a].type?(i={name:o[a].name,position:CgsDrawFeatureByMouse.stringToArr(o[a].position),fillColor:o[a].fillColor?o[a].fillColor:"rgba(71,199,207,0.2)",pixelSize:o[a].pixelSize?o[a].pixelSize:5,outlineColor:o[a].outlineColor?o[a].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[a].outlineWidth?o[a].outlineWidth:2},s=new CgsPoint(i),t.addFeature(s),s.setFont("24px 微软雅黑"),s.setLabelFillColor("rgba(255,255,255,1.0)")):"CgsLabel"==o[a].type?(i={position:CgsDrawFeatureByMouse.stringToArr(o[a].position),fillColor:o[a].fillColor?o[a].fillColor:"rgba(71,199,207,0.2)",outlineColor:o[a].outlineColor?o[a].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[a].outlineWidth?o[a].outlineWidth:0},s=new CgsLabel(i),t.addFeature(s)):"CgsLine"==o[a].type?(i={name:o[a].name,positions:CgsDrawFeatureByMouse.stringToArr(o[a].position),followSurface:!1,fillColor:o[a].fillColor?o[a].fillColor:"rgba(71,199,207,0.2)",outlineColor:o[a].outlineColor?o[a].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[a].outlineWidth?o[a].outlineWidth:0},s=new CgsLine(i),t.addFeature(s)):"CgsPolygon"==o[a].type?(i={name:o[a].name,positions:CgsDrawFeatureByMouse.stringToArr(o[a].position),fillColor:o[a].fillColor?o[a].fillColor:"rgba(71,199,207,0.2)",outlineColor:o[a].outlineColor?o[a].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[a].outlineWidth?o[a].outlineWidth:0},s=new CgsPolygon(i),t.addFeature(s)):"CgsRect"==o[a].type?(i={name:o[a].name,positions:CgsDrawFeatureByMouse.stringToArr(o[a].position),fillColor:o[a].fillColor?o[a].fillColor:"rgba(71,199,207,0.2)",outlineColor:o[a].outlineColor?o[a].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[a].outlineWidth?o[a].outlineWidth:0},s=new CgsRect(i),t.addFeature(s)):"CgsCircle"==o[a].type&&(i={position:CgsDrawFeatureByMouse.stringToArr(o[a].position),name:o[a].name,radius:parseFloat(o[a].Radius),fillColor:o[a].fillColor?o[a].fillColor:"rgba(71,199,207,0.2)",outlineColor:o[a].outlineColor?o[a].outlineColor:"rgba(71,203,212,1)",outlineWidth:o[a].outlineWidth?o[a].outlineWidth:0},s=new CgsCircle(i),t.addFeature(s)),s instanceof CgsLabel||s.setLabelFillColor("rgba(255,255,255,1.0)"),o[a]&&o[a].appendExplain&&(s.appendExplain=o[a].appendExplain),s.setLabelDraggable(!0),s.showLine(!0),s.setPickColorFlag(!1),t.featuresDrawedByMouse.push(s)}},CgsDrawFeatureByMouse.arrToString=function(e){var t="";if(e[0]instanceof Array){e[0][0]instanceof Array&&(e=e[0]);for(var i=0;i<e.length;i++)t=i==e.length-1?t+e[i][0]+","+e[i][1]:t+e[i][0]+","+e[i][1]+","}else if(2==e.length)t=e[0]+","+e[1];else for(i=0;i<e.length;i++)i==e.length-1?t+=e[i]:t=t+e[i]+",";return t},CgsDrawFeatureByMouse.stringToArr=function(e){var t=e.split(","),i=[];if(2==t.length)i=[parseFloat(t[0]),parseFloat(t[1])];else if(3!=t.length||t[0]instanceof Array)for(var s=0;s<t.length;s+=2)i.push([parseFloat(t[s]),parseFloat(t[s+1])]);else i=[parseFloat(t[0]),parseFloat(t[1])];return i},CgsDrawFeatureByMouse.SHAPE_POINT="POINT",CgsDrawFeatureByMouse.SHAPE_CIRCLE="CIRCLE",CgsDrawFeatureByMouse.SHAPE_LINE="LINE",CgsDrawFeatureByMouse.SHAPE_RECTANGLE="RECT",CgsDrawFeatureByMouse.SHAPE_POLYGON="POLYGON",CgsDrawFeatureByMouse.SHAPE_MARK="MARK",CgsDashLine=function(e){e.pixelSize=e.pixelSize||e.dashLength||16;for(var t,i=0;i<e.positions;i++);CgsFeature.call(this,e),e.evenColor||(e.fillColor?e.evenColor=e.fillColor:e.evenColor="rgba(0,153,255,0.8)"),e.fillColor=e.evenColor,e.oddColor||(e.oddColor="rgba(0,0,0,0)"),1==window.WGMODEFLAG?(this.feature3D=new CgsDashLine3D(e),(t=_.cloneDeep(e)).fillColor=t.oddColor,t.pixelSize=null,t.name="",FEATURE_NUM++,this.feature2DHelper=new CgsLine2D(t),this.feature2D=new CgsLine2D(e)):2==window.WGMODEFLAG?((t=_.cloneDeep(e)).fillColor=t.oddColor,t.pixelSize=null,t.name="",FEATURE_NUM++,this.feature2DHelper=new CgsLine2D(t),this.feature2D=new CgsLine2D(e)):3==window.WGMODEFLAG&&(this.feature3D=new CgsDashLine3D(e))},CgsInherits(CgsDashLine,CgsLine),CgsDashLine.prototype.setFillColor=function(e){var t;this.feature2D&&(t=ol.color.asString(e),this.feature2D.setFillColor(t)),this.feature3D&&this.feature3D.setFillColor(e)},CgsDashLine.prototype.getFillColor=function(){return this.feature2D?this.feature2D.getFillColor():this.feature3D?this.feature3D.getFillColor():void 0},CgsDashLine.prototype.setWidth=function(e){this.feature2D&&(this.feature2D.setWidth(e),this.feature2DHelper.setWidth(e)),this.feature3D&&this.feature3D.setWidth(e)},CgsDashLine.prototype.getWidth=function(){return this.feature2D?this.feature2D.getWidth():this.feature3D?this.feature3D.getWidth():void 0},CgsDashLine.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.feature2D&&(this.feature2D.setPosition(e),this.feature2DHelper.setPosition(e)),this.feature3D&&this.feature3D.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsDashLine.prototype.getOddColor=function(){if(this.feature3D)return this.feature3D.getOddColor()},CgsDashLine.prototype.setOddColor=function(e){var t;this.feature2D&&(t=ol.color.asString(e),this.feature2DHelper.setFillColor(t)),this.feature3D&&this.feature3D.setOddColor(e)},CgsDashLine.prototype.getEvenColor=function(){return this.getFillColor()},CgsDashLine.prototype.setEvenColor=function(e){this.setFillColor(e)},CgsDashLine.prototype.getPixelSize=function(){if(this.feature3D)return this.feature3D.getDashLength()},CgsDashLine.prototype.setPixelSize=function(e){this.feature2D&&this.feature2D.setDashLine(e),this.feature3D&&this.feature3D.setDashLength(e)},CgsLabel=function(e){if(CgsFeature.call(this,e),e.feature2D&&e.feature3D)return this.feature2D=e.feature2D,void(this.feature3D=e.feature3D);1==window.WGMODEFLAG?(this.feature3D=new CgsLabel3D(e),this.feature2D=new CgsLabel2D(e)):2==window.WGMODEFLAG?this.feature2D=new CgsLabel2D(e):3==window.WGMODEFLAG&&(this.feature3D=new CgsLabel3D(e))},CgsInherits(CgsLabel,CgsFeature),CgsLabel.prototype.setPosition=function(e){this.feature3D&&this.feature3D.setPosition(e),this.feature2D&&this.feature2D.setPosition(e)},CgsLabel.prototype.getPosition=function(){return this.feature3D?this.feature3D.getPosition():this.feature2D?this.feature2D.getPosition():void 0},CgsLabel.prototype.setFont=function(e){this.feature3D&&this.feature3D.setFont(e),this.feature2D&&this.feature2D.setFont(e)},CgsLabel.prototype.getFont=function(){return this.feature3D?this.feature3D.getFont():this.feature2D?this.feature2D.getFont():void 0},CgsLabel.prototype.setFillColor=function(e){this.feature3D&&this.feature3D.setFillColor(e),this.feature2D&&this.feature2D.setLabelFillColor(e)},CgsLabel.prototype.getFillColor=function(){if(this.feature3D)return this.feature3D.getFillColor()},CgsLabel.prototype.setText=function(e){this.feature3D&&this.feature3D.setText(e),this.feature2D&&this.feature2D.setName(e)},CgsLabel.prototype.getText=function(){return this.feature3D?this.feature3D.getText():this.feature2D?this.feature2D.getName():void 0},CgsLabel.prototype.setName=function(e){this.feature3D&&this.feature3D.setText(e),this.feature2D&&this.feature2D.setName(e)},CgsLabel.prototype.getName=function(){return this.feature3D?this.feature3D.getText():this.feature2D?this.feature2D.getName():void 0},CgsLabel.prototype.setPixelOffset=function(e){this.feature3D&&this.feature3D.setPixelOffset(e),this.feature2D&&this.feature2D.setLabelOffset(e)},CgsLabel.prototype.getPixelOffset=function(){if(this.feature3D)return this.feature3D.getPixelOffset()},CgsLabel.prototype.setOutlineColor=function(e){this.feature3D&&this.feature3D.setOutlineColor(e),this.feature2D&&this.feature2D.setLabelOutlineColor(e)},CgsLabel.prototype.getOutlineColor=function(){if(this.feature3D)return this.feature3D.getOutlineColor()},CgsLabel.prototype.setOutlineWidth=function(e){this.feature3D&&this.feature3D.setOutlineWidth(e),this.feature2D&&this.feature2D.setLabelOutlineWidth(e)},CgsLabel.prototype.getOutlineWidth=function(){if(this.feature3D)return this.feature3D.getOutlineWidth()},CgsLabel.prototype.getBackgroundColor=function(){return this.feature3D?this.feature3D.getLabelBackgroundColor():this.feature2D?this.feature2D.getLabelBackgroundColor():void 0},CgsLabel.prototype.setBackgroundColor=function(e){this.feature3D&&this.feature3D.setLabelBackgroundColor(e),this.feature2D&&this.feature2D.setLabelBackgroundColor(e)},CgsLabel.prototype.getShowBackground=function(){return this.feature3D?this.feature3D.getShowLabelBackground():this.feature2D?this.feature2D.getShowLabelBackground():void 0},CgsLabel.prototype.setShowBackground=function(e){this.feature3D&&this.feature3D.setShowLabelBackground(e),this.feature2D&&this.feature2D.setShowLabelBackground(e)},CgsLabel.prototype.getBackgroundPadding=function(){return this.feature3D?this.feature3D.getLabelBackgroundPadding():this.feature2D?this.feature2D.getLabelBackgroundPadding():void 0},CgsLabel.prototype.setBackgroundPadding=function(e){this.feature3D&&this.feature3D.setLabelBackgroundPadding(e),this.feature2D&&this.feature2D.setLabelBackgroundPadding(e)},CgsLabel.prototype.setVisible=function(e){this.feature3D&&this.feature3D.setVisible(e),this.feature2D&&this.feature2D.setVisible(e)},CgsLabel.prototype.getVisible=function(){return this.feature3D?this.feature3D.getVisible():this.feature2D?this.feature2D.getVisible():void 0},CgsLabel.prototype.setVisibleHeight=function(e){this.feature3D&&this.feature3D.setVisibleHeight(e)},CgsLabel.prototype.getVisibleHeight=function(){if(this.feature3D)return this.feature3D.getVisibleHeight()},CgsLabel.prototype.setProperty=function(name,value){if("name"==name)this.setText(value);else if("show"==name)this.setVisible(value);else if("position"==name)this.setPosition(value);else if("font"==name)this.setFont(this.getFont().split(" ")[0]+" "+value);else if("fontSize"==name)this.setFont(parseFloat(value)+"px "+this.getFont().split(" ")[1]);else if("offsetX"==name){var pp=this.getPixelOffset();pp[0]=parseFloat(value),this.setPixelOffset(pp)}else if("offsetY"==name){var pp=this.getPixelOffset();pp[1]=parseFloat(value),this.setPixelOffset(pp)}else if("fillColor"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("outlineWidth"==name)this.setOutlineWidth(value);else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void console.log("输入格式错误！")}this.setVisibleHeight(pp)}},CgsLabel.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getText()},{type:"checkbox",label:"显示",name:"show",value:e.getVisibled()},{type:"title",label:"标签"},{type:"hline"},{type:"cesiumPosition",label:"位置",name:"position",minusLngLatStepLen:1,plusLngLatStepLen:2,minusHeightStepLen:2e3,plusHeightStepLen:3e3,data:e.getPosition()},{type:"hline"},{type:"dropdown",label:"字体",name:"font",defaultValue:e.getFont().split(" ")[1],data:[{value:0,label:"微软雅黑"},{value:1,label:"宋体"},{value:2,label:"黑体"},{value:3,label:"斜体"},{value:3,label:"仿宋"}]},{type:"slider",label:"字体大小",name:"fontSize",min:1,max:72,defaultValue:e.getFont().split(" ")[0].replace("px",""),fixedNumber:0},{type:"inputTypeNum",label:"偏移量x",name:"offsetX",value:e.getPixelOffset()[0]},{type:"inputTypeNum",label:"偏移量y",name:"offsetY",value:e.getPixelOffset()[1]},{type:"hline"},{type:"cesiumColor",label:"颜色",name:"fillColor",data:e.getFillColor()},{type:"hline"},{type:"inputTypeNum",label:"轮廓线宽",name:"outlineWidth",value:e.getOutlineWidth()},{type:"hline"},{type:"cesiumColor",label:"轮廓颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsLabel.prototype.save=function(){return{type:this.getType(),name:this.getText(),position:this.getPosition(),fillColor:this.getFillColor(),font:this.getFont(),pixelOffset:this.getPixelOffset(),visibleHeight:this.getVisibleHeight()}},CgsLabel.load=function(e,t){var i=new CgsLabel(t);e.addFeature(i),i.setVisibleHeight(t.visibleHeight)},CgsKml=function(e){this.options=e,CgsDataSource.call(this,e),e.parent=this,e.mapObject.map3D&&(this.kml3D=new CgsKml3D(e)),e.mapObject.map2D&&(this.kml2D=new CgsKml2D(e))},CgsInherits(CgsKml,CgsDataSource),CgsKml.prototype.loadedOperation=function(){this.kml2D.isLoaded&&this.kml3D.isLoaded&&(this.options.loadCompleted&&this.options.loadCompleted(this),CgsSubPub.publish("kmlloaded",[this]))},CgsKml.prototype.setColor=function(e,t){if(!t)throw new Error("颜色参数不不能为空");var i,s=t.fillColor,o=t.strokeColor,a=t.strokeWidth,n={};(o||a)&&(i={},o&&(i.color=o),a&&(i.width=a||1),n.stroke=new ol.style.Stroke(i)),s&&(n.fill=new ol.style.Fill({color:s}));for(var r=this.kml3D.entities.values,l=this.kml2D.featureArr,u=0,p=r.length;u<p;u++)e==r[u].name&&r[u].polygon&&(s&&(r[u].polygon.material=new Cesium.Color.fromCssColorString(s)),o&&(r[u].polygon.outlineColor=new Cesium.Color.fromCssColorString(o)));for(u=0,p=l.length;u<p;u++)l[u].values_.name==e&&l[u].setStyle(new ol.style.Style(n))},CgsKml.prototype.setVisible=function(e){this.kml2D&&this.kml2D.setVisible(e),this.kml3D&&this.kml3D.setVisible(e)},CgsKml.prototype.remove=function(){this.options.mapObject.removeDataSource(this),CgsSubPub.publish("kmlremove",[this,this.options.mapObject])},CgsKml.prototype.getType=function(){if(this.kml3D)return this.kml3D.getType()},CgsKml.prototype.getUrl=function(){if(this.kml3D)return this.kml3D.getUrl()},CgsKml.prototype.getName=function(){if(this.kml3D)return this.kml3D.getName()},CgsKml.prototype.setName=function(e){this.kml3D&&this.kml3D.setName(e)},CgsKml.prototype.getPId=function(){if(this.kml3D)return this.kml3D.getPId()},CgsKml.prototype.setPId=function(e){this.kml3D&&this.kml3D.setPId(e)},CgsKml.prototype.getVisible=function(){if(this.kml3D)return this.kml3D.getVisible()},CgsKml.prototype.fileLoad=function(e){this.kml3D&&this.kml3D.fileLoad(e)},CgsKml.prototype.save=function(){return{type:this.getType(),url:this.getUrl(),name:this.getName(),pId:this.getPId(),visible:this.getVisible()}},CgsKml.load=function(e,t){t.mapObject=e;var i=new CgsKml(t);e.addDataSource(i)},CgsKml.prototype.getSaveFlag=function(){if(this.kml3D)return this.kml3D.getSaveFlag()},CgsKml.prototype.setSaveFlag=function(e){this.kml3D&&this.kml3D.setSaveFlag(e)},CgsKml.prototype.setPickEnable=function(e){this.kml3D&&this.kml3D.setPickEnable(e)},CgsKml.prototype.getPickEnable=function(){return!!this.kml3D&&this.kml3D.getPickEnable()},CgsKml.prototype.openManipulateMode=function(e){e=e||{},this.kml3D&&this.kml3D.openManipulateMode(e),this.kml2D&&this.kml2D.openManipulateMode(e)},CgsKml.prototype.closeManipulateMode=function(){this.kml3D&&this.kml3D.closeManipulateMode(),this.kml2D&&this.kml2D.closeManipulateMode()},CgsKml.prototype.openEdit=function(){var e,t,i=this;this.kml3D&&!this.kml3D.result?("string"==typeof this.options.url&&this.options.url.startsWith("base")&&(this.options.url=new Blob([this.options.url])),(this.options.url instanceof Blob||this.options.url instanceof File)&&((e=new FileReader).onload=(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i.kml3D.result=t.target.result,i.kml3D.openEdit_();case 2:case"end":return e.stop()}},e,i)})),function(e){return t.apply(this,arguments)}),e.readAsText(this.options.url))):this.kml3D.openEdit_()},CgsKml.prototype.closeEdit=function(){this.kml3D&&this.kml3D.closeEdit_()},CgsKml.prototype.exportKmlByString=function(){if(this.kml3D)return this.kml3D.exportEditResult_()},CgsKml.prototype.updateKml=function(){if(this.kml3D)return this.kml3D.updateKml()},CgsGeoJSON=function(e){this.fillColor=e.fillColor,this.strokeColor=e.strokeColor,this.strokeWidth=e.strokeWidth,this.markUrl=e.markUrl,this.markScale=e.markScale,this.name=e.name,this.visible=!0,ol.format.GeoJSON.call(this,e),CgsDataSource.call(this,e),this.json2DVectorLayer=new CgsGroupVector2D({name:e.name}),this.json3DVectorLayer=new CgsFeatureGroup3D({name:e.name});function t(e){i.features=i.readFeatures(e);for(var t=0;t<i.features.length;t++)i.features[t].groupName=i.name,i.json2DVectorLayer.addFeature(i.features[t].feature2D),i.json3DVectorLayer.addFeature(i.features[t].feature3D)}var i=this;"object"===_typeof(e.url)?t(e.url):$$.ajax({dataType:"json",async:!1,url:e.url,success:function(e){t(e)},error:function(e,t,i){console.error("mapconfig read error:"+t+"\n"+i)}})},CgsInherits(CgsGeoJSON,CgsDataSource),CgsExtend(CgsGeoJSON,ol.format.GeoJSON),CgsGeoJSON.prototype.getName=function(){return this.name},CgsGeoJSON.prototype.setVisible=function(e){this.visible=e,this.json2DVectorLayer&&this.json2DVectorLayer.setVisible(e),this.json3DVectorLayer&&this.json3DVectorLayer.setVisible(e)},CgsGeoJSON.prototype.getVisible=function(){return this.visible},CgsGeoJSON.prototype.setPickEnable=function(e){this.json3DVectorLayer&&this.json3DVectorLayer.setPickEnable(e)},CgsGeoJSON.prototype.getPickEnable=function(){return!!this.json3DVectorLayer&&this.json3DVectorLayer.getPickEnable()},CgsGeoJSON.prototype.readFeatureFromObject=function(e,t){var i=e;goog.DEBUG&&console.assert("Feature"==i.type,"geoJSONFeature.type should be Feature");for(var s=CgsGeoJSON.readGeometry_(i.geometry,t),o=null,a=s.getType(),n={},r=s.flatCoordinates,l=[],u=0;u<r.length;u+=2){var p=[];p[0]=r[u],p[1]=r[u+1],l.push(p)}switch(a){case"Point":n.position=l[0],o=null==this.markUrl?(n.fillColor=this.fillColor,n.outlineWidth=this.strokeWidth,n.outlineColor=this.strokeColor,new CgsPoint(n)):(n.url=this.markUrl,n.scale=this.markScale,new CgsMark(n));break;case"LineString":case"MultiLineString":n.positions=l,n.fillColor=this.strokeColor,n.width=this.strokeWidth,o=new CgsLine(n);break;case"Polygon":case"MultiPolygon":n.positions=[l],n.fillColor=this.fillColor,n.outlineWidth=this.strokeWidth,n.outlineColor=this.strokeColor,o=new CgsPolygon(n);break;case"Circle":n.center=[r[0],r[1]],n.fillColor=this.fillColor,n.outlineWidth=this.strokeWidth,n.outlineColor=this.strokeColor;var h=[r[2],r[3]],c=new ol.Sphere(CgsUtil.EPSG3857_RADIUS);n.radius=c.haversineDistance(n.center,h),o=new CgsCircle(n);break;case"MARK":n.position=l[0],o=new CgsMark(n)}return i.properties&&o.setProperties(i.properties),void 0!==i.id&&o.feature2D.setId(i.id),o},CgsGeoJSON.prototype.readFeaturesFromObject=function(e,t){var i=getObject_(e),s=null;if("Feature"==i.type)s=[this.readFeatureFromObject(i,t)];else if("FeatureCollection"==i.type)for(var s=[],o=i.features,a=0,n=o.length;a<n;++a)s.push(this.readFeatureFromObject(o[a],t));else ol.asserts.assert(!1,35);return s},CgsGeoJSON.prototype.readStyleFromObject=function(e){if(null==e)return null;var t=e.fill,i=t?this.readFillObject(t):null,s=e.text,o=s?this.readTextObject(s):null,a=e.image,n=a?this.readImageObject(a):null,r=e.stroke,l=r?this.readStrokeObject(r):null;return new CgsStyle2D({image:n,stroke:l,fill:i,text:o})},CgsGeoJSON.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);var i={type:"Feature"},s=e.getId();void 0!==s&&(i.id=s);var o=e.getGeometry();i.geometry=o?CgsGeoJSON.writeGeometry_(o,t):null;var a=e.getProperties(),n=e.style_;i.style=n?this.writeStyleObject(n):null;var r=e.groupName;return group?i.groupName=r:i.groupName=null,delete a[e.getGeometryName()],ol.obj.isEmpty(a)?i.properties=null:i.properties=a,i},CgsGeoJSON.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);for(var i=[],s=0,o=e.length;s<o;++s)i.push(this.writeFeatureObject(e[s],t));return JSON.stringify({type:"FeatureCollection",features:i})},CgsGeoJSON.prototype.writeStyleObject=function(e){if(null==e)return null;var t={type:"style"};"function"==typeof e&&(e=e()[0]);var i=e.fill_;t.fill=i?this.writeFillObject(i):null;var s=e.text_;t.text=s?this.writeTextObject(s):null;var o=e.image_;t.image=o?this.writeImageObject(o):null;var a=e.stroke_;return t.stroke=a?this.writeStrokeObject(a):null,t},CgsGeoJSON.prototype.writeFillObject=function(e){var t={type:"style"},i=e.color_;return i?t.color=i:t.fill=null,t},CgsGeoJSON.prototype.writeTextObject=function(e){var t={type:"style"},i=e.font_;t.font=i||null;var s=e.text_;t.text=s||null;var o=e.rotation_;t.rotation=o?180*o/Math.PI:null;var a=e.fill_;t.fill=a?this.writeFillObject(a):null;var n=e.stroke_;t.stroke=n?this.writeStrokeObject(n):null;var r=e.offsetX_;t.offsetX=r||null;var l=e.offsetY_;return t.offsetY=l||null,t},CgsGeoJSON.prototype.writeStrokeObject=function(e){var t={type:"style"},i=e.color_;t.color=i||null;var s=e.width_;t.width=s||null;var o=e.lineDash_;return t.lineDash=o||null,t},CgsGeoJSON.prototype.writeImageObject=function(e){var t,i,s,o,a,n,r,l,u=null;return e instanceof CgsStylePoint2D||e instanceof ol.style.Circle?(u={type:"point"},t=e.radius_,u.radius=t||null,i=e.stroke_,u.stroke=i?this.writeStrokeObject(i):null,s=e.fill_,u.fill=s?this.writeStrokeObject(s):null):(e instanceof CgsStyleIcon2D||e instanceof ol.style.Icon)&&(u={type:"icon"},o=e.anchor_,u.anchor=o||null,a=e.opacity_,u.opacity=a||null,n=e.rotation_,u.rotation=n?180*n/Math.PI:null,r=e.scale_,u.scale=r||null,l=e.iconImage_.src_,u.src=l||null),u},CgsGeoJSON.prototype.readFillObject=function(e){var t=e.color;return new CgsStyleFill({color:t})},CgsGeoJSON.prototype.readTextObject=function(e){var t=e.font,i=e.text,s=e.rotation,o=e.fill?this.readFillObject(e.fill):null,a=e.stroke?this.readStrokeObject(e.stroke):null,n=e.offsetX,r=e.offsetY;return new CgsStyleText({text:i,font:t,rotation:s,fill:o,stroke:a,offset:[n,r]})},CgsGeoJSON.prototype.readStrokeObject=function(e){var t=e.color,i=e.width,s=e.lineDash;return new CgsStyleStroke({color:t,width:i,lineDash:s})},CgsGeoJSON.prototype.readImageObject=function(e){var t,i,s=null;return"point"==e.type?(t=e.stroke?this.readStrokeObject(e.stroke):null,i={fill:e.fill?this.readStrokeObject(e.fill):null,radius:e.radius,stroke:t},s=new CgsStylePoint(i)):"icon"==e.type&&(i={src:e.src,anchor:e.anchor,opacity:e.opacity,rotation:e.rotation,scale:e.scale},s=new CgsStyleIcon(i)),s},CgsGeoJSON.readGeometry_=function(e,t){if(!e)return null;var i=CgsGeoJSON.GEOMETRY_READERS_[e.type];return ol.format.Feature.transformWithOptions(i(e),!1,t)},CgsGeoJSON.readCircleGeometry_=function(e){goog.DEBUG&&console.assert("Circle"==e.type,"object.type should be Circle");var t=[e.coordinates[0],e.coordinates[1]],i=e.coordinates[2]-e.coordinates[0];return new ol.geom.Circle(t,i)},CgsGeoJSON.writeGeometry_=function(e,t){return(0,CgsGeoJSON.GEOMETRY_WRITERS_[e.getType()])(ol.format.Feature.transformWithOptions(e,!0,t),t)},CgsGeoJSON.writeCircleGeometry_=function(e,t){return{type:"Circle",coordinates:e.getFlatCoordinates()}},CgsGeoJSON.GEOMETRY_READERS_={Point:ol.format.GeoJSON.readPointGeometry_,LineString:ol.format.GeoJSON.readLineStringGeometry_,Polygon:ol.format.GeoJSON.readPolygonGeometry_,MultiPoint:ol.format.GeoJSON.readMultiPointGeometry_,MultiLineString:ol.format.GeoJSON.readMultiLineStringGeometry_,MultiPolygon:ol.format.GeoJSON.readMultiPolygonGeometry_,GeometryCollection:ol.format.GeoJSON.readGeometryCollectionGeometry_,Circle:CgsGeoJSON.readCircleGeometry_},CgsGeoJSON.GEOMETRY_WRITERS_={Point:ol.format.GeoJSON.writePointGeometry_,LineString:ol.format.GeoJSON.writeLineStringGeometry_,Polygon:ol.format.GeoJSON.writePolygonGeometry_,MultiPoint:ol.format.GeoJSON.writeMultiPointGeometry_,MultiLineString:ol.format.GeoJSON.writeMultiLineStringGeometry_,MultiPolygon:ol.format.GeoJSON.writeMultiPolygonGeometry_,GeometryCollection:ol.format.GeoJSON.writeGeometryCollectionGeometry_,Circle:CgsGeoJSON.writeCircleGeometry_},CgsCzml=function(e){CgsDataSource.call(this,e),(e.parent=this).czml3D=new CgsCzml3D(e)},CgsInherits(CgsCzml,CgsDataSource),CgsCzml.prototype.setVisible=function(e){this.czml3D.setVisible(e)},CgsCzml.prototype.remove=function(){this.czml3D.remove()},CgsCzml.prototype.getType=function(){if(this.czml3D)return this.czml3D.getType()},CgsCzml.prototype.getUrl=function(){if(this.czml3D)return this.czml3D.getUrl()},CgsCzml.prototype.getName=function(){if(this.czml3D)return this.czml3D.getName()},CgsCzml.prototype.setName=function(e){this.czml3D&&this.czml3D.setName(e)},CgsCzml.prototype.getPId=function(){if(this.czml3D)return this.czml3D.getPId()},CgsCzml.prototype.setPId=function(e){this.czml3D&&this.czml3D.setPId(e)},CgsCzml.prototype.getVisible=function(){if(this.czml3D)return this.czml3D.getVisible()},CgsCzml.prototype.fileLoad=function(e){this.czml3D&&this.czml3D.fileLoad(e)},CgsCzml.prototype.save=function(){return{type:this.getType(),url:this.getUrl(),name:this.getName(),pId:this.getPId(),visible:this.getVisible()}},CgsCzml.load=function(e,t){t.mapObject=e;var i=new CgsCzml(t);e.addDataSource(i)},CgsCzml.prototype.getSaveFlag=function(){if(this.czml3D)return this.czml3D.getSaveFlag()},CgsCzml.prototype.setSaveFlag=function(e){this.czml3D&&this.czml3D.setSaveFlag(e)},CgsCzml.prototype.setPickEnable=function(e){this.czml3D&&this.czml3D.setPickEnable(e)},CgsCzml.prototype.getPickEnable=function(){return!!this.czml3D&&this.czml3D.getPickEnable()},CgsTerrain=function(e){this.terrain3D=new CgsTerrain3D(e)},CgsTileTerrain=function(e){this.terrain3D=new CgsTileTerrain3D(e)},CgsOverlay=function(e){(e.parentOverlay=this).cloneMode=CgsUtil.defaultValue(e.cloneMode,!0),this.options=e,this.options.brokenLine=this.options.brokenLine||!1,this.options.lineStyle||(this.options.lineStyle={}),this.options.map=null},CgsOverlay.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.options.position=e,this.overlay3D?this.overlay3D.setPosition(e):this.overlay2D&&(this.overlay2D.setPos(e),this.overlay2D.render())):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsOverlay.prototype.getPosition=function(e){return this.options.position},CgsOverlay.prototype.setPositioning=function(e){this.options.positioning=e,this.overlay3D?this.overlay3D.setPositioning(e):this.overlay2D&&(this.overlay2D.setPositioning(e),this.overlay2D.render())},CgsOverlay.prototype.getPositioning=function(e){return this.options.positioning},CgsOverlay.prototype.setPixelOffset=function(e){this.options.offset=e,this.overlay3D?this.overlay3D.setOffset(e):this.overlay2D&&(this.overlay2D.setOffset(e),this.overlay2D.render())},CgsOverlay.prototype.getPixelOffset=function(){return this.options.offset},CgsOverlay.prototype.updateDom=function(e){this.options.element=e,this.overlay3D?this.overlay3D.updateDom(e):this.overlay2D&&(this.overlay2D.setElement(e),this.overlay2D.render())},CgsOverlay.prototype.setMap=function(e){this.map=e},CgsOverlay.prototype.getMap=function(){return this.map},CgsOverlay.prototype.setVisible=function(e){this.overlay3D?this.overlay3D.setVisible(e):this.overlay2D&&this.overlay2D.setVisible(e),this.mobileObj&&(this.realVisibleFlag=e)},CgsOverlay.prototype.getVisible=function(){return this.overlay3D?this.overlay3D.getVisible():this.overlay2D?this.overlay2D.getVisible():void 0},CgsOverlay.prototype.setPointerEvents=function(e){this.options.stopEvent=e,this.overlay3D?this.overlay3D.setPointerEvents(e):this.overlay2D&&this.overlay2D.setPointerEvents(e)},CgsOverlay.prototype.getPointerEvents=function(){return this.overlay3D?this.overlay3D.getPointerEvents():this.overlay2D?this.overlay2D.getPointerEvents():void 0},CgsOverlay.prototype.setLineVisible=function(e){this.overlay3D&&this.overlay3D.setLineVisible(e),this.overlay2D&&this.overlay2D.setLineVisible(e),this.options.showLine=e},CgsOverlay.prototype.getLineVisible=function(){return this.options.showLine},CgsOverlay.prototype.setDraggable=function(e){this.options.draggable=e;try{this.overlay3D&&((this.overlay3D.draggable=e)?$$(this.overlay3D.state.div).draggable({disabled:!1,containment:this.map.container}):$$(this.overlay3D.state.div).draggable({disabled:!0})),this.overlay2D&&((this.overlay2D.draggable=e)?$$(this.overlay2D.element).draggable({disabled:!1,containment:this.map.container}):$$(this.overlay2D.element).draggable({disabled:!0}))}catch(e){var t;this.map&&((t=this.map).removeOverlay(this),t.addOverlay(this))}},CgsOverlay.prototype.getDraggable=function(){return this.options.draggable},CgsOverlay.prototype.setLineStyle=function(e){this.options.lineStyle||(this.options.lineStyle={}),null!=e.color&&(this.options.lineStyle.color=e.color),null!=e.width&&(this.options.lineStyle.width=e.width),null!=e.dasharray&&(this.options.lineStyle.dasharray=e.dasharray),null!=e.dashoffset&&(this.options.lineStyle.dashoffset=e.dashoffset),this.overlay2D&&this.overlay2D.setLineStyle(e),this.overlay3D&&this.overlay3D.setLineStyle(e)},CgsOverlay.prototype.getLineStyle=function(){return this.options.lineStyle},CgsOverlay.prototype.setLineZIndex=function(e){if("number"!=typeof e)throw new Error("index is wrong");this.overlay3D&&this.overlay3D.svg.css("z-index",e),this.overlay2D&&this.overlay2D.svg.css("z-index",e)},CgsOverlay.prototype.getOverlay3DIndex=function(){if(this.overlay3D)return this.overlay3D.getOverlay3DIndex()},CgsOverlay.prototype.setOverlay3DIndex=function(e){this.overlay3D&&this.overlay3D.setOverlay3DIndex(e)},CgsOverlay.clone=function(e){if(Cesium.defined(e)&&e.cloneMode){var t=e.options,i=e.overlay3D.dom;t.element=$$(i).clone()[0];var s=new CgsOverlay3D(t);return s.parent=e.overlay3D,e.overlay3D.clones.push(s),s}},CgsPopup=function(e){var t={position:[120,29],positioning:"top-left",offset:[0,0],draggable:!1,showLine:!1,onRemove:null,className:void 0};_.assign(t,e),this.content=t.content,t.element=this.createSelfDom(this.content,t),CgsOverlay.call(this,t)},CgsInherits(CgsPopup,CgsOverlay),CgsPopup.prototype.createSelfDom=function(e,t){var i=this,s=document.createElement("div");s.className="cesium-feature-popup "+t.className;var o=document.createElement("div");$$(o).html(e),$$(s).append(o);var a=document.createElement("a");return a.className="cesium-feature-popup-closer",a.href="javascript:;",$$(s).append(a),$$(a).on("click",function(){var e;i.map?((e=i.options.onRemove)&&e(i),i.map.removeOverlay(i)):console.info("没有map对象")}),s},function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsCluster=t()}(window,function(){function e(e){var t=0<arguments.length&&void 0!==e?e:{};if(!t.map)throw Error("须设置map对象");this.map_=t.map,this.pixelRange_=t.pixelRange||100,this.minPoints_=t.minPoints||2,this.features=t.features,t.imageUrl=t.imageUrl||CGS_SDK_PATH+"assets/image/cluster/cluster_default.png",this.feature3D=new CgsCluster3D(t),this.feature2D=new CgsCluster2D(t);var i=void 0===t.enabled||t.enabled;this.setEnabled(i)}var d=proj4("EPSG:4326","EPSG:3857").forward,m=proj4("EPSG:4326","EPSG:3857").inverse;return e.prototype.setEnabled=function(e){var t,i,s,o,a,n,r,l;this.enabled_!==e&&(i=(t=this).map_.map2D,(s=t.eventListener)&&(i.getView().un("change:resolution",s.listener2D),s.listener3D()),e?(this.render_(),a=(o=this).map_,n=a.map3D,r=a.map2D,(l={}).listener3D=n.camera.changed.addEventListener(function(){var e=a.getResolution();(1.5<=e/o.resolution_||1.5<=o.resolution_/e)&&o.render_()}),l.listener2D=function(){var e=a.getResolution();(1.5<=e/o.resolution_||1.5<=o.resolution_/e)&&o.render_()},r.getView().on("change:resolution",l.listener2D),o.eventListener=l):(this.feature3D.clearClusterd(),this.feature2D.clearClusterd(),this.features.forEach(function(e){e.clustered=!1}),this.updateClusteringFeatures()))},e.prototype.getEnabled=function(){return this.enabled_},e.prototype.setPixelRange=function(e){},e.prototype.getPixelRange=function(){return this.pixelRange_},e.prototype.setMinPoints=function(e){},e.prototype.getMinPoints=function(){return this.minPoints_},e.prototype.render_=function(){this.resolution_=this.map_.getResolution();var e=this.pixelRange_*this.map_.getResolution()*.5,t=function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2,s={},o=[],a=0,n=e.length;a<n;a++){var r,l,u,p,h,c,g=e[a];g.getId()in s||(g.clustered=!1,r=g.getPosition(),r=d(r),l=m([r[0]-t,r[1]-t]),u=m([r[0]+t,r[1]+t]),p=[l[0],l[1],u[0],u[1]],h=function(e,t){for(var i=_slicedToArray(t,4),s=i[0],o=i[1],a=i[2],n=i[3],r=[],l=0,u=e.length;l<u;l++){var p=e[l],h=p.getPosition(),c=_slicedToArray(h,2),g=c[0],d=c[1];s<=g&&g<=a&&o<=d&&d<=n&&r.push(p)}return r}(e,p),c=(h=h.filter(function(e){return!(e.getId()in s)})).length,i<=c&&o.push(function(e,t){for(var i=0,s=0,o=e.length,a=0;a<o;a++){var n=e[a],r=n.getId();t[r]=!0,n.clustered=!0;var l=n.getPosition();i+=l[0],s+=l[1]}return{center:[i/o,s/o],features:e,length:o}}(h,s)))}return o}(this.features,e,this.minPoints_);this.updateClusteringFeatures(),this.feature3D.setData(t),this.feature2D.setData(t)},e.prototype.updateClusteringFeatures=function(){for(var e=this.features,t=0,i=e.length;t<i;t++){var s=e[t];s.clustered?(s.feature3D.entity.show=!1,s.feature3D.label.entity.show=!1,s.feature2D.setVisible(!1)):(s.feature3D.entity.show=!0,s.feature3D.label.entity.show=!0,s.feature2D.setVisible(!0))}},Object.defineProperties(e.prototype,{enabled:{set:function(e){this.setEnabled(e)},get:function(){return this.enabled_}}}),e.prototype.addFeatures=function(e){},e.prototype.removeFeatures=function(e){},e.prototype.destroy=function(){this.setEnabled(!1),this.feature2D&&this.feature2D.destroy(),this.feature3D&&this.feature3D.destroy()},e}),CgsAirLine=function(e){e.mark&&!e.satelineFlag&&(this.feature2D=new CgsAirLine2D(e)),e.model?(this.feature3D=new CgsAirLine3D(e),e.mark&&e.mapObject&&"3D"==e.mapObject.mode&&(e.satelineFlag||e.mark.setVisible(!1))):e.mark&&(e.model=e.mark,this.feature3D=new CgsAirLine3D(e)),this.options=e},CgsAirLine.prototype.showPath=function(){this.feature3D&&this.feature3D.showPath(),this.feature2D&&this.feature2D.showPath()},CgsAirLine.prototype.hidePath=function(){this.feature3D&&this.feature3D.hidePath(),this.feature2D&&this.feature2D.hidePath()},CgsAirLine.prototype.setPoints=function(e){this.feature3D&&this.feature3D.setPoints(e),this.feature2D&&this.feature2D.setPoints(e)},CgsAirLine.prototype.start=function(){var i=this;this.options.model&&this.options.mark&&(this.modechangedId=CgsSubPub.subscribe("modechanged",function(e,t){"3D"==t?i.options.mark&&i.options.mark.setVisible(!1):"2D"==t&&i.options.mark&&i.options.mark.setVisible(!0)})),this.feature3D&&this.feature3D.start(),this.feature2D&&this.feature2D.start()},CgsAirLine.prototype.stop=function(){this.modechangedId&&CgsSubPub.unsubscribe(this.modechangedId),this.feature3D&&this.feature3D.stop(),this.feature2D&&this.feature2D.stop()},CgsAirLine.prototype.freeze=function(){this.feature3D&&this.feature3D.freeze(),this.feature2D&&this.feature2D.freeze()},CgsAirLine.prototype.unfreeze=function(){this.feature3D&&this.feature3D.unfreeze(),this.feature2D&&this.feature2D.unfreeze()},CgsAirLine.prototype.restart=function(){this.feature3D&&this.feature3D.restart(),this.feature2D&&this.feature2D.restart()},CgsAirLine.prototype.getState=function(){return this.feature3D.getState()},CgsAirLine.prototype.isFinish=function(){return this.feature3D.isFinish()},CgsAirLine.prototype.getPassedPath=function(){return this.feature3D.getPassedPath()},CgsAirLine.prototype.showPassPath=function(){this.feature3D.showPassPath(),this.feature2D&&this.feature2D.showPassPath()},CgsAirLine.prototype.hidePassPath=function(){this.feature3D.hidePassPath(),this.feature2D&&this.feature2D.hidePassPath()},CgsAirLine.prototype.speedUp=function(){this.feature3D.speedUp(),this.feature2D&&this.feature2D.speedUp()},CgsAirLine.prototype.speedDown=function(){this.feature3D.speedDown(),this.feature2D&&this.feature2D.speedDown()},CgsAirLine.prototype.setPassedRate=function(e){this.feature3D&&this.feature3D.setPassedRate(e),this.feature2D&&this.feature2D.setPassedRate(e)},CgsAirLine.prototype.getPassedRate=function(){return this.feature3D.getPassedRate()},CgsAirLine.prototype.addTailFire=function(e){this.feature3D.addTailFire(e)},CgsAirLine.prototype.addRibbon=function(e){this.feature3D.addRibbon(e)},CgsAirLine.prototype.addSlope=function(e){this.feature3D.addSlope(e)},CgsAirLine.prototype.getMultiplier=function(){this.feature3D.getMultiplier()},CgsAirLine.prototype.setMultiplier=function(e){this.feature3D.setMultiplier(e)},CgsAirLine.prototype.showPrePath=function(){this.feature3D.showPrePath()},CgsAirLine.prototype.hidePrePath=function(){this.feature3D.hidePrePath()},CgsAirLine.prototype.addRadar=function(e){this.feature3D.addRadar(e)},CgsAirLine.prototype.addScanArea=function(){var e,t,i,s,o,a=this.feature3D.radar;a&&(a.getType()==CgsRadar.SATELLITE_RADAR?(i=a.getRadius(),e=a.feature3D.cirPosition):a.getType()==CgsRadar.AIR_RADAR&&(e=a.getPosition(),t=a.getAngle(),i=a.getLength()*Math.tan(Cesium.Math.toRadians(t/2))),s={positions:[[e[0],e[1]],[e[0],e[1]]],width:2*i,height:0,cornerType:"MITERED",fillColor:"rgba(125,175,80,0.8)",outlineColor:"rgba(125,175,80,0.8)",callbackFlag:!0},o=new CgsCorridor(s),this.feature3D.addScanArea(o))},CgsAirLine.prototype.setIntervalTime=function(e){this.feature3D.setIntervalTime(e)},CgsAirLine.prototype.getIntervalTime=function(){return this.feature3D.getIntervalTime()},CgsAirLine.prototype.getOrbitMotionFlag=function(){this.feature3D.getOrbitMotionFlag()},CgsAirLine.prototype.setOrbitMotionFlag=function(e){this.feature3D.setOrbitMotionFlag(e)},CgsAirLine.prototype.dispose=function(){this.feature3D&&this.feature3D.dispose(),this.feature2D&&this.feature2D.dispose&&this.feature2D.dispose(),this.hidePath(),this.stop()},CgsAirLine.STATE_START=0,CgsAirLine.STATE_FREEZE=1,CgsAirLine.STATE_UNFREEZE=2,CgsAirLine.STATE_RESTART=3,CgsAirLine.STATE_STOP=4,CgsLineAnimation=function(e){CgsLine.call(this,e),this.feature3D=new CgsLineAnimation3D(e)},CgsInherits(CgsLineAnimation,CgsLine),CgsLineAnimation.prototype.setTotalTime=function(e){this.feature3D.setTotalTime(e)},CgsLineAnimation.prototype.getTotalTime=function(){return this.feature3D.getTotalTime()},CgsLineAnimation.prototype.setLoop=function(e){this.feature3D.setTotalTime(e)},CgsLineAnimation.prototype.getLoop=function(){return this.feature3D.getLoop()},CgsLineAnimation.prototype.setReverse=function(e){this.feature3D.setReverse(e)},CgsLineAnimation.prototype.getReverse=function(){return this.feature3D.getReverse()},CgsLineAnimation.prototype.setInterpolation=function(e){this.feature3D.setInterpolation(e)},CgsLineAnimation.prototype.getInterpolation=function(){return this.feature3D.getInterpolation()},CgsLineAnimation.prototype.getSelfType=function(){return this.feature3D.getSelfType()},CgsLineAnimation.prototype.isFinish=function(){return this.feature3D.isFinish()},CgsLineAnimation.LINEER_INTER=0,CgsLineAnimation.HERMITE_INTER=1,CgsLineAnimation.LAGRANGE_INTER=2,CgsLineAnimation.prototype.save=function(){return{positions:this.getPosition(),totalTime:this.getTotalTime(),loop:this.getLoop(),reverse:this.getReverse(),interpolation:this.getInterpolation(),selfType:this.getSelfType(),lineType:this.getLineType(),fillColor:this.getFillColor(),followSurface:this.getFollowSurface()}},CgsLineAnimation.load=function(e,t){var i=new CgsLineAnimation(t);e.addFeature(i)},CgsManipulate=function(e){this.mainpulate3D=new CgsManipulate3D(e)},CgsManipulate.prototype.setSelectFeature=function(e){this.mainpulate3D.setSelectFeature(e)},CgsManipulate.prototype.getSelectModel=function(){return this.mainpulate3D.getSelectModel()},CgsManipulate.prototype.setManipulteType=function(e){this.mainpulate3D.setManipulteType(e)},CgsManipulate.prototype.setManipulateType=function(e){this.mainpulate3D.setManipulateType(e)},CgsManipulate.prototype.getManipulteType=function(){return this.mainpulate3D.getManipulateType()},CgsManipulate.prototype.getManipulateType=function(){return this.mainpulate3D.getManipulateType()},CgsManipulate.prototype.setModelOffsetHeading=function(e){this.mainpulate3D.setModelOffsetHeading(e)},CgsManipulate.prototype.getModelOffsetHeading=function(){return this.mainpulate3D.getModelOffsetHeading()},CgsManipulate.MANIPULATE_FREEDOM=1,CgsManipulate.MANIPULATE_FIRST=2,CgsManipulate.MANIPULATE_THIRD=3,CgsManipulate.MANIPULATE_COCKPIT=4,CgsFlyLine=function(e){this.timer=null,this.selfType="CgsFlyLine",this.entities=[],CgsFeature.call(this,e),null==e?(this.name="",this.positions=[[118,30,5e4],[120,32,5e4]],this.evenColor="rgba(255,255,255,1.0)",this.width=2,this.show=!0,this.followSurface=!0,this.time=3e3,this.saveFlag=!0):(this.returnFlag=!!e.returnFlag&&e.returnFlag,this.bindedLine=e.bindedLine,this.bindedLine instanceof CgsArc?e.positions=this.bindedLine.coordinates:(this.bindedLine instanceof CgsParabola||this.bindedLine instanceof CgsLine)&&(e.positions=this.bindedLine.feature3D.positions),this.name=void 0===e.name?"":e.name,this.positions=void 0===e.positions?[[118,30,5e4],[120,32,5e4]]:e.positions,this.evenColor=void 0===e.evenColor?"rgba(255,255,255,0.99)":e.evenColor,this.width=void 0===e.width?2:e.width,this.time=void 0===e.time?3e3:e.time,this.saveFlag=void 0===e.saveFlag||e.saveFlag,this.visibleIn2D=void 0!==e.visibleIn2D&&e.visibleIn2D);var t=!1;if(2==this.positions.length){var i,s=this.positions,o=new Array;if("[object Array]"==Object.prototype.toString.call(s[0]))for(var a=0;a<s.length;a++){3==s[a].length&&(t=!0);for(var n=s[a],r=0;r<n.length;r++)o.push(n[r])}else o=s;i=t?new Cesium.CatmullRomSpline({times:[0,1],points:[Cesium.Cartesian3.fromDegrees(o[0],o[1],o[2]),Cesium.Cartesian3.fromDegrees(o[3],o[4],o[5])]}):new Cesium.CatmullRomSpline({times:[0,1],points:[Cesium.Cartesian3.fromDegrees(o[0],o[1],0),Cesium.Cartesian3.fromDegrees(o[2],o[3],0)]});for(var l=[],a=0;a<=100;a++){var u=i.evaluate(a/100),p=Cesium.Cartographic.fromCartesian(u),h=[];e.followSurface?h.push(180*p.longitude/Math.PI,180*p.latitude/Math.PI,0):h.push(180*p.longitude/Math.PI,180*p.latitude/Math.PI,p.height),l.push(h)}this.poslist=l,this.bindedLine instanceof CgsLine&&this.bindedLine.feature2D.setPosition(l)}else this.poslist=e.positions,3==e.positions[0].length&&(t=!0);var c=[];this.pointsLength=10;if(1==t){for(a=0;a<this.pointsLength;a++)c[3*a]=this.poslist[a][0],c[3*a+1]=this.poslist[a][1],c[3*a+2]=this.poslist[a][2];Cesium.Cartesian3.fromDegreesArrayHeights(c)}else{for(a=0;a<this.pointsLength;a++)c[2*a]=this.poslist[a][0],c[2*a+1]=this.poslist[a][1];Cesium.Cartesian3.fromDegreesArray(c)}for(a=0;a<this.pointsLength/2;a++){var g=new CgsLine({positions:[this.poslist[a],this.poslist[a+1]],width:this.width*((a+1)/(this.pointsLength/2)),fillColor:this.evenColor,clampToGround:!1});this.entities.push(g)}this.bflag=t,this.pos=c,this.type="flyline"},CgsInherits(CgsFlyLine,CgsFeature),CgsFlyLine.prototype.start=function(){var t=0,i=this;if(!(this.visibleIn2D||this.bindedLine instanceof CgsParabola))for(var e=0;e<i.entities;e++)this.entities[e].feature2D.setVisible(!1);var s=setInterval(function(){for(var e=0;e<i.pointsLength;e+=2)i.visibleIn2D?i.entities[e/2].setPosition([i.poslist[t+e/2],i.poslist[t+e/2+1]]):(i.entities[e/2].feature3D.setPosition([i.poslist[t+e/2],i.poslist[t+e/2+1]]),i.entities[e/2].feature2D.setVisible(!1));++t==i.poslist.length-i.pointsLength/2&&(t=0,i.returnFlag&&(i.poslist=Array.reverse(i.poslist)))},i.time/(i.poslist.length-i.pointsLength/2));i.timer=s},CgsFlyLine.prototype.getId=function(){if(this.entities&&0<this.entities.length)return this.entities[0].getId()},CgsFlyLine.prototype.setVisible=function(e){if(this.getVisible()!=e)for(var t=0;t<this.entities.length;t++)this.entities[t].setVisible(e)},CgsFlyLine.prototype.getVisible=function(){if(this.entities&&0<this.entities.length)return this.entities[0].getVisible()},CgsFlyLine.prototype.getType=function(){return this.type},CgsFlyLine.prototype.getEvenColor=function(){return this.evenColor},CgsFlyLine.prototype.setEvenColor=function(e){for(var t=0;t<this.entities.length;t++)this.entities[t].setFillColor(e)},CgsFlyLine.prototype.getWidth=function(){return this.width},CgsFlyLine.prototype.getTime=function(){return this.time},CgsFlyLine.prototype.getName=function(){return this.name},CgsFlyLine.prototype.getPosition=function(){return this.positions},CgsFlyLine.prototype.getSaveFlag=function(){return this.saveFlag},CgsFlyLine.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsFlyLine.prototype.getSelfType=function(){return this.selfType},CgsFlyLine.prototype.save=function(){return{evenColor:this.getEvenColor(),width:this.getWidth(),show:this.getVisible(),time:this.getTime(),name:this.getName(),positions:this.getPosition(),selfType:this.getSelfType(),visibleIn2D:this.visibleIn2D}},CgsFlyLine.load=function(e,t){var i=new CgsFlyLine(t);e.addFeature(i)},CgsMeasure=function(e){if(e&&e.mapObject){this.tempMeasureTooltip=null,this.tempMeasureFeature=null,this.measureTooltipElement=null,this.mode=e.mode,this.tempDistance=0,this.tempTips=[],e.type?e.type=e.type.toUpperCase():e.type="LINE",this.type=e.type,this.options=e;var t=new CgsStyleStroke2D({color:void 0===e.fill?"rgba(0,153,255,1.0)":e.fill,width:void 0===e.width?1:e.width,lineDash:[e.dash]}),i=new CgsStyleStroke2D({color:void 0===e.fill?"rgba(255,255,255,0.4)":e.fill}),s=null;switch(this.type){case"LINE":s={image:null,stroke:t,fill:null,text:null};break;case"POLYGON":case"RECT":case"CIRCLE":s={image:null,stroke:t,fill:i,text:null};break;case"ANGLE":s={image:null,stroke:t,fill:null,text:null};break;default:return void console.info("the type of drawfeaturebymouse is not surpported")}e.style=new CgsStyle2D(s),this.options.mapObject.threeFlag&&(this.drawfeaturebymouse3D=new CgsDrawFeatureByMouse3D(e)),this.options.mapObject.isCesium2D||(this.drawfeaturebymouse2D=new CgsDrawFeatureByMouse2D(e))}},CgsMeasure.prototype.activate=function(){"2D"!=this.options.mapObject.mode||this.options.mapObject.isCesium2D?this.drawfeaturebymouse3D.activate():(this.options.mapObject.featureSelect.deactivate(),this.drawfeaturebymouse2D.activate());var d=this;function o(){d.measureTooltipElement=document.createElement("div"),d.measureTooltipElement.className="cgstooltip cgstooltip-measure",d.measureTooltipElement.style.pointerEvents="none",d.measureTooltip=new CgsOverlay({position:[0,0],element:d.measureTooltipElement,offset:[0,-6],positioning:"bottom-center",stopEvent:!1}),d.measureTooltip.setVisible(!1),d.options.mapObject.addOverlay(d.measureTooltip),d.options.mapObject.overlayMeasureByMouse.push(d.measureTooltip),d.tempMeasureTooltip=d.measureTooltip}this.changeModeId=CgsSubPub.subscribe("modechanged",function(e,t){"3D"!=t||d.options.mapObject.isCesium2D?d.deactivateByMapMode("3D"):d.deactivateByMapMode("2D")}),this.featuredrawstartId2D=CgsSubPub.subscribe("featuredrawstart2d",function(e,t,i){o();var s=[t];switch(d.type){case"LINE":d.measureTooltipElement.innerHTML=d.formatLine(s);break;case"POLYGON":case"RECT":d.measureTooltipElement.innerHTML=d.formatArea(s);break;case"CIRCLE":break;case"ANGLE":d.measureTooltipElement.innerHTML=d.formatAngle(s)}}),this.featuredrawstartId3D=CgsSubPub.subscribe("featuredrawstart3d",function(e,t,i){o();var s=[t];switch(d.type){case"LINE":d.measureTooltipElement.innerHTML=d.formatLine(s);break;case"POLYGON":case"RECT":d.measureTooltipElement.innerHTML=d.formatArea(s);break;case"CIRCLE":d.measureTooltip.setPosition(t),d.measureTooltipElement.innerHTML=d.formatCircleArea();break;case"ANGLE":d.measureTooltipElement.innerHTML=d.formatAngle(s)}}),this.featuredrawmoveId2D=CgsSubPub.subscribe("featuredrawmove2d",function(e,t,i){for(var s=i.getGeometry().flatCoordinates,o=[],a=0;a<s.length;a+=2){var n=[];n[0]=s[a],n[1]=s[a+1],n=ol.proj.transform(n,d.options.mapObject.map2D.projection,"EPSG:4326"),o.push(n)}switch(d.measureTooltip.setVisible(!0),d.type){case"LINE":d.measureTooltipElement.innerHTML=d.formatLine(o),d.measureTooltip.setPosition(o[o.length-1]);break;case"POLYGON":d.measureTooltipElement.innerHTML=d.formatArea(o),d.measureTooltip.setPosition(o[o.length-1]);break;case"RECT":d.measureTooltipElement.innerHTML=d.formatArea(o),d.measureTooltip.setPosition(o[o.length-2]);break;case"CIRCLE":break;case"ANGLE":d.measureTooltipElement.innerHTML=d.formatAngle(o);var r=o.length;3<=r&&(s=o[r-2],d.measureTooltip.setPosition([s[0],s[1]]))}}),this.featuredrawmoveId3D=CgsSubPub.subscribe("featuredrawmove3d",function(e,t,i){var s=(d.tempMeasureFeature=i).getPosition();switch("CIRCLE"!==d.type&&d.measureTooltip.setPosition(s[s.length-1]),d.measureTooltip.setVisible(!0),d.type){case"LINE":d.measureTooltipElement.innerHTML="总距离："+d.formatLine(s);break;case"POLYGON":d.measureTooltipElement.innerHTML=d.formatArea(s);break;case"RECT":var o=[s[0],[s[0][0],s[1][1]],s[1],[s[1][0],s[0][1]]];d.measureTooltipElement.innerHTML=d.formatArea(o);break;case"CIRCLE":d.measureTooltipElement.innerHTML=d.formatCircleArea(i.getRadius());break;case"ANGLE":d.measureTooltipElement.innerHTML=d.formatAngle(s);var a,n=s.length;3<=n&&(a=s[n-2],d.measureTooltip.setPosition([a[0],a[1]]))}}),this.featuredrawlinetemp=CgsSubPub.subscribe("featuredrawlinetemp",function(e,t,i,s){var o,a;d.options.mapObject.mode==s&&d.options.mode&&"LINE"===d.type&&((o=document.createElement("div")).className="cgstooltip cgstooltiptemp-measure",o.style.pointerEvents="none",d.tempDistance=d.tempDistance+i,1e3<i?(display=i/1e3,o.innerHTML="距起点距离："+(d.tempDistance/1e3).toFixed(2)+"m"):o.innerHTML="距起点距离："+(d.tempDistance/1e3).toFixed(2)+"km",a=new CgsOverlay({position:[t[0],t[1]],element:o,offset:[0,26],positioning:"bottom-center",stopEvent:!1}),d.options.mapObject.addOverlay(a),d.options.mapObject.overlayMeasureByMouse.push(a),d.tempTips.push(a))}),this.featuredrawendId2D=CgsSubPub.subscribe("featuredrawend2d",function(e,t,i){for(var s=t.getGeometry().flatCoordinates,o=[],a=0;a<s.length;a+=2){var n=[];n[0]=s[a],n[1]=s[a+1],n=ol.proj.transform(n,d.options.mapObject.map2D.projection,"EPSG:4326"),o.push(n)}var r=null;switch(d.type){case"LINE":d.options.positions=o,d.measureTooltipElement.innerHTML="总距离："+d.formatLine(o),r=new CgsLine(d.options),0<d.tempTips.length&&d.options.mapObject.removeOverlay(d.tempTips[d.tempTips.length-1]),d.tempTips=[],d.tempDistance=0;break;case"POLYGON":d.options.positions=[o];for(var l=[],a=0;a<d.options.positions[0].length-1;a++)l[a]=d.options.positions[0][a];d.measureTooltipElement.innerHTML=d.formatArea(o),r=new CgsPolygon(d.options);break;case"RECT":d.measureTooltipElement.innerHTML=d.formatArea(o);var u=Math.min(o[0][0],o[2][0]),p=Math.max(o[0][0],o[2][0]),h=Math.min(o[0][1],o[2][1]),c=Math.max(o[0][1],o[2][1]);d.options.positions=[[u,h],[p,c]],r=new CgsRect(d.options);break;case"CIRCLE":break;case"ANGLE":d.options.positions=o,d.measureTooltipElement.innerHTML=d.formatAngle(o),d.measureTooltip.setPosition(o[o.length-2]),r=new CgsLine(d.options)}d.options.mapObject.addFeature(r),d.options.mapObject.featuresMeasureByMouse.push(r),d.tempMeasureTooltip=null,CgsSubPub.publish("drawend",[o,d.type]),d.options.once&&d.drawfeaturebymouse2D.deactivate()}),this.featuredrawendId3D=CgsSubPub.subscribe("featureDrawnByMouse",function(e,t,i){var s,o=t.getPosition(),a=null;switch(d.type){case"LINE":d.options.positions=o,d.measureTooltipElement.innerHTML="总距离："+d.formatLine(o),a=new CgsLine(d.options),0<d.tempTips.length&&d.options.mapObject.removeOverlay(d.tempTips[d.tempTips.length-1]),d.tempTips=[],d.tempDistance=0;break;case"POLYGON":"[object Array]"==Object.prototype.toString.call(o[0])&&(s=o[0],"[object Array]"!=Object.prototype.toString.call(s[0])&&(d.options.positions=[o]));for(var n=[],r=0;r<d.options.positions[0].length-1;r++)n[r]=d.options.positions[0][r];d.measureTooltipElement.innerHTML=d.formatArea(n),a=new CgsPolygon(d.options);break;case"RECT":n=[o[0],[o[0][0],o[1][1]],o[1],[o[1][0],o[0][1]]];d.measureTooltipElement.innerHTML=d.formatArea(n),a=new CgsRect(d.options);for(var l=t.labelList,r=0;r<l.length;r++){var u=(n=l[r].getPosition())[0].toFixed(2),p=n[1].toFixed(2),h={position:n,fillColor:"rgba(0,153,255,1.0)",name:u+","+p,pixelSize:2,labelfont:"12px 宋体"};1==r&&(h.labeloffset=[20,20]);var c=new CgsPoint(h);d.options.mapObject.map3D.removeFeature(l[r]),d.options.mapObject.addFeature(c),d.options.mapObject.featuresMeasureByMouse.push(c)}break;case"CIRCLE":var g=t.getRadius();d.options.radius=g,a=new CgsCircle(d.options),d.measureTooltipElement.innerHTML=d.formatCircleArea(g);break;case"ANGLE":d.options.positions=o,d.measureTooltipElement.innerHTML=d.formatAngle(o),d.measureTooltip.setPosition(o[o.length-2]),a=new CgsLine(d.options)}d.options.mapObject.map3D.removeFeature(t),d.options.mapObject.addFeature(a),d.options.mapObject.featuresMeasureByMouse.push(a),d.tempMeasureTooltip=null,d.tempMeasureFeature=null,CgsSubPub.publish("drawend",[o,d.type]),d.options.once&&d.drawfeaturebymouse3D.deactivate()})},CgsMeasure.prototype.getType=function(){return this.type},CgsMeasure.prototype.deactivate=function(){this.deactivateByMapMode(this.options.mapObject.mode)},CgsMeasure.prototype.deactivateByMapMode=function(e){var t,i=this;if(setTimeout(function(){i.options.mapObject.isCesium2D||i.options.mapObject.featureSelect.activate()},1e3),"2D"!=e||this.options.mapObject.isCesium2D?(this.drawfeaturebymouse3D.deactivate(),null!=i.tempMeasureTooltip&&null!=i.tempMeasureFeature&&(i.options.mapObject.map3D.removeFeature(i.tempMeasureFeature),i.options.mapObject.removeOverlay(i.tempMeasureTooltip),t=i.options.mapObject.overlayMeasureByMouse.indexOf(i.measureTooltip),i.options.mapObject.overlayMeasureByMouse.splice(t,1),i.tempMeasureTooltip=null,i.tempMeasureFeature=null)):(this.drawfeaturebymouse2D.deactivate(),null!=i.tempMeasureTooltip&&(i.options.mapObject.removeOverlay(i.tempMeasureTooltip),t=i.options.mapObject.overlayMeasureByMouse.indexOf(i.measureTooltip),i.options.mapObject.overlayMeasureByMouse.splice(t,1),i.tempMeasureTooltip=null)),0!=i.tempTips.length){for(var s=0;s<i.tempTips.length;s++)i.options.mapObject.removeOverlay(i.tempTips[s]);i.tempTips=[],i.tempDistance=0}this.changeModeId&&CgsSubPub.unsubscribe(this.changeModeId),this.featuredrawstartId3D&&CgsSubPub.unsubscribe(this.featuredrawstartId3D),this.featuredrawstartId2D&&CgsSubPub.unsubscribe(this.featuredrawstartId2D),this.featuredrawmoveId3D&&CgsSubPub.unsubscribe(this.featuredrawmoveId3D),this.featuredrawlinetemp&&CgsSubPub.unsubscribe(this.featuredrawlinetemp),this.featuredrawmoveId2D&&CgsSubPub.unsubscribe(this.featuredrawmoveId2D),this.featuredrawendId3D&&CgsSubPub.unsubscribe(this.featuredrawendId3D),this.featuredrawendId2D&&CgsSubPub.unsubscribe(this.featuredrawendId2D)},CgsMeasure.prototype.formatArea=function(e){var t=this.areaMeasure(e),i=1e4<t?Math.round(t/1e6*100)/100+" k㎡":Math.round(100*t)/100+" ㎡";return i},CgsMeasure.prototype.formatCircleArea=function(e){if(!e)return"0㎡";var t=CgsGeometry.measureCircleByRadius(e),i=1e4<t?Math.round(t/1e6*100)/100+" k㎡":Math.round(100*t)/100+" ㎡";return i},CgsMeasure.prototype.formatLine=function(e){var t=this.distanceMeasure(e),i=100<t?Math.round(t/1e3*100)/100+" km":Math.round(100*t)/100+" m";return i},CgsMeasure.prototype.formatAngle=function(e){var t,i,s,o=0,a=e.length;return 3<=e.length&&(t=e[a-3],i=e[a-2],s=e[a-1],o=(o=CgsMath3D.calculateAngle([i,t],[i,s])).toFixed(2)+"度"),o},CgsMeasure.prototype.distanceMeasure=function(e){for(var t=0,i=0,s=e.length-1;i<s;++i)t+=ol.sphere.getDistance(e[i],e[i+1]);return t},CgsMeasure.distanceMeasure=function(e){for(var t=0,i=0,s=e.length-1;i<s;++i)t+=ol.sphere.getDistance(e[i],e[i+1]);return t},CgsMeasure.prototype.areaMeasure=function(e){var t,i=0;return 3<=e.length&&(t=new ol.geom.Polygon([e]),i=Math.abs(ol.sphere.getArea(t))),i},CgsMeasure.POINT_DISTANCE="LINE",CgsMeasure.POINT_ANGLE="ANGLE",CgsMeasure.SHAPE_RECTANGLE="RECT",CgsMeasure.SHAPE_POLYGON="POLYGON",CgsMeasure.SHAPE_CIRCLE="CIRCLE",CgsMeasure.MULTI_RESULT=!0,CgsMeasure.SINGLE_RESULT=!1,CgsFlyPath=function(e){this.flypath3D=new CgsFlyPath3D(e)},CgsFlyPath.prototype.setHeight=function(e){this.flypath3D.setHeight(e)},CgsFlyPath.prototype.setStartEndPosition=function(e){this.flypath3D.setStartEndPosition(e)},CgsFlyPath.prototype.setSpeed=function(e){this.flypath3D.setSpeed(e)},CgsFlyPath.prototype.remove=function(){this.flypath3D.remove()},CgsCylinder=function(e){CgsFeature.call(this,e),this.feature3D=new CgsCylinder3D(e)},CgsInherits(CgsCylinder,CgsFeature),CgsCylinder.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsCylinder.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsCylinder.prototype.setLength=function(e){this.feature3D.setLength(e)},CgsCylinder.prototype.getLength=function(){return this.feature3D.getLength()},CgsCylinder.prototype.setTopRadius=function(e){this.feature3D.setTopRadius(e)},CgsCylinder.prototype.getTopRadius=function(){return this.feature3D.getTopRadius()},CgsCylinder.prototype.setBottomRadius=function(e){this.feature3D.setBottomRadius(e)},CgsCylinder.prototype.getBottomRadius=function(){return this.feature3D.getBottomRadius()},CgsCylinder.prototype.setFillFlag=function(e){this.feature3D.setFillFlag(e)},CgsCylinder.prototype.getFillFlag=function(){return this.feature3D.getFillFlag()},CgsCylinder.prototype.setFillColor=function(e){this.feature3D.setFillColor(e)},CgsCylinder.prototype.getFillColor=function(){return this.feature3D.getFillColor()},CgsCylinder.prototype.setOutlineFlag=function(e){this.feature3D.setOutlineFlag(e)},CgsCylinder.prototype.getOutlineFlag=function(){return this.feature3D.getOutlineFlag()},CgsCylinder.prototype.setOutline=function(e){this.feature3D.setOutline(e)},CgsCylinder.prototype.getOutline=function(){return this.feature3D.getOutline()},CgsCylinder.prototype.setOutlineColor=function(e){this.feature3D.setOutlineColor(e)},CgsCylinder.prototype.getOutlineColor=function(){return this.feature3D.getOutlineColor()},CgsCylinder.prototype.setVerticalLines=function(e){this.feature3D.setVerticalLines(e)},CgsCylinder.prototype.getVerticalLines=function(){return this.feature3D.getVerticalLines()},CgsCylinder.prototype.setSlices=function(e){this.feature3D.setSlices(e)},CgsCylinder.prototype.getSlices=function(){return this.feature3D.getSlices()},CgsCylinder.prototype.setVisibleHeight=function(e){this.feature3D.setVisibleHeight(e)},CgsCylinder.prototype.getVisibleHeight=function(){return this.feature3D.getVisibleHeight()},CgsCylinder.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name)this.setPosition(value);else if("fillColor"==name)this.setFillColor(value);else if("outlineColor"==name)this.setOutlineColor(value);else if("outline"==name)this.setOutlineFlag(value);else if("length"==name)this.setLength(parseFloat(value));else if("fillFlag"==name)this.setFillFlag(value);else if("topRadius"==name)this.setTopRadius(parseFloat(value));else if("bottomRadius"==name)this.setBottomRadius(parseFloat(value));else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void console.log("输入格式错误！")}this.setVisibleHeight(pp)}},CgsCylinder.prototype.getPropertyString=function(){var e=this,t=[];return t.push({type:"input",label:"id",name:"id",value:e.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:e.getName()},{type:"checkbox",label:"显示",name:"show",value:e.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:e.getDragEnable()},{type:"title",label:"圆柱/圆锥"},{type:"hline"},{type:"cesiumPosition",label:"位置",name:"position",minusLngLatStepLen:1,plusLngLatStepLen:2,minusHeightStepLen:2e3,plusHeightStepLen:3e3,data:e.getPosition()},{type:"hline"},{type:"inputTypeNum",label:"顶部半径",name:"topRadius",value:e.getTopRadius()},{type:"inputTypeNum",label:"底部半径",name:"bottomRadius",value:e.getBottomRadius()},{type:"inputTypeNum",label:"拉伸高度",name:"length",value:e.getLength()},{type:"hline"},{type:"checkbox",label:"填充",name:"fillFlag",value:e.getFillFlag()},{type:"cesiumColor",label:"颜色",name:"fillColor",data:e.getFillColor()},{type:"hline"},{type:"checkbox",label:"轮廓线",name:"outline",value:e.getOutlineFlag()},{type:"cesiumColor",label:"轮廓线颜色",name:"outlineColor",data:e.getOutlineColor()},{type:"hline"},{type:"cesiumVisibleHeight",name:"visibleHeight",value:e.getVisibleHeight()}),t},CgsCylinder.prototype.save=function(){var e=this;return{type:e.getType(),name:e.getName(),position:e.getPosition(),fillFlag:e.getFillFlag(),fill:e.getFillColor(),outline:e.getOutlineFlag(),outlineColor:e.getOutlineColor(),topRadius:e.getTopRadius(),bottomRadius:e.getBottomRadius(),length:e.getLength()}},CgsCylinder.load=function(e,t){var i=new CgsCylinder(t);e.addFeature(i)};var ClipType={Z:1,ZR:2,X:3,XR:4,Y:5,YR:6};function CgsViewInfo(e){var o;function i(e){"3D"==e&&(o.divItems.eCameraH.style.display="block",o.divItems.eH.style.display="block",o.divItems.eRotate.style.display="none"),"2D"==e&&(o.divItems.eCameraH.style.display="none",o.divItems.eH.style.display="none",o.divItems.eRotate.style.display="block")}e&&(this.map=e,this.divGroup=void 0,this.eleInfo="",this.doms={},this.eLanlotFormat=1,this.eLanlotLastPosition=[],(o=this).createViewDiv(e),CgsSubPub.subscribe("viewpoint",function(e,t,i){o.refreshLonLatCH(e,t,i)}),CgsSubPub.subscribe("zoomchanged",function(){o.refreshLonLatCH(null,o.eLanlotLastPosition,!0),o.showLevel()}),CgsSubPub.subscribe("modechanged",function(e,t){i(t)}),i(e.getMapMode()),e.container.onmousemove=function(e){if(e){var t=navigator.userAgent,i=null;i=-1<t.indexOf("Firefox")?[e.layerX,e.layerY]:[e.offsetX,e.offsetY];for(var s=e.target;s!=e.currentTarget&&null!=s;)i[0]=i[0]+s.offsetLeft,i[1]=i[1]+s.offsetTop,s=s.offsetParent;o.refreshLonLatCH(e,{x:i[0],y:i[1]},!0)}},o.showLevel())}CgsTilesClipPlane=function(e){this.map=e.map.map3D,this.clipTarget=e.tileset.feature3D.tileset,this.enabled=Cesium.defaultValue(e.enabled,!1),this.positions=Cesium.defaultValue(e.positions,void 0),this.type=Cesium.defaultValue(e.type,void 0),this.distance=Cesium.defaultValue(e.distance,0),this.clipOutSide=Cesium.defaultValue(e.clipOutSide,!1),this.edgeWidth=Cesium.defaultValue(e.edgeWidth,0),this.edgeColor=Cesium.defaultValue(Cesium.Color.fromCssColorString(e.edgeColor||""),Cesium.Color.WHITE),this.positions&&this.setPositions(this.positions),this.type&&this.setType(this.type)},CgsTilesClipPlane.prototype.setPositions=function(e){if(!(e.length<2)){var t=[];if(2==e.length){var i=this._createPlaneByLine(e[0],e[1]);i&&t.push(i)}else{var s=void 0,o=CgsUtil.getAngle(e[0],e[1]);s=0!=o&&o<CgsUtil.getAngle(e[0],e[2]),this.clipOutSide&&(s=!s);for(var a=void 0,n=0,r=e.length;n<r;++n){var l=(n+1)%r;(a=s?this._createPlaneByLine(e[l],e[n]):this._createPlaneByLine(e[n],e[l]))&&t.push(a)}}this.setPlanes(t)}},CgsTilesClipPlane.prototype._createPlaneByLine=function(e,t){if(Cesium.Cartesian3.distance(e,t)<.1)return null;var i=void 0,s=this.clipTarget.root.transform,i=s&&s.equals(Cesium.Matrix4.IDENTITY)||!s?Cesium.Transforms.eastNorthUpToFixedFrame(this.clipTarget.boundingSphere.center):Cesium.Matrix4.fromArray(this.clipTarget.root.transform);this.Matrix=Cesium.Matrix4.inverseTransformation(i,new Cesium.Matrix4);var o=this.Matrix,a=Cesium.Matrix4.multiplyByPoint(o,e,new Cesium.Cartesian3(0,0,0)),n=Cesium.Matrix4.multiplyByPoint(o,t,new Cesium.Cartesian3(0,0,0)),r=new Cesium.Cartesian3(0,0,10),l=Cesium.Cartesian3.subtract(n,a,new Cesium.Cartesian3),u=Cesium.Cartesian3.cross(l,r,new Cesium.Cartesian3),u=Cesium.Cartesian3.normalize(u,u),p=Cesium.Plane.fromPointNormal(a,u);return Cesium.ClippingPlane.fromPlane(p)},CgsTilesClipPlane.prototype.setType=function(e){var t=void 0;switch(this.type=e){case ClipType.Z:t=[new Cesium.ClippingPlane(new Cesium.Cartesian3(0,0,1),1)];break;case ClipType.ZR:t=[new Cesium.ClippingPlane(new Cesium.Cartesian3(0,0,-1),1)];break;case ClipType.X:t=[new Cesium.ClippingPlane(new Cesium.Cartesian3(1,0,0),1)];break;case ClipType.XR:t=[new Cesium.ClippingPlane(new Cesium.Cartesian3(-1,0,0),1)];break;case ClipType.Y:t=[new Cesium.ClippingPlane(new Cesium.Cartesian3(0,1,0),1)];break;case ClipType.YR:t=[new Cesium.ClippingPlane(new Cesium.Cartesian3(0,-1,0),1)]}this.setPlanes(t)},CgsTilesClipPlane.prototype.setPlanes=function(e){if(e){var t=new Cesium.ClippingPlaneCollection({planes:e,edgeWidth:Cesium.defaultValue(this.edgeWidth,0),edgeColor:Cesium.defaultValue(this.edgeColor,Cesium.Color.WHITE),unionClippingRegions:Cesium.defaultValue(this.clipOutSide,!1)});if(this.clippingPlanes=t,null!=this.clippingPlanes){if(1==e.length)for(var i=0;i<this.clippingPlanes.length;i++){this.clippingPlanes.get(i).distance=this.distance}return this.clipTarget&&(this.clipTarget.clippingPlanes=t),this.clipTarget}}},CgsTilesClipPlane.prototype.clear=function(){this.positions=null,this.clipOutSide=!1,this.clippingPlanes&&delete this.clippingPlanes,this.enabled&&(this.clipTarget.clippingPlanes.enabled=!1),this.clipTarget.clippingPlanes&&(this.clipTarget.clippingPlanes.removeAll(),this.clipTarget.clippingPlanes=void 0)},CgsRadar=function(e){this.feature3D=new CgsRadar3D(e)},CgsRadar.prototype.getPrimitive=function(){return this.feature3D.getPrimitive()},CgsRadar.prototype.getType=function(){return this.feature3D.getType()},CgsRadar.prototype.getSelfType=function(){return this.feature3D.getSelfType()},CgsRadar.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsRadar.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsRadar.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsRadar.prototype.getMap=function(){return this.feature3D.getMap()},CgsRadar.prototype.getId=function(){return this.feature3D.getId()},CgsRadar.prototype.getSaveFlag=function(){return this.feature3D.getSaveFlag()},CgsRadar.prototype.setSaveFlag=function(e){return this.feature3D.setSaveFlag(e)},CgsRadar.RADAR_TYPE_1="GroundRadar",CgsRadar.RADAR_TYPE_2="SearchRadar",CgsRadar.RADAR_TYPE_3="AirRadar",CgsRadar.RADAR_TYPE_4="SpreadRadar",CgsRadar.RADAR_TYPE_5="AirBorneRadar",CgsRadar.RADAR_TYPE_6="ScanRadar",CgsRadar.RADAR_TYPE_8="cylinderTrans",CgsRadar3D.RADAR_TYPE_5="Cone",CgsRadar.PLANE_RADAR="Cone",CgsRadar.GROUND_RADAR="GroundRadar",CgsRadar.SEARCH_RADAR="SearchRadar",CgsRadar.AIR_RADAR="AirRadar",CgsRadar.SPREAD_RADAR="SpreadRadar",CgsRadar.AIRBORNE_RADAR="AirBorneRadar",CgsRadar.SCAN_RADAR="ScanRadar",CgsRadar.SATELLITE_RADAR="SatelliteRadar",CgsRadar.LAYER_RADAR="LayerRadar",CgsRadar.PLANESCAN_RADAR="PlaneScanRadar",CgsRadar.RO_RADAR="RORadar",CgsRadar.DYNTRANS="cylinderTrans",CgsGroundRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsGroundRadar3D(e)},CgsInherits(CgsGroundRadar,CgsRadar),CgsGroundRadar.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsGroundRadar.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsGroundRadar.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsGroundRadar.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsGroundRadar.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsGroundRadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsGroundRadar.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsGroundRadar.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsGroundRadar.prototype.setMinRadius=function(e){this.feature3D.setMinRadius(e)},CgsGroundRadar.prototype.getMinRadius=function(){return this.feature3D.getMinRadius()},CgsGroundRadar.prototype.setMaxRadius=function(e){this.feature3D.setMaxRadius(e)},CgsGroundRadar.prototype.getMaxRadius=function(){return this.feature3D.getMaxRadius()},CgsGroundRadar.prototype.start=function(e){return this.feature3D.start(e)},CgsGroundRadar.prototype.stop=function(){this.feature3D.stop()},CgsGroundRadar.prototype.save=function(){return{type:this.getSelfType(),position:this.getPosition(),radius:this.getRadius(),color:this.getColor(),speed:this.getSpeed(),show:this.getVisible(),minRadius:this.getMinRadius(),maxRadius:this.getMaxRadius()}},CgsGroundRadar.load=function(e,t){var i=new CgsGroundRadar(t);e.addFeature(i)},CgsSearchRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsSearchRadar3D(e)},CgsInherits(CgsSearchRadar,CgsRadar),CgsSearchRadar.prototype._update=function(){this.feature3D._update()},CgsSearchRadar.prototype.setPosition=function(e){this.feature3D.setPosition(e)},CgsSearchRadar.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsSearchRadar.prototype.setAngle=function(e){this.feature3D.setAngle(e)},CgsSearchRadar.prototype.getAngle=function(){return this.feature3D.getAngle()},CgsSearchRadar.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsSearchRadar.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsSearchRadar.prototype.setDistance=function(e){this.feature3D.setDistance(e)},CgsSearchRadar.prototype.getDistance=function(){return this.feature3D.getDistance()},CgsSearchRadar.prototype.setScale=function(e){this.feature3D.setScale(e)},CgsSearchRadar.prototype.getScale=function(){return this.feature3D.getScale()},CgsSearchRadar.prototype.setHeading=function(e){this.feature3D.setHeading(e)},CgsSearchRadar.prototype.getHeading=function(){return this.feature3D.getHeading()},CgsSearchRadar.prototype.setPitch=function(e){this.feature3D.setPitch(e)},CgsSearchRadar.prototype.getPitch=function(){return this.feature3D.getPitch()},CgsSearchRadar.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsSearchRadar.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsSearchRadar.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsSearchRadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsSearchRadar.prototype.start=function(){this.feature3D.start()},CgsSearchRadar.prototype.stop=function(){this.feature3D.stop()},CgsSearchRadar.prototype._updateGeometry=function(){this.feature3D._updateGeometry()},CgsSearchRadar.prototype.save=function(){var e=this;return{type:e.getSelfType(),position:e.getPosition(),radius:e.getRadius(),color:e.getColor(),speed:e.getSpeed(),show:e.getVisible(),angle:e.getAngle(),distance:e.getDistance(),scale:e.getScale(),heading:e.getHeading(),pitch:e.getPitch()}},CgsSearchRadar.load=function(e,t){var i=new CgsSearchRadar(t);e.addFeature(i)},CgsAirRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsAirRadar3D(e)},CgsInherits(CgsAirRadar,CgsRadar),CgsAirRadar.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsAirRadar.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsAirRadar.prototype.setWaveWidth=function(e){this.feature3D.setWaveWidth(e)},CgsAirRadar.prototype.getWaveWidth=function(){return this.feature3D.getWaveWidth()},CgsAirRadar.prototype.setAngle=function(e){this.feature3D.setAngle(e)},CgsAirRadar.prototype.getAngle=function(){return this.feature3D.getAngle()},CgsAirRadar.prototype.setLength=function(e){this.feature3D.setLength(e)},CgsAirRadar.prototype.getLength=function(){return this.feature3D.getLength()},CgsAirRadar.prototype.setScale=function(e){this.feature3D.setScale(e)},CgsAirRadar.prototype.getScale=function(){return this.feature3D.getScale()},CgsAirRadar.prototype.setHeading=function(e){this.feature3D.setHeading(e)},CgsAirRadar.prototype.getHeading=function(){return this.feature3D.getHeading()},CgsAirRadar.prototype.setPitch=function(e){this.feature3D.setPitch(e)},CgsAirRadar.prototype.getPitch=function(){return this.feature3D.getPitch()},CgsAirRadar.prototype.setRoll=function(e){this.feature3D.setRoll(e)},CgsAirRadar.prototype.getRoll=function(){return this.feature3D.getRoll()},CgsAirRadar.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsAirRadar.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsAirRadar.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsAirRadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsAirRadar.prototype.setWaveColor=function(e){this.feature3D.setWaveColor(e)},CgsAirRadar.prototype.getWaveColor=function(){return this.feature3D.getWaveColor()},CgsAirRadar.prototype._updateGeometry=function(){this.feature3D._updateGeometry()},CgsAirRadar.prototype.save=function(){var e=this;return{type:e.getSelfType(),position:e.getPosition(),color:e.getColor(),waveColor:e.getWaveColor(),speed:e.getSpeed(),show:e.getVisible(),angle:e.getAngle(),length:e.getLength(),scale:e.getScale(),heading:e.getHeading(),pitch:e.getPitch(),roll:e.getRoll(),waveWidth:e.getWaveWidth()}},CgsAirRadar.load=function(e,t){var i=new CgsAirRadar(t);e.addFeature(i)},CgsAirborneRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsAirborneRadar3D(e)},CgsInherits(CgsAirborneRadar,CgsRadar),CgsAirborneRadar.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsAirborneRadar.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsAirborneRadar.prototype.removePrimitives=function(){this.feature3D.removePrimitives()},CgsAirborneRadar.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsAirborneRadar.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsAirborneRadar.prototype.setHAngle=function(e){this.feature3D.setHAngle(e)},CgsAirborneRadar.prototype.getHAngle=function(){return this.feature3D.getHAngle()},CgsAirborneRadar.prototype.setVAngle=function(e){this.feature3D.setVAngle(e)},CgsAirborneRadar.prototype.getVAngle=function(){return this.feature3D.getVAngle()},CgsAirborneRadar.prototype.setScale=function(e){this.feature3D.setScale(e)},CgsAirborneRadar.prototype.getScale=function(){return this.feature3D.getScale()},CgsAirborneRadar.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsAirborneRadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsAirborneRadar.prototype.setHeading=function(e){this.feature3D.setHeading(e)},CgsAirborneRadar.prototype.getHeading=function(){return this.feature3D.getHeading()},CgsAirborneRadar.prototype.setPitch=function(e){this.feature3D.setPitch(e)},CgsAirborneRadar.prototype.getPitch=function(){return this.feature3D.getPitch()},CgsAirborneRadar.prototype.setRoll=function(e){this.feature3D.setRoll(e)},CgsAirborneRadar.prototype.getRoll=function(){return this.feature3D.getRoll()},CgsScanRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsScanRadar3D(e)},CgsInherits(CgsScanRadar,CgsRadar),CgsScanRadar.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsScanRadar.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsScanRadar.prototype.removePrimitives=function(){this.feature3D.removePrimitives()},CgsScanRadar.prototype.setIsHorizontal=function(e){this.feature3D.setIsHorizontal(e)},CgsScanRadar.prototype.getIsHorizontal=function(){return this.feature3D.getIsHorizontal()},CgsScanRadar.prototype.setIsVertical=function(e){this.feature3D.setIsVertical(e)},CgsScanRadar.prototype.getIsVertical=function(){return this.feature3D.getIsVertical()},CgsScanRadar.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsScanRadar.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsScanRadar.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsScanRadar.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsScanRadar.prototype.setHAngle=function(e){this.feature3D.setHAngle(e)},CgsScanRadar.prototype.getHAngle=function(){return this.feature3D.getHAngle()},CgsScanRadar.prototype.setVAngle=function(e){this.feature3D.setVAngle(e)},CgsScanRadar.prototype.getVAngle=function(){return this.feature3D.getVAngle()},CgsScanRadar.prototype.setScale=function(e){this.feature3D.setScale(e)},CgsScanRadar.prototype.getScale=function(){return this.feature3D.getScale()},CgsScanRadar.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsScanRadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsScanRadar.prototype.setHeading=function(e){this.feature3D.setHeading(e)},CgsScanRadar.prototype.getHeading=function(){return this.feature3D.getHeading()},CgsScanRadar.prototype.setPitch=function(e){this.feature3D.setPitch(e)},CgsScanRadar.prototype.getPitch=function(){return this.feature3D.getPitch()},CgsScanRadar.prototype.setRoll=function(e){this.feature3D.setRoll(e)},CgsScanRadar.prototype.getRoll=function(){return this.feature3D.getRoll()},CgsDynTransmit=function(e){this._map=void 0,this.feature3D=new CgsDynTransmit3D(e)},CgsDynTransmit.prototype.getMap=function(){return this._map},CgsDynTransmit.prototype.setMap=function(e){this._map=e},CgsDynTransmit.prototype.getPrimitive=function(){return this.feature3D.getPrimitive()},CgsDynTransmit.prototype.setType=function(e){this.feature3D.setType(e)},CgsDynTransmit.prototype.getType=function(){return this.feature3D.getType()},CgsDynTransmit.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsDynTransmit.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsDynTransmit.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsDynTransmit.prototype.getColor=function(){return this.feature3D.getColor()},CgsDynTransmit.prototype.setUpColor=function(e){this.feature3D.setUpColor(e)},CgsDynTransmit.prototype.getUpColor=function(){return this.feature3D.getUpColor()},CgsDynTransmit.prototype.setDownColor=function(e){this.feature3D.setDownColor(e)},CgsDynTransmit.prototype.getDownColor=function(){return this.feature3D.getDownColor()},CgsDynTransmit.prototype.setVertActive=function(e){this.feature3D.setVertActive(e)},CgsDynTransmit.prototype.getVertActive=function(){return this.feature3D.getVertActive()},CgsDynTransmit.prototype.setVertUpdate=function(e){this.feature3D.setVertUpdate(e)},CgsDynTransmit.prototype.getVertUpdate=function(){return this.feature3D.getVertUpdate()},CgsDynTransmit.prototype.setHoriActive=function(e){this.feature3D.setHoriActive(e)},CgsDynTransmit.prototype.getHoriActive=function(){return this.feature3D.getHoriActive()},CgsDynTransmit.prototype.setHoriUpdate=function(e){this.feature3D.setHoriUpdate(e)},CgsDynTransmit.prototype.getHoriUpdate=function(){return this.feature3D.getHoriUpdate()},CgsDynTransmit.prototype.setUpFaceActive=function(e){this.feature3D.setUpFaceActive(e)},CgsDynTransmit.prototype.getUpFaceActive=function(){return this.feature3D.getUpFaceActive()},CgsDynTransmit.prototype.setDownFaceActive=function(e){this.feature3D.setDownFaceActive(e)},CgsDynTransmit.prototype.getDownFaceActive=function(){return this.feature3D.getDownFaceActive()},CgsDynTransmit.prototype.setPositions=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPositions(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsDynTransmit.prototype.getPositions=function(){return this.feature3D.getPositions()},CgsDynTransmit.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsDynTransmit.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsDynTransmit.prototype.setTextureNumVert=function(e){this.feature3D.setTextureNumVert(e)},CgsDynTransmit.prototype.getTextureNumVert=function(){return this.feature3D.getTextureNumVert()},CgsDynTransmit.prototype.setTextureNumHori=function(e){this.feature3D.setTextureNumHori(e)},CgsDynTransmit.prototype.getTextureNumHori=function(){return this.feature3D.getTextureNumHori()},CgsDynTransmit.prototype.setTextureSpeedVert=function(e){this.feature3D.setTextureSpeedVert(e)},CgsDynTransmit.prototype.getTextureSpeedVert=function(){return this.feature3D.getTextureSpeedVert()},CgsDynTransmit.prototype.setTextureSpeedHori=function(e){this.feature3D.setTextureSpeedHori(e)},CgsDynTransmit.prototype.getTextureSpeedHori=function(){return this.feature3D.getTextureSpeedHori()},CgsDynTransmit.prototype.setTextUrlHori=function(e){this.feature3D.setTextUrlHori(e)},CgsDynTransmit.prototype.getTextUrlHori=function(){return this.feature3D.getTextUrlHori()},CgsDynTransmit.prototype.setTextUrlVert=function(e){this.feature3D.setTextUrlVert(e)},CgsDynTransmit.prototype.getTextUrlVert=function(){return this.feature3D.getTextUrlVert()},CgsDynTransmit.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsDynTransmit.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsShadows=function(e){this.map=map.map3D,this.feature3D=new CgsShadows3D(e)},CgsShadows.prototype.getTime=function(){this.feature3D.getTime()},CgsShadows.prototype.setTime=function(e){this.feature3D.setTime(e)},CgsShadows.prototype.getIsStart=function(){return this.feature3D.getIsStart()},CgsShadows.prototype.getMultiplier=function(){return this.feature3D.getMultiplier()},CgsShadows.prototype.setMultiplier=function(e){this.feature3D.setMultiplier(e)},CgsShadows.prototype.enabledHook=function(e){this.map&&this.feature3D.enabledHook(e)},CgsShadows.prototype.mountedHook=function(){},CgsShadows.prototype.addedHook=function(){this.feature3D.addedHook()},CgsShadows.prototype.removedHook=function(){},CgsShadows.prototype.onClockTickHanlder=function(){this.map.clock.shouldAnimate&&this.fire("change")},CgsShadows.prototype.start=function(e,t,i){this.map&&(!e||!t||t<=e||this.feature3D.start(e,t,i))},CgsShadows.prototype.pause=function(){this.map&&(this.map.clock.shouldAnimate=!1)},CgsShadows.prototype.proceed=function(){this.map&&(this.map.clock.shouldAnimate=!0)},CgsShadows.prototype.stop=function(){this.map&&(this.map.clock.shouldAnimate=!1)},CgsShadows.prototype.clear=function(){this.feature3D.clear()},CgsSkyLine=function(e){this._map=map.map3D,this.feature3D=new CgsSkyLine3D(e)},CgsSkyLine.prototype.enabledHook=function(e){this.feature3D._enabledHook(e)},CgsSlope=function(e){this._map=void 0,this.feature3D=new CgsSlope3D(e)},CgsSlope.prototype.getMap=function(){return this._map},CgsSlope.prototype.setMap=function(e){this._map=e},CgsSlope.prototype.setType=function(e){this.feature3D.setType(e)},CgsSlope.prototype.getType=function(){return this.feature3D.getType()},CgsSlope.prototype.setOffsetX=function(e){this.feature3D.setOffsetX(e)},CgsSlope.prototype.getOffsetX=function(){return this.feature3D.getOffsetX()},CgsSlope.prototype.setOffsetZ=function(e){this.feature3D.setOffsetZ(e)},CgsSlope.prototype.getOffsetZ=function(){return this.feature3D.getOffsetZ()},CgsSlope.prototype.getPrimitive=function(){return this.feature3D.getPrimitive()},CgsSlope.prototype.setPosition=function(e){if(CgsUtil.verifyLonLat(e))return this.feature3D.setPosition(e);console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsSlope.prototype.setMaxNum=function(e){return this.feature3D.setMaxNum(e)},CgsSlope.prototype.getMaxNum=function(){return this.feature3D.getMaxNum()},CgsSlope.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsSlope.prototype.getColor=function(){return this.feature3D.getColor()},CgsSlope.prototype.setMinAlpha=function(e){this.feature3D.setMinAlpha(e)},CgsSlope.prototype.getMinAlpha=function(){return this.feature3D.getMinAlpha()},CgsSlope.prototype.setMaxAlpha=function(e){this.feature3D.setMaxAlpha(e)},CgsSlope.prototype.getMaxAlpha=function(){return this.feature3D.getMaxAlpha()},CgsSlope.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsSlope.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsSlope.SLOPE="slope",CgsRibbon=function(e){this._map=void 0,this.feature3D=new CgsRibbon3D(e)},CgsRibbon.prototype.getMap=function(){return this._map},CgsRibbon.prototype.setMap=function(e){this._map=e},CgsRibbon.prototype.getPrimitive=function(){return this.feature3D.getPrimitive()},CgsRibbon.prototype.setType=function(e){this.feature3D.setType(e)},CgsRibbon.prototype.getType=function(){return this.feature3D.getType()},CgsRibbon.prototype.setOffsetX=function(e){this.feature3D.setOffsetX(e)},CgsRibbon.prototype.getOffsetX=function(){return this.feature3D.getOffsetX()},CgsRibbon.prototype.setOffsetY=function(e){this.feature3D.setOffsetY(e)},CgsRibbon.prototype.getOffsetY=function(){return this.feature3D.getOffsetY()},CgsRibbon.prototype.setOffsetZ=function(e){this.feature3D.setOffsetZ(e)},CgsRibbon.prototype.getOffsetZ=function(){return this.feature3D.getOffsetZ()},CgsRibbon.prototype.setWidth=function(e){this.feature3D.setWidth(e)},CgsRibbon.prototype.getWidth=function(){return this.feature3D.getWidth()},CgsRibbon.prototype.getPrimitive=function(){return this.feature3D.getPrimitive()},CgsRibbon.prototype.setPosition=function(e){if(CgsUtil.verifyLonLat(e))return this.feature3D.setPosition(e);console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsRibbon.prototype.setMaxNum=function(e){return this.feature3D.setMaxNum(e)},CgsRibbon.prototype.getMaxNum=function(){return this.feature3D.getMaxNum()},CgsRibbon.prototype.setRotate=function(e){return this.feature3D.setRotate(e)},CgsRibbon.prototype.getRotate=function(){return this.feature3D.getRotate()},CgsRibbon.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsRibbon.prototype.getColor=function(){return this.feature3D.getColor()},CgsRibbon.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsRibbon.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsRibbon.prototype.setMinAlpha=function(e){this.feature3D.setMinAlpha(e)},CgsRibbon.prototype.getMinAlpha=function(){return this.feature3D.getMinAlpha()},CgsRibbon.prototype.setMaxAlpha=function(e){this.feature3D.setMaxAlpha(e)},CgsRibbon.prototype.getMaxAlpha=function(){return this.feature3D.getMaxAlpha()},CgsRibbon.RIBBON="ribbon",CgsGlowFlyLine=function(e){this.feature3D=new CgsGlowFlyLine3D(e)},CgsGlowFlyLine.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsGlowFlyLine.prototype.getMap=function(){return this.feature3D.getMap()},CgsGlowFlyLine.prototype.getType=function(){return this.feature3D.getType()},CgsGlowFlyLine.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsGlowFlyLine.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsGlowFlyLine.prototype.addFlyLine=function(e){this.feature3D.addFlyLine(e)},CgsGlowFlyLine.prototype.getSaveFlag=function(){return this.feature3D.getSaveFlag()},CgsGlowFlyLine.prototype.setSaveFlag=function(e){this.feature3D.setSaveFlag(e)},CgsGlowFlyLine.prototype.save=function(){var e=this;return{positions:e.getPosition(),show:e.getVisible(),color:e.getColor(),height:e.getHeight(),fact:e.getFact(),pointNum:e.getPointNum(),count:e.getCount(),speed:e.getSpeed(),times:e.getTimes(),active:e.getActive(),moveColor:e.getMoveColor(),selfType:e.getSelfType(),type:e.getType()}},CgsGlowFlyLine.load=function(e,t){var i=new CgsGlowFlyLine(t);e.addFeature(i)},CgsLayerRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsLayerRadar3D(e)},CgsInherits(CgsLayerRadar,CgsRadar),CgsLayerRadar.prototype.setLineColor=function(e){this.feature3D.setLineColor(e)},CgsLayerRadar.prototype.getLineColor=function(){return this.feature3D.getLineColor()},CgsLayerRadar.prototype.setScanColor=function(e){this.feature3D.setScanColor(e)},CgsLayerRadar.prototype.getScanColor=function(){return this.feature3D.getScanColor()},CgsLayerRadar.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsLayerRadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsLayerRadar.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsLayerRadar.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsSpreadRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsSpreadRadar3D(e)},CgsInherits(CgsSpreadRadar,CgsRadar),CgsSpreadRadar.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsSpreadRadar.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsSpreadRadar.prototype.setWaveWidth=function(e){this.feature3D.setWaveWidth(e)},CgsSpreadRadar.prototype.getWaveWidth=function(){return this.feature3D.getWaveWidth()},CgsSpreadRadar.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsSpreadRadar.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsSpreadRadar.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsSpreadRadar.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsSpreadRadar.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsSpreadRadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsSpreadRadar.prototype.setWaveColor=function(e){this.feature3D.setWaveColor(e)},CgsSpreadRadar.prototype.getWaveColor=function(){return this.feature3D.getWaveColor()},CgsSpreadRadar.prototype.setAngle=function(e){this.feature3D.setAngle(e)},CgsSpreadRadar.prototype.getAngle=function(){return this.feature3D.getAngle()},CgsSpreadRadar.prototype.setHeading=function(e){this.feature3D.setHeading(e)},CgsSpreadRadar.prototype.getHeading=function(){return this.feature3D.getHeading()},CgsSpreadRadar.prototype.setPitch=function(e){this.feature3D.setPitch(e)},CgsSpreadRadar.prototype.getPitch=function(){return this.feature3D.getPitch()},CgsSpreadRadar.prototype.setRoll=function(e){this.feature3D.setRoll(e)},CgsSpreadRadar.prototype.getRoll=function(){return this.feature3D.getRoll()},CgsSpreadRadar.prototype._updateGeometry=function(){this.feature3D._updateGeometry()},CgsSpreadRadar.prototype.save=function(){return{type:this.getSelfType(),position:this.getPosition(),radius:this.getRadius(),color:this.getColor(),waveColor:this.getWaveColor(),speed:this.getSpeed(),show:this.getVisible(),waveWidth:this.getWaveWidth()}},CgsSpreadRadar.load=function(e,t){var i=new CgsSpreadRadar(t);e.addFeature(i)},CgsPlaneRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsPlaneRadar3D(e)},CgsInherits(CgsPlaneRadar,CgsRadar),CgsPlaneRadar.prototype.setPosition=function(e){this.feature3D.setPosition(e)},CgsPlaneRadar.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsPlaneRadar.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsPlaneRadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsPlaneRadar.prototype.setRingColor=function(e){this.feature3D.setRingColor(e)},CgsPlaneRadar.prototype.getRingColor=function(){return this.feature3D.getRingColor()},CgsPlaneRadar.prototype.setMove=function(e){this.feature3D.setMove(e)},CgsPlaneRadar.prototype.getMove=function(){return this.feature3D.getMove()},CgsPlaneRadar.prototype.setHighLight=function(e){this.feature3D.setHighLight(e)},CgsPlaneRadar.prototype.getHighLight=function(){return this.feature3D.getHighLight()},CgsPlaneRadar.prototype.setHighLightColor=function(e){this.feature3D.setHighLightColor(e)},CgsPlaneRadar.prototype.getHighLightColor=function(){return this.feature3D.getHighLightColor()},CgsPlaneRadar.prototype.setFlash=function(e){this.feature3D.setFlash(e)},CgsPlaneRadar.prototype.getFlash=function(){return this.feature3D.getFlash()},CgsPlaneRadar.prototype.setOutRadius=function(e){this.feature3D.setOutRadius(e)},CgsPlaneRadar.prototype.getOutRadius=function(){return this.feature3D.getOutRadius()},CgsPlaneRadar.prototype.setMiddleRadius=function(e){this.feature3D.setMiddleRadius(e)},CgsPlaneRadar.prototype.getMiddleRadius=function(){return this.feature3D.getMiddleRadius()},CgsPlaneRadar.prototype.setInRadius=function(e){this.feature3D.setInRadius(e)},CgsPlaneRadar.prototype.getInRadius=function(){return this.feature3D.getInRadius()},CgsPlaneRadar.prototype.setMoveInterval=function(e){this.feature3D.setMoveInterval(e)},CgsPlaneRadar.prototype.getMoveInterval=function(){return this.feature3D.getMoveInterval()},CgsPlaneRadar.prototype.setFlashInterval=function(e){this.feature3D.setFlashInterval(e)},CgsPlaneRadar.prototype.getFlashInterval=function(){return this.feature3D.getFlashInterval()},CgsPlaneRadar.prototype.setHighLightInterval=function(e){this.feature3D.setHighLightInterval(e)},CgsPlaneRadar.prototype.getHighLightInterval=function(){return this.feature3D.getHighLightInterval()},CgsPlaneRadar.prototype._updateGeometry=function(){this.feature3D._updateGeometry()},CgsPlaneScanRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsPlaneScanRadar3D(e)},CgsInherits(CgsPlaneScanRadar,CgsRadar),CgsPlaneScanRadar.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsPlaneScanRadar.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsPlaneScanRadar.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsPlaneScanRadar.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsPlaneScanRadar.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsPlaneScanRadar.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsPlaneScanRadar.prototype.setAngle=function(e){this.feature3D.setAngle(e)},CgsPlaneScanRadar.prototype.getAngle=function(){return this.feature3D.getAngle()},CgsPlaneScanRadar.prototype.setWaveColor=function(e){this.feature3D.setWaveColor(e)},CgsPlaneScanRadar.prototype.getWaveColor=function(){return this.feature3D.getWaveColor()},CgsPlaneScanRadar.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsPlaneScanRadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsPlaneScanRadar.prototype.setRing=function(e){this.feature3D.setRing(e)},CgsPlaneScanRadar.prototype.getRing=function(){return this.feature3D.getRing()},CgsPlaneScanRadar.prototype.setWaveVisible=function(e){this.feature3D.setWaveVisible(e)},CgsPlaneScanRadar.prototype.getWaveVisible=function(){return this.feature3D.getWaveVisible()},CgsPlaneScanRadar.prototype.setCrossVisible=function(e){this.feature3D.setCrossVisible(e)},CgsPlaneScanRadar.prototype.getCrossVisible=function(){return this.feature3D.getCrossVisible()},CgsPlaneScanRadar.prototype.setClockwise=function(e){this.feature3D.setClockwise(e)},CgsPlaneScanRadar.prototype.getClockwise=function(){return this.feature3D.getClockwise()},CgsSatelliteRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsSatelliteRadar3D(e)},CgsInherits(CgsSatelliteRadar,CgsRadar),CgsSatelliteRadar.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsSatelliteRadar.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsSatelliteRadar.prototype.setColor=function(e){this.feature3D._primitive&&this.feature3D.setColor(e)},CgsSatelliteRadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsSatelliteRadar.prototype.setPosition=function(e){return this.feature3D._updateGeometry(e)},CgsRORadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsRORadar3D(e)},CgsInherits(CgsRORadar,CgsRadar),CgsRORadar.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsRORadar.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsRORadar.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsRORadar.prototype.getColor=function(){return this.feature3D.getColor()},CgsRORadar.prototype.setFlowerColor=function(e){this.feature3D.setFlowerColor(e)},CgsRORadar.prototype.getFlowerColor=function(){return this.feature3D.getFlowerColor()},CgsRORadar.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsRORadar.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsAnimation=function(e){var t={mapObj:e.mapObj,projection:e.mapObj.map2D.projection,id:e.id};this.obj=new CgsEffect(t)},CgsAnimation.prototype.removeAllEffect=function(){this.obj.map.removeAllEffect(this.obj)},CgsCurve=function(e){var t={CgsEffectObj:e.effectObj.obj,startlonlat:e.startlonlat,endlonlat:e.endlonlat,bdirection:e.bdirection,id:e.id,fillColor:e.fillColor,width:e.width,length:e.length,time:e.time,type:e.type,opacity:e.opacity,clickcall:e.clickcall,mouseover:e.mouseover,mouseout:e.mouseout,fadeTime:e.fadeTime};if(!e.startlonlat||!e.endlonlat)throw Error("参数输入错误");if(e.startlonlat[0]==e.endlonlat[0]&&e.startlonlat[1]==e.endlonlat[1])throw Error("开始结束坐标不能相同");this.map=null,this.feature=new CgsEffectCurve(t),this.saveFlag=CgsUtil.defaultValue(e.saveFlag,!0)},CgsCurve.prototype.getCurveMiddleCoordinate=function(){return this.feature.middleCoordinate},CgsCurve.prototype.getMap=function(){return this.map},CgsCurve.prototype.setMap=function(e){this.map=e},CgsCurve.prototype.getId=function(){return this.feature.id},CgsCurve.prototype.modifyEffect=function(e,t){this.feature.CgsEffectObj.map.modifyEffect(this.feature.CgsEffectObj,this.feature.id,e,t)},CgsCurve.prototype.removeEffect=function(){this.feature.CgsEffectObj.map.removeEffect(this.feature.CgsEffectObj,this.feature.id)},CgsCurve.prototype.setFillColor=function(e){this.feature.CgsEffectObj.map.modifyEffect(this.feature.CgsEffectObj,this.feature.id,"fill",e)},CgsCurve.prototype.setVisible=function(e,t){var i=this.getVisible();this.feature.svg[0][0].style.display=e?"":"none",i!=e&&0!=t&&CgsSubPub.publish("featurevisiblechange",[this])},CgsCurve.prototype.getVisible=function(){return"none"!=this.feature.svg[0][0].style.display},CgsCurve.prototype.getSaveFlag=function(){return this.saveFlag},CgsCurve.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsCurve.prototype.getType=function(){return"CgsCurve"},CgsCurve.prototype.save=function(){var e=this.feature;return{startlonlat:e.startlonlat,endlonlat:e.endlonlat,bdirection:e.bdirection,id:e.id,fillColor:e.fillColor,width:e.width,length:e.length,time:e.time,type:e.type,opacity:e.opacity,fadeTime:e.fadeTime,selfType:"CgsCurve",effectObjId:e.CgsEffectObj.id}},CgsCurve.load=function(e,t){var i=new CgsCurve(t);e.addFeature(i)},CgsEffectManager=function(){this.effectObjects=[],this.stop=!0;var s=this;!function e(){if(!s.stop){s.endTime=(new Date).getTime(),s.delay=s.endTime-s.startTime,s.startTime=s.endTime;for(var t=0;t<s.effectObjects.length;++t){var i=s.effectObjects[t];i.visible?(i.overlay.setVisible(!0),i.ctxBack.drawImage(i.canvas,0,0,i.canvas.width,i.canvas.height),i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height),i.tempRadius+=s.delay*i.delta,s.drawCircle(i.ctx,[i.wh/2,i.wh/2],i.tempRadius,i.radius,i.fillColor),i.ctx.drawImage(i.canvasBack,0,0,i.canvasBack.width,i.canvasBack.height)):i.overlay.setVisible(!1)}}requestAnimationFrame(e)}()},CgsEffectManager.prototype.stopRender=function(){this.stop=!0},CgsEffectManager.prototype.startRender=function(){this.startTime=(new Date).getTime(),this.stop=!1},CgsEffectManager.prototype.drawCircle=function(e,t,i,s,o){e.beginPath(),i%=s,e.arc(t[0],t[1],i,0,2*Math.PI),e.closePath(),e.lineWidth=1,e.strokeStyle=o,e.stroke()},CgsCircleAnimation=function(e){CgsFeature.call(this,e),e&&e.position?(this.position=e.position,e.radius?this.radius=parseInt(e.radius):this.radius=10,e.fillColor?this.fillColor=e.fillColor:this.fillColor="rgba(255, 0, 0, 0.8)",!e.duration||this.duration<=0?this.duration=2e3:this.duration=e.duration,0==e.visible?this.visible=e.visible:this.visible=!0,this.relatePixelPosition=[],this.delta=this.radius/this.duration,this.tempRadius=0,this.wh=2*this.radius,this.canvas=document.createElement("canvas"),this.canvas.id="effect-canvas",this.canvas.width=this.wh,this.canvas.height=this.wh,this.ctx=this.canvas.getContext("2d"),this.lastFrameAlpha=.95,this.ctx.globalAlpha=this.lastFrameAlpha,this.canvasBack=document.createElement("canvas"),this.canvasBack.id="effect-canvasback",this.canvasBack.width=this.wh,this.canvasBack.height=this.wh,this.ctxBack=this.canvasBack.getContext("2d"),this.ctxBack.globalCompositeOperation="copy",this.id=CgsUtil.createGuid(),this.overlay=new CgsOverlay({cloneMode:!1,position:this.position,element:this.canvas,offset:[0,0],positioning:"center-center",stopEvent:!1}),this.clones=[]):console.info("the position of circleanimation is required")},CgsInherits(CgsCircleAnimation,CgsFeature),CgsCircleAnimation.prototype.getId=function(){return this.id},CgsCircleAnimation.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.position=e,this.overlay.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsCircleAnimation.prototype.getPosition=function(){return this.position},CgsCircleAnimation.prototype.setRadius=function(e){this.radius=e,this.delta=this.radius/this.duration;var t=2*e;this.wh=t,this.canvas.width=t,this.canvas.height=t,this.canvasBack.width=t,this.canvasBack.height=t,this.ctx.globalAlpha=this.lastFrameAlpha,this.ctxBack.globalCompositeOperation="copy"},CgsCircleAnimation.prototype.getRadius=function(){return this.radius},CgsCircleAnimation.prototype.setFillColor=function(e){this.fillColor=e},CgsCircleAnimation.prototype.getFillColor=function(){return this.fillColor},CgsCircleAnimation.prototype.setDuration=function(e){this.duration=e,this.delta=this.radius/this.duration},CgsCircleAnimation.prototype.getDuration=function(){return this.duration},CgsCircleAnimation.prototype.setVisible=function(e){this.visible=e},CgsCircleAnimation.prototype.getVisible=function(){return this.visible},CgsCircleAnimation.prototype.setMap=function(e){this.map=e},CgsCircleAnimation.prototype.getMap=function(){return this.map},CgsViewInfo.prototype.refreshLonLatCH=function(e,t,i){var s=this.map;this.eleInfo;if(i){if(!s)return;if(!this.divGroup)return;var o,a,n,r,l,u,p,h,c,g,d,m,f=this.doms.eLanlot,C=this.doms.eCameraH,y=this.doms.eH;1<this.eLanlotFormat?(o=CgsUtil.getStripNumFromMousePosition(s,t,this.eLanlotFormat),f.innerHTML=o):(a=CgsUtil.getLonLatFromMousePosition(s,t,{buildText:!0,middleText:"&nbsp;&nbsp;",format:this.eLanlotFormat}),f.innerHTML=a.text),this.eLanlotLastPosition=t,"3D"==s.mode?(n="",r=s.map3D.getHeight(),l="",Cesium.defined(t)&&(u=new Cesium.Cartesian2(t.x,t.y),(p=s.map3D.camera.pickEllipsoid(u,s.map3D.scene.globe.ellipsoid))?(d=s.map3D.scene.globe.ellipsoid.cartesianToCartographic(p),m=0,l+=(m=(h=s.getTerrain())instanceof CgsTerrain3D||h instanceof CgsTileTerrain3D?(c=s.map3D.camera.getPickRay(u),g=s.map3D.scene.globe.pick(c,s.map3D.scene),Cesium.defined(g)?(d=Cesium.Cartographic.fromCartesian(g)).height:0):Math.abs(d.height))<.1?(m=0).toFixed(2)+"&nbsp m":d.height.toFixed(2)+"&nbsp m",n+=1e3<(r-=m)?(r/=1e3).toFixed(2)+"&nbsp km":r.toFixed(2)+"&nbsp m",C.innerHTML=n):l+=(m=0).toFixed(2)+"&nbsp m"),y.innerHTML=l):this.divItems.eRotate.children[1].children[2].innerHTML=(180*s.map2D.view.getRotation()/Math.PI).toFixed(4)%360+"°"}},CgsViewInfo.prototype.createViewDiv=function(t){t&&(t.viewifo=this);var i=this,e=CGS_SDK_PATH+"assets/image/CgsViewInfo/",s='    <div class="view-point-container">\n        <div class="view-point-item" id="viewinfo-lonlat" style="user-select: none;cursor: pointer;">\n            <div class="bg-img" >\n                <img src="'+e+'bg.png">\n            </div>\n            <div class="view-lb">\n                <div class="lb1">经&#8194;纬&#8194;度</div> <div class="lb-divider"></div><div class="lb2">0°&nbsp;&nbsp;0°</div>\n            </div>\n        </div>\n\n        <div class="view-point-item" id="viewinfo-rotate2D" style="user-select: none;cursor: pointer;">\n            <div class="bg-img" >\n                <img src="'+e+'bg.png">\n            </div>\n            <div class="view-lb">\n                <div class="lb1">旋转角度</div> <div class="lb-divider"></div><div class="lb2">0°</div>\n            </div>\n        </div>\n\n        <div class="view-point-item" id="viewinfo-height-camera">\n            <div class="bg-img" >\n                <img src="'+e+'bg.png">\n            </div>\n            <div class="view-lb">\n                <div class="lb1">相机高度</div> <div class="lb-divider"></div><div class="lb2">200 km</div>\n            </div>\n        </div>\n\n        <div class="view-point-item" id="viewinfo-height-position">\n            <div class="bg-img" >\n                <img src="'+e+'bg.png">\n            </div>\n            <div class="view-lb">\n                <div class="lb1">当前高程</div> <div class="lb-divider"></div><div class="lb2">1200 km</div>\n            </div>\n        </div>\n\n        <div class="view-point-item" id="viewinfo-level">\n            <div class="bg-img" >\n                <img src="'+e+'bg.png">\n            </div>\n            <div class="view-lb">\n                <div class="lb1">当前层级</div> <div class="lb-divider"></div><div class="lb2">13</div>\n            </div>\n        </div>\n\n        <div class="view-point-item" id="viewinfo-time-tianwen">\n            <div class="bg-img" >\n                <img src="'+e+'bg.png">\n            </div>\n            <div class="view-lb">\n                <div class="lb1">天文时间</div> <div class="lb-divider"></div><div class="lb2">2017-08-23 10:50:51</div>\n            </div>\n        </div>\n\n\n\n\n    </div>',o=document.createElement("div");o.style.position="absolute",o.setAttribute("id","viewpointGroupDiv"),o.style.width="auto",o.style.height="auto",o.style.left="22px",o.style.bottom="80px",$$(o).html(s),this.divItems={eLanlot:$$(o).find(".view-point-item")[0],eRotate:$$(o).find("#viewinfo-rotate2D")[0],eCameraH:$$(o).find("#viewinfo-height-camera")[0],eH:$$(o).find("#viewinfo-height-position")[0],eLevel:$$(o).find("#viewinfo-level")[0],eTime1:$$(o).find("#viewinfo-time-tianwen")[0]};var a=$$(o).find(".view-point-item .lb2"),n=a[0],r=a[1],l=a[2],u=a[3],p=a[4],h=a[5];$$($$(o).find("#viewinfo-lonlat")).click(function(){3==i.eLanlotFormat&&(i.eLanlotFormat=-1),i.eLanlotFormat+=1;var e=$$("#viewinfo-lonlat .lb1");i.eLanlotFormat<2&&e.text("经 纬 度"),2==i.eLanlotFormat&&e.text("三度分带"),3==i.eLanlotFormat&&e.text("六度分带"),i.refreshLonLatCH(null,i.eLanlotLastPosition,!0)}),this.doms={eLanlot:n,eCameraH:l,eRotate:r,eH:u,eLevel:p,eTime1:h},o.style.visibility="visible",t.container.appendChild(o);setInterval(function(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,s=e.getDate(),o=e.getHours(),a=e.getMinutes(),n=e.getSeconds(),r="",l="";r+=t+"-",r+=(i<10?"0":"")+i+"-",l+=(o<10?"0":"")+o,l+=(a<10?":0":":")+a;var u="";u+=(r+=(s<10?"0":"")+s)+" "+(l+=(n<10?":0":":")+n);h.innerHTML=u},1e3);this.divGroup=o,i.showLevel=function(){var e=t.getZoom();p.innerHTML=e}},CgsViewInfo.prototype.show=function(){this.divGroup.style.visibility="visible"},CgsViewInfo.prototype.hide=function(){this.divGroup.style.visibility="hidden"},CgsSelectRegion=function(e){e.type?e.type=e.type.toUpperCase():e.type="RECT",this.type=e.type,this.options=e;var t=new CgsStyleStroke2D({color:void 0===e.fill?"rgba(0,153,255,1.0)":e.fill,width:void 0===e.width?1:e.width,lineDash:[e.dash]}),i=new CgsStyleStroke2D({color:void 0===e.fill?"rgba(255,255,255,0.4)":e.fill}),s=null;switch(this.type){case"POLYGON":case"RECT":case"CIRCLE":s={image:null,stroke:t,fill:i,text:null};break;default:return void console.info("the type of drawfeaturebymouse is not surpported")}e.style=new CgsStyle2D(s),this.options.mapObject.threeFlag&&(this.drawfeaturebymouse3D=new CgsDrawFeatureByMouse3D(e)),this.drawfeaturebymouse2D=new CgsDrawFeatureByMouse2D(e),this.selectEndCallback=e.selectEndCallback},CgsSelectRegion.prototype.activate=function(){this.options.mapObject.featureSelect.deactivate();var i=this;this.switchSubId=CgsSubPub.subscribe("modechanged",function(e,t){"3D"==t?(i.drawfeaturebymouse2D.deactivate(),i.drawfeaturebymouse3D.activate()):(i.drawfeaturebymouse3D.deactivate(),i.drawfeaturebymouse2D.activate())}),"3D"==this.options.mapObject.mode?this.drawfeaturebymouse3D.activate():this.drawfeaturebymouse2D.activate();var p=this;this.subscribeId2D=CgsSubPub.subscribe("featuredrawend2d",function(e,t,i){for(var s=t.getGeometry().flatCoordinates,o=[],a=0;a<s.length;a+=2){var n=[];n[0]=s[a],n[1]=s[a+1],n=ol.proj.transform(n,p.options.mapObject.map2D.projection,"EPSG:4326"),o.push(n)}var r=[];switch(p.type){case"POLYGON":case"RECT":r=o;break;case"CIRCLE":var l=ol.proj.transform([s[0],s[1]],p.options.mapObject.map2D.projection,"EPSG:4326"),u=ol.proj.transform([s[2],s[3]],p.options.mapObject.map2D.projection,"EPSG:4326"),r=[l,[new ol.Sphere(CgsUtil.EPSG3857_RADIUS).haversineDistance(l,u),0]]}p.drawfeaturebymouse2D.drawFeatureVL.removeFeature(t),p.selectEndCallback&&p.selectEndCallback(r),CgsSubPub.publish("selectend",[r,p.type])}),this.subscribeId3D=CgsSubPub.subscribe("featureDrawnByMouse",function(e,t,i){var s=t.getPosition(),o=[];switch(p.type){case"POLYGON":o=s;break;case"RECT":o=[s[0],[s[0][0],s[1][1]],s[1],[s[1][0],s[0][1]]];for(var a=t.labelList,n=0;n<a.length;n++)p.options.mapObject.map3D.removeFeature(a[n]);break;case"CIRCLE":for(o=[s,[t.getRadius(),0]],a=t.labelList,n=0;n<a.length;n++)p.options.mapObject.map3D.removeFeature(a[n])}p.options.mapObject.map3D.removeFeature(t),p.selectEndCallback&&p.selectEndCallback(o),CgsSubPub.publish("selectend",[o,p.type])})},CgsSelectRegion.prototype.deactivate=function(){var e=this;setTimeout(function(){e.options.mapObject.featureSelect.activate()},1e3),"3D"==this.options.mapObject.mode?this.drawfeaturebymouse3D.deactivate():setTimeout(function(){e.drawfeaturebymouse2D.deactivate()},50),this.subscribeId3D&&CgsSubPub.unsubscribe(this.subscribeId3D),this.subscribeId2D&&CgsSubPub.unsubscribe(this.subscribeId2D),this.switchSubId&&CgsSubPub.unsubscribe(this.switchSubId)},CgsAerialView=function(e,t){this.divGroup=void 0,this._createViewDiv(e,t)},CgsAerialView.prototype._createViewDiv=function(n,e){var r=!1,l=e;null==l&&(l=240);var u=l/2,t=document.createElement("div");t.style.position="absolute",t.setAttribute("id","aerialViewGroupDiv"),t.style.width=l+"px",t.style.height=u+"px",t.style.right="5px",t.style.bottom="5px",t.style.border="0px solid #6a859c";var i=(CGS_SDK_PATH,0),s=document.createElement("img");s.src=CGS_SDK_PATH+"assets/image/aerialView.png",s.style.width="100%",s.style.height="100%",t.style.zIndex="999999";var p=document.createElement("div");p.style.cssText+="pointer-events:none",p.style.position="absolute",p.setAttribute("id","aerialViewGroupDiv"),p.style.width="60px",p.style.height="60px";var o=n.getCenter(),a=(o[0]/180+1)*l/2,h=(-o[1]/90+1)*u/2;p.style.right=l-a-30+"px",p.style.bottom=u-h-30+"px",p.style.border="0px solid #6a859c";i="url("+CGS_SDK_PATH+"assets/image/aerialMark.png)";p.style.backgroundImage=i,p.style.backgroundRepeat="no-repeat",t.appendChild(s),t.appendChild(p),t.style.visibility="visible",t.onmousedown=function(e){r=!0;var t,i=e.layerX,s=e.layerY,o=180*(2*i/l-1),a=90*-(2*s/u-1);CgsUtil.defined(n)&&(n.map3D?(t=n.map3D.camera.positionCartographic,"2D"==n.mode?(n.flyTo({destination:[o,a],duration:3,completeCallback:function(){}}),setTimeout(function(){r=!1},500)):n.flyTo({destination:[o,a,t.height],duration:3,completeCallback:function(){setTimeout(function(){r=!1},500)}})):n.flyTo({destination:[o,a],duration:3,completeCallback:function(){setTimeout(function(){r=!1},500)}})),p.style.right=l-i-30+"px",p.style.bottom=u-s-30+"px"},CgsSubPub.subscribe("aerialView",function(e){var t,i,s;r||(t=n.getCenter())&&(i=(t[0]/180+1)*l/2,s=(-t[1]/90+1)*u/2,p.style.right=l-i-30+"px",p.style.bottom=u-s-30+"px")}),n.container.appendChild(t),this.divGroup=t},CgsAerialView.prototype.show=function(){this.divGroup.style.visibility="visible"},CgsAerialView.prototype.hide=function(){this.divGroup.style.visibility="hidden"},CgsMobileManager=function(e){this.map=e,this.objs=[];var h=this;this.interval=setInterval(function(){for(var e=0;e<h.objs.length;e++){var t=h.objs[e];t.active&&t.stepForward()}},50),this.visibleModeStatus={},this.subId=CgsSubPub.subscribe("modechanged",function(e,t,i){if(i==h.map)if("3D"==t)for(var s=i.getHeight(),o=0;o<h.objs.length;o++){var a,n=(p=h.objs[o]).model;n&&(a=n.getVisibleHeight());var r,l,u=p.mark;u&&((r=u.getVisibleHeight())instanceof Array&&2<=r.length&&(s<r[0]||s>r[1])&&u.setVisible(!1),a instanceof Array&&1==a.length&&(l=!p.model,p.setFeatureVisible(u,l)))}else for(var p,o=0;o<h.objs.length;o++){(p=h.objs[o]).mark&&(p.mark.realVisibleFlag?p.setFeatureVisible(p.mark,!0):p.setFeatureVisible(p.mark,!1))}})},CgsMobileManager.prototype.addObject=function(e){if(e.manager){if(e.manager==this)return;e.manager.removeObject(e)}this.objs.push(e),e.manager=this},CgsMobileManager.prototype.removeObject=function(e){var t;if(isNaN(e)){for(var i=0;i<this.objs.length;i++)if(this.objs[i].id==e.id){t=i;break}}else t=e;null!=t?(this.objs.splice(t,1),e.manager=null):console.warn("mobileObject is not in Manager!")},CgsMobileManager.prototype.stopUpdate=function(){this.interval&&(clearInterval(this.interval),this.interval=null)},CgsMobileManager.visibleModeType={normal:1,byZoomLv:2},CgsMobileManager.prototype.setVisibleMode=function(e,t){var o,i,s,a,n=this.visibleModeStatus,r=this,l=1,u=2;e===CgsMobileManager.visibleModeType.normal&&(n.evZoomchanged&&CgsSubPub.unsubscribe(n.evZoomchanged),n.evModechanged&&CgsSubPub.unsubscribe(n.evModechanged),n.orginaddObject&&(CgsMobileManager.prototype.addObject=n.orginaddObject,n.orginaddObject=null)),e===CgsMobileManager.visibleModeType.byZoomLv&&(o=function(){a.status===l?_.each(r.objs,function(e){_.attempt(function(){e.model.setVisible(!1),e.partner[0].setVisible(!0)})}):_.each(r.objs,function(e){_.attempt(function(){e.model.setVisible(!0),e.partner[0].setVisible(!1)})})},i=function(e,t){var i=t.getZoom(),s=!1;"3D"===r.map.mode&&(i<a.switchLevel&&a.status===u?(a.status=l,s=!0):i>=a.switchLevel&&a.status===l&&(a.status=u,s=!0),s&&o(a.status))},s=_.assign({sLevel:6},t),a={switchLevel:s.sLevel,status:this.map.getZoom()<s.sLevel?l:u},o(a.status),i(0,r.map),n.evZoomchanged=CgsSubPub.subscribe("zoomchanged",i),n.orginaddObject=CgsMobileManager.prototype.addObject.bind(r),CgsMobileManager.prototype.addObject=function(e){n.orginaddObject(e),_.defer(function(e){_.attempt(function(){e.model.setVisibleHeight(0),e.model.setVisible(!1),e.partner[0].setVisibleHeight(0),e.partner[0].setVisible(!1)}),_.attempt(function(){(a.status===l?e.partner[0]:e.model).setVisible(!0)})},e)},n.evModechanged=CgsSubPub.subscribe("modechanged",function(e,t){"2D"===t?a.status!==l&&(a.status=l,o(a.status)):i(0,r.map)}))};var CgsMobileId=0;CgsMobileObj=function(e){var t,i;if(this.spline=null,this.id=CgsMobileId,CgsMobileId++,this.tempPoints=[],this.tempTimes=[],this.count=0,this.model=e.model,this.partner=e.partner,this.mark=e.mark,this.symbol=e.symbol,this.currentTime=new Date,this.boundingSphere=void 0,this.lastPosition=void 0,this.rotate=[0,0,0],this.contrailMode=e.contrailMode||"nearpath",this.contrailNum=1,this.sommthFly=void 0!==e.sommthFly&&e.sommthFly,this.markRotateWithMobile=!1!==e.markRotateWithMobile,this.sommthFly2D=e.sommthFly2D||!1,this.anticipationTime=null,this.currentPos=null,this.lastPos=null,this.pathPos=[],this.lastPathLength=0,this.lastTime=0,this.intervalTime=0,this.lastPathPosHead=null,this.changeModePos=null,this.expectationPushTime=[],this.hideFlag=[1,1],this.rit=1,this.counts=0,this.alternationTime=50,this.startTime=e.startTime?e.startTime:1e3,this.amortize=e.amortize,this.backTrace=e.backTrace,this.durationCallback=e.durationCallback?e.durationCallback:null,this.sommthHeightFlag=!!e.sommthHeightFlag&&e.sommthHeightFlag,this.scaleDistanceCallBack=null,this.hideModelFlag=e.hideModelFlag,this.contrail=e.contrail,this.contrailMaxNum=e.contrailMaxNum||30,this.templinePos2D=[],this.lineVisible=!1,this.partner=this.partner||[],this.mark)this.mark.mobileObj&&this.mark.mobileObj.dispose(),t=t||this.mark.getMap();else if(this.model)console.warn("A mark is recommanded to create a mobileObj");else if(!this.symbol)return void console.error("mark、model、symbol.There must be at least one");if(this.model?(t=this.model.getMap(),this.model.mobileObj&&this.model.mobileObj.dispose(),(this.model.mobileObj=this).model.realVisibleFlag=this.model.getVisible()):console.warn("A model is recommanded to create a mobileObj!"),this.symbol&&!t&&(t=this.symbol.map),this.map=e.map||t,this.map.mobileManager.addObject(this),this.mark&&(this.mark.mobileObj=this),this.symbol&&(this.symbol.mobileObj=this),this.partner)for(var s=0;s<this.partner.length;s++)this.partner[s].mobileObj&&this.partner[s].mobileObj.dispose(),(this.partner[s].mobileObj=this).partner[s].realVisibleFlag=this.partner[s].getVisible();if(this.map){this.model?(this.model.getMap()!=this.map&&(this.model.getMap()&&this.model.getMap().removeFeature(this.model),this.map.addFeature(this.model)),i=this.model.getPosition()):this.mark?(this.mark.getMap()!=this.map&&(this.mark.getMap()&&this.mark.getMap().removeFeature(this.mark),this.map.addFeature(this.mark)),i=this.mark.getPosition()):this.symbol&&(i=[this.symbol.getPosition()[0].x,this.symbol.getPosition()[0].y]);for(var o,s=0;s<this.partner.length;s++)this.partner[s].getMap()!=this.map&&(this.partner[s]instanceof CgsOverlay?(this.partner[s].getMap()&&this.partner[s].getMap().removeOverlay(this.partner[s]),this.map.addOverlay(this.partner[s])):(this.partner[s].getMap()&&this.partner[s].getMap().removeFeature(this.partner[s]),this.map.addFeature(this.partner[s]))),i&&this.partner[s].setPosition(i);i&&this.mark&&this.mark.setPosition(i),"3D"==this.map.mode?(this.model&&this.model.setVisible(!0),this.mark&&(o=!this.model,this.mark.realVisibleFlag=this.mark.getVisible(),this.setFeatureVisible(this.mark,o))):this.mark&&(this.mark.realVisibleFlag=this.mark.getVisible(),this.setFeatureVisible(this.mark,!0))}this.contrail&&(this.templinePos=[],this.templinePos2D=[],this.templine=new CgsLine({positions:[[0,0],[1,1]],width:1,fillColor:"rgba(255,255,0,1.0)"}),this.map.addFeature(this.templine),this.templine.setVisible(!1),this.lineVisible=!1),this.points=null,this.posProperty=null,this.voProperty=null,this.interval=null,this.totalTime=null,this.completeCallback=null,this.arrPickPoints=[]},CgsMobileObj.prototype.setHideModelFlag=function(e){if(!(this.hideModelFlag=e)&&(this.model&&this.model.getVisible()!=this.model.realVisibleFlag&&this.setFeatureVisible(this.model,this.model.realVisibleFlag),this.partner))for(var t=this.partner.length,i=0;i<t;i++)this.partner[i].getVisible()!=this.partner[i].realVisibleFlag&&this.setFeatureVisible(this.partner[i],this.partner[i].realVisibleFlag)},CgsMobileObj.prototype.getHideModelFlag=function(){return this.hideModelFlag},CgsMobileObj.prototype.pushPoint=function(e,t,i){var s,o=this.map;2==e.length&&e.push(0),this.startFlag?this.startFlag&&(50!=this.alternationTime&&(this.alternationTime=50),o.pushPoint||(o.pushPoint={},o.pushPoint.modelArray=[]),-1==o.pushPoint.modelArray.indexOf(this)&&o.pushPoint.modelArray.push(this),o.pushPoint.Interval||(o.pushPoint.Interval=setInterval(function(){o.pushPoint.level=Math.round(o.getHeight()/3e5)||1;for(var e=0,t=o.pushPoint.modelArray.length;e<t;e++){var i=o.pushPoint.modelArray[e];if(!o.pushPoint.mobileTrack&&i.hideModelFlag&&i.sommthFly&&i.hideModel(),i.sommthFly&&i.active&&0!=i.pathPos.length){if(null==i.model&&null==i.mark){o.pushPoint.modelArray.splice(e,1);break}if(2<i.rit&&"hidden"==document.visibilityState&&(i.pathPos.splice(0,i.pathPos.length-Math.round(i.lastPathLength)),i.rit=1,i.inRotation||0==i.inRotation?i.setRotation(i.inRotation):i.setRotationByPoint(i.pathPos[0],i.pathPos[i.pathPos.length-1],"3D")),i.backTrace||200<i.pathPos.length)for(;(i.counts%i.rit!=0||0==i.counts)&&i.pathPos[0]&&i.pathPos[0].length<=3;)i.pathPos.shift(),i.counts++;i.pushModel("3D"),i.pathPos.shift(),i.counts++,i.counts<20*i.lastPathLength&&i.amortize&&i.pathPos.length<Math.round(i.lastPathLength/2)&&10<i.lastPathLength&&(i.pathPos=i.rebuildPath(i.pathPos))}}0==o.pushPoint.modelArray.length&&(window.clearInterval(o.pushPoint.Interval),o.pushPoint.modelArray=null,o.pushPoint.Interval=null,o.pushPoint=null)},90)),i?this.startTime=i:i=(new Date).getTime()-this.lastTime,s=i/90-1,this.counts=0,this.lastPathLength=s,this.rit=Math.round((this.pathPos.length+s)/s),this.pathPos=this.pathPos.concat(this.inciseAnticipateFlyLine(this.lastPos,e,s,t)),this.lastPos=e):(this.active=!0,this.startFlag=!0,this.lastPos=e,this.lastPathPosHead=e,this.lastPathLength=this.startTime/50,this.lastTime=(new Date).getTime())},CgsMobileObj.prototype.flightPathPlan=function(e){"nearpath"==this.contrailMode?(this.templinePos.push(e),this.templinePos.length>this.contrailMaxNum&&this.templinePos.shift()):"allpath"==this.contrailMode&&(this.templinePos.push(e),2e3<this.templinePos.length&&(this.templinePos.splice(this.contrailNum,1),this.contrailNum++,15<this.contrailNum&&(this.contrailNum=1)))},CgsMobileObj.prototype.hideModel=function(){if("3D"==this.map.mode){var e=this.model?this.model:this.mark,t=new Cesium.BoundingSphere;t.center=Cesium.Cartesian3.fromDegrees(e.getPosition()[0],e.getPosition()[1],e.getPosition()[2]),t.radius=11.02;var i=map.map3D.scene.camera.frustum.computeCullingVolume(this.map.map3D.scene.camera.position,this.map.map3D.scene.camera.direction,this.map.map3D.scene.camera.up).computeVisibility(t);if(-1==i){if(this.model&&this.model.getVisible()&&this.setFeatureVisible(this.model,!1),this.partner)for(var s=this.partner.length,o=0;o<s;o++)this.partner[o].getVisible()&&this.setFeatureVisible(this.partner[o],!1)}else if((1==i||0==i)&&(this.model&&!this.model.getVisible()&&this.model.realVisibleFlag&&this.model.feature3D&&this.setFeatureVisible(this.model,!0),this.partner))for(s=this.partner.length,o=0;o<s;o++)!this.partner[o].getVisible()&&this.partner[o].realVisibleFlag&&this.setFeatureVisible(this.partner[o],!0)}},CgsMobileObj.prototype.setFeatureVisible=function(e,t){e instanceof CgsOverlay&&e.overlay3D&&e.overlay3D.setVisible(t),e.getVisible()!=t&&(e instanceof CgsFlyLine||e instanceof CgsParabola||e instanceof CgsRadar||e instanceof CgsModel||e instanceof CgsExplode||e instanceof CgsLineAnimation||(e.feature2D&&e.feature2D.setVisible(t),e.feature2DHelper&&e.feature2DHelper.setVisible(t)),e.feature3D&&e.feature3D.setVisible(t))},CgsMobileObj.prototype.inciseAnticipateFlyLine=function(e,t,i,s){for(var o=[],i=i,a=0;a<i;a++){var n=(a+1)/i;1<n&&(n=1);var r=[(1-n)*e[0]+n*t[0],(1-n)*e[1]+n*t[1],(e[2]+t[2])/2];o.push(r)}return o[0]&&(o[0].push("head"),o[0].push(this.lastPathPosHead),!s&&0!=s||o[0].push(s)),this.lastPathPosHead=o[o.length-1],o},CgsMobileObj.prototype.rebuildPath=function(e){for(var t=e[0],i=e[e.length-1],s=2*e.length,o=[],a=0;a<s;a++){var n=(a+1)/s;1<n&&(n=1);var r=[(1-n)*t[0]+n*i[0],(1-n)*t[1]+n*i[1],(t[2]+i[2])/2];o.push(r)}return o.push(i),o},CgsMobileObj.prototype.pushModel=function(e){var t,i,s=this.pathPos[0],o=!1;if(s&&(6==this.pathPos[0].length&&"head"==this.pathPos[0][3]&&this.pathPos[0][4]?(this.setRotation(this.pathPos[0][5],0,0),o=!0,this.contrail&&this.flightPathPlan([this.pathPos[0][0],this.pathPos[0][1],this.pathPos[0][2]])):5==this.pathPos[0].length&&"head"==this.pathPos[0][3]&&this.pathPos[0][4]&&(t=this.pathPos[0][4],this.contrail&&this.flightPathPlan(this.pathPos[0]),this.pathPos[0].pop(),this.pathPos[0].pop(),this.setRotationByPoint(t,this.pathPos[0],e),o=!0),4==s.length&&s.pop(),this.counts%this.map.pushPoint.level==0||o||!this.sommthHeightFlag)){if(this.model&&this.model.feature3D&&(this.model.feature3D.setPosition(s),i=this.model.getPosition(),this.model.getMap(),this.map.manipulate.getManipulateType()===CgsManipulate.MANIPULATE_COCKPIT&&i&&this.pathPos[1]&&i[0]!=this.pathPos[1][0]&&i[1]!=this.pathPos[1][1]&&this.setRotationByPoint(this.model.getPosition(),this.pathPos[1],e)),this.contrail&&(this.templinePos.push(this.pathPos[0]),2<this.templinePos.length&&this.templine.feature3D.setPosition(this.templinePos),this.templinePos.pop()),this.partner)for(var a=this.partner.length,n=0;n<a;n++)this.partner[n]instanceof CgsOverlay&&"3D"==this.map.mode?this.partner[n].overlay3D.setPosition(s):this.partner[n]instanceof CgsSlope||this.partner[n]instanceof CgsOverlay||this.partner[n].feature3D.setPosition(s),"all"==e&&(this.partner[n]instanceof CgsOverlay&&"2D"==this.map.mode?this.partner[n].overlay2D.setPosition(s):this.partner[n]instanceof CgsSlope||this.partner[n]instanceof CgsOverlay||this.partner[n].feature2D.setPosition(s));this.mark&&(this.mark.feature3D.setPosition(s),"all"==e&&this.mark.feature2D.setPosition(s)),this.pathPos[1]&&(this.currentPos=this.pathPos[1]),this.setEffectRotation(s),this.durationCallback&&(this.model?this.durationCallback(this.model):this.mark&&this.durationCallback(this.mark)),this.scaleDistanceCallBack&&(this.model?this.scaleDistanceCallBack(this.model):this.mark?this.scaleDistanceCallBack(this.mark):this.symbol&&this.scaleDistanceCallBack(this.symbol))}},CgsMobileObj.prototype.computeTime=function(e){if(0==this.expectationPushTime.length)return this.expectationPushTime.push(e),e;if(1==this.expectationPushTime.length)return this.expectationPushTime.push(e),this.expectationPushTime[1];if(2==this.expectationPushTime.length)return this.expectationPushTime.push(e),t(this.expectationPushTime[0],this.expectationPushTime[1],this.expectationPushTime[2]);if(3==this.expectationPushTime.length)return this.expectationPushTime.shift(),this.expectationPushTime.push(e),t(this.expectationPushTime[0],this.expectationPushTime[1],this.expectationPushTime[2]);function t(e,t,i){var s=0,o=Math.abs(e-t),a=Math.abs(e-i),n=Math.abs(t-i);return o<=a&&o<=n?s=(e+t)/2:n<=a&&n<=o?s=(t+i)/2:a<=n&&a<=o&&(s=(e+i)/2),s}},CgsMobileObj.prototype.setRotation=function(e){if(this.rotate=[-e,0,0],this.model&&this.model.feature3D.setRotation([-e-90,0,0]),this.markRotateWithMobile){for(var t=0;t<this.partner.length;t++)this.partner[t]instanceof CgsMark&&this.partner[t].feature3D.setRotation(-e);this.mark&&this.mark.feature3D.setRotation(e-90)}},CgsMobileObj.prototype.setEffectRotation=function(e){if(this.partner&&"3D"==this.map.mode)for(var t=0;t<this.partner.length;t++)this.partner[t]instanceof CgsRibbon&&this.partner[t].setRotate(this.rotate),this.partner[t]instanceof CgsTailFire&&this.partner[t].setRotate([this.rotate[0]-90,this.rotate[1],this.rotate[2]]),this.partner[t].setPosition(e)},CgsMobileObj.prototype.setPointAndTime=function(e){if(this.model||this.mark||this.symbol){if(2==e.point.length&&e.point.push(0),this.templinePos2D.push(e.point),this.inRotation=void 0===e.rotation?null:e.rotation,this.sommthFly){this.pushPoint(e.point,e.rotation,e.time);var t=null,t=this.model?this.model:this.mark;if((e.rotation||0==e.rotation)&&this.markRotateWithMobile){for(i=0;i<this.partner.length;i++)this.partner[i]instanceof CgsMark&&this.partner[i].feature2D.setRotation(90-e.rotation);this.mark&&this.mark.feature2D&&this.mark.feature2D.setRotation(e.rotation-90)}else e.rotation||this.setRotationByPoint(t.getPosition(),e.point,"2D");if(this.partner)for(i=0;i<this.partner.length;i++)this.partner[i]instanceof CgsOverlay?this.partner[i].overlay2D&&(this.partner[i].overlay2D.setPos(e.point),this.partner[i].overlay2D.render()):this.partner[i]instanceof CgsSlope||!this.partner[i].feature2D||this.partner[i].feature2D.setPosition(e.point);this.model&&this.model.feature2D&&this.model.feature2D.setPosition(e.point),this.mark&&this.mark.feature2D&&this.mark.feature2D.setPosition(e.point)}else{if(e.rotation||0==e.rotation){if(this.rotate=[-e.rotation,0,0],this.model&&this.model.setRotation([-e.rotation-90,0,0]),this.markRotateWithMobile){for(var i=0;i<this.partner.length;i++)this.partner[i]instanceof CgsMark&&this.partner[i].feature3D.setRotation(e.rotation-90);this.mark&&this.mark.feature3D&&this.mark.feature3D.setRotation(e.rotation-90)}this.symbol&&this.symbol.setAngle(-(e.rotation-90))}else this.model?this.setRotationByPoint(this.model.getPosition(),e.point,"all"):this.mark?this.setRotationByPoint(this.mark.getPosition(),e.point,"all"):this.symbol&&this.setRotationByPoint([this.symbol.getPosition()[0].x,this.symbol.getPosition()[0].y],e.point,"all");if(this.contrail&&(this.flightPathPlan(e.point),this.templine.feature3D&&this.templine.feature3D.setPosition(this.templinePos)),this.setEffectRotation(e.point),this.model&&this.model.setPosition(e.point),this.partner)for(var s=this.partner.length,i=0;i<s;i++)this.partner[i]instanceof CgsSlope||this.partner[i].setPosition(e.point);this.mark&&this.mark.setPosition(e.point),this.completeCallback&&this.completeCallback(this.model),this.active=!0,this.startFlag=!0,this.lastPos=e.point,this.lastPathPosHead=e.point,this.lastPathLength=this.startTime/50,this.lastTime=(new Date).getTime(),this.durationCallback&&(this.model?this.durationCallback(this.model):this.mark&&this.durationCallback(this.mark)),this.scaleDistanceCallBack&&(this.model?this.scaleDistanceCallBack(this.model):this.mark&&this.scaleDistanceCallBack(this.mark))}if((e.rotation||0==e.rotation)&&this.markRotateWithMobile){this.rotate=[-e.rotation,0,0];for(i=0;i<this.partner.length;i++)this.partner[i]instanceof CgsMark&&this.partner[i].feature2D.setRotation(e.rotation-90);this.mark&&this.mark.feature2D.setRotation(e.rotation-90)}this.symbol&&this.symbol.setPosition(e.point),this.contrail&&(this.lineVisible||(this.templine.setVisible(!0),this.lineVisible=!0),this.templinePos2D.length>this.contrailMaxNum&&this.templinePos2D.shift(),this.templine.feature2D.setPosition(this.templinePos2D)),this.changeModePos=e.point,this.lastTime=(new Date).getTime(),this.map.mobileManager.switchModeEvent||(this.map.mobileManager.switchModeEvent=CgsSubPub.subscribe(CgsEvent.eModeChanged,function(e,t,i){if("2D"==t)for(var s=i.mobileManager.objs,o=0;o<s.length;o++){var a=s[o].partner;if(a&&0<a.length)for(var n=s[o].changeModePos,r=0;r<a.length;r++)a[r]instanceof CgsOverlay?a[r].overlay2D&&(a[r].overlay2D.setPos(n),a[r].overlay2D.render(),a[r].realVisibleFlag&&a[r].overlay2D.setVisible(!0)):a[r]instanceof CgsSlope||!a[r].feature2D||(a[r].feature2D.setPosition(n),a[r].realVisibleFlag&&s[o].setFeatureVisible(a[r],a[r].realVisibleFlag))}}))}else console.error("model or mark do not exist,can not push point")},CgsMobileObj.prototype.setSommthFly=function(e){if(this.mark||this.model){if(e)this.active=!0,this.pathPos=[],this.counts=0;else{if(this.pathPos&&0<this.pathPos.length){if(this.inRotation){if(this.model&&this.model.setRotation([-this.inRotation-90,0,0]),this.markRotateWithMobile){for(var t=0;t<this.partner.length;t++)this.partner[t]instanceof CgsMark&&this.partner[t].feature3D.setRotation(-this.inRotation);this.mark&&this.mark.setRotation(this.inRotation-90)}this.symbol&&this.symbol.setAngle(-(this.inRotation-90)),this.inRotation=null}else this.model?this.setRotationByPoint(this.model.getPosition(),this.pathPos[this.pathPos.length-1],"3D"):this.mark?this.setRotationByPoint(this.mark.getPosition(),this.pathPos[this.pathPos.length-1],"3D"):this.symbol&&this.setRotationByPoint([this.symbol.getPosition()[0].x,this.symbol.getPosition()[0].y],this.pathPos[this.pathPos.length-1],"3D");if(this.model&&this.model.setPosition(this.pathPos[this.pathPos.length-1]),this.partner)for(var i=this.partner.length,t=0;t<i;t++)this.partner[t].setPosition(this.pathPos[this.pathPos.length-1]);this.mark&&this.mark.setPosition(this.pathPos[this.pathPos.length-1]),this.symbol&&this.symbol.setPosition(this.pathPos[this.pathPos.length-1])}if(this.active=!1,this.tempPoints=[],this.tempTimes=[],this.tmpCount=0,this.count=0,this.model&&this.model.getVisible()!=this.model.realVisibleFlag&&this.setFeatureVisible(this.model,this.model.realVisibleFlag),this.partner)for(i=this.partner.length,t=0;t<i;t++)this.partner[t].getVisible()!=this.partner[t].realVisibleFlag&&this.setFeatureVisible(this.partner[t],this.partner[t].realVisibleFlag)}this.sommthFly=e}else console.warn("军标不支持拟合")},CgsMobileObj.prototype.setPoints=function(e){this.points=e},CgsMobileObj.prototype.addPartner=function(e){var t;this.model&&this.model.getMap()&&(t=this.model.getMap()),!t&&this.mark&&this.mark.getMap()&&(t=this.mark.getMap()),!t&&this.symbol&&this.symbol.map&&(t=this.symbol.map),"[object Array]"!=Object.prototype.toString.call(e)&&(e=[e]),this.partner||(this.partner=[]);for(var i=e.length,s=0;s<i;s++){for(var o=!1,a=0;a<this.partner.length;a++)if(this.partner[a]==e[s]){o=!0;break}o||(e[s].getMap()!=t&&(e[s].getMap()&&e[s].getMap().removeFeature(e[s]),t&&(e[s]instanceof CgsOverlay&&t.addOverlay(e[s]),(e[s]instanceof CgsMark||e[s]instanceof CgsSlope||e[s]instanceof CgsRibbon||e[s]instanceof CgsTailFire)&&t.addFeature(e[s]))),this.partner.push(e[s]),e[s].mobileObj=this,e[s].realVisibleFlag=e[s].getVisible())}},CgsMobileObj.prototype.removePartner=function(e){var t,i=this.partner.length;if(isNaN(e)){for(var s=!1,o=0;o<i;o++)if(this.partner[o]==e){s=!0,t=o;break}if(!s)return void console.error("partner is not exist in this MobileObj")}else{if(i<=(t=e))return void console.error("partner's index is out of number");e=this.partner[t]}e.getMap()&&(e instanceof CgsOverlay&&e.getMap().removeOverlay(e),e instanceof CgsMark&&e.getMap().removeFeature(e),(e instanceof CgsSlope||e instanceof CgsRibbon||e instanceof CgsTailFire)&&this.model.getMap().removeFeature(e)),this.partner.splice(t,1)},CgsMobileObj.prototype.start=function(e){this.totalTime=e.totalTime,this.completeCallback=e.completeCallback,this.completeCallbackArgs=e.completeCallbackArgs,this.durationCallback=e.durationCallback,this.durationCallbackArgs=e.durationCallbackArgs;"3D"==this.map.mode&&this.setRotationByPoint(this.points[0],this.points[1],"3D");var t=this.totalTime/50;if(t<1){if(this.active=!1,this.model.feature3D.setPosition(this.points[1]),this.partner)for(var i=this.partner.length,s=0;s<i;s++)this.partner[s].setPosition(this.points[1]);this.mark&&this.mark.feature3D.setPosition(this.points[1]),this.completeCallback&&this.completeCallback(this.model)}else{this.arrPickPoints=[];for(s=0;s<t;s++){var o=(s+1)/t;1<o&&(o=1);var a=[(1-o)*this.points[0][0]+o*this.points[1][0],(1-o)*this.points[0][1]+o*this.points[1][1],(1-o)*this.points[0][2]+o*this.points[1][2]];this.arrPickPoints.push(a)}this.active=!0,this.tmpCount=0,this.tmpTotal=t-1}},CgsMobileObj.prototype.hidePath=function(){this.contrail=!1,this.templine.setVisible(!1)},CgsMobileObj.prototype.showPath=function(){this.contrail=!0,this.templine.setVisible(!0)},CgsMobileObj.prototype.getPathVisibleFlag=function(){return this.templine.getVisible()},CgsMobileObj.prototype.getPartner=function(){return this.partner},CgsMobileObj.prototype.stepForward=function(){var e=this.arrPickPoints[this.tmpCount];if(null!=e){if(this.model&&this.model.feature3D.setPosition(e),this.partner&&"3D"==this.map.mode)for(var t,i=this.partner.length,s=0;s<i;s++){this.partner[s]instanceof CgsRibbon&&this.partner[s].setRotate(this.rotate),this.partner[s]instanceof CgsTailFire&&this.partner[s].setRotate([this.rotate[0]-90,this.rotate[1],this.rotate[2]]),this.partner[s]instanceof CgsSlope?(t=this.getOffsetPosition(this.partner[s],e),this.partner[s].setPosition(t)):this.partner[s].setPosition(e)}this.mark&&this.mark.feature3D.setPosition(e),this.tmpCount<this.tmpTotal?this.durationCallback&&this.durationCallback(this.completeCallbackArgs):(this.active=!1,this.completeCallback&&this.completeCallback(this.completeCallbackArgs)),this.tmpCount++}},CgsMobileObj.prototype.stop=function(){this.active=!1},CgsMobileObj.prototype.setRotationByPoint=function(e,t,i){if(i=i||"3D",2!=window.WGMODEFLAG){var s=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),o=Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]),a=Cesium.Cartesian3.distance(s,o);if(0==a)return;var n=Math.asin((t[1]-e[1])/Math.sqrt((e[0]-t[0])*(e[0]-t[0])*Math.cos(Cesium.Math.toRadians(t[1]))*Math.cos(Cesium.Math.toRadians(t[1]))+(e[1]-t[1])*(e[1]-t[1])));t[0]-e[0]<0&&(n=-n+Math.PI),n=Cesium.Math.toDegrees(n);var r=Math.asin((t[2]-e[2])/a),r=Cesium.Math.toDegrees(r);this.rotate=[-n,r,0]}else{this.rotate=[-CgsUtil.azimuthMeasure(e,t),r,0];n=90-CgsUtil.azimuthMeasure(e,t)}if(("3D"==i||"all"==i)&&(this.model&&this.model.feature3D&&this.model.feature3D.setRotation([-n-90,r,0]),this.markRotateWithMobile)){for(var l=0;l<this.partner.length;l++)this.partner[l].feature3D&&this.partner[l]instanceof CgsMark&&this.partner[l].feature3D.setRotation(270-n);this.mark&&this.mark.feature3D&&this.mark.feature3D.setRotation(270-n)}if(("2D"==i||"all"==i)&&this.markRotateWithMobile){for(l=0;l<this.partner.length;l++)this.partner[l].feature2D&&this.partner[l]instanceof CgsMark&&this.partner[l].feature2D.setRotation(90-CgsUtil.azimuthMeasure(e,t));this.mark&&this.mark.feature2D&&this.mark.feature2D.setRotation(90-CgsUtil.azimuthMeasure(e,t))}this.symbol&&this.symbol.setAngle(-(n-90))},CgsMobileObj.prototype.track=function(){if(this.model){if(this.model.getMap()){for(var e=0;e<map.mobileManager.objs.length;e++)map.mobileManager.objs[e].model&&(this.setFeatureVisible(map.mobileManager.objs[e].model,!0),map.mobileManager.objs[e].model.feature3D.mobileTrack=!0);this.map.pushPoint&&(this.map.pushPoint.mobileTrack=!0),this.model.feature3D.getMap().trackedEntity=this.model.getEntity()}}else console.warn("无模型，无法跟随")},CgsMobileObj.prototype.unTrack=function(){if(this.model){if(this.model.getMap()&&this.model.feature3D.getMap().trackedEntity==this.model.feature3D.getEntity()){for(var e=0;e<map.mobileManager.objs.length;e++){var t=map.mobileManager.objs[e];if(t.model&&(t.model.feature3D.mobileTrack=!1,t.model.getVisible()!=t.model.realVisibleFlag&&t.setFeatureVisible(t.model,t.model.realVisibleFlag)),t.partner)for(var i=t.partner.length,s=0;s<i;s++){var o=t.partner[s];o.getVisible()!=o.realVisibleFlag&&t.setFeatureVisible(o,o.realVisibleFlag)}}this.map.pushPoint&&(this.map.pushPoint.mobileTrack=!1),this.model.feature3D.getMap().trackedEntity=null}}else console.warn("无模型，无法跟随")},CgsMobileObj.prototype.dispose=function(){this.model&&this.model.getMap()&&this.model.feature3D.getMap()&&this.model.feature3D.getMap().trackedEntity==this.model.getEntity()&&this.unTrack(),this.interval&&(this.arrPickPoints=null,clearInterval(this.interval),this.interval=null),!this.map&&this.model?this.map=this.model.map:!this.map&&this.mark&&(this.map=this.mark.map);var e=this.map;if(this.model&&(e&&e.removeFeature(this.model),this.model.mobileObj=null,this.model=null),this.lineEntity&&e&&e.removeFeature(this.lineEntity),this.templine&&e&&e.removeFeature(this.templine),this.symbol&&e&&e.removeSymbol(this.symbol),this.mark&&e&&e.removeFeature(this.mark),this.partner)for(var t=this.partner.length-1;0<=t;t--)this.partner[t]&&(e&&(this.partner[t]instanceof CgsOverlay?e.removeOverlay(this.partner[t]):e.removeFeature(this.partner[t])),this.partner[t].mobileObj=null);this.manager&&this.manager.removeObject(this),e.pushPoint&&e.pushPoint.modelArray&&e.pushPoint.modelArray.splice(e.pushPoint.modelArray.indexOf(this),1)},CgsMobileObj.prototype.getOffsetPosition=function(e,t){var i=new Cesium.BoundingSphere,s=this.model.feature3D.getEntity();if(null!=s){if(this.map.map3D.dataSourceDisplay.getBoundingSphere(s,!1,i),null==this.lastPosition)return this.lastPosition=this.model?this.model.getPosition():this.mark.getPosition(),t;if(null==this.lastPosition)return this.lastPosition=this.model?this.model.getPosition():this.mark.getPosition(),t;var o=this.lastPosition,a=Cesium.Cartesian3.fromDegrees(o[0],o[1],o[2]),n=this.model?this.model.getPosition():this.mark.getPosition(),r=Cesium.Cartesian3.fromDegrees(n[0],n[1],n[2]);this.lastPosition=this.model?this.model.getPosition():this.mark.getPosition();var l=r.x-a.x,u=r.y-a.y,p=r.z-a.z,h=0;null!=e.getOffsetX()&&(h=e.getOffsetX());var c=Math.sqrt(h*h/(l*l+u*u+p*p)),g=void 0,g=e.getOffsetX()<=0?new Cesium.Cartesian3(r.x-l*c,r.y-u*c,r.z-p*c):new Cesium.Cartesian3(r.x+l*c,r.y+u*c,r.z+p*c),d=Cesium.Cartographic.fromCartesian(g),m=[0,0,0];return m[0]=Cesium.Math.toDegrees(d.longitude),m[1]=Cesium.Math.toDegrees(d.latitude),m[2]=n[2],null!=e.getOffsetZ()&&(m[2]+=e.getOffsetZ()),m}},CgsMobileObj.prototype.setBackTrace=function(e){this.backTrace=e},CgsMobileObj.prototype.getBackTrace=function(){return!!this.backTrace&&this.backTrace},CgsMobileObj.prototype.setAmortize=function(e){this.amortize=e},CgsMobileObj.prototype.getAmortize=function(){return!!this.amortize&&this.amortize},CgsMobileObj.prototype.getContrailLine=function(){return this.templine},CgsMobileObj.prototype.addContrailLine=function(){this.contrail=!0,this.templinePos=[];return this.templine=new CgsLine({positions:[[0,0],[1,1]],width:1,fillColor:"rgba(255,255,0,1.0)"}),this.map.addFeature(this.templine),this.templine.setVisible(!0),this.lineVisible=!1,this.templine},CgsMobileObj.prototype.removeContrailLine=function(){this.contrail=!1,this.lineVisible=!1,this.templinePos=[],this.templinePos2D=[],this.map.removeFeature(this.templine)},CgsMobileObj.prototype.setContrailLineMode=function(e){this.contrailMode=e},CgsMobileObj.prototype.setMarkRotateWithMobile=function(e){this.markRotateWithMobile=e},CgsMobileObj.prototype.getMarkRotateWithMobile=function(){return this.markRotateWithMobile},CgsAnalyze=function(e){this.analyze3D=new CgsAnalyze3D(e),this.analyzeTool3D=new CgsAnalyzeTool3D(e)},CgsAnalyze.prototype.activate=function(){this.analyzeTool3D&&this.analyzeTool3D.activate()},CgsAnalyze.prototype.deactivate=function(){this.analyzeTool3D&&this.analyzeTool3D.deactivate()},CgsAnalyze.prototype.setType=function(e){this.analyzeTool3D&&this.analyzeTool3D.setType(e)},CgsAnalyze.prototype.getType=function(){if(this.analyzeTool3D)return this.analyzeTool3D.getType()},CgsAnalyze.prototype.remove=function(){this.analyze3D&&this.analyze3D.remove(),this.analyzeTool3D&&this.analyzeTool3D.remove()},CgsAnalyze.prototype.computeLineVisible=function(e,t){this.analyze3D&&this.analyze3D.computeLineVisible(e,t)},CgsAnalyze.prototype.computeLineVisibleHide=function(e,t){this.analyze3D&&this.analyze3D.computeLineVisibleHide(e,t)},CgsAnalyze.prototype.computePolygonVisible=function(e,t){this.analyze3D&&this.analyze3D.computePolygonVisible(e,t)},CgsAnalyze.prototype.computeGradient=function(e,t){this.analyze3D&&this.analyze3D.computeGradient(e,t)},CgsAnalyze.prototype.computeGradientHide=function(e,t){if(this.analyze3D)return this.analyze3D.computeGradientHide(e,t)},CgsAnalyze.prototype.computeProfile=function(e){this.analyze3D&&this.analyze3D.computeProfile(e)},CgsAnalyze.prototype.computeFillDig=function(e){this.analyze3D&&this.analyze3D.computeFillDig(e)},CgsAnalyze.prototype.visibilityAnalyze=function(e){this.analyze3D&&this.analyze3D.visibilityAnalyze(e)},CgsAnalyze.prototype.slopeAnalyze=function(e,t,i){this.analyze3D&&this.analyze3D.slopeAnalyze(e,t,i)},CgsAnalyze.prototype.aspectAnalyze=function(e,t,i){this.analyze3D&&this.analyze3D.aspectAnalyze(e,t,i)},CgsAnalyze.prototype.setFillColor=function(e){this.analyze3D&&this.analyze3D.setFillColor(e)},CgsAnalyze.prototype.getFillColor=function(){if(this.analyze3D)return this.analyze3D.getFillColor()},CgsAnalyze.prototype.setGroundColor=function(e){this.analyze3D&&this.analyze3D.setGroundColor(e)},CgsAnalyze.prototype.getGroundColor=function(){if(this.analyze3D)return this.analyze3D.getGroundColor()},CgsAnalyze.prototype.setBaseColor=function(e){this.analyze3D&&this.analyze3D.setBaseColor(e)},CgsAnalyze.prototype.getBaseColor=function(){if(this.analyze3D)return this.analyze3D.getBaseColor()},CgsAnalyze.prototype.setCoverColor=function(e){this.analyze3D&&this.analyze3D.setCoverColor(e)},CgsAnalyze.prototype.getCoverColor=function(){if(this.analyze3D)return this.analyze3D.getCoverColor()},CgsAnalyze.prototype.setLineColor=function(e){this.analyze3D&&this.analyze3D.setLineColor(e)},CgsAnalyze.prototype.getLineColor=function(){if(this.analyze3D)return this.analyze3D.getLineColor()},CgsAnalyze.prototype.setSampleCount=function(e){if(this.analyze3D)return this.analyze3D.setSampleCount(e)},CgsAnalyze.prototype.getSampleCount=function(){if(this.analyze3D)return this.analyze3D.getSampleCount()},CgsAnalyze.prototype.setSampleLength=function(e){if(this.analyze3D)return this.analyze3D.setSampleLength(e)},CgsAnalyze.prototype.getSampleLength=function(){if(this.analyze3D)return this.analyze3D.getSampleLength()},CgsAnalyze.prototype.getVisiblePolygonData=function(e,t,i){this.analyze3D&&this.analyze3D.computePolygonVisibleHide(e,t,i)},CgsAnalyze.prototype.getFillDigData=function(e,t){this.analyze3D&&this.analyze3D.computeFillDigHide(e,t)},CgsAnalyze.prototype.getFloodData=function(e,t){this.analyze3D&&this.analyze3D.computeFloodHide(e,t)},CgsAnalyze.prototype.getProfileData=function(e,t){this.analyze3D&&this.analyze3D.computeProfileHide(e,t)},CgsAnalyze.VISIBLE_LINE="visibleLine",CgsAnalyze.VISIBLE_POLYGON="visiblePolygon",CgsAnalyze.GRADIENT_ANALYZE="gradientAnalyze",CgsAnalyze.PROFILE_ANALYZE="profileAnalyze",CgsAnalyze.FILLDIG_ANALYZE="filldigAnalyze",CgsAnalyze.FLOOD_ANALYZE="floodAnalyze",CgsAnalyze.VISIBILITY_ANALYZE="VisibilityAnalyze",CgsAnalyze.VIEWSHED_ANALYZE="tilesetViewshedAnalyze",CgsAnalyze.SLOPE_ANALYZE="slopeAnalyze",CgsAnalyze.ASPECT_ANALYZE="aspectAnalyze",CgsAnalyze.CIRCLE_POINT_NUM=360,CgsWFSLayer=function(e){e.mapObject&&e.mapObject.map3D?this.layer3D=new CgsWFSLayer3D(e):console.warn("未创建三维地球，初始化CgsWFSLayer失败")},CgsInherits(CgsWFSLayer,CgsLayer),CgsWFSLayer.prototype.setAddToLayerTree=function(e){this.layer3D&&this.layer3D.setAddToLayerTree(e)},CgsWFSLayer.prototype.getAddToLayerTree=function(){if(this.layer3D)return this.layer3D.getAddToLayerTree()},CgsWFSLayer.prototype.getFeatureType=function(){if(this.layer3D)return this.layer3D.getFeatureType()},CgsWFSLayer.prototype.getFont=function(){if(this.layer3D)return this.layer3D.getFont()},CgsWFSLayer.prototype.getLevel=function(){if(this.layer3D)return this.layer3D.getLevel()},CgsWFSLayer.prototype.getColor=function(){if(this.layer3D)return this.layer3D.getColor()},CgsWFSLayer.prototype.getImage=function(){if(this.layer3D)return this.layer3D.getImage()},CgsWFSLayer.prototype.getMinHeight=function(){if(this.layer3D)return this.layer3D.getMinRange()},CgsWFSLayer.prototype.getMaxHeight=function(){if(this.layer3D)return this.layer3D.getMaxRange()},CgsWFSLayer.prototype.save=function(){var e=this;return{type:"WFS",text:e.getText(),featureType:e.getFeatureType(),url:e.getUrl(),visible:e.getVisible(),font:e.getFont(),level:e.getLevel(),minHeight:e.getMinHeight(),maxHeight:e.getMaxHeight(),color:e.getColor(),name:e.getName(),image:e.getImage(),pId:e.getPId(),isAddToLayerTree:e.getAddToLayerTree()}},CgsWFSLayer.load=function(e,t){var i=new CgsWFSLayer(t);e.addLayer(i)},CgsGraticuleLayer=function(e){CgsLayer.call(this,e),e.mapObject&&e.mapObject.map3D&&(this.layer3D=new CgsGraticuleLayer3D(e))},CgsInherits(CgsGraticuleLayer,CgsLayer),CgsGraticuleLayer.prototype.setLabelVisible=function(e){this.layer3D.setLabelVisible(e)},CgsGraticuleLayer.prototype.getLabelVisible=function(){return this.layer3D.getLabelVisible()},CgsGraticuleLayer.prototype.setSpan=function(e){this.layer3D.setSpan(e)},CgsGraticuleLayer.prototype.getSpan=function(){return this.layer3D.getSpan()},CgsGraticuleLayer.prototype.getType=function(){return this.layer3D.getType()},CgsGraticuleLayer.prototype.setLineColor=function(e){this.layer3D.setLineColor(e)},CgsGraticuleLayer.prototype.getLineColor=function(){return this.layer3D.getLineColor()},CgsGraticuleLayer.prototype.setLabelColor=function(e){this.layer3D.setLabelColor(e)},CgsGraticuleLayer.prototype.getLabelColor=function(){return this.layer3D.getLabelColor()},CgsKilometerGrid=function(e){this.feature2D=new CgsKilometerGrid2D(e),2!==window.WGMODEFLAG&&(this.feature3D=new CgsKilometerGrid3D(e))},CgsKilometerGrid.prototype.setMap=function(e){this.feature2D&&this.feature2D.setMap(e?e.map2D:null),this.feature3D&&this.feature3D.setMap(e)},CgsKilometerGrid.prototype.setLineColor=function(e){this.feature3D&&this.feature3D.setLineColor(e),this.feature2D&&this.feature2D.setLineColor(e)},CgsKilometerGrid.prototype.setLineWidth=function(e){this.feature3D&&this.feature3D.setLineWidth(e),this.feature2D&&this.feature2D.setLineWidth(e)},CgsKilometerGrid.prototype.setLabelFillColor=function(e){this.feature3D&&this.feature3D.setLabelFillColor(e),this.feature2D&&this.feature2D.setLabelFillColor(e)},CgsKilometerGrid.prototype.setLabelStroke=function(e){this.feature3D&&this.feature3D.setLabelStroke(e),this.feature2D&&this.feature2D.setLabelStroke(e)},CgsKilometerGrid.prototype.setLabelStrokeWidth=function(e){this.feature3D&&this.feature3D.setLabelStrokeWidth(e),this.feature2D&&this.feature2D.setLabelStrokeWidth(e)},CgsParticleCollection=function(e){this.particleCollection3D=new CgsParticleCollection3D(e)},CgsParticleCollection.prototype.getParticleCollection=function(){return this.particleCollection3D.getParticleCollection()},CgsParticleCollection.prototype.setVisible=function(e){this.particleCollection3D.setVisible(e)},CgsParticleCollection.prototype.getVisible=function(){return this.particleCollection3D.getVisible()},CgsParticleCollection.prototype.setMap=function(e){this.particleCollection3D.setMap(e)},CgsParticleCollection.prototype.getMap=function(){return this.particleCollection3D.getMap()},CgsParticleCollection.prototype.get=function(e){return this.particleCollection3D.get(e)},CgsParticleCollection.prototype.getType=function(){return this.particleCollection3D.getType()},CgsExplode=function(e){CgsParticleCollection.call(this,e),this.feature3D=new CgsExplode3D(e)},CgsInherits(CgsExplode,CgsParticleCollection),CgsExplode.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsExplode.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsExplode.prototype.getRotate=function(e){return this.feature3D.getRotate(e)},CgsExplode.prototype.setTranslation=function(e,t){this.feature3D.setTranslation(e,t)},CgsExplode.prototype.getTranslation=function(e){return this.feature3D.getTranslation(e)},CgsExplode.prototype.setRotation=function(e,t){this.feature3D.setRotation(e,t)},CgsExplode.prototype.getRotation=function(e){return this.feature3D.getRotation(e)},CgsExplode.prototype.setEmitter=function(e,t){this.feature3D.setEmitter(e,t)},CgsExplode.prototype.getEmitter=function(e){return this.feature3D.getEmitter(e)},CgsExplode.prototype.setDimensions=function(e,t){this.feature3D.setDimensions(e,t)},CgsExplode.prototype.getDimensions=function(e){return this.feature3D.getDimensions(e)},CgsExplode.prototype.setAngle=function(e,t){this.feature3D.setAngle(e,t)},CgsExplode.prototype.getAngle=function(e){return this.feature3D.getAngle(e)},CgsExplode.prototype.setRadius=function(e,t){this.feature3D.setRadius(e,t)},CgsExplode.prototype.getRadius=function(e){return this.feature3D.getRadius(e)},CgsExplode.prototype.setStartColor=function(e,t){this.feature3D.setStartColor(e,t)},CgsExplode.prototype.getStartColor=function(e){return this.feature3D.getStartColor(e)},CgsExplode.prototype.setEndColor=function(e,t){this.feature3D.setEndColor(e,t)},CgsExplode.prototype.getEndColor=function(e){return this.feature3D.getEndColor(e)},CgsExplode.prototype.setStartScale=function(e,t){this.feature3D.setStartScale(e,t)},CgsExplode.prototype.getStartScale=function(e){return this.feature3D.getStartScale(e)},CgsExplode.prototype.setEndScale=function(e,t){this.feature3D.setEndScale(e,t)},CgsExplode.prototype.getEndScale=function(e){return this.feature3D.getEndScale(e)},CgsExplode.prototype.setRate=function(e,t){this.feature3D.setRate(e,t)},CgsExplode.prototype.getRate=function(e){return this.feature3D.getRate(e)},CgsExplode.prototype.getLoop=function(e){return this.feature3D.getLoop(e)},CgsExplode.prototype.getSpeed=function(e){return this.feature3D.getSpeed(e)},CgsExplode.prototype.setMinSpeed=function(e,t){this.feature3D.setMinSpeed(e,t)},CgsExplode.prototype.getMinSpeed=function(e){return this.feature3D.getMinSpeed(e)},CgsExplode.prototype.setMaxSpeed=function(e,t){this.feature3D.setMaxSpeed(e,t)},CgsExplode.prototype.getMaxSpeed=function(e){return this.feature3D.getMaxSpeed(e)},CgsExplode.prototype.getLife=function(e){return this.feature3D.getLife(e)},CgsExplode.prototype.setMinLife=function(e,t){this.feature3D.setMinLife(e,t)},CgsExplode.prototype.getMinLife=function(e){return this.feature3D.getMinLife(e)},CgsExplode.prototype.setMaxLife=function(e,t){this.feature3D.setMaxLife(e,t)},CgsExplode.prototype.getMaxLife=function(e){return this.feature3D.getMaxLife(e)},CgsExplode.prototype.getMass=function(e){return this.feature3D.getMass(e)},CgsExplode.prototype.setMinMass=function(e,t){this.feature3D.setMinMass(e,t)},CgsExplode.prototype.getMinMass=function(e){return this.feature3D.getMinMass(e)},CgsExplode.prototype.setMaxMass=function(e,t){this.feature3D.setMaxMass(e,t)},CgsExplode.prototype.getMaxMass=function(e){return this.feature3D.getMaxMass(e)},CgsExplode.prototype.getImage=function(e){return this.feature3D.getImage(e)},CgsExplode.prototype.getWidth=function(e){return this.feature3D.getWidth(e)},CgsExplode.prototype.setMinWidth=function(e,t){this.feature3D.setMinWidth(e,t)},CgsExplode.prototype.getMinWidth=function(e){return this.feature3D.getMinWidth(e)},CgsExplode.prototype.setMaxWidth=function(e,t){this.feature3D.setMaxWidth(e,t)},CgsExplode.prototype.getMaxWidth=function(e){return this.feature3D.getMaxWidth(e)},CgsExplode.prototype.getHeight=function(e){return this.feature3D.getHeight(e)},CgsExplode.prototype.setMinHeight=function(e,t){this.feature3D.setMinHeight(e,t)},CgsExplode.prototype.getMinHeight=function(e){return this.feature3D.getMinHeight(e)},CgsExplode.prototype.setMaxHeight=function(e,t){this.feature3D.setMaxHeight(e,t)},CgsExplode.prototype.getMaxHeight=function(e){return this.feature3D.getMaxHeight(e)},CgsExplode.prototype.getLifeTime=function(e){return this.feature3D.getLifeTime(e)},CgsExplode.prototype.setVisibleHeight=function(e,t){this.feature3D.setVisibleHeight(e,t)},CgsExplode.prototype.getVisibleHeight=function(e){return this.feature3D.getVisibleHeight(e)},CgsExplode.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsExplode.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsExplode.prototype.getParticles=function(){return this.feature3D.getParticles()},CgsExplode.prototype.getBursts=function(e){return this.feature3D.getBursts(e)},CgsExplode.prototype.getType=function(e){return this.feature3D.getType(e)},CgsExplode.prototype.getXMin=function(e){return this.feature3D.getXMin(e)},CgsExplode.prototype.getXMax=function(e){return this.feature3D.getXMax(e)},CgsExplode.prototype.getYMin=function(e){return this.feature3D.getYMin(e)},CgsExplode.prototype.getYMax=function(e){return this.feature3D.getYMax(e)},CgsExplode.prototype.getZMin=function(e){return this.feature3D.getZMin(e)},CgsExplode.prototype.getZMax=function(e){return this.feature3D.getZMax(e)},CgsExplode.prototype.getEmitterOffset=function(e){return this.feature3D.getEmitterOffset(e)},CgsExplode.prototype.getMinExplosionSize=function(e){return this.feature3D.getMinExplosionSize(e)},CgsExplode.prototype.getMaxExplosionSize=function(e){return this.feature3D.getMaxExplosionSize(e)},CgsExplode.prototype.getSelfType=function(){return this.feature3D.getSelfType()},CgsExplode.prototype.getSaveFlag=function(){return this.feature3D.getSaveFlag()},CgsExplode.prototype.setSaveFlag=function(e){this.feature3D.setSaveFlag(e)},CgsExplode.prototype.save=function(){for(var e=this,t={position:e.getPosition(),selfType:e.getSelfType(),particles:[]},i=e.getParticles(),s=0;s<i.length;s++){var o={rotate:e.getRotate(s),translation:e.getTranslation(s),rotation:e.getRotation(s),emitter:e.getEmitter(s),startColor:e.getStartColor(s),endColor:e.getEndColor(s),startScale:e.getStartScale(s),endScale:e.getEndScale(s),rate:e.getRate(s),loop:e.getLoop(s),speed:e.getSpeed(s),minSpeed:e.getMinSpeed(s),maxSpeed:e.getMaxSpeed(s),life:e.getLife(s),minLife:e.getMinLife(s),maxLife:e.getMaxLife(s),mass:e.getMass(s),minMass:e.getMinMass(s),maxMass:e.getMaxMass(s),width:e.getWidth(),minWidth:e.getMinWidth(s),maxWidth:e.getMaxWidth(s),height:e.getHeight(s),minHeight:e.getMinHeight(s),maxHeight:e.getMaxHeight(s),lifeTime:e.getLifeTime(s),url:e.getImage(s),radius:e.getRadius(s),angle:e.getAngle(s),dimensions:e.getDimensions(s),visibleDistance:e.getVisibleHeight(s),bursts:e.getBursts(s),type:e.getType(s),xMin:e.getXMin(s),xMax:e.getXMax(s),yMin:e.getYMin(s),yMax:e.getYMax(s),zMin:e.getZMin(s),zMax:e.getZMax(s),emitterOffset:e.getEmitterOffset(s),minExplosionSize:e.getMinExplosionSize(s),maxExplosionSize:e.getMaxExplosionSize(s)};t.particles.push(o)}return t},CgsExplode.load=function(e,t){var i=new CgsExplode(t);e.addFeature(i)},CgsCircleCluster=function(e){this.name=e.name,this.breakFlag=!1,this.center=e.center,this.visibleHeight=e.visibleHeight?e.visibleHeight:3e4,null==e.mark?(this.mark=new CgsMark({name:this.name,url:CGS_SDK_PATH+"assets/image/cluster/clusterMark.png",position:e.center,positioning:"bottom-left"}),this.mark.setFont("12px 微软雅黑"),this.mark.setLabelOffset([0,10])):(this.mark=e.mark,this.name&&this.mark.setName(this.name)),this.map=e.map,this.map.addFeature(this.mark),this.mark.setVisible(!1,!1),(this.mark.cluster=this).radius=e.radius,this.mark.setVisibleHeight(this.visibleHeight),this.rec=[this.center[0]-this.radius,this.center[1]-this.radius,this.center[0]+this.radius,this.center[1]+this.radius],this.overlayElement=$$("<div class='circleClusterOverlay'></div>"),this.linePrototype="<div class='circleClusterLine'><span class='circleClusterIcon'></span>lineText</div>",this.overlay=new CgsOverlay({position:this.mark.getPosition(),element:this.overlayElement.get(0),positioning:"bottom-left",offset:[35,-23]}),this.map.addOverlay(this.overlay),this.overlay.setVisible(!1);var i=this;CgsSubPub.subscribe("featuredoubleclick",function(e,t){t==i.mark&&i.track()}),this.interval=setInterval(function(){i.update()},1e3),CgsSubPub.subscribe("featurevisiblechange",function(e,t){t instanceof CgsMark&&t!=i.mark&&i.include(t.feature3D.pos1)&&(t.clusterShow=t.getVisible(),i.update()),null!=t.clusterShow&&(t.clusterShow=t.getVisible())}),CgsSubPub.subscribe("featureremoved",function(e,t){t instanceof CgsMark&&t!=i.mark&&i.include(t.feature3D.pos1)&&i.update()}),CgsSubPub.subscribe("featureadded",function(e,t){t instanceof CgsMark&&t!=i.mark&&i.include(t.feature3D.pos1)&&i.update()}),CgsSubPub.subscribe("featureclick",function(e,t){t==i.mark&&(i.overlay.getVisible()?i.overlay.setVisible(!1):i.overlay.setVisible(!0))})},CgsCircleCluster.prototype.update=function(){new Date;if(this.map)if(this.map.getHeight()<this.visibleHeight)0==this.breakFlag&&(this.breakUp(),this.breakFlag=!0);else{for(var e=this.map.getAllFeatures(),t=0,i=0;i<e.length;i++){(s=e[i])instanceof CgsMark&&null==s.mobileObj&&s!=this.mark&&(o=s.getPosition(),this.include(o)&&(null==s.clusterShow&&(s.clusterShow=s.feature3D.entity.show),s.clusterShow&&t++))}if(t<=1)this.breakUp();else{this.breakFlag=!1,this.mark.setVisible(!0,!1),this.overlayText="";for(var s,o,a,i=0;i<e.length;i++){(s=e[i])instanceof CgsParabola?this.include(s.feature3D.state.end)&&this.include(s.feature3D.state.start)?(s.clusterStart||(s.clusterStart=s.feature3D.state.start,s.clusterEnd=s.feature3D.state.end,s.clusterShow=s.feature3D.entity.show),s.feature3D.entity.show&&(a=s.clusterShow,s.setVisible(!1,!1),s.feature3D.visibleSetValue=a,s.flyLine&&(a=s.flyLine.clusterShow,s.flyLine.setVisible(!1,!1),s.flyLine.feature3D.visibleSetValue=a))):(this.include(s.feature3D.state.end)&&(s.clusterStart||(s.clusterStart=s.feature3D.state.start,s.clusterEnd=s.feature3D.state.end,s.clusterShow=s.feature3D.entity.show),s.feature3D.state.end!=this.mark.getPosition()&&(s.setEnd(this.mark.getPosition()),s.flyLine&&(s.flyLine.feature3D.poslist=s.feature3D.positions))),this.include(s.feature3D.state.start)&&(s.clusterStart||(s.clusterStart=s.feature3D.state.start,s.clusterEnd=s.feature3D.state.end,s.clusterShow=s.feature3D.entity.show),s.feature3D.state.start!=this.mark.getPosition()&&(s.setStart(this.mark.getPosition()),s.flyLine&&(s.flyLine.feature3D.poslist=s.feature3D.positions)))):s instanceof CgsCurve?this.include(s.feature.endlonlat)&&this.include(s.feature.startlonlat)?(s.clusterStart||(s.clusterStart=s.feature.startlonlat,s.clusterEnd=s.feature.endlonlat,s.clusterShow=s.getVisible()),s.getVisible()&&s.setVisible(!1,!1)):(this.include(s.feature.endlonlat)&&(s.clusterStart||(s.clusterStart=s.feature.startlonlat,s.clusterEnd=s.feature.endlonlat,s.clusterShow=s.getVisible()),s.feature.endlonlat!=this.mark.getPosition()&&(s.feature.endlonlat=this.mark.getPosition())),this.include(s.feature.startlonlat)&&(s.clusterStart||(s.clusterStart=s.feature.startlonlat,s.clusterEnd=s.feature.endlonlat,s.clusterShow=s.getVisible()),s.feature.startlonlat!=this.mark.getPosition()&&(s.feature.startlonlat=this.mark.getPosition()))):s instanceof CgsMark&&s instanceof CgsMark&&null==s.mobileObj&&s!=this.mark&&(o=s.getPosition(),this.include(o)&&(null==s.clusterShow&&(s.clusterShow=s.feature3D.entity.show),null!=s.clusterShow&&(a=s.clusterShow,s.setVisible(!1,!1),s.feature3D.visibleSetValue=a),this.overlayText+=this.linePrototype.replace("lineText",s.getName()))),this.overlayElement.find("div").remove(),this.overlayElement.append($$(this.overlayText))}}new Date}},CgsCircleCluster.prototype.breakUp=function(){if(1!=this.breakFlag){this.mark.setVisible(!1,!1),this.overlay.setVisible(!1);for(var e=this.map.getAllFeatures(),t=0;t<e.length;t++){var i=e[t];i instanceof CgsParabola&&(this.include(i.feature3D.state.start)||this.include(i.feature3D.state.end))&&null!=i.clusterStart&&(i.setStart(i.clusterStart,!0),i.setEnd(i.clusterEnd),i.feature3D.entity.show!=i.clusterShow&&(i.feature3D.entity.show=i.clusterShow,i.flyLine&&i.flyLine.setVisible(i.feature3D.entity.show,!1)),i.flyLine&&(i.flyLine.feature3D.poslist=i.feature3D.positions)),i instanceof CgsCurve&&(this.include(i.feature.startlonlat)||this.include(i.feature.endlonlat))&&null!=i.clusterStart&&(i.feature.startlonlat=i.clusterStart,i.feature.endlonlat=i.clusterEnd,i.getVisible()!=i.clusterShow&&i.setVisible(i.clusterShow,!1)),i instanceof CgsMark&&this.include(i.feature3D.pos1)&&null!=i.clusterShow&&i.feature3D.entity.show!=i.clusterShow&&i.setVisible(i.clusterShow,!1)}this.breakFlag=!0}},CgsCircleCluster.prototype.include=function(e){return this.rec[0]<e[0]&&this.rec[1]<e[1]&&this.rec[2]>e[0]&&this.rec[3]>e[1]},CgsCircleCluster.prototype.track=function(){this.map.flyTo({destination:[this.center[0],this.center[1],.3*this.visibleHeight],noFlyHigher:!0})},Cgs3DTileset=function(e,t,i){this.feature3D=new Cgs3DTileset3D(e,t,i)},Cgs3DTileset.prototype.setMap=function(e){this.feature3D.setMap(e)},Cgs3DTileset.prototype.getMap=function(){return this.feature3D.getMap()},Cgs3DTileset.prototype.getTileset=function(){return this.feature3D.getTileset()},Cgs3DTileset.prototype.getLocateFlag=function(){return this.feature3D.getLocateFlag()},Cgs3DTileset.prototype.getType=function(){return this.feature3D.getType()},Cgs3DTileset.prototype.setSuccessFlag=function(e){this.feature3D.setSuccessFlag(e)},Cgs3DTileset.prototype.getSuccessFlag=function(){return this.feature3D.getSuccessFlag()},Cgs3DTileset.prototype.setVisible=function(e){this.feature3D.setVisible(e)},Cgs3DTileset.prototype.getVisible=function(){return this.feature3D.getVisible()},Cgs3DTileset.prototype.setShadow=function(e){this.feature3D.setShadow(e)},Cgs3DTileset.prototype.getShadow=function(){return this.feature3D.getShadow()},Cgs3DTileset.prototype.setVisibleWire=function(e){this.feature3D.setVisibleWire(e)},Cgs3DTileset.prototype.getVisibleWire=function(){return this.feature3D.getVisibleWire()},Cgs3DTileset.prototype.setVisibleBounding=function(e){this.feature3D.setVisibleBounding(e)},Cgs3DTileset.prototype.getVisibleBounding=function(){return this.feature3D.getVisibleBounding()},Cgs3DTileset.prototype.setSelectColor=function(e){this.feature3D.setSelectColor(e)},Cgs3DTileset.prototype.getSelectColor=function(){return this.feature3D.getSelectColor()},Cgs3DTileset.prototype.setHighlightColor=function(e){this.feature3D.setHighlightColor(e)},Cgs3DTileset.prototype.getHighlightColor=function(){return this.feature3D.getHighlightColor()},Cgs3DTileset.prototype.setEnableSelected=function(e){this.feature3D.setEnableSelected(e)},Cgs3DTileset.prototype.getEnableSelected=function(){return this.feature3D.getEnableSelected()},Cgs3DTileset.prototype.setHeightColor=function(e){this.feature3D.setHeightColor(e)},Cgs3DTileset.prototype.setBaseColor=function(e){this.feature3D.setBaseColor(e)},Cgs3DTileset.prototype.getHeightColor=function(){return this.feature3D.getHeightColor()},Cgs3DTileset.prototype.getPosition=function(){return this.feature3D.getPosition()},Cgs3DTileset.prototype.getOffsetHeight=function(){return this.feature3D.getOffsetHeight()},Cgs3DTileset.prototype.getId=function(){return this.feature3D.getId()},Cgs3DTileset.prototype.getBaseColor=function(){return this.feature3D.getBaseColor()},Cgs3DTileset.prototype.getProxy=function(){return this.feature3D.getProxy()},Cgs3DTileset.prototype.getUrl=function(){return this.feature3D.getUrl()},Cgs3DTileset.prototype.getSelfType=function(){return this.feature3D.getSelfType()},Cgs3DTileset.prototype.getSaveFlag=function(){return this.feature3D.getSaveFlag()},Cgs3DTileset.prototype.setSaveFlag=function(e){this.feature3D.getSaveFlag=e},Cgs3DTileset.prototype.setAttrName=function(e){this.feature3D.setAttrName()},Cgs3DTileset.prototype.setMaximumScreenSpaceError=function(e){this.feature3D.setMaximumScreenSpaceError(e)},Cgs3DTileset.prototype.setImmediatelyLoadDesiredLevelOfDetail=function(e){this.feature3D.setImmediatelyLoadDesiredLevelOfDetail(e)},Cgs3DTileset.prototype.setMaximumMemoryUsage=function(e){this.feature3D.setMaximumMemoryUsage(e)},Cgs3DTileset.prototype.setDynamicScreenSpaceError=function(e){this.feature3D.setDynamicScreenSpaceError(e)},Cgs3DTileset.prototype.setCullWithChildrenBounds=function(e){this.feature3D.setCullWithChildrenBounds(e)},Cgs3DTileset.prototype.setSkipLevelOfDetail=function(e){this.feature3D.setSkipLevelOfDetail(e)},Cgs3DTileset.prototype.setSkipLevels=function(e){this.feature3D.setSkipLevels(e)},Cgs3DTileset.ShadowMode_DISABLED=0,Cgs3DTileset.ShadowMode_ENABLED=1,Cgs3DTileset.ShadowMode_CAST_ONLY=2,Cgs3DTileset.ShadowMode_RECEIVE_ONLY=3,Cgs3DTileset.prototype.save=function(){var e=this;return{url:e.getUrl(),show:e.getVisible(),shadow:e.getShadow(),showWire:e.getVisibleWire(),showBounding:e.getVisibleBounding(),selectColor:e.getSelectColor(),highlightColor:e.getHighlightColor(),locate:e.getLocateFlag(),baseColor:e.getBaseColor(),heightColorTable:e.getHeightColor(),enableSelected:e.getEnableSelected(),offsetHeight:e.getOffsetHeight(),proxy:e.getProxy(),selfType:e.getSelfType(),saveFlag:e.getSaveFlag(),type:e.getType()}},Cgs3DTileset.load=function(e,t){var i=new Cgs3DTileset(t);e.addFeature(i)},Cgs3DTileset.prototype.setZTranslation=function(e){this.feature3D.setZTranslation(e)},Cgs3DTileset.prototype.setAnalyzeStatus=function(e){this.feature3D.setAnalyzeStatus(e)},Cgs3DTileset.prototype.setAnalyzeType=function(e,t){this.feature3D.setAnalyzeType(e,t)},Cgs3DTileset.prototype.setAnalyzeNodeData=function(e){this.feature3D.setAnalyzeNodeData(e)},Cgs3DTilesClipPlane=function(e){this.map=e.map,this.tileset=e.tileset,this.active=Cesium.defaultValue(e.active,!0),this.direction=Cesium.defaultValue(e.direction,"V"),this.modelMatrix=Cesium.defaultValue(e.modelMatrix,Cesium.Matrix4.IDENTITY),this.unionClippingRegions=Cesium.defaultValue(e.unionClippingRegions,!1),this.edgeColor=Cesium.defaultValue(Cesium.Color.fromCssColorString(e.edgeColor||""),Cesium.Color.WHITE),this.edgeWidth=Cesium.defaultValue(e.edgeWidth,0),this.dimensions=Cesium.defaultValue(e.dimensions,[2*Math.PI,2*Math.PI]),this.show=Cesium.defaultValue(e.show,!0),this.fill=Cesium.defaultValue(e.fill,!0),this.material=Cesium.defaultValue(Cesium.Color.fromCssColorString(e.material||""),Cesium.Color.WHITE.withAlpha(.1)),this.outline=Cesium.defaultValue(e.outline,!1),this.outlineColor=Cesium.defaultValue(Cesium.Color.fromCssColorString(e.outlineColor||""),Cesium.Color.WHITE),this.outlineWidth=Cesium.defaultValue(e.outlineWidth,1),this.shadows=Cesium.defaultValue(e.shadows,Cesium.ShadowMode.DISABLED);var o=this,a=o.map.map3D,i=o.map.map3D.scene,n=o.tileset.feature3D.tileset,r=Cesium.defaultValue(e.targetY,0),s=void 0;new Cesium.ScreenSpaceEventHandler(i.canvas).setInputAction(function(e){var t=i.pick(e.position);Cesium.defined(t)&&Cesium.defined(t.id)&&Cesium.defined(t.id.plane)&&((s=t.id.plane).material=o.material.withAlpha(.05),s.outlineColor=Cesium.Color.WHITE,i.screenSpaceCameraController.enableInputs=!1)},Cesium.ScreenSpaceEventType.LEFT_DOWN),new Cesium.ScreenSpaceEventHandler(i.canvas).setInputAction(function(){Cesium.defined(s)&&(s.material=o.material,s.outlineColor=o.outlineColor,s=void 0),i.screenSpaceCameraController.enableInputs=!0},Cesium.ScreenSpaceEventType.LEFT_UP),new Cesium.ScreenSpaceEventHandler(i.canvas).setInputAction(function(e){var t;Cesium.defined(s)&&(t=e.startPosition.y-e.endPosition.y,r+=t)},Cesium.ScreenSpaceEventType.MOUSE_MOVE);var l=new Cesium.ClippingPlaneCollection({planes:[new Cesium.ClippingPlane("V"===o.direction?new Cesium.Cartesian3(0,0,-1):new Cesium.Cartesian3(0,1,0),0)],enabled:o.active,modelMatrix:o.modelMatrix,unionClippingRegions:o.unionClippingRegions,edgeColor:o.edgeColor,edgeWidth:o.edgeWidth});n._clippingPlanes=l,n.readyPromise.then(function(){for(var e=n.boundingSphere,t=e.radius,i=0;i<l.length;++i){var s=l.get(i);a.entities.add({position:e.center,plane:{plane:new Cesium.CallbackProperty(function(e){return function(){return e.distance=r,e}}(s),!1),dimensions:new Cesium.Cartesian2(t*o.dimensions[0],t*o.dimensions[1]),show:o.show,fill:o.fill,material:o.material,outline:o.outline,outlineColor:o.outlineColor,outlineWidth:o.outlineWidth,shadows:o.shadows}})}})},Cgs3DTilesClipPlane.prototype.setActive=function(e){this.active=e,this.tileset.feature3D.tileset._clippingPlanes.enabled=e},Cgs3DTilesClipPlane.prototype.setEdgeColor=function(e){this.edgeColor=Cesium.Color.fromCssColorString(e),this.tileset.feature3D.tileset._clippingPlanes.edgeColor=Cesium.Color.fromCssColorString(e||"")},Cgs3DTilesClipPlane.prototype.setEdgeWidth=function(e){this.edgeWidth=e,this.tileset.feature3D.tileset._clippingPlanes.edgeWidth=e},Cgs3DTilesClipPlane.prototype.removeAll=function(){map.map3D.entities.removeAll()},CgsModelClipPlane=function(e){var t;this.map=e.map,this.url=Cesium.defaultValue(e.url,""),this.position=Cesium.defaultValue(e.position,Cesium.Cartesian3.fromDegrees(-123.0744619,44.0503706,100)),this.name=Cesium.defaultValue(e.name,""),this.description=Cesium.defaultValue(e.description,""),this.show=Cesium.defaultValue(e.show,!0),this.scale=Cesium.defaultValue(e.scale,1),this.minimumPixelSize=Cesium.defaultValue(e.minimumPixelSize,0),this.maximumScale=Cesium.defaultValue(e.maximumScale,100),this.silhouetteColor=Cesium.defaultValue(Cesium.Color.fromCssColorString(e.silhouetteColor||""),Cesium.Color.RED),this.silhouetteSize=Cesium.defaultValue(e.silhouetteSize,0),this.color=Cesium.defaultValue(Cesium.Color.fromCssColorString(e.color||""),Cesium.Color.WHITE),this.active=Cesium.defaultValue(e.active,!0),this.direction=Cesium.defaultValue(e.direction,"V"),this.modelMatrix=Cesium.defaultValue(e.modelMatrix,Cesium.Matrix4.IDENTITY),this.unionClippingRegions=Cesium.defaultValue(e.unionClippingRegions,!1),this.edgeColor=Cesium.defaultValue(Cesium.Color.fromCssColorString(e.edgeColor||""),Cesium.Color.WHITE),this.edgeWidth=Cesium.defaultValue(e.edgeWidth,0),this.dimensions=Cesium.defaultValue(e.dimensions,[10,10]),this.show=Cesium.defaultValue(e.show,!0),this.fill=Cesium.defaultValue(e.fill,!0),this.material=Cesium.defaultValue(Cesium.Color.fromCssColorString(e.material||""),Cesium.Color.WHITE.withAlpha(.1)),this.outline=Cesium.defaultValue(e.outline,!1),this.outlineColor=Cesium.defaultValue(Cesium.Color.fromCssColorString(e.outlineColor||""),Cesium.Color.WHITE),this.outlineWidth=Cesium.defaultValue(e.outlineWidth,1),this.shadows=Cesium.defaultValue(e.shadows,Cesium.ShadowMode.DISABLED);var i=this,s=this.map.map3D,o=i.map.map3D.scene;this.targetY=Cesium.defaultValue(e.targetY,0);var a=void 0;new Cesium.ScreenSpaceEventHandler(o.canvas).setInputAction(function(e){var t=o.pick(e.position);Cesium.defined(t)&&Cesium.defined(t.id)&&Cesium.defined(t.id.plane)&&((a=t.id.plane).material=Cesium.Color.WHITE.withAlpha(.05),a.outlineColor=Cesium.Color.WHITE,o.screenSpaceCameraController.enableInputs=!1)},Cesium.ScreenSpaceEventType.LEFT_DOWN),new Cesium.ScreenSpaceEventHandler(o.canvas).setInputAction(function(){Cesium.defined(a)&&(a.material=Cesium.Color.WHITE.withAlpha(.1),a.outlineColor=Cesium.Color.WHITE,a=void 0),o.screenSpaceCameraController.enableInputs=!0},Cesium.ScreenSpaceEventType.LEFT_UP),new Cesium.ScreenSpaceEventHandler(o.canvas).setInputAction(function(e){var t;Cesium.defined(a)&&(t=e.startPosition.y-e.endPosition.y,i.targetY+=t)},Cesium.ScreenSpaceEventType.MOUSE_MOVE);var n=new Cesium.ClippingPlaneCollection({planes:[new Cesium.ClippingPlane("V"===i.direction?new Cesium.Cartesian3(0,0,-1):new Cesium.Cartesian3(0,1,0),0)],enabled:i.active,show:i.show,modelMatrix:i.modelMatrix,unionClippingRegions:i.unionClippingRegions,edgeColor:i.edgeColor,edgeWidth:i.edgeWidth}),r=s.entities.add({name:i.url,position:i.position,description:i.description,model:(_defineProperty(t={uri:i.url,name:i.name,show:i.show,scale:i.scale,minimumPixelSize:i.minimumPixelSize,maximumScale:i.maximumScale,silhouetteColor:i.silhouetteColor,silhouetteSize:i.silhouetteSize,color:i.color},"scale",i.scale),_defineProperty(t,"minimumPixelSize",i.minimumPixelSize),_defineProperty(t,"clippingPlanes",n),t)});s.trackedEntity=r;for(var l=0;l<n.length;++l){var u=n.get(l);s.entities.add({position:i.position,plane:{plane:new Cesium.CallbackProperty(function(e){return function(){return e.distance=i.targetY,e}}(u),!1),dimensions:new Cesium.Cartesian2(i.dimensions[0],i.dimensions[1]),show:i.show,fill:i.fill,material:i.material,outline:i.outline,outlineColor:i.outlineColor,outlineWidth:i.outlineWidth,shadows:i.shadows}})}},CgsModelClipPlane.prototype.setTargetY=function(e){this.targetY=e},CgsModelClipPlane.prototype.getTargetY=function(){return this.targetY},CgsModelClipPlane.prototype.removeAll=function(){map.map3D.entities.removeAll()},CgsStream=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){this.saveFlag=CgsUtil.defaultValue(e.saveFlag,!0),this.feature2D=new CgsStream2D(e),e.mapObject.threeFlag&&(this.feature3D=new CgsStream3D(e)),this.type=CgsUtil.defaultValue(e.type,CgsStream.Ocean)}),CgsStream.prototype.setMap=function(e){e?(this.feature2D.setMap(e.map2D),e.map3D&&this.feature3D.setMap(e.map3D),this.map=e):this.map=null},CgsStream.prototype.getMap=function(){return this.map},CgsStream.prototype.setSpeed=function(e){this.feature2D.setSpeed(e),this.feature3D&&this.feature3D.setSpeed(e)},CgsStream.prototype.getSpeed=function(){return this.feature2D.getSpeed()},CgsStream.prototype.setVisible=function(e){this.feature3D&&this.feature3D.setVisible(e),this.feature2D.setVisible(e)},CgsStream.prototype.getVisible=function(){return this.feature2D.getVisible()},CgsStream.prototype.setColor=function(e){this.feature3D&&this.feature3D.setColor(e),this.feature2D.setColor(e)},CgsStream.prototype.getColor=function(){return this.feature2D.getColor()},CgsStream.prototype.getId=function(){return this.feature3D.getId()},CgsStream.prototype.getType=function(){return this.type},CgsStream.prototype.getSelfType=function(){return"CgsStream"},CgsStream.prototype.getUrl=function(){return this.feature2D.getUrl()},CgsStream.prototype.getLineCount=function(){return this.feature2D.getLineCount()},CgsStream.prototype.getBackgroundFlag=function(){return!!this.feature3D&&this.feature3D.getBackgroundFlag()},CgsStream.prototype.setBackgroundFlag=function(e){this.feature3D&&this.feature3D.setBackgroundFlag(e)},CgsStream.prototype.getSaveFlag=function(){return this.saveFlag},CgsStream.prototype.setSaveFlag=function(e){return this.saveFlag=e},CgsStream.prototype.save=function(){return{url:this.getUrl(),show:this.getVisible(),type:this.getType(),speed:this.getSpeed(),lineCount:this.getLineCount(),selfType:this.getSelfType(),color:this.getColor()}},CgsStream.load=function(e,t){t.mapObject=e;var i=new CgsStream(t);e.addFeature(i)},CgsStream.Stream="stream",CgsStream.Ocean="ocean",CgsStream.Air="air",CgsPrecipitation=function(e){this.feature3D=new CgsPrecipitation3D(e)},CgsPrecipitation.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsPrecipitation.prototype.getMap=function(){return this.feature3D.getMap()},CgsPrecipitation.prototype.getPrecipitation=function(){return this.feature3D.getPrecipitation()},CgsPrecipitation.prototype.setDensity=function(e){this.feature3D.setDensity(e)},CgsPrecipitation.prototype.getDensity=function(){return this.feature3D.getDensity()},CgsPrecipitation.prototype.setVisibleHeight=function(e){this.feature3D.setVisibleHeight(e)},CgsPrecipitation.prototype.getVisibleHeight=function(){return this.feature3D.getVisibleHeight()},CgsPrecipitation.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsPrecipitation.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsPrecipitation.prototype.getId=function(){return this.feature3D.getId()},CgsPrecipitation.prototype.getSelfType=function(){return this.feature3D.getSelfType()},CgsPrecipitation.prototype.getType=function(){return this.feature3D.getType()},CgsPrecipitation.prototype.getSaveFlag=function(){return this.feature3D.getSaveFlag()},CgsPrecipitation.prototype.setSaveFlag=function(e){this.feature3D.setSaveFlag(e)},CgsPrecipitation.Snow="snow",CgsPrecipitation.Rain="rain",CgsPrecipitation.prototype.save=function(){return{show:this.getVisible(),type:this.getType(),density:this.getDensity(),visibleHeight:this.getVisibleHeight(),selfType:this.getSelfType()}},CgsPrecipitation.load=function(e,t){var i=new CgsPrecipitation(t);e.addFeature(i)},CgsStreamLine=function(e){this.feature3D=new CgsStreamLine3D(e)},CgsStreamLine.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsStreamLine.prototype.getMap=function(){return this.feature3D.getMap()},CgsStreamLine.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsStreamLine.prototype.getType=function(){return this.feature3D.getType()},CgsStreamLine.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsStreamLine.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsStreamLine.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsStreamLine.prototype.getColor=function(){return this.feature3D.getColor()},CgsStreamLine.prototype.setMoveColor=function(e){this.feature3D.setMoveColor(e)},CgsStreamLine.prototype.getMoveColor=function(){return this.feature3D.getMoveColor()},CgsStreamLine.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsStreamLine.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsStreamLine.prototype.setTimes=function(e){this.feature3D.setTimes(e)},CgsStreamLine.prototype.getTimes=function(){return this.feature3D.getTimes()},CgsStreamLine.prototype.activate=function(){this.feature3D.activate()},CgsStreamLine.prototype.deactivate=function(){this.feature3D.deactivate()},CgsStreamLine.prototype.getSelfType=function(){return this.feature3D.getSelfType()},CgsStreamLine.prototype.getHeight=function(){return this.feature3D.getHeight()},CgsStreamLine.prototype.getPointNum=function(){return this.feature3D.getPointNum()},CgsStreamLine.prototype.getCount=function(){return this.feature3D.getCount()},CgsStreamLine.prototype.getActive=function(){return this.feature3D.getActive()},CgsStreamLine.prototype.getSaveFlag=function(){return this.feature3D.getSaveFlag()},CgsStreamLine.prototype.setSaveFlag=function(e){this.feature3D.setSaveFlag(e)},CgsStreamLine.prototype.save=function(){var e=this;return{positions:e.getPosition(),show:e.getVisible(),color:e.getColor(),height:e.getHeight(),pointNum:e.getPointNum(),count:e.getCount(),speed:e.getSpeed(),times:e.getTimes(),active:e.getActive(),moveColor:e.getMoveColor(),selfType:e.getSelfType(),type:e.getType()}},CgsStreamLine.load=function(e,t){var i=new CgsStreamLine(t);e.addFeature(i)},CgsFlyMark=function(e){this.bindedLine=e.bindedLine,this.bindedLine instanceof CgsArc?e.positions=this.bindedLine.coordinates:this.bindedLine instanceof CgsParabola&&(e.positions=this.bindedLine.feature3D.positions),e.positions?e.mark?(this.fact=e.fact?e.fact:.5,this.rotation=e.rotation?e.rotation:0,this.settingHeight=e.height,this.positions=e.positions,this.time=e.time?e.time:3e3,this.times=e.times?e.times:null,this.currentTimes=0,this.currentTime=0,this.mark=e.mark,this.mark.setSaveFlag(!1),this.mark.setVisible(!1),this.show=null==e.show||e.show,this.active=!1,this.calculatePosition(),this.saveFlag=CgsUtil.defaultValue(e.saveFlag,!0)):console.error("a CgsMark is needed!"):console.error("positions/bindto is not defined!")},CgsFlyMark.prototype.calculatePosition=function(){if(2==this.positions.length){var e=Cesium.Cartesian3.fromDegrees(this.positions[0][0],this.positions[0][1],0),t=Cesium.Cartesian3.fromDegrees(this.positions[this.positions.length-1][0],this.positions[this.positions.length-1][1],0),i=Cesium.Cartesian3.distance(e,t);if(this.settingHeight)this.height=this.settingHeight;else if(2==this.positions.length)this.height=i/4*this.fact;else for(var s=this.height=0;s<this.positions.length;s++)this.positions[s][2]&&this.height<this.positions[s][2]&&(this.height=this.positions[s][2]);var o=[];o[0]=this.positions[0],o[0][2]=0,o[1]=this.positions[this.positions.length-1],o[1][2]=0,this.positions=o;var a,n,r,l,u,p,h,c,g,d,m=(this.positions[0][0]+this.positions[1][0])/2,f=(this.positions[0][1]+this.positions[1][1])/2,C=Cesium.Cartesian3.fromDegrees(m,f,this.height),y=new Cesium.Cartesian3;this.rotation&&(a=t.x-e.x,n=t.y-e.y,r=t.z-e.z,l=-(a*t.x+n*t.y+r*t.z)/(a*a+n*n+r*r),u=new Cesium.Cartesian3(a*l+t.x,n*l+t.y,r*l+t.z),p=Cesium.Cartesian3.subtract(C,u,y),h=new Cesium.Cartesian3(a,n,r),Cesium.Cartesian3.normalize(h,h),c=Cesium.Math.toRadians(this.rotation),g=Cesium.Quaternion.fromAxisAngle(h,c),d=Cesium.Matrix3.fromQuaternion(g),Cesium.Matrix3.multiplyByVector(d,p,p),C=Cesium.Cartesian3.add(p,u,y)),this.spline=Cesium.HermiteSpline.createNaturalCubic({times:[0,.5,1],points:[e,C,t]})}this.mark.setPosition(this.positions[0])},CgsFlyMark.prototype.frameCallback=function(){var e=this,t=new Date,i=t-this.date;this.date=t,this.currentTime+=i;var s,o,a,n,r=0;this.currentTime>this.time&&(r=this.currentTime-this.time,this.currentTime=this.time),n=2==this.positions.length?(s=this.spline.evaluate(this.currentTime/this.time),[180*(o=Cesium.Cartographic.fromCartesian(s)).longitude/Math.PI,180*o.latitude/Math.PI,o.height]):(null==this.index&&(this.index=0),a=this.currentTime/this.time*this.positions.length,this.index=Math.round(a),this.index>=this.positions.length&&(this.index-=this.positions.length),this.positions[this.index]),this.mark.setPosition(n),this.mark.getVisible()&&this.bindedLine instanceof CgsParabola&&this.map&&"2D"==this.map.getMapMode()?this.mark.setVisible(!1):!this.mark.getVisible()&&this.bindedLine instanceof CgsParabola&&this.map&&"3D"==this.map.getMapMode()&&this.mark.setVisible(!0),this.currentTime==this.time&&(this.currentTimes++,this.currentTime=r),this.active&&(null==this.times||this.currentTimes<this.times)?this.animationTimer=requestAnimationFrame(function(){e.frameCallback.call(e)}):(this.deactivate(),this.currentTimes=0,this.currentTime=0,CgsSubPub.publish("flymarkfinished",[this,this.map]))},CgsFlyMark.prototype.setMap=function(e){if(null==e)return this.deactivate(),this.map&&this.map.removeFeature(this.mark),void(this.map=null);this.map&&this.map.removeFeature(this),e.allFeatures.push(this),e.addFeature(this.mark),this.map=e},CgsFlyMark.prototype.getMap=function(){return this.map},CgsFlyMark.prototype.activate=function(){var e=this;this.active=!0,this.mark.setVisible(this.show),0==this.currentTime&&(this.date=new Date),this.animationTimer=requestAnimationFrame(function(){e.frameCallback.call(e)})},CgsFlyMark.prototype.deactivate=function(){this.active=!1,cancelAnimationFrame(this.animationTimer),this.mark.setVisible(!1)},CgsFlyMark.prototype.getActiveFlag=function(){return this.active},CgsFlyMark.prototype.setVisible=function(e){this.mark.setVisible(e&&this.active),this.show=e},CgsFlyMark.prototype.getVisible=function(){return this.show},CgsFlyMark.prototype.setTime=function(e){this.currentTime=0,this.time=e},CgsFlyMark.prototype.getTime=function(){return this.time},CgsFlyMark.prototype.setTimes=function(e){this.currentTimes=0,this.times=e},CgsFlyMark.prototype.getTimes=function(){return this.times},CgsFlyMark.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.positions=e,this.calculatePosition()):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsFlyMark.prototype.getPosition=function(){return this.positions},CgsFlyMark.prototype.setFact=function(e){this.fact=e,this.calculatePosition()},CgsFlyMark.prototype.getFact=function(){return this.fact},CgsFlyMark.prototype.setHeight=function(e){this.settingHeight=e,this.calculatePosition()},CgsFlyMark.prototype.getHeight=function(){return this.height},CgsFlyMark.prototype.getType=function(){return"CgsFlyMark"},CgsFlyMark.prototype.getRotation=function(){return this.rotation},CgsFlyMark.prototype.getMark=function(){return this.mark},CgsFlyMark.prototype.getSaveFlag=function(){return this.saveFlag},CgsFlyMark.prototype.setSaveFlag=function(e){this.saveFlag=value},CgsFlyMark.prototype.save=function(){var e=this,t={positions:e.getPosition(),height:e.getHeight(),fact:e.getFact(),rotation:e.getRotation(),time:e.getTime(),times:e.getTimes(),type:e.getType(),show:e.getVisible(),activeFlag:e.getActiveFlag()};return t.markOpt=e.getMark().save(),t},CgsFlyMark.load=function(e,t){var i=new CgsFlyMark(t);e.addFeature(i),t.activeFlag&&i.activate()},CgsFireworks=function(e){CgsParticleCollection.call(this,e),this.feature3D=new CgsFireworks3D(e)},CgsInherits(CgsFireworks,CgsParticleCollection),CgsFireworks.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsFireworks.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsFireworks.prototype.setStartColor=function(e){this.feature3D.setStartColor(e)},CgsFireworks.prototype.getStartColor=function(){return this.feature3D.getStartColor()},CgsFireworks.prototype.setEndColor=function(e){this.feature3D.setEndColor(e)},CgsFireworks.prototype.getEndColor=function(){return this.feature3D.getEndColor()},CgsFireworks.prototype.setStartScale=function(e){this.feature3D.setStartScale(e)},CgsFireworks.prototype.getStartScale=function(){return this.feature3D.getStartScale()},CgsFireworks.prototype.setEndScale=function(e){this.feature3D.setEndScale(e)},CgsFireworks.prototype.getEndScale=function(){return this.feature3D.getEndScale()},CgsFireworks.prototype.setRate=function(e){this.feature3D.setRate(e)},CgsFireworks.prototype.getRate=function(){return this.feature3D.getRate()},CgsFireworks.prototype.setMinSpeed=function(e){this.feature3D.setMinSpeed(e)},CgsFireworks.prototype.getMinSpeed=function(){return this.feature3D.getMinSpeed()},CgsFireworks.prototype.setMaxSpeed=function(e){this.feature3D.setMaxSpeed(e)},CgsFireworks.prototype.getMaxSpeed=function(){return this.feature3D.getMaxSpeed()},CgsFireworks.prototype.setMinWidth=function(e){this.feature3D.setMinWidth(e)},CgsFireworks.prototype.getMinWidth=function(){return this.feature3D.getMinWidth()},CgsFireworks.prototype.setMaxWidth=function(e){this.feature3D.setMaxWidth(e)},CgsFireworks.prototype.getMaxWidth=function(){return this.feature3D.getMaxWidth()},CgsFireworks.prototype.setMinHeight=function(e){this.feature3D.setMinHeight(e)},CgsFireworks.prototype.getMinHeight=function(){return this.feature3D.getMinHeight()},CgsFireworks.prototype.setMaxHeight=function(e){this.feature3D.setMaxHeight(e)},CgsFireworks.prototype.getMaxHeight=function(){return this.feature3D.getMaxHeight()},CgsFireworks.prototype.getLifeTime=function(){return this.feature3D.getLifeTime()},CgsFireworks.prototype.setVisibleHeight=function(e){this.feature3D.setVisibleHeight(e)},CgsFireworks.prototype.getVisibleHeight=function(){return this.feature3D.getVisibleHeight()},CgsFireworks.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsFireworks.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsFireworks.prototype.location=function(){this.feature3D.location()},CgsFireworks.prototype.getSelfType=function(){return this.feature3D.getSelfType()},CgsFireworks.prototype.getSaveFlag=function(){return this.feature3D.getSaveFlag()},CgsFireworks.prototype.setSaveFlag=function(e){this.feature3D.setSaveFlag(value)},CgsFireworks.prototype.getEmitterOffset=function(){return this.feature3D.getEmitterOffset()},CgsFireworks.prototype.getCountFireworks=function(){return this.feature3D.getCountFireworks()},CgsFireworks.prototype.getColorFireworks=function(){return this.feature3D.getColorFireworks()},CgsFireworks.prototype.getBurstSize=function(){return this.feature3D.getBurstSize()},CgsFireworks.prototype.getCanvasSize=function(){return this.feature3D.getCanvasSize()},CgsFireworks.prototype.getDrawRadius=function(){return this.feature3D.getDrawRadius()},CgsFireworks.prototype.getParticles=function(){return this.feature3D.getParticles()},CgsFireworks.prototype.save=function(){for(var e=this,t={position:e.getPosition(),selfType:e.getSelfType(),show:e.getVisible(),emitterOffset:e.getEmitterOffset(),countFireworks:e.getCountFireworks(),colorFireworks:e.getColorFireworks(),lifeTime:e.getLifeTime(),burstSize:e.getBurstSize(),canvasSize:e.getCanvasSize(),drawRadius:e.getDrawRadius(),particles:[]},i=e.getParticles(),s=0;s<i.length;s++){var o=i[s],a={rotate:o.getRotate(),translation:o.getTranslation(),rotation:o.getEmitterRotation(),emitter:o.getEmitter(),startColor:o.getStartColor(),endColor:o.getEndColor(),startScale:o.getStartScale(),endScale:o.getEndScale(),rate:o.getRate(),loop:o.getLoop(),speed:o.getSpeed(),life:o.getLife(),width:o.getWidth(),height:o.getHeight(),lifeTime:o.getLifeTime(),url:o.getUrl(),radius:o.getRadius(),angle:o.getAngle(),dimensions:o.getDimensions(),visibleDistance:o.getVisibleHeight(),type:o.getType(),xMin:o.getXMin(),xMax:o.getXMax(),yMin:o.getYMin(),yMax:o.getYMax(),zMin:o.getZMin(),zMax:o.getZMax(),emitterOffset:o.getEmitterOffset(),minExplosionSize:o.getMinExplosionSize(),maxExplosionSize:o.getMaxExplosionSize()};t.particles.push(a)}return t},CgsFireworks.load=function(e,t){var i=new CgsFireworks(t);e.addFeature(i)},CgsTailFire=function(e){CgsParticleCollection.call(this,e),this.feature3D=new CgsTailFire3D(e)},CgsInherits(CgsTailFire,CgsParticleCollection),CgsTailFire.prototype.setPosition=function(e){this.feature3D.setPosition(e)},CgsTailFire.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsTailFire.prototype.setRotate=function(e,t){this.feature3D.setRotate(e)},CgsTailFire.prototype.getRotate=function(e){return this.feature3D.getRotate(e)},CgsTailFire.prototype.setTranslation=function(e,t){this.feature3D.setTranslation(e,t)},CgsTailFire.prototype.getTranslation=function(e){return this.feature3D.getTranslation(e)},CgsTailFire.prototype.setRotation=function(e,t){this.feature3D.setRotation(e,t)},CgsTailFire.prototype.getRotation=function(e){return this.feature3D.getRotation(e)},CgsTailFire.prototype.setEmitter=function(e,t){this.feature3D.setEmitter(e,t)},CgsTailFire.prototype.getEmitter=function(e){return this.feature3D.getEmitter(e)},CgsTailFire.prototype.setDimensions=function(e,t){this.feature3D.setDimensions(e,t)},CgsTailFire.prototype.getDimensions=function(e){return this.feature3D.getDimensions(e)},CgsTailFire.prototype.setAngle=function(e,t){this.feature3D.setAngle(e,t)},CgsTailFire.prototype.getAngle=function(e){return this.feature3D.getAngle(e)},CgsTailFire.prototype.setRadius=function(e,t){this.feature3D.setRadius(e,t)},CgsTailFire.prototype.getRadius=function(e){return this.feature3D.getRadius(e)},CgsTailFire.prototype.setStartColor=function(e,t){this.feature3D.setStartColor(e,t)},CgsTailFire.prototype.getStartColor=function(e){return this.feature3D.getStartColor(e)},CgsTailFire.prototype.setEndColor=function(e,t){this.feature3D.setEndColor(e,t)},CgsTailFire.prototype.getEndColor=function(e){return this.feature3D.getEndColor(e)},CgsTailFire.prototype.setStartScale=function(e,t){this.feature3D.setStartScale(e,t)},CgsTailFire.prototype.getStartScale=function(e){return this.feature3D.getStartScale(e)},CgsTailFire.prototype.setEndScale=function(e,t){this.feature3D.setEndScale(e,t)},CgsTailFire.prototype.getEndScale=function(e){return this.feature3D.getEndScale(e)},CgsTailFire.prototype.setRate=function(e,t){this.feature3D.setRate(e,t)},CgsTailFire.prototype.getRate=function(e){return this.feature3D.getRate(e)},CgsTailFire.prototype.getLoop=function(e){return this.feature3D.getLoop(e)},CgsTailFire.prototype.getSpeed=function(e){return this.feature3D.getSpeed(e)},CgsTailFire.prototype.setMinSpeed=function(e,t){this.feature3D.setMinSpeed(e,t)},CgsTailFire.prototype.getMinSpeed=function(e){return this.feature3D.getMinSpeed(e)},CgsTailFire.prototype.setMaxSpeed=function(e,t){this.feature3D.setMaxSpeed(e,t)},CgsTailFire.prototype.getMaxSpeed=function(e){return this.feature3D.getMaxSpeed(e)},CgsTailFire.prototype.getLife=function(e){return this.feature3D.getLife(e)},CgsTailFire.prototype.setMinLife=function(e,t){this.feature3D.setMinLife(e,t)},CgsTailFire.prototype.getMinLife=function(e){return this.feature3D.getMinLife(e)},CgsTailFire.prototype.setMaxLife=function(e,t){this.feature3D.setMaxLife(e,t)},CgsTailFire.prototype.getMaxLife=function(e){return this.feature3D.getMaxLife(e)},CgsTailFire.prototype.getMass=function(e){return this.feature3D.getMass(e)},CgsTailFire.prototype.setMinMass=function(e,t){this.feature3D.setMinMass(e,t)},CgsTailFire.prototype.getMinMass=function(e){return this.feature3D.getMinMass(e)},CgsTailFire.prototype.setMaxMass=function(e,t){this.feature3D.setMaxMass(e,t)},CgsTailFire.prototype.getMaxMass=function(e){return this.feature3D.getMaxMass(e)},CgsTailFire.prototype.getImage=function(e){return this.feature3D.getImage(e)},CgsTailFire.prototype.getWidth=function(e){return this.feature3D.getWidth(e)},CgsTailFire.prototype.setMinWidth=function(e,t){this.feature3D.setMinWidth(e,t)},CgsTailFire.prototype.getMinWidth=function(e){return this.feature3D.getMinWidth(e)},CgsTailFire.prototype.setMaxWidth=function(e,t){this.feature3D.setMaxWidth(e,t)},CgsTailFire.prototype.getMaxWidth=function(e){return this.feature3D.getMaxWidth(e)},CgsTailFire.prototype.getHeight=function(e){return this.feature3D.getHeight(e)},CgsTailFire.prototype.setMinHeight=function(e,t){this.feature3D.setMinHeight(e,t)},CgsTailFire.prototype.getMinHeight=function(e){return this.feature3D.getMinHeight(e)},CgsTailFire.prototype.setMaxHeight=function(e,t){this.feature3D.setMaxHeight(e,t)},CgsTailFire.prototype.getMaxHeight=function(e){return this.feature3D.getMaxHeight(e)},CgsTailFire.prototype.getLifeTime=function(e){return this.feature3D.getLifeTime(e)},CgsTailFire.prototype.setVisibleHeight=function(e,t){this.feature3D.setVisibleHeight(e,t)},CgsTailFire.prototype.getVisibleHeight=function(e){return this.feature3D.getVisibleHeight(e)},CgsTailFire.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsTailFire.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsTailFire.prototype.getParticles=function(){return this.feature3D.getParticles()},CgsTailFire.prototype.getBursts=function(e){return this.feature3D.getBursts(e)},CgsTailFire.prototype.getType=function(e){return this.feature3D.getType(e)},CgsTailFire.prototype.getXMin=function(e){return this.feature3D.getXMin(e)},CgsTailFire.prototype.getXMax=function(e){return this.feature3D.getXMax(e)},CgsTailFire.prototype.getYMin=function(e){return this.feature3D.getYMin(e)},CgsTailFire.prototype.getYMax=function(e){return this.feature3D.getYMax(e)},CgsTailFire.prototype.getZMin=function(e){return this.feature3D.getZMin(e)},CgsTailFire.prototype.getZMax=function(e){return this.feature3D.getZMax(e)},CgsTailFire.prototype.getEmitterOffset=function(e){return this.feature3D.getEmitterOffset(e)},CgsTailFire.prototype.getMinExplosionSize=function(e){return this.feature3D.getMinExplosionSize(e)},CgsTailFire.prototype.getMaxExplosionSize=function(e){return this.feature3D.getMaxExplosionSize(e)},CgsTailFire.prototype.getSelfType=function(){return this.feature3D.getSelfType()},CgsTailFire.prototype.getSaveFlag=function(){return this.feature3D.getSaveFlag()},CgsTailFire.prototype.setSaveFlag=function(e){this.feature3D.setSaveFlag(e)},CgsTailFire.prototype.save=function(){for(var e=this,t={position:e.getPosition(),selfType:e.getSelfType(),particles:[]},i=e.getParticles(),s=0;s<i.length;s++){var o={rotate:e.getRotate(s),translation:e.getTranslation(s),rotation:e.getRotation(s),emitter:e.getEmitter(s),startColor:e.getStartColor(s),endColor:e.getEndColor(s),startScale:e.getStartScale(s),endScale:e.getEndScale(s),rate:e.getRate(s),loop:e.getLoop(s),speed:e.getSpeed(s),minSpeed:e.getMinSpeed(s),maxSpeed:e.getMaxSpeed(s),life:e.getLife(s),minLife:e.getMinLife(s),maxLife:e.getMaxLife(s),width:e.getWidth(),minWidth:e.getMinWidth(s),maxWidth:e.getMaxWidth(s),height:e.getHeight(s),minHeight:e.getMinHeight(s),maxHeight:e.getMaxHeight(s),lifeTime:e.getLifeTime(s),url:e.getImage(s),radius:e.getRadius(s),angle:e.getAngle(s),dimensions:e.getDimensions(s),visibleDistance:e.getVisibleHeight(s),emitterOffset:e.getEmitterOffset(s)};t.particles.push(o)}return t},CgsTailFire.load=function(e,t){var i=new CgsTailFire(t);e.addFeature(i)},CgsSpreadEffect=function(e){this.feature3D=new CgsSpreadEffect3D(e)},CgsSpreadEffect.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsSpreadEffect.prototype.getMap=function(){return this.feature3D.getMap()},CgsSpreadEffect.prototype.setPosition=function(e){this.feature3D&&this.feature3D.setPosition(e)},CgsSpreadEffect.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsSpreadEffect.prototype.setRadius=function(e){this.feature3D&&this.feature3D.setRadius(e)},CgsSpreadEffect.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsSpreadEffect.prototype.setSpeed=function(e){this.feature3D&&this.feature3D.setSpeed(e)},CgsSpreadEffect.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsSpreadEffect.prototype.setColor=function(e){this.feature3D&&this.feature3D.setColor(e)},CgsSpreadEffect.prototype.getColor=function(){return this.feature3D.getColor()},CgsSpreadEffect.prototype.setVisible=function(e){this.feature3D&&this.feature3D.setVisible(e)},CgsSpreadEffect.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsImagerySplit=function(e){this.feature3D=new CgsImagerySplit3D(e)},CgsImagerySplit.prototype.addLayer=function(e){this.feature3D.addLayer(e)},CgsImagerySplit.prototype.setLeftLayer=function(e){this.feature3D.setLeftLayer(e)},CgsImagerySplit.prototype.getLeftLayer=function(){return this.feature3D.getLeftLayer()},CgsImagerySplit.prototype.setRightLayer=function(e){this.feature3D.setRightLayer(e)},CgsImagerySplit.prototype.getRightLayer=function(){return this.feature3D.getRightLayer()},CgsImagerySplit.prototype.activate=function(){this.feature3D.activate()},CgsImagerySplit.prototype.deactivate=function(){return this.feature3D.deactivate()},CgsImagerySplit.prototype.setAgain=function(e){this.feature3D.setAgain(e)},CgsImagerySplit.prototype.getAgain=function(){return this.feature3D.getAgain()},CgsImagerySplit.prototype.setWidth=function(e){this.feature3D.setWidth(e)},CgsImagerySplit.prototype.getWidth=function(){return this.feature3D.getWidth()},CgsImagerySplit.prototype.setDirection=function(e){this.feature3D.setDirection(e)},CgsImagerySplit.prototype.getDirection=function(){return this.feature3D.getDirection()},CgsImagerySplit.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsImagerySplit.prototype.getColor=function(){return this.feature3D.getColor()},CgsImagerySplit.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsImagerySplit.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsImagerySplit.prototype.setAlpha=function(e){this.feature3D.setAlpha(e)},CgsImagerySplit.prototype.getAlpha=function(){return this.feature3D.getAlpha()},CgsImagerySplit.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsImagerySplit.prototype.getMap=function(){return this.feature3D.getMap()},CgsImagerySplit.prototype.setMode=function(e){this.feature3D.setMode(e)},CgsImagerySplit.prototype.getMode=function(){return this.feature3D.getMode()},CgsImagerySplit.prototype.remove=function(){this.feature3D.remove()},CgsImagerySplit.MANUAL_MODE="manual",CgsImagerySplit.AUTOMATIC_MODE="automatic",CgsOcean=function(e){this.ocean3D=new CgsOcean3D(e)},CgsOcean.prototype.setMap=function(e){this.ocean3D.setMap(e)},CgsOcean.prototype.getMap=function(){return this.ocean3D.getMap()},CgsOcean.prototype.setVisible=function(e){this.ocean3D.setVisible(e)},CgsOcean.prototype.getVisible=function(){return this.ocean3D.getVisible()},CgsOcean3D.prototype.setVisibleHeight=function(e){this.ocean3D.setVisibleHeight(e)},CgsOcean3D.prototype.getVisibleHeight=function(){return this.ocean3D.getVisibleHeight()},CgsStar=function(e){this.feature3D=new CgsStar3D(e)},CgsStar.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsStar.prototype.getMap=function(){return this.feature3D.getMap()},CgsStar.prototype.getStarrySky=function(){return this.feature3D.getStarrySky()},CgsStar.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsStar.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsStar.prototype.getSaveFlag=function(){return this.feature3D.getSaveFlag()},CgsStar.prototype.setSaveFlag=function(e){this.feature3D.setSaveFlag(e)},CgsEarthWeak=function(e){this.feature3D=new CgsEarthWeak3D(e)},CgsEarthWeak.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsEarthWeak.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsEarthWeak.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsEarthWeak.prototype.getColor=function(){return this.feature3D.getColor()},CgsEarthWeak.prototype.setStrokeColor=function(e){this.feature3D.setStrokeColor(e)},CgsEarthWeak.prototype.getStrokeColor=function(){return this.feature3D.getStrokeColor()},CgsEarthWeak.prototype.setStrokeWidth=function(e){this.feature3D.setStrokeWidth(e)},CgsEarthWeak.prototype.getStrokeWidth=function(){return this.feature3D.getStrokeWidth()},CgsEarthWeak.prototype.setGridVisible=function(e){this.feature3D.setGridVisible(e)},CgsEarthWeak.prototype.getGridVisible=function(){return this.feature3D.getGridVisible()},CgsEarthWeak.prototype.setGridColor=function(e){this.feature3D.setGridColor(e)},CgsEarthWeak.prototype.getGridColor=function(){return this.feature3D.getGridColor()},CgsEarthWeak.prototype.setCountryVisible=function(e){this.feature3D.setCountryVisible(e)},CgsEarthWeak.prototype.getCountryVisible=function(){return this.feature3D.getCountryVisible()},CgsEarthWeak.prototype.remove=function(){this.feature3D.remove()},CgsTerrainColour=function(e){this.feature3D=new CgsTerrainColour3D(e)},CgsTerrainColour.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsTerrainColour.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsTerrainColour.prototype.setGraticuleMode=function(e){this.feature3D.setGraticuleMode(e)},CgsTerrainColour.prototype.setRampColor=function(e){this.feature3D.setRampColor(e)},CgsTerrainColour.prototype.getRampColor=function(){return this.feature3D.getRampColor()},CgsTerrainColour.prototype.setRamp=function(e){this.feature3D.setRamp(e)},CgsTerrainColour.prototype.getRamp=function(){return this.feature3D.getRamp()},CgsTerrainColour.prototype.setMinHeight=function(e){this.feature3D.setMinHeight(e)},CgsTerrainColour.prototype.getMinHeight=function(){return this.feature3D.getMinHeight()},CgsTerrainColour.prototype.setMaxHeight=function(e){this.feature3D.setMaxHeight(e)},CgsTerrainColour.prototype.getMaxHeight=function(){return this.feature3D.getMaxHeight()},CgsTerrainColour.prototype.remove=function(){this.feature3D.remove()},CgsSatelineManager=function(e){this.feature3D=new CgsSatelineManager3D(e),this.satelineModel=new CgsSatelineModel(this.feature3D)},CgsSatelineManager.prototype.getMap=function(){return this.feature3D.getMap()},CgsSatelineManager.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsSatelineManager.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsSatelineManager.prototype.track=function(e){var t,i;this.satelineModel&&(this.satelineModel.setName(e),(t=this.feature3D.getMap().map3D.manipulate)&&(t.setSelectFeature(this.satelineModel),i=this.satelineModel.feature3D.getEntity(),Cesium.defined(i)&&t.setManipulateType(3)))},CgsSatelineManager.prototype.cancelTrack=function(){var e=this.feature3D.getMap().map3D.manipulate;e&&(e.setLocateFlag(!1),e.setManipulateType(1))},CgsSatelineManager.prototype.setPastColor=function(e){this.feature3D.setPastColor(e)},CgsSatelineManager.prototype.getPastColor=function(){return this.feature3D.getPastColor()},CgsSatelineManager.prototype.setPredictColor=function(e){this.feature3D.setPredictColor(e)},CgsSatelineManager.prototype.getPredictColor=function(){return this.feature3D.getPredictColor()},CgsSatelineManager.prototype.setWidth=function(e){this.feature3D.setWidth(e)},CgsSatelineManager.prototype.getWidth=function(){return this.feature3D.getWidth()},CgsSatelineManager.prototype.setBeginTime=function(e){this.feature3D.setBeginTime(e)},CgsSatelineManager.prototype.getBeginTime=function(){return this.feature3D.getBeginTime()},CgsSatelineManager.prototype.setEndTime=function(e){this.feature3D.setEndTime(e)},CgsSatelineManager.prototype.getEndTime=function(){return this.feature3D.getEndTime()},CgsSatelineManager.prototype.addSatelite=function(e){this.feature3D.addSatelite(e)},CgsSatelineManager.prototype.addAllSatelite=function(){this.feature3D.addAllSatelite()},CgsSatelineManager.prototype.setOrbitVisible=function(e,t){this.feature3D.setOrbitVisible(e,t)},CgsSatelineManager.prototype.getOrbitVisible=function(e){return this.feature3D.getOrbitVisible(e)},CgsSatelineManager.prototype.setState=function(e){this.feature3D.setState(e)},CgsSatelineManager.prototype.getNameList=function(){return this.feature3D.getNameList()},CgsSatelineManager.prototype.getNameToSatelineInfo=function(){return this.feature3D.getNameToSatelineInfo()},CgsSatelineManager.prototype.getModelFromName=function(e){return this.feature3D.getModelFromName(e)},CgsSatelineManager.prototype.clear=function(){this.feature3D.clear()},CgsSatelineManager.START_STATE=0,CgsSatelineManager.PAUSE_STATE=1,CgsSatelineManager.STOP_STATE=2,CgsSatelineManager.RESTART_STATE=3,CgsSatelineModel=function(e){this.feature3D=new CgsSatelineModel3D(e),this.sateline=!0},CgsSatelineModel.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsSatelineModel.prototype.getEntity=function(){return this.feature3D.getEntity()},CgsSatelineModel.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsSatelineModel.prototype.setName=function(e){this.feature3D.setName(e)},CgsSatelineModel.prototype.getType=function(){return this.feature3D.getType()},CgsSatelliteSimulation=function(e){var t,i;e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),Cesium.defined(e.mapObject)?(this.map=e.mapObject,this.dataUrl=Cesium.defaultValue(e.dataUrl,CGS_SDK_PATH+"assets/sateline/Features.json"),this.modelUrl=Cesium.defaultValue(e.modelUrl,CGS_SDK_PATH+"assets/sateline/ldcxwx.gltf"),this.imageUrl=Cesium.defaultValue(e.imageUrl,CGS_SDK_PATH+"assets/sateline/1.png"),t=Cesium.defaultValue(e.beginTime,void 0),i=Cesium.defaultValue(e.endTime,void 0),t&&i?(this.beginTime=this.strTimeToDate(t),this.endTime=this.strTimeToDate(i),e.totalTime?this.totalTime=e.totalTime:this.totalTime=this.endTime.getTime()-this.beginTime.getTime()):this.totalTime=Cesium.defaultValue(e.totalTime,36e5),this.preOrbitColor=Cesium.defaultValue(e.preOrbitColor,"rgba(255,50,0,0.8)"),this.pastOrbitColor=Cesium.defaultValue(e.pastOrbitColor,"rgba(0,255,0,0.8)"),this.width=Cesium.defaultValue(e.width,.5),this.labelFont=Cesium.defaultValue(e.labelFont,"24px 微软雅黑"),this.labelFillColor=Cesium.defaultValue(e.labelFillColor,"rgba(255,217,39,1.0)"),this.labelStrokeColor=Cesium.defaultValue(e.labelStrokeColor,"rgba(255,255,255,1.0)"),this.labelOutlineWidth=Cesium.defaultValue(e.labelOutlineWidth,1),this.labelPixelOffset=Cesium.defaultValue(e.labelPixelOffset,[30,30]),this.limitHeight=Cesium.defaultValue(e.limitHeight,25e5),this.limitHeightFlag=Cesium.defaultValue(e.limitHeightFlag,!0),this.allSatellites=new Map,this.manipulate=this.map.getManipulate(),this.selectFeature=void 0,this.orbitMotionFlag=!1,this.maxNumOfPoints=5e5,this.setEvent()):console.info("please input mapObject!!")},CgsSatelliteSimulation.prototype.setEvent=function(){var o=this;this.clickSpaceEvent=CgsSubPub.subscribe("featureclickout",function(e,t,i){o.selectFeature&&t!=o.selectFeature&&o.overlay&&o.overlay.setVisible(!1)}),this.rightPickSelectEvent=CgsSubPub.subscribe("featurerightclickSelected",function(e,t,i,s){"CgsModel"==t.getType()&&t.parentFeature.aboutSatellite&&(o.selectFeature&&o.selectFeature!=t.parentFeature&&(o.selectFeature.aboutSatellite.feature3D.overlay=void 0),o.selectFeature=t.parentFeature,i=o.selectFeature.getPosition(),o.overlay?(o.overlay.setPosition(i),o.overlay.setVisible(!0)):(o.createOverlay(),o.overlay.setPosition(i)),t.parentFeature.aboutSatellite.feature3D.overlay=o.overlay)})},CgsSatelliteSimulation.prototype.createOverlay=function(){var i=this,e=["目标跟随","取消跟随","预测轨迹","飞行尾迹","卫星雷达","扫描范围"],t=document.createElement("div");t.setAttribute("id","satelliteDiv");for(var s=0;s<e.length;s++){var o=document.createElement("div");o.setAttribute("class","satellite_one"),o.innerText=e[s],t.appendChild(o)}t.addEventListener("click",function(e){var t;switch(e.target.innerText){case"目标跟随":i.selectFeature&&((t=i.selectFeature.aboutSatellite).hidePath(),i.manipulate.setSelectFeature(i.selectFeature),i.manipulate.setManipulateType(3));break;case"取消跟随":i.cancelTrack();break;case"预测轨迹":i.selectFeature&&i.selectFeature.aboutSatellite&&((t=i.selectFeature.aboutSatellite).hidePath(),t.setOrbitMotionFlag(!0),t.showPrePath());break;case"飞行尾迹":i.selectFeature&&i.selectFeature.aboutSatellite&&((t=i.selectFeature.aboutSatellite).hidePath(),t.setOrbitMotionFlag(!0),t.showPassPath());break;case"卫星雷达":i.setRadarVisible(!i.getRadarVisible());break;case"扫描范围":i.setScanAreaVisible(!i.getScanAreaVisible())}}),this.overlay=new CgsOverlay({position:[115,39],positioning:"top-left",element:t,offset:[10,10],draggable:!0,showLine:!0,brokenLine:!1}),this.map.addOverlay(this.overlay)},CgsSatelliteSimulation.prototype.getMap=function(){return this.map},CgsSatelliteSimulation.prototype.parseAndInit=function(e){var t=this;e.beginTime&&(this.beginTime=this.strTimeToDate(e.beginTime)),e.endTime&&(this.endTime=this.strTimeToDate(e.endTime)),(e.beginTime||e.endTime)&&(this.totalTime=this.endTime.getTime()-this.beginTime.getTime());for(var i,s=e.features,o=s.length,a=t.maxNumOfPoints/o,n=0;n<s.length;++n){var r={width:t.width,fillColor:t.preOrbitColor,lineType:0,useDynamicColor:!0,dynamicColor:t.pastOrbitColor},l={width:t.width,fillColor:t.pastOrbitColor,lineType:0};if(t.limitHeightFlag)for(var u=0;u<s[n].positions.length;++u){var p=(p=s[n].positions[u][2])>t.limitHeight?.1*(p-t.limitHeight)+t.limitHeight:p;s[n].positions[u][2]=p}var h=s[n].positions[0],c=s[n].name,g={name:c,position:h,url:t.modelUrl,minimumPixelSize:64,modelOriginalRotation:[0,0,0],maxmumScale:1e4,minimumScale:30,distanceDisplayCondition:[0,3e6],labelstroke:this.labelStrokeColor,labelstrokewidth:this.labelOutlineWidth,labelfill:this.labelFillColor,labelfont:this.labelFont,labeloffset:this.labelPixelOffset,selectEnable:!0},d=new CgsModel(g);this.map.addFeature(d);var m={position:h,url:t.imageUrl,distanceDisplayCondition:3e6},f=new CgsMark(m);this.map.addFeature(f),(i=new CgsAirLine({mapObject:t.map,mark:f,model:d,totalTime:t.totalTime,optAllLine:r,optPassLine:l,satelineFlag:!0,orbitMotionFlag:t.orbitMotionFlag,numOfPoints:a})).setPoints(s[n].positions),i.freeze(),i.hidePath(),i.start(),t.allSatellites.has(c)||t.allSatellites.set(c,i),d.aboutSatellite=i}},CgsSatelliteSimulation.prototype.init=function(){var t;"object"===_typeof(this.dataUrl)?this.parseAndInit(this.dataUrl):(t=this,$$.ajax({url:t.dataUrl,type:"get",dataType:"json",success:function(e){t.parseAndInit(e),CgsSubPub.publish("satelliteinitfinished",[t.allSatellites])},error:function(){console.error("初始化时请求数据失败")}}))},CgsSatelliteSimulation.prototype.freeze=function(){this.allSatellites.forEach(function(e,t){e.freeze()})},CgsSatelliteSimulation.prototype.unfreeze=function(){this.allSatellites.forEach(function(e,t){e.unfreeze()})},CgsSatelliteSimulation.prototype.restart=function(){this.allSatellites.forEach(function(e,t){e.restart()})},CgsSatelliteSimulation.prototype.stop=function(){this.allSatellites.forEach(function(e,t){e.stop()})},CgsSatelliteSimulation.prototype.showPath=function(){this.allSatellites.forEach(function(e,t){e.showPath()})},CgsSatelliteSimulation.prototype.hidePath=function(){this.allSatellites.forEach(function(e,t){e.hidePath()})},CgsSatelliteSimulation.prototype.showPassPath=function(){this.allSatellites.forEach(function(e,t){e.showPassPath()})},CgsSatelliteSimulation.prototype.hidePassPath=function(){this.allSatellites.forEach(function(e,t){e.hidePassPath()})},CgsSatelliteSimulation.prototype.speedUp=function(){this.allSatellites.forEach(function(e,t){e.speedUp()})},CgsSatelliteSimulation.prototype.speedDown=function(){this.allSatellites.forEach(function(e,t){e.speedDown()})},CgsSatelliteSimulation.prototype.setIntervalTime=function(i){this.allSatellites.forEach(function(e,t){e.setIntervalTime(i)})},CgsSatelliteSimulation.prototype.getIntervalTime=function(){var e=[],t=!0,i=!1,s=void 0;try{for(var o,a=this.allSatellites.keys()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var n=o.value;e.push(n)}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}return this.allSatellites.get(e[0]).getIntervalTime()},CgsSatelliteSimulation.prototype.setMultiplier=function(i){this.allSatellites.forEach(function(e,t){e.setMultiplier(i)})},CgsSatelliteSimulation.prototype.getMultiplier=function(){var e=[],t=!0,i=!1,s=void 0;try{for(var o,a=this.allSatellites.keys()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var n=o.value;e.push(n)}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}this.allSatellites.get(e[0]).getMultiplier()},CgsSatelliteSimulation.prototype.setLabelsVisible=function(i){this.allSatellites.forEach(function(e,t){e.feature3D.model.feature3D.getLabel().setVisible(i)})},CgsSatelliteSimulation.prototype.track=function(e){var t=this.allSatellites.get(e);t?(this.selectFeature=t.feature3D.model,t&&this.selectFeature&&(t.feature3D.getPathState()&&(t.showPrePath(),t.showPassPath(),t.setOrbitMotionFlag(!0)),t.hidePath(),this.manipulate.setSelectFeature(this.selectFeature),this.manipulate.setManipulateType(3),this.trackFlag=!0)):console.log("卫星不存在！")},CgsSatelliteSimulation.prototype.cancelTrack=function(){var e;this.selectFeature&&(e=this.selectFeature.aboutSatellite,this.manipulate.setLocateFlag(!1),this.manipulate.setManipulateType(1),e.feature3D.getPassPathState()&&e.feature3D.getPrePathState()&&(e.showPath(),e.hidePassPath(),e.hidePrePath(),e.setOrbitMotionFlag(!1)),this.trackFlag=!1)},CgsSatelliteSimulation.prototype.setRadarVisible=function(e){var t,i,s,o;this.selectFeature&&this.selectFeature.aboutSatellite&&((t=this.selectFeature.aboutSatellite).feature3D.radar||(s={destinationPosition:[(i=this.selectFeature.getPosition())[0],i[1],0],launchPosition:i,radius:2e5,radarColor:"rgba(0,255,0,0.3)"},o=new CgsSatelliteRadar(s),this.map.addFeature(o),t.addRadar(o)),t.feature3D.radar.setVisible(e))},CgsSatelliteSimulation.prototype.getRadarVisible=function(){if(this.selectFeature&&this.selectFeature.aboutSatellite){var e=this.selectFeature.aboutSatellite;return!!e.feature3D.radar&&e.feature3D.radar.getVisible()}},CgsSatelliteSimulation.prototype.setScanAreaVisible=function(e){var t;this.selectFeature&&this.selectFeature.aboutSatellite&&((t=this.selectFeature.aboutSatellite).feature3D.scanArea||t.addScanArea(),t.feature3D.scanArea.setVisible(e))},CgsSatelliteSimulation.prototype.getScanAreaVisible=function(){if(this.selectFeature&&this.selectFeature.aboutSatellite){var e=this.selectFeature.aboutSatellite;return!!e.feature3D.scanArea&&e.feature3D.scanArea.getVisible()}},CgsSatelliteSimulation.prototype.setSelectFeature=function(e){var t=this.allSatellites.get(e);return this.selectFeature=t.feature3D.model},CgsSatelliteSimulation.prototype.getSelectFeature=function(){return this.selectFeature},CgsSatelliteSimulation.prototype.showPathByName=function(e){var t=this.allSatellites.get(e);!this.trackFlag&&t.feature3D.getPassPathState()?(t.setOrbitMotionFlag(!1),t.hidePassPath(),t.showPath()):(t.hidePath(),t.setOrbitMotionFlag(!0),t.showPrePath())},CgsSatelliteSimulation.prototype.hidePathByName=function(e){var t=this.allSatellites.get(e);t.feature3D.getPassPathState()?t.hidePrePath():t.feature3D.getPathState()?(t.hidePath(),t.setOrbitMotionFlag(!0),t.showPassPath()):(t.hidePrePath(),t.setOrbitMotionFlag(!1))},CgsSatelliteSimulation.prototype.showPassPathByName=function(e){var t=this.allSatellites.get(e);!this.trackFlag&&t.feature3D.getPrePathState()?(t.setOrbitMotionFlag(!1),t.hidePrePath(),t.showPath()):(t.hidePath(),t.setOrbitMotionFlag(!0),t.showPassPath())},CgsSatelliteSimulation.prototype.hidePassPathByName=function(e){var t=this.allSatellites.get(e);t.feature3D.getPrePathState()?t.hidePassPath():t.feature3D.getPathState()?(t.hidePath(),t.setOrbitMotionFlag(!0),t.showPrePath()):(t.hidePassPath(),t.setOrbitMotionFlag(!1))},CgsSatelliteSimulation.prototype.setFollowOverlay=function(e){var t,i=this.getSelectFeature();i?(t=i.aboutSatellite)&&(t.feature3D.overlay&&this.map.removeOverlay(t.feature3D.overlay),t.feature3D.overlay=e):console.log("selectFeature不存在！")},CgsSatelliteSimulation.prototype.getFollowOverlay=function(){var e=this.getSelectFeature();if(e){var t=e.aboutSatellite;return t?t.feature3D.overlay:void 0}},CgsSatelliteSimulation.prototype.dispose=function(){this.hidePath(),this.stop(),this.allSatellites.forEach(function(e,t){e.dispose()})},CgsSatelliteSimulation.prototype.strTimeToDate=function(e){var t=e.substr(0,4),i=e.substr(5,2),s=e.substr(8,2),o=e.substr(11,2),a=e.substr(14,2),n=e.substr(17,2),r=new Date;return r.setFullYear(parseInt(t)),r.setMonth(parseInt(i)-1),r.setDate(parseInt(s)),r.setHours(parseInt(o)),r.setMinutes(parseInt(a)),r.setSeconds(parseInt(n)),r},CgsSelectEffect=function(e){this.feature3D=new CgsSelectEffect3D(e),this.map=void 0},CgsSelectEffect.prototype.setMap=function(e){this.feature3D.setMap(e.map3D),this.map=e},CgsSelectEffect.prototype.getMap=function(){return this.map},CgsSelectEffect.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?this.feature3D.setPosition(e):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsSelectEffect.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsSelectEffect.prototype.startEffect=function(){this.feature3D.startEffect()},CgsSelectEffect.prototype.getStartState=function(){return this.feature3D.getStartState()},CgsSelectEffect.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsSelectEffect.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsSelectEffect.prototype.setTimes=function(e){this.feature3D.setTimes(e)},CgsSelectEffect.prototype.getTimes=function(){return this.feature3D.getTimes()},CgsSelectEffect.prototype.setPeriod=function(e){this.feature3D.setPeriod(e)},CgsSelectEffect.prototype.getPeriod=function(){return this.feature3D.getPeriod()},CgsSelectEffect.prototype.setMinScale=function(e){this.feature3D.setMinScale(e)},CgsSelectEffect.prototype.getMinScale=function(){return this.feature3D.getMinScale()},CgsSelectEffect.prototype.setMaxScale=function(e){this.feature3D.setMaxScale(e)},CgsSelectEffect.prototype.getMaxScale=function(){return this.feature3D.getMaxScale()},CgsSelectEffect.prototype.remove=function(){this.feature3D.remove()},CgsWideLine=function(e){this.feature3D=new CgsWideLine3D(e),e.speed=e.xTexSpeed,this.feature2D=new CgsWideLine2D(e)},CgsWideLine.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsWideLine.prototype.getMap=function(){return this.feature3D.getMap()},CgsWideLine.prototype.setPosition=function(e){CgsUtil.verifyLonLat(e)?(this.feature3D.setPosition(e),this.feature2D.setPosition(e)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsWideLine.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsWideLine.prototype.setColor=function(e){this.feature3D.setColor(e),this.feature2D.setColor(e)},CgsWideLine.prototype.getColor=function(){return this.feature3D.getColor()},CgsWideLine.prototype.setTexSpeedX=function(e){this.feature3D.setTexSpeedX(e),this.feature2D.setSpeed(e)},CgsWideLine.prototype.getTexSpeedX=function(){return this.feature3D.getTexSpeedX()},CgsWideLine.prototype.setTexSpeedY=function(e){this.feature3D.setTexSpeedY(e)},CgsWideLine.prototype.getTexSpeedY=function(){return this.feature3D.getTexSpeedY()},CgsWideLine.prototype.enableAnimation=function(e){this.feature3D.enableAnimation(e),this.feature2D.enableAnimation(e)},CgsWideLine.prototype.setWidth=function(e){this.feature3D.setWidth(e),this.feature2D.setWidth(e)},CgsWideLine.prototype.getWidth=function(){return this.feature3D.getWidth()},CgsWideLine.prototype.setLengthTexUint=function(e){this.feature3D.setLengthTexUint(e),this.feature2D.setLengthTexUint(e)},CgsWideLine.prototype.getLengthTexUint=function(){return this.feature3D.getLengthTexUint()},CgsWideLine.prototype.getType=function(){return this.feature3D.getType()},CgsWideLine.prototype.setVisible=function(e){this.feature3D.setVisible(e),this.feature2D.setVisible(e)},CgsWideLine.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsWideLine.LINE_SOLID=0,CgsWideLine.LINE_DASH=1,CgsWideLine.LINE_DOT=2,CgsWideLine.LINE_DASH_DAT=3,CgsWideLine.LINE_USER_DEFINE=4,CgsWideLine.WIDELINE_DISTANCE=0,CgsWideLine.WIDELINE_PIXEL=1,CgsTerrainClip=function(e){this.feature3D=new CgsTerrainClip3D(e)},CgsTerrainClip.prototype.setRegion=function(e){this.feature3D.setRegion(e)},CgsTerrainClip.prototype.getRegions=function(){return this.feature3D.getRegions()},CgsTerrainClip.prototype.deleteAllRegion=function(){return this.feature3D.deleteAllRegion()},CgsTerrainClip.PULL=0,CgsTerrainClip.SINK=1,CgsTerrainClip.EXAGGERATE=2,CgsTerrainClip.FLAT=3,CgsTerrainClipTool=function(e){this.terrainClipTool3D=new CgsTerrainClipTool3D(e)},CgsTerrainClipTool.prototype.activate=function(){this.terrainClipTool3D&&this.terrainClipTool3D.activate()},CgsTerrainClipTool.prototype.deactivate=function(){this.terrainClipTool3D&&this.terrainClipTool3D.deactivate()},CgsTerrainClipTool.prototype.remove=function(){this.terrainClipTool3D&&this.terrainClipTool3D.remove()},CgsTerrainClipTool.prototype.setTerrainMode=function(e){this.terrainClipTool3D.setTerrainMode(e)},CgsTerrainClipTool.prototype.getTerrainMode=function(){return this.terrainClipTool3D.getTerrainMode()},CgsTerrainClipTool.prototype.setParameter=function(e){this.terrainClipTool3D.setParameter(e)},CgsTerrainClipTool.prototype.getParameter=function(){return this.terrainClipTool3D.getParameter()},CgsTerrainClipTool.prototype.deleteAllRegion=function(){this.terrainClipTool3D.deleteAllRegion()},CgsFlightLine=function(e){this.feature3D=new CgsFlightLine3D(e)},CgsFlightLine.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsFlightLine.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsFlightLine.prototype.setWarningLineVisible=function(e){this.feature3D.setWarningLineVisible(e)},CgsFlightLine.prototype.getWarningLineVisible=function(){return this.feature3D.getWarningLineVisible()},CgsFlightLine.prototype.setVerticalLineVisible=function(e){this.feature3D.setVerticalLineVisible(e)},CgsFlightLine.prototype.getVerticalLineVisible=function(){return this.feature3D.getVerticalLineVisible()},CgsFlightLine.prototype.setFlightColor=function(e){this.feature3D.setFlightColor(e)},CgsFlightLine.prototype.getFlightColor=function(){return this.feature3D.getFlightColor()},CgsFlightLine.prototype.setSlopeColor=function(e){this.feature3D.setSlopeColor(e)},CgsFlightLine.prototype.getSlopeColor=function(){return this.feature3D.getSlopeColor()},CgsFlightLine.prototype.setDangerLineColor=function(e){this.feature3D.setDangerLineColor(e)},CgsFlightLine.prototype.getDangerLineColor=function(){return this.feature3D.getDangerLineColor()},CgsFlightLine.prototype.setWarningLineColor=function(e){this.feature3D.setWarningLineColor(e)},CgsFlightLine.prototype.getWarningLineColor=function(){return this.feature3D.getWarningLineColor()},CgsFlightLine.prototype.setVerticalLineColor=function(e){this.feature3D.setVerticalLineColor(e)},CgsFlightLine.prototype.getVerticalLineColor=function(){return this.feature3D.getVerticalLineColor()},CgsFlightLine.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsFlightLine.prototype.getMap=function(){return this.feature3D.getMap()},CgsIndoorRoaming=function(e){this.feature3D=new CgsIndoorRoaming3D(e)},CgsIndoorRoaming.prototype.enterIndoorRoaming=function(){this.feature3D.enterIndoorRoaming()},CgsIndoorRoaming.prototype.leaveIndoorRoaming=function(){this.feature3D.leaveIndoorRoaming()},CgsIndoorRoaming.prototype.startIndoorRoaming=function(){this.feature3D.startIndoorRoaming()},CgsIndoorRoaming.prototype.stopIndoorRoaming=function(){this.feature3D.stopIndoorRoaming()},CgsStreetMap=function(e){this.map=e.mapObject,this.imageFilePath=e.imageUrl;this.positions=CgsUtil.defaultValue(e.positions,[[116.35709,39.898598,100],[116.35709,39.89851,100],[116.35709,39.898422,100],[116.35709,39.898335,100],[116.35709,39.898243,100],[116.35709,39.898155,100],[116.35709,39.898067,100],[116.35709,39.897976,100],[116.35709,39.897888,100],[116.35709,39.8978,100]]),this.iconFilePath=CgsUtil.defaultValue(e.iconFilePath,CGS_SDK_PATH+"assets/image/JieJing/camera.png"),this.distanceDisplayCondition=CgsUtil.defaultValue(e.distanceDisplayCondition,[400,1425e4]);var t={position:this.positions[this.positions.length-1],visibleHeight:this.distanceDisplayCondition,url:this.iconFilePath,selectEnable:!0};this._mark=new CgsMark(t),this.map.addFeature(this._mark),this.streetMaps=[];for(var i=this.positions.length,s=0;s<i;++s){var o={mapObject:e.mapObject,imageFilePath:this.imageFilePath,position:this.positions[s],show:!1},a=new CgsStreetMap3D(o);this.streetMaps.push(a)}var v=i-1;this._cameraInPanorama=!1,this.first=!0;this.map.map3D.scene;var b=this.map.map3D.canvas,D=this.map.map3D.camera,S=this,n=new Cesium.ScreenSpaceEventHandler(b),r={looking:!1,moveForward:!1,moveBackward:!1,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1},_=!1,w=!1;n.setInputAction(function(e){r.looking=!0,_=!0},Cesium.ScreenSpaceEventType.LEFT_DOWN),n.setInputAction(function(e){S.looking=!1,w=_=!1},Cesium.ScreenSpaceEventType.LEFT_UP),n.setInputAction(function(e){e.position},Cesium.ScreenSpaceEventType.RIGHT_DOWN),n.setInputAction(function(e){w=!1,S.looking=!1},Cesium.ScreenSpaceEventType.RIGHT_UP),n.setInputAction(function(e){_&&S._cameraInPanorama&&(w=!0);var t=D.position,i=Cesium.Cartesian3.distance(t,S.streetMaps[v].initPosition);if(w&&i<.95*S.streetMaps[v].radius){D.right;var s=D.up,o=D.direction,t=D.position,a=b.clientWidth,n=b.clientHeight,r=(e.endPosition.x-e.startPosition.x)/a,l=(e.startPosition.y-e.endPosition.y)/n;if(0==Math.abs(l)&&0==Math.abs(r))return;r*=4,S.streetMaps[v].camHeading+=Cesium.Math.toDegrees(r),360<=S.streetMaps[v].camHeading&&(S.streetMaps[v].camHeading-=360),S.streetMaps[v].camHeading<=-360&&(S.streetMaps[v].camHeading+=360);var u=Cesium.Cartesian3.clone(s),p=Cesium.Cartesian3.clone(o),h=new Cesium.Cartesian3,c=Cesium.Quaternion.fromAxisAngle(S.streetMaps[v].initUp,r),g=Cesium.Matrix3.fromQuaternion(c),u=Cesium.Matrix3.multiplyByVector(g,u,u),p=Cesium.Matrix3.multiplyByVector(g,p,p);u=Cesium.Cartesian3.normalize(u,u),p=Cesium.Cartesian3.normalize(p,p),h=Cesium.Cartesian3.cross(u,p,h),h=Cesium.Cartesian3.normalize(h,h),l*=4;var d=Cesium.Math.toDegrees(-l),m=Cesium.Math.toDegrees(D.pitch);if(90<m+d?l=-Cesium.Math.toRadians(90-m-.01):m+d<-90&&(l=-Cesium.Math.toRadians(-90-m+.01)),Math.abs(l)<Cesium.Math.EPSILON6&&0!=Math.abs(l))return;var f=Cesium.Quaternion.fromAxisAngle(h,l),C=Cesium.Matrix3.fromQuaternion(f);u=Cesium.Matrix3.multiplyByVector(C,u,u),u=Cesium.Cartesian3.normalize(u,u),p=Cesium.Cartesian3.cross(h,u,p),p=Cesium.Cartesian3.normalize(p,p);i=Cesium.Cartesian3.distance(t,S.streetMaps[v].initPosition);S.streetMaps[v].direction=Cesium.Cartesian3.clone(p),S.streetMaps[v].up=Cesium.Cartesian3.clone(u);var y=new Cesium.Cartesian3,y=Cesium.Cartesian3.multiplyByScalar(p,i,y);S.streetMaps[v].camCenter=Cesium.Cartesian3.add(S.streetMaps[v].initPosition,y,S.streetMaps[v].camCenter)}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),n.setInputAction(function(e){var t=.991,i=D.position,s=Cesium.Cartesian3.distance(i,S.streetMaps[v].initPosition);if(s<.95*S.streetMaps[v].radius){D.right;var o=D.up,a=D.direction;S.streetMaps[v].direction=Cesium.Cartesian3.clone(a),S.streetMaps[v].up=Cesium.Cartesian3.clone(o);var n=0<e?1:-1;if(0<e){if(s>=.9*S.streetMaps[v].radius)return;s+t>=.9*S.streetMaps[v].radius&&(t=.9*S.streetMaps[v].radius-s)}a=Cesium.Cartesian3.multiplyByScalar(a,t*n,a),S.streetMaps[v].camCenter=Cesium.Cartesian3.add(i,a,S.streetMaps[v].camCenter),e<0&&s<=Math.abs(t)&&(S.streetMaps[v].camCenter=Cesium.Cartesian3.clone(S.streetMaps[v].initPosition))}},Cesium.ScreenSpaceEventType.WHEEL),n.setInputAction(function(e){S._cameraInPanorama&&(S._cameraInPanorama=!1,S.first=!1,D.flyTo({destination:Cesium.Cartesian3.fromDegrees(S.positions[v][0],S.positions[v][1],100),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:0},duration:.5,complete:function(){S.streetMaps[v].setVisible(!1),D.flyTo({destination:Cesium.Cartesian3.fromDegrees(S.positions[v][0],S.positions[v][1],5e5),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:0},duration:3,complete:function(){S._mark.setPosition(S.positions[v]),S._mark.setVisible(!0),S._mark.setColor("rgba(255,255,255,1.0)")}})}}))},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),S.markDoubleClick=CgsSubPub.subscribe("featuredoubleclick",function(e){var t=S.map.map3D.camera;S.map.map3D.scene;t.flyTo({destination:1==S.first?S.streetMaps[i-1].initPosition:S.streetMaps[v].initPosition,orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:0},duration:.5,easingFunction:Cesium.EasingFunction.QUADRACTIC_IN,complete:function(){S.streetMaps[v].setVisible(!0),S._mark.setVisible(!1),S._cameraInPanorama=!0}})}),S.map.map3D.clock.onTick.addEventListener(function(e){S._cameraInPanorama&&D.setView({destination:S.streetMaps[v].camCenter,orientation:{direction:S.streetMaps[v].direction,up:S.streetMaps[v].up}})}),document.addEventListener("keydown",function(e){if(38==e.keyCode){if(v<=0)return void(v=0);v--,S.streetMaps[v+1].setVisible(!1),S.streetMaps[v].setVisible(!0)}else if(40==e.keyCode){if(i-1<=v)return void(v=i-1);v++,S.streetMaps[v-1].setVisible(!1),S.streetMaps[v].setVisible(!0)}},!1)},CgsStreetMap.prototype.setImageUrl=function(e){this.streetMap.setImageUrl(e)},CgsStreetMap.prototype.destroy=function(){this._cameraInPanorama=!1;for(var e=this.streetMaps.length,t=0;t<e;++t)this.streetMaps[t].destroy();this.map.removeFeature(this._mark)},CgsPointAggregation=function(e){CgsDataSource.call(this,e),e.mapObject.map3D&&(this.geoJson3D=new CgsPointAggregation3D(e))},CgsInherits(CgsPointAggregation,CgsDataSource),CgsPointAggregation.prototype.getName=function(){if(this.geoJson3D)return this.geoJson3D.getName()},CgsPointAggregation.prototype.setName=function(e){this.geoJson3D&&this.geoJson3D.setName(e)},CgsPointAggregation.prototype.setVisible=function(e){this.geoJson3D&&this.geoJson3D.setVisible(e)},CgsPointAggregation.prototype.getVisible=function(){if(this.geoJson3D)return this.geoJson3D.getVisible()},CgsPointAggregation.prototype.setIntensity=function(e){this.geoJson3D&&(this.geoJson3D.intensity=e)},CgsPoint.prototype.getIntensity=function(){if(this.geoJson3D)return this.geoJson3D.intensity},CgsBigDataV=function(e,t){this.geojson=CgsMapV.geojson,this.utilCityCenter=CgsMapV.utilCityCenter,this.utilCurve=CgsMapV.utilCurve,this.data=Cesium.defaultValue(e,void 0),this.options=Cesium.defaultValue(t,void 0),this.viewer=void 0,this.layer3D=void 0,this.layer2D=void 0,this.show=!0},CgsBigDataV.prototype.create3D=function(){var e;this.viewer&&this.data&&(this.data instanceof CgsMapV.DataSet?this.dataSet3D=this.data:(this.dataSet3D=new CgsMapV.DataSet(this.data),this.options.filter&&(e=this.dataSet3D.get({filter:this.options.filter}),this.dataSet3D=new CgsMapV.DataSet(e))),this.layer3D=new CgsMapV.cesiumMapLayer(this.viewer.map3D,this.dataSet3D,this.options,this.viewer.map3D.container),this.layer3D.viewer=this.viewer)},CgsBigDataV.prototype.create2D=function(){var e;this.viewer&&this.data&&(this.data instanceof CgsMapV.DataSet?this.dataSet2D=this.data:(this.dataSet2D=new CgsMapV.DataSet(this.data),this.options.filter&&(e=this.dataSet2D.get({filter:this.options.filter}),this.dataSet2D=new CgsMapV.DataSet(e))),this.options.projection=this.viewer.map2D.projection,this.layer2D=new CgsMapV.OpenlayersLayer(this.viewer.map2D,this.dataSet2D,this.options),this.layer2D.viewer=this.viewer)},CgsBigDataV.prototype.destroy=function(){this.layer3D&&(this.layer3D.destroy(),this.layer3D=void 0,this.dataSet3D=void 0),this.layer2D&&(this.layer2D.removeLayer(),this.layer2D=void 0,this.dataSet2D=void 0)},CgsBigDataV.prototype.setVisible=function(e){this.layer3D&&((this.show=e)?this.layer3D.show():this.layer3D.hide())},CgsBigDataV.prototype.getVisible=function(){if(this.layer3D)return this.show},CgsTimeDynamicTileLayer=function(e){CgsLayer.call(this,e),null==e.layer&&(e.layer=e.name),1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG||(this.layer3D=new CgsTimeDynamicTileLayer3D(e)),0==e.visible&&this.setVisible(e.visible)},CgsInherits(CgsTimeDynamicTileLayer,CgsLayer),CgsTimeDynamicTileLayer.prototype.getLayer=function(){if(1==window.WGMODEFLAG||3==window.WGMODEFLAG)return this.layer3D.getLayer()},CgsTimeDynamicTileLayer.prototype.setClockCurrentTime=function(e){this.layer3D.setClockCurrentTime(e)},CgsTimeDynamicTileLayer.prototype.createTimeLine=function(){this.layer3D.createTimeLine()},CgsTimeDynamicTileLayer.prototype.makeTics=function(){this.layer3D.makeTics()},CgsTimeDynamicTileLayer.prototype.getBodyElement=function(){return this.layer3D.body},CgsTimeDynamicTileLayer.prototype.getReady=function(){return this.layer3D.ready},CgsTimeDynamicTileLayer.load=function(e,t){var i=new CgsTimeDynamicTileLayer(t);e.addLayer(i)},CgsTimeDynamicTileLayer.prototype.getCloseButtonEle=function(){return this.layer3D.closeButtonEle};var CgsPolylineTrailMaterialProperty=function(e){this.options=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e.color,this.duration=e.duration,this.trailImage=e.trailImage,this._time=performance.now(),this.feature=e.feature,this.meterPerPixel=0,this.maxMPP=14e3,this.minMPP=500};Object.defineProperties(CgsPolylineTrailMaterialProperty.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),CgsPolylineTrailMaterialProperty.prototype.getType=function(e){return"PolylineTrail"},CgsPolylineTrailMaterialProperty.prototype.getValue=function(e,t){Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=this.trailImage;var i,s,o=1;this.feature.map&&(this.meterPerPixel=this.feature.map.getMeterPerPixel(),i=parseFloat(this.meterPerPixel.toFixed(2)),s=map.getHeight(),o=i>this.maxMPP||0==i&&16e6<s?1:(i<this.minMPP&&(i=this.minMPP),i/this.maxMPP));var a=this.duration;return t.time=(performance.now()-this._time)%a/a,t.scale=o,t},CgsPolylineTrailMaterialProperty.prototype.equals=function(e){return this===e||e instanceof CgsPolylineTrailMaterialProperty&&Cesium.Property.equals(this._color,e._color)},Cesium.Material.PolylineTrailType="PolylineTrail",Cesium.Material.PolylineTrailImage="colors.png",Cesium.Material.PolylineTrailSource=" czm_material czm_getMaterial(czm_materialInput materialInput)\n {\n czm_material material = czm_getDefaultMaterial(materialInput);\n vec2 st = materialInput.st;\n st.s = fract(st.s - time) / scale;\n vec4 colorImage;\n if(st.s >= 0.0 && st.s <= 1.0) {\n    colorImage = texture2D(image, vec2(st.s, st.t));\n}else{\n    colorImage = vec4(1.0,1.0,1.0,0.0);\n}\n material.alpha = colorImage.a;\n material.diffuse = colorImage.rgb;\n return material;\n }",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineTrailType,{fabric:{type:Cesium.Material.PolylineTrailType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:Cesium.Material.PolylineTrailImage,time:0,scale:1},source:Cesium.Material.PolylineTrailSource},translucent:function(){return!0}}),Cesium.CgsPolylineTrailMaterialProperty=CgsPolylineTrailMaterialProperty,CgsImageFlyLine=function(e){this.selfType="CgsImageFlyLine",this.allPositions=[],CgsFeature.call(this,e),null==e?(this.name="",this.positions=[[118,30,5e4],[120,32,5e4]],this.evenColor="rgba(255,255,255,1.0)",this.width=2,this.show=!0,this.followSurface=!0,this.time=3e3,this.saveFlag=!0):(this.returnFlag=!!e.returnFlag&&e.returnFlag,this.bindedLine=e.bindedLine,this.bindedLine instanceof CgsArc?e.positions=this.bindedLine.coordinates:(this.bindedLine instanceof CgsParabola||this.bindedLine instanceof CgsLine)&&(e.positions=this.bindedLine.feature3D.positions),this.name=void 0===e.name?"":e.name,this.positions=void 0===e.positions?[[118,30,5e4],[120,32,5e4]]:e.positions,this.width=void 0===e.width?2:e.width,this.time=void 0===e.time?3e3:e.time,this.imageUrl=void 0===e.imageUrl?CGS_SDK_PATH+"assets/image/1.png":e.imageUrl,this.saveFlag=void 0===e.saveFlag||e.saveFlag,this.visibleIn2D=void 0!==e.visibleIn2D&&e.visibleIn2D);var t=!1;if(2==this.positions.length){var i,s=this.positions,o=new Array;if("[object Array]"==Object.prototype.toString.call(s[0]))for(var a=0;a<s.length;a++){3==s[a].length&&(t=!0);for(var n=s[a],r=0;r<n.length;r++)o.push(n[r])}else o=s;i=t?new Cesium.CatmullRomSpline({times:[0,1],points:[Cesium.Cartesian3.fromDegrees(o[0],o[1],o[2]),Cesium.Cartesian3.fromDegrees(o[3],o[4],o[5])]}):new Cesium.CatmullRomSpline({times:[0,1],points:[Cesium.Cartesian3.fromDegrees(o[0],o[1],0),Cesium.Cartesian3.fromDegrees(o[2],o[3],0)]});for(var l=[],a=0;a<100;a++){var u=i.evaluate(a/100),p=Cesium.Cartographic.fromCartesian(u),h=[];e.followSurface?(h.push(180*p.longitude/Math.PI,180*p.latitude/Math.PI,0),this.allPositions.push(180*p.longitude/Math.PI),this.allPositions.push(180*p.latitude/Math.PI),this.allPositions.push(0)):(h.push(180*p.longitude/Math.PI,180*p.latitude/Math.PI,p.height),this.allPositions.push(180*p.longitude/Math.PI),this.allPositions.push(180*p.latitude/Math.PI),this.allPositions.push(p.height)),l.push(h)}this.poslist=l}else{this.poslist=e.positions,3==e.positions[0].length&&(t=!0);for(a=0;a<this.poslist.length;++a)for(var c=this.poslist[a],r=0;r<c.length;++r)this.allPositions.push(c[r])}var g=new Cesium.CgsPolylineTrailMaterialProperty({color:Cesium.Color.GREEN,duration:this.time,trailImage:this.imageUrl,feature:this});this.entity=new Cesium.Entity({show:this.show,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(this.allPositions),width:this.width,material:g}}),(this.entity.feature=this).bflag=t,this.type="imageflyline"},CgsInherits(CgsImageFlyLine,CgsFeature),CgsImageFlyLine.prototype.getId=function(){if(this.entities&&0<this.entities.length)return this.entities[0].getId()},CgsImageFlyLine.prototype.setVisible=function(e){if(this.getVisible()!=e)for(var t=0;t<this.entities.length;t++)this.entities[t].setVisible(e)},CgsImageFlyLine.prototype.getVisible=function(){if(this.entities&&0<this.entities.length)return this.entities[0].getVisible()},CgsImageFlyLine.prototype.getType=function(){return this.type},CgsImageFlyLine.prototype.getEvenColor=function(){return this.evenColor},CgsImageFlyLine.prototype.setEvenColor=function(e){for(var t=0;t<this.entities.length;t++)this.entities[t].setFillColor(e)},CgsImageFlyLine.prototype.getWidth=function(){return this.width},CgsImageFlyLine.prototype.getTime=function(){return this.time},CgsImageFlyLine.prototype.getName=function(){return this.name},CgsImageFlyLine.prototype.getPosition=function(){return this.positions},CgsImageFlyLine.prototype.getSaveFlag=function(){return this.saveFlag},CgsImageFlyLine.prototype.setSaveFlag=function(e){this.saveFlag=e},CgsImageFlyLine.prototype.getSelfType=function(){return this.selfType},CgsImageFlyLine.prototype.save=function(){return{evenColor:this.getEvenColor(),width:this.getWidth(),show:this.getVisible(),time:this.getTime(),name:this.getName(),positions:this.getPosition(),selfType:this.getSelfType(),visibleIn2D:this.visibleIn2D}},CgsImageFlyLine.load=function(e,t){var i=new CgsImageFlyLine(t);e.addFeature(i)},Cgs3DTilesetLayer=function(e){CgsLayer.call(this,e),null==e.layer&&(e.layer=e.name),1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG||(this.layer3D=new Cgs3DTilesetLayer3D(e)),0==e.visible&&this.setVisible(e.visible)},CgsInherits(Cgs3DTilesetLayer,CgsLayer),Cgs3DTilesetLayer.prototype.getLayer=function(){if(1==window.WGMODEFLAG||3==window.WGMODEFLAG)return this.layer3D.getLayer()},Cgs3DTilesetLayer.prototype.save=function(){var e=this;return{type:"WMTS",url:e.getUrl(),layer:e.getLayer(),rectangle:e.getExtent(),level:e.getLevel(),text:e.getText(),pId:e.getPId(),visible:e.getVisible(),isAddToLayerTree:e.getAddToLayerTree(),minVisLevel:e.getMinVisLevel(),maxVisLevel:e.getMaxVisLevel()}},Cgs3DTilesetLayer.load=function(e,t){var i=new Cgs3DTilesetLayer(t);e.addLayer(i)},Cgs3DTilesetLayer.prototype.setLimitLevel=function(e){this.layer3D&&this.layer3D.setLimitLevel(e)},Cgs3DTilesetLayer.prototype.getLimitLevel=function(){return this.layer3D&&this.layer3D.getLimitLevel()},CgsCSV=function(e){this.pointParam=e.pointParam,this.lineParam=e.lineParam,this.polygonParam=e.polygonParam,this.markParam=e.markParam,this.circleParam=e.circleParam,this.name=e.name,this.metaData=e.metaData,CgsDataSource.call(this,e),this.csvLayer2D=new CgsGroupVector2D({name:e.name}),this.csvLayer3D=new CgsFeatureGroup3D({name:e.name});function t(e){var t=s.parseCSV(e);s.features=s.readFeatures(t);for(var i=0;i<s.features.length;i++)s.features[i].groupName=s.name,s.csvLayer2D.addFeature(s.features[i].feature2D),s.csvLayer3D.addFeature(s.features[i].feature3D)}var s=this;this.metaData?t(e.url):$$.ajax({dataType:"text",async:!1,url:e.url,success:function(e){t(e)},error:function(e,t,i){console.error("mapconfig read error:"+t+"\n"+i)}})},CgsInherits(CgsCSV,CgsDataSource),CgsCSV.prototype.readFeatures=function(e){for(var t=[],i=0;i<e.length;++i){var s=e[i],o=s.type,a=s.coordinates,n=s.name,r=void 0,l=void 0;switch(o){case"Point":(r=this.pointParam).position=a,r.name=n,l=new CgsPoint(r);break;case"Line":(r=this.lineParam).positions=a,r.name=n,l=new CgsLine(r);break;case"Polygon":(r=this.polygonParam).positions=[a],r.name=n,l=new CgsPolygon(r);break;case"Circle":(r=this.circleParam).name=n,r.center=[position[0],position[1]];var u=[position[2],position[3]],p=new ol.Sphere(CgsUtil.EPSG3857_RADIUS);r.radius=p.haversineDistance(r.center,u),l=new CgsCircle(r);break;case"Mark":(r=this.markParam).name=n,r.position=a,l=new CgsMark(r)}l?t.push(l):console.log("数据错误，没有相应类型！")}return t},CgsCSV.prototype.parseCSV=function(e){for(var t=e.split(/[\n]/g),i=(t.splice(0,1)[0].split(","),[]),s=0;s<t.length;++s){var o=t[s];if(""!=o){var a={},n=o.split(",");if("Point"==n[0])a.type=n[0],a.coordinates=[Number(n[1]),Number(n[2])],a.name=n[3];else{if("Line"!=n[0]&&"Polygon"!=n[0]){console.log("数据错误，没有相应类型！");continue}a.type=n[0];for(var r=n[1].split("#"),l=n[2].split("#"),u=[],p=0;p<r.length;++p)u.push([Number(r[p]),Number(l[p])]);a.coordinates=u,a.name=n[3]}i.push(a)}}return i},CgsCSV.prototype.getName=function(){return this.name},CgsCSV.prototype.setVisible=function(e){this.csvLayer2D&&this.csvLayer2D.setVisible(e),this.csvLayer3D&&this.csvLayer3D.setVisible(e)},CgsCSV.prototype.setPickEnable=function(e){this.csvLayer3D&&this.csvLayer3D.setPickEnable(e)},CgsCSV.prototype.getPickEnable=function(){return!!this.csvLayer3D&&this.csvLayer3D.getPickEnable()},CgsPhaseArrayRadar=function(e){CgsRadar.call(this,e),this.feature3D=new CgsPhaseArrayRadar3D(e)},CgsInherits(CgsPhaseArrayRadar,CgsRadar),CgsPhaseArrayRadar.prototype.setVisible=function(e){this.feature3D.setVisible(e)},CgsPhaseArrayRadar.prototype.getVisible=function(){return this.feature3D.getVisible()},CgsPhaseArrayRadar.prototype.setSurfaceColor=function(e){this.feature3D.setSurfaceColor(e)},CgsPhaseArrayRadar.prototype.getSurfaceColor=function(){return this.feature3D.getSurfaceColor()},CgsPhaseArrayRadar.prototype.setLineColor=function(e){this.feature3D.setLineColor(e)},CgsPhaseArrayRadar.prototype.getLineColor=function(){return this.feature3D.getLineColor()},CgsPhaseArrayRadar.prototype.setScanPlaneColor=function(e){this.feature3D.setScanPlaneColor(e)},CgsPhaseArrayRadar.prototype.getScanPlaneColor=function(){return this.feature3D.getScanPlaneColor()},CgsPhaseArrayRadar.prototype.setDomeSurfacesVisible=function(e){this.feature3D.setDomeSurfacesVisible(e)},CgsPhaseArrayRadar.prototype.getDomeSurfacesVisible=function(){return this.feature3D.getDomeSurfacesVisible()},CgsPhaseArrayRadar.prototype.setDomeLinesVisible=function(e){this.feature3D.setDomeLinesVisible(e)},CgsPhaseArrayRadar.prototype.getDomeLinesVisible=function(){return this.feature3D.getDomeLinesVisible()},CgsPhaseArrayRadar.prototype.setLateralSurfacesVisible=function(e){this.feature3D.setLateralSurfacesVisible(e)},CgsPhaseArrayRadar.prototype.getLateralSurfacesVisible=function(){return this.feature3D.getLateralSurfacesVisible()},CgsPhaseArrayRadar.prototype.setLateralLinesVisible=function(e){this.feature3D.setLateralSurfacesVisible(e)},CgsPhaseArrayRadar.prototype.getLateralLinesVisible=function(){return this.feature3D.getLateralLinesVisible()},CgsPhaseArrayRadar.prototype.setScanPlaneVisible=function(e){this.feature3D.setScanPlaneVisible(e)},CgsPhaseArrayRadar.prototype.getScanPlaneVisible=function(){return this.feature3D.getScanPlaneVisible()},CgsPhaseArrayRadar.prototype.setScanPlaneMode=function(e){this.feature3D.setScanPlaneMode(e)},CgsPhaseArrayRadar.prototype.getScanPlaneMode=function(){return this.feature3D.getScanPlaneMode()},CgsPhaseArrayRadar.prototype.setScanPlaneRate=function(e){this.feature3D.setScanPlaneRate(e)},CgsPhaseArrayRadar.prototype.getScanPlaneRate=function(){return this.feature3D.getScanPlaneRate()},CgsPhaseArrayRadar.prototype.setThroughEllipsoidVisible=function(e){this.feature3D.setThroughEllipsoidVisible(e)},CgsPhaseArrayRadar.prototype.getThroughEllipsoidVisible=function(){return this.feature3D.getThroughEllipsoidVisible()},CgsPhaseArrayRadar.prototype.setXAngle=function(e){this.feature3D.setXAngle(e)},CgsPhaseArrayRadar.prototype.getXAngle=function(){return this.feature3D.getXAngle()},CgsPhaseArrayRadar.prototype.setYAngle=function(e){this.feature3D.setYAngle(e)},CgsPhaseArrayRadar.prototype.getYAngle=function(){return this.feature3D.getYAngle()},CgsPhaseArrayRadar.prototype.setPosition=function(e){this.feature3D.setPosition(e)},CgsPhaseArrayRadar.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsPhaseArrayRadar.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsPhaseArrayRadar.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsPhaseArrayRadar.prototype.setHeading=function(e){this.feature3D.setHeading(e)},CgsPhaseArrayRadar.prototype.getHeading=function(){return this.feature3D.getHeading()},CgsPhaseArrayRadar.prototype.setPitch=function(e){this.feature3D.setPitch(e)},CgsPhaseArrayRadar.prototype.getPitch=function(){return this.feature3D.getPitch()},CgsPhaseArrayRadar.prototype.setRoll=function(e){this.feature3D.setRoll(e)},CgsPhaseArrayRadar.prototype.getRoll=function(){return this.feature3D.getRoll()},CgsTimeDynamicTerrain=function(e){this.terrain3D=new CgsTimeDynamicTerrain3D(e)},CgsTimeDynamicTerrain.prototype.setClockCurrentTime=function(e){this.terrain3D.setClockCurrentTime(e)},CgsTimeDynamicTerrain.prototype.createTimeLine=function(){this.terrain3D.createTimeLine()},CgsTimeDynamicTerrain.prototype.makeTics=function(){this.terrain3D.makeTics()},CgsTimeDynamicTerrain.prototype.getBodyElement=function(){return this.terrain3D.body},CgsTimeDynamicTerrain.prototype.getIsReady=function(){return this.terrain3D.isReady},CgsTimeDynamicTerrain.prototype.getCloseButtonEle=function(){return this.layer3D.closeButtonEle},CgsBigDataDisplay=function(e){if(!e||!e.map||!e.callback)throw new Error("param is wrong");this.map=e.map,this.callback=e.callback,this.farType=e.farType=e.farType||"image",this.nearType=e.nearType=e.nearType||"mark",this.imageParam=e.imageParam=e.imageParam||{},this.honeycombParam=e.honeycombParam=e.honeycombParam||{},this.markParam=e.markParam=e.markParam||{},this.pointParam=e.pointParam=e.pointParam||{},this.heatmapParam=e.heatmapParam=e.heatmapParam||{},this.heatmap2DParam=e.heatmap2DParam=e.heatmap2DParam||{},this.count=this.heatmap2DParam.count=this.heatmap2DParam.count||1,this.heatmap2DParam.only2D=!0,this.level=e.level=e.level||8,this.level2D=e.level2D=e.level2D||6,this.lastLevel=0,this.lastCenterLon=0,this.maxRequestNumber=e.maxRequestNumber=e.maxRequestNumber||1e4,this.maxDisplayNumber=e.maxDisplayNumber=e.maxDisplayNumber||1e4,this.moveEndId2d=null,this.moveEndId3d=null,this.area={west:-180,east:180,south:-90,north:90},this.farFeatures=[],this.nearFeatures=[],this.honeycombLayer=void 0,this.heatmapLayer=void 0,this.heatmap2DLayer=void 0,this.preCenter=void 0;var t=this.callback(this.area,this.maxRequestNumber,0),r=this;t.then(function(e){r.data=e,r.data&&("image"==r.farType?r.createImage(r.data):"honeycomb"==r.farType?r.createHoneycomb(r.data):"heatmap"==r.farType&&(r.createHeatmap(r.data),r.createHeatmap2D(r.data)),"mark"==r.nearType?r.createMark(e):"point"==r.nearType&&r.createPoint(e))},function(){console.log("请求数据失败或者数据错误！")}),this.onCameraChanged=function(){var e=r.map.map3D.scene.globe._surface._debug.maxDepth,t=r.map.map3D.camera.computeViewRectangle(),i=t.west/Math.PI*180,s=t.north/Math.PI*180,o={west:i,east:t.east/Math.PI*180,south:t.south/Math.PI*180,north:s},a=[r.map.map3D.canvas.clientWidth/2,r.map.map3D.canvas.clientHeight/2],n=r.map.pixelToLonLat(a);n&&(r.preCenter&&r.preCenter==n||(r.preCenter=n,0<r.nearFeatures.length&&r.callback(o,r.maxDisplayNumber,1).then(function(e){"image"==r.farType?r.farFeatures.forEach(function(e){return e.feature3D.setVisible(!1)}):"honeycomb"==r.farType?r.honeycombLayer&&r.honeycombLayer.setVisible(!1):"heatmap"==r.farType&&r.heatmapLayer&&r.heatmapLayer.setVisible(!1);for(var t,i=e.length,s=0;s<r.nearFeatures.length;++s){s<i?(r.nearFeatures[s].feature3D.setPosition([e[s].x,e[s].y]),r.nearFeatures[s].feature3D.setVisible(!0),"airport_bdd"==(t=e[s].type)?r.nearFeatures[s].airportInfo=e[s].airportInfo:"port_bdd"==t&&(r.nearFeatures[s].portInfo=e[s].portInfo)):r.nearFeatures[s].feature3D.setVisible(!1)}})),r.lastLevel=e)},this.zoomChanged=function(){var e,t;"2D"==r.map.mode&&(r.map.getZoom()>=r.level2D?("image"==r.farType?r.farFeatures.forEach(function(e){return e.feature2D.setVisible(!1)}):"honeycomb"==r.farType?r.honeycombLayer&&r.honeycombLayer.setVisible(!1):"heatmap"==r.farType&&r.heatmap2DLayer&&r.heatmap2DLayer.setVisible(!1),t={west:(e=r.map.getExtent())[0],east:e[2],south:e[1],north:e[3]},0<r.nearFeatures.length&&r.callback(t,r.maxDisplayNumber,1).then(function(e){for(var t,i=e.length,s=0;s<r.nearFeatures.length;++s){s<i?(r.nearFeatures[s].feature2D.setPosition([e[s].x,e[s].y]),r.nearFeatures[s].feature2D.setVisible(!0),"airport"==(t=e[s].type)?r.nearFeatures[s].airportInfo=e[s].airportInfo:"port"==t&&(r.nearFeatures[s].portInfo=e[s].portInfo)):r.nearFeatures[s].feature2D.setVisible(!1)}})):"image"==r.farType?(r.farFeatures.forEach(function(e){return e.feature2D.setVisible(!0)}),r.nearFeatures.forEach(function(e){return e.feature2D.setVisible(!1)})):"honeycomb"==r.farType?(r.honeycombLayer&&r.honeycombLayer.setVisible(!0),r.nearFeatures.forEach(function(e){return e.feature2D.setVisible(!1)})):"heatmap"==r.farType&&(r.heatmap2DLayer&&!r.heatmap2DLayer.getVisible()&&r.heatmap2DLayer.setVisible(!0),r.nearFeatures.forEach(function(e){return e.feature2D.setVisible(!1)})))},this.moveEndId3d=CgsSubPub.subscribe(CgsEvent.eMoveEnd,this.onCameraChanged),this.moveEndId2d=CgsSubPub.subscribe("moveend2d",this.zoomChanged)},CgsBigDataDisplay.prototype.createImage=function(e){var i=this;e.map(function(e){var t=new CgsMark({position:[e.x,e.y],url:i.imageParam.url,scale:i.imageParam.scale,name:i.imageParam.name,pixelOffset:i.imageParam.pixelOffset});"airport_bdd"==e.type?(t.type=e.type,t.airportInfo=e.airportInfo):"port_bdd"==e.type&&(t.type=e.type,t.portInfo=e.portInfo),i.farFeatures.push(t),i.map.addFeature(t)})},CgsBigDataDisplay.prototype.createMark=function(e){var i=this;e.map(function(e){var t=new CgsMark({position:[e.x,e.y],url:i.markParam.url,scale:i.markParam.scale,name:i.markParam.name,pixelOffset:i.markParam.pixelOffset});"airport_bdd"==e.type?(t.type=e.type,t.airportInfo=e.airportInfo):"port_bdd"==e.type&&(t.type=e.type,t.portInfo=e.portInfo),t.setVisible(!1),i.nearFeatures.push(t),i.map.addFeature(t)})},CgsBigDataDisplay.prototype.createHoneycomb=function(e){var t=[];e.map(function(e){t.push({geometry:{type:"Point",coordinates:[e[0],e[1]]},count:e[2]})}),this.honeycombLayer=new CgsBigDataV(t,this.honeycombParam),this.map.addBDVLayer(this.honeycombLayer)},CgsBigDataDisplay.prototype.createHeatmap2D=function(e){var t=this,i=[];e.map(function(e){i.push({geometry:{type:"Point",coordinates:[e.x,e.y]},count:t.count})}),this.heatmap2DLayer=new CgsBigDataV(i,this.heatmap2DParam),this.map.addBDVLayer(this.heatmap2DLayer)},CgsBigDataDisplay.prototype.createHeatmap=function(e){this.heatmapLayer=new CgsCesiumHeatmap({map:this.map,size:this.heatmapParam&&this.heatmapParam.size,intensity:this.heatmapParam&&this.heatmapParam.intensity,geojsonUrl:this.heatmapParam&&this.heatmapParam.geojsonUrl}),this.heatmapParam&&this.heatmapParam.geojsonUrl||this.heatmapLayer.init(e)},CgsBigDataDisplay.prototype.createPoint=function(e){var i=this;e.map(function(e){var t=new CgsPoint({position:[e[0],e[1]],fillColor:i.pointParam.fillColor,outlineColor:i.pointParam.outlineColor,name:i.pointParam.name,pixelSize:i.pointParam.pixelSize,outlineWidth:i.pointParam.outlineWidth});"airport_bdd"==e.type?(t.type=e.type,t.airportInfo=e.airportInfo):"port_bdd"==e.type&&(t.type=e.type,t.portInfo=e.portInfo),t.setVisible(!1),i.nearFeatures.push(t),i.map.addFeature(t)})},CgsBigDataDisplay.prototype.setVisible=function(t){t?(this.moveEndId3d=CgsSubPub.subscribe(CgsEvent.eMoveEnd,this.onCameraChanged),this.moveEndId2d=CgsSubPub.subscribe("moveend2d",this.zoomChanged),this.onCameraChanged(),this.zoomChanged()):(this.honeycombLayer&&this.honeycombLayer.setVisible(t),this.heatmapLayer&&this.heatmapLayer.setVisible(t),this.heatmap2DLayer&&this.heatmap2DLayer.setVisible(t),this.nearFeatures.forEach(function(e){e.feature2D.setVisible(t),e.feature3D.setVisible(t)}),this.farFeatures.forEach(function(e){e.feature2D.setVisible(t),e.feature3D.setVisible(t)}),this.map.map3D.camera.changed.removeEventListener(this.onCameraChanged),this.moveEndId2d&&CgsSubPub.unsubscribe(this.moveEndId2d),this.moveEndId3d&&CgsSubPub.unsubscribe(this.moveEndId3d))},CgsBigDataDisplay.prototype.dispose=function(){var t=this;this.honeycombLayer&&this.map.removeBDVLayer(honeycombLayer),this.heatmap2DLayer&&this.map.removeBDVLayer(heatmap2DLayer),this.heatmapLayer&&this.heatmapLayer.dispose(),this.map.map3D.camera.changed.removeEventListener(this.onCameraChanged),this.moveEndId2d&&CgsSubPub.unsubscribe(this.moveEndId2d),this.moveEndId3d&&CgsSubPub.unsubscribe(this.moveEndId3d),this.nearFeatures.forEach(function(e){return t.map.removeFeature(e)}),this.nearFeatures=void 0,this.farFeatures.forEach(function(e){return t.map.removeFeature(e)}),this.farFeatures=void 0},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/groundSiteQueryPlugg/CgsGroundSiteQuery.css"/>'),CgsGroundSiteQuery=function(e){var P=this;this.body=$$("<div id='groundSiteQueryplugg' class='CgsGroundSiteQuery'></div>"),$$(map.container).append(this.body);var t,P=this;function i(){var e;3==P.keyMode&&(!P.tempSelectPoint&&0!=P.tempSelectPoint||(e="drapTrall"+P.tempSelectPoint.id,document.getElementById(e).click()),P.lastSearchInput!=$$("input#myInput2").val()&&document.getElementById("groundSiteQuerySearchBtn").click())}function T(){P.tempSelectPoint&&(M(P.tempSelectPoint,"blue"),P.tempSelectPoint.placeInfo.trAll.css("background-color",P.tempSelectPoint.placeInfo.defaultColor)),P.tempSelectPoint=null}function s(){P.lastSelectPoint||(P.lastSelectPoint=P.markGroup[0]),P.tempSelectPoint?(P.tempSelectPoint.id!=P.lastSelectPoint.id&&(P.tempSelectPoint.placeInfo.trAll.css("background-color",P.tempSelectPoint.placeInfo.defaultColor),M(P.tempSelectPoint,"blue")),P.tempSelectPoint.id==P.markGroup.length-1?P.tempSelectPoint=P.markGroup[0]:P.tempSelectPoint=P.markGroup[P.tempSelectPoint.id+1]):P.tempSelectPoint=P.markGroup[P.lastSelectPoint.id+1],P.tempSelectPoint.id!=P.lastSelectPoint.id&&(P.tempSelectPoint.placeInfo.trAll.css("background-color","#2f5ea4"),M(P.tempSelectPoint,"red")),$$(".CgsGroundSiteQuery_tableDiv").animate({scrollTop:32*P.tempSelectPoint.id},1)}function o(){P.lastSelectPoint||(P.lastSelectPoint=P.markGroup[0]),P.tempSelectPoint?(P.tempSelectPoint.id!=P.lastSelectPoint.id&&(P.tempSelectPoint.placeInfo.trAll.css("background-color",P.tempSelectPoint.placeInfo.defaultColor),M(P.tempSelectPoint,"blue")),0==P.tempSelectPoint.id?P.tempSelectPoint=P.markGroup[P.markGroup.length-1]:P.tempSelectPoint=P.markGroup[P.tempSelectPoint.id-1]):0==P.lastSelectPoint.id?P.tempSelectPoint=P.markGroup[P.markGroup.length-1]:P.tempSelectPoint=P.markGroup[P.lastSelectPoint.id-1],P.tempSelectPoint.id!=P.lastSelectPoint.id&&(P.tempSelectPoint.placeInfo.trAll.css("background-color","#2f5ea4"),M(P.tempSelectPoint,"red")),$$(".CgsGroundSiteQuery_tableDiv").animate({scrollTop:32*P.tempSelectPoint.id},1)}function M(e,t){var i;i="red"==t?"url('"+CGS_SDK_PATH+"plugg/groundSiteQuery/image/bubbleRed.png":"url('"+CGS_SDK_PATH+"plugg/groundSiteQuery/image/bubbleBlue.png","3D"==P.map.mode?$$(e.overlay3D.dom).find("div").css("background-image",i):$$(e.overlay2D.element).find("div").css("background-image",i)}this.map=e,this.lastInput=null,this.url=map.allPropertiesConfigs.dmssUrl,this.dropNum=6,this.markGroup=[],this.listGroup=[],this.logGroup=[],this.lastMarkGroup=[],this.delayNum=0,this.lastSelectPoint=null,this.lastSelectTr=null,this.tempSelectPoint=null,this.tempSelectList=null,this.tempSelectLog=null,this.buttonFlag=!1,this.keyMode=null,this.hideButtomFlag=!1,P.mistinessSearchFlag=!0,this.searchMode=null,this.lastSearchInput=null,function(){$$("<div></div>").addClass("groundSiteQueryContainer");var e=P.body,t=$$("<div></div>");t.addClass("CgsGroundSiteQuery_container"),t.appendTo(e),$$('<div title="搜索按钮" ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsGroundSiteQuery_searchbuttonimg"><a href="#" id="groundSiteQuerySearchBtn"  ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsGroundSiteQuery_searchbutton"></a></div>').appendTo(t);var l=$$("<div></div>");l.addClass("CgsGroundSiteQuery_body"),l.appendTo(t);var s=$$('<input type="text" placeholder="请输入查询的地址地名" id="myInput2"></input>');s.appendTo(l),$$('<i id="deleteallinfo"></i>').appendTo(l);var i=$$('<div title="拖拽按钮" id="dmssmovebtn" ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsGroundSiteQuery_movebuttonimg"><a href="#" ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsGroundSiteQuery_movebutton"></a></div>');i.appendTo(t),i.css("display","none");var o=$$("<div>输入关键字：</div>");function a(){$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3").style.display="none",$$("table").remove(".CgsGroundSiteQuery_table"),P.lastSelectTr=null,$$("div").remove(".CgsGroundSiteQuery_table_hidebuttom"),$$("div").remove(".CgsGroundSiteQuery_tableDiv"),s.blur(),$$(document.getElementById("myInput2")).val(""),h()}o.addClass("CgsGroundSiteQuery_btn"),o.appendTo(t),p("myInput2","input propertychange",function(){P.delayNum++,setTimeout(function(){P.delayNum--,0==P.delayNum&&function(){$$("p").remove(".drap-line"),document.getElementById("myInputDiv3").style.display="none",$$("div").remove(".drap-deletelog"),P.searchMode=1;{if(""==$$("input#myInput2").val())return P.keyMode=1,u();this.lastInput=$$("input#myInput2").val()}!function(e){var t=JSON.parse(sessionStorage.getItem("cgsdmsslog"));null==t&&(t=[]);-1!=t.indexOf(e)&&t.splice(t.indexOf(e),1);t.push(e),5<t.length&&t.splice(0,1);window.sessionStorage.removeItem("cgsdmsslog"),window.sessionStorage.cgsdmsslog=JSON.stringify(t)}($$("input#myInput2").val());var e=encodeURIComponent(encodeURIComponent($$("input#myInput2").val())),t=CGS_SDK_PATH+"proxy/proxy.jsp?address=",i=$$("input#myInput2").val();function s(e,t){if(P.lastSearchInput!=t&&P.mistinessSearchFlag){P.keyMode=1;for(var i,o,a,e=e.records,s=0;s<e.length;s++)e[s].geometrysInfo.geometrys=b(e[s].geometrysInfo.geometrys),e[s].centerLat=parseFloat(e[s].centerLat),e[s].centerLng=parseFloat(e[s].centerLng);!function(){if(0!=P.markGroup.length)for(var e=0;e<P.markGroup.length;e++){P.markGroup[e].overlay&&P.markGroup[e].overlay.setVisible(!1);for(var t=0;t<P.markGroup[e].closeFeature.length;t++)P.markGroup[e].closeFeature[t].setVisible(!1);P.markGroup[e].setVisible(!1)}}(),P.lastSelectPoint&&D(P.lastSelectPoint),t==$$("input#myInput2").val()&&(0!=e.length?(document.getElementById("myInputDiv3").style.display="",i=e,this.dataObj=i,$$("p").remove(".drap-line"),o=0,a=[],_.each(i,function(e,t){var i,s;-1==e.layer.indexOf("街区")&&(o<P.dropNum&&((i=$$('<p class="drap-line"><a herf="#">'+e.name+"</a></p>")).appendTo(n),i.id=o,s={tr:i,obj:e},a.push(s)),o++)}),P.tempSelectLog=null,P.logGroup=a,setTimeout(function(){for(var e=a.length<P.dropNum?a.length:P.dropNum,t=0;t<e;t++)a[t].tr.attr("id","drapline"+t),a[t].tr.click(function(){document.getElementById("dmssmovebtn").style.display="none";for(var e=parseInt($$(this).attr("id").slice(8)),t=0;t<P.listGroup.length;t++){P.map.removeOverlay(P.listGroup[t].overlay);for(var i=0;i<P.listGroup[t].closeFeature.length;i++)P.map.removeFeature(P.listGroup[t].closeFeature[i]);P.map.removeOverlay(P.listGroup[t])}P.listGroup=[],document.getElementById("myInputDiv3").style.display="none",$$("#myInput2").val(a[e].obj.name),r(),S()})},400)):document.getElementById("myInputDiv3").style.display="none")}}$$.ajax({type:"GET",url:t+P.url+e,success:function(e){s(e,i)},dataType:"json"})}()},1e3)}),p("myInput2","focus",function(){P.keyMode=1,""===$$("input#myInput2").val()&&u();document.getElementById("dmssmovebtn").style.display=""}),p("myInput2","blur",function(){P.keyMode=3}),p("deleteallinfo","click",a),$(".CgsGroundSiteQuery_button1").click(function(){r()}),$(".CgsGroundSiteQuery_button").click(function(){a()}),CgsSubPub.subscribe(CgsEvent.eFeatureClickOut,function(e,t,i){$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3").style.display="none",s.blur(),document.getElementById("dmssmovebtn").style.display="none"}),s.bind("keyup",function(e){"13"==e.keyCode&&1==P.keyMode&&function(){if(P.tempSelectLog||0==P.tempSelectLog){var e="drapline"+P.tempSelectLog;if(document.getElementById(e))return document.getElementById(e).click()}P.tempSelectLog||(P.buttonFlag=!0,document.getElementById("groundSiteQuerySearchBtn").click())}(),"40"==e.keyCode&&1==P.keyMode&&function(){{var e;e=(null==P.tempSelectLog?P.tempSelectLog=0:(e="drapline"+P.tempSelectLog,$$(document.getElementById(e)).css("background","rgba(14,30,45,0.8)"),P.tempSelectLog==P.logGroup.length-1?P.tempSelectLog=0:P.tempSelectLog=P.tempSelectLog+1),"drapline"+P.tempSelectLog),$$(document.getElementById(e)).css("background","#35ACC1")}}(),"38"==e.keyCode&&1==P.keyMode&&function(){{var e;e=(null==P.tempSelectLog?P.tempSelectLog=P.logGroup.length-1:(e="drapline"+P.tempSelectLog,$$(document.getElementById(e)).css("background","rgba(14,30,45,0.8)"),0==P.tempSelectLog?P.tempSelectLog=P.logGroup.length-1:P.tempSelectLog=P.tempSelectLog-1),"drapline"+P.tempSelectLog),$$(document.getElementById(e)).css("background","#35ACC1")}}()}),$$(".CgsGroundSiteQuery_searchbuttonimg").click(function(){P.buttonFlag&&r()}),$$(".CgsGroundSiteQuery_searchbuttonimg").mouseover(function(){P.buttonFlag=!0}),$$(".CgsGroundSiteQuery_searchbuttonimg").mouseout(function(){P.buttonFlag=!1});var n=$$('<div style="display:none" id="myInputDiv3"></div>');function r(){if(!P.mistinessSearchFlag)return $$("p").remove(".drap-line"),void $$("div").remove(".drap-deletelog");var e,t,i;""!=$$("input#myInput2").val()&&(P.mistinessSearchFlag=!1,P.searchMode=2,h(),e=encodeURIComponent(encodeURIComponent($$("input#myInput2").val())),t=CGS_SDK_PATH+"proxy/proxy.jsp?address=",i=$$("input#myInput2").val(),$$.ajax({type:"GET",url:t+P.url+e,success:function(e){!function(e,t){if(0==e.length)return;P.keyMode=3,P.keyMode=3;for(var e=e.records,i=0;i<e.length;i++)e[i].geometrysInfo.geometrys=b(e[i].geometrysInfo.geometrys),e[i].centerLat=parseFloat(e[i].centerLat),e[i].centerLng=parseFloat(e[i].centerLng);if(P.lastSelectPoint){$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3").style.display="none";for(var s=0;s<P.markGroup.length;s++)if(P.markGroup[s]!==P.lastSelectPoint){P.markGroup[s].overlay&&P.map.removeOverlay(P.markGroup[s].overlay);for(var o=0;o<P.markGroup[s].closeFeature.length;o++)this.map.removeFeature(P.markGroup[s].closeFeature[o]);this.map.removeOverlay(P.markGroup[s])}P.markGroup=[]}if(t!=$$("input#myInput2").val())return;document.getElementById("myInputDiv3").style.display="none";var a=e;this.dataObj=a,$$("p").remove(".drap-line");var p=1,h=[],n=$$('<div class="CgsGroundSiteQuery_tableDiv"></div>');if(n.appendTo(l),0==e.length){var r=$$('<div class="noresponse">未搜索到结果！</div>');return $$(document.getElementsByClassName("CgsGroundSiteQuery_body")).css("border-bottom","1px solid #3869ab"),r.appendTo(n),P.tempSelectLog=null,P.mistinessSearchFlag=!0}var c=$$('<table id="CgsGroundSiteQuery_table" class="CgsGroundSiteQuery_table" cellspacing="1" cellpadding="0"></table>');c.appendTo(n);var g=!0;$$("<tr></tr>");_.each(a,function(e,t){var i=$$("<tr></tr>"),s=$$('<td class="CgsGroundSiteQuery_table_td_num">'+p+"</td>"),o=$$('<td class="CgsGroundSiteQuery_table_td_name">'+e.name+"</td>"),a=$$('<td class="CgsGroundSiteQuery_table_td_layer">'+e.layer+"</td>"),n=$$('<td class="CgsGroundSiteQuery_table_td_lonlat"></td>');s.appendTo(i),o.appendTo(i),a.appendTo(i),n.appendTo(i);var r=$$('<a herf="#">['+parseFloat(e.centerLng).toFixed(2)+","+parseFloat(e.centerLat).toFixed(2)+"]</a>");r.appendTo(n),i.appendTo(c);var l=null;g=g?(i.css("background","#0d1d2d"),!(l="#0d1d2d")):(i.css("background","#1a3047"),l="#1a3047",!0);var u={tr:r,trAll:i,obj:e,defaultColor:l};h.push(u),p++});var d=$$('<div class="CgsGroundSiteQuery_table_hidebuttom"></div>');(P.myTableHide=d).appendTo(l),$$('<div class="CgsGroundSiteQuery_table_hidebuttom_bg"></div>').appendTo(d),setTimeout(function(){for(var e=[],t=0;t<h.length;t++){5==h[t].obj.geometryTypeId?(h[t].obj.geometrysInfo.geometrys[0].points,h[t].obj.pos=[h[t].obj.geometrysInfo.geometrys[0].points[Math.round(h[t].obj.geometrysInfo.geometrys[0].points.length/2)][0],h[t].obj.geometrysInfo.geometrys[0].points[Math.round(h[t].obj.geometrysInfo.geometrys[0].points.length/2)][1],2.5*parseInt(m(h[t].obj.geometrysInfo.geometrys))]):h[t].obj.pos=[h[t].obj.centerLng,h[t].obj.centerLat,2.5*parseInt(m(h[t].obj.geometrysInfo.geometrys))],e.push(function(e,t,s,o){var i=[e.obj.pos[0],e.obj.pos[1]],a=P.map;{var n;n="3D"==P.map.mode?[-10,-20]:[-15,-20]}var r=new CgsOverlay({position:i,positioning:"center-center",element:$$("\n                                <div class = 'oponyPopMark'>\n                                <div style=\"cursor: default\">\n                                </div>\n                                </div>\n                                ").get(0),draggable:!1,showLine:!1,offset:n});{var l;this.map.addOverlay(r),l="3D"==P.map.mode?r.overlay3D.dom:r.overlay2D.element}$$($$(l).find("div")[0]).html(s+1),$$($$(l).context).attr("id","markflag"+s),o&&"mark"!=o?"list"==o&&($$(l).mouseover(function(){r.placeInfo.tr.css("background","#35ACC1")}),$$(l).mouseout(function(){r.placeInfo.tr.css("background","rgba(39, 52, 61,0)")})):($$(l).mouseover(function(){var e=$$(".CgsGroundSiteQuery_tableDiv");$$("#drapTrall32"),parseInt($$($$(l).context).attr("id"));e.animate({scrollTop:32*(s-1)},1),setTimeout(function(){r.placeInfo.trAll&&r.placeInfo!=P.lastSelectTr&&r.placeInfo.trAll.css("background","#2f5ea4")},5)}),$$(l).mouseout(function(){setTimeout(function(){r.placeInfo.trAll&&r.placeInfo!=P.lastSelectTr&&r.placeInfo.trAll.css("background",r.placeInfo.defaultColor)},7)}));$$(l).click(function(){var e;if(document.getElementById("dmssmovebtn").style.display="none",o&&"mark"!=o?"list"==o&&(e=P.listGroup[s]):e=P.markGroup[s],T(),C(e.placeInfo),!e.overlay.getVisible()){D(P.lastSelectPoint),e.placeInfo.obj.pos,e.overlay.setVisible(!0);e.placeInfo.obj.pos;for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!0);for(var i=0;i<P.listGroup.length;i++)v(P.listGroup[i]);y(e),D(P.lastSelectPoint),P.lastSelectPoint=e}}),r.groundSiteQueryFlag=!0,r.placeInfo=e,r.closeFeature=[],o&&"mark"!=o?"list"==o&&P.listGroup.push(r):P.markGroup.push(r);!s&&0!=s||(r.id=s);var u=e.obj.geometryType,p=e.obj.geometrysInfo.geometrys;if(1!=u)if(2==u){for(var h=[],c=0;c<p[0].points.length;c++)h.push([p[0].points[c][0],p[0].points[c][1]]);var g={positions:h,followSurface:!0,width:1,fillColor:"rgba(29,192,255,1.0)"},d=new CgsLine(g);a.addFeature(d),d.setVisible(!1),r.closeFeature.push(d)}else if(3==u){for(h=[],c=0;c<p[0].points.length;c++)h.push([p[0].points[c][0],p[0].points[c][1]]);var g={positions:h,fillColor:"rgba(29,192,255,0.3)",outlineColor:"rgba(29,192,255,1.0)",outlineWidth:1},m=new CgsPolygon(g);a.addFeature(m),m.setVisible(!1),r.closeFeature.push(m)}else if(4!=u)if(5==u)for(var f=0;f<p.length;f++){for(h=[],c=0;c<p[f].points.length;c++)h.push([p[f].points[c][0],p[f].points[c][1]]),f!=Math.round(p.length/2)&&1!=p.length||c!=Math.round(p[f].points.length/2)||(p[f].points[c][0],p[f].points[c][1]);g={positions:h,followSurface:!0,width:1,fillColor:"rgba(29,192,255,1.0)"},d=new CgsLine(g);a.addFeature(d),d.setVisible(!1),r.closeFeature.push(d)}else if(6==u)for(f=0;f<p.length;f++){for(h=[],c=0;c<p[f].points.length;c++)h.push([p[f].points[c][0],p[f].points[c][1]]);g={positions:h,fillColor:"rgba(29,192,255,0.3)",outlineColor:"rgba(29,192,255,1.0)",outlineWidth:1},m=new CgsPolygon(g);a.addFeature(m),m.setVisible(!1),r.closeFeature.push(m)}if(t&&"nomark"==t){r.setVisible(!0);for(f=0;f<r.closeFeature.length;f++)r.closeFeature[f].setVisible(!0);r.nomark=!0}return r}(h[t],null,t))}for(var i=[],s=[],o=[],t=0;t<e.length;t++){var a=function(e){var t=e.placeInfo,i=[t.obj.pos[0],t.obj.pos[1]],s=new CgsOverlay({position:[i[0],i[1],0],positioning:"top-center",element:$$("\n\t\t\t\t\t<div class = 'oponyPop'>\n\t\t\t\t\t\t\t<div class='oponyPop__lineContainer'>\n\t\t\t\t\t\t\t    <div class='oponyPop__lineSpanGroup'>\n                                <div class='oponyPop__list_head'><span class=\"oponyPop__country\">地标名</span><span></span></div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">所在国</span><span></span></div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">所属省</span><span></span></div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">数据来</span><span></span> </div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">位置座</span><span></span> </div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">地标等</span><span></span> </div>\n\t\t\t\t\t\t\t    </div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>    \n\t\t\t\t\t").get(0),offset:[152,-200],draggable:!0,showLine:!0,isRoundCorner:!0,roundCornerSize:7});P.map.addOverlay(s),(P.infoBox=s).setVisible(!1),s.type="infobox";var o=null;s.overlay3D?o=s.overlay3D.dom:(o=s.overlay2D.element,$$(o).css("z-index","599"));16<t.obj.name.length&&$$(o).css("width","280px");$$($$(o).find("span")[1]).html("称: "+t.obj.name),"未知"==t.obj.country?($$($$(o).find("span")[3]).css("display","none"),$$($$(o).find("span")[2]).css("display","none")):$$($$(o).find("span")[3]).html("家: "+t.obj.country);"未知"==t.obj.province?($$($$(o).find("span")[5]).css("display","none"),$$($$(o).find("span")[4]).css("display","none")):$$($$(o).find("span")[5]).html("份: "+t.obj.province);$$($$(o).find("span")[7]).html("源: "+t.obj.comment),$$($$(o).find("span")[9]).html("标: ["+t.obj.centerLng.toFixed(2)+","+t.obj.centerLat.toFixed(2)+"]"),$$($$(o).find("span")[11]).html("级: "+t.obj.layer),e.overlay=s,e.nomark&&s.setVisible(!0);return e}(e[t]);i.push({points:[[h[t].obj.pos[0],h[t].obj.pos[1]]]}),s.push(h[t].obj.pos[0]),o.push(h[t].obj.pos[1]),0==t&&(f(a),C(a.placeInfo))}var n=Math.max.apply(null,s),r=Math.min.apply(null,s),l=Math.max.apply(null,o),u=Math.min.apply(null,o);65e5<m(i,"real")?P.map.flyTo({destination:[h[0].obj.centerLng,h[0].obj.centerLat,2.3*m(i)],duration:1,noFlyHigher:!0}):P.map.flyTo({destination:[(n+r)/2,(l+u)/2,2*m(i)],duration:1,noFlyHigher:!0});for(t=0;t<h.length;t++)h[t].trAll&&(h[t].trAll.attr("id","drapTrall"+t),h[t].trAll.click(function(){document.getElementById("dmssmovebtn").style.display="none",T(),S(),w();var e=parseInt($$(this).attr("id").slice(9));P.lastSelectPoint&&D(P.lastSelectPoint),C(h[e]),document.getElementById("myInputDiv3").style.display="none",h[e].obj.pos=[h[e].obj.centerLng,h[e].obj.centerLat,2.5*parseInt(m(h[e].obj.geometrysInfo.geometrys))],map.flyTo({destination:h[e].obj.pos,duration:1,noFlyHigher:!0}),f(P.markGroup[e]),y(P.lastSelectPoint)}),h[t].trAll.mouseover(function(){var e=parseInt($$(this).attr("id").slice(9));P.markGroup[e]&&M(P.markGroup[e],"red")}),h[t].trAll.mouseout(function(){var e=parseInt($$(this).attr("id").slice(9));P.lastSelectPoint&&P.markGroup[e]&&(P.lastSelectPoint.placeInfo.obj.centerLat!=P.markGroup[e].placeInfo.obj.centerLat||P.lastSelectPoint.placeInfo.obj.centerLng!=P.markGroup[e].placeInfo.obj.centerLng)&&M(P.markGroup[e],"blue")}));P.lastSelectPoint&&y(P.lastSelectPoint),d.click(function(){var e;$$(".CgsGroundSiteQuery_table").slideToggle(50,null),P.hideButtomFlag=!P.hideButtomFlag,e=P.hideButtomFlag?"url('"+CGS_SDK_PATH+"plugg/groundSiteQuery/image/show.png":"url('"+CGS_SDK_PATH+"plugg/groundSiteQuery/image/hide.png",$$(document.getElementsByClassName("CgsGroundSiteQuery_table_hidebuttom_bg")).css("background-image",e)}),P.updateOverlay3dom()},300),setTimeout(function(){P.mistinessSearchFlag=!0},300)}(e,i)},dataType:"json",error:function(){P.mistinessSearchFlag=!0}}),P.keyMode=3,P.lastSearchInput=$$("input#myInput2").val(),P.lastInput=$$("input#myInput2").val())}function C(e){P.lastSelectTr&&P.lastSelectTr.trAll.css("background-color",P.lastSelectTr.defaultColor),e.trAll.css("background-color","#2f5ea4"),P.lastSelectTr=e}function y(e){if(!e.placeInfo.trAll)for(var t=0;t<P.markGroup.length;t++){P.lastSelectPoint.placeInfo.obj.centerLat==P.markGroup[t].placeInfo.obj.centerLat&&P.lastSelectPoint.placeInfo.obj.centerLng==P.markGroup[t].placeInfo.obj.centerLng&&(i=P.markGroup[t])}var i;M(i=i||e,"red")}function v(e){if(!e.placeInfo.trAll)for(var t=0;t<P.markGroup.length;t++){P.lastSelectPoint.placeInfo.obj.centerLat==P.markGroup[t].placeInfo.obj.centerLat&&P.lastSelectPoint.placeInfo.obj.centerLng==P.markGroup[t].placeInfo.obj.centerLng&&(i=P.markGroup[t])}var i;M(i=i||e,"blue")}function m(e,t){for(var i=[],s=[],o=0;o<e.length;o++)for(var a=0;a<e[o].points.length;a++)i.push(e[o].points[a][0]),s.push(e[o].points[a][1]);var n,r,l,u=Math.max.apply(null,i),p=Math.min.apply(null,i),h=Math.max.apply(null,s),c=Math.min.apply(null,s);return 1==window.WGMODEFLAG||3==window.WGMODEFLAG?(n=Cesium.Cartesian3.fromDegrees(p,c),r=Cesium.Cartesian3.fromDegrees(u,h),l=Cesium.Cartesian3.distance(n,r)):2==window.WGMODEFLAG&&(l=25e5),t||(l<1e3?l=2e5:25e5<l&&(l=25e5)),l}function u(){P.tempSelectLog=null,h();var e=JSON.parse(sessionStorage.getItem("cgsdmsslog"));if(null!=e){var t=[];P.logGroup=null;for(var i,s=e.length-1;0<=s;s--){var o=$$('<p class="drap-line"><a herf="#">  '+e[s]+"</a></p>");o.appendTo(n);var a={tr:o,session:e[s]};t.push(a)}P.logGroup=t,document.getElementById("myInputDiv3").style.display="",setTimeout(function(){for(var e=0;e<t.length;e++)t[e].tr.attr("id","drapline"+e),t[e].tr.click(function(){h();var e=parseInt($$(this).attr("id").slice(8));t[e]&&($$("#myInput2").val(t[e].session),r())})},20),P.trButton||((i=$$('<div class="drap-deletelog"></div>')).appendTo(n),P.trButton=$$('<p style="text-align: center"><a herf="#">清除搜索记录..</a></p>'),P.trButton.appendTo(i),setTimeout(function(){P.trButton&&P.trButton.click(function(){h(),window.sessionStorage.removeItem("cgsdmsslog")})},100))}}function p(t,i,s){var o=setInterval(function(){var e;document.getElementById(t)&&(window.clearInterval(o),e=document.getElementById(t),$("#"+t).bind(i,function(){s(e)}))},1)}function f(e){if(e){e.setVisible(!0);for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!0);e.overlay.setVisible(!0),P.lastSelectPoint=e}}function b(e){for(var t=0;t<e.length;t++)for(var i=0;i<e[t].points.length;i++){var s=e[t].points[i].split(",");s[0]=parseFloat(s[0]),s[1]=parseFloat(s[1]),e[t].points[i]=s}return e}function h(e){$$(document.getElementsByClassName("CgsGroundSiteQuery_body")).css("border-bottom","0px"),document.getElementById("dmssmovebtn").style.display="none",P.tempSelectPoint=null,$$("table").remove(".CgsGroundSiteQuery_table"),$$("div").remove(".CgsGroundSiteQuery_table_hidebuttom"),$$("div").remove(".CgsGroundSiteQuery_tableDiv"),P.myTableHide=null,P.lastSelectTr=null,$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3")&&(document.getElementById("myInputDiv3").style.display="none"),P.markGroup=[];for(var t=0;t<P.map.overlays.length;t++)P.map.overlays[t].placeInfo&&P.markGroup.push(P.map.overlays[t]);if(0!=P.markGroup.length)for(t=0;t<P.markGroup.length;t++){P.markGroup[t].overlay&&P.markGroup[t]!=e&&P.map.removeOverlay(P.markGroup[t].overlay);for(var i=0;i<P.markGroup[t].closeFeature.length;i++)P.markGroup[t]!=e&&P.map.removeFeature(P.markGroup[t].closeFeature[i]);P.map.removeOverlay(P.markGroup[t])}e?(P.markGroup=[e],P.lastSelectPoint=e):(P.markGroup=[],P.lastSelectPoint=null),P.trButton=null}function D(e){if(e&&e.overlay.getVisible()){e.overlay&&e.overlay.setVisible(!1);for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!1);v(e)}}function S(){if(0!=P.listGroup.length){for(var e=0;e<P.listGroup.length;e++){P.listGroup[e].overlay&&P.map.removeOverlay(P.listGroup[e].overlay);for(var t=0;t<P.listGroup[e].closeFeature.length;t++)P.map.removeFeature(P.listGroup[e].closeFeature[t]);P.map.removeOverlay(P.listGroup[e])}P.listGroup=[]}}function w(){if(0!=P.markGroup.length)for(var e=0;e<P.markGroup.length;e++)P.markGroup[e].setVisible(!0)}n.addClass("CgsGroundSiteQuery_droplist"),n.appendTo(t),CgsSubPub.subscribe(CgsEvent.eModeChanged,function(e,t,i){if("3D"==t){for(var s,o=0;o<P.markGroup.length;o++){"3D"==i.mode||(s=P.markGroup[o].overlay2D.element),$$(s).attr("id","drapTrall"+o),$$(s).click(function(){document.getElementById("dmssmovebtn").style.display="none",S(),w();var e=parseInt($$(this).attr("id").slice(9));P.lastSelectPoint&&(M(P.lastSelectPoint,"blue"),$$(document.getElementById(P.lastSelectPoint.overlay3D.dom.id)).css("background-image",url),D(P.lastSelectPoint)),C(P.markGroup[e].placeInfo),document.getElementById("myInputDiv3").style.display="none",P.markGroup[e].placeInfo.obj.pos=[P.markGroup[e].placeInfo.obj.centerLng,P.markGroup[e].placeInfo.obj.centerLat,2.5*parseInt(m(P.markGroup[e].placeInfo.obj.geometrysInfo.geometrys))],i.flyTo({destination:P.markGroup[e].placeInfo.obj.pos,duration:1,noFlyHigher:!0}),y(P.markGroup[e]),f(P.markGroup[e])}),$$(s).mouseover(function(){var e=parseInt($$(this).attr("id").slice(9));P.markGroup[e]&&("3D"==P.map.mode&&($$(".CgsGroundSiteQuery_tableDiv").animate({scrollTop:32*(e-1)},1),setTimeout(function(){P.markGroup[e].placeInfo.trAll&&P.markGroup[e].placeInfo!=P.lastSelectTr&&P.markGroup[e].placeInfo.trAll.css("background","#2f5ea4")},5)),M(P.markGroup[e],"red"))}),$$(s).mouseout(function(){var e=parseInt($$(this).attr("id").slice(9));P.lastSelectPoint&&P.markGroup[e]&&(P.lastSelectPoint.placeInfo.obj.centerLat!=P.markGroup[e].placeInfo.obj.centerLat||P.lastSelectPoint.placeInfo.obj.centerLng!=P.markGroup[e].placeInfo.obj.centerLng)&&("3D"==P.map.mode&&setTimeout(function(){P.markGroup[e].placeInfo.trAll&&P.markGroup[e].placeInfo!=P.lastSelectTr&&P.markGroup[e].placeInfo.trAll.css("background",P.markGroup[e].placeInfo.defaultColor)},7),M(P.markGroup[e],"blue"))})}for(o=0;o<i.overlays.length;o++)i.overlays[o].placeInfo&&i.overlays[o].setPixelOffset([0,12])}else for(o=0;o<i.overlays.length;o++)i.overlays[o].placeInfo&&i.overlays[o].setPixelOffset([-15,-30]),i.overlays[o].type&&"infobox"==i.overlays[o].type&&$$(i.overlays[o].overlay2D.element).css("z-index","800")}),CgsSubPub.subscribe(CgsEvent.eFeatureDoubleClick,function(e,t,i,s){!t.groundSiteQueryFlag||t instanceof CgsMark||(t.overlay.setVisible(!1),t.setVisible(!1))})}(),document.onkeydown?(t=document.onkeydown,document.onkeydown=function(e){t(e),"13"==e.keyCode&&3==P.keyMode&&i(),"40"==e.keyCode&&0<P.markGroup.length&&3==P.keyMode&&s(),"38"==e.keyCode&&0<P.markGroup.length&&3==P.keyMode&&o()}):document.onkeydown=function(e){"13"==e.keyCode&&3==P.keyMode&&i(),"40"==e.keyCode&&0<P.markGroup.length&&3==P.keyMode&&s(),"38"==e.keyCode&&0<P.markGroup.length&&3==P.keyMode&&o()},setTimeout(function(){var t=2e12;$$(".CgsGroundSiteQuery_movebutton").mousedown(function(e){t=(new Date).valueOf(),document.getElementById("myInput2").blur()}),$$(".CgsGroundSiteQuery_movebutton").mouseup(function(){t=2e12}),document.addEventListener("mousemove",function(e){10<(new Date).valueOf()-t&&1==e.which&&($$(document.getElementById("groundSiteQueryplugg")).css("left",e.clientX-290+"px"),$$(document.getElementById("groundSiteQueryplugg")).css("top",e.clientY-120+"px")),0==e.which&&(t=2e12)})},100);var a=CGS_SDK_PATH+"assets/image/ablum.png";this.title=$$("<div class='CgsLayerTool__title CgsTool__title' style='width: 352px'><img class='CgsLayerTool__titleImg' ><span class='CgsLayerTool__titleText' style='font-size: 10px;'>地名搜索</span><div class='CgsLayerTool__closeButton'></div></div>"),this.title.find(".CgsLayerTool__titleImg").attr("src",a),this.title.find(".CgsLayerTool__title CgsTool__title").attr("width","650px"),CgsTool.call(this,e,this.title,this.body)},CgsInherits(CgsGroundSiteQuery,CgsTool),CgsGroundSiteQuery.prototype.activate=function(){CgsUtil.defined(this.body)&&this.body.show()},CgsGroundSiteQuery.prototype.deactivate=function(){CgsUtil.defined(this.body)&&this.body.hide();var e=this;if($$("p").remove(".drap-line"),$$("table").remove(".CgsGroundSiteQuery_table"),e.lastSelectTr=null,$$("div").remove(".CgsGroundSiteQuery_table_hidebuttom"),$$("div").remove(".CgsGroundSiteQuery_tableDiv"),document.getElementById("myInputDiv3").style.display="none",0!=e.markGroup.length){for(var t=0;t<e.markGroup.length;t++){e.markGroup[t].overlay&&e.map.removeOverlay(e.markGroup[t].overlay);for(var i=0;i<e.markGroup[t].closeFeature.length;i++)this.map.removeFeature(e.markGroup[t].closeFeature[i]);this.map.removeOverlay(e.markGroup[t])}e.markGroup=[]}$$("#myInput2").val("")},CgsGroundSiteQuery.prototype.updateOverlay3dom=function(){for(var e,t=0;t<this.markGroup.length;t++){this.markGroup[t].overlay3D&&0<this.markGroup[t].overlay3D.clones.length&&(CgsOverlay.clone(this.markGroup[t]),this.map.map3D.removeFeature(this.markGroup[t].overlay3D.clones[0]),this.markGroup[t].overlay3D.clones.shift(),this.map.map3D.addFeature(this.markGroup[t].overlay3D.clones[0])),this.markGroup[t].overlay.overlay3D&&0<this.markGroup[t].overlay.overlay3D.clones.length&&(e=this.markGroup[t].overlay.getVisible(),CgsOverlay.clone(this.markGroup[t].overlay),this.map.map3D.removeFeature(this.markGroup[t].overlay.overlay3D.clones[0]),this.markGroup[t].overlay.overlay3D.clones.shift(),this.map.map3D.addFeature(this.markGroup[t].overlay.overlay3D.clones[0]),this.markGroup[t].overlay.overlay3D.setVisible(e))}},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/fuzzyQueryPlugg/CgsFuzzyQuery.css"/>'),CgsFuzzyQuery=function(e,t){this.rootid="fuzzyQueryplugg";var i="<div id='"+this.rootid+"' class='CgsFuzzyQuery'></div>";this.body=$$(i),t&&this.body.css("top",t.toString()+"px"),this.container=$$(map.container),this.container.append(this.body);this.map=e,this.lastInput=null,this.dropNum=6,this.markGroup=[],this.listGroup=[]},CgsInherits(CgsFuzzyQuery,CgsTool),CgsFuzzyQuery.prototype.loadDate=function(e,t){var h=t.fieldId,c=t.fieldName,p=t.useFieldFilter,g=t.filterFields,d=g;t.filterFieldsName&&t.filterFieldsName.length==g.length&&(d=t.filterFieldsName);var m=this;function f(e){if(e){e.setVisible(!0);for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!0);e.overlay.setVisible(!0),m.lastSelectPoint=e}}function C(){m.tempSelectPoint&&(S(m.tempSelectPoint,"blue"),m.tempSelectPoint.placeInfo.trAll.css("background-color",m.tempSelectPoint.placeInfo.defaultColor)),m.tempSelectPoint=null}function y(e){if(e&&e.overlay.getVisible()){e.overlay&&e.overlay.setVisible(!1);for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!1);D(e)}}function v(e){m.lastSelectTr&&m.lastSelectTr.trAll.css("background-color",m.lastSelectTr.defaultColor),e.trAll.css("background-color","#2f5ea4"),m.lastSelectTr=e}function b(e){if(!e.placeInfo.trAll)for(var t=0;t<m.markGroup.length;t++){m.lastSelectPoint.placeInfo.obj.centerLat==m.markGroup[t].placeInfo.obj.centerLat&&m.lastSelectPoint.placeInfo.obj.centerLng==m.markGroup[t].placeInfo.obj.centerLng&&(i=m.markGroup[t])}var i;S(i=i||e,"red")}function D(e){if(!e.placeInfo.trAll)for(var t=0;t<m.markGroup.length;t++){m.lastSelectPoint.placeInfo.obj.centerLat==m.markGroup[t].placeInfo.obj.centerLat&&m.lastSelectPoint.placeInfo.obj.centerLng==m.markGroup[t].placeInfo.obj.centerLng&&(i=m.markGroup[t])}var i;S(i=i||e,"blue")}function S(e,t){var i;i="red"==t?"url('"+CGS_SDK_PATH+"plugg/fuzzyQuery/image/bubbleRed.png":"url('"+CGS_SDK_PATH+"plugg/fuzzyQuery/image/bubbleBlue.png","3D"==m.map.mode?$$(e.overlay3D.dom).find("div").css("background-image",i):$$(e.overlay2D.element).find("div").css("background-image",i)}function w(e,t){for(var i=[],s=[],o=0;o<e.length;o++)for(var a=0;a<e[o].points.length;a++)i.push(e[o].points[a][0]),s.push(e[o].points[a][1]);var n,r,l,u=Math.max.apply(null,i),p=Math.min.apply(null,i),h=Math.max.apply(null,s),c=Math.min.apply(null,s);return 1==window.WGMODEFLAG||3==window.WGMODEFLAG?(n=Cesium.Cartesian3.fromDegrees(p,c),r=Cesium.Cartesian3.fromDegrees(u,h),l=Cesium.Cartesian3.distance(n,r)):2==window.WGMODEFLAG&&(l=25e5),t||(l<1e3?l=2e5:25e5<l&&(l=25e5)),l}if(0!=e.length){m.clearDust();for(var e=e.features,i=0;i<e.length;i++){var s=e[i].geometry.coordinates[0],o=e[i].geometry.coordinates[1];e[i].centerLat=parseFloat(o),e[i].centerLng=parseFloat(s)}var P,T,M=1,L=[],a=e,n=$$('<div class="CgsKeywordQuery_tableDiv"></div>');n.css("width","350px"),n.appendTo(m.body),0!=e.length?((P=$$('<table id="CgsFuzzyQuery_table" class="CgsFuzzyQuery_table" cellspacing="1" cellpadding="0"></table>')).appendTo(n),T=!0,$$("<tr></tr>"),_.each(a,function(e,t){var i=e.properties,s=$$("<tr></tr>"),o=$$('<td class="CgsFuzzyQuery_table_td_num">'+M+"</td>"),a=$$('<td class="CgsFuzzyQuery_table_td_name">'+i[h]+"</td>"),n=$$('<td class="CgsFuzzyQuery_table_td_layer">'+i[c]+"</td>"),r=$$('<td class="CgsFuzzyQuery_table_td_lonlat"></td>');o.appendTo(s),a.appendTo(s),n.appendTo(s),r.appendTo(s);var l=$$('<a herf="#">['+e.centerLng.toFixed(2)+","+e.centerLat.toFixed(2)+"]</a>");l.appendTo(r),s.appendTo(P);var u=null;T=T?(s.css("background","#0d1d2d"),!(u="#0d1d2d")):(s.css("background","#1a3047"),u="#1a3047",!0);var p={tr:l,trAll:s,obj:e,defaultColor:u};L.push(p),M++}),setTimeout(function(){for(var e=[],t=0;t<L.length;t++)L[t].obj.pos=[L[t].obj.centerLng,L[t].obj.centerLat,2.5*parseInt(2e5)],e.push(function(e,s,o){var t,i=[e.obj.pos[0],e.obj.pos[1]];m.map,t="3D"==m.map.mode?[-10,-20]:[-15,-20];var a,n=new CgsOverlay({position:i,positioning:"center-center",element:$$("\n                                <div class = 'oponyPopMark'>\n                                <div style=\"cursor: default\">\n                                </div>\n                                </div>\n                                ").get(0),draggable:!1,showLine:!1,offset:t});return this.map.addOverlay(n),a="3D"==m.map.mode?n.overlay3D.dom:n.overlay2D.element,$$($$(a).find("div")[0]).html(s+1),$$($$(a).context).attr("id","markflag"+s),o&&"mark"!=o?"list"==o&&($$(a).mouseover(function(){n.placeInfo.tr.css("background","#35ACC1")}),$$(a).mouseout(function(){n.placeInfo.tr.css("background","rgba(39, 52, 61,0)")})):($$(a).mouseover(function(){var e=$$(".CgsKeywordQuery_tableDiv");$$("#drapTrall32"),parseInt($$($$(a).context).attr("id"));e.animate({scrollTop:32*(s-1)},1),setTimeout(function(){n.placeInfo.trAll&&n.placeInfo!=m.lastSelectTr&&n.placeInfo.trAll.css("background","#2f5ea4")},5)}),$$(a).mouseout(function(){setTimeout(function(){n.placeInfo.trAll&&n.placeInfo!=m.lastSelectTr&&n.placeInfo.trAll.css("background",n.placeInfo.defaultColor)},7)})),$$(a).click(function(){var e;if(o&&"mark"!=o?"list"==o&&(e=m.listGroup[s]):e=m.markGroup[s],C(),v(e.placeInfo),!e.overlay.getVisible()){y(m.lastSelectPoint),e.placeInfo.obj.pos,e.overlay.setVisible(!0);e.placeInfo.obj.pos;for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!0);for(var i=0;i<m.listGroup.length;i++)D(m.listGroup[i]);b(e),y(m.lastSelectPoint),m.lastSelectPoint=e}}),n.keywordQueryFlag=!0,n.placeInfo=e,n.closeFeature=[],o&&"mark"!=o?"list"==o&&m.listGroup.push(n):m.markGroup.push(n),!s&&0!=s||(n.id=s),n}(L[t],t));for(var i=[],s=[],o=[],t=0;t<e.length;t++){var a=function(e){var t=e.placeInfo,i=[t.obj.pos[0],t.obj.pos[1]],s=t.obj.properties,o="<div class = 'oponyPop'><div class='oponyPop__lineContainer'><div class='oponyPop__lineSpanGroup'>";if(o+="<div class='oponyPop__list_head'><span class=\"oponyPop__country\">名称:"+s[c]+"</span></div>",p&&g)for(var a=0;a<g.length;a++)o+="<div class='oponyPop__list_head'><span class=\"oponyPop__country\">"+d[a]+":"+s[g[a]]+"</span></div>";o+=" <div class='oponyPop__list'><span class=\"oponyPop__country\">位置坐标:["+t.obj.centerLng.toFixed(2)+","+t.obj.centerLat.toFixed(2)+"]</span></div>",o+="</div></div></div> ";var n=new CgsOverlay({position:[i[0],i[1],0],positioning:"top-center",element:$$(o).get(0),offset:[152,-200],draggable:!0,showLine:!0,isRoundCorner:!0,roundCornerSize:7});return m.map.addOverlay(n),(m.infoBox=n).setVisible(!1),n.type="infobox",o=null,n.overlay3D?o=n.overlay3D.dom:(o=n.overlay2D.element,$$(o).css("z-index","599")),e.overlay=n,e.nomark&&n.setVisible(!0),e}(e[t]);i.push({points:[[L[t].obj.pos[0],L[t].obj.pos[1]]]}),s.push(L[t].obj.pos[0]),o.push(L[t].obj.pos[1]),0==t&&(f(a),v(a.placeInfo))}var n=Math.max.apply(null,s),r=Math.min.apply(null,s),l=Math.max.apply(null,o),u=Math.min.apply(null,o);65e5<w(i,"real")?m.map.flyTo({destination:[L[0].obj.centerLng,L[0].obj.centerLat,2.3*w(i)],duration:1,noFlyHigher:!0}):m.map.flyTo({destination:[(n+r)/2,(l+u)/2,2*w(i)],duration:1,noFlyHigher:!0});for(t=0;t<L.length;t++)L[t].trAll&&(L[t].trAll.attr("id","drapTrall"+t),L[t].trAll.click(function(){C(),function(){if(0!=m.listGroup.length){for(var e=0;e<m.listGroup.length;e++){m.listGroup[e].overlay&&m.map.removeOverlay(m.listGroup[e].overlay);for(var t=0;t<m.listGroup[e].closeFeature.length;t++)m.map.removeFeature(m.listGroup[e].closeFeature[t]);m.map.removeOverlay(m.listGroup[e])}m.listGroup=[]}}();var e=parseInt($$(this).attr("id").slice(9));m.lastSelectPoint&&y(m.lastSelectPoint),v(L[e]),L[e].obj.pos=[L[e].obj.centerLng,L[e].obj.centerLat,2.5*parseInt(w(L[e].obj.geometrysInfo.geometrys))],map.flyTo({destination:L[e].obj.pos,duration:1,noFlyHigher:!0}),f(m.markGroup[e]),b(m.lastSelectPoint)}),L[t].trAll.mouseover(function(){var e=parseInt($$(this).attr("id").slice(9));m.markGroup[e]&&S(m.markGroup[e],"red")}),L[t].trAll.mouseout(function(){var e=parseInt($$(this).attr("id").slice(9));m.lastSelectPoint&&m.markGroup[e]&&(m.lastSelectPoint.placeInfo.obj.centerLat!=m.markGroup[e].placeInfo.obj.centerLat||m.lastSelectPoint.placeInfo.obj.centerLng!=m.markGroup[e].placeInfo.obj.centerLng)&&S(m.markGroup[e],"blue")}));m.lastSelectPoint&&b(m.lastSelectPoint),m.updateOverlay3dom()},300)):$$('<div class="noresponse">未搜索到结果！</div>').appendTo(n)}},CgsFuzzyQuery.prototype.clearDust=function(e){var t=this;t.tempSelectPoint=null;var i=document.getElementById(t.rootid);0<i.childNodes.length&&i.removeChild(i.childNodes[0]),t.markGroup=[];for(var s=0;s<t.map.overlays.length;s++)t.map.overlays[s].placeInfo&&t.markGroup.push(t.map.overlays[s]);if(0!=t.markGroup.length)for(s=0;s<t.markGroup.length;s++){t.markGroup[s].overlay&&t.markGroup[s]!=e&&t.map.removeOverlay(t.markGroup[s].overlay);for(var o=0;o<t.markGroup[s].closeFeature.length;o++)t.markGroup[s]!=e&&t.map.removeFeature(t.markGroup[s].closeFeature[o]);t.map.removeOverlay(t.markGroup[s])}e?(t.markGroup=[e],t.lastSelectPoint=e):(t.markGroup=[],t.lastSelectPoint=null)},CgsFuzzyQuery.prototype.activate=function(){CgsUtil.defined(this.body)&&this.body.show()},CgsFuzzyQuery.prototype.deactivate=function(){var e,t=this;if(CgsUtil.defined(this.body)&&(this.body.hide(),(e=document.getElementById(t.rootid))&&map.container.removeChild(e)),t.markGroup&&0!=t.markGroup.length){for(var i=0;i<t.markGroup.length;i++){t.markGroup[i].overlay&&t.map.removeOverlay(t.markGroup[i].overlay);for(var s=0;s<t.markGroup[i].closeFeature.length;s++)this.map.removeFeature(t.markGroup[i].closeFeature[s]);this.map.removeOverlay(t.markGroup[i])}t.markGroup=[]}},CgsFuzzyQuery.prototype.updateOverlay3dom=function(){for(var e,t=0;t<this.markGroup.length;t++){this.markGroup[t].overlay3D&&0<this.markGroup[t].overlay3D.clones.length&&(CgsOverlay.clone(this.markGroup[t]),this.map.map3D.removeFeature(this.markGroup[t].overlay3D.clones[0]),this.markGroup[t].overlay3D.clones.shift(),this.map.map3D.addFeature(this.markGroup[t].overlay3D.clones[0])),this.markGroup[t].overlay.overlay3D&&0<this.markGroup[t].overlay.overlay3D.clones.length&&(e=this.markGroup[t].overlay.getVisible(),CgsOverlay.clone(this.markGroup[t].overlay),this.map.map3D.removeFeature(this.markGroup[t].overlay.overlay3D.clones[0]),this.markGroup[t].overlay.overlay3D.clones.shift(),this.map.map3D.addFeature(this.markGroup[t].overlay.overlay3D.clones[0]),this.markGroup[t].overlay.overlay3D.setVisible(e))}},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/keywordQueryPlugg/CgsKeywordQuery.css"/>'),CgsKeywordQuery=function(e){var P=this;this.body=$$("<div id='keywordQueryplugg' class='CgsKeywordQuery'></div>"),$$(map.container).append(this.body);var t,P=this;function i(){var e;3==P.keyMode&&(!P.tempSelectPoint&&0!=P.tempSelectPoint||(e="drapTrall"+P.tempSelectPoint.id,document.getElementById(e).click()),P.lastSearchInput!=$$("input#myInput2").val()&&document.getElementById("keywordQuerySearchBtn").click())}function T(){P.tempSelectPoint&&(M(P.tempSelectPoint,"blue"),P.tempSelectPoint.placeInfo.trAll.css("background-color",P.tempSelectPoint.placeInfo.defaultColor)),P.tempSelectPoint=null}function s(){P.lastSelectPoint||(P.lastSelectPoint=P.markGroup[0]),P.tempSelectPoint?(P.tempSelectPoint.id!=P.lastSelectPoint.id&&(P.tempSelectPoint.placeInfo.trAll.css("background-color",P.tempSelectPoint.placeInfo.defaultColor),M(P.tempSelectPoint,"blue")),P.tempSelectPoint.id==P.markGroup.length-1?P.tempSelectPoint=P.markGroup[0]:P.tempSelectPoint=P.markGroup[P.tempSelectPoint.id+1]):P.tempSelectPoint=P.markGroup[P.lastSelectPoint.id+1],P.tempSelectPoint.id!=P.lastSelectPoint.id&&(P.tempSelectPoint.placeInfo.trAll.css("background-color","#2f5ea4"),M(P.tempSelectPoint,"red")),$$(".CgsKeywordQuery_tableDiv").animate({scrollTop:32*P.tempSelectPoint.id},1)}function o(){P.lastSelectPoint||(P.lastSelectPoint=P.markGroup[0]),P.tempSelectPoint?(P.tempSelectPoint.id!=P.lastSelectPoint.id&&(P.tempSelectPoint.placeInfo.trAll.css("background-color",P.tempSelectPoint.placeInfo.defaultColor),M(P.tempSelectPoint,"blue")),0==P.tempSelectPoint.id?P.tempSelectPoint=P.markGroup[P.markGroup.length-1]:P.tempSelectPoint=P.markGroup[P.tempSelectPoint.id-1]):0==P.lastSelectPoint.id?P.tempSelectPoint=P.markGroup[P.markGroup.length-1]:P.tempSelectPoint=P.markGroup[P.lastSelectPoint.id-1],P.tempSelectPoint.id!=P.lastSelectPoint.id&&(P.tempSelectPoint.placeInfo.trAll.css("background-color","#2f5ea4"),M(P.tempSelectPoint,"red")),$$(".CgsKeywordQuery_tableDiv").animate({scrollTop:32*P.tempSelectPoint.id},1)}function M(e,t){var i;i="red"==t?"url('"+CGS_SDK_PATH+"plugg/keywordQuery/image/bubbleRed.png":"url('"+CGS_SDK_PATH+"plugg/keywordQuery/image/bubbleBlue.png","3D"==P.map.mode?$$(e.overlay3D.dom).find("div").css("background-image",i):$$(e.overlay2D.element).find("div").css("background-image",i)}this.map=e,this.lastInput=null,this.url=map.allPropertiesConfigs.dmssUrl,this.dropNum=6,this.markGroup=[],this.listGroup=[],this.logGroup=[],this.lastMarkGroup=[],this.delayNum=0,this.lastSelectPoint=null,this.lastSelectTr=null,this.tempSelectPoint=null,this.tempSelectList=null,this.tempSelectLog=null,this.buttonFlag=!1,this.keyMode=null,this.hideButtomFlag=!1,P.mistinessSearchFlag=!0,this.searchMode=null,this.lastSearchInput=null,function(){$$("<div></div>").addClass("keywordQueryContainer");var e=P.body,t=$$("<div></div>");t.addClass("CgsKeywordQuery_container"),t.appendTo(e),$$('<div title="搜索按钮" ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsKeywordQuery_searchbuttonimg"><a href="#" id="keywordQuerySearchBtn"  ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsKeywordQuery_searchbutton"></a></div>').appendTo(t);var l=$$("<div></div>");l.addClass("CgsKeywordQuery_body"),l.appendTo(t);var s=$$('<input type="text" placeholder="请输入查询的关键字" id="myInput2"></input>');s.appendTo(l),$$('<i id="deleteallinfo"></i>').appendTo(l);var i=$$('<div title="拖拽按钮" id="dmssmovebtn" ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsKeywordQuery_movebuttonimg"><a href="#" ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsKeywordQuery_movebutton"></a></div>');i.appendTo(t),i.css("display","none");var o=$$("<div>输入关键字：</div>");function a(){$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3").style.display="none",$$("table").remove(".CgsKeywordQuery_table"),P.lastSelectTr=null,$$("div").remove(".CgsKeywordQuery_table_hidebuttom"),$$("div").remove(".CgsKeywordQuery_tableDiv"),s.blur(),$$(document.getElementById("myInput2")).val(""),h()}o.addClass("CgsKeywordQuery_btn"),o.appendTo(t),p("myInput2","input propertychange",function(){P.delayNum++,setTimeout(function(){P.delayNum--,0==P.delayNum&&function(){$$("p").remove(".drap-line"),document.getElementById("myInputDiv3").style.display="none",$$("div").remove(".drap-deletelog"),P.searchMode=1;{if(""==$$("input#myInput2").val())return P.keyMode=1,u();this.lastInput=$$("input#myInput2").val()}!function(e){var t=JSON.parse(sessionStorage.getItem("cgsdmsslog"));null==t&&(t=[]);-1!=t.indexOf(e)&&t.splice(t.indexOf(e),1);t.push(e),5<t.length&&t.splice(0,1);window.sessionStorage.removeItem("cgsdmsslog"),window.sessionStorage.cgsdmsslog=JSON.stringify(t)}($$("input#myInput2").val());var e=encodeURIComponent(encodeURIComponent($$("input#myInput2").val())),t=CGS_SDK_PATH+"proxy/proxy.jsp?address=",i=$$("input#myInput2").val();function s(e,t){if(P.lastSearchInput!=t&&P.mistinessSearchFlag){P.keyMode=1;for(var i,o,a,e=e.records,s=0;s<e.length;s++)e[s].geometrysInfo.geometrys=b(e[s].geometrysInfo.geometrys),e[s].centerLat=parseFloat(e[s].centerLat),e[s].centerLng=parseFloat(e[s].centerLng);!function(){if(0!=P.markGroup.length)for(var e=0;e<P.markGroup.length;e++){P.markGroup[e].overlay&&P.markGroup[e].overlay.setVisible(!1);for(var t=0;t<P.markGroup[e].closeFeature.length;t++)P.markGroup[e].closeFeature[t].setVisible(!1);P.markGroup[e].setVisible(!1)}}(),P.lastSelectPoint&&D(P.lastSelectPoint),t==$$("input#myInput2").val()&&(0!=e.length?(document.getElementById("myInputDiv3").style.display="",i=e,this.dataObj=i,$$("p").remove(".drap-line"),o=0,a=[],_.each(i,function(e,t){var i,s;-1==e.layer.indexOf("街区")&&(o<P.dropNum&&((i=$$('<p class="drap-line"><a herf="#">'+e.name+"</a></p>")).appendTo(n),i.id=o,s={tr:i,obj:e},a.push(s)),o++)}),P.tempSelectLog=null,P.logGroup=a,setTimeout(function(){for(var e=a.length<P.dropNum?a.length:P.dropNum,t=0;t<e;t++)a[t].tr.attr("id","drapline"+t),a[t].tr.click(function(){document.getElementById("dmssmovebtn").style.display="none";for(var e=parseInt($$(this).attr("id").slice(8)),t=0;t<P.listGroup.length;t++){P.map.removeOverlay(P.listGroup[t].overlay);for(var i=0;i<P.listGroup[t].closeFeature.length;i++)P.map.removeFeature(P.listGroup[t].closeFeature[i]);P.map.removeOverlay(P.listGroup[t])}P.listGroup=[],document.getElementById("myInputDiv3").style.display="none",$$("#myInput2").val(a[e].obj.name),r(),S()})},400)):document.getElementById("myInputDiv3").style.display="none")}}$$.ajax({type:"GET",url:t+P.url+e,success:function(e){s(e,i)},dataType:"json"})}()},1e3)}),p("myInput2","focus",function(){P.keyMode=1,""===$$("input#myInput2").val()&&u();document.getElementById("dmssmovebtn").style.display=""}),p("myInput2","blur",function(){P.keyMode=3}),p("deleteallinfo","click",a),$(".CgsKeywordQuery_button1").click(function(){r()}),$(".CgsKeywordQuery_button").click(function(){a()}),CgsSubPub.subscribe(CgsEvent.eFeatureClickOut,function(e,t,i){$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3").style.display="none",s.blur(),document.getElementById("dmssmovebtn").style.display="none"}),s.bind("keyup",function(e){"13"==e.keyCode&&1==P.keyMode&&function(){if(P.tempSelectLog||0==P.tempSelectLog){var e="drapline"+P.tempSelectLog;if(document.getElementById(e))return document.getElementById(e).click()}P.tempSelectLog||(P.buttonFlag=!0,document.getElementById("keywordQuerySearchBtn").click())}(),"40"==e.keyCode&&1==P.keyMode&&function(){{var e;e=(null==P.tempSelectLog?P.tempSelectLog=0:(e="drapline"+P.tempSelectLog,$$(document.getElementById(e)).css("background","rgba(14,30,45,0.8)"),P.tempSelectLog==P.logGroup.length-1?P.tempSelectLog=0:P.tempSelectLog=P.tempSelectLog+1),"drapline"+P.tempSelectLog),$$(document.getElementById(e)).css("background","#35ACC1")}}(),"38"==e.keyCode&&1==P.keyMode&&function(){{var e;e=(null==P.tempSelectLog?P.tempSelectLog=P.logGroup.length-1:(e="drapline"+P.tempSelectLog,$$(document.getElementById(e)).css("background","rgba(14,30,45,0.8)"),0==P.tempSelectLog?P.tempSelectLog=P.logGroup.length-1:P.tempSelectLog=P.tempSelectLog-1),"drapline"+P.tempSelectLog),$$(document.getElementById(e)).css("background","#35ACC1")}}()}),$$(".CgsKeywordQuery_searchbuttonimg").click(function(){P.buttonFlag&&r()}),$$(".CgsKeywordQuery_searchbuttonimg").mouseover(function(){P.buttonFlag=!0}),$$(".CgsKeywordQuery_searchbuttonimg").mouseout(function(){P.buttonFlag=!1});var n=$$('<div style="display:none" id="myInputDiv3"></div>');function r(){if(!P.mistinessSearchFlag)return $$("p").remove(".drap-line"),void $$("div").remove(".drap-deletelog");var e,t,i;""!=$$("input#myInput2").val()&&(P.mistinessSearchFlag=!1,P.searchMode=2,h(),e=encodeURIComponent(encodeURIComponent($$("input#myInput2").val())),t=CGS_SDK_PATH+"proxy/proxy.jsp?address=",i=$$("input#myInput2").val(),$$.ajax({type:"GET",url:t+P.url+e,success:function(e){!function(e,t){if(0==e.length)return;P.keyMode=3,P.keyMode=3;for(var e=e.records,i=0;i<e.length;i++)e[i].geometrysInfo.geometrys=b(e[i].geometrysInfo.geometrys),e[i].centerLat=parseFloat(e[i].centerLat),e[i].centerLng=parseFloat(e[i].centerLng);if(P.lastSelectPoint){$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3").style.display="none";for(var s=0;s<P.markGroup.length;s++)if(P.markGroup[s]!==P.lastSelectPoint){P.markGroup[s].overlay&&P.map.removeOverlay(P.markGroup[s].overlay);for(var o=0;o<P.markGroup[s].closeFeature.length;o++)this.map.removeFeature(P.markGroup[s].closeFeature[o]);this.map.removeOverlay(P.markGroup[s])}P.markGroup=[]}if(t!=$$("input#myInput2").val())return;document.getElementById("myInputDiv3").style.display="none";var a=e;this.dataObj=a,$$("p").remove(".drap-line");var p=1,h=[],n=$$('<div class="CgsKeywordQuery_tableDiv"></div>');if(n.appendTo(l),0==e.length){var r=$$('<div class="noresponse">未搜索到结果！</div>');return $$(document.getElementsByClassName("CgsKeywordQuery_body")).css("border-bottom","1px solid #3869ab"),r.appendTo(n),P.tempSelectLog=null,P.mistinessSearchFlag=!0}var c=$$('<table id="CgsKeywordQuery_table" class="CgsKeywordQuery_table" cellspacing="1" cellpadding="0"></table>');c.appendTo(n);var g=!0;$$("<tr></tr>");_.each(a,function(e,t){var i=$$("<tr></tr>"),s=$$('<td class="CgsKeywordQuery_table_td_num">'+p+"</td>"),o=$$('<td class="CgsKeywordQuery_table_td_name">'+e.name+"</td>"),a=$$('<td class="CgsKeywordQuery_table_td_layer">'+e.layer+"</td>"),n=$$('<td class="CgsKeywordQuery_table_td_lonlat"></td>');s.appendTo(i),o.appendTo(i),a.appendTo(i),n.appendTo(i);var r=$$('<a herf="#">['+parseFloat(e.centerLng).toFixed(2)+","+parseFloat(e.centerLat).toFixed(2)+"]</a>");r.appendTo(n),i.appendTo(c);var l=null;g=g?(i.css("background","#0d1d2d"),!(l="#0d1d2d")):(i.css("background","#1a3047"),l="#1a3047",!0);var u={tr:r,trAll:i,obj:e,defaultColor:l};h.push(u),p++});var d=$$('<div class="CgsKeywordQuery_table_hidebuttom"></div>');(P.myTableHide=d).appendTo(l),$$('<div class="CgsKeywordQuery_table_hidebuttom_bg"></div>').appendTo(d),setTimeout(function(){for(var e=[],t=0;t<h.length;t++){5==h[t].obj.geometryTypeId?(h[t].obj.geometrysInfo.geometrys[0].points,h[t].obj.pos=[h[t].obj.geometrysInfo.geometrys[0].points[Math.round(h[t].obj.geometrysInfo.geometrys[0].points.length/2)][0],h[t].obj.geometrysInfo.geometrys[0].points[Math.round(h[t].obj.geometrysInfo.geometrys[0].points.length/2)][1],2.5*parseInt(m(h[t].obj.geometrysInfo.geometrys))]):h[t].obj.pos=[h[t].obj.centerLng,h[t].obj.centerLat,2.5*parseInt(m(h[t].obj.geometrysInfo.geometrys))],e.push(function(e,t,s,o){var i=[e.obj.pos[0],e.obj.pos[1]],a=P.map;{var n;n="3D"==P.map.mode?[-10,-20]:[-15,-20]}var r=new CgsOverlay({position:i,positioning:"center-center",element:$$("\n                                <div class = 'oponyPopMark'>\n                                <div style=\"cursor: default\">\n                                </div>\n                                </div>\n                                ").get(0),draggable:!1,showLine:!1,offset:n});{var l;this.map.addOverlay(r),l="3D"==P.map.mode?r.overlay3D.dom:r.overlay2D.element}$$($$(l).find("div")[0]).html(s+1),$$($$(l).context).attr("id","markflag"+s),o&&"mark"!=o?"list"==o&&($$(l).mouseover(function(){r.placeInfo.tr.css("background","#35ACC1")}),$$(l).mouseout(function(){r.placeInfo.tr.css("background","rgba(39, 52, 61,0)")})):($$(l).mouseover(function(){var e=$$(".CgsKeywordQuery_tableDiv");$$("#drapTrall32"),parseInt($$($$(l).context).attr("id"));e.animate({scrollTop:32*(s-1)},1),setTimeout(function(){r.placeInfo.trAll&&r.placeInfo!=P.lastSelectTr&&r.placeInfo.trAll.css("background","#2f5ea4")},5)}),$$(l).mouseout(function(){setTimeout(function(){r.placeInfo.trAll&&r.placeInfo!=P.lastSelectTr&&r.placeInfo.trAll.css("background",r.placeInfo.defaultColor)},7)}));$$(l).click(function(){var e;if(document.getElementById("dmssmovebtn").style.display="none",o&&"mark"!=o?"list"==o&&(e=P.listGroup[s]):e=P.markGroup[s],T(),C(e.placeInfo),!e.overlay.getVisible()){D(P.lastSelectPoint),e.placeInfo.obj.pos,e.overlay.setVisible(!0);e.placeInfo.obj.pos;for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!0);for(var i=0;i<P.listGroup.length;i++)v(P.listGroup[i]);y(e),D(P.lastSelectPoint),P.lastSelectPoint=e}}),r.keywordQueryFlag=!0,r.placeInfo=e,r.closeFeature=[],o&&"mark"!=o?"list"==o&&P.listGroup.push(r):P.markGroup.push(r);!s&&0!=s||(r.id=s);var u=e.obj.geometryType,p=e.obj.geometrysInfo.geometrys;if(1!=u)if(2==u){for(var h=[],c=0;c<p[0].points.length;c++)h.push([p[0].points[c][0],p[0].points[c][1]]);var g={positions:h,followSurface:!0,width:1,fillColor:"rgba(29,192,255,1.0)"},d=new CgsLine(g);a.addFeature(d),d.setVisible(!1),r.closeFeature.push(d)}else if(3==u){for(h=[],c=0;c<p[0].points.length;c++)h.push([p[0].points[c][0],p[0].points[c][1]]);var g={positions:h,fillColor:"rgba(29,192,255,0.3)",outlineColor:"rgba(29,192,255,1.0)",outlineWidth:1},m=new CgsPolygon(g);a.addFeature(m),m.setVisible(!1),r.closeFeature.push(m)}else if(4!=u)if(5==u)for(var f=0;f<p.length;f++){for(h=[],c=0;c<p[f].points.length;c++)h.push([p[f].points[c][0],p[f].points[c][1]]),f!=Math.round(p.length/2)&&1!=p.length||c!=Math.round(p[f].points.length/2)||(p[f].points[c][0],p[f].points[c][1]);g={positions:h,followSurface:!0,width:1,fillColor:"rgba(29,192,255,1.0)"},d=new CgsLine(g);a.addFeature(d),d.setVisible(!1),r.closeFeature.push(d)}else if(6==u)for(f=0;f<p.length;f++){for(h=[],c=0;c<p[f].points.length;c++)h.push([p[f].points[c][0],p[f].points[c][1]]);g={positions:h,fillColor:"rgba(29,192,255,0.3)",outlineColor:"rgba(29,192,255,1.0)",outlineWidth:1},m=new CgsPolygon(g);a.addFeature(m),m.setVisible(!1),r.closeFeature.push(m)}if(t&&"nomark"==t){r.setVisible(!0);for(f=0;f<r.closeFeature.length;f++)r.closeFeature[f].setVisible(!0);r.nomark=!0}return r}(h[t],null,t))}for(var i=[],s=[],o=[],t=0;t<e.length;t++){var a=function(e){var t=e.placeInfo,i=[t.obj.pos[0],t.obj.pos[1]],s=new CgsOverlay({position:[i[0],i[1],0],positioning:"top-center",element:$$("\n\t\t\t\t\t<div class = 'oponyPop'>\n\t\t\t\t\t\t\t<div class='oponyPop__lineContainer'>\n\t\t\t\t\t\t\t    <div class='oponyPop__lineSpanGroup'>\n                                <div class='oponyPop__list_head'><span class=\"oponyPop__country\">地标名</span><span></span></div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">所在国</span><span></span></div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">所属省</span><span></span></div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">数据来</span><span></span> </div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">位置座</span><span></span> </div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">地标等</span><span></span> </div>\n\t\t\t\t\t\t\t    </div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>    \n\t\t\t\t\t").get(0),offset:[152,-200],draggable:!0,showLine:!0,isRoundCorner:!0,roundCornerSize:7});P.map.addOverlay(s),(P.infoBox=s).setVisible(!1),s.type="infobox";var o=null;s.overlay3D?o=s.overlay3D.dom:(o=s.overlay2D.element,$$(o).css("z-index","599"));16<t.obj.name.length&&$$(o).css("width","280px");$$($$(o).find("span")[1]).html("称: "+t.obj.name),"未知"==t.obj.country?($$($$(o).find("span")[3]).css("display","none"),$$($$(o).find("span")[2]).css("display","none")):$$($$(o).find("span")[3]).html("家: "+t.obj.country);"未知"==t.obj.province?($$($$(o).find("span")[5]).css("display","none"),$$($$(o).find("span")[4]).css("display","none")):$$($$(o).find("span")[5]).html("份: "+t.obj.province);$$($$(o).find("span")[7]).html("源: "+t.obj.comment),$$($$(o).find("span")[9]).html("标: ["+t.obj.centerLng.toFixed(2)+","+t.obj.centerLat.toFixed(2)+"]"),$$($$(o).find("span")[11]).html("级: "+t.obj.layer),e.overlay=s,e.nomark&&s.setVisible(!0);return e}(e[t]);i.push({points:[[h[t].obj.pos[0],h[t].obj.pos[1]]]}),s.push(h[t].obj.pos[0]),o.push(h[t].obj.pos[1]),0==t&&(f(a),C(a.placeInfo))}var n=Math.max.apply(null,s),r=Math.min.apply(null,s),l=Math.max.apply(null,o),u=Math.min.apply(null,o);65e5<m(i,"real")?P.map.flyTo({destination:[h[0].obj.centerLng,h[0].obj.centerLat,2.3*m(i)],duration:1,noFlyHigher:!0}):P.map.flyTo({destination:[(n+r)/2,(l+u)/2,2*m(i)],duration:1,noFlyHigher:!0});for(t=0;t<h.length;t++)h[t].trAll&&(h[t].trAll.attr("id","drapTrall"+t),h[t].trAll.click(function(){document.getElementById("dmssmovebtn").style.display="none",T(),S(),w();var e=parseInt($$(this).attr("id").slice(9));P.lastSelectPoint&&D(P.lastSelectPoint),C(h[e]),document.getElementById("myInputDiv3").style.display="none",h[e].obj.pos=[h[e].obj.centerLng,h[e].obj.centerLat,2.5*parseInt(m(h[e].obj.geometrysInfo.geometrys))],map.flyTo({destination:h[e].obj.pos,duration:1,noFlyHigher:!0}),f(P.markGroup[e]),y(P.lastSelectPoint)}),h[t].trAll.mouseover(function(){var e=parseInt($$(this).attr("id").slice(9));P.markGroup[e]&&M(P.markGroup[e],"red")}),h[t].trAll.mouseout(function(){var e=parseInt($$(this).attr("id").slice(9));P.lastSelectPoint&&P.markGroup[e]&&(P.lastSelectPoint.placeInfo.obj.centerLat!=P.markGroup[e].placeInfo.obj.centerLat||P.lastSelectPoint.placeInfo.obj.centerLng!=P.markGroup[e].placeInfo.obj.centerLng)&&M(P.markGroup[e],"blue")}));P.lastSelectPoint&&y(P.lastSelectPoint),d.click(function(){var e;$$(".CgsKeywordQuery_table").slideToggle(50,null),P.hideButtomFlag=!P.hideButtomFlag,e=P.hideButtomFlag?"url('"+CGS_SDK_PATH+"plugg/keywordQuery/image/show.png":"url('"+CGS_SDK_PATH+"plugg/keywordQuery/image/hide.png",$$(document.getElementsByClassName("CgsKeywordQuery_table_hidebuttom_bg")).css("background-image",e)}),P.updateOverlay3dom()},300),setTimeout(function(){P.mistinessSearchFlag=!0},300)}(e,i)},dataType:"json",error:function(){P.mistinessSearchFlag=!0}}),P.keyMode=3,P.lastSearchInput=$$("input#myInput2").val(),P.lastInput=$$("input#myInput2").val())}function C(e){P.lastSelectTr&&P.lastSelectTr.trAll.css("background-color",P.lastSelectTr.defaultColor),e.trAll.css("background-color","#2f5ea4"),P.lastSelectTr=e}function y(e){if(!e.placeInfo.trAll)for(var t=0;t<P.markGroup.length;t++){P.lastSelectPoint.placeInfo.obj.centerLat==P.markGroup[t].placeInfo.obj.centerLat&&P.lastSelectPoint.placeInfo.obj.centerLng==P.markGroup[t].placeInfo.obj.centerLng&&(i=P.markGroup[t])}var i;M(i=i||e,"red")}function v(e){if(!e.placeInfo.trAll)for(var t=0;t<P.markGroup.length;t++){P.lastSelectPoint.placeInfo.obj.centerLat==P.markGroup[t].placeInfo.obj.centerLat&&P.lastSelectPoint.placeInfo.obj.centerLng==P.markGroup[t].placeInfo.obj.centerLng&&(i=P.markGroup[t])}var i;M(i=i||e,"blue")}function m(e,t){for(var i=[],s=[],o=0;o<e.length;o++)for(var a=0;a<e[o].points.length;a++)i.push(e[o].points[a][0]),s.push(e[o].points[a][1]);var n,r,l,u=Math.max.apply(null,i),p=Math.min.apply(null,i),h=Math.max.apply(null,s),c=Math.min.apply(null,s);return 1==window.WGMODEFLAG||3==window.WGMODEFLAG?(n=Cesium.Cartesian3.fromDegrees(p,c),r=Cesium.Cartesian3.fromDegrees(u,h),l=Cesium.Cartesian3.distance(n,r)):2==window.WGMODEFLAG&&(l=25e5),t||(l<1e3?l=2e5:25e5<l&&(l=25e5)),l}function u(){P.tempSelectLog=null,h();var e=JSON.parse(sessionStorage.getItem("cgsdmsslog"));if(null!=e){var t=[];P.logGroup=null;for(var i,s=e.length-1;0<=s;s--){var o=$$('<p class="drap-line"><a herf="#">  '+e[s]+"</a></p>");o.appendTo(n);var a={tr:o,session:e[s]};t.push(a)}P.logGroup=t,document.getElementById("myInputDiv3").style.display="",setTimeout(function(){for(var e=0;e<t.length;e++)t[e].tr.attr("id","drapline"+e),t[e].tr.click(function(){h();var e=parseInt($$(this).attr("id").slice(8));t[e]&&($$("#myInput2").val(t[e].session),r())})},20),P.trButton||((i=$$('<div class="drap-deletelog"></div>')).appendTo(n),P.trButton=$$('<p style="text-align: center"><a herf="#">清除搜索记录..</a></p>'),P.trButton.appendTo(i),setTimeout(function(){P.trButton&&P.trButton.click(function(){h(),window.sessionStorage.removeItem("cgsdmsslog")})},100))}}function p(t,i,s){var o=setInterval(function(){var e;document.getElementById(t)&&(window.clearInterval(o),e=document.getElementById(t),$("#"+t).bind(i,function(){s(e)}))},1)}function f(e){if(e){e.setVisible(!0);for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!0);e.overlay.setVisible(!0),P.lastSelectPoint=e}}function b(e){for(var t=0;t<e.length;t++)for(var i=0;i<e[t].points.length;i++){var s=e[t].points[i].split(",");s[0]=parseFloat(s[0]),s[1]=parseFloat(s[1]),e[t].points[i]=s}return e}function h(e){$$(document.getElementsByClassName("CgsKeywordQuery_body")).css("border-bottom","0px"),document.getElementById("dmssmovebtn").style.display="none",P.tempSelectPoint=null,$$("table").remove(".CgsKeywordQuery_table"),$$("div").remove(".CgsKeywordQuery_table_hidebuttom"),$$("div").remove(".CgsKeywordQuery_tableDiv"),P.myTableHide=null,P.lastSelectTr=null,$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3")&&(document.getElementById("myInputDiv3").style.display="none"),P.markGroup=[];for(var t=0;t<P.map.overlays.length;t++)P.map.overlays[t].placeInfo&&P.markGroup.push(P.map.overlays[t]);if(0!=P.markGroup.length)for(t=0;t<P.markGroup.length;t++){P.markGroup[t].overlay&&P.markGroup[t]!=e&&P.map.removeOverlay(P.markGroup[t].overlay);for(var i=0;i<P.markGroup[t].closeFeature.length;i++)P.markGroup[t]!=e&&P.map.removeFeature(P.markGroup[t].closeFeature[i]);P.map.removeOverlay(P.markGroup[t])}e?(P.markGroup=[e],P.lastSelectPoint=e):(P.markGroup=[],P.lastSelectPoint=null),P.trButton=null}function D(e){if(e&&e.overlay.getVisible()){e.overlay&&e.overlay.setVisible(!1);for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!1);v(e)}}function S(){if(0!=P.listGroup.length){for(var e=0;e<P.listGroup.length;e++){P.listGroup[e].overlay&&P.map.removeOverlay(P.listGroup[e].overlay);for(var t=0;t<P.listGroup[e].closeFeature.length;t++)P.map.removeFeature(P.listGroup[e].closeFeature[t]);P.map.removeOverlay(P.listGroup[e])}P.listGroup=[]}}function w(){if(0!=P.markGroup.length)for(var e=0;e<P.markGroup.length;e++)P.markGroup[e].setVisible(!0)}n.addClass("CgsKeywordQuery_droplist"),n.appendTo(t),CgsSubPub.subscribe(CgsEvent.eModeChanged,function(e,t,i){if("3D"==t){for(var s,o=0;o<P.markGroup.length;o++){"3D"==i.mode||(s=P.markGroup[o].overlay2D.element),$$(s).attr("id","drapTrall"+o),$$(s).click(function(){document.getElementById("dmssmovebtn").style.display="none",S(),w();var e=parseInt($$(this).attr("id").slice(9));P.lastSelectPoint&&(M(P.lastSelectPoint,"blue"),$$(document.getElementById(P.lastSelectPoint.overlay3D.dom.id)).css("background-image",url),D(P.lastSelectPoint)),C(P.markGroup[e].placeInfo),document.getElementById("myInputDiv3").style.display="none",P.markGroup[e].placeInfo.obj.pos=[P.markGroup[e].placeInfo.obj.centerLng,P.markGroup[e].placeInfo.obj.centerLat,2.5*parseInt(m(P.markGroup[e].placeInfo.obj.geometrysInfo.geometrys))],i.flyTo({destination:P.markGroup[e].placeInfo.obj.pos,duration:1,noFlyHigher:!0}),y(P.markGroup[e]),f(P.markGroup[e])}),$$(s).mouseover(function(){var e=parseInt($$(this).attr("id").slice(9));P.markGroup[e]&&("3D"==P.map.mode&&($$(".CgsKeywordQuery_tableDiv").animate({scrollTop:32*(e-1)},1),setTimeout(function(){P.markGroup[e].placeInfo.trAll&&P.markGroup[e].placeInfo!=P.lastSelectTr&&P.markGroup[e].placeInfo.trAll.css("background","#2f5ea4")},5)),M(P.markGroup[e],"red"))}),$$(s).mouseout(function(){var e=parseInt($$(this).attr("id").slice(9));P.lastSelectPoint&&P.markGroup[e]&&(P.lastSelectPoint.placeInfo.obj.centerLat!=P.markGroup[e].placeInfo.obj.centerLat||P.lastSelectPoint.placeInfo.obj.centerLng!=P.markGroup[e].placeInfo.obj.centerLng)&&("3D"==P.map.mode&&setTimeout(function(){P.markGroup[e].placeInfo.trAll&&P.markGroup[e].placeInfo!=P.lastSelectTr&&P.markGroup[e].placeInfo.trAll.css("background",P.markGroup[e].placeInfo.defaultColor)},7),M(P.markGroup[e],"blue"))})}for(o=0;o<i.overlays.length;o++)i.overlays[o].placeInfo&&i.overlays[o].setPixelOffset([0,12])}else for(o=0;o<i.overlays.length;o++)i.overlays[o].placeInfo&&i.overlays[o].setPixelOffset([-15,-30]),i.overlays[o].type&&"infobox"==i.overlays[o].type&&$$(i.overlays[o].overlay2D.element).css("z-index","800")}),CgsSubPub.subscribe(CgsEvent.eFeatureDoubleClick,function(e,t,i,s){!t.keywordQueryFlag||t instanceof CgsMark||(t.overlay.setVisible(!1),t.setVisible(!1))})}(),document.onkeydown?(t=document.onkeydown,document.onkeydown=function(e){t(e),"13"==e.keyCode&&3==P.keyMode&&i(),"40"==e.keyCode&&0<P.markGroup.length&&3==P.keyMode&&s(),"38"==e.keyCode&&0<P.markGroup.length&&3==P.keyMode&&o()}):document.onkeydown=function(e){"13"==e.keyCode&&3==P.keyMode&&i(),"40"==e.keyCode&&0<P.markGroup.length&&3==P.keyMode&&s(),"38"==e.keyCode&&0<P.markGroup.length&&3==P.keyMode&&o()},setTimeout(function(){var t=2e12;$$(".CgsKeywordQuery_movebutton").mousedown(function(e){t=(new Date).valueOf(),document.getElementById("myInput2").blur()}),$$(".CgsKeywordQuery_movebutton").mouseup(function(){t=2e12}),document.addEventListener("mousemove",function(e){10<(new Date).valueOf()-t&&1==e.which&&($$(document.getElementById("keywordQueryplugg")).css("left",e.clientX-290+"px"),$$(document.getElementById("keywordQueryplugg")).css("top",e.clientY-120+"px")),0==e.which&&(t=2e12)})},100);var a=CGS_SDK_PATH+"assets/image/ablum.png";this.title=$$("<div class='CgsLayerTool__title CgsTool__title' style='width: 352px'><img class='CgsLayerTool__titleImg' ><span class='CgsLayerTool__titleText' style='font-size: 10px;'>地名搜索</span><div class='CgsLayerTool__closeButton'></div></div>"),this.title.find(".CgsLayerTool__titleImg").attr("src",a),this.title.find(".CgsLayerTool__title CgsTool__title").attr("width","650px"),CgsTool.call(this,e,this.title,this.body)},CgsInherits(CgsKeywordQuery,CgsTool),CgsKeywordQuery.prototype.activate=function(){CgsUtil.defined(this.body)&&this.body.show()},CgsKeywordQuery.prototype.deactivate=function(){CgsUtil.defined(this.body)&&this.body.hide();var e=this;if($$("p").remove(".drap-line"),$$("table").remove(".CgsKeywordQuery_table"),e.lastSelectTr=null,$$("div").remove(".CgsKeywordQuery_table_hidebuttom"),$$("div").remove(".CgsKeywordQuery_tableDiv"),document.getElementById("myInputDiv3").style.display="none",0!=e.markGroup.length){for(var t=0;t<e.markGroup.length;t++){e.markGroup[t].overlay&&e.map.removeOverlay(e.markGroup[t].overlay);for(var i=0;i<e.markGroup[t].closeFeature.length;i++)this.map.removeFeature(e.markGroup[t].closeFeature[i]);this.map.removeOverlay(e.markGroup[t])}e.markGroup=[]}$$("#myInput2").val("")},CgsKeywordQuery.prototype.updateOverlay3dom=function(){for(var e,t=0;t<this.markGroup.length;t++){this.markGroup[t].overlay3D&&0<this.markGroup[t].overlay3D.clones.length&&(CgsOverlay.clone(this.markGroup[t]),this.map.map3D.removeFeature(this.markGroup[t].overlay3D.clones[0]),this.markGroup[t].overlay3D.clones.shift(),this.map.map3D.addFeature(this.markGroup[t].overlay3D.clones[0])),this.markGroup[t].overlay.overlay3D&&0<this.markGroup[t].overlay.overlay3D.clones.length&&(e=this.markGroup[t].overlay.getVisible(),CgsOverlay.clone(this.markGroup[t].overlay),this.map.map3D.removeFeature(this.markGroup[t].overlay.overlay3D.clones[0]),this.markGroup[t].overlay.overlay3D.clones.shift(),this.map.map3D.addFeature(this.markGroup[t].overlay.overlay3D.clones[0]),this.markGroup[t].overlay.overlay3D.setVisible(e))}},CgsQuery=function(e){this.url=e.serverUrl,this.successCallback=e.successCallback,this.errorCallback=e.errorCallback,this.fieldId=e.fieldId||"id",this.fieldName=e.fieldName||"NAME",this.fieldX=e.fieldX||"lon",this.fieldY=e.fieldY||"lat",this.fieldZ=e.fieldZ||"altitude",this.useFieldFilter=e.useFieldFilter||!1,this.filterFields=e.filterFields||[],this.filterFields=e.filterFieldsName},CgsQuery.prototype.query=function(e){var t=this;$$.ajax({type:"GET",dataType:"json",url:t.url,success:function(e){t.successCallback&&t.successCallback(e)},error:function(){t.successCallback&&t.successCallback(data)}})},CgsQuery.prototype.spaceQuery=function(e){var t=this;$$.ajax({type:"GET",dataType:"json",url:t.url,success:function(e){t.successCallback&&t.successCallback(e)},error:function(){t.successCallback&&t.successCallback(data)}})},CgsQuery.prototype.setSuccessCallback=function(e){this.successCallback=e},CgsQuery.prototype.setErrorCallback=function(e){this.errorCallback=e},CgsQuery.prototype.setFilterFields=function(e){this.filterFields=e},CgsQuery.prototype.setFilterFieldsName=function(e){this.filterFieldsName=e},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/modelPlugg/zoolonModelPlugg.css"/>'),CgsModelPlugg=function(m){var c,f=this,C={currentModelUrl:"",currentModelName:"",currentModelNumber:200,firstTimeFlag:!0,preSelectedGroupId:-1,drawOnMapDefaultGroup:"model_root",dbClickId:null,clickId:null,clickOutId:null,featurePropertyChangeId:null,featureClickFlag:!1,canvasBindEventState:null};function e(){var a=[],n=new dhtmlXTreeObject("modelTree","100%","auto","modelRoot");n.setImagePath(CGS_SDK_PATH+"dHtmlxTree/skins/skyblue/imgs/dhxtree_skyblue/"),n.enableTreeImages(!1),n.setDataMode("json"),n.enableTreeLines(!0),f.body.find("#modelTree").css("overflow","auto"),n.setOnClickHandler(function(e){a=[],0==n.hasChildren(e)?p(e,!0):p(function e(t){var i=n.getSubItems(t).split(",");for(var s=0;s<i.length;s++){var o=i[s];0!=n.hasChildren(o)?e(o):a.push(o)}return a}(e),!1)});for(var e=m.getModelPluggInfo().modeGroup,t=0;t<e.length;t++){var i=e[t].pId,s=e[t].name,o=e[t].id;e[t].open;"null"==i&&(i="modelRoot"),n.insertNewItem(i,o,s,"","groupEmpty.gif")}(c=new dhtmlXTreeObject("modelTreeOnMap","100%","auto","modelOnMapRoot")).setImagePath(CGS_SDK_PATH+"dHtmlxTree/skins/skyblue/imgs/dhxtree_skyblue/"),c.enableTreeImages(!1),c.setDataMode("json"),c.enableTreeLines(!0),c.setOnClickHandler(function(e){var t,i;C.featureClickFlag?C.featureClickFlag=!1:(t=c.getUserData(e,"model-id"),i=m.getFeatureById(t),CgsSubPub.publish("featureclick",[i]))}),c.setOnDblClickHandler(function(e){var t=c.getUserData(e,"model-id"),i=m.getFeatureById(t);CgsSubPub.publish("featuredoubleclick",[i])});for(var r,l,u=m.getAllFeatures(),t=0;t<u.length;t++){"CgsModel"==u[t].getType()&&(h(),C.currentModelNumber++,i=C.drawOnMapDefaultGroup,r="models_"+C.currentModelNumber,s=u[t].getName()||"未命名",l=u[t].getId(),c.insertNewItem(i,r,s),c.setUserData(r,"model-id",l))}f.modelOnMapTree=c}function p(e,t){if(e!=C.preSelectedGroupId){C.preSelectedGroupId=e;var i=f.body.find(".model_perGroupShow").eq(0);i.empty();for(var s=0,o=m.getModelPluggInfo().modelList,a=o.length,n=0;n<a;n++){var r,l,u,p,h,c,g=o[n].pId;t&&g!=e||(t||function(e,t){for(var i=0;i<e.length;i++)if(e[i]==t)return 1}(e,g))&&(s++,(r=$$("<div></div>")).addClass("model_item"),(l=$$("<div></div>")).addClass("model_itemPic"),u=o[n].url+o[n].model,p="url("+o[n].url+o[n].icon+")",h=o[n].name,l.attr("data-modelUrl",u),l.attr("data-iconUrl",p),l.attr("data-modelName",h),l.css("backgroundImage",p),l.mousedown(function(e){if(e.preventDefault(),e.stopPropagation(),$$(this).hasClass("model_itemPic_selected"))return $$(this).removeClass("model_itemPic_selected"),(t=$$(m.container).find("#CgsMapContainer3D").find("canvas")).off("click",b),t.off("mousemove",y),t.off("mouseup",v),$$(document).off("contextmenu",b),void C.canvasBindEventState.dragIcon.remove();for(var t,i=!1,s=$$(this).parents(".model_groupShow").find(".model_itemPic"),o=0;o<s.length;o++)if(s.eq(o).hasClass("model_itemPic_selected")){s.eq(o).removeClass("model_itemPic_selected"),(t=$$(m.container).find("#CgsMapContainer3D").find("canvas")).off("click",b),t.off("mousemove",y),t.off("mouseup",v),$$(document).off("contextmenu",b),C.canvasBindEventState.dragIcon.remove(),i=!0;break}i||null==C.canvasBindEventState||((t=$$(m.container).find("#CgsMapContainer3D").find("canvas")).off("click",b),t.off("mousemove",y),t.off("mouseup",v),$$(document).off("contextmenu",b),C.canvasBindEventState.dragIcon.remove());var a=$$(this).attr("data-modelUrl"),n=$$(this).attr("data-iconUrl"),r=$$(this).attr("data-modelName");$$(this).addClass("model_itemPic_selected"),function(e,t,i,s){var o=e.pageX,a=e.pageY,n=$$("<div class='drag_Icon' style='position:absolute;'></div>");n.css("backgroundImage",i),n.css("pointerEvents","none"),C.canvasBindEventState={dx:o,dy:a,disX:0,disY:0,dragIcon:n,flag:!0,moveFlag:!1};var r=$$(m.container).find("#CgsMapContainer3D").find("canvas");r.mousemove(y),r.mouseup(v),r.click(b),$$(document).contextmenu(b),C.currentModelUrl=t,C.currentModelName=s}(e,a,n,r)}),(c=$$("<div></div>")).addClass("model_itemDes"),c.text(h),l.appendTo(r),c.appendTo(r),r.appendTo(i))}var d="共"+s+"个模型";f.body.find(".model_perGroupDescribe").eq(0).text(d)}}this.state=C;var g=[];function d(){0==c.hasChildren(C.drawOnMapDefaultGroup)&&c.deleteItem(C.drawOnMapDefaultGroup,!1)}function h(){c.getItemText(C.drawOnMapDefaultGroup)||c.insertNewItem("modelOnMapRoot",C.drawOnMapDefaultGroup,"模型","","groupEmpty.gif")}function y(e){C.canvasBindEventState.moveFlag=!0,C.canvasBindEventState.disX+=Math.abs(e.pageX-C.canvasBindEventState.dx),C.canvasBindEventState.disY+=Math.abs(e.pageY-C.canvasBindEventState.dy),C.canvasBindEventState.flag&&($$("body").append(C.canvasBindEventState.dragIcon),C.canvasBindEventState.flag=!1),e.preventDefault(),e.stopPropagation();var t=e.pageX-15+"px",i=e.pageY-15+"px";C.canvasBindEventState.dragIcon.css("left",t),C.canvasBindEventState.dragIcon.css("top",i)}function v(e){if(C.canvasBindEventState.disX+=Math.abs(e.pageX-C.canvasBindEventState.dx),C.canvasBindEventState.disY+=Math.abs(e.pageY-C.canvasBindEventState.dy),e.preventDefault(),e.stopPropagation(),C.canvasBindEventState.moveFlag){if(f.removeSelectedItem(),C.canvasBindEventState.disX<20&&C.canvasBindEventState.disY<20)return;var t=$$(m.container).find("canvas").offset().left,i=$$(m.container).find("canvas").offset().top;s(e.pageX-t,e.pageY-i)}}function b(e){var t,i;3!=e.which?(t=$$(m.container).find("canvas").offset().left,i=$$(m.container).find("canvas").offset().top,s(e.pageX-t,e.pageY-i)):f.removeSelectedItem()}function n(e){for(var t=c.getAllChildless().split(","),i=0;i<t.length;i++){var s=t[i];if(e==c.getUserData(s,"model-id"))return t[i]}return null}function s(e,t){var i=m.pixelToLonLat([e,t]);C.currentModelNumber++;var s=C.currentModelName+C.currentModelNumber,o=new CgsModel({name:s,position:i,url:C.currentModelUrl,maxmumScale:2e4});m.addFeature(o)}function t(e,t){var i,s;"CgsModel"==t.getType()&&(s=(i=t.getPosition())[2]?i[2]+150:150,m.flyTo({destination:[i[0],i[1],s]}))}function i(e,t){var i,s,o;"CgsModel"==t.getType()&&(C.featureClickFlag=!0,(i=n(t.getId()))&&(c.selectItem(i,!0),s=f.body.find("#modelTreeOnMap").find(".selectedTreeRow").position().top,f.body.find("#modelTreeOnMap").animate({scrollTop:s+"px"}),o=t,document.onkeydown=function(e){if("Delete"==e.key||46==e.which){var t=c.getSelectedItemId();if(!t)return;c.deleteItem(t,!1),m.removeFeature(o),d()}}))}function o(){var e=c.getSelectedItemId();e&&c.clearSelection(e)}function a(e,t,i){var s,o,a;"name"==i&&"CgsModel"==t.getType()&&(s=c.getSelectedItemId(),o=c.getUserData(s,"model-id"),t==m.getFeatureById(o)&&(a=t.getName(),c.setItemText(s,a)))}this.removeSelectedItem=function(){if(f.state.canvasBindEventState){f.state.canvasBindEventState.moveFlag&&f.state.canvasBindEventState.dragIcon.remove();for(var e=f.body.find(".model_groupShow").find(".model_itemPic"),t=0;t<e.length;t++)if(e.eq(t).hasClass("model_itemPic_selected")){e.eq(t).removeClass("model_itemPic_selected");break}var i=$$(m.container).find("#CgsMapContainer3D").find("canvas");$$(document).off("contextmenu",b),i.off("click",b),i.off("mousemove",y),i.off("mouseup",v)}},CgsSubPub.subscribe("featureadded",function(e,t){var i,s,o,a;"CgsModel"==t.getType()&&(s=n(a=t.getId()),C.currentModelNumber++,i=C.drawOnMapDefaultGroup,s="models_"+C.currentModelNumber,""==(o=t.getName())&&(o="未命名"),a=t.getId(),h(),c.insertNewItem(i,s,o),c.setUserData(s,"model-id",a))}),CgsSubPub.subscribe("featureremoved",function(e,t){var i;"CgsModel"!=t.getType()||(i=n(t.getId()))&&(c.deleteItem(i,!1),d())}),CgsSubPub.subscribe("sceneload",function(){f.body.find("#modelTreeOnMap").empty(),C.firstTimeFlag=!0,f.deactivate()}),this.showView=function(){C.firstTimeFlag&&(e(),C.firstTimeFlag=!1,f.body.find("#modelTreeOnMap").css("display","none"),f.body.find("#modelTree").css("display","block"),f.body.find(".model_groupShow").eq(0).css("display","block"),f.body.find(".model_perGroupDescribe").eq(0).text("共0个模型")),C.dbClickId=CgsSubPub.subscribe("featuredoubleclick",t),C.clickId=CgsSubPub.subscribe("featureclick",i),C.clickOutId=CgsSubPub.subscribe("featureclickout",o),C.featurePropertyChangeId=CgsSubPub.subscribe("featurepropertychange",a)},function(){var e=$$("<div></div>");e.addClass("modelContainer");var t=$$("<div></div>");t.addClass("model_title");var i=$$("<div></div>");i.addClass("model_content");var s=$$("<div></div>");s.addClass("model_edit"),s.css("display","none"),s.click(function(){var e=f.modelOnMapTree.getSelectedItemId();e&&function(e){{var t,i,s,o,a;m.toolbar.propertyToolActive||(m.toolbar.propertyTool||(m.toolbar.propertyTool=new CgsPropertyPlugg(m)),m.toolbar.propertyTool.activate(),m.toolbar.propertyToolActive=!0,document.getElementById("sxk").setAttribute("class","tool_pressDiv"),t=f.body.parents(".CgsToolBone").width(),i=f.body.parents(".CgsToolBone").position().left,s=f.body.parents(".CgsToolBone").position().top,o=t+i+"px",a=s+"px",m.toolbar.propertyTool.body.parents(".CgsToolBone").css("left",o),m.toolbar.propertyTool.body.parents(".CgsToolBone").css("top",a))}var n=c.getUserData(e,"model-id"),r=m.getFeatureById(n);m.toolbar.propertyTool.setSelectedEntity(r)}(e)});var o=$$("<div></div>");o.addClass("model_delete"),o.css("display","none"),o.click(function(){var e=f.modelOnMapTree.getSelectedItemId();e&&function(e){if(0==c.hasChildren(e)){var t=c.getUserData(e,"model-id"),i=m.getFeatureById(t);m.removeFeature(i),c.deleteItem(e,!1),d()}else{g=[];for(var s=function e(t){var i=c.getSubItems(t).split(",");for(var s=0;s<i.length;s++){var o=i[s];0!=c.hasChildren(o)?e(o):g.push(o)}return g}(e),o=0;o<s.length;o++){var a=s[o],t=c.getUserData(a,"model-id"),i=m.getFeatureById(t);m.removeFeature(i),c.deleteItem(a,!1),d()}}}(e)}),t.appendTo(e),i.appendTo(e),s.appendTo(e),o.appendTo(e),f.body=e;var a=$$("<div></div>");a.addClass("model_titleItem"),a.addClass("model_titleItem_selected"),a.text("模型列表"),a.click(function(){$$(this).addClass("model_titleItem_selected"),f.body.find(".model_titleItem").eq(1).removeClass("model_titleItem_selected"),f.body.find("#modelTreeOnMap").css("display","none"),f.body.find(".model_edit").eq(0).css("display","none"),f.body.find(".model_delete").eq(0).css("display","none"),f.body.find("#modelTree").css("display","block"),f.body.find(".model_groupShow").eq(0).css("display","block")});var n=$$("<div></div>");n.addClass("model_titleItem"),n.text("管理器"),n.click(function(){$$(this).addClass("model_titleItem_selected"),f.body.find(".model_titleItem").eq(0).removeClass("model_titleItem_selected"),f.body.find("#modelTree").css("display","none"),f.body.find(".model_groupShow").eq(0).css("display","none"),f.body.find("#modelTreeOnMap").css("display","block"),f.body.find("#modelTreeOnMap").css("overflow","auto"),f.body.find(".model_edit").eq(0).css("display","block"),f.body.find(".model_delete").eq(0).css("display","block")}),a.appendTo(t),n.appendTo(t);var r=$$("<div id=></div>");r.addClass("model_groupTree"),r.attr("id","modelTree"),r.css("display","none");var l=$$("<div></div>");l.addClass("model_groupShow"),l.css("display","none");var u=$$("<div></div>");u.addClass("model_perGroupDescribe");var p=$$("<div></div>");p.addClass("model_perGroupShow"),u.appendTo(l),p.appendTo(l);var h=$$("<div id=></div>");h.addClass("model_onMapTree"),h.attr("id","modelTreeOnMap"),h.css("display","none"),r.appendTo(i),l.appendTo(i),h.appendTo(i)}();var r=CGS_SDK_PATH+"assets/image/ablum.png";this.title=$$("<div class='CgsLayerTool__title CgsTool__title'><img class='CgsLayerTool__titleImg' ><span class='CgsLayerTool__titleText'>模型</span><div class='CgsLayerTool__closeButton'></div></div>"),this.title.find(".CgsLayerTool__titleImg").attr("src",r),CgsTool.call(this,m,this.title,this.body)},CgsInherits(CgsModelPlugg,CgsTool),CgsModelPlugg.prototype.activate=function(){CgsTool.prototype.activate.call(this),this.bone.element.css("width","384px"),this.showView()},CgsModelPlugg.prototype.deactivate=function(){this.removeSelectedItem(),CgsSubPub.unsubscribe(this.state.dbClickId),CgsSubPub.unsubscribe(this.state.clickId),CgsSubPub.unsubscribe(this.state.clickOutId),CgsSubPub.unsubscribe(this.state.featurePropertyChangeId),CgsTool.prototype.deactivate.call(this)},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/propertyPlugg/zoolonPropertyPlugg.css"/>'),document.write('<script type="text/javascript" src="'+CGS_SDK_PATH+'plugg/propertyPlugg/DescriptorDataModel.js"><\/script>'),CgsPropertyPlugg=function(e){var o=this,t=new DescriptorDataModel;o.body=$$(t.state.body);var i={viewer:e,descriptorDataModel:t,globe:new CgsGlobe(e),featureClickId:null,featureClickOutId:null,featurePropertyChangeId:null,visible:!1};function a(e,t){if(null!=t){o.state.descriptorDataModel.clear(),o.state.descriptorDataModel.setObject(t);for(var i=t.getPropertyString(),s=0;s<i.length;s++)o.state.descriptorDataModel.add(i[s])}}function n(e){o.state.descriptorDataModel.clear(),o.state.descriptorDataModel.setObject(o.state.globe);for(var t=o.state.globe.getPropertyString(),i=0;i<t.length;i++)o.state.descriptorDataModel.add(t[i])}function r(e,t,i){o.state.descriptorDataModel.getObject()==t&&o.setSelectedEntity(t)}function l(e,t){o.state.descriptorDataModel.getObject()==t&&o.setSelectedEntity(t)}this.state=i,this.setSelectedEntity=function(e){if(null!=e){this.state.descriptorDataModel.clear(),this.state.descriptorDataModel.setObject(e);for(var t=e.getPropertyString(),i=0;i<t.length;i++)this.state.descriptorDataModel.add(t[i])}},CgsSubPub.subscribe("sceneload",function(){o.deactivate()}),CgsSubPub.subscribe("featureremoved",function(e,t){if(o.state.visible&&t==o.state.descriptorDataModel.getObject()){o.state.descriptorDataModel.clear(),o.state.descriptorDataModel.setObject(o.state.globe);for(var i=o.state.globe.getPropertyString(),s=0;s<i.length;s++)o.state.descriptorDataModel.add(i[s])}}),this.setVisible=function(e){var t=this;if(t.state.visible=e){t.state.featureClickId=CgsSubPub.subscribe("featureclick",a),t.state.featureClickOutId=CgsSubPub.subscribe("featureclickout",n),t.state.featurePropertyChangeId=CgsSubPub.subscribe("featurepropertychange",r),t.state.featurePropertyChangeId=CgsSubPub.subscribe("featuredragend",l),t.state.descriptorDataModel.clear(),t.state.descriptorDataModel.setObject(t.state.globe);for(var i=t.state.globe.getPropertyString(),s=0;s<i.length;s++)t.state.descriptorDataModel.add(i[s])}else t.state.descriptorDataModel.clear(),CgsSubPub.unsubscribe(t.state.featureClickId),CgsSubPub.unsubscribe(t.state.featureClickOutId),CgsSubPub.unsubscribe(t.state.featurePropertyChangeId);t.state.descriptorDataModel.clear(),t.state.descriptorDataModel.setObject(t.state.globe);for(i=t.state.globe.getPropertyString(),s=0;s<i.length;s++)t.state.descriptorDataModel.add(i[s])};var s=CGS_SDK_PATH+"assets/image/ablum.png";this.title=$$("<div class='property__title CgsTool__title'><img class='CgsLayerTool__titleImg' ><span class='CgsLayerTool__titleText'>属性</span><div class='CgsLayerTool__closeButton'></div></div>"),this.title.find(".CgsLayerTool__titleImg").attr("src",s),CgsTool.call(this,e,this.title,this.body)},CgsInherits(CgsPropertyPlugg,CgsTool),CgsPropertyPlugg.prototype.activate=function(){CgsTool.prototype.activate.call(this),this.setVisible(!0)},CgsPropertyPlugg.prototype.deactivate=function(){this.setVisible(!1),CgsTool.prototype.deactivate.call(this)},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/layerPlugg/zoolonLayerPlugg.css"/>'),CgsLayerPlugg=function CgsLayerPlugg(viewer){var self=this;this.sortOrder=!0;var state={selectedItem:void 0,firstTimeFlag:!0,layerStartId:200,datasourceStartId:11e4,newDomList:[],currentSelectedId:-1,addDomFlag:!1,layerRootId:null,layerId:null,dataRootId:null,datasourceId:null,datasourceLoadErrorId:null,datasourceLoadByFileSucessId:null,layerAddedHandlerId:null,layerRemovedHandlerId:null,datasourceAddedHandlerId:null,datasourceRemovedHandlerId:null,opacityRecords:{}};this.state=state;var myTree=void 0,dataTree=void 0,$sliderPlgg=null;function initTreeData(){if(viewer.treeNodes.layerGroup){for(var e=viewer.treeNodes.layerGroup,t=0;t<e.length;t++){var i=e[t].pId,s=e[t].name,o=e[t].id;"null"==i&&(i="layerRoot",state.layerRootId=o),"图层"==s&&(state.layerId=o),myTree.insertNewItem(i,o,s,"","groupEmpty.gif"),myTree.setUserData(o,"type","folder"),myTree.setUserData(o,"icon","layer"),addDomToDomList(o,s)}for(var a=viewer.getLayers(),n=0;n<a.length;n++){t=n;self.sortOrder&&(t=a.length-1-n),a[t].getAddToLayerTree()&&(u=a[t].getId(),""!=(i=a[t].getPId())&&null!=i||(i=state.layerId),""!=(s=a[t].getText())&&null!=s||(s="未命名"),p=a[t].getVisible(),o=state.layerStartId++,myTree.insertNewItem(i,o,s),myTree.setUserData(o,"icon","layer"),myTree.setUserData(o,"data-layerId",u),p?myTree.setCheck(o,1):myTree.setCheck(o,0),state.layerStartId++)}for(e=viewer.treeNodes.layerGroup,t=0;t<e.length;t++){o=e[t].id;e[t].open?myTree.openItem(o):myTree.closeItem(o)}}if(viewer.treeNodes.datasourceGroup){for(var r=viewer.treeNodes.datasourceGroup,t=0;t<r.length;t++){i=r[t].pId,s=r[t].name,o=r[t].id;"null"==i&&(i="dataRoot",state.dataRootId=o),"数据源"==s&&(state.datasourceId=o),dataTree.insertNewItem(i,o,s,"","groupEmpty.gif"),dataTree.setUserData(o,"type","folder"),dataTree.setUserData(o,"icon","dataSource"),addDomToDomList(o,s)}for(var l=viewer.getAllDataSources(),n=0;n<l.length;n++){t=n;if(self.sortOrder&&(t=l.length-1-n),!l[t].getIsAddToLayerTree())return;var u=l[t].getId();""!=(i=l[t].getPId())&&null!=i||(i=state.datasourceId),""!=(s=l[t].getName())&&null!=s||(s="未命名");var p=l[t].getVisible(),o=state.datasourceStartId++;dataTree.insertNewItem(i,o,s),dataTree.setUserData(o,"icon","dataSource"),dataTree.setUserData(o,"data-datasourceId",u),p?dataTree.setCheck(o,1):dataTree.setCheck(o,0),state.datasourceStartId++}for(r=viewer.treeNodes.datasourceGroup,t=0;t<r.length;t++){o=r[t].id;r[t].open?dataTree.openItem(o):dataTree.closeItem(o)}}}function loadDataTree(){(dataTree=new dhtmlXTreeObject("dataTreeHere","100%","auto","dataRoot")).setImagePath(CGS_SDK_PATH+"dHtmlxTree/skins/web/imgs/dhxtree_web/"),dataTree.enableDragAndDrop(!0),dataTree.enableCheckBoxes(!0),dataTree.setDragBehavior("complex"),dataTree.setDataMode("json"),dataTree.enableThreeStateCheckboxes(1),dataTree.setOnDblClickHandler(function(e){var t=myTree.getUserData(state.currentSelectedId,"icon");-1!=state.currentSelectedId&&"layer"==t&&myTree.clearSelection(state.currentSelectedId),state.currentSelectedId=e}),dataTree.attachEvent("onBeforeDrag",function(e){return"folder"!=dataTree.getUserData(e,"type")}),dataTree.attachEvent("onDragIn",function(e,t,i,s){return null!=t&&dataTree.getUserData(t,"icon")==dataTree.getUserData(e,"icon")}),dataTree.attachEvent("onDrag",function(e,t,i,s,o){return!(!i&&"folder"!=dataTree.getUserData(t,"type"))}),dataTree.attachEvent("onDrop",function(e,t,i,s,o){var a;return state.addDomFlag||(a=dataTree.getUserData(e,"data-datasourceId"),viewer.getDataSourceById(a).setPId(t)),!0}),dataTree.attachEvent("onCheck",function(e,t){return setVisible(e,t),!0})}function switchOpacityComp(e){var t,i,s,o,a,n;"layer"===(myTree.getUserData(e,"icon")||dataTree.getUserData(e,"icon"))&&("block"!==$$("#cgs-layers-popup").css("display")&&$$("#cgs-layers-popup").css("display","block"),t=myTree.getUserData(e,"data-layerId"),state.selectLayerId=t,(i=viewer.getLayerById(t))instanceof CgsTileLayer&&(s=(state.selectLayer=i).getText(),o=state.opacityRecords[t]||115,a=$sliderPlgg.children()[0],n=$sliderPlgg.next(),a.style.left=o+"px",10==o?n.text("0%"):115==o?n.text("100%"):n.text(parseInt((o-10)/105*100)+"%"),$$("#cgs-layers-popup .layers-popup-title span").text("当前图层："+s)))}function loadMyTree(){var n,a;(myTree=new dhtmlXTreeObject("layerTreeHere","100%","auto","layerRoot")).setImagePath(CGS_SDK_PATH+"dHtmlxTree/skins/web/imgs/dhxtree_web/"),myTree.enableDragAndDrop(!0),myTree.enableCheckBoxes(!0),myTree.setDragBehavior("complex"),myTree.setDataMode("json"),myTree.enableThreeStateCheckboxes(1),myTree.setOnClickHandler(function(e){var t=dataTree.getUserData(state.currentSelectedId,"icon");-1!=state.currentSelectedId&&"dataSource"==t&&dataTree.clearSelection(state.currentSelectedId),state.currentSelectedId=e}),myTree.setOnDblClickHandler(function(e){var t=dataTree.getUserData(state.currentSelectedId,"icon");-1!=state.currentSelectedId&&"dataSource"==t&&dataTree.clearSelection(state.currentSelectedId),switchOpacityComp(state.currentSelectedId=e)}),myTree.attachEvent("onBeforeDrag",function(e){return"folder"!=myTree.getUserData(e,"type")&&(n=myTree.getParentId(e),a=getGroupLastChild(n),!0)}),myTree.attachEvent("onDragIn",function(e,t,i,s){return null!=t&&(myTree.getUserData(t,"icon")==myTree.getUserData(e,"icon")&&!0)}),myTree.attachEvent("onDrag",function(e,t,i,s,o){if(!i&&"folder"!=myTree.getUserData(t,"type"))return!1;if(n==t&&null!=i){var a=myTree.getUserData(i,"data-layerId");if(null==viewer.getLayerIndexById(a))return state.currentSelectedId=e,!1}return!0}),myTree.attachEvent("onDrop",function(e,t,i,s,o){return state.addDomFlag||(n==t?solveOnDropOneGroup(e,t,i,a,!0):solveOnDropOneGroup(e,t,i,getGroupLastSecondChild(t),!1)),!0}),myTree.attachEvent("onCheck",function(e,t){return setVisible(e,t),!0})}function solveOnDropOneGroup(e,t,i,s,o){var a=myTree.getUserData(e,"data-layerId"),n=viewer.getLayerById(a),r=viewer.getLayerIndexById(a),l=myTree.getUserData(i,"data-layerId"),u=myTree.getIndexById(i),p=!1;null==i&&(l=myTree.getUserData(s,"data-layerId"),u=myTree.getIndexById(s),p=!0);var h=viewer.getLayerIndexById(l);if(n.setPId(t),null!=h){if(self.sortOrder){if(!o){if(1<u&&p&&r<h)return void logLayer();if(1==u&&h<r)return void logLayer();if(1<u){c=myTree.getItemIdByIndex(t,u-2),g=myTree.getUserData(c,"data-layerId"),d=viewer.getLayerIndexById(g);if(h<r&&r<d)return void logLayer()}}m=Math.abs(h-r);if(r<h){f=m;p&&(f=m-1);for(C=0;C<f;C++)viewer.raiseLayer(n)}else{f=m-1;p&&(f=m);for(C=0;C<f;C++)viewer.lowerLayer(n)}}else{if(!o){if(console.log("onegroupflag",!1),1<u&&p&&h<r)return void logLayer();if(1==u&&r<h)return void logLayer();if(1<u){var c=myTree.getItemIdByIndex(t,u-2),g=myTree.getUserData(c,"data-layerId"),d=viewer.getLayerIndexById(g);if(r<h&&d<r)return void logLayer()}}var m=Math.abs(h-r);if(r<h){var f=m-1;p&&(f=m);for(var C=0;C<f;C++)viewer.raiseLayer(n)}else{var f=m;p&&(f=m-1);for(var C=0;C<f;C++)viewer.lowerLayer(n)}}logLayer()}else logLayer()}function setVisible(e,t){var i=myTree.getUserData(e,"icon"),s=dataTree.getUserData(e,"icon"),o=null==i?s:i;if("layer"==o)if(0==myTree.hasChildren(e)){var a=myTree.getUserData(e,"data-layerId");(l=viewer.getLayerById(a))&&l.setVisible(t),myTree.setCheck(e,t)}else for(var n=myTree.getSubItems(e).split(","),r=0;r<n.length;r++){var l,u=n[r];0!=myTree.hasChildren(u)?(myTree.setCheck(u,t),setVisible(u,t)):(a=myTree.getUserData(u,"data-layerId"),(l=viewer.getLayerById(a))&&l.setVisible(t),myTree.setCheck(u,t))}else if("dataSource"==o)if(0==dataTree.hasChildren(e)){var p=dataTree.getUserData(e,"data-datasourceId");(h=viewer.getDataSourceById(p))&&h.setVisible(t),dataTree.setCheck(e,t)}else for(n=dataTree.getSubItems(e).split(","),r=0;r<n.length;r++){var h,u=n[r];0!=dataTree.hasChildren(u)?(dataTree.setCheck(u,t),setVisible(u,t)):(p=dataTree.getUserData(u,"data-datasourceId"),(h=viewer.getDataSourceById(p))&&h.setVisible(t),dataTree.setCheck(u,t))}}function getCurrentSelectedItemText(e){var t=myTree.getSelectedItemId(),i=dataTree.getSelectedItemId();if(!t&&!i)return null;var s,o=null;return t&&"datasource"!=e&&(o="folder"==myTree.getUserData(t,"type")?myTree.getItemText(t):(s=myTree.getParentId(t),myTree.getItemText(s))),i&&"layer"!=e&&(o="folder"==dataTree.getUserData(i,"type")?dataTree.getItemText(i):(s=dataTree.getParentId(i),dataTree.getItemText(s))),o}function solveAddDom(){var u=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$;if(self.newdom)self.newdom.remove(),self.newdom=null,u(this).removeClass("CgsBottomTool__pressed");else{self.newdom=u("<div class='CgsLayerWindow' id='adlayer'><div class='CgsLayerWindow__title'><span>添加节点</span><div class='CgsToolBone__closeDiv'><div class='CgsToolBone__closeBtn_addLayer'>+</div></div></div><div class='CgsLayerWindow__body'><div class='CgsLayerWindow__name'><span>父节点名称</span></div><select class='CgsLayerWindow__layerType_select CgsLayerWindow__layerType_select_new'></select><div class='CgsLayerWindow__name'><span>新节点名称</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel_newdom CgsLayerWindow__cancel_newdom_new'>取消</div><div class='CgsLayerWindow__ok_newdom CgsLayerWindow__ok_newdom_new'>确定</div></div></div></div>");for(var e=self.newdom.find(".CgsLayerWindow__layerType_select").eq(0),t=viewer.treeNodes.layerGroup,i=0;i<t.length;i++){var s=t[i].name;e.append("<option>"+s+"</option>")}for(var o=viewer.treeNodes.datasourceGroup,i=0;i<o.length;i++){s=o[i].name;e.append("<option>"+s+"</option>")}var a=getCurrentSelectedItemText("all");a&&self.newdom.find(".CgsLayerWindow__layerType_select").eq(0).find("option:selected").text(a),self.newdom.find(".CgsLayerWindow__name_input").eq(0).val("未命名"),u(viewer.container).append(self.newdom),self.newdom.draggable({handle:self.newdom.find(".CgsLayerWindow__title")}),u(this).addClass("CgsBottomTool__pressed")}var n=u(viewer.container);n.delegate(".CgsLayerWindow__ok_newdom","click",function(e){var t,i,s,o,a,n,r,l;state.addDomFlag=!0,self.newdom&&(t=self.newdom.find(".CgsLayerWindow__layerType_select").eq(0).find("option:selected").text(),i=u(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(0).val(),s=getGroupId(t),""!=i?null==getGroupId(i)?(o=myTree.getUserData(s,"icon"),a=dataTree.getUserData(s,"icon"),"layer"==(n=null==o?a:o)?(r=state.layerStartId++,myTree.insertNewItem(s,r,i,"","groupEmpty.gif"),l=getParentIdLastGruopId("myTree",s),myTree.moveItem(r,"item_sibling",l),myTree.setUserData(r,"type","folder"),myTree.setUserData(r,"icon","layer"),myTree.setCheck(r,1),addDomToDomList(r,i),state.layerStartId++):"dataSource"==n&&(r=state.datasourceStartId,dataTree.insertNewItem(s,r,i,"","groupEmpty.gif"),l=getParentIdLastGruopId("dataTree",s),dataTree.moveItem(r,"item_sibling",l),dataTree.setUserData(r,"type","folder"),dataTree.setUserData(r,"icon","dataSource"),dataTree.setCheck(r,1),addDomToDomList(r,i),state.datasourceStartId++),state.addDomFlag=!1,self.newdom.remove(),self.newdom=null,self.body.find(".CgsBottomTool__pressed").removeClass("CgsBottomTool__pressed")):CgsTipsWindow.showLog("该组别已存在，组别不能相同，请重新输入！"):CgsTipsWindow.showLog("新节点名称不能为空！"))}),n.delegate(".CgsToolBone__closeBtn_addLayer","click",function(e){state.addDomFlag=!1,self.newdom&&(self.newdom.remove(),self.newdom=null,self.body.find(".CgsBottomTool__pressed").removeClass("CgsBottomTool__pressed"))}),n.delegate(".CgsLayerWindow__cancel_newdom","click",function(e){state.addDomFlag=!1,self.newdom&&(self.newdom.remove(),self.newdom=null,self.body.find(".CgsBottomTool__pressed").removeClass("CgsBottomTool__pressed"))})}function solveEditDatasource(e){var o=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$;self.selectedId=e;var t=dataTree.getItemText(e);self.editDT?(self.editDT.remove(),self.editDT=null):(self.editDT=o("<div class='CgsLayerWindow'><div class='CgsLayerWindow__title'><span>编辑数据源</span></div><div class='CgsLayerWindow__body'><div class='CgsLayerWindow__name'><span>名称</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel_editDT'>取消</div><div class='CgsLayerWindow__ok_editDT'>确定</div></div></div></div>"),self.editDT.find(".CgsLayerWindow__name_input").eq(0).val(t),o(viewer.container).append(self.editDT),self.editDT.draggable({handle:self.editDT.find(".CgsLayerWindow__title")}));var i=o(viewer.container);i.delegate(".CgsLayerWindow__ok_editDT","click",function(e){var t,i,s;self.editDT&&(t=o(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").val(),i=dataTree.getUserData(self.selectedId,"data-datasourceId"),(s=viewer.getDataSourceById(i))&&(s.setName(t),dataTree.setItemText(self.selectedId,t)),self.editDT.remove(),self.editDT=null,self.selectedId=null)}),i.delegate(".CgsLayerWindow__cancel_editDT","click",function(e){self.editDT&&(self.editDT.remove(),self.editDT=null,self.selectedId=null)})}function checkJsonType(e){var t=null;switch(e.split(".")[1].toUpperCase()){case"KML":t="KML";break;case"CZML":t="CZML";break;case"KMZ":t="KMZ";break;case"TOPOJSON":t="GeoJSON";break;case"GEOJSON":t="TopoJSON"}return t}function solveAddDatasource(){var t=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$;if(self.addDT)self.addDT.remove(),self.addDT=null,self.file=null,self.fileName=null,t(this).removeClass("CgsBottomTool__pressed");else{self.addDT=t("<div class='CgsLayerWindow' id='adlayer'><div class='CgsLayerWindow__title'><span>添加数据源</span><div class='CgsToolBone__closeDiv'><div class='CgsToolBone__closeBtn_dataOri'>+</div></div></div><div class='CgsLayerWindow__body'><div class='CgsLayerWindow__name'><span>数据源类型*</span></div><select class='CgsLayerWindow__layerType_select CgsLayerWindow__layerType_select_new'><option>CZML</option><option>KML</option><option>KMZ</option><option>GeoJSON</option><option>TopoJSON</option></select><div class='CgsLayerWindow__name'><span>父节点名称*</span></div><select class='CgsLayerWindow__layerType_select CgsLayerWindow__layerType_select_new'></select><div class='CgsLayerWindow__name'><span>名称</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>文件位置</span></div><div class='filePosition'><input class='CgsLayerWindow__name_extraInput' style='width:175px;border-right:none;'></input><div class='CgsLayerWindow__file_browser'></div></div><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel_addDT CgsLayerWindow__cancel_newdom_new'>取消</div><div class='CgsLayerWindow__ok_addDT CgsLayerWindow__ok_newdom_new'>确定</div></div></div></div>");for(var e=self.addDT.find(".CgsLayerWindow__layerType_select").eq(1),i=viewer.treeNodes.datasourceGroup,s=0;s<i.length;s++){var o=i[s].name;e.append("<option>"+o+"</option>")}var a=getCurrentSelectedItemText("datasource");a&&self.addDT.find(".CgsLayerWindow__layerType_select").eq(1).find("option:selected").text(a),self.addDT.find(".CgsLayerWindow__name_input").eq(0).val("未命名"),self.addDT.find(".CgsLayerWindow__name_input").eq(1).change(function(){var e=checkJsonType(t(this).val());e&&self.addDT.find(".CgsLayerWindow__layerType_select").eq(0).find("option:selected").text(e)}),self.addDT.find(".CgsLayerWindow__file_browser").eq(0).click(function(){var s=t("<input type='file' id='file-input'>");s.trigger("click"),s.change(function(e){var t=s.get(0).files[0];self.file=t,self.fileName=self.file.name,self.addDT.find(".CgsLayerWindow__name_input").eq(1).val(self.file.name);var i=checkJsonType(self.file.name);i&&self.addDT.find(".CgsLayerWindow__layerType_select").eq(0).find("option:selected").text(i)})}),t(viewer.container).append(self.addDT),self.addDT.draggable({handle:self.addDT.find(".CgsLayerWindow__title")}),t(this).addClass("CgsBottomTool__pressed")}var n=t(viewer.container);n.delegate(".CgsLayerWindow__ok_addDT","click",function(e){if(self.addDT){var t=self.addDT.find(".CgsLayerWindow__layerType_select").eq(0).find("option:selected").text(),i=self.addDT.find(".CgsLayerWindow__layerType_select").eq(1).find("option:selected").text(),n=self.addDT.find(".CgsLayerWindow__name_input").eq(0).val(),s=self.addDT.find(".CgsLayerWindow__name_input").eq(1).val();if(""!=s){var r=getGroupId(i);if(s==self.fileName)loadDatasourceByFile(t,self.file),state.datasourceLoadByFileSucessId=CgsSubPub.subscribe("datasourceloadByFileSucess",function(e,t){""==n?n=t.getName():t.setName(n),t.setPId(r),t.setSaveFlag(!1);for(var i=t.getId(),s=dataTree.getAllChildless().split(","),o=0;o<s.length;o++){var a=s[o];if(i==dataTree.getUserData(a,"data-datasourceId"))return void dataTree.setItemText(a,n)}});else{var o,a={mapObject:viewer,name:n,url:s,pId:r};try{"KML"==t?o=new CgsKml(a):"CZML"==t?o=new CgsCzml(a):"GeoJSON"!=t&&"TopoJSON"!=t||(o=new CgsGeoJson(a)),viewer.addDataSource(o)}catch(e){return void CgsTipsWindow.showLog("数据源信息有误，请重新输入！")}}state.datasourceStartId++,self.addDT.remove(),self.addDT=null,self.file=null,self.fileName=null,self.body.find(".CgsBottomTool__pressed").removeClass("CgsBottomTool__pressed")}else CgsTipsWindow.showLog("没有选择文件！")}}),n.delegate(".CgsToolBone__closeBtn_dataOri","click",function(e){self.addDT&&(self.addDT.remove(),self.addDT=null,self.body.find(".CgsBottomTool__pressed").removeClass("CgsBottomTool__pressed"))}),n.delegate(".CgsLayerWindow__cancel_addDT","click",function(e){self.addDT&&(self.addDT.remove(),self.addDT=null,self.body.find(".CgsBottomTool__pressed").removeClass("CgsBottomTool__pressed"))})}function loadDatasourceByFile(s,e){readText(s,e,function(e){try{var t,i;"GeoJSON"==s||"TopoJSON"==s?(t=JSON.parse(e),(i=new CgsGeoJson({mapObject:viewer,dataType:"other"})).fileLoad(t)):"CZML"==s?(t=JSON.parse(e),(i=new CgsCzml({mapObject:viewer,dataType:"other"})).fileLoad(t)):"KML"==s?(t=$$.parseXML(e),(i=new CgsKml({mapObject:viewer,dataType:"other"})).fileLoad(t)):"KMZ"==s&&(i=new CgsKml({mapObject:viewer,dataType:"other"})).fileLoad(e),viewer.addDataSource(i)}catch(e){CgsTipsWindow.showLog("数据源信息有误，请重新输入！")}})}function readText(e,t,i){var s=new FileReader;s.onload=function(){i(s.result)},"KMZ"==e?s.readAsDataURL(t):s.readAsText(t)}function openFile(e){browser(function(e){readText(type,e,function(e){})})}function browser(i){var s=$$("<input type='file'>");s.trigger("click"),s.change(function(e){var t=s.get(0).files[0];i(t)})}function solveAddLayer(){var _$$=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$,$$=_$$;if(self.window)self.window.remove(),self.window=null,$$(this).removeClass("CgsBottomTool__pressed");else{self.window=$$("<div class='CgsLayerWindow' id='adlayer'><div class='CgsLayerWindow__title'><span>添加图层</span><div class='CgsToolBone__closeDiv'><div class='CgsToolBone__closeBtn'>+</div></div></div><div class='CgsLayerWindow__body'><div class='CgsLayerWindow__body_bottom'><div class='CgsLayerWindow__name'><span>图层类型</span></div><select class='CgsLayerWindow__layerType_select CgsLayerWindow__layerType_select_new'><option>WMTS</option><option>WMS</option><option>WFS</option><option>Image</option><option>xyz</option></select><div class='CgsLayerWindow__name'><span>父节点名称*</span></div><select class='CgsLayerWindow__layerType_select CgsLayerWindow__layerType_select_new'></select><div class='CgsLayerWindow__name'><span>名称</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>服务地址*</span></div><input class='CgsLayerWindow__name_input'></input></div></div></div>");for(var selectParentName=self.window.find(".CgsLayerWindow__layerType_select").eq(1),parentNameList=viewer.treeNodes.layerGroup,i=0;i<parentNameList.length;i++){var name=parentNameList[i].name;selectParentName.append("<option>"+name+"</option>")}var defaultDom=getCurrentSelectedItemText("layer");defaultDom&&self.window.find(".CgsLayerWindow__layerType_select").eq(1).find("option:selected").text(defaultDom),self.window.find(".CgsLayerWindow__name_input").eq(0).val("未命名");var layerEditContent=$$("<div class='CgsLayerWindow__body_bottom'><div class='CgsLayerWindow__name'><span>服务层级*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>边界</span></div><input class='CgsLayerWindow__name_input' placeholder='[minLng,minLat,maxLng,maxLat]'></input><div class='CgsLayerWindow__name'><span>图层名*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最小可见层级</span></div><input class='CgsLayerWindow__name_input' value='0'></input><div class='CgsLayerWindow__name'><span>最大可见层级</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel CgsLayerWindow__cancel_newdom_new'>取消</div><div class='CgsLayerWindow__ok CgsLayerWindow__ok_newdom_new'>确定</div></div></div>"),windowBody=self.window.find(".CgsLayerWindow__body").eq(0);layerEditContent.appendTo(windowBody),self.window.find(".CgsLayerWindow__layerType_select").eq(0).change(function(){var e,t=self.window.find(".CgsLayerWindow__layerType_select").eq(0).find("option:selected").text();self.window.find(".CgsLayerWindow__body_bottom").eq(1).remove(),"WMTS"==t||"xyz"==t?e=$$("<div class='CgsLayerWindow__body_bottom'><div class='CgsLayerWindow__name'><span>服务层级*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>边界</span></div><input class='CgsLayerWindow__name_input' placeholder='[minLng,minLat,maxLng,maxLat]'></input><div class='CgsLayerWindow__name'><span>图层名*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最小可见层级</span></div><input class='CgsLayerWindow__name_input' value='0'></input><div class='CgsLayerWindow__name'><span>最大可见层级</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel'>取消</div><div class='CgsLayerWindow__ok'>确定</div></div></div>"):"WMS"==t?e=$$("<div class='CgsLayerWindow__body_bottom'><div class='CgsLayerWindow__name'><span>边界</span></div><input class='CgsLayerWindow__name_input' placeholder='[minLng,minLat,maxLng,maxLat]'></input><div class='CgsLayerWindow__name'><span>图层名*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最小可见层级</span></div><input class='CgsLayerWindow__name_input' value='0'></input><div class='CgsLayerWindow__name'><span>最大可见层级</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel'>取消</div><div class='CgsLayerWindow__ok'>确定</div></div></div>"):"WFS"==t?e=$$("<div class='CgsLayerWindow__body_bottom'><div class='CgsLayerWindow__name'><span>服务层级*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最小可视距离*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最大可视距离*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>字体</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>字体颜色</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>图标路径</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>图元类型*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>图层名*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel'>取消</div><div class='CgsLayerWindow__ok'>确定</div></div></div>"):"Image"==t&&(e=$$("<div class='CgsLayerWindow__body_bottom'><div class='CgsLayerWindow__name'><span>边界*</span></div><input class='CgsLayerWindow__name_input' placeholder='[minLng,minLat,maxLng,maxLat]'></input><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel'>取消</div><div class='CgsLayerWindow__ok'>确定</div></div></div>"));var i=self.window.find(".CgsLayerWindow__body").eq(0);e.appendTo(i)}),$$(viewer.container).append(self.window),self.window.draggable({handle:self.window.find(".CgsLayerWindow__title")}),$$(this).addClass("CgsBottomTool__pressed")}var container=$$(viewer.container);container.delegate(".CgsToolBone__closeBtn","click",function(e){self.window&&(self.type=null,self.window.remove(),self.window=null,self.body.find(".CgsBottomTool__pressed").removeClass("CgsBottomTool__pressed"))}),container.delegate(".CgsLayerWindow__ok","click",function(e){if(self.window){var type=self.window.find(".CgsLayerWindow__layerType_select").eq(0).find("option:selected").text(),parentGroupName=self.window.find(".CgsLayerWindow__layerType_select").eq(1).find("option:selected").text(),textValue=self.window.find(".CgsLayerWindow__name_input").eq(0).val(),urlValue=self.window.find(".CgsLayerWindow__name_input").eq(1).val();if(""!=urlValue){var pId=getGroupId(parentGroupName),levelValue,rectangleValue,layerValue,layersValue,maxHeight,minHeight,options,layerNew;if("WMTS"==type||"xyz"==type){levelValue=self.window.find(".CgsLayerWindow__name_input").eq(2).val(),rectangleValue=self.window.find(".CgsLayerWindow__name_input").eq(3).val(),layerValue=self.window.find(".CgsLayerWindow__name_input").eq(4).val();var minVisLevelValue=self.window.find(".CgsLayerWindow__name_input").eq(5).val(),maxVisLevelValue=self.window.find(".CgsLayerWindow__name_input").eq(6).val();if(""==levelValue||""==layerValue)return void CgsTipsWindow.showLog("信息填写不完整！");""==textValue&&(textValue=layerValue),(""==maxVisLevelValue||parseInt(maxVisLevelValue)>parseInt(levelValue))&&(maxVisLevelValue=levelValue),""==minVisLevelValue&&(minVisLevelValue=0),options={text:textValue,url:urlValue,level:levelValue,layer:layerValue,maxVisLevel:parseInt(maxVisLevelValue),minVisLevel:parseInt(minVisLevelValue),pId:pId}}else if("WMS"==type){rectangleValue=self.window.find(".CgsLayerWindow__name_input").eq(2).val(),layersValue=self.window.find(".CgsLayerWindow__name_input").eq(3).val();var minVisLevelValue=self.window.find(".CgsLayerWindow__name_input").eq(4).val(),maxVisLevelValue=self.window.find(".CgsLayerWindow__name_input").eq(5).val();if(""==layersValue)return void CgsTipsWindow.showLog("信息填写不完整！");""==textValue&&(textValue=layersValue),(""==maxVisLevelValue||parseInt(maxVisLevelValue)>parseInt(levelValue))&&(maxVisLevelValue=levelValue),""==minVisLevelValue&&(minVisLevelValue=0),options={text:textValue,url:urlValue,layers:layersValue,maxVisLevel:parseInt(maxVisLevelValue),minVisLevel:parseInt(minVisLevelValue),pId:pId}}else if("WFS"==type){levelValue=self.window.find(".CgsLayerWindow__name_input").eq(2).val(),minHeight=self.window.find(".CgsLayerWindow__name_input").eq(3).val(),maxHeight=self.window.find(".CgsLayerWindow__name_input").eq(4).val();var font=self.window.find(".CgsLayerWindow__name_input").eq(5).val(),color=self.window.find(".CgsLayerWindow__name_input").eq(6).val(),image=self.window.find(".CgsLayerWindow__name_input").eq(7).val(),featureType=self.window.find(".CgsLayerWindow__name_input").eq(8).val(),name=self.window.find(".CgsLayerWindow__name_input").eq(9).val();if(""==levelValue||""==maxHeight||""==minHeight||""==name)return void CgsTipsWindow.showLog("信息填写不完整！");""==textValue&&(textValue=name),options={name:name,text:textValue,url:urlValue,level:levelValue,maxHeight:maxHeight,minHeight:minHeight,font:font,color:color,image:image,pId:pId,mapObject:viewer,featureType:featureType}}else if("Image"==type){if(rectangleValue=self.window.find(".CgsLayerWindow__name_input").eq(2).val(),""==textValue||""==rectangleValue)return void CgsTipsWindow.showLog("信息填写不完整！");options={text:textValue,url:urlValue,pId:pId}}if(rectangleValue)try{if(rectangleValue=eval(rectangleValue),4!=rectangleValue.length)return void CgsTipsWindow.showLog("图层的显示范围必须包括【west,south,east,north】")}catch(e){return void CgsTipsWindow.showLog("图层显示范围格式不正确！")}else rectangleValue=void 0;options.isAddToLayerTree=!0;try{"WMTS"==type?(options.rectangle=rectangleValue,layerNew=new CgsTileLayer(options)):"xyz"==type?(options.rectangle=rectangleValue,layerNew=new CgsXYZLayer(options)):"WMS"==type?(options.rec=rectangleValue,layerNew=new CgsWMSLayer(options)):"WFS"==type?layerNew=new CgsWFSLayer(options):"Image"==type&&(options.rec=rectangleValue,layerNew=new CgsImageLayer(options)),viewer.addLayer(layerNew)}catch(e){return void CgsTipsWindow.showLog("信息存在问题，请重新输入！")}state.layerStartId++,self.window.remove(),self.window=null,self.body.find(".CgsBottomTool__pressed").removeClass("CgsBottomTool__pressed")}else CgsTipsWindow.showLog("信息填写不完整！")}}),container.delegate(".CgsLayerWindow__cancel","click",function(e){self.window&&(self.type=null,self.window.remove(),self.window=null,self.body.find(".CgsBottomTool__pressed").removeClass("CgsBottomTool__pressed"))})}function solveDeleteItem(){var e=dataTree.getSelectedItemId(),t=myTree.getSelectedItemId();if(e==state.currentSelectedId){if(e==state.dataRootId)return void CgsTipsWindow.showLog("数据源组别不能删除，请重新选择！");deleteDatasource(e),dataTree.deleteItem(e,!1)}else if(t==state.currentSelectedId){if(t==state.layerRootId)return void CgsTipsWindow.showLog("图层组别不能删除，请重新选择！");deleteLayer(t),myTree.deleteItem(t,!1)}}function deleteDatasource(e){if("folder"==dataTree.getUserData(e,"type")&&0==dataTree.hasChildren(e))deleteDomToDomList(e),dataTree.deleteItem(e,!1);else if(0==dataTree.hasChildren(e)){var t=dataTree.getUserData(e,"data-datasourceId");(o=viewer.getDataSourceById(t))&&viewer.removeDataSource(o),dataTree.deleteItem(e,!1)}else{var i=dataTree.getSubItems(e).split(",");deleteDomToDomList(e);for(var s=0;s<i.length;s++){var o,a=i[s];0!=dataTree.hasChildren(a)?deleteDatasource(a):(t=dataTree.getUserData(a,"data-datasourceId"),(o=viewer.getDataSourceById(t))&&viewer.removeDataSource(o),dataTree.deleteItem(e,!1))}}}function deleteLayer(e){if("folder"==myTree.getUserData(e,"type")&&0==myTree.hasChildren(e))deleteDomToDomList(e),myTree.deleteItem(e,!1);else if(0==myTree.hasChildren(e)){var t=myTree.getUserData(e,"data-layerId");(o=viewer.getLayerById(t))&&viewer.removeLayer(o),myTree.deleteItem(e,!1)}else{var i=myTree.getSubItems(e).split(",");deleteDomToDomList(e);for(var s=0;s<i.length;s++){var o,a=i[s];0!=myTree.hasChildren(a)?deleteLayer(a):(t=myTree.getUserData(a,"data-layerId"),(o=viewer.getLayerById(t))&&viewer.removeLayer(o),myTree.deleteItem(a,!1))}}}function solveEditItem(){var e=dataTree.getSelectedItemId(),t=myTree.getSelectedItemId();e==state.currentSelectedId?("folder"==dataTree.getUserData(e,"type")?solveEditDom:solveEditDatasource)(e):t==state.currentSelectedId&&("folder"==myTree.getUserData(t,"type")?solveEditDom:solveEditLayer)(t)}function solveEditDom(e){var a=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$,t=myTree.getItemText(e);"dataSource"==dataTree.getUserData(e,"icon")&&(t=dataTree.getItemText(e)),self.selectedId=e,self.editDom?(self.editDom.remove(),self.editDom=null):(self.editDom=a("<div class='CgsLayerWindow'><div class='CgsLayerWindow__title'><span>编辑组名</span><div class='CgsToolBone__closeDiv_groupName'><div class='CgsToolBone__closeBtn_groupName'>+</div></div></div><div class='CgsLayerWindow__body'><div class='CgsLayerWindow__name'><span>名称</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel_editDom'>取消</div><div class='CgsLayerWindow__ok_editDom'>确定</div></div></div></div>"),self.editDom.find(".CgsLayerWindow__name_input").eq(0).val(t),a(viewer.container).append(self.editDom),self.editDom.draggable({handle:self.editDom.find(".CgsLayerWindow__title")}));var i=a(viewer.container);i.delegate(".CgsToolBone__closeDiv_groupName","click",function(e){self.editDom&&(self.editDom.remove(),self.editDom=null,self.selectedId=null)}),i.delegate(".CgsLayerWindow__ok_editDom","click",function(e){var t,i,s,o;self.editDom&&(t=a(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").val(),i=dataTree.getUserData(self.selectedId,"icon"),s=myTree.getUserData(self.selectedId,"icon"),"dataSource"==(o=null==i?s:i)?(editDomToDomList(self.selectedId,t),dataTree.setItemText(self.selectedId,t)):"layer"==o&&(editDomToDomList(self.selectedId,t),myTree.setItemText(self.selectedId,t)),self.editDom.remove(),self.editDom=null,self.selectedId=null)}),i.delegate(".CgsLayerWindow__cancel_editDom","click",function(e){self.editDom&&(self.editDom.remove(),self.editDom=null,self.selectedId=null)})}function solveEditLayer(selectedId){var _$$=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$,$$=_$$;self.selectedId=selectedId;var layerId=myTree.getUserData(selectedId,"data-layerId"),layer=viewer.getLayerById(layerId);self.type=layer.getType();var info=layer.save();self.editName?(self.editName.remove(),self.editName=null):("WMTS"==self.type&&(self.editName=$$("<div class='CgsLayerWindow'><div class='CgsLayerWindow__title'><span>编辑图层</span><div class='CgsToolBone__closeDiv_Public'><div class='CgsToolBone__closeBtn_mask_WMTS'>+</div></div></div><div class='CgsLayerWindow__body'><div class='CgsLayerWindow__name'><span>名称</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>服务地址*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>服务层级*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>边界</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>图层名*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最小可见层级</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最大可见层级</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>类型</span></div><textarea class='CgsLayerWindow__name_input' readonly='readonly'>WMTS</textarea><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel_editLayer'>取消</div><div class='CgsLayerWindow__ok_editLayer'>确定</div></div></div></div>"),self.editName.find(".CgsLayerWindow__name_input").eq(0).val(info.text),self.editName.find(".CgsLayerWindow__name_input").eq(1).val(info.url),self.editName.find(".CgsLayerWindow__name_input").eq(2).val(info.level),self.editName.find(".CgsLayerWindow__name_input").eq(3).val("["+info.rectangle+"]"),self.editName.find(".CgsLayerWindow__name_input").eq(4).val(info.layer),self.editName.find(".CgsLayerWindow__name_input").eq(5).val(info.minVisLevel),self.editName.find(".CgsLayerWindow__name_input").eq(6).val(info.maxVisLevel)),"WMS"==self.type&&(self.editName=$$("<div class='CgsLayerWindow'><div class='CgsLayerWindow__title'><span>编辑图层</span><div class='CgsToolBone__closeDiv_Public'><div class='CgsToolBone__closeBtn_mask_WMS'>+</div></div></div><div class='CgsLayerWindow__body'><div class='CgsLayerWindow__name'><span>名称</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>服务地址*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>边界</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>图层名*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最小可见层级</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最大可见层级</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>类型</span></div><textarea class='CgsLayerWindow__name_input' readonly='readonly'>WMS</textarea><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel_editLayer'>取消</div><div class='CgsLayerWindow__ok_editLayer'>确定</div></div></div></div>"),self.editName.find(".CgsLayerWindow__name_input").eq(0).val(info.text),self.editName.find(".CgsLayerWindow__name_input").eq(1).val(info.url),self.editName.find(".CgsLayerWindow__name_input").eq(2).val("["+info.rec+"]"),self.editName.find(".CgsLayerWindow__name_input").eq(3).val(info.layers),self.editName.find(".CgsLayerWindow__name_input").eq(4).val(info.minVisLevel),self.editName.find(".CgsLayerWindow__name_input").eq(5).val(info.maxVisLevel)),"WFS"==self.type&&(self.editName=$$("<div class='CgsLayerWindow'><div class='CgsLayerWindow__title'><span>编辑图层</span><div class='CgsToolBone__closeDiv_Public'><div class='CgsToolBone__closeBtn_mask_WFS'>+</div></div></div><div class='CgsLayerWindow__body'><div class='CgsLayerWindow__name'><span>名称</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>服务地址*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>服务层级*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最小可视距离*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>最大可视距离*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>图层名*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>类型</span></div><textarea class='CgsLayerWindow__name_input' readonly='readonly'>WFS</textarea><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel_editLayer'>取消</div><div class='CgsLayerWindow__ok_editLayer'>确定</div></div></div></div>"),self.editName.find(".CgsLayerWindow__name_input").eq(0).val(info.text),self.editName.find(".CgsLayerWindow__name_input").eq(1).val(info.url),self.editName.find(".CgsLayerWindow__name_input").eq(2).val(info.level),self.editName.find(".CgsLayerWindow__name_input").eq(3).val(info.minHeight),self.editName.find(".CgsLayerWindow__name_input").eq(4).val(info.maxHeight),self.editName.find(".CgsLayerWindow__name_input").eq(5).val(info.name)),"Image"==self.type&&(self.editName=$$("<div class='CgsLayerWindow'><div class='CgsLayerWindow__title'><span>编辑图层</span><div class='CgsToolBone__closeDiv_Public'><div class='CgsToolBone__closeBtn_mask_Image'>+</div></div></div><div class='CgsLayerWindow__body'><div class='CgsLayerWindow__name'><span>名称*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>服务地址*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>边界*</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__name'><span>类型</span></div><textarea class='CgsLayerWindow__name_input' readonly='readonly'>Image</textarea><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel_editLayer'>取消</div><div class='CgsLayerWindow__ok_editLayer'>确定</div></div></div></div>"),self.editName.find(".CgsLayerWindow__name_input").eq(0).val(info.text),self.editName.find(".CgsLayerWindow__name_input").eq(1).val(info.url),self.editName.find(".CgsLayerWindow__name_input").eq(2).val("["+info.rec+"]")),layer=null,$$(viewer.container).append(self.editName),self.editName.draggable({handle:self.editName.find(".CgsLayerWindow__title")}));var container=$$(viewer.container);container.delegate(".CgsToolBone__closeDiv_Public","click",function(e){self.editName&&(self.type=null,self.editName.remove(),self.editName=null,self.selectedId=null)}),container.delegate(".CgsToolBone__closeDiv_WMTS","click",function(e){self.editName&&(self.type=null,self.editName.remove(),self.editName=null,self.selectedId=null)}),container.delegate(".CgsToolBone__closeDiv_WMTS","click",function(e){self.editName&&(self.type=null,self.editName.remove(),self.editName=null,self.selectedId=null)}),container.delegate(".CgsToolBone__closeDiv_WMTS","click",function(e){self.editName&&(self.type=null,self.editName.remove(),self.editName=null,self.selectedId=null)}),container.delegate(".CgsLayerWindow__ok_editLayer","click",function(e){if(self.editName){var layerId=myTree.getUserData(self.selectedId,"data-layerId"),layer=viewer.getLayerById(layerId),index=viewer.getLayerIndexById(layerId),textValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(0).val(),urlValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(1).val(),levelValue,rectangleValue,layerValue,layersValue,maxHeight,minHeight,options,layerNew;if(""!=urlValue){if("WMTS"==self.type){levelValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(2).val(),rectangleValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(3).val(),layerValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(4).val();var minVisLevelValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(5).val(),maxVisLevelValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(6).val();if(""==levelValue||""==layerValue)return void CgsTipsWindow.showLog("信息填写不完整，请输入！");""==textValue&&(textValue=layerValue),(""==maxVisLevelValue||parseInt(maxVisLevelValue)>parseInt(levelValue))&&(maxVisLevelValue=levelValue),""==minVisLevelValue&&(minVisLevelValue=0),options=layer.save(),options.text=textValue,options.url=urlValue,options.level=levelValue,options.layer=layerValue,options.maxVisLevel=parseInt(maxVisLevelValue),options.minVisLevel=parseInt(minVisLevelValue)}else if("WMS"==self.type){rectangleValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(2).val(),layersValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(3).val();var minVisLevelValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(4).val(),maxVisLevelValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(5).val();if(""==layersValue)return void CgsTipsWindow.showLog("信息填写不完整，请输入！");""==textValue&&(textValue=layersValue),(""==maxVisLevelValue||parseInt(maxVisLevelValue)>parseInt(levelValue))&&(maxVisLevelValue=levelValue),""==minVisLevelValue&&(minVisLevelValue=0),options=layer.save(),options.text=textValue,options.url=urlValue,options.layers=layersValue,options.maxVisLevel=parseInt(maxVisLevelValue),options.minVisLevel=parseInt(minVisLevelValue)}else if("WFS"==self.type){if(levelValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(2).val(),minHeight=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(3).val(),maxHeight=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(4).val(),name=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(5).val(),""==levelValue||""==maxHeight||""==minHeight)return void CgsTipsWindow.showLog("信息填写不完整，请输入！");""==textValue&&(textValue=name),options=layer.save(),options.name=name,options.text=textValue,options.url=urlValue,options.level=levelValue,options.maxHeight=maxHeight,options.minHeight=minHeight,options.mapObject=viewer}else if("Image"==self.type){if(rectangleValue=$$(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(2).val(),""==textValue||""==rectangleValue)return void CgsTipsWindow.showLog("信息填写不完整，请输入！");options=layer.save(),options.text=textValue,options.url=urlValue}if(rectangleValue)try{if(rectangleValue=eval(rectangleValue),4!=rectangleValue.length)return void CgsTipsWindow.showLog("图层的显示范围必须包括【west,south,east,north】")}catch(e){return void CgsTipsWindow.showLog("图层显示范围格式不正确！")}else rectangleValue=void 0;options.isAddToLayerTree=!0;try{"WMTS"==self.type?(options.rectangle=rectangleValue,layerNew=new CgsTileLayer(options)):"WMS"==self.type?(options.rec=rectangleValue,layerNew=new CgsWMSLayer(options)):"WFS"==self.type?layerNew=new CgsWFSLayer(options):"Image"==self.type&&(options.rec=rectangleValue,layerNew=new CgsImageLayer(options));var layerId=layerNew.getId();myTree.setUserData(self.selectedId,"data-layerId",layerId),viewer.removeLayer(layer),viewer.addLayer(layerNew,index),myTree.setItemText(self.selectedId,textValue)}catch(e){return void CgsTipsWindow.showLog("信息存在问题，请重新输入！")}self.editName.remove(),self.type=null,self.editName=null,self.selectedId=null}else CgsTipsWindow.showLog("信息填写不完整，请输入！")}}),container.delegate(".CgsLayerWindow__cancel_editLayer","click",function(e){self.editName&&(self.type=null,self.editName.remove(),self.editName=null,self.selectedId=null)})}function addDomToDomList(e,t){if(state.newDomList.push({id:e,text:t}),0!=myTree.getItemText(e)){for(var i=viewer.treeNodes.layerGroup,s=0;s<i.length;s++)if(e==i[s].id)return;var o=myTree.getParentId(e);viewer.treeNodes.layerGroup.push({name:t,id:e,pId:o,open:!0,type:"layerGroup"})}else if(0!=dataTree.getItemText(e)){for(i=viewer.treeNodes.datasourceGroup,s=0;s<i.length;s++)if(e==i[s].id)return;o=dataTree.getParentId(e);viewer.treeNodes.datasourceGroup.push({name:t,id:e,pId:o,open:!0,type:"datasourceGroup"})}logDom()}function deleteDomToDomList(e){for(var t=0;t<state.newDomList.length;t++)if(e==state.newDomList[t].id){state.newDomList.splice(t,1);break}for(var i=viewer.treeNodes.layerGroup,t=0;t<i.length;t++){if(e==i[t].id)return void viewer.treeNodes.layerGroup.splice(t,1)}i=viewer.treeNodes.datasourceGroup;for(t=0;t<i.length;t++){if(e==i[t].id)return void viewer.treeNodes.datasourceGroup.splice(t,1)}logDom()}function editDomToDomList(e,t){for(var i=0;i<state.newDomList.length;i++)e==state.newDomList[i].id&&(state.newDomList[i]={id:e,text:t});for(var s=viewer.treeNodes.layerGroup,i=0;i<s.length;i++){e==s[i].id&&(viewer.treeNodes.layerGroup[i].name=t)}s=viewer.treeNodes.datasourceGroup;for(i=0;i<s.length;i++){e==s[i].id&&(viewer.treeNodes.datasourceGroup[i].name=t)}}function getGroupId(e){for(var t=0;t<state.newDomList.length;t++){var i=state.newDomList[t].id,s=myTree.getItemText(i),o=dataTree.getItemText(i);if(s==e||o==e)return i}return null}function getParentIdLastGruopId(e,t){if("dataTree"==e){for(var i=dataTree.getSubItems(t).split(","),s=0;s<i.length;s++)if("folder"!=dataTree.getUserData(i[s],"type"))return i[s];return i[i.length-1]}if("myTree"==e){for(i=myTree.getSubItems(t).split(","),s=0;s<i.length;s++)if("folder"!=myTree.getUserData(i[s],"type"))return i[s];return i[i.length-1]}}function getGroupLastChild(e){var t=myTree.getSubItems(e).split(",");return t[t.length-1]}function getGroupLastSecondChild(e){var t=myTree.getSubItems(e).split(",");return t[t.length-2]}function logLayer(){}function logDom(){for(var e=0;e<state.newDomList.length;e++)state.newDomList[e].id,state.newDomList[e].text}function initFrame(){var e=document.createElement("div");e.setAttribute("class","layerBox layerBox_new"),e.onclick=function(e){for(var t=document.getElementsByClassName("lec_bc_addLayerMode"),i=0;i<t.length;i++)"none"!=t[i].style.display&&(t[i].style.display="none")};var t=document.createElement("div");t.setAttribute("class","treeBox"),t.setAttribute("id","CgsLayerTool_container_id"),t.setAttribute("class","CgsLayerTool_container_new");var i=document.createElement("div");i.setAttribute("id","layerTreeHere"),i.setAttribute("class","layerTreeHere_new");var s=document.createElement("div");s.setAttribute("id","dataTreeHere");var o=document.createElement("div");o.setAttribute("class","lec_buttonContainer lec_buttonContainer_new"),t.appendChild(i),t.appendChild(s),e.appendChild(t),e.appendChild(o),self.body=$$(e);var a=CGS_SDK_PATH+"assets/image/plugg/layerPlugg/box_title_background.png";self.title=$$("<div class='CgsLayerTool__title CgsTool__title CgsLayerTool_title_new'><span class='CgsLayerTool__titleText CgsLayerTool__titleText_new'>图层</span><div class='CgsLayerTool__closeButton'></div></div>"),self.title.find(".CgsLayerTool__titleImg").attr("src",a),CgsTool.call(self,viewer,self.title,self.body);var n=document.createElement("div");n.setAttribute("class","lec_bc_addLayer lec_bc_addLayer_new"),n.setAttribute("title","添加"),n.onclick=function(e){e.stopPropagation();var t=document.getElementsByClassName("lec_bc_addLayerMode")[0];"none"==t.style.display?t.style.display="block":t.style.display="none"};var r=document.createElement("div");r.setAttribute("class","lec_bc_editLayer lec_bc_editLayer_new"),r.setAttribute("title","编辑"),r.onclick=function(e){solveEditItem()};var l=document.createElement("div");l.setAttribute("class","lec_bc_addDom lec_bc_addDom_new"),l.setAttribute("title","添加节点"),l.onclick=function(e){solveAddDom()};var u=document.createElement("div");u.setAttribute("class","lec_bc_removeDom lec_bc_removeDom_new"),u.setAttribute("title","删除"),u.onclick=function(e){confirm("确定删除该图层？")&&solveDeleteItem()},o.appendChild(n),o.appendChild(r),o.appendChild(l),o.appendChild(u);var p=document.createElement("div");p.setAttribute("class","lec_bc_addLayerMode"),p.setAttribute("data-flag",!1),p.style.display="none",p.onmouseleave=function(e){e.target.style.display="none"};var h=document.createElement("div");h.setAttribute("class","lec_bc_alm_item"),h.style.height="32px",h.innerHTML="添加图层",h.onclick=function(e){e.stopPropagation(),solveAddLayer(),e.target.parentNode.style.display="none"},p.appendChild(h),o.appendChild(p),createLayersPopup()}function getAddedLayerHasInTreeFlag(e){for(var t=myTree.getAllChildless().split(","),i=0;i<t.length;i++){var s=t[i];if(e==myTree.getUserData(s,"data-layerId"))return!0}return!1}function getAddedDatasourceHasInTreeFlag(e){for(var t=dataTree.getAllChildless().split(","),i=0;i<t.length;i++){var s=t[i];if(e==dataTree.getUserData(s,"data-datasourceId"))return!0}return!1}function layerAddedHandler(e,t,i){if(i.getAddToLayerTree()){var s=i.getId();if(!getAddedLayerHasInTreeFlag(s)){var o=i.getPId();""!=o&&null!=o||(o=state.layerId);var a=i.getText();""!=a&&null!=a||(a="未命名");var n=i.getVisible(),r=state.layerStartId++;if(myTree.insertNewItem(o,r,a),myTree.setUserData(r,"icon","layer"),myTree.setUserData(r,"data-layerId",s),n?myTree.setCheck(r,1):myTree.setCheck(r,0),self.sortOrder&&o!=state.layerId)for(var l=myTree.getSubItems(o).split(",").length,u=0;u<l-1;u++)myTree.moveItem(r,"up");state.layerStartId++}}}function layerRemovedHandler(e,t,i){for(var s=i.getId(),o=myTree.getAllChildless().split(","),a=0;a<o.length;a++){var n=o[a];if(s==myTree.getUserData(n,"data-layerId"))return void myTree.deleteItem(n,!1)}}function datasourceAddedHandler(e,t,i){var s,o,a,n,r;i.getIsAddToLayerTree()&&(getAddedDatasourceHasInTreeFlag(s=i.getId())||(""!=(o=i.getPId())&&null!=o||(o=state.datasourceId),""!=(a=i.getName())&&null!=a||(a="未命名"),n=i.getVisible(),r=state.datasourceStartId++,dataTree.insertNewItem(o,r,a),dataTree.setUserData(r,"icon","dataSource"),dataTree.setUserData(r,"data-datasourceId",s),n?dataTree.setCheck(r,1):dataTree.setCheck(r,0),state.datasourceStartId++))}function datasourceRemovedHandler(e,t,i){for(var s=i.getId(),o=dataTree.getAllChildless().split(","),a=0;a<o.length;a++){var n=o[a];if(s==dataTree.getUserData(n,"data-datasourceId"))return void dataTree.deleteItem(n,!1)}}function createLayersPopup(){var e=$$("<div id='cgs-layers-popup'></div>");e.appendTo($$("#"+viewer.target)),e.prepend($$("\n\t\t\t<div class='layers-popup-title'>\n\t\t\t\t<span>当前图层：未选中图层</span>\n\t\t\t\t<div class='CgsToolBone__closeDiv'><div class='CgsToolBone__closeBtn_choseMsak'>+</div></div>\n\t\t\t</div>\n\t\t\t<div class='layers-popup-body'>\n\t\t\t\t<div class='opacity-title-name'>透明度</div>\n\t\t\t\t<div id='cgs-opacity-slider'>\n\t\t\t\t\t<div class='slider-bar'></div>\n\t\t\t\t\t<div class='slider-mask'></div>\n\t\t\t\t</div>\n\t\t\t\t<span class='slider-number'>100%</span>\n\t\t\t</div>")),$$("#cgs-layers-popup .layers-popup-title .CgsToolBone__closeDiv").on("click",function(){$$("#cgs-layers-popup").css("display","none")}),e.draggable({handle:e.find(".layers-popup-title")});var t=e.find("#cgs-opacity-slider"),i=($sliderPlgg=t).children()[0],a=(t.children()[1],t.next());i.onmousedown=function(e){var s=(e=e||window.event).clientX-this.offsetLeft,o=this;document.onmousemove=function(e){e=e||window.event;o.style.left=e.clientX-s+"px";var t=parseInt(o.style.left),i=void 0;t<10?(o.style.left="10px",i=0,a.text("0%"),self.state.opacityRecords[self.state.selectLayerId]=0):10<t&&t<115?(i=(t-10)/105,a.text(parseInt((t-10)/105*100)+"%"),self.state.opacityRecords[self.state.selectLayerId]=t):115<t&&(i=1,o.style.left="115px",a.text("100%"),self.state.opacityRecords[self.state.selectLayerId]=115),self.state.selectLayer&&self.state.selectLayer.setAlpha(i),window.getSelection?window.getSelection().removeAllRanges():document.getSelection.empty()},document.onmouseup=function(){document.onmousemove=null}}}CgsSubPub.subscribe("datasourceloaderror",function(e){CgsTipsWindow.showLog("数据源加载失败!")}),CgsSubPub.subscribe("sceneload",function(){self.body.find("#dataTreeHere").empty(),self.body.find("#layerTreeHere").empty(),state.firstTimeFlag=!0,CgsSubPub.unsubscribe(state.layerAddedHandlerId),CgsSubPub.unsubscribe(state.layerRemovedHandlerId),CgsSubPub.unsubscribe(state.datasourceAddedHandlerId),CgsSubPub.unsubscribe(state.datasourceRemovedHandlerId),self.deactivate()}),this.showView=function(){state.firstTimeFlag&&(loadDataTree(),loadMyTree(),initTreeData(),state.datasourceRemovedHandlerId=CgsSubPub.subscribe("datasourceremoved",datasourceRemovedHandler),state.datasourceAddedHandlerId=CgsSubPub.subscribe("datasourceadded",datasourceAddedHandler),state.layerRemovedHandlerId=CgsSubPub.subscribe("layerremoved",layerRemovedHandler),state.layerAddedHandlerId=CgsSubPub.subscribe("layeradded",layerAddedHandler),state.firstTimeFlag=!1)},this.getSaveLayerInfo=function(){return viewer.treeNodes.layerGroup},this.getSaveDatasourceInfo=function(){return viewer.treeNodes.datasourceGroup},this.setSortOrder=function(e){this.sortOrder=e},initFrame()},CgsInherits(CgsLayerPlugg,CgsTool),CgsLayerPlugg.prototype.activate=function(){CgsTool.prototype.activate.call(this),this.showView()},CgsLayerPlugg.prototype.deactivate=function(){CgsTool.prototype.deactivate.call(this)},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/jmpLayerPlugg/CgsJmpLayerPlugg.css"/>'),CgsJmpLyaerPlugg=function(h,p){var c=this,g={selectedItem:void 0,firstTimeFlag:this.sortOrder=!0,layerStartId:200,datasourceStartId:11e4,newDomList:[],currentSelectedId:"symbol_layer_1",addDomFlag:!1,layerRootId:null,layerId:null,dataRootId:null,datasourceId:null,datasourceLoadErrorId:null,datasourceLoadByFileSucessId:null,layerAddedHandlerId:null,layerRemovedHandlerId:null,datasourceAddedHandlerId:null,datasourceRemovedHandlerId:null,opacityRecords:{}},d=p;this.map=h,this.jmpManage=new CgsJmpManage(h),this.state=g;var m=void 0,u=void 0,f=null;h.jmpApi.layerGroup||(h.jmpApi.layerGroup=[]);var C=p?JSON.parse(p.config).treeNode:[{id:"symbol_layer_1",name:"军标基础图层",open:!0,pId:"null",type:"layerGroup"}];function e(){var r,l;(m=new dhtmlXTreeObject("layerTreeHere","100%","auto","layerRoot")).setImagePath(CGS_SDK_PATH+"dHtmlxTree/skins/skyblue/imgs/dhxtree_skyblue/"),m.enableDragAndDrop(!0),m.enableCheckBoxes(!0),m.setDragBehavior("complex"),m.setDataMode("json"),m.enableThreeStateCheckboxes(1),(c.myTree=m).setOnClickHandler(function(e){var t,i,s,o,a,n,r,l;g.treeNodeClickDisable||(t=u.getUserData(g.currentSelectedId,"icon"),-1!=g.currentSelectedId&&"dataSource"==t&&u.clearSelection(g.currentSelectedId),g.currentSelectedId=e,i=e,"layer"===(m.getUserData(i,"icon")||u.getUserData(i,"icon"))&&("block"!==$$("#cgs-layers-popup").css("display")&&$$("#cgs-layers-popup").css("display","block"),s=m.getUserData(i,"data-layerId"),g.selectLayerId=s,(o=h.getLayerById(s))instanceof CgsTileLayer&&(a=(g.selectLayer=o).getText(),n=g.opacityRecords[s]||115,r=f.children()[0],l=f.next(),r.style.left=n+"px",10==n?l.text("0%"):115==n?l.text("100%"):l.text(parseInt((n-10)/105*100)+"%"),$$("#cgs-layers-popup .layers-popup-title span").text("当前图层："+a))))}),m.attachEvent("onBeforeDrag",function(e){return"folder"!=m.getUserData(e,"type")&&(r=m.getParentId(e),t=r,i=m.getSubItems(t).split(","),l=i[i.length-1],!0);var t,i}),m.attachEvent("onDragIn",function(e,t,i,s){return null!=t&&(m.getUserData(t,"icon")==m.getUserData(e,"icon")&&!0)}),m.attachEvent("onDrag",function(e,t,i,s,o){if(!i&&"folder"!=m.getUserData(t,"type"))return!1;if(r==t&&null!=i){var a=m.getUserData(i,"data-layerId");if(null==h.getLayerIndexById(a))return g.currentSelectedId=e,!1}return!0}),m.attachEvent("onDrop",function(e,t,i,s,o){var a,n;return g.addDomFlag||(r==t?y(e,t,i,l):y(e,t,i,(a=t,(n=m.getSubItems(a).split(","))[n.length-2]))),!0}),m.attachEvent("onCheck",function(e,t){return v(e,t),!0})}function y(e,t,i,s){var o=m.getUserData(e,"data-layerId"),a=h.getSymbolByNodeName(o),n=m.getUserData(i,"data-layerId");m.getIndexById(i);null==i&&(n=m.getUserData(s,"data-layerId"),m.getIndexById(s));h.getLayerIndexById(n);a.pId=t}function v(e,t){m.getUserData(e,"icon"),u.getUserData(e,"icon");if(0==m.hasChildren(e)){var i=m.getUserData(e,"data-layerId");(a=h.getSymbolByNodeName(i))&&a.setVisible(t),m.setCheck(e,t)}else for(var s=m.getSubItems(e).split(","),o=0;o<s.length;o++){var a,n=s[o];0!=m.hasChildren(n)?(m.setCheck(n,t),v(n,t)):(i=m.getUserData(n,"data-layerId"),(a=h.getSymbolByNodeName(i))&&a.setVisible(t),m.setCheck(n,t))}}function b(e){var t=m.getSelectedItemId(),i=u.getSelectedItemId();if(!t&&!i)return null;var s,o=null;return t&&"datasource"!=e&&(o="folder"==m.getUserData(t,"type")?m.getItemText(t):(s=m.getParentId(t),m.getItemText(s))),i&&"layer"!=e&&(o="folder"==u.getUserData(i,"type")?u.getItemText(i):(s=u.getParentId(i),u.getItemText(s))),o}function D(){u.getSelectedItemId();var e=m.getSelectedItemId();e==g.currentSelectedId&&(!function e(t){if("folder"==m.getUserData(t,"type")&&0==m.hasChildren(t))r(t),m.deleteItem(t,!1);else if(0==m.hasChildren(t)){var i=m.getUserData(t,"data-layerId"),s=h.getSymbolByNodeName(i);s&&h.removeSymbol(s),m.deleteItem(t,!1)}else{var o=m.getSubItems(t).split(",");r(t);for(var a=0;a<o.length;a++){var n=o[a];0!=m.hasChildren(n)?e(n):(i=m.getUserData(n,"data-layerId"),(s=h.getSymbolByNodeName(i))&&h.removeSymbol(s),m.deleteItem(n,!1))}}}(e),m.deleteItem(e,!1))}function S(e){var a=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$,t=m.getItemText(e);"dataSource"==u.getUserData(e,"icon")&&(t=u.getItemText(e)),c.selectedId=e,c.editDom?(c.editDom.remove(),c.editDom=null):(c.editDom=a("<div class='CgsLayerWindow'><div class='CgsLayerWindow__title'><span>编辑图层</span></div><div class='CgsLayerWindow__body'><div class='CgsLayerWindow__name'><span>名称</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel_editDom'>取消</div><div class='CgsLayerWindow__ok_editDom'>确定</div></div></div></div>"),c.editDom.find(".CgsLayerWindow__name_input").eq(0).val(t),a(h.container).append(c.editDom),c.editDom.draggable({handle:c.editDom.find(".CgsLayerWindow__title")}));var i=a(h.container);i.delegate(".CgsLayerWindow__ok_editDom","click",function(e){var t,i,s,o;c.editDom&&(t=a(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").val(),i=u.getUserData(c.selectedId,"icon"),s=m.getUserData(c.selectedId,"icon"),"dataSource"==(o=null==i?s:i)?(n(c.selectedId,t),u.setItemText(c.selectedId,t)):"layer"==o&&(n(c.selectedId,t),m.setItemText(c.selectedId,t)),c.editDom.remove(),c.editDom=null,c.selectedId=null)}),i.delegate(".CgsLayerWindow__cancel_editDom","click",function(e){c.editDom&&(c.editDom.remove(),c.editDom=null,c.selectedId=null)})}function _(e,t){g.newDomList.push({id:e,text:t});for(var i=h.jmpApi.layerGroup,s=0;s<i.length;s++)if(e==i[s].id)return;var o=m.getParentId(e);h.jmpApi.layerGroup.push({name:t,id:e,pId:o,open:!0,type:"layerGroup"}),a()}function r(e){for(var t=0;t<g.newDomList.length;t++)if(e==g.newDomList[t].id){g.newDomList.splice(t,1);break}for(var i=h.jmpApi.layerGroup,t=0;t<i.length;t++){if(e==i[t].id)return void h.jmpApi.layerGroup.splice(t,1)}i=h.treeNodes.datasourceGroup;for(t=0;t<i.length;t++){if(e==i[t].id)return void h.treeNodes.datasourceGroup.splice(t,1)}a()}function n(e,t){for(var i=0;i<g.newDomList.length;i++)e==g.newDomList[i].id&&(g.newDomList[i]={id:e,text:t});for(var s=h.jmpApi.layerGroup,i=0;i<s.length;i++){e==s[i].id&&(h.jmpApi.layerGroup[i].name=t)}s=h.treeNodes.datasourceGroup;for(i=0;i<s.length;i++){e==s[i].id&&(h.treeNodes.datasourceGroup[i].name=t)}}function w(e){for(var t=0;t<g.newDomList.length;t++){var i=g.newDomList[t].id,s=m.getItemText(i),o=u.getItemText(i);if(s==e||o==e)return i}return null}function a(){for(var e=0;e<g.newDomList.length;e++)g.newDomList[e].id,g.newDomList[e].text}function t(e,t,i){window.map;var s=t.getNodeName();if(!function(e){for(var t=m.getAllChildless().split(","),i=0;i<t.length;i++){var s=t[i];if(e==m.getUserData(s,"data-layerId"))return!0}return!1}(s)){var o=c.state.currentSelectedId;(-1!=(t.pId=o).indexOf("level")&&-1!=o.indexOf("symbol")||""==o||null==o)&&(o=g.layerId);var a=t.getName();""!=a&&null!=a||(a=c.jmpManage.findJbsById(t.options.id)[0].name);var n=t.getVisible(),r=g.layerStartId++;if(m.insertNewItem(o,r,a),m.setUserData(r,"icon","symbol"),m.setUserData(r,"data-layerId",s),n?m.setCheck(r,1):m.setCheck(r,0),c.sortOrder&&o!=g.layerId)for(var l=m.getSubItems(o).split(",").length,u=0;u<l-1;u++)m.moveItem(r,"up");g.layerStartId++}}function i(e,t,i){for(var s=t,o=m.getAllChildless().split(","),a=0;a<o.length;a++){var n=o[a];if(s==m.getUserData(n,"data-layerId"))return void m.deleteItem(n,!1)}}function s(e,t,i){var s,o,a,n,r;i.getIsAddToLayerTree()&&(function(e){for(var t=u.getAllChildless().split(","),i=0;i<t.length;i++){var s=t[i];if(e==u.getUserData(s,"data-datasourceId"))return!0}return!1}(s=i.getId())||(""!=(o=i.getPId())&&null!=o||(o=g.datasourceId),""!=(a=i.getName())&&null!=a||(a="未命名"),n=i.getVisible(),r=g.datasourceStartId++,u.insertNewItem(o,r,a),u.setUserData(r,"icon","dataSource"),u.setUserData(r,"data-datasourceId",s),n?u.setCheck(r,1):u.setCheck(r,0),g.datasourceStartId++))}function o(e,t,i){for(var s=i.getId(),o=u.getAllChildless().split(","),a=0;a<o.length;a++){var n=o[a];if(s==u.getUserData(n,"data-datasourceId"))return void u.deleteItem(n,!1)}}this.layers=C,CgsSubPub.subscribe("datasourceloaderror",function(e){CgsTipsWindow.showLog("数据源加载失败!")}),CgsSubPub.subscribe("sceneload",function(){c.body.find("#jmpTreeHere").empty(),c.body.find("#layerTreeHere").empty(),g.firstTimeFlag=!0,CgsSubPub.unsubscribe(g.layerAddedHandlerId),CgsSubPub.unsubscribe(g.layerRemovedHandlerId),CgsSubPub.unsubscribe(g.datasourceAddedHandlerId),CgsSubPub.unsubscribe(g.datasourceRemovedHandlerId),c.deactivate()}),this.showView=function(){g.firstTimeFlag&&((u=new dhtmlXTreeObject("jmpTreeHere","100%","auto","dataRoot")).setImagePath(CGS_SDK_PATH+"dHtmlxTree/skins/web/imgs/dhxtree_web/"),u.enableDragAndDrop(!0),u.enableCheckBoxes(!0),u.setDragBehavior("complex"),u.setDataMode("json"),u.enableThreeStateCheckboxes(1),u.setOnClickHandler(function(e){var t=m.getUserData(g.currentSelectedId,"icon");-1!=g.currentSelectedId&&"layer"==t&&m.clearSelection(g.currentSelectedId),g.currentSelectedId=e}),u.attachEvent("onBeforeDrag",function(e){return"folder"!=u.getUserData(e,"type")}),u.attachEvent("onDragIn",function(e,t,i,s){return null!=t&&u.getUserData(t,"icon")==u.getUserData(e,"icon")}),u.attachEvent("onDrag",function(e,t,i,s,o){return!(!i&&"folder"!=u.getUserData(t,"type"))}),u.attachEvent("onDrop",function(e,t,i,s,o){var a;return g.addDomFlag||(a=u.getUserData(e,"data-datasourceId"),h.getDataSourceById(a).setPId(t)),!0}),u.attachEvent("onCheck",function(e,t){return v(e,t),!0}),e(),function(){if(c.state.myTree=m,C){for(var e=C,t=0;t<e.length;t++){var i=e[t].pId,s=e[t].name,o=e[t].id;"null"==i&&(i="layerRoot",g.layerRootId=o),"图层"==s&&(g.layerId=o),m.insertNewItem(i,o,s,"","groupEmpty.gif"),m.setUserData(o,"type","folder"),m.setUserData(o,"icon","layer"),_(o,s)}d&&d.config&&c.loadTreeConfigFile(p.config);for(var a=map.allSymbols,n=0;n<a.length;n++){t=n;c.sortOrder&&(t=a.length-1-n);var r=a[t].getNodeName(),l=map.getSymbolByNodeName(r),i="symbol_layer_1";l.pId&&(i=l.pId),""!=i&&null!=i||(i=g.layerId),""!=(s=l.getName())&&null!=s||(s=c.jmpManage.findJbsById(l.options.id)[0].name);var u=a[t].getVisible(),o=g.layerStartId++;m.insertNewItem(i,o,s),m.setUserData(o,"icon","layer"),m.setUserData(o,"data-layerId",r),u?m.setCheck(o,1):m.setCheck(o,0),g.layerStartId++}for(e=h.jmpApi.layerGroup,t=0;t<e.length;t++){o=e[t].id;e[t].open?m.openItem(o):m.closeItem(o)}}}(),g.datasourceRemovedHandlerId=CgsSubPub.subscribe("datasourceremoved",o),g.datasourceAddedHandlerId=CgsSubPub.subscribe("datasourceadded",s),g.layerRemovedHandlerId=CgsSubPub.subscribe(CgsEvent.eSymbolDeleted,i),g.layerAddedHandlerId=CgsSubPub.subscribe("symbolnodeadd",t),g.firstTimeFlag=!1)},this.getSaveLayerInfo=function(){return h.jmpApi.layerGroup},this.getSaveDatasourceInfo=function(){return h.treeNodes.datasourceGroup},this.setSortOrder=function(e){this.sortOrder=e},function(){var e=document.createElement("div");e.setAttribute("class","layerBox"),e.onclick=function(e){for(var t=document.getElementsByClassName("lec_bc_addLayerMode"),i=0;i<t.length;i++)"none"!=t[i].style.display&&(t[i].style.display="none")};var t=document.createElement("div");t.setAttribute("class","treeBox"),t.setAttribute("id","CgsJmpLayer_container_id");var i=document.createElement("div");i.setAttribute("id","layerTreeHere");var s=document.createElement("div");s.setAttribute("id","jmpTreeHere");var o=document.createElement("div");o.setAttribute("class","lec_buttonContainer"),t.appendChild(i),t.appendChild(s),e.appendChild(t),e.appendChild(o),c.body=$$(e);var a=CGS_SDK_PATH+"assets/image/ablum.png";c.title=$$("<div class='CgsLayerTool__title CgsTool__title'><img class='CgsLayerTool__titleImg' ><span class='CgsLayerTool__titleText'>图层</span><div class='CgsLayerTool__closeButton'></div></div>"),c.title.find(".CgsLayerTool__titleImg").attr("src",a),CgsTool.call(c,h,c.title,c.body);var n=document.createElement("div");n.setAttribute("class","lec_bc_addLayer"),n.setAttribute("title","导出"),n.onclick=function(e){console.log(c.state.currentSelectedId);for(var t=m.getAllChildless().split(","),i=[],s=0;s<t.length;s++){var o=t[s],a=m.getUserData(o,"data-layerId");if(i.push(c.map.getSymbolByNodeName(a)),""==a)return void m.deleteItem(o,!1)}var n=c.map.saveAfferentSymbolsScene(i),r=new File([n],"scene.sml",{type:"text/xml;charset=utf-8"});saveAs(r)};var r=document.createElement("div");r.setAttribute("class","lec_bc_editLayer"),r.setAttribute("title","编辑"),r.onclick=function(e){S()};var l=document.createElement("div");l.setAttribute("class","lec_bc_addDom"),l.setAttribute("title","添加节点"),l.onclick=function(e){!function(){var n=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$;if(c.newdom)c.newdom.remove(),c.newdom=null,n(this).removeClass("CgsBottomTool__pressed");else{c.newdom=n("<div class='CgsLayerWindow' id='adlayer'><div class='CgsLayerWindow__title'><span>添加节点</span></div><div class='CgsLayerWindow__body'><div style='display:none;' class='CgsLayerWindow__name'><span>父节点名称</span></div><select style='display:none;' class='CgsLayerWindow__layerType_select'></select><div class='CgsLayerWindow__name'><span>新节点名称</span></div><input class='CgsLayerWindow__name_input'></input><div class='CgsLayerWindow__bottom'><div class='CgsLayerWindow__cancel_newdom'>取消</div><div class='CgsLayerWindow__ok_newdom'>确定</div></div></div></div>");for(var e=c.newdom.find(".CgsLayerWindow__layerType_select").eq(0),t=h.jmpApi.layerGroup,i=0;i<t.length;i++){var s=t[i].name;e.append("<option>"+s+"</option>")}var o=b("all");o&&c.newdom.find(".CgsLayerWindow__layerType_select").eq(0).find("option:selected").text(o),c.newdom.find(".CgsLayerWindow__name_input").eq(0).val("未命名"),n(h.container).append(c.newdom),c.newdom.draggable({handle:c.newdom.find(".CgsLayerWindow__title")}),n(this).addClass("CgsBottomTool__pressed")}var a=n(h.container);a.delegate(".CgsLayerWindow__ok_newdom","click",function(e){var t,i,s,o,a;console.log("添加节点"),g.addDomFlag=!0,c.newdom&&(t=c.newdom.find(".CgsLayerWindow__layerType_select").eq(0).find("option:selected").text(),o=n(this).parents(".CgsLayerWindow").find(".CgsLayerWindow__name_input").eq(0).val(),s=w(t),""!=o?null==w(o)?(a=301,"null"==(s=null)&&(s="layerRoot"),m.insertNewItem(s,301,o,"","groupEmpty.gif"),m.setUserData(301,"type","folder"),m.setUserData(301,"icon","layer"),i={id:"symbol_layer_"+(c.layers.length+1),name:o,open:!0,pId:"null",type:"layerGroup"},c.layers.push(i),o=i.name,a=i.id,"null"==(s=i.pId)&&(s="layerRoot",g.layerRootId=a),"图层"==o&&(g.layerId=a),m.insertNewItem(s,a,o,"","groupEmpty.gif"),m.setUserData(a,"type","folder"),m.setUserData(a,"icon","layer"),_(a,o),c.newdom.remove(),c.newdom=null,n(this).removeClass("CgsBottomTool__pressed")):CgsTipsWindow.showLog("该组别已存在，组别不能相同，请重新输入！"):CgsTipsWindow.showLog("新节点名称不能为空！"))}),a.delegate(".CgsLayerWindow__cancel_newdom","click",function(e){g.addDomFlag=!1,c.newdom&&(c.newdom.remove(),c.newdom=null,c.body.find(".CgsBottomTool__pressed").removeClass("CgsBottomTool__pressed"))})}()};var u=document.createElement("div");u.setAttribute("class","lec_bc_removeDom"),u.setAttribute("title","删除"),u.onclick=function(e){confirm("确定删除该图层？")&&D()},o.appendChild(r),o.appendChild(n),o.appendChild(l),o.appendChild(u);var p=document.createElement("div");p.setAttribute("class","lec_bc_addLayerMode"),p.setAttribute("data-flag",!1),p.style.display="none",p.onmouseleave=function(e){e.target.style.display="none"}}()},CgsInherits(CgsJmpLyaerPlugg,CgsTool),CgsJmpLyaerPlugg.prototype.activate=function(){CgsTool.prototype.activate.call(this),this.activateType=!0,this.showView()},CgsJmpLyaerPlugg.prototype.deactivate=function(){CgsTool.prototype.deactivate.call(this),this.activateType=!1},CgsJmpLyaerPlugg.prototype.exportTreeConfigFile=function(){for(var e={symbols:[],treeNode:[]},t=0;t<this.map.allSymbols.length;t++){var i={key:this.map.allSymbols[t].node.getName(),value:this.map.allSymbols[t].pId};e.symbols.push(i)}for(var s=0;s<this.map.jmpApi.layerGroup.length;s++)-1!=this.map.jmpApi.layerGroup[s].id.indexOf("symbol")&&e.treeNode.push(this.map.jmpApi.layerGroup[s]);return JSON.stringify(e)},CgsJmpLyaerPlugg.prototype.loadTreeConfigFile=function(e){for(var t=JSON.parse(e),i=0;i<t.symbols.length;i++)for(var s=0;s<this.map.allSymbols.length;s++){if(this.map.allSymbols[s].node.getName()==t.symbols[i].key){this.map.allSymbols[s].pId=t.symbols[i].value;break}}},CgsJmpLyaerPlugg.prototype.closeAllItem=function(){for(var e=this.map.jmpApi.layerGroup,t=0;t<e.length;t++){var i=e[t].id;e[t].open;this.myTree.closeItem(i)}},CgsJmpLyaerPlugg.prototype.openAllItem=function(){for(var e=this.map.jmpApi.layerGroup,t=0;t<e.length;t++){var i=e[t].id;e[t].open;this.myTree.openItem(i)}},CgsJmpLyaerPlugg.prototype.addTreeNode=function(e){this.state.addDomFlag=!0;var t="symbol_layer_"+this.map.jmpApi.layerGroup.length;this.state.myTree.insertNewItem("layerRoot",t,e,"","groupEmpty.gif"),this.state.myTree.setUserData(t,"type","folder"),this.state.myTree.setUserData(t,"icon","layer");var i={id:"symbol_layer_"+(this.layers.length+1),name:e,open:!0,pId:"layerRoot",type:"layerGroup"};this.layers.push(i);e=i.name,t=i.id;this.state.newDomList.push({id:t,text:e});var s=this.state.myTree.getParentId(t);this.map.jmpApi.layerGroup.push({name:e,id:t,pId:s,open:!0,type:"layerGroup"});for(var o=0;o<this.state.newDomList.length;o++)t=this.state.newDomList[o].id,this.state.newDomList[o].newDomName;return t},CgsJmpLyaerPlugg.prototype.setTreeNodeAndChildrenDisable=function(e,t){var i=null,i=t?1:0;this.state.myTree.disableCheckbox(e,i);for(var s=this.state.myTree.getSubItems(e).split(","),o=0;o<s.length;o++){var a=s[o];this.state.myTree.disableCheckbox(a,i)}},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/toolbarPlugg/zoolonToolbarPlugg.css"/>'),CgsToolbarPlugg=function(r,l){var u,p=this;function h(e,t){var i=$$("<div></div>");i.addClass("toolbar_buttonBox"),i.attr("data-btID",t.id),i.attr("title",t.showText),i.mouseover(function(e){$$(this).addClass("toolbar_buttonBox_hover")}),i.mouseout(function(e){var t=$$(this).attr("data-btID");$$(this).removeClass("toolbar_buttonBox_hover"),$$(this).hasClass("toolbar_buttonBox_selected")&&("rotateLeft"!=t&&"rotateRight"!=t||p.rotateCancelFlag)&&$$(this).removeClass("toolbar_buttonBox_selected")}),i.click(function(e){var t=$$(this).attr("data-btID"),i=!0;switch($$(this).hasClass("toolbar_buttonBox_selected")?(i=!1,"rotateLeft"!=t&&"rotateRight"!=t||(p.rotateCancelFlag=!0)):($$(this).addClass("toolbar_buttonBox_selected"),p.rotateCancelFlag=!1),t){case"zoomIn":r.zoomIn();break;case"zoomOut":r.zoomOut();break;case"viewHome":r.flyHome(),r.map2D.view.setRotation(0);break;case"dimensionSwitch":r.threeFlag&&("2D"==r.mode?r.setMapMode("3D"):r.setMapMode("2D"));break;case"rotateLeft":i?r.leftRotate({}):r.cancelRotate();break;case"rotateRight":i?r.rightRotate({}):r.cancelRotate()}});var s=$$("<div></div>");return s.addClass("toolbar_buttonPic"),s.css("background-image","url("+CGS_SDK_PATH+t.iconUrl+")"),s.appendTo(i),console.log(i),i}null==(u=null==l.pluggOptions?{openFlag:!0}:{openFlag:l.pluggOptions.open,right:l.pluggOptions.right,top:l.pluggOptions.top}).openFlag&&(u.openFlag=!0),this.firstTime=!0,this.setVisible=function(e){e?this.body.show():this.body.hide()},function(){var i=window.$$.fn.draggable&&1!==window.$$.fn.draggable.length?window.$$:window.$,e=i("<div></div>");e.addClass("toolbar_container"),u.right&&e.css("right",u.right),u.top&&e.css("top",u.top);var t=i("<div></div>");t.addClass("toolbar_folder_open"),u.openFlag||t.addClass("toolbar_folder_close"),t.click(function(e){var t;i(this).hasClass("toolbar_folder_close")?(i(this).removeClass("toolbar_folder_close"),t=i(p.body).position().left-216+"px",i(p.body).animate({width:p.width,left:t},200,function(){i(p.body).find(".toolbar_content").eq(0).show()})):(i(this).addClass("toolbar_folder_close"),i(p.body).find(".toolbar_content").eq(0).hide(),t=i(p.body).position().left+216+"px",i(p.body).animate({width:"30px",left:t},200))});var s=i("<div></div>");s.addClass("toolbar_content");var o=l.buttonOptions;if(o){for(var a=0,n=0;n<o.length;n++){2===window.WGMODEFLAG&&o[n].is3DOnly||(a++,new h(0,o[n]).appendTo(s))}p.width=36*a+30+"px",e.css("width",p.width)}t.appendTo(e),s.appendTo(e),r.container.appendChild(e[0]),p.body=e,p.body.draggable({handle:p.body})}()},CgsToolbarPlugg.prototype.activate=function(){this.setVisible(!0)},CgsToolbarPlugg.prototype.deactivate=function(){this.setVisible(!1)},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/toponymyPlugg/CgsToponymyPlugg.css"/>'),CgsToponymyPlugg=function(e){var w=this;this.body=$$("<div id='toponyplugg' class='CgsToponymyPlugg'></div>"),$$(map.container).append(this.body);var t,w=this;function i(){var e;3==w.keyMode&&(!w.tempSelectPoint&&0!=w.tempSelectPoint||(e="drapTrall"+w.tempSelectPoint.id,document.getElementById(e).click()),w.lastSearchInput!=$$("input#myInput2").val()&&document.getElementById("toponySearchBtn").click())}function P(){w.tempSelectPoint&&(T(w.tempSelectPoint,"blue"),w.tempSelectPoint.placeInfo.trAll.css("background-color",w.tempSelectPoint.placeInfo.defaultColor)),w.tempSelectPoint=null}function s(){w.lastSelectPoint||(w.lastSelectPoint=w.markGroup[0]),w.tempSelectPoint?(w.tempSelectPoint.id!=w.lastSelectPoint.id&&(w.tempSelectPoint.placeInfo.trAll.css("background-color",w.tempSelectPoint.placeInfo.defaultColor),T(w.tempSelectPoint,"blue")),w.tempSelectPoint.id==w.markGroup.length-1?w.tempSelectPoint=w.markGroup[0]:w.tempSelectPoint=w.markGroup[w.tempSelectPoint.id+1]):w.tempSelectPoint=w.markGroup[w.lastSelectPoint.id+1],w.tempSelectPoint.id!=w.lastSelectPoint.id&&(w.tempSelectPoint.placeInfo.trAll.css("background-color","#2f5ea4"),T(w.tempSelectPoint,"red")),$$(".CgsToponymyPlugg_tableDiv").animate({scrollTop:32*w.tempSelectPoint.id},1)}function o(){w.lastSelectPoint||(w.lastSelectPoint=w.markGroup[0]),w.tempSelectPoint?(w.tempSelectPoint.id!=w.lastSelectPoint.id&&(w.tempSelectPoint.placeInfo.trAll.css("background-color",w.tempSelectPoint.placeInfo.defaultColor),T(w.tempSelectPoint,"blue")),0==w.tempSelectPoint.id?w.tempSelectPoint=w.markGroup[w.markGroup.length-1]:w.tempSelectPoint=w.markGroup[w.tempSelectPoint.id-1]):0==w.lastSelectPoint.id?w.tempSelectPoint=w.markGroup[w.markGroup.length-1]:w.tempSelectPoint=w.markGroup[w.lastSelectPoint.id-1],w.tempSelectPoint.id!=w.lastSelectPoint.id&&(w.tempSelectPoint.placeInfo.trAll.css("background-color","#2f5ea4"),T(w.tempSelectPoint,"red")),$$(".CgsToponymyPlugg_tableDiv").animate({scrollTop:32*w.tempSelectPoint.id},1)}function T(e,t){var i;i="red"==t?"url('"+CGS_SDK_PATH+"plugg/toponymyPlugg/image/bubbleRed.png":"url('"+CGS_SDK_PATH+"plugg/toponymyPlugg/image/bubbleBlue.png","3D"==w.map.mode?$$(e.overlay3D.dom).find("div").css("background-image",i):$$(e.overlay2D.element).find("div").css("background-image",i)}this.map=e,this.lastInput=null,this.url=map.allPropertiesConfigs.dmssUrl,this.dropNum=6,this.markGroup=[],this.listGroup=[],this.logGroup=[],this.lastMarkGroup=[],this.delayNum=0,this.lastSelectPoint=null,this.lastSelectTr=null,this.tempSelectPoint=null,this.tempSelectList=null,this.tempSelectLog=null,this.buttonFlag=!1,this.keyMode=null,this.hideButtomFlag=!1,w.mistinessSearchFlag=!0,this.searchMode=null,this.lastSearchInput=null,function(){$$("<div></div>").addClass("toponyContainer");var e=w.body,t=$$("<div></div>");t.addClass("CgsToponymyPlugg_container"),t.appendTo(e),$$('<div title="搜索按钮" ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsToponymyPlugg_searchbuttonimg"><a href="#" id="toponySearchBtn"  ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsToponymyPlugg_searchbutton"></a></div>').appendTo(t);var l=$$("<div></div>");l.addClass("CgsToponymyPlugg_body"),l.appendTo(t);var s=$$('<input type="text" placeholder="请输入地名" id="myInput2"></input>');s.appendTo(l),$$('<i id="deleteallinfo"></i>').appendTo(l);var i=$$('<div title="拖拽按钮" id="dmssmovebtn" ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsToponymyPlugg_movebuttonimg"><a href="#" ondragenter="event.preventDefault()" ondragover="event.preventDefault()" draggable="false" class="CgsToponymyPlugg_movebutton"></a></div>');i.appendTo(t),i.css("display","none"),a("myInput2","input propertychange",function(){w.delayNum++,setTimeout(function(){w.delayNum--,0==w.delayNum&&function(){$$("p").remove(".drap-line"),document.getElementById("myInputDiv3").style.display="none",$$("div").remove(".drap-deletelog"),w.searchMode=1;{if(""==$$("input#myInput2").val())return w.keyMode=1,o();this.lastInput=$$("input#myInput2").val()}!function(e){var t=JSON.parse(sessionStorage.getItem("cgsdmsslog"));null==t&&(t=[]);-1!=t.indexOf(e)&&t.splice(t.indexOf(e),1);t.push(e),5<t.length&&t.splice(0,1);window.sessionStorage.removeItem("cgsdmsslog"),window.sessionStorage.cgsdmsslog=JSON.stringify(t)}($$("input#myInput2").val());var e=$$("input#myInput2").val(),t=(CGS_SDK_PATH,$$("input#myInput2").val());function i(e,t){if(w.lastSearchInput!=t&&w.mistinessSearchFlag){w.keyMode=1;for(var i,o,a,e=e,s=0;s<e.length;s++)e[s].centerLat=parseFloat(e[s].lat),e[s].centerLng=parseFloat(e[s].lng);!function(){if(0!=w.markGroup.length)for(var e=0;e<w.markGroup.length;e++){w.markGroup[e].overlay&&w.markGroup[e].overlay.setVisible(!1);for(var t=0;t<w.markGroup[e].closeFeature.length;t++)w.markGroup[e].closeFeature[t].setVisible(!1);w.markGroup[e].setVisible(!1)}}(),w.lastSelectPoint&&b(w.lastSelectPoint),t==$$("input#myInput2").val()&&(0!=e.length?(document.getElementById("myInputDiv3").style.display="",i=e,this.dataObj=i,$$("p").remove(".drap-line"),o=0,a=[],_.each(i,function(e,t){var i,s;-1==e.layer.indexOf("街区")&&(o<w.dropNum&&((i=$$('<p class="drap-line"><a herf="#">'+e.name+"</a></p>")).appendTo(n),i.id=o,s={tr:i,obj:e},a.push(s)),o++)}),w.tempSelectLog=null,w.logGroup=a,setTimeout(function(){for(var e=a.length<w.dropNum?a.length:w.dropNum,t=0;t<e;t++)a[t].tr.attr("id","drapline"+t),a[t].tr.click(function(){document.getElementById("dmssmovebtn").style.display="none";for(var e=parseInt($$(this).attr("id").slice(8)),t=0;t<w.listGroup.length;t++){w.map.removeOverlay(w.listGroup[t].overlay);for(var i=0;i<w.listGroup[t].closeFeature.length;i++)w.map.removeFeature(w.listGroup[t].closeFeature[i]);w.map.removeOverlay(w.listGroup[t])}w.listGroup=[],document.getElementById("myInputDiv3").style.display="none",$$("#myInput2").val(a[e].obj.name),r(),D()})},400)):document.getElementById("myInputDiv3").style.display="none")}}$$.ajax({type:"GET",url:w.url+e,success:function(e){0!=e.data.length?i(e.data,t):w.mistinessSearchFlag=!0},dataType:"json"})}()},1e3)}),a("myInput2","focus",function(){w.keyMode=1,""===$$("input#myInput2").val()&&o();document.getElementById("dmssmovebtn").style.display=""}),a("myInput2","blur",function(){w.keyMode=3}),a("deleteallinfo","click",function(){$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3").style.display="none",$$("table").remove(".CgsToponymyPlugg_table"),w.lastSelectTr=null,$$("div").remove(".CgsToponymyPlugg_table_hidebuttom"),$$("div").remove(".CgsToponymyPlugg_tableDiv"),s.blur(),$$(document.getElementById("myInput2")).val(""),u()}),CgsSubPub.subscribe(CgsEvent.eFeatureClickOut,function(e,t,i){$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3").style.display="none",s.blur(),document.getElementById("dmssmovebtn").style.display="none"}),s.bind("keyup",function(e){"13"==e.keyCode&&1==w.keyMode&&function(){if(w.tempSelectLog||0==w.tempSelectLog){var e="drapline"+w.tempSelectLog;if(document.getElementById(e))return document.getElementById(e).click()}w.tempSelectLog||(w.buttonFlag=!0,document.getElementById("toponySearchBtn").click())}(),"40"==e.keyCode&&1==w.keyMode&&function(){{var e;e=(null==w.tempSelectLog?w.tempSelectLog=0:(e="drapline"+w.tempSelectLog,$$(document.getElementById(e)).css("background","rgba(14,30,45,0.8)"),w.tempSelectLog==w.logGroup.length-1?w.tempSelectLog=0:w.tempSelectLog=w.tempSelectLog+1),"drapline"+w.tempSelectLog),$$(document.getElementById(e)).css("background","#35ACC1")}}(),"38"==e.keyCode&&1==w.keyMode&&function(){{var e;e=(null==w.tempSelectLog?w.tempSelectLog=w.logGroup.length-1:(e="drapline"+w.tempSelectLog,$$(document.getElementById(e)).css("background","rgba(14,30,45,0.8)"),0==w.tempSelectLog?w.tempSelectLog=w.logGroup.length-1:w.tempSelectLog=w.tempSelectLog-1),"drapline"+w.tempSelectLog),$$(document.getElementById(e)).css("background","#35ACC1")}}()}),$$(".CgsToponymyPlugg_searchbuttonimg").click(function(){w.buttonFlag&&r()}),$$(".CgsToponymyPlugg_searchbuttonimg").mouseover(function(){w.buttonFlag=!0}),$$(".CgsToponymyPlugg_searchbuttonimg").mouseout(function(){w.buttonFlag=!1});var n=$$('<div style="display:none" id="myInputDiv3"></div>');function r(){if(!w.mistinessSearchFlag)return $$("p").remove(".drap-line"),void $$("div").remove(".drap-deletelog");var e,t;""!=$$("input#myInput2").val()&&(w.mistinessSearchFlag=!1,w.searchMode=2,u(),e=$$("input#myInput2").val(),CGS_SDK_PATH,t=$$("input#myInput2").val(),$$.ajax({type:"GET",url:w.url+e,success:function(e){0!=e.data.length?function(e,t){if(0==e.length)return;w.keyMode=3,w.keyMode=3;for(var e=e,i=0;i<e.length;i++)e[i].centerLat=parseFloat(e[i].lat),e[i].centerLng=parseFloat(e[i].lng);if(w.lastSelectPoint){$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3").style.display="none";for(var s=0;s<w.markGroup.length;s++)if(w.markGroup[s]!==w.lastSelectPoint){w.markGroup[s].overlay&&w.map.removeOverlay(w.markGroup[s].overlay);for(var o=0;o<w.markGroup[s].closeFeature.length;o++)this.map.removeFeature(w.markGroup[s].closeFeature[o]);this.map.removeOverlay(w.markGroup[s])}w.markGroup=[]}if(t!=$$("input#myInput2").val())return;document.getElementById("myInputDiv3").style.display="none";var a=e;this.dataObj=a,$$("p").remove(".drap-line");var p=1,h=[],n=$$('<div class="CgsToponymyPlugg_tableDiv"></div>');if(n.appendTo(l),0==e.length){var r=$$('<div class="noresponse">未搜索到结果！</div>');return $$(document.getElementsByClassName("CgsToponymyPlugg_body")).css("border-bottom","1px solid #3869ab"),r.appendTo(n),w.mistinessSearchFlag=!0,w.tempSelectLog=null}var c=$$('<table id="CgsToponymyPlugg_table" class="CgsToponymyPlugg_table" cellspacing="1" cellpadding="0"></table>');c.appendTo(n);var g=!0;$$("<tr></tr>");_.each(a,function(e,t){var i=$$("<tr></tr>"),s=$$('<td class="CgsToponymyPlugg_table_td_num">'+p+"</td>"),o=$$('<td class="CgsToponymyPlugg_table_td_name">'+e.name+"</td>"),a=$$('<td class="CgsToponymyPlugg_table_td_layer">'+e.code+"</td>"),n=$$('<td class="CgsToponymyPlugg_table_td_lonlat"></td>');s.appendTo(i),o.appendTo(i),a.appendTo(i),n.appendTo(i);var r=$$('<a herf="#">['+parseFloat(e.centerLng).toFixed(2)+","+parseFloat(e.centerLat).toFixed(2)+"]</a>");r.appendTo(n),i.appendTo(c);var l=null;g=g?(i.css("background","#0d1d2d"),!(l="#0d1d2d")):(i.css("background","#1a3047"),l="#1a3047",!0);var u={tr:r,trAll:i,obj:e,defaultColor:l};h.push(u),p++});var d=$$('<div class="CgsToponymyPlugg_table_hidebuttom"></div>');(w.myTableHide=d).appendTo(l),$$('<div class="CgsToponymyPlugg_table_hidebuttom_bg"></div>').appendTo(d),setTimeout(function(){for(var e=[],t=0;t<h.length;t++){5==h[t].obj.geometryTypeId?(h[t].obj.geometrysInfo.geometrys[0].points,h[t].obj.pos=[h[t].obj.geometrysInfo.geometrys[0].points[Math.round(h[t].obj.geometrysInfo.geometrys[0].points.length/2)][0],h[t].obj.geometrysInfo.geometrys[0].points[Math.round(h[t].obj.geometrysInfo.geometrys[0].points.length/2)][1],2.5*parseInt(y(h[t].obj.geometrysInfo.geometrys))]):h[t].obj.pos=[h[t].obj.centerLng,h[t].obj.centerLat,250],e.push(function(e,t,s,o){var i=[e.obj.pos[0],e.obj.pos[1]];w.map;{var a;a="3D"==w.map.mode?[-10,-20]:[-15,-20]}var n=new CgsOverlay({position:i,positioning:"center-center",element:$$("\n                                <div class = 'oponyPopMark'>\n                                <div style=\"cursor: default\">\n                                </div>\n                                </div>\n                                ").get(0),draggable:!1,showLine:!1,offset:a});{var r;this.map.addOverlay(n),r="3D"==w.map.mode?n.overlay3D.dom:n.overlay2D.element}$$($$(r).find("div")[0]).html(s+1),$$($$(r).context).attr("id","markflag"+s),o&&"mark"!=o?"list"==o&&($$(r).mouseover(function(){n.placeInfo.tr.css("background","#35ACC1")}),$$(r).mouseout(function(){n.placeInfo.tr.css("background","rgba(39, 52, 61,0)")})):($$(r).mouseover(function(){var e=$$(".CgsToponymyPlugg_tableDiv");$$("#drapTrall32"),parseInt($$($$(r).context).attr("id"));e.animate({scrollTop:32*(s-1)},1),setTimeout(function(){n.placeInfo.trAll&&n.placeInfo!=w.lastSelectTr&&n.placeInfo.trAll.css("background","#2f5ea4")},5)}),$$(r).mouseout(function(){setTimeout(function(){n.placeInfo.trAll&&n.placeInfo!=w.lastSelectTr&&n.placeInfo.trAll.css("background",n.placeInfo.defaultColor)},7)}));$$(r).click(function(){var e;if(document.getElementById("dmssmovebtn").style.display="none",o&&"mark"!=o?"list"==o&&(e=w.listGroup[s]):e=w.markGroup[s],P(),m(e.placeInfo),!e.overlay.getVisible()){b(w.lastSelectPoint),e.placeInfo.obj.pos,e.overlay.setVisible(!0);e.placeInfo.obj.pos;for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!0);for(var i=0;i<w.listGroup.length;i++)C(w.listGroup[i]);f(e),b(w.lastSelectPoint),w.lastSelectPoint=e}}),n.toponymyFlag=!0,n.placeInfo=e,n.closeFeature=[],o&&"mark"!=o?"list"==o&&w.listGroup.push(n):w.markGroup.push(n);!s&&0!=s||(n.id=s);e.obj;{}if(t&&"nomark"==t){n.setVisible(!0);for(var l=0;l<n.closeFeature.length;l++)n.closeFeature[l].setVisible(!0);n.nomark=!0}return n}(h[t],null,t))}for(var i=[],s=[],o=[],t=0;t<e.length;t++){var a=function(e){var t=e.placeInfo,i=[t.obj.pos[0],t.obj.pos[1]],s=new CgsOverlay({position:[i[0],i[1],0],positioning:"top-center",element:$$("\n\t\t\t\t\t<div class = 'oponyPop' style='width:auto'>\n\t\t\t\t\t\t\t<div class='oponyPop__lineContainer'>\n\t\t\t\t\t\t\t    <div class='oponyPop__lineSpanGroup'>\n                                <div class='oponyPop__list_head'><span class=\"oponyPop__country\">地标名</span><span></span></div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">详情地</span><span></span></div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">电</span><span></span></div>\n                                <div class='oponyPop__list'><span class=\"oponyPop__country\">位置座</span><span></span> </div>\n\t\t\t\t\t\t\t    </div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>    \n\t\t\t\t\t").get(0),offset:[152,-200],draggable:!0,showLine:!0,isRoundCorner:!0,roundCornerSize:7});w.map.addOverlay(s),(w.infoBox=s).setVisible(!1),s.type="infobox";var o=null;s.overlay3D?o=s.overlay3D.dom:(o=s.overlay2D.element,$$(o).css("z-index","599"));16<t.obj.name.length&&$$(o).css("width","280px");$$($$(o).find("span")[1]).html("称: "+t.obj.name),"未知"==t.obj.country?($$($$(o).find("span")[3]).css("display","none"),$$($$(o).find("span")[2]).css("display","none")):$$($$(o).find("span")[3]).html("址:"+t.obj.address);"未知"==t.obj.province?($$($$(o).find("span")[5]).css("display","none"),$$($$(o).find("span")[4]).css("display","none")):$$($$(o).find("span")[5]).html("话: "+t.obj.phone);$$($$(o).find("span")[7]).html("标: ["+t.obj.centerLng.toFixed(2)+","+t.obj.centerLat.toFixed(2)+"]"),e.overlay=s,e.nomark&&s.setVisible(!0);return e}(e[t]);i.push({points:[[h[t].obj.pos[0],h[t].obj.pos[1]]]}),s.push(h[t].obj.pos[0]),o.push(h[t].obj.pos[1]),0==t&&(v(a),m(a.placeInfo))}var n=Math.max.apply(null,s),r=Math.min.apply(null,s),l=Math.max.apply(null,o),u=Math.min.apply(null,o);65e5<y(i,"real")?w.map.flyTo({destination:[h[0].obj.centerLng,h[0].obj.centerLat,2.3*y(i)],duration:1,noFlyHigher:!0}):w.map.flyTo({destination:[(n+r)/2,(l+u)/2,2*y(i)],duration:1,noFlyHigher:!0});for(t=0;t<h.length;t++)h[t].trAll&&(h[t].trAll.attr("id","drapTrall"+t),h[t].trAll.click(function(){document.getElementById("dmssmovebtn").style.display="none",P(),D(),S();var e=parseInt($$(this).attr("id").slice(9));w.lastSelectPoint&&b(w.lastSelectPoint),m(h[e]),document.getElementById("myInputDiv3").style.display="none",h[e].obj.pos=[h[e].obj.centerLng,h[e].obj.centerLat,25],map.flyTo({destination:h[e].obj.pos,duration:1,noFlyHigher:!0}),v(w.markGroup[e]),f(w.lastSelectPoint)}),h[t].trAll.mouseover(function(){var e=parseInt($$(this).attr("id").slice(9));w.markGroup[e]&&T(w.markGroup[e],"red")}),h[t].trAll.mouseout(function(){var e=parseInt($$(this).attr("id").slice(9));w.lastSelectPoint&&w.markGroup[e]&&(w.lastSelectPoint.placeInfo.obj.centerLat!=w.markGroup[e].placeInfo.obj.centerLat||w.lastSelectPoint.placeInfo.obj.centerLng!=w.markGroup[e].placeInfo.obj.centerLng)&&T(w.markGroup[e],"blue")}));w.lastSelectPoint&&f(w.lastSelectPoint),d.click(function(){var e;$$(".CgsToponymyPlugg_table").slideToggle(50,null),w.hideButtomFlag=!w.hideButtomFlag,e=w.hideButtomFlag?"url('"+CGS_SDK_PATH+"plugg/toponymyPlugg/image/show.png":"url('"+CGS_SDK_PATH+"plugg/toponymyPlugg/image/hide.png",$$(document.getElementsByClassName("CgsToponymyPlugg_table_hidebuttom_bg")).css("background-image",e)}),w.updateOverlay3dom()},300),setTimeout(function(){w.mistinessSearchFlag=!0},300)}(e.data,t):w.mistinessSearchFlag=!0},dataType:"json",error:function(){w.mistinessSearchFlag=!0}}),w.keyMode=3,w.lastSearchInput=$$("input#myInput2").val(),w.lastInput=$$("input#myInput2").val())}function m(e){w.lastSelectTr&&w.lastSelectTr.trAll.css("background-color",w.lastSelectTr.defaultColor),e.trAll.css("background-color","#2f5ea4"),w.lastSelectTr=e}function f(e){if(!e.placeInfo.trAll)for(var t=0;t<w.markGroup.length;t++){w.lastSelectPoint.placeInfo.obj.centerLat==w.markGroup[t].placeInfo.obj.centerLat&&w.lastSelectPoint.placeInfo.obj.centerLng==w.markGroup[t].placeInfo.obj.centerLng&&(i=w.markGroup[t])}var i;T(i=i||e,"red")}function C(e){if(!e.placeInfo.trAll)for(var t=0;t<w.markGroup.length;t++){w.lastSelectPoint.placeInfo.obj.centerLat==w.markGroup[t].placeInfo.obj.centerLat&&w.lastSelectPoint.placeInfo.obj.centerLng==w.markGroup[t].placeInfo.obj.centerLng&&(i=w.markGroup[t])}var i;T(i=i||e,"blue")}function y(e,t){for(var i=[],s=[],o=0;o<e.length;o++)for(var a=0;a<e[o].points.length;a++)i.push(e[o].points[a][0]),s.push(e[o].points[a][1]);var n,r,l,u=Math.max.apply(null,i),p=Math.min.apply(null,i),h=Math.max.apply(null,s),c=Math.min.apply(null,s);return 1==window.WGMODEFLAG||3==window.WGMODEFLAG?(n=Cesium.Cartesian3.fromDegrees(p,c),r=Cesium.Cartesian3.fromDegrees(u,h),l=Cesium.Cartesian3.distance(n,r)):2==window.WGMODEFLAG&&(l=25e5),t||(l<1e3?l=2e5:25e5<l&&(l=25e5)),l}function o(){w.tempSelectLog=null,u();var e=JSON.parse(sessionStorage.getItem("cgsdmsslog"));if(null!=e){var t=[];w.logGroup=null;for(var i,s=e.length-1;0<=s;s--){var o=$$('<p class="drap-line"><a herf="#">  '+e[s]+"</a></p>");o.appendTo(n);var a={tr:o,session:e[s]};t.push(a)}w.logGroup=t,document.getElementById("myInputDiv3").style.display="",setTimeout(function(){for(var e=0;e<t.length;e++)t[e].tr.attr("id","drapline"+e),t[e].tr.click(function(){u();var e=parseInt($$(this).attr("id").slice(8));t[e]&&($$("#myInput2").val(t[e].session),r())})},20),w.trButton||((i=$$('<div class="drap-deletelog"></div>')).appendTo(n),w.trButton=$$('<p style="text-align: center"><a herf="#">清除搜索记录..</a></p>'),w.trButton.appendTo(i),setTimeout(function(){w.trButton&&w.trButton.click(function(){u(),window.sessionStorage.removeItem("cgsdmsslog")})},100))}}function a(t,i,s){var o=setInterval(function(){var e;document.getElementById(t)&&(window.clearInterval(o),e=document.getElementById(t),$("#"+t).bind(i,function(){s(e)}))},1)}function v(e){if(e){e.setVisible(!0);for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!0);e.overlay.setVisible(!0),w.lastSelectPoint=e}}function u(e){$$(document.getElementsByClassName("CgsToponymyPlugg_body")).css("border-bottom","0px"),document.getElementById("dmssmovebtn").style.display="none",w.tempSelectPoint=null,$$("table").remove(".CgsToponymyPlugg_table"),$$("div").remove(".CgsToponymyPlugg_table_hidebuttom"),$$("div").remove(".CgsToponymyPlugg_tableDiv"),w.myTableHide=null,w.lastSelectTr=null,$$("p").remove(".drap-line"),$$("div").remove(".drap-deletelog"),document.getElementById("myInputDiv3")&&(document.getElementById("myInputDiv3").style.display="none"),w.markGroup=[];for(var t=0;t<w.map.overlays.length;t++)w.map.overlays[t].placeInfo&&w.markGroup.push(w.map.overlays[t]);if(0!=w.markGroup.length)for(t=0;t<w.markGroup.length;t++){w.markGroup[t].overlay&&w.markGroup[t]!=e&&w.map.removeOverlay(w.markGroup[t].overlay);for(var i=0;i<w.markGroup[t].closeFeature.length;i++)w.markGroup[t]!=e&&w.map.removeFeature(w.markGroup[t].closeFeature[i]);w.map.removeOverlay(w.markGroup[t])}e?(w.markGroup=[e],w.lastSelectPoint=e):(w.markGroup=[],w.lastSelectPoint=null),w.trButton=null}function b(e){if(e&&e.overlay.getVisible()){e.overlay&&e.overlay.setVisible(!1);for(var t=0;t<e.closeFeature.length;t++)e.closeFeature[t].setVisible(!1);C(e)}}function D(){if(0!=w.listGroup.length){for(var e=0;e<w.listGroup.length;e++){w.listGroup[e].overlay&&w.map.removeOverlay(w.listGroup[e].overlay);for(var t=0;t<w.listGroup[e].closeFeature.length;t++)w.map.removeFeature(w.listGroup[e].closeFeature[t]);w.map.removeOverlay(w.listGroup[e])}w.listGroup=[]}}function S(){if(0!=w.markGroup.length)for(var e=0;e<w.markGroup.length;e++)w.markGroup[e].setVisible(!0)}n.addClass("CgsToponymyPlugg_droplist"),n.appendTo(t),CgsSubPub.subscribe(CgsEvent.eModeChanged,function(e,t,i){if("3D"==t){for(var s,o=0;o<w.markGroup.length;o++){"3D"==i.mode||(s=w.markGroup[o].overlay2D.element),$$(s).attr("id","drapTrall"+o),$$(s).click(function(){document.getElementById("dmssmovebtn").style.display="none",D(),S();var e=parseInt($$(this).attr("id").slice(9));w.lastSelectPoint&&(T(w.lastSelectPoint,"blue"),$$(document.getElementById(w.lastSelectPoint.overlay3D.dom.id)).css("background-image",url),b(w.lastSelectPoint)),m(w.markGroup[e].placeInfo),document.getElementById("myInputDiv3").style.display="none",w.markGroup[e].placeInfo.obj.pos=[w.markGroup[e].placeInfo.obj.centerLng,w.markGroup[e].placeInfo.obj.centerLat,2.5*parseInt(y(w.markGroup[e].placeInfo.obj.geometrysInfo.geometrys))],i.flyTo({destination:w.markGroup[e].placeInfo.obj.pos,duration:1,noFlyHigher:!0}),f(w.markGroup[e]),v(w.markGroup[e])}),$$(s).mouseover(function(){var e=parseInt($$(this).attr("id").slice(9));w.markGroup[e]&&("3D"==w.map.mode&&($$(".CgsToponymyPlugg_tableDiv").animate({scrollTop:32*(e-1)},1),setTimeout(function(){w.markGroup[e].placeInfo.trAll&&w.markGroup[e].placeInfo!=w.lastSelectTr&&w.markGroup[e].placeInfo.trAll.css("background","#2f5ea4")},5)),T(w.markGroup[e],"red"))}),$$(s).mouseout(function(){var e=parseInt($$(this).attr("id").slice(9));w.lastSelectPoint&&w.markGroup[e]&&(w.lastSelectPoint.placeInfo.obj.centerLat!=w.markGroup[e].placeInfo.obj.centerLat||w.lastSelectPoint.placeInfo.obj.centerLng!=w.markGroup[e].placeInfo.obj.centerLng)&&("3D"==w.map.mode&&setTimeout(function(){w.markGroup[e].placeInfo.trAll&&w.markGroup[e].placeInfo!=w.lastSelectTr&&w.markGroup[e].placeInfo.trAll.css("background",w.markGroup[e].placeInfo.defaultColor)},7),T(w.markGroup[e],"blue"))})}for(o=0;o<i.overlays.length;o++)i.overlays[o].placeInfo&&i.overlays[o].setPixelOffset([0,12])}else for(o=0;o<i.overlays.length;o++)i.overlays[o].placeInfo&&i.overlays[o].setPixelOffset([-15,-30]),i.overlays[o].type&&"infobox"==i.overlays[o].type&&$$(i.overlays[o].overlay2D.element).css("z-index","800")}),CgsSubPub.subscribe(CgsEvent.eFeatureDoubleClick,function(e,t,i,s){!t.toponymyFlag||t instanceof CgsMark||(t.overlay.setVisible(!1),t.setVisible(!1))})}(),document.onkeydown?(t=document.onkeydown,document.onkeydown=function(e){t(e),"13"==e.keyCode&&3==w.keyMode&&i(),"40"==e.keyCode&&0<w.markGroup.length&&3==w.keyMode&&s(),"38"==e.keyCode&&0<w.markGroup.length&&3==w.keyMode&&o()}):document.onkeydown=function(e){"13"==e.keyCode&&3==w.keyMode&&i(),"40"==e.keyCode&&0<w.markGroup.length&&3==w.keyMode&&s(),"38"==e.keyCode&&0<w.markGroup.length&&3==w.keyMode&&o()},setTimeout(function(){var t=2e12;$$(".CgsToponymyPlugg_movebutton").mousedown(function(e){t=(new Date).valueOf(),document.getElementById("myInput2").blur()}),$$(".CgsToponymyPlugg_movebutton").mouseup(function(){t=2e12}),document.addEventListener("mousemove",function(e){10<(new Date).valueOf()-t&&1==e.which&&($$(document.getElementById("toponyplugg")).css("left",e.clientX-290+"px"),$$(document.getElementById("toponyplugg")).css("top",e.clientY-120+"px")),0==e.which&&(t=2e12)})},100);var a=CGS_SDK_PATH+"assets/image/ablum.png";this.title=$$("<div class='CgsLayerTool__title CgsTool__title' style='width: 352px'><img class='CgsLayerTool__titleImg' ><span class='CgsLayerTool__titleText' style='font-size: 10px;'>地名搜索</span><div class='CgsLayerTool__closeButton'></div></div>"),this.title.find(".CgsLayerTool__titleImg").attr("src",a),this.title.find(".CgsLayerTool__title CgsTool__title").attr("width","650px"),CgsTool.call(this,e,this.title,this.body)},CgsInherits(CgsToponymyPlugg,CgsTool),CgsToponymyPlugg.prototype.activate=function(){CgsUtil.defined(this.body)&&this.body.show()},CgsToponymyPlugg.prototype.deactivate=function(){CgsUtil.defined(this.body)&&this.body.hide();var e=this;if($$("p").remove(".drap-line"),$$("table").remove(".CgsToponymyPlugg_table"),e.lastSelectTr=null,$$("div").remove(".CgsToponymyPlugg_table_hidebuttom"),$$("div").remove(".CgsToponymyPlugg_tableDiv"),document.getElementById("myInputDiv3").style.display="none",0!=e.markGroup.length){for(var t=0;t<e.markGroup.length;t++){e.markGroup[t].overlay&&e.map.removeOverlay(e.markGroup[t].overlay);for(var i=0;i<e.markGroup[t].closeFeature.length;i++)this.map.removeFeature(e.markGroup[t].closeFeature[i]);this.map.removeOverlay(e.markGroup[t])}e.markGroup=[]}$$("#myInput2").val("")},CgsToponymyPlugg.prototype.updateOverlay3dom=function(){for(var e,t=0;t<this.markGroup.length;t++){this.markGroup[t].overlay3D&&0<this.markGroup[t].overlay3D.clones.length&&(CgsOverlay.clone(this.markGroup[t]),this.map.map3D.removeFeature(this.markGroup[t].overlay3D.clones[0]),this.markGroup[t].overlay3D.clones.shift(),this.map.map3D.addFeature(this.markGroup[t].overlay3D.clones[0])),this.markGroup[t].overlay.overlay3D&&0<this.markGroup[t].overlay.overlay3D.clones.length&&(e=this.markGroup[t].overlay.getVisible(),CgsOverlay.clone(this.markGroup[t].overlay),this.map.map3D.removeFeature(this.markGroup[t].overlay.overlay3D.clones[0]),this.markGroup[t].overlay.overlay3D.clones.shift(),this.map.map3D.addFeature(this.markGroup[t].overlay.overlay3D.clones[0]),this.markGroup[t].overlay.overlay3D.setVisible(e))}},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/mapNote/CgsMapNoteEdit.css"/>'),CgsMapNoteEdit=function(e){var p=this;p.usualExample=[],p.fontFamily=["微软雅黑","宋体"],p.lastSelectedNoteStyle={},p.visible=!1,p.map=e,p.map.mapNoteEditTool=this;p.usualExample.push({name:"常用模板(默认)",noteLineColor:"rgba(6,17,39,0.6)",noteOutLineColor:"rgba(6,17,39,0.6)",noteTextColor:"rgba(6,16,56,0.5)",font:"100 12px MicrosoftYaHei",fontColor:"rgba(152,186,229,1)"}),p.usualExample.push({name:"常用模板(米黄)",noteLineColor:"rgb(250,243,182)",noteOutLineColor:"rgb(250,243,182)",noteTextColor:"rgb(250,243,182)",font:"100 11px 微软雅黑",fontColor:"black"}),p.usualExample.push({name:"常用模板(白色)",noteLineColor:"rgba(255,255,255,0.6)",noteOutLineColor:"rgba(255,255,255,0.6)",noteTextColor:"rgba(255,255,255,1)",font:"300 30px 宋体",fontColor:"black"}),p.usualExample.push({name:"常用模板(淡蓝)",noteLineColor:"rgba(16,64,231,0.6)",noteOutLineColor:"rgba(16,64,231,0.6)",noteTextColor:"rgba(255,255,255,1)",font:"100 20px 微软雅黑",fontColor:"rgba(0,0,0,1)"}),p.usualExample.push({name:"常用模板(白底红字)",noteLineColor:"rgba(255,255,255,1)",noteOutLineColor:"rgba(255,255,255,1)",noteTextColor:"rgba(255,255,255,1)",font:"300 15px 宋体",fontColor:"rgba(255,0,0,1)"}),p.usualExample.push({name:"常用模板(白底蓝字)",noteLineColor:"rgba(255,255,255,1)",noteOutLineColor:"rgba(255,255,255,1)",noteTextColor:"rgba(255,255,255,1)",font:"300 15px 宋体",fontColor:"rgba(0,0,255,1)"}),this.state={currentModelUrl:"",currentModelName:"",currentModelNumber:200,firstTimeFlag:!0,preSelectedGroupId:-1,drawOnMapDefaultGroup:"model_root",dbClickId:null,clickId:null,clickOutId:null,featurePropertyChangeId:null,featureClickFlag:!1,canvasBindEventState:null},p.currentMapNote=e.currentMapNote,this.showView=function(){},function(){var e=$$("<div></div>");e.addClass("modelContainer"),$$("<div></div>").addClass("model_title"),$$("<div></div>").addClass("model_content"),p.body=e;var t=$$('<table id="mapNote_table" class="mapNote_table" cellspacing="1" cellpadding="0"></table>');t.appendTo(e);var i=$$('<tr class="mapNote_table_tr" style="background-color:#1b2b40"></tr>'),s=$$('<td class="mapNote_table_td1"><div class="mapNote_table_titleFont">字体大小</div></td>'),o=$$('<td class="mapNote_table_td2"></td>');s.appendTo(i),o.appendTo(i),i.appendTo(t),p.fontSizeInput=$$('<input id="mapNote_table_fontSize" type="text" class="mapNote_table_fontSize" placeholder="例：15" id="myInput2"></input>'),p.fontSizeInput.appendTo(o),$$(p.fontSizeInput).on("input propertychange",function(){var e;p.map.currentMapNote&&(e=$$(document.getElementById("mapNote_table_fontSize")).val(),$$(document.getElementById(p.map.currentMapNote.textareaId)).css("font-size",e+"px"))}),i=$$('<tr class="mapNote_table_tr" style="background-color:#0d1a2b"></tr>'),s=$$('<td class="mapNote_table_td1"><div class="mapNote_table_titleFont">字体颜色</div></td>'),o=$$('<td class="mapNote_table_td2"></td>'),s.appendTo(i),o.appendTo(i),i.appendTo(t),p.fontColorInput=$$('<input id="mapNote_table_fontColor"></input>'),p.fontColorInput.appendTo(o),$$(p.fontColorInput).on("change",function(){var e,t;p.map.currentMapNote&&(t="rgba("+(e=$$("#mapNote_table_fontColor").spectrum("get"))._r+","+e._g+","+e._b+","+e._a+")",$$(document.getElementById(p.map.currentMapNote.textareaId)).css("color",t))}),i=$$('<tr class="mapNote_table_tr" style="background-color:#1b2b40"></tr>'),s=$$('<td class="mapNote_table_td1"><div class="mapNote_table_titleFont">字体样式</div></td>'),o=$$('<td class="mapNote_table_td2"></td>'),s.appendTo(i),o.appendTo(i),i.appendTo(t),p.fontStyleSelect=$$('<select class="mapNote_table_select" id="mapNote_table_fontStyle" style="height:20px;"><option>微软雅黑</option><option>宋体</option></select>'),p.fontStyleSelect.appendTo(o),$$(p.fontStyleSelect).on("change",function(){var e;p.map.currentMapNote&&(e=$$(document.getElementById("mapNote_table_fontStyle")).val(),$$(document.getElementById(p.map.currentMapNote.textareaId)).css("font-family",e))}),i=$$('<tr class="mapNote_table_tr" style="background-color:#0d1a2b"></tr>'),s=$$('<td class="mapNote_table_td1"><div class="mapNote_table_titleFont">文本框颜色</div></td>'),o=$$('<td class="mapNote_table_td2"></td>'),s.appendTo(i),o.appendTo(i),i.appendTo(t),p.textBackColor=$$('<input id="mapNote_table_textBackColor"></input>'),p.textBackColor.appendTo(o),$$(p.textBackColor).on("change",function(){var e,t;p.map.currentMapNote&&(t="rgba("+(e=$$("#mapNote_table_textBackColor").spectrum("get"))._r+","+e._g+","+e._b+","+e._a+")",$$(document.getElementById(p.map.currentMapNote.textareaId)).css("background-color",t))}),i=$$('<tr class="mapNote_table_tr" style="background-color:#1b2b40"></tr>'),s=$$('<td class="mapNote_table_td1"><div class="mapNote_table_titleFont">连线颜色</div></td>'),o=$$('<td class="mapNote_table_td2"></td>'),s.appendTo(i),o.appendTo(i),i.appendTo(t),p.lineFillColor=$$('<input id="mapNote_table_lineFillColor"></input>'),p.lineFillColor.appendTo(o),$$(p.lineFillColor).on("change",function(){var e,t,i;p.map.currentMapNote&&(t="rgba("+(e=$$("#mapNote_table_lineFillColor").spectrum("get"))._r+","+e._g+","+e._b+","+e._a+")",p.map.currentMapNote.noteOverlay.noteLineColor=t,i=p.map.currentMapNote.noteOverlay.getPixelOffset(),CgsMapNote.move(i,p.map.currentMapNote.getLineType(i),p.map.currentMapNote.noteOverlay,p.map.currentMapNote.lineOverlay,t))}),i=$$('<tr class="mapNote_table_tr" style="background-color:#0d1a2b" ></tr>'),s=$$('<td class="mapNote_table_td1"><div class="mapNote_table_titleFont">背景颜色</div></td>'),o=$$('<td class="mapNote_table_td2"></td>'),s.appendTo(i),o.appendTo(i),i.appendTo(t),p.backGroundColor=$$('<input id="mapNote_table_backGroundColor"></input>'),p.backGroundColor.appendTo(o),$$(p.backGroundColor).on("change",function(){var e,t;p.map.currentMapNote&&(t="rgba("+(e=$$("#mapNote_table_backGroundColor").spectrum("get"))._r+","+e._g+","+e._b+","+e._a+")",$$(document.getElementById(p.map.currentMapNote.divId)).css("background-color",t))}),i=$$('<tr class="mapNote_table_tr" style="background-color:#1b2b40"></tr>'),s=$$('<td class="mapNote_table_td1"><div class="mapNote_table_titleFont">常用模板</div></td>'),o=$$('<td class="mapNote_table_td2"></td>'),s.appendTo(i),o.appendTo(i),i.appendTo(t),p.exampleSelect=$$('<div class="mapNote_table_drawDiv" id="mapNote_table_draw"></div><select class="mapNote_table_select" id="mapNote_table_example" style="height:20px;"><option>常用模板(默认)</option><option>常用模板(米黄)</option><option>常用模板(白色)</option><option>常用模板(淡蓝)</option><option>常用模板(白底红字)</option><option>常用模板(白底蓝字)</option></select>'),p.exampleSelect.appendTo(o),$$(p.exampleSelect).on("change",function(){if(p.map.currentMapNote)for(var e,t=$$(document.getElementById("mapNote_table_example")).val(),i=0;i<p.usualExample.length;i++){p.usualExample[i].name==t&&(e=p.map.currentMapNote.noteOverlay.getPixelOffset(),CgsMapNote.move(e,p.map.currentMapNote.getLineType(e),p.map.currentMapNote.noteOverlay,p.map.currentMapNote.lineOverlay,p.usualExample[i].noteLineColor),p.map.currentMapNote.noteOverlay.noteLineColor=p.usualExample[i].noteLineColor,$$(document.getElementById(p.map.currentMapNote.divId)).css("background-color",p.usualExample[i].noteOutLineColor),$$(document.getElementById(p.map.currentMapNote.textareaId)).css("background-color",p.usualExample[i].noteTextColor),$$(document.getElementById(p.map.currentMapNote.textareaId)).css("font",p.usualExample[i].font),$$(document.getElementById(p.map.currentMapNote.textareaId)).css("color",p.usualExample[i].fontColor),CgsSubPub.publish("mapNoteSelect",[p.lastSelectedNoteStyle.divId,p.lastSelectedNoteStyle.textareaId,p.lastSelectedNoteStyle.obj]))}}),setTimeout(function(){p.updateColorPicker("mapNote_table_textBackColor"),p.updateColorPicker("mapNote_table_fontColor"),p.updateColorPicker("mapNote_table_lineFillColor"),p.updateColorPicker("mapNote_table_backGroundColor"),$$(document.getElementById("mapNote_table_draw")).on("click",function(){var l=null,u=null,l=CgsSubPub.subscribe(CgsEvent.eFeatureClick,function(e,t,i,s){for(var o=$$(document.getElementById("mapNote_table_example")).val(),a=0;a<p.usualExample.length;a++)if(p.usualExample[a].name==o){var n=new CgsMapNote({map:p.map,noteLineColor:p.usualExample[a].noteLineColor,noteOutLineColor:p.usualExample[a].noteOutLineColor,noteTextColor:p.usualExample[a].noteTextColor,font:p.usualExample[a].font,fontColor:p.usualExample[a].fontColor,position:p.map.pixelToLonLat(i)});p.lastSelectedNoteStyle=n,p.drawNoteFlag=!0,$$(document.getElementById(n.adderId)).css("display","block"),$$(document.getElementById(n.smallerId)).css("display","block"),$$(document.getElementById(n.closerId)).css("display","block"),n.saveButton&&$$(document.getElementById(n.saveButtonId)).css("display","block"),$$(document.getElementById(n.divId)).css("border","2px solid #cccccc");var r=n.noteOverlay.getPixelOffset();return CgsMapNote.move(r,n.getLineType(r),n.noteOverlay,n.lineOverlay,p.usualExample[a].noteLineColor),n.noteOverlay.noteLineColor=p.usualExample[a].noteLineColor,$$(document.getElementById(n.divId)).css("background-color",p.usualExample[a].noteOutLineColor),$$(document.getElementById(n.textareaId)).css("background-color",p.usualExample[a].noteTextColor),$$(document.getElementById(n.textareaId)).css("font",p.usualExample[a].font),$$(document.getElementById(n.textareaId)).css("color",p.usualExample[a].fontColor),CgsSubPub.publish("mapNoteSelect",[n.divId,n.textareaId,n]),p.currentMapNote&&p.currentMapNote!=p&&$$(document.getElementById(p.map.currentMapNote.divId)).css("border","0px"),CgsSubPub.unsubscribe(u),t.mobileObj&&n.addNoteToMobileObj(t.mobileObj),CgsSubPub.unsubscribe(l),void(u&&CgsSubPub.unsubscribe(u))}}),u=CgsSubPub.subscribe(CgsEvent.eFeatureClickOut,function(e,t,i){for(var s=$$(document.getElementById("mapNote_table_example")).val(),o=0;o<p.usualExample.length;o++)if(p.usualExample[o].name==s){var a=new CgsMapNote({map:p.map,noteLineColor:p.usualExample[o].noteLineColor,noteOutLineColor:p.usualExample[o].noteOutLineColor,noteTextColor:p.usualExample[o].noteTextColor,font:p.usualExample[o].font,fontColor:p.usualExample[o].fontColor,position:p.map.pixelToLonLat(i),offset:[-35,-150]});return p.drawNoteFlag=!0,$$(document.getElementById(a.adderId)).css("display","block"),$$(document.getElementById(a.smallerId)).css("display","block"),$$(document.getElementById(a.closerId)).css("display","block"),a.textareaId&&$$(document.getElementById(p.textareaId)).blur(),a.saveButton&&$$(document.getElementById(a.saveButtonId)).css("display","block"),$$(document.getElementById(a.divId)).css("border","2px solid #cccccc"),p.lastSelectedNoteStyle=a,CgsSubPub.publish("mapNoteSelect",[a.divId,a.textareaId,a]),p.currentMapNote&&p.currentMapNote!=p&&$$(document.getElementById(p.currentMapNote.divId)).css("border","0px"),CgsSubPub.unsubscribe(u),void(l&&CgsSubPub.unsubscribe(l))}})})},100),CgsSubPub.subscribe(CgsEvent.eFeatureClickOut,function(e,t,i){p.drawNoteFlag||($$(p.fontStyleSelect).val("微软雅黑"),$$("#mapNote_table_fontColor").spectrum("set","rgba(0,0,0,1)"),$$(p.fontSizeInput).val(""),$$("#mapNote_table_textBackColor").spectrum("set","rgba(0,0,0,1)"),$$("#mapNote_table_backGroundColor").spectrum("set","rgba(0,0,0,1)"),$$("#mapNote_table_lineFillColor").spectrum("set","rgba(0,0,0,1)"),p.map.currentMapNote&&$$(document.getElementById(p.map.currentMapNote.divId)).css("border","0px"),p.map.currentMapNote&&(p.map.currentMapNote.textareaId&&$$(document.getElementById(p.map.currentMapNote.textareaId)).blur(),$$(document.getElementById(p.map.currentMapNote.divId)).css("border","0px"),$$(document.getElementById(p.map.currentMapNote.adderId)).css("display","none"),$$(document.getElementById(p.map.currentMapNote.smallerId)).css("display","none"),$$(document.getElementById(p.map.currentMapNote.closerId)).css("display","none"),p.map.currentMapNote.saveButton&&$$(document.getElementById(p.map.currentMapNote.saveButtonId)).css("display","none"),p.map.currentMapNote=null)),p.drawNoteFlag=!1}),i=$$('<tr class="mapNote_table_tr"></tr>'),s=$$('<td style="border-bottom: 0px;" class="mapNote_table_td1"><div class="mapNote_table_titleFont">保存模板</div></td>'),o=$$('<td style="border-bottom: 0px;" class="mapNote_table_td2"></td>'),s.appendTo(i),o.appendTo(i),i.appendTo(t);var a=$$('<input  placeholder="例：常用模板"  id="mapNote_table_save" type="text" class="mapNote_table_fontSize"></input><div class="mapNote_table_saveDiv"></div>');a.appendTo(o),$$(a).on("click",function(){var e,t;!p.map.currentMapNote||(e=$$(document.getElementById("mapNote_table_save")).val())&&($$(document.getElementById("mapNote_table_save")).val(""),(t={name:e}).noteLineColor=p.map.currentMapNote.noteOverlay.noteLineColor,t.noteOutLineColor=document.getElementById(p.map.currentMapNote.divId).style.backgroundColor,t.noteTextColor=document.getElementById(p.map.currentMapNote.textareaId).style.backgroundColor,t.font=document.getElementById(p.map.currentMapNote.textareaId).style.font,t.fontColor=document.getElementById(p.map.currentMapNote.textareaId).style.color,p.usualExample.push(t),$$("<option>"+e+"</option>").appendTo($$(document.getElementById("mapNote_table_example"))),CgsSubPub.publish("mapNoteSelect",[p.lastSelectedNoteStyle.divId,p.lastSelectedNoteStyle.textareaId,p.map.currentMapNote]))}),CgsSubPub.subscribe("mapNoteSelect",function(e,t,i,s){p.map.currentMapNote&&($$(document.getElementById(p.map.currentMapNote.adderId)).css("display","none"),$$(document.getElementById(p.map.currentMapNote.smallerId)).css("display","none"),$$(document.getElementById(p.map.currentMapNote.closerId)).css("display","none"),p.map.currentMapNote.saveButton&&$$(document.getElementById(p.map.currentMapNote.saveButtonId)).css("display","none"),$$(document.getElementById(p.map.currentMapNote.divId)).css("border","0px")),p.map.currentMapNote=s,p.lastSelectedNoteStyle={divId:t,textareaId:i,obj:s};var o=document.getElementById(i).style.fontFamily;-1==p.fontFamily.indexOf(o)&&(p.fontFamily.push(o),$$("<option>"+o+"</option>").appendTo(p.fontStyleSelect)),$$(p.fontStyleSelect).val(o);var a=document.getElementById(i).style.color;$$(p.fontColorInput).val(CgsUtil.rgbToHex(a));var n=document.getElementById(i).style.fontSize;$$(p.fontSizeInput).val(n.split("px")[0]);var r=document.getElementById(i).style.backgroundColor;$$(p.textBackColor).val(CgsUtil.rgbToHex(r));var l=document.getElementById(t).style.backgroundColor;$$(p.backGroundColor).val(CgsUtil.rgbToHex(l));var u=s.noteOverlay.noteLineColor;$$(p.lineFillColor).val(CgsUtil.rgbToHex(u)),$$(document.getElementById(p.map.currentMapNote.adderId)).css("display","block"),$$(document.getElementById(p.map.currentMapNote.smallerId)).css("display","block"),$$(document.getElementById(p.map.currentMapNote.closerId)).css("display","block"),p.map.currentMapNote.saveButton&&$$(document.getElementById(p.map.currentMapNote.saveButtonId)).css("display","block"),$$(document.getElementById(p.map.currentMapNote.divId)).css("border","solid 1px white")})}();var t=CGS_SDK_PATH+"assets/image/ablum.png";this.title=$$("<div class='CgsLayerTool__title CgsTool__title'><img class='CgsLayerTool__titleImg' ><span class='CgsLayerTool__titleText'>注释</span><div class='CgsLayerTool__closeButton'></div></div>"),this.title.find(".CgsLayerTool__titleImg").attr("src",t),CgsTool.call(this,e,this.title,this.body)},CgsInherits(CgsMapNoteEdit,CgsTool),CgsMapNoteEdit.prototype.activate=function(){this.visible=!0,CgsTool.prototype.activate.call(this),this.bone.element.css("width","254px"),this.bone.element.css("height","327px"),this.showView()},CgsMapNoteEdit.prototype.updateColorPicker=function(e,t){$$("#"+e).spectrum({allowEmpty:!0,color:"#000000",showInput:!0,containerClassName:"full-spectrum",showInitial:!0,showPalette:!0,showSelectionPalette:!0,showAlpha:!0,maxPaletteSize:7,preferredFormat:"hex",localStorageKey:"spectrum.demo",move:function(){},show:function(){},beforeShow:function(){},hide:function(){},palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(153, 153, 153)","rgb(183, 183, 183)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(239, 239, 239)","rgb(243, 243, 243)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(133, 32, 12)","rgb(153, 0, 0)","rgb(180, 95, 6)","rgb(191, 144, 0)","rgb(56, 118, 29)","rgb(19, 79, 92)","rgb(17, 85, 204)","rgb(11, 83, 148)","rgb(53, 28, 117)","rgb(116, 27, 71)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]});var i=$$($$(document.getElementById(e)).parent()[0].children[1]),s=$$($$(document.getElementById(e)).parent()[0].children[1].children[0]),o=$$($$(document.getElementById(e)).parent()[0].children[1].children[0].children[0]),a=$$($$(document.getElementById(e)).parent()[0].children[1].children[1]);o.css("width","89px"),i.css("padding","0px"),s.css("width","77px"),s.css("border","0px"),s.css("padding","0px"),s.css("height","15px"),s.css("background","rgba(255,255,255,0.01)"),a.css("display","none");for(var n=document.getElementsByClassName("sp-choose"),r=0;r<n.length;r++)$$(n[r]).html("确认");for(var l=document.getElementsByClassName("sp-cancel"),u=0;u<l.length;u++)$$(l[u]).html("取消")},CgsMapNoteEdit.prototype.deactivate=function(){this.visible=!1;this.map.currentMapNote&&$$(document.getElementById(this.map.currentMapNote.divId)).css("border","0px"),$$(this.fontStyleSelect).val("微软雅黑"),$$("#mapNote_table_fontColor").spectrum("set","rgba(0,0,0,1)"),$$(this.fontSizeInput).val(""),$$("#mapNote_table_textBackColor").spectrum("set","rgba(0,0,0,1)"),$$("#mapNote_table_backGroundColor").spectrum("set","rgba(0,0,0,1)"),$$("#mapNote_table_lineFillColor").spectrum("set","rgba(0,0,0,1)"),CgsTool.prototype.deactivate.call(this)},CgsMapNoteEdit.prototype.getVisible=function(){return this.visible},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/satellitePlugg/CgsSatellitePlugg.css"/>'),CgsSatellitePlugg=function(e){if(!e||!e.mapObject)return console.error("map is not exit");this.map=e.mapObject,this.starttime=void 0,this.endtime=void 0,this.step=e.step?e.step:1,this.speed=e.speed?e.speed:1,this.callback=e.callback?e.callback:null,this.mintime=void 0,this.maxtime=void 0,this.satelliteSimulation=void 0,this.startTimeOrigin=void 0,this.endTimeOrigin=void 0,this.startTimeOriginGetTime=void 0,this.endTimeOriginGetTime=void 0,this.dataUrl=void 0,this.distime=void 0,this.distimeend=void 0,this.disSliderTime=void 0,this.title=$("<div class='title' style='color: white;display: block;margin: 8px;'>推演控制</div>");CgsSubPub.subscribe("toolActive",function(e,t,i){t==self&&0==i&&($$(".CgsLayerWindow").remove(),self.window=null,self.body.find(".CgsLayerTool__addLayer").parent().removeClass("CgsBottomTool__pressed"))}),this.body=$("\n    <div class='satellite_body'>\n        <fieldset class='satellite_body_fieldset'>\n            <legend>回放设置</legend>\n            <div style='overflow: hidden;margin-left: 8px'>\n                <span class='satellite_body_fieldset_span'>开始时间：</span><input id=\"starttime\" class='satellite_body_fieldset_input' /> \n                <span class='satellite_body_fieldset_span' style=\"margin-left: 10px;\">结束时间：</span><input id=\"endtime\" class='satellite_body_fieldset_input' />\n                <button id=\"init\"  type='button' class='CgsLayui-btn' style='margin-left: 17px'>应用</button>\n                <button id=\"import\"  type='button' class='CgsLayui-btn' style='margin-left: 17px;margin-right: 14px;'>导入</button>\n            </div>\n        </fieldset>\n        <fieldset class='satellite_body_fieldset'>\n            <legend>时间轴</legend>\n            <div class=\"satellite_body_fieldset_div\">\n                <span class=\"satellite_body_fieldset_span2\" style='float: right;position: relative;right: 15px;'>--:--</span> \n                <span class=\"satellite_body_fieldset_span2\" style='margin-left: 10px;'>--:--</span>\n            </div>\n            <div id=\"slider\" style='margin:5px 0px 14px 0px;'></div>\n        </fieldset>\n        <div>\n            <fieldset class='satellite_body_fieldset' style='display: inline-block;position: relative;top: 3px;'>\n                <legend>参数设置</legend>\n                <div style='margin-left: 8px;margin-right: 12px;height: 25px;'>\n                    <span>速度：</span>\n                    <select class='satellite_body_fieldset_select' id='speed'>\n                        <option value='1'>秒</option>\n                        <option value='60'>分</option>\n                        <option value='3600'>时</option>\n                        <option value='86400'>日</option>\n                    </select>\n                </div>\n            </fieldset>\n            <fieldset class='satellite_body_fieldset' style='display: inline-block;width: 236px;position: relative;'>\n                <legend>播放设置</legend>\n                <div style='height: 25px;'>\n                    <button id=\"down\"   type='button'  class='CgsLayui-btn sateillte_play_control-button'><i class=\"CgsLayui-icon CgsLayui-icon-prev \"></i></button>\n                    <button id=\"toggle\" type='button'  class='CgsLayui-btn sateillte_play_control-button' value='start'><i class=\"CgsLayui-icon CgsLayui-icon-play\" ></i></button>\n                    <button id=\"up\"     type='button'  class='CgsLayui-btn sateillte_play_control-button'><i class=\"CgsLayui-icon CgsLayui-icon-next\" ></i></button>\n                    <button id=\"reset\"  type='button'  class='CgsLayui-btn sateillte_play_control-button'>重置</button>\n                </div>\n            </fieldset>\n            <fieldset class='satellite_body_fieldset' style='display: inline-block;'>\n                <legend>属性设置</legend>\n                <div>\n                    <button id=\"path\" type='button'  value='false' class='CgsLayui-btn' style='margin-left: 14px;'>轨迹开启</button>\n                    <button id=\"board\" type='button'  value='true' class='CgsLayui-btn' style='margin: 0px 14px;'>标牌关闭</button>\n                </div>\n            </fieldset>\n        </div>\n    </div>\n    "),CgsTool.call(this,this.map,this.title,this.body)},CgsInherits(CgsSatellitePlugg,CgsTool),CgsSatellitePlugg.prototype.activate=function(){if(this.bone)return console.log("tool is exist");CgsTool.prototype.activate.call(this);var t,i=this;function a(e){var t={},i=new Date(e);return t.year=i.getFullYear(),t.month=i.getMonth(),t.date=i.getDate(),t.hours=i.getHours(),t.minutes=i.getMinutes(),t.seconds=i.getSeconds(),t}this.bone.element.css({height:"279px",left:"13px",top:"3px",width:"auto"}),CgsLayui.use(["laydate","slider"],function(){var e=CgsLayui.laydate,t=CgsLayui.slider;i.startLaydate=e.render({elem:"#starttime",type:"datetime",done:function(e){i.starttime=e}}),i.endLaydate=e.render({elem:"#endtime",type:"datetime",done:function(e){i.endtime=e}}),i.timeslider=t.render({elem:"#slider",theme:"#1F5B92",min:i.mintime,max:i.maxtime,change:function(){},setTips:function(e){if(!isNaN(e))return i.satelliteSimulation&&i.satelliteSimulation.setIntervalTime(new Date(e).getTime()-i.startTimeOriginGetTime),new Date(e).toString().substring(4,24)}})}),document.getElementById("toggle").onclick=function(e){"start"==e.currentTarget.value?(this.startPlay(),e.currentTarget.value="pause",e.currentTarget.children[0].className="CgsLayui-icon CgsLayui-icon-pause"):(this.stopPlay(),e.currentTarget.value="start",e.currentTarget.children[0].className="CgsLayui-icon CgsLayui-icon-play")}.bind(this),document.getElementById("path").onclick=function(e){"轨迹关闭"==e.target.innerText?(this.hidePath(),e.target.innerText="轨迹开启"):(this.showPath(),e.target.innerText="轨迹关闭")}.bind(this),document.getElementById("board").onclick=function(e){"标牌关闭"==e.target.innerText?(this.setLabelsVisible(!1),e.target.innerText="标牌开启"):(this.setLabelsVisible(!0),e.target.innerText="标牌关闭")}.bind(this),document.getElementById("reset").onclick=function(e){this.reset()}.bind(this),document.getElementById("speed").onchange=function(e){this.setSpeed(parseInt(e.target.value))}.bind(this),document.getElementById("down").onclick=function(e){this.speedDown()}.bind(this),document.getElementById("up").onclick=function(e){this.speedUp()}.bind(this),document.getElementById("init").onclick=function(e){void 0!==this.dataUrl?(this.reset(),this.satelliteSimulation&&this.satelliteSimulation.dispose(),this.satelliteSimulation=new CgsSatelliteSimulation({mapObject:map,startTime:this.startTimeOrigin,endTime:this.endTimeOrigin,dataUrl:this.dataUrl}),this.satelliteSimulation.init(),this.satelliteSimulation.setIntervalTime(this.mintime-this.startTimeOriginGetTime)):alert("未检测到数据，请导入文件")}.bind(this),document.getElementById("import").onclick=(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var i,s,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("导入"==t.target.innerText)return $$(document.getElementById("import")).attr("type","text"),$$(document.getElementById("import")).attr("type","file"),e.next=5,CgsUtil.openLoadFileWindow({accept:".json"});e.next=9;break;case 5:i=e.sent;try{s=i.result,o=JSON.parse(s),this.dataUrl=o,this.startTimeOrigin=o.beginTime,this.endTimeOrigin=o.endTime,this.starttime=this.startTimeOrigin,this.endtime=this.endTimeOrigin,this.startTimeOriginGetTime=new Date(this.startTimeOrigin).getTime(),$$(".satellite_body_fieldset_span2")[1]&&($$(".satellite_body_fieldset_span2")[1].innerText=this.starttime),$$(".satellite_body_fieldset_span2")[0]&&($$(".satellite_body_fieldset_span2")[0].innerText=this.endtime),this.startLaydate.config.elem[0].value=this.startTimeOrigin,this.endLaydate.config.elem[0].value=this.endTimeOrigin,this.startLaydate.config.min=a(this.startTimeOrigin),this.startLaydate.config.max=a(this.endTimeOrigin),this.endLaydate.config.min=a(this.startTimeOrigin),this.endLaydate.config.max=a(this.endTimeOrigin),t.target.innerText="清空"}catch(e){alert("文件解析失败，检查文件类型是否正确")}e.next=17;break;case 9:this.satelliteSimulation&&this.satelliteSimulation.dispose(),$$(".satellite_body_fieldset_span2")[1]&&($$(".satellite_body_fieldset_span2")[1].innerText="--:--"),$$(".satellite_body_fieldset_span2")[0]&&($$(".satellite_body_fieldset_span2")[0].innerText="--:--"),this.dataUrl=void 0,t.target.innerText="导入",this.startLaydate.config.elem[0].value="",this.endLaydate.config.elem[0].value="",this.timeslider.setValue(0);case 17:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)}.bind(this))},CgsSatellitePlugg.prototype.deactivate=function(){CgsTool.prototype.deactivate.call(this)},CgsSatellitePlugg.prototype.startPlay=function(){this.satelliteSimulation&&(this.satelliteSimulation.unfreeze(),this.interval=setInterval(function(){var e;this.satelliteSimulation.getIntervalTime()-this.distime<=this.disSliderTime?this.timeslider.setValue(this.satelliteSimulation.getIntervalTime()-this.distime):(this.stopPlay(),(e=document.getElementById("toggle")).value="start",e.children[0].className="CgsLayui-icon CgsLayui-icon-play")}.bind(this),1e3))},CgsSatellitePlugg.prototype.stopPlay=function(){this.satelliteSimulation&&this.satelliteSimulation.freeze(),clearInterval(this.interval)},CgsSatellitePlugg.prototype.reset=function(){this.dataUrl?(this.satelliteSimulation&&(this.satelliteSimulation.restart(),setTimeout(function(){this.satelliteSimulation.setIntervalTime(new Date(this.starttime).getTime()-this.startTimeOriginGetTime),this.satelliteSimulation.freeze()}.bind(this),100)),this.mintime=this.timeslider.config.min=new Date(this.starttime).getTime(),this.maxtime=this.timeslider.config.max=new Date(this.endtime).getTime(),$$(".satellite_body_fieldset_span2")[1].innerText=this.starttime,$$(".satellite_body_fieldset_span2")[0].innerText=this.endtime,this.disSliderTime=this.maxtime-this.mintime,this.distime=this.mintime-this.startTimeOriginGetTime,document.getElementById("toggle").value="start",document.getElementById("toggle").children[0].className="CgsLayui-icon CgsLayui-icon-play",document.getElementById("path").innerText="轨迹开启",document.getElementById("board").innerText="标牌关闭",clearInterval(this.interval),this.timeslider.setValue(0)):alert("未检测到数据，请导入文件")},CgsSatellitePlugg.prototype.setSpeed=function(e){this.satelliteSimulation&&this.satelliteSimulation.setMultiplier(e)},CgsSatellitePlugg.prototype.getSpeed=function(){if(this.satelliteSimulation)return this.satelliteSimulation.getMultiplier()},CgsSatellitePlugg.prototype.speedUp=function(){this.satelliteSimulation&&this.satelliteSimulation.speedUp()},CgsSatellitePlugg.prototype.speedDown=function(){this.satelliteSimulation&&this.satelliteSimulation.speedDown()},CgsSatellitePlugg.prototype.showPath=function(){this.satelliteSimulation&&this.satelliteSimulation.showPath()},CgsSatellitePlugg.prototype.hidePath=function(){this.satelliteSimulation&&this.satelliteSimulation.hidePath()},CgsSatellitePlugg.prototype.setLabelsVisible=function(e){this.satelliteSimulation&&this.satelliteSimulation.setLabelsVisible(e)},document.write('<link rel="stylesheet" href="'+CGS_SDK_PATH+'plugg/symbolPlugg/CgsSymbolPlugg.css"/>'),CgsSymbolPlugg=function(e){if(!e||!e.map)return console.error("map is not exit");this.smlFile="",this.jsonObj="",this.speedNum=1,this.maxDelay=0,(window.sym=this).map=e.map,this.starttime=0,this.endtime=0,this.step=e.step?e.step:1,this.speed=e.speed?e.speed:1,this.callback=e.callback?e.callback:null,this.mintime=void 0,this.maxtime=void 0,this.symbolSituation=void 0,this.startTimeOrigin=void 0,this.endTimeOrigin=void 0,this.startTimeOriginGetTime=void 0,this.endTimeOriginGetTime=void 0,this.dataUrl=void 0,this.distime=void 0,this.distimeend=void 0,this.disSliderTime=void 0,this.title=$$("<div class='title' style='color: white;display: block;margin: 8px;'>推演控制</div>");CgsSubPub.subscribe("toolActive",function(e,t,i){t==s&&0==i&&($$(".CgsLayerWindow").remove(),s.window=null,s.body.find(".CgsLayerTool__addLayer").parent().removeClass("CgsBottomTool__pressed"))});var s=this;this.body=$$("\n    <div class='satellite_body'>\n        <fieldset class='satellite_body_fieldset'>\n            <legend>时间轴</legend>\n            <div class=\"satellite_body_fieldset_div\">\n                <span class=\"satellite_body_fieldset_span2\" style='float: right;position: relative;right: 15px;'>--:--</span> \n                <span class=\"satellite_body_fieldset_span2\" style='margin-left: 10px;'>--:--</span>\n            </div>\n            <div id=\"slider\" style='margin:5px 0px 14px 0px;'></div>\n        </fieldset>\n        <div>\n            <fieldset class='satellite_body_fieldset' style='display: inline-block;position: relative;top: 3px;'>\n                <legend>播放速度</legend>\n                <div style='margin-left: 8px;margin-right: 12px;height: 25px;'>\n                    <span>速度：</span>\n                    <select value=\"1\" class='satellite_body_fieldset_select' id='speed'>\n                        <option value='0.5'>x0.5</option>\n                        <option value='0.75'>x0.75</option>\n                        <option selected value='1'>x1</option>\n                        <option value='2'>x2</option>\n                        <option value='3'>x3</option>\n                        <option value='4'>x4</option>\n                    </select>\n                </div>\n            </fieldset>\n            <fieldset class='satellite_body_fieldset' style='display: inline-block;width: 236px;position: relative;'>\n                <legend>播放设置</legend>\n                <div style='height: 25px;'>\n                    <button id=\"down\"   type='button'  class='CgsLayui-btn sateillte_play_control-button'><i class=\"CgsLayui-icon CgsLayui-icon-prev \"></i></button>\n                    <button id=\"toggles\" type='button'  class='CgsLayui-btn sateillte_play_control-button' value='start'><i class=\"CgsLayui-icon CgsLayui-icon-play\" ></i></button>\n                    <button id=\"up\"     type='button'  class='CgsLayui-btn sateillte_play_control-button'><i class=\"CgsLayui-icon CgsLayui-icon-next\" ></i></button>\n                    <button id=\"reset\"  type='button'  class='CgsLayui-btn sateillte_play_control-button'>重置</button>\n                </div>\n            </fieldset>\n            <fieldset class='satellite_body_fieldset' style='display: inline-block;'>\n                <legend>导入文件</legend>\n                <div>\n                    <button id=\"path\" type='button'  value='false' class='CgsLayui-btn' style='margin-left: 14px;'>上传态势文件</button>\n                    <button id=\"board\" type='button'  value='true' class='CgsLayui-btn' style='margin: 0px 14px;'>上传脚本文件</button>\n                </div>\n            </fieldset>\n        </div>\n    </div>\n    "),CgsTool.call(this,this.map,this.title,this.body);var i=this.activate;this.activate=function(e,t){i.call(this),e?s.bone.element.css(e):s.bone.element.css({height:"191px",left:"362px",top:"446px",width:"742px"})}},CgsInherits(CgsSymbolPlugg,CgsTool),CgsSymbolPlugg.prototype.activate=function(){var s=this;if(this.bone)return console.log("tool is exist");CgsTool.prototype.activate.call(this);var t,a=this;this.bone.element.css({height:"279px",left:"13px",top:"3px",width:"auto"}),CgsLayui.use(["laydate","slider"],function(){var e=CgsLayui.laydate,t=CgsLayui.slider;a.startLaydate=e.render({elem:"#starttime",type:"datetime",done:function(e){a.starttime=e}}),a.endLaydate=e.render({elem:"#endtime",type:"datetime",done:function(e){a.endtime=e}}),a.timeslider=t.render({elem:"#slider",theme:"#1F5B92",min:0,max:1e5,change:function(){},setTips:function(e){if(!isNaN(e)){var t=a.symbolSituation.getIntervalTime(),i=parseInt(t/6e4),s=parseInt((t-6e4*i)/1e3);return(i<10?"0"+i:""+i)+":"+(s<10?"0"+s:""+s)}}})}),setTimeout(function(){var t,i=this;document.getElementById("toggles")&&(document.getElementById("toggles").onclick=(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.symbolSituation){e.next=14;break}if(!a.jsonObj||!a.smlFile){e.next=9;break}a.symbolSituation=new CgsSymbolSituation({map:i.map,jsonObj:a.jsonObj}),a.symbolSituation.active(),a.timeslider.config.max=a.getMaxDelay(JSON.parse(a.jsonObj)),a.maxDelay=a.getMaxDelay(JSON.parse(a.jsonObj)),a.startPlay(),e.next=12;break;case 9:return console.log("态势文件或脚本文件不存在！"),CgsSubPub.publish("symbolpluggerror",["态势文件或脚本文件不存在！"]),e.abrupt("return");case 12:e.next=15;break;case 14:a.symbolSituation&&a.symbolSituation.stop();case 15:"start"==t.currentTarget.value?(t.currentTarget.value="pause",t.currentTarget.children[0].className="CgsLayui-icon CgsLayui-icon-pause"):(t.currentTarget.value="start",t.currentTarget.children[0].className="CgsLayui-icon CgsLayui-icon-play");case 16:case"end":return e.stop()}},e,i)})),function(e){return t.apply(this,arguments)})),document.getElementById("down")&&(document.getElementById("down").onclick=function(e){1==a.speedNum||.75==a.speedNum?a.speedNum=a.speedNum-.25:1<a.speedNum&&a.speedNum<=4&&(a.speedNum=a.speedNum-1),a.setSpeed(a.speedNum),document.getElementById("speed").value=a.speedNum}),document.getElementById("up")&&(document.getElementById("up").onclick=function(e){a.speedNum<=.75?a.speedNum=a.speedNum+.25:1<=a.speedNum&&a.speedNum<4&&(a.speedNum=a.speedNum+1),document.getElementById("speed").value=a.speedNum,a.setSpeed(a.speedNum)})},3e3),document.getElementById("path").onclick=(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:$$(document.getElementById("path")).attr("type","text"),$$(document.getElementById("path")).attr("type","file"),(i=new FileReader).onload=function(){var e=this.result;a.map.jmpApi.importByString(e),a.smlFile=e},inputF=$$("<input type='file'>"),inputF.change(function(){var e=this.files[0];i.readAsText(e)}),a.map.jmpApi.clearSymbolScene(),a.map.allSymbols=[],inputF.click();case 9:case"end":return e.stop()}},e,s)})),function(e){return t.apply(this,arguments)}),document.getElementById("board").onclick=function(e){$$(document.getElementById("path")).attr("type","text"),$$(document.getElementById("path")).attr("type","file");var t=new FileReader;t.onload=function(){a.jsonObj=this.result;var e=JSON.parse(this.result);a.endtime=e.Camera.delay[e.Camera.delay.length-1],a.maxtime=e.Camera.delay[e.Camera.delay.length-1],a.starttime="00:00";var t=parseInt(a.endtime/6e4),i=(a.endtime-6e4*t)/1e3,s="",o="",s=t<10?"0"+t:""+t,o=i<10?"0"+i:""+i;a.endtime=s+":"+o,$$(".satellite_body_fieldset_span2")[1].innerText=a.starttime,$$(".satellite_body_fieldset_span2")[0].innerText=a.endtime},inputF=$$("<input type='file'>"),inputF.change(function(){var e=this.files[0];t.readAsText(e)}),inputF.click()},document.getElementById("reset").onclick=function(e){s.reset()},document.getElementById("speed").onchange=function(e){s.setSpeed(parseInt(e.target.value)),s.speedNum=e.target.value}},CgsSymbolPlugg.prototype.deactivate=function(){CgsTool.prototype.deactivate.call(this)},CgsSymbolPlugg.prototype.startPlay=function(){var e=this;this.interval=setInterval(function(){e.timeslider.setValue(e.symbolSituation.getIntervalTime()),e.symbolSituation.getIntervalTime()>=e.maxDelay&&(document.getElementById("toggles").children[0].className="CgsLayui-icon CgsLayui-icon-play",document.getElementById("toggles").value="start",window.clearInterval(e.interval),e.symbolSituation.dispose(),e.symbolSituation=null,self.speedNum=1,document.getElementById("speed").value=self.speedNum)},1e3)},CgsSymbolPlugg.prototype.stopPlay=function(){this.symbolSituation&&this.symbolSituation.freeze(),clearInterval(this.interval)},CgsSymbolPlugg.prototype.reset=function(){this.map.removeAllSymbols(),this.symbolSituation&&(this.symbolSituation.deactivate(),this.map.removeAllSymbols()),this.speedNum=1,document.getElementById("speed").value=this.speedNum,this.jsonObj=null,this.smlFile=null,$$(".satellite_body_fieldset_span2")[1].innerText="--:--",$$(".satellite_body_fieldset_span2")[0].innerText="--:--",document.getElementById("toggles").value="start",document.getElementById("toggles").children[0].className="CgsLayui-icon CgsLayui-icon-play",clearInterval(this.interval),this.timeslider.setValue(0),this.symbolSituation.dispose(),this.symbolSituation=null},CgsSymbolPlugg.prototype.setSpeed=function(e){this.symbolSituation&&this.symbolSituation.setSpeedNum(e)},CgsSymbolPlugg.prototype.getMaxDelay=function(e){for(var t=e.symbol,i=0,s=0;s<t.length;s++)for(var o=0;o<t[s].delay.length;o++)i<t[s].delay[o]&&(i=t[s].delay[o]);return i},CgsSymbolPlugg.prototype.getSpeed=function(){if(this.symbolSituation)return this.symbolSituation.getMultiplier()},CgsSymbolPlugg.prototype.speedUp=function(){this.symbolSituation&&this.symbolSituation.speedUp()},CgsSymbolPlugg.prototype.speedDown=function(){this.symbolSituation&&this.symbolSituation.speedDown()},CgsSymbolPlugg.prototype.showPath=function(){this.symbolSituation&&this.symbolSituation.showPath()},CgsSymbolPlugg.prototype.hidePath=function(){this.symbolSituation&&this.symbolSituation.hidePath()},CgsSymbolPlugg.prototype.setLabelsVisible=function(e){this.symbolSituation&&this.symbolSituation.setLabelsVisible(e)},CgsGlobe=function(c){c.oceanStream;this.setProperty=function(e,t){var i;"resolutionScale"==e?(0==parseFloat(t)&&(t=.01),c.map3D.resolutionScale=parseFloat(t)):"shadows"==e?c.setShadowVisible(t):"terrainShadows"==e?(i=-1,"CAST_ONLY"==t?i=Cesium.ShadowMode.CAST_ONLY:"DISABLED"==t?i=Cesium.ShadowMode.DISABLED:"ENABLED"==t?i=Cesium.ShadowMode.ENABLED:"RECEIVE_ONLY"==t&&(i=Cesium.ShadowMode.RECEIVE_ONLY),c.map3D.terrainShadows=i):"enableLighting"==e?c.map3D.scene.globe.enableLighting=t:"fog"==e?c.map3D.scene.fog.enabled=t:"fxaa"==e?c.map3D.scene.postProcessStages.fxaa.enabled=t:"skyBoxShow"==e?c.map3D.scene.skyBox.show=t:"brightness"==e?c.map3D.setLayerBrightness(t):"skyAtmosphereShow"==e?c.map3D.scene.skyAtmosphere.show=t:"hueShift"==e?c.map3D.scene.skyAtmosphere.hueShift=parseFloat(t):"saturationShift"==e?c.map3D.scene.skyAtmosphere.saturationShift=parseFloat(t):"brightnessShift"==e?c.map3D.scene.skyAtmosphere.brightnessShift=parseFloat(t):"oceanStreamShow"==e?c.oceanStream?c.oceanStream.setVisible(t):(c.oceanStream=new CgsStream({url:"http://28.12.2.55:8888/currentData/current-surface.json",type:"ocean",show:!0,color:"rgba(0.0,255.0,255.0,1.0)",numCurrent:2e3,speed:120}),c.addFeature(c.oceanStream)):"oceanStreamSpeed"==e?c.oceanStream&&c.oceanStream.setSpeed(parseFloat(t)):"airStreamShow"==e?c.airStream?c.airStream.setVisible(t):(c.airStream=new CgsStream({url:"http://28.12.2.55:8888/currentData/current-surface.json",type:"air",show:!0,color:"rgba(255.0,255.0,255.0,1.0)",numCurrent:2e3,speed:120}),c.addFeature(c.airStream)):"airStreamSpeed"==e?c.airStream&&c.airStream.setSpeed(parseFloat(t)):"snowShow"==e?c.snow?c.snow.setVisible(t):(c.snow=new CgsPrecipitation({type:"snow",show:!0,density:.5,visibleHeight:1e3}),c.addFeature(c.snow)):"snowVisibieHeight"==e?c.snow&&c.snow.setVisibleHeight(parseInt(t)):"snowDensity"==e?c.snow&&c.snow.setDensity(parseFloat(t)):"rainShow"==e?c.rain?c.rain.setVisible(t):(c.rain=new CgsPrecipitation({type:"rain",show:!0,density:.5,visibleHeight:1e3}),c.addFeature(c.rain)):"rainVisibieHeight"==e?c.rain&&c.rain.setVisibleHeight(parseInt(t)):"rainDensity"==e&&c.rain&&c.rain.setDensity(parseFloat(t))},this.getPropertyString=function(){var e,t=c.map3D.resolutionScale,i=c.map3D.shadows;switch(c.map3D.terrainShadows){case 0:e="RECEIVE_ONLY";break;case 1:e="DISABLED";break;case 2:e="ENABLED";break;case 3:e="CAST_ONLY"}var s=c.map3D.scene.globe.enableLighting,o=c.map3D.scene.fog.enabled,a=c.map3D.scene.postProcessStages.fxaa.enabled,n=c.map3D.scene.skyBox.show,r=c.map3D.scene.skyAtmosphere.show,l=c.map3D.scene.skyAtmosphere.hueShift,u=c.map3D.scene.skyAtmosphere.saturationShift,p=c.map3D.scene.skyAtmosphere.brightnessShift,h=[];return h.push({type:"slider",label:"解析度",name:"resolutionScale",min:0,max:1,defaultValue:t,fixedNumber:2},{type:"checkbox",label:"阴影",name:"shadows",value:i},{type:"dropdown",label:"地形阴影",name:"terrainShadows",defaultValue:e,data:[{value:0,label:"RECEIVE_ONLY"},{value:1,label:"DISABLED"},{value:2,label:"ENABLED"},{value:3,label:"CAST_ONLY"}]},{type:"header",label:"场景"},{type:"checkbox",label:"光照",name:"enableLighting",value:s},{type:"checkbox",label:"雾",name:"fog",value:o},{type:"checkbox",label:"抗锯齿",name:"fxaa",value:a},{type:"title",label:"地球"},{type:"header",label:"天空盒"},{type:"checkbox",label:"显示",name:"skyBoxShow",value:n},{type:"header",label:"图层亮度"},{type:"slider",label:"亮度",name:"brightness",min:0,max:1,defaultValue:1,fixedNumber:2},{type:"header",label:"大气层"},{type:"checkbox",label:"显示",name:"skyAtmosphereShow",value:r},{type:"slider",label:"色相偏移",name:"hueShift",min:-1,max:1,defaultValue:l,fixedNumber:2},{type:"slider",label:"饱和度偏移",name:"saturationShift",min:-1,max:1,defaultValue:u,fixedNumber:2},{type:"slider",label:"亮度偏移",name:"brightnessShift",min:-1,max:1,defaultValue:p,fixedNumber:2},{type:"header",label:"洋流"},{type:"checkbox",label:"显示",name:"oceanStreamShow",value:!1},{type:"slider",label:"速率",name:"oceanStreamSpeed",min:1,max:500,defaultValue:120,fixedNumber:1},{type:"header",label:"气流"},{type:"checkbox",label:"显示",name:"airStreamShow",value:!1},{type:"slider",label:"速率",name:"airStreamSpeed",min:1,max:500,defaultValue:120,fixedNumber:1},{type:"header",label:"雪"},{type:"checkbox",label:"显示",name:"snowShow",value:!1},{type:"slider",label:"可见高度",name:"snowVisibieHeight",min:100,max:5e3,defaultValue:1e3,fixedNumber:2},{type:"slider",label:"密度",name:"snowDensity",min:0,max:1,defaultValue:.5,fixedNumber:2},{type:"header",label:"雨"},{type:"checkbox",label:"显示",name:"rainShow",value:!1},{type:"slider",label:"可见高度",name:"rainVisibieHeight",min:100,max:5e3,defaultValue:1e3,fixedNumber:2},{type:"slider",label:"密度",name:"rainDensity",min:0,max:1,defaultValue:.5,fixedNumber:2}),h}},CgsTipsWindow=function(e){var t=$$("<div></div>");t.addClass("tipsWindow");var i=$$("<div></div>");i.addClass("outerDiv");var s=$$("<div></div>");s.addClass("tipsSelf"),s.text(e);var o=$$("<div></div>");o.addClass("tipsConfirm"),o.text("确定"),o.click(function(e){e.stopPropagation(),$$(".tipsWindow").eq(0).css("display","none")}),s.appendTo(i),o.appendTo(i),i.appendTo(t),t.appendTo($$("#mapContainer")),$$(window).resize({minWidth:600,minHeight:400},function(e){var t=e.data,i=$$(".tipsWindow .outerDiv").eq(0),s=$$(this).width(),o=$$(this).height(),a=s/2-210+"px",n=o/2-120+"px";s<t.minWidth&&(a="100px"),o<t.minHeight&&(n="50px"),i.css("left",a),i.css("top",n)})},CgsTipsWindow.showLog=function(e){var t=$$(".tipsWindow").eq(0);0==t.length&&new CgsTipsWindow(e);var i=$$(".tipsWindow .outerDiv .tipsSelf").eq(0);t.css("display","block"),i.text(e)},CgsMapFile=function CgsMapFile(map){var state={saveEntitiesFlag:!0,saveLayersFlag:!0,saveDatasourcesFlag:!0,saveCameraFlag:!0,saveSymbolSceneFlag:!0,saveGlobeFlag:!0,saveData:{}};function recoverEntities(type,options){var effect,opt,mark,str;"CgsCurve"==type?(effect=new CgsAnimation({mapObj:map,id:options.info.effectObjId}),options.info.effectObj=effect,CgsCurve.load(map,options.info)):"CgsCircleAnimation"==type||("CgsFlyMark"==type?(opt=options.info.markOpt,opt.pixelOffset=eval(opt.pixelOffset),mark=new CgsMark(opt),mark.setVisibleHeight(opt.visibleHeight),options.info.mark=mark,CgsFlyMark.load(map,options.info)):(str=type+".load(map,options.info)",eval(str)))}function loadFrustum(e){null!=e.near&&(map.camera.frustum.near=e.near),null!=e.far&&(map.camera.frustum.far=e.far),null!=e.top&&(map.camera.frustum.top=e.top),null!=e.bottom&&(map.camera.frustum.bottom=e.bottom),null!=e.left&&(map.camera.frustum.left=e.left),null!=e.right&&(map.camera.frustum.right=e.right),null!=e.xOffset&&(map.camera.frustum.xOffset=e.xOffset),null!=e.yOffset&&(map.camera.frustum.yOffset=e.yOffset),null!=e.fov&&(map.camera.frustum.fov=e.fov),null!=e.aspectRatio&&(map.camera.frustum.aspectRatio=e.aspectRatio)}function saveFrustum(e){var t={};return null!=e.near&&(t.near=e.near),null!=e.far&&(t.far=e.far),null!=e.top&&(t.top=e.top),null!=e.bottom&&(t.bottom=e.bottom),null!=e.left&&(t.left=e.left),null!=e.right&&(t.right=e.right),null!=e.xOffset&&(t.xOffset=e.xOffset),null!=e.yOffset&&(t.yOffset=e.yOffset),null!=e.fov&&(t.fov=e.fov),null!=e.aspectRatio&&(t.aspectRatio=e.aspectRatio),t}function updateCamera(e){map.camera.setView({destination:e.position,orientation:{direction:e.direction,up:e.up}}),null!=state.saveData.listener&&(map.scene.morphComplete.removeEventListener(state.saveData.listener),state.saveData.listener=void 0),loadFrustum(e.frustum)}this.state=state,this.setSaveEntitiesFlag=function(e){state.saveEntitiesFlag=e},this.getSaveEntitiesFlag=function(){return state.saveEntitiesFlag},this.setSaveLayersFlag=function(e){state.saveLayersFlag=e},this.getSaveLayersFlag=function(){return state.saveLayersFlag},this.setSaveDatasourcesFlag=function(e){state.saveDatasourcesFlag=e},this.getSaveDatasourcesFlag=function(){return state.saveDatasourcesFlag},this.setSaveCameraFlag=function(e){state.saveCameraFlag=e},this.getSaveCameraFlag=function(){return state.saveCameraFlag},this.setSaveSymbolSceneFlag=function(e){state.saveSymbolSceneFlag=e},this.getSaveSymbolSceneFlag=function(){return state.saveSymbolSceneFlag},this.setSaveGlobeFlag=function(e){state.saveGlobeFlag=e},this.getSaveGlobeFlag=function(){return state.saveGlobeFlag},this.save=function(){var e,t;if(state.saveData={},CgsSubPub.publish("sceneSave",[this]),state.saveCameraFlag&&(e=map.mode,t={position:null,direction:null,up:null},"3D"==(state.saveData.sceneMode=e)?(t.position=map.map3D.camera.positionWC.clone(),t.up=map.map3D.camera.up.clone(),t.direction=map.map3D.camera.direction.clone()):"2D"==e&&(t.center=map.getCenter(),t.zoom=map.getZoom()),state.saveData.camera=t),state.saveGlobeFlag&&(t={resolutionScale:map.map3D.resolutionScale,shadows:map.map3D.shadows,terrainShadows:map.map3D.terrainShadows,enableLighting:map.map3D.scene.globe.enableLighting,fog:map.map3D.scene.fog.enabled,fxaa:map.map3D.scene.fxaa,skyBoxShow:map.map3D.scene.skyBox.show,skyAtmosphereShow:map.map3D.scene.skyAtmosphere.show,hueShift:map.map3D.scene.skyAtmosphere.hueShift,saturationShift:map.map3D.scene.skyAtmosphere.saturationShift,brightnessShift:map.map3D.scene.skyAtmosphere.brightnessShift},state.saveData.globe=t),state.saveLayersFlag){for(var i=map.getLayers(),s=i.length,o=0;o<s;o++){var a=i[o];a.getSaveFlag()&&(p=a.getType(),u=a.save(),"WMTS"==p?(null==state.saveData.WMTS&&(state.saveData.WMTS=[]),state.saveData.WMTS.push(u)):"WFS"==p?(null==state.saveData.WFS&&(state.saveData.WFS=[]),state.saveData.WFS.push(u)):"WMS"==p?(null==state.saveData.WMS&&(state.saveData.WMS=[]),state.saveData.WMS.push(u)):"Image"==p&&(null==state.saveData.Image&&(state.saveData.Image=[]),state.saveData.Image.push(u)))}map.toolbar.layerTool&&(state.saveData.layersTree=map.toolbar.layerTool.getSaveLayerInfo())}if(state.saveDatasourcesFlag){for(var n=map.getAllDataSources(),s=n.length,o=0;o<s;o++){var r=n[o];r.getSaveFlag()&&(u=r.save(),null==state.saveData.datasources&&(state.saveData.datasources=[]),state.saveData.datasources.push(u))}map.toolbar.layerTool&&(state.saveData.datasourcesTree=map.toolbar.layerTool.getSaveDatasourceInfo())}if(state.saveData.entities=[],state.saveEntitiesFlag)for(var l=map.getAllFeatures(),s=l.length,o=0;o<s;o++){var u,p,h=l[o];h.getSaveFlag&&h.getSaveFlag()&&(u=h.save(),p=h.constructor.name,h.feature3D&&h.feature3D.label&&(u.labelstroke=h.feature3D.label.labelstroke,u.labelstrokewidth=h.feature3D.label.labelstrokewidth,u.labelfill=h.feature3D.label.labelfill,u.labelfont=h.feature3D.label.labelfont,u.labelscale=h.feature3D.label.labelscale,u.labeloffset=h.feature3D.label.labeloffset),p&&state.saveData.entities.push({type:p,info:u}))}return state.saveSymbolSceneFlag&&(state.saveData.symbolScene=map.saveSymbolScene()),state.saveData},this.loadFromFile=function(e){var t=JSON.parse(e);this.load(t)},this.load=function(e){var t;if(CgsSubPub.publish("sceneload"),e.layersTree&&(map.treeNodes.layerGroup=e.layersTree,map.removeAllLayers()),e.datasourcesTree&&(map.treeNodes.datasourceGroup=e.datasourcesTree,map.removeAllDataSources()),e.entities&&map.removeAllFeatures(),e.sceneMode&&("3D"==(t=e.sceneMode)?("2D"==map.mode&&map.setMapMode("3D"),e.camera&&map.map3D.camera.setView({destination:e.camera.position,orientation:{direction:e.camera.direction,up:e.camera.up}})):"2D"==t&&("3D"==map.mode&&map.setMapMode("2D"),e.camera&&(map.setCenter(e.camera.center),map.setZoom(e.camera.zoom)))),e.globe&&(map.map3D.resolutionScale=e.globe.resolutionScale,map.map3D.shadows=e.globe.shadows,map.map3D.terrainShadows=e.globe.terrainShadows,map.map3D.scene.globe.enableLighting=e.globe.enableLighting,map.map3D.scene.fog.enabled=e.globe.fog,map.map3D.scene.fxaa=e.globe.fxaa,map.map3D.scene.skyBox.show=e.globe.skyBoxShow,map.map3D.scene.skyAtmosphere.show=e.globe.skyAtmosphereShow,map.map3D.scene.skyAtmosphere.hueShift=e.globe.hueShift,map.map3D.scene.skyAtmosphere.saturationShift=e.globe.saturationShift,map.map3D.scene.skyAtmosphere.brightnessShift=e.globe.brightnessShift),e.WMTS)for(var i=e.WMTS.length,s=0;s<i;s++){var o=e.WMTS[s];CgsTileLayer.load(map,o)}if(e.WMS)for(i=e.WMS.length,s=0;s<i;s++){o=e.WMS[s];CgsWMSLayer.load(map,o)}if(e.WFS)for(i=e.WFS.length,s=0;s<i;s++){(o=e.WFS[s]).mapObject=map,CgsWFSLayer.load(map,o)}if(e.Image)for(i=e.Image.length,s=0;s<i;s++){o=e.Image[s];CgsImageLayer.load(map,o)}if(e.datasources)for(i=e.datasources.length,s=0;s<i;s++){o=e.datasources[s];CgsKml.load(map,o)}map.getLayers(),map.getAllDataSources();if(e.entities)for(i=e.entities.length,s=0;s<i;s++){recoverEntities((o=e.entities[s]).type,o)}e.symbolScene&&map.loadSymbolScene(e.symbolScene),CgsSubPub.publish("sceneloadsuccess")};var self=this;function init(){var e=$$("<div style='position:absolute;width:100%;height:100%;'></div>"),t=$$("<div style='position:absolute;width:100%;height:auto;'></div>"),i=$$("<div class='CgsLayerWindow__name' style='font-size:14px;'><span>文件名称</span></div><input class='CgsLayerWindow__name_input' value='未命名' style='width:195px;margin-left:82px'></input><div class='CgsLayerWindow__name' style='font-size:14px;'><span>保存项</span></div><div class='CgsLayerWindow__save_box'><input class='CgsLayerWindow__name_checkbox_file' type='checkbox'></input><div class='CgsLayerWindow__name_file'><span>相机位置</span></div><input class='CgsLayerWindow__name_checkbox_file' type='checkbox'></input><div class='CgsLayerWindow__name_file'><span>地球设置</span></div><input class='CgsLayerWindow__name_checkbox_file' type='checkbox'></input><div class='CgsLayerWindow__name_file'><span>图元</span></div><input class='CgsLayerWindow__name_checkbox_file' type='checkbox'></input><div class='CgsLayerWindow__name_file'><span>军标</span></div><input class='CgsLayerWindow__name_checkbox_file' type='checkbox'></input><div class='CgsLayerWindow__name_file'><span>图层</span></div><input class='CgsLayerWindow__name_checkbox_file' type='checkbox'></input><div class='CgsLayerWindow__name_file'><span>数据源</span></div></div>"),s=$$("<div style='position:absolute;width:100%;height:auto;bottom:22px'></div>"),o=$$("<div class='CgsLayerWindow_cancel_file'>取消</div>"),a=$$("<div class='CgsLayerWindow_ok_file'>确定</div>");a.click(function(e){var t=$$(self.body).find(".CgsLayerWindow__name_input").eq(0).val(),i=$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[0].checked,s=$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[1].checked,o=$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[2].checked,a=$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[3].checked,n=$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[4].checked,r=$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[5].checked;self.setSaveEntitiesFlag(o),self.setSaveLayersFlag(n),self.setSaveDatasourcesFlag(r),self.setSaveCameraFlag(i),self.setSaveSymbolSceneFlag(a),self.setSaveGlobeFlag(s),""==t?t="CgsEarth"+(new Date).getTime()+".ge":t+=".ge",prepareSaveData(t),recoverState()}),o.click(function(e){recoverState()}),i.appendTo(t),t.appendTo(e),o.appendTo(s),a.appendTo(s),s.appendTo(e),self.body=e,$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[0].checked=self.getSaveCameraFlag(),$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[1].checked=self.getSaveGlobeFlag(),$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[2].checked=self.getSaveEntitiesFlag(),$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[3].checked=self.getSaveSymbolSceneFlag(),$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[4].checked=self.getSaveLayersFlag(),$$(self.body).find(".CgsLayerWindow__name_checkbox_file")[5].checked=self.getSaveDatasourcesFlag()}function recoverState(){$$(self.body).find(".CgsLayerWindow__name_input").eq(0).val("未命名"),self.deactivateSave()}function prepareSaveData(e){var t=self.save(),i=JSON.stringify(t);saveDataToFile("data:text/txt;charset=utf-8,"+encodeURIComponent(i),e)}function saveDataToFile(e,t){var i=$("<a>");i.attr("href",e),i.attr("download",t),i.get(0).click(),CgsTipsWindow.showLog("保存成功！")}init();var titleImgUrl=CGS_SDK_PATH+"assets/image/ablum.png";function readText(e,t){var i=new FileReader;i.onload=function(){t(i.result)},i.readAsText(e)}function browser(i){var s=$$("<input type='file' id='file-input'>");s.trigger("click"),s.change(function(e){var t=s.get(0).files[0];i(t)})}this.title=$$("<div class='CgsLayerTool__title CgsTool__title'><img class='CgsLayerTool__titleImg' ><span class='CgsLayerTool__titleText'>保存</span><div class='CgsLayerTool__closeButton'></div></div>"),this.title.find(".CgsLayerTool__titleImg").attr("src",titleImgUrl),CgsTool.call(this,map,this.title,this.body),this.activateLoad=function(){var t=this;browser(function(e){readText(e,function(e){t.loadFromFile(e)})})}},CgsInherits(CgsMapFile,CgsTool),CgsMapFile.prototype.activateSave=function(){CgsTool.prototype.activate.call(this),this.bone.element.css("width","303px")},CgsMapFile.prototype.deactivateSave=function(){CgsTool.prototype.deactivate.call(this)},CgsGraticule=function(e){var _={viewer:e.map.map3D,scene:e.map.map3D.scene,camera:e.map.map3D.scene.camera,ellipsoid:e.map.map3D.scene.globe.ellipsoid,eventHandler:null,lines:{},labels:null,points:null,option:null,span:e.span||30,color:e.color,labelColor:e.labelColor||"rgba(0, 0, 0, 1)",labelSize:e.labelSize||"14px",targetSize:e.targetSize||100,labelsFlag:!0},w=null,n=!1,r=e.map.map2D,l=new ol.layer.Graticule({targetSize:_.targetSize,strokeStyle:new ol.style.Stroke({color:_.color,width:1}),showLabels:!0,lonLabelStyle:new ol.style.Text({font:_.labelSize+" sans-serif,Calibri",textBaseline:"bottom",fill:new ol.style.Fill({color:_.labelColor})}),latLabelStyle:new ol.style.Text({font:_.labelSize+" sans-serif,Calibri",textBaseline:"right",fill:new ol.style.Fill({color:_.labelColor})}),latLabelFormatter:function(e){return P(e,"lat")+"            "},lonLabelFormatter:function(e){return P(e,"lng")+"            "}});function P(e,t){var i="lng"===t?e<0?"W":"E":"lat"===t?e<0?"S":"N":"";e=Math.abs(e);var s=Math.floor(e),o=Math.floor(60*(e-s)),a=Math.round(3600*(e-s)%60);return 60==a&&(a=0,o++),60==o&&(o=0,s++),0==o&&0==a?i+s+"°":0==a?i+s+"°"+o+"'":i+s+"°"+o+"'"+a+'"'}function u(){_.lines.lng.removeAll(),_.lines.lat.removeAll(),_.labels.removeAll(),_.points.removeAll();var e=_.scene.globe._surface._debug.maxDepthVisited;10<=e||function(e){_.option=w[e];var t=_.option;if(t){var i=function(e){var t=_.option;if(t){var i=t.style.color;return i=i&&4===i.length?Cesium.Color.fromBytes(i[0],i[1],i[2],e||i[3]):Cesium.Color.fromBytes(255,255,255,255)}return Cesium.Color.fromBytes(255,255,255,255)}(),s=t.style.width;s=s&&0<s&&!isNaN(s)?Math.round(s):1;var o=function(){var e=_.camera.computeViewRectangle(_.scene.globe.ellipsoid);return{west:Cesium.Math.toDegrees(e.west),east:Cesium.Math.toDegrees(e.east),south:Cesium.Math.toDegrees(e.south),north:Cesium.Math.toDegrees(e.north)}}(),a=t.interval.lat,n=t.interval.lng,r=o.west,l=o.south,u=o.east,p=o.north;l=-(p=90),r=Math.floor(r/n)*n-n,u=Math.ceil(u/n)*n+n,l=Math.floor(-90/a)*a-n,p=Math.ceil(90/a)*a+a;u<r&&(u+=360);for(var h=r;h<=u;h+=n){var c=[];for(g=l;g<=p;g+=1)Math.abs(g)<=85&&c.push(h,g);0<c.length&&_.lines.lng.add({positions:Cesium.Cartesian3.fromDegreesArray(c),material:Cesium.Material.fromType("Color",{color:i}),width:s})}for(var g=l;g<=p;g+=a){c=[];for(h=r;h<=u;h+=1)Math.abs(g)<=85&&c.push(h,g);0<c.length&&_.lines.lat.add({positions:Cesium.Cartesian3.fromDegreesArray(c),material:Cesium.Material.fromType("Color",{color:i}),width:s})}var d=function(e){var t=_.scene.canvas;return e=e||1,[_.camera.pickEllipsoid(new Cesium.Cartesian2(0,0),_.ellipsoid),_.camera.pickEllipsoid(new Cesium.Cartesian2(Math.ceil(t.width*e),0),_.ellipsoid),_.camera.pickEllipsoid(new Cesium.Cartesian2(0,Math.ceil(t.height*e)),_.ellipsoid),_.camera.pickEllipsoid(new Cesium.Cartesian2(Math.ceil(t.width*e),Math.ceil(t.height*e)),_.ellipsoid)]}(.85),m=Cesium.Color.fromCssColorString(_.labelColor),f=0,C=0;void 0!==d[1]&&(S=Cesium.Cartographic.fromCartesian(d[1]),f=Cesium.Math.toDegrees(S.longitude)),void 0!==d[2]&&(b=Cesium.Cartographic.fromCartesian(d[2]),C=Cesium.Math.toDegrees(b.latitude));for(var y=0;y<_.lines.lat.length;y++){var v=_.lines.lat.get(y),b=Cesium.Cartographic.fromCartesian(v.positions[0]),g=Cesium.Math.toDegrees(b.latitude);T(f,g,P(g,"lat"),!0,m)}for(y=0;y<_.lines.lng.length;y++){var D=_.lines.lng.get(y),S=Cesium.Cartographic.fromCartesian(D.positions[0]),h=Cesium.Math.toDegrees(S.longitude);(!(_.span<25)||y%2==0)&&T(h,C,P(h,"lng"),!1,m)}}}(e)}function T(e,t,i,s,o){_.labels.add({position:Cesium.Cartesian3.fromDegrees(e,t),text:i+"",font:_.labelSize+"  sans-serif",fillColor:o||Cesium.Color.fromBytes(255,255,255,255),outlineColor:o||Cesium.Color.fromBytes(255,255,255,255),style:Cesium.LabelStyle.FILL,scaleByDistance:new Cesium.NearFarScalar(1550,.8,55e6,1.5),horizontalOrigin:s?Cesium.VerticalOrigin.Left:Cesium.VerticalOrigin.RIGHT,verticalOrigin:s?Cesium.VerticalOrigin.TOP:Cesium.VerticalOrigin.BOTTOM,scale:1,show:_.labelsFlag})}this.setSpan=function(e){_.span=e,n&&(this.deactivate(),this.activate())},this.setColor=function(e){l&&l.strokeStyle_.setColor(e),_.color=e,n&&(this.deactivate(),this.activate())},this.setLabelColor=function(e){_.labelColor=e,_.labelsFlag&&(l.latLabelStyle_.fill_.setColor(e),l.lonLabelStyle_.fill_.setColor(e)),n&&(this.deactivate(),this.activate())},this.setLablesVisible=function(e){_.labelsFlag=e;var t=l.lonLabelStyleBase_,i=l.latLabelStyleBase_,s=t.getText().getFill(),o=i.getText().getFill();e?(s.setColor(_.labelColor),o.setColor(_.labelColor)):(s.setColor("rgba(0, 0, 0, 0)"),o.setColor("rgba(0, 0, 0, 0)")),n&&(this.deactivate(),this.activate())},this.activate=function(){if(n)return 0;n=!0,l.setMap(r);for(var e={},t=_.span,i=1;i<=30;i++){var s=Math.floor(16/i);3<s&&(s=3),s<1&&(s=1);var o=Cesium.Color.fromCssColorString(_.color),a={interval:{lat:t,lng:t},style:{width:s=1,color:[255*o.red,255*o.green,255*o.blue,255*o.alpha]}},t=5<t?Math.round(10*t/2)/10:1<t?Math.round(100*t/2)/100:Math.round(1e4*t/2)/1e4;e[i]=a}w=e,_.lines.lng=_.scene.primitives.add(new Cesium.PolylineCollection),_.lines.lat=_.scene.primitives.add(new Cesium.PolylineCollection),_.points=_.scene.primitives.add(new Cesium.PointPrimitiveCollection),_.labels=_.scene.primitives.add(new Cesium.LabelCollection),u(),_.camera.changed.addEventListener(u)},this.deactivate=function(){_.camera.changed.removeEventListener(u),_.eventHandler=null,_.scene.primitives.remove(_.lines.lng),_.scene.primitives.remove(_.lines.lat),_.scene.primitives.remove(_.points),_.scene.primitives.remove(_.labels),_.lines={},_.points=null,_.labels=null,n=!1,l.setMap(null)}},CgsWFSQuery=function(e){this.url=e.url,this.typeName=e.typeName,this.completeCallback=e.completeCallback,this.map=e.mapObject},CgsWFSQuery.prototype.activate=function(){var l=this;this.featureclickoutId=CgsSubPub.subscribe("featureclickout",function(e,t,i){var s=[i[0]-2,i[1]+2],o=[i[0]+2,i[1]-2],a=l.map.pixelToLonLat(s),n=l.map.pixelToLonLat(o),r=l.url+"?request=getfeature&version=1.0.0&maxfeatures=10&featureversion=0&featureid=&filter=&service=wfs&typename="+l.typeName+"&bbox="+a[0]+","+a[1]+","+n[0]+","+n[1],r=CGS_SDK_PATH+"proxy/proxy.jsp?address="+encodeURIComponent(r);$$.ajax({url:r,dataType:"xml",success:function(e){var t=e.children[0].children;if(1<t.length){for(var i=t[1],s=i.children[0].children[2].textContent,o=i.children[0].children[0].children[0].children[0].textContent.split(" "),a=[],n=0;n<o.length;n++){var r=o[n].split(",");a.push([parseFloat(r[0]),parseFloat(r[1])])}l.completeCallback&&l.completeCallback(s,a)}else l.completeCallback&&l.completeCallback(null)},error:function(e,t,i){console.info(e+"**"+t+"**"+i)}})})},CgsWFSQuery.prototype.deactivate=function(){this.featureclickoutId&&CgsSubPub.unsubscribe(this.featureclickoutId)},CgsArc=function(e){if(null==e.name?this.name="":this.name=e.name,null!=e.positions&&2==e.positions.length){this.positions=e.positions,null==e.fillColor?this.fillColor="rgba(0,153,255,1.0)":this.fillColor=e.fillColor,null==e.lineType&&(e.lineType=1),null==e.angle?this.angle=60:this.angle=e.angle,null==e.direction?this.direction="right":this.direction=e.direction,null==e.width?this.width=1:this.width=e.width,this.distanceDisplayCondition?this.distanceDisplayCondition=e.distanceDisplayCondition:this.distanceDisplayCondition=0;var t=0,i=0;e.positions[0][2]&&(t=e.positions[0][2]),e.positions[1][2]&&(i=e.positions[1][2]),e.positions=this.createPositions_();for(var s=0;s<e.positions.length;s++)e.positions[s].push((1-s/(e.positions.length-1))*t+s/(e.positions.length-1)*i);CgsFeature.call(this,e),1==window.WGMODEFLAG?(this.feature2D=new CgsLine2D(e),this.feature3D=new CgsLine3D(e)):2==window.WGMODEFLAG?this.feature2D=new CgsLine2D(e):3==window.WGMODEFLAG&&(this.feature3D=new CgsLine3D(e))}else console.info("the positions of the arc "+e.name+" is wrong!")},CgsInherits(CgsArc,CgsFeature),CgsArc.prototype.getCircleCoordinate_=function(e,t,i,s){if(2==window.WGMODEFLAG||1==window.WGMODEFLAG){var o,a,n,r,l,u,p,h=[],c=ol.proj.transform(e,"EPSG:4326","EPSG:102113")[0],g=ol.proj.transform(e,"EPSG:4326","EPSG:102113")[1],d=ol.proj.transform(t,"EPSG:4326","EPSG:102113")[0],m=ol.proj.transform(t,"EPSG:4326","EPSG:102113")[1];return h=i*i<((d-c)*(d-c)+(m-g)*(m-g))/4?[(c+d)/2,(g+m)/2]:c==d?(u=(g+m)/2,["right"==s?c+Math.sqrt(i*i-(m-g)/2*((m-g)/2)):c-Math.sqrt(i*i-(m-g)/2*((m-g)/2)),u]):g==m?(u=0,[(c+d)/2,u="right"==s?g-Math.sqrt(i*i-(d-c)/2*((d-c)/2)):g+Math.sqrt(i*i-(d-c)/2*((d-c)/2))]):0<=(l=(r=2*c*(a=(m-g)/(d-c))-2*(o=(d*d-c*c+m*m-g*g)/(2*(d-c)))*a-2*g)*r-4*(n=a*a+1)*(c*c-2*c*o+o*o+g*g-i*i))?(u=0,p=Math.sqrt(l),[o-a*(u="right"==s?d<c?(-r+p)/2/n:(-r-p)/2/n:d<c?(-r-p)/2/n:(-r+p)/2/n),u]):[(c+d)/2,(g+m)/2],ol.proj.transform(h,"EPSG:102113","EPSG:4326")}},CgsArc.prototype.getP2Angle_=function(e,t){var i=ol.proj.transform(e,"EPSG:4326","EPSG:102113")[0],s=ol.proj.transform(e,"EPSG:4326","EPSG:102113")[1],o=ol.proj.transform(t,"EPSG:4326","EPSG:102113")[0]-i,a=ol.proj.transform(t,"EPSG:4326","EPSG:102113")[1]-s,n=Math.sqrt(o*o+a*a);return 0==o?0==a?0:0<a?90:270:0<o?0==a?0:0<a?180/Math.PI*Math.asin(a/n):360+180/Math.PI*Math.asin(a/n):180-180/Math.PI*Math.asin(a/n)},CgsArc.prototype.createPositions_=function(){this.radiusOfInnerUints=this.getRadiusOfInnerUints_(this.positions[0],this.positions[1],this.angle),this.center=this.getCircleCoordinate_(this.positions[0],this.positions[1],this.radiusOfInnerUints,this.direction),this.coordinate=ol.proj.transform(this.center,"EPSG:4326","EPSG:102113"),"right"==this.direction?this.rotation=this.getP2Angle_(this.center,this.positions[1]):this.rotation=this.getP2Angle_(this.center,this.positions[0]),this.coordinates=[];for(var e=this.angle;0<=e;e--){var t=this.radiusOfInnerUints*Math.cos(e/180*Math.PI),i=this.radiusOfInnerUints*Math.sin(e/180*Math.PI),s=Math.cos(this.rotation/180*Math.PI)*t-Math.sin(this.rotation/180*Math.PI)*i,o=Math.cos(this.rotation/180*Math.PI)*i+Math.sin(this.rotation/180*Math.PI)*t;s+=this.coordinate[0],o+=this.coordinate[1];var a=ol.proj.transform([s,o],"EPSG:102113","EPSG:4326");this.coordinates.push(a)}return this.coordinates},CgsArc.prototype.getRadiusOfInnerUints_=function(e,t,i){var s=ol.proj.transform(e,"EPSG:4326","EPSG:102113")[0],o=ol.proj.transform(e,"EPSG:4326","EPSG:102113")[1],a=ol.proj.transform(t,"EPSG:4326","EPSG:102113")[0],n=ol.proj.transform(t,"EPSG:4326","EPSG:102113")[1];return Math.sqrt((a-s)*(a-s)+(n-o)*(n-o))/2/Math.sin(i/2/180*Math.PI)},CgsArc.prototype.setPosition=function(e){var t;CgsUtil.verifyLonLat(e)?(this.positions=e,t=this.createPositions_(),this.feature3D&&this.feature3D.setPosition(t),this.feature2D&&this.feature2D.setPosition(t)):console.error("Illegal Parameter,Lng or Lat NOT Within Range, position:"+e)},CgsArc.prototype.getPosition=function(){return this.positions},CgsArc.prototype.setFillColor=function(e){var t;this.feature3D&&this.feature3D.setFillColor(e),this.feature2D&&(t=ol.color.asString(e),this.feature2D.setFillColor(t))},CgsArc.prototype.getFillColor=function(){return this.feature3D?this.feature3D.getFillColor():this.feature2D?this.feature2D.getFillColor():void 0},CgsArc.prototype.setWidth=function(e){this.feature3D&&this.feature3D.setWidth(e),this.feature2D&&this.feature2D.setWidth(e)},CgsArc.prototype.getWidth=function(){return this.feature3D?this.feature3D.getWidth():this.feature2D?this.feature2D.getWidth():void 0},CgsArc.prototype.setAngle=function(e){this.angle=e;var t=this.createPositions_();this.feature3D&&this.feature3D.setPosition(t),this.feature2D&&this.feature2D.setPosition(t)},CgsArc.prototype.getAngle=function(){return this.angle},CgsArc.prototype.setDirection=function(e){this.direction=e;var t=this.createPositions_();this.feature3D&&this.feature3D.setPosition(t),this.feature2D&&this.feature2D.setPosition(t)},CgsArc.prototype.getDirection=function(){return this.direction},CgsArc.prototype.getPointInLine=function(e){if(this.feature3D)return this.feature3D.getPointInLine(e)},CgsArc.prototype.setVisibleHeight=function(e){this.feature3D&&this.feature3D.setVisibleHeight(e)},CgsArc.prototype.getVisibleHeight=function(){if(this.feature3D)return this.feature3D.getVisibleHeight()},CgsArc.prototype.setProperty=function(name,value){if("name"==name)this.setName(value);else if("show"==name)this.setVisible(value);else if("drag"==name)this.setDragEnable(value);else if("position"==name){var pp=[];try{pp=eval(value)}catch(e){CgsTipsWindow.showLog("输入格式错误，请重新输入！")}this.setPosition(pp)}else if("fillColor"==name)this.setFillColor(value);else if("width"==name)this.setWidth(parseFloat(value));else if("visibleHeight"==name){var pp;try{pp=eval(value)}catch(e){return void CgsTipsWindow.showLog("输入格式错误！")}this.setVisibleHeight(pp)}},CgsArc.prototype.getPropertyString=function(){var e=[];return e.push({type:"input",label:"id",name:"id",value:this.getId(),readonly:!0},{type:"input",label:"名称",name:"name",value:this.getName()},{type:"checkbox",label:"显示",name:"show",value:this.getVisible()},{type:"checkbox",label:"拖拽",name:"drag",value:this.getDragEnable()},{type:"title",label:"线"},{type:"hline"},{type:"input",label:"位置",name:"position",value:CgsFeature.traverse(this.getPosition())},{type:"slider",label:"宽度",name:"width",min:1,max:72,defaultValue:this.getWidth(),fixedNumber:2},{type:"hline"},{type:"cesiumColor",label:"颜色",name:"fillColor",data:this.getFillColor()},{type:"cesiumVisibleHeight",name:"visibleHeight",value:this.getVisibleHeight()}),e},CgsArc.prototype.save=function(){return _defineProperty({name:this.getName(),show:this.getVisible(),positions:this.getPosition(),fillColor:this.getFillColor(),width:this.getWidth(),angle:this.getAngle()},"width",this.getDirection())},CgsArc.load=function(e,t){var i=new CgsArc(t);e.addFeature(i)};var CgsRoute=function(e){var t=0<arguments.length&&void 0!==e?e:{};this.vehicle=t.vehicle||"car",this.elevation=t.elevation||!1,this.weighting=t.weighting||"fastest",this.use_miles=t.use_miles||!1,this.locale="zh-CN",this.fromPoint=t.fromPoint||null,this.toPoint=t.toPoint||null,this.passPointArray=t.passPointArray||[],this.serverUrl=t.serverUrl||"http://localhost:8989/route/?",this.blockArea=t.blockArea||[],this.blockPoints=t.blockPoints||[]};CgsRoute.prototype.addPassPoint=function(e){e&&this.pointList.push(e)},CgsRoute.prototype.setFromPoint=function(e){this.fromPoint=e},CgsRoute.prototype.setToPoint=function(e){this.toPoint=e},CgsRoute.prototype.setPassPointArray=function(e){this.passPointArray=e},CgsRoute.prototype.setWeighting=function(e){this.weighting=e},CgsRoute.prototype._buildPointArray=function(){var e=[this.fromPoint].concat(_toConsumableArray(this.passPointArray));return e.push(this.toPoint),e},CgsRoute.prototype._pointToString=function(e){var t=null;return null==e?t="":e instanceof Array?t=e[1]+","+e[0]:e.hasOwnProperty("lon")&&e.hasOwnProperty("lat")?t=e.lat+","+e.lon:e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&(t=e.y+","+e.x),t},CgsRoute.prototype._addBlockArea=function(e){this.blockArea.push(e)},CgsRoute.prototype._doRequest=function(){var n=this;return new Promise(function(t,i){var s="";n._buildPointArray().forEach(function(e){return s+="point="+n._pointToString(e)+"&"});var o="";n.blockArea.forEach(function(e){return o+=e[0][1]+","+e[0][0]+","+e[1][1]+","+e[1][0]+";"}),n.blockPoints.forEach(function(e){return o+=e[1]+","+e[0]+";"});var e=""+n.serverUrl+s+"type=json&locale="+n.locale+"&vehicle="+n.vehicle+"&weighting="+n.weighting+"&elevation="+n.elevation+"&use_miles="+n.use_miles+"&block_area="+o,a=new XMLHttpRequest;a.open("GET",e),a.responseType="json",a.send(),a.onload=function(e){return 200==a.status?t(a.response.paths):i(a.response.message)},a.onerror=function(e){return i(a.response.message)}})},CgsRoute.prototype._buildRoute=function(e,t){if(!e)return t;var i=e[0],s=i.distance,o=i.time,a=i.instructions,n=i.points,r=this._decodePath(n,!1),l={distance:s,time:o,points:r};l.weighting=this.weighting,l.parts=[];for(var u=0,p=a.length;u<p;u++){var h=a[u],c=h.distance,g=h.sign,d=h.time,m=h.text,f=h.street_name,C=h.interval,y=r.slice(C[0],C[1]+1);l.parts.push({distance:c,sign:g,time:d,text:m,street_name:f,path:y,interval:C})}return l},CgsRoute.prototype.navigate=function(){var t=this;return this._doRequest().then(function(e){return t._buildRoute(e)}).catch(function(e){return t._buildRoute(!1,e)})},CgsRoute.prototype._decodePath=function(e,t){for(var i=e.length,s=0,o=[],a=0,n=0,r=0;s<i;){for(var l,u=0,p=0;p|=(31&(l=e.charCodeAt(s++)-63))<<u,u+=5,32<=l;);for(a+=1&p?~(p>>1):p>>1,p=u=0;p|=(31&(l=e.charCodeAt(s++)-63))<<u,u+=5,32<=l;);if(n+=1&p?~(p>>1):p>>1,t){for(p=u=0;p|=(31&(l=e.charCodeAt(s++)-63))<<u,u+=5,32<=l;);r+=1&p?~(p>>1):p>>1,o.push([1e-5*n,1e-5*a,r/100])}else o.push([1e-5*n,1e-5*a])}return o},CgsSampleAltitude=function(e){this.map=Cesium.defaultValue(e&&e.map,window.map),this.scene=this.map.map3D.scene},CgsSampleAltitude.prototype.sampleAltitude=function(e){this.scene.sampleHeightSupported||console.log("当前浏览器不支持模糊计算高程功能");var t=new Cesium.Cartographic.fromDegrees(e[0],e[1]),i=this.scene.sampleHeight(t);return[e[0],e[1],i]},CgsSampleAltitude.prototype.sampleAltitudeMostDetailed=function(e){this.scene.sampleHeightSupported||console.log("当前浏览器不支持模糊计算高程功能");var t=[];return e.forEach(function(e){t.push(new Cesium.Cartographic.fromDegrees(e[0],e[1]))}),this.scene.sampleHeightMostDetailed(t)},CgsSampleAltitude.prototype.sampleTerrain=function(e,t,i){var s=[];return i.forEach(function(e){s.push(Cesium.Cartographic.fromDegrees(e[0],e[1]))}),Cesium.sampleTerrain(e,t,s)},CgsSampleAltitude.prototype.sampleTerrainMostDetailed=function(e,t){var i=[];return t.forEach(function(e){i.push(new Cesium.Cartographic(e[0],e[1]))}),Cesium.sampleTerrainMostDetailed(e,i)},CgsGroundMeasure=function(e){1!==window.WGMODEFLAG&&3!==window.WGMODEFLAG||(this.measure=new CgsGroundMeasure3D(e))},CgsGroundMeasure.prototype.groundMeasureCoordinate=function(e){this.measure.groundMeasureCoordinate(e)},CgsGroundMeasure.prototype.groundMeasureHeight=function(e){this.measure.groundMeasureHeight(e)},CgsGroundMeasure.prototype.groundMeasureDistance=function(e){this.measure.groundMeasureDistance(e)},CgsGroundMeasure.prototype.groundMeasurePerimeter=function(e){this.measure.groundMeasurePerimeter(e)},CgsGroundMeasure.prototype.groundMeasureArea=function(e){this.measure.groundMeasureArea(e)},CgsGroundMeasure.prototype.groundMeasureVolume=function(e){this.measure.groundMeasureVolume(e)},CgsGroundMeasure.prototype.removeAllGroundMeasure=function(e){this.measure.removeAllGroundMeasure(e)},CgsHeatMap=function(e){this.map=e.map;this.canvasInfo={size:{w:4096,h:2048}};var t=$$('<div id="heatMap" style="width:'+this.canvasInfo.size.w+"px; height:"+this.canvasInfo.size.h+'px; position:relative; top:0px; left:0px; display: none;"></div>');this.divRoot=t,this.heatMapLayer2D=null,this.heatMapLayer3D=null,$$("body").append(t),this.img=null,this.heatMapJs=h337,this.data=e.data,e.radius=void 0===e.radius?15:e.radius,this.options=Object.assign({container:t[0]},e),this.heatMapInstance=this.heatMapJs.create(this.options)},CgsHeatMap.prototype.reDraw=function(){var t=this;return this.refreshData(this.data),new Promise(function(e){t.refreshCanvas().then(function(){t.refreshImageLayer()})})},CgsHeatMap.prototype.refreshData=function(e){var t=[],i=e.data,s=this.canvasInfo.size,o=(s.w,s.h,this.heatMapInstance._config.radius),a=(new Cesium.GeographicProjection,this.getDataExtent(i));this.dataExtent=a;for(var n=ol.proj.transform([a[0],a[1]],"EPSG:4326","EPSG:102113"),r=ol.proj.transform([a[2],a[3]],"EPSG:4326","EPSG:102113"),l=(r[0]-n[0])/s.w,u=(r[1]-n[1])/s.h,p=0;p<i.length;++p){var h=i[p],c=ol.proj.transform([h.x,h.y],"EPSG:4326","EPSG:102113");t.push({x:(c[0]-n[0])/l,y:(-c[1]+r[1])/u,value:h.value,radius:h.radius?h.radius:o})}this.heatMapInstance.setData({max:e.max,data:t})},CgsHeatMap.prototype.setData=function(e){var t=this.heatMapInstance._config.valField?this.heatMapInstance._config.valField:this.heatMapInstance._config.defaultValueField,i=_.maxBy(e.data,t),s=_.minBy(e.data,t);e.max=e.max?e.max:i[t],e.min=e.min?e.min:s[t],this.data=e},CgsHeatMap.prototype.setConfigs=function(e){return e.radius||(e.radius=this.heatMapInstance._config.radius+.001),this.heatMapInstance.configure(e),this.reDraw()},CgsHeatMap.prototype.refreshImageLayer=function(){var e=this;e.map.map2D&&(e.heatMapLayer2D?e.heatMapLayer2D.setSource(new ol.source.ImageStatic({url:e.img,imageExtent:this.dataExtent,projection:"EPSG:4326"})):(e.heatMapLayer2D=new ol.layer.Image({source:new ol.source.ImageStatic({url:e.img,imageExtent:this.dataExtent,projection:"EPSG:4326"})}),e.map.map2D.addLayer(e.heatMapLayer2D))),e.map.map3D&&(e.heatMapLayer3D&&e.map.map3D.removeLayer(e.heatMapLayer3D),e.heatMapLayer3D=new CgsImageLayer3D({name:"heatmap"+CgsUtil.createGuid(),url:e.img,rec:this.dataExtent}),e.map.map3D.addLayer(e.heatMapLayer3D),e.heatMapLayer3D.setVisible(!0))},CgsHeatMap.prototype.refreshCanvas=function(){var s=this;return new Promise(function(i){s.heatMapInstance._renderer.canvas.toBlob(function(e){var t=window.URL.createObjectURL(e);s.img=t,i()})})},CgsHeatMap.prototype.setVisible=function(e){this.heatMapLayer2D&&this.heatMapLayer2D.setVisible(e),this.heatMapLayer3D&&this.heatMapLayer3D.setVisible(e)},CgsHeatMap.prototype.remove=function(){this.map.map2D&&this.heatMapLayer2D&&this.map.map2D.removeLayer(this.heatMapLayer2D),this.map.map3D&&this.heatMapLayer3D&&this.map.map3D.removeLayer(this.heatMapLayer3D),$$(this.divRoot).remove()},CgsHeatMap.prototype.setColorParam=function(){},CgsHeatMap.prototype.getDataExtent=function(e){for(var t=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=0,n=e.length;a<n;a++)var r=e[a],t=r.x<t?r.x:t,i=r.y<i?r.y:i,s=r.x>s?r.x:s,o=r.y>o?r.y:o;return[t,i,s,o]};var env=window;CgsSubPub.subscribe(CgsEvent.eMapInstanceCreated,function(e,t){!function(e){var t=e.container,i=$$('<div class="CgsAEffectLevel" style=""></div>');i.css({position:"absolute","pointer-events":"none",top:"0",left:"0"}),$$(t).append(i);var s=Cgszrender.init(i[0],{renderer:"canvas",width:$$(t).width(),height:$$(t).height()});window.ss=s,CgsAEffect.zz=s,CgsAEffect.map=e,$$(window).on("resize",_.throttle(CgsAEffect.resize,1e3))}(t)}),CgsAEffect=function(){function s(){}return s.eElReDraw="eElReDraw",s.resize=function(){var e=s.map.container,t=s.zz,i={width:$$(e).width(),height:$$(e).height()};t.resize(i),CgsSubPub.publish(s.eElReDraw)},s.zz=null,s.map=null,s}(),CgsLocateEffect=function(e){var t,i,s=CgsAEffect.call(this)||this;if(s.updatePosEv=null,s.eMapModeChanged=null,s.eElReDraw=null,s.zCtx=null,s.map=null,s.pos=[0,0,0],s.pixelPos=null,s.locateObject=null,s.animeTime=240,s.animeTurn=2,s.hidePart="locateEffectGroup",s.hideTime=200,s.visible=!0,s.focusShow=!1,_.assign(s,e),!s.map)throw"map 是必传参数";return s.pixelPos||((t=s.locateObject)instanceof CgsFeature?s.pos=t.getPosition():(1==window.WGMODEFLAG||3==window.WGMODEFLAG)&&t instanceof Cesium.Entity?(i=CgsUtil.getPositionFromEntity(t),s.pos=[i.lon,i.lat,i.height]):console.log("未实现"),s.pixelPos=s.map.lonLatToPixel(s.pos)),s},CgsUtil.__extends(CgsLocateEffect,CgsAEffect),CgsLocateEffect.drawEffect=function(e){var t=e.zCtx=CgsLocateEffect.zz,i=e.locateEffectGroup=new Cgszrender.Group;t.add(i);var s=e.lineGroup=new Cgszrender.Group;i.add(s);var o=e.rectGroup=new Cgszrender.Group;i.add(o);var a,n,r,l,u,p,h,c,g;e.focusShow?(p=[0,0],h=50,(a=e.rect3=new Cgszrender.Polyline({shape:{points:[[p[0],p[1]+h/3],p,[p[0]+h,p[1]],[p[0]+h,p[1]+h],[p[0],p[1]+h],[p[0],p[1]+h/3]]},style:{stroke:"yellow",lineDash:[h/3*2,h/3*1],lineWidth:2}})).attr("origin",[h/2,h/2]),a.attr("position",[-h/2,-h/2]),a.attr("scale",[5,5]),o.add(a),n={stroke:"#FFFFFF",lineDash:[4,4],lineWidth:2},p=[0,0],r=t.painter.getWidth(),l=t.painter.getHeight(),s.add(new Cgszrender.Line({shape:{x1:p[0]+20,y1:p[0],x2:p[0]+r,y2:p[0]},style:n})),s.add(new Cgszrender.Line({shape:{x1:p[0]-20,y1:p[0],x2:p[0]-r,y2:p[0]},style:n})),s.add(new Cgszrender.Line({shape:{x1:p[0],y1:p[0]-20,x2:p[0],y2:p[0]-l},style:n})),s.add(new Cgszrender.Line({shape:{x1:p[0],y1:p[0]+20,x2:p[0],y2:p[0]+l},style:n}))):(n={stroke:"#FFFFFF",lineDash:[4,4],lineWidth:2},p=[0,0],r=t.painter.getWidth(),l=t.painter.getHeight(),s.add(new Cgszrender.Line({shape:{x1:p[0]+20,y1:p[0],x2:p[0]+r,y2:p[0]},style:n})),s.add(new Cgszrender.Line({shape:{x1:p[0]-20,y1:p[0],x2:p[0]-r,y2:p[0]},style:n})),s.add(new Cgszrender.Line({shape:{x1:p[0],y1:p[0]-20,x2:p[0],y2:p[0]-l},style:n})),s.add(new Cgszrender.Line({shape:{x1:p[0],y1:p[0]+20,x2:p[0],y2:p[0]+l},style:n})),(u=new Cgszrender.Rect({shape:{width:40,height:40},style:{fill:"transparent",lineWidth:2,stroke:"white"}})).attr("origin",[20,20]),u.attr("position",[-20,-20]),o.add(u),p=[0,0],h=46,(c=new Cgszrender.Polyline({shape:{points:[[p[0],p[1]+h/3],p,[p[0]+h,p[1]],[p[0]+h,p[1]+h],[p[0],p[1]+h],[p[0],p[1]+h/3]]},style:{stroke:"white",lineDash:[h/3*2,h/3*1],lineWidth:2}})).attr("origin",[h/2,h/2]),c.attr("position",[-h/2,-h/2]),o.add(c),p=[0,0],h=68,(g=e.rect2=new Cgszrender.Polyline({shape:{points:[[p[0],p[1]+h/3],p,[p[0]+h,p[1]],[p[0]+h,p[1]+h],[p[0],p[1]+h],[p[0],p[1]+h/3]]},style:{stroke:"white",lineDash:[h/3*2,h/3*1],lineWidth:2}})).attr("origin",[h/2,h/2]),g.attr("position",[-h/2,-h/2]),g.attr("scale",[.2,.2]),o.add(g)),i.hide()},CgsLocateEffect.create=function(e){var s=new CgsLocateEffect(e);return e.focusShow&&(s.focusShow=e.focusShow),CgsLocateEffect.drawEffect(s),CgsLocateEffect.on2DUpdatePos.call(s),s.setVisible(s.visible),CgsLocateEffect.switchUpdatePosByMapMode(s),s.eMapModeChanged=CgsSubPub.subscribe(CgsEvent.eMapModeChanged,function(e,t,i){CgsLocateEffect.switchUpdatePosByMapMode(s)}),s.eElReDraw=CgsSubPub.subscribe(CgsAEffect.eElReDraw,function(){s._reDraw()}),s},CgsLocateEffect.on3DUpdatePos=function(){var e,t=this.map;this.visible&&(CgsUtil.map3DCheckPositionIfVisible(t.map3D,this.pos)?(this.locateEffectGroup.show(),e=this.pixelPos=t.lonLatToPixel(this.pos),this.locateEffectGroup.attr("position",e)):this.locateEffectGroup.hide())},CgsLocateEffect.on2DUpdatePos=function(){var e=this.map,t=this.pixelPos=e.lonLatToPixel(this.pos);this.locateEffectGroup.attr("position",t)},CgsLocateEffect.switchUpdatePosByMapMode=function(e){var t=e.map,i=e.updatePosEv;t.is3d()?(i&&t.map2D.unByKey(i),i=CgsLocateEffect.on3DUpdatePos.bind(e),t.map3D.scene.postRender.addEventListener(i)):(i&&t.map3D.scene.postRender.removeEventListener(i),e.locateEffectGroup.show(),i=t.map2D.on("postcompose",CgsLocateEffect.on2DUpdatePos.bind(e))),e.updatePosEv=i},CgsLocateEffect.prototype._reDraw=function(){this.zCtx.remove(this.locateEffectGroup),CgsLocateEffect.drawEffect(this)},CgsLocateEffect.prototype.setVisible=function(e){(this.visible=e)?(this.lineGroup.setChildsAttr("style",{opacity:1}),this.lineGroup.show(),this.rectGroup.setChildsAttr("style",{opacity:1}),this.rectGroup.show(),this.locateEffectGroup.show()):this.locateEffectGroup.hide()},CgsLocateEffect.prototype.rePlayAnime=function(){var o=this;return o.setVisible(!0),this.locateEffectGroup.attr("position",this.pixelPos),o.focusShow?new Promise(function(e){function i(){return new Promise(function(e){t.animateTo({rotation:0,scale:[1,1]},s,0,function(){t.animateTo({rotation:0,scale:[1,1]},s,0,function(){t.attr("rotation",0),e()})})})}var t,s;t=o.rect3,s=o.animeTime,t.show(),CgsUtil.promiseFlow(function(){for(var e=[],t=0;t<1;t++)e.push(i);return e}(o.animeTurn)).then(function(){o.rect3.hide(),o.rect3.attr("scale",[5,5]),e()})}):new Promise(function(e){function s(){return new Promise(function(e){t.animateTo({rotation:-3.14,scale:[1,1]},i,0,function(){t.animateTo({rotation:-6.28,scale:[.2,.2]},i,0,function(){t.attr("rotation",0),e()})})})}var t,i;t=o.rect2,i=o.animeTime,t.show(),CgsUtil.promiseFlow(function(e){for(var t=[],i=0;i<e;i++)t.push(s);return t}(o.animeTurn)).then(function(){o.rect2.hide(),e()})})},CgsLocateEffect.prototype.animeHide=function(){var t=this,i=t[t.hidePart];return new Promise(function(e){i.setChildsAttrWithAnime({attr:{style:{opacity:0}},animeTime:t.hideTime}).then(function(){i.hide(),e()})})},CgsLocateEffect.prototype.destroy=function(){var e=this;CgsUtil.tryNoThrow(function(){map.map2D.unByKey(e.updatePosEv)}),CgsUtil.tryNoThrow(function(){map.map3D.scene.postRender.removeEventListener(e.updatePosEv)}),CgsSubPub.unsubscribe(e.eMapModeChanged),CgsSubPub.unsubscribe(e.eElReDraw),e.zCtx.remove(e.locateEffectGroup)},CgsDrawByMouse=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var i=this;this.map=e.map,this.mode=CgsDrawByMouse.PointMode,this.createOptions=null,this.onDrawEnd=null,this.onCancel=null,this.editPointStyle=e.editPointStyle||{name:"",labelfont:"10px 微软雅黑",fillColor:"blue",pixelSize:10},_.assign(this,e),this.isActivate=!1,this.pointerHandle=null,this.group=this.map.getFeatureGroupByName("drawByMouse"),this.overlays=[],this.group||(this.group=new CgsFeatureGroup("drawByMouse"),this.map.addFeatureGroup(this.group)),CgsSubPub.subscribe(CgsEvent.eMapModeChanged,function(e,t){i.deactivate()}),this.switchMode(this.mode)}),CgsDrawByMouse.prototype.activate=function(){var a,n,e;this.isActivate||(this.isActivate=!0,a=this.mode,n=a.ins.map,a.onActive&&a.onActive(a),"3D"===n.mode?(this.evs=CgsUtil.getInputHandles(n.map3D),(e=function(s,e,o){return s&&n.map3D.screenSpaceEventHandler.setInputAction(function(e){var t=[e[o].x,e[o].y],i=n.pixelToLonLat(t);i&&s(a,i,t)},e)})(a.onLeftClick,Cesium.ScreenSpaceEventType.LEFT_CLICK,"position"),e(a.onLeftDbClick,Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK,"position"),e(a.onRightClick,Cesium.ScreenSpaceEventType.RIGHT_CLICK,"position"),e(a.onMove,Cesium.ScreenSpaceEventType.MOUSE_MOVE,"endPosition")):(this.pointerHandle&&n.map2D.removeInteraction(this.pointerHandle),this.pointerHandle=new ol.interaction.Pointer({handleEvent:function(e){var t=e.pixel,i=n.pixelToLonLat(t);return"click"===e.type?0===e.pointerEvent.button&&a.onLeftClick&&a.onLeftClick(a,i,t,e):"pointerdown"===e.type?2===e.pointerEvent.button&&a.onRightClick&&a.onRightClick(a,i,t,e):"dblclick"===e.type?0===e.pointerEvent.button&&a.onLeftDbClick&&a.onLeftDbClick(a,i,t,e):"pointermove"===e.type&&a.onMove&&a.onMove(a,i,t,e),!0}}),n.map2D.addInteraction(this.pointerHandle)))},CgsDrawByMouse.prototype.deactivate=function(){var e,t;this.isActivate&&(this.isActivate=!1,e=this.mode,t=this.map,e&&e.onDeactivate&&e.onDeactivate(e),"3D"===t.mode?CgsUtil.restoreInputHandles(t.map3D,this.evs):this.pointerHandle&&t.map2D.removeInteraction(this.pointerHandle))},CgsDrawByMouse.prototype.switchMode=function(e){var t=this.isActivate;this.deactivate(),this.mode=e,(this.mode.ins=this).createOptions&&(this.mode.createOptions=this.createOptions),t&&this.activate()},CgsDrawByMouse.prototype.getCreateOptions=function(){return this.createOptions},CgsDrawByMouse.prototype.setCreateOptions=function(e){this.createOptions=e},CgsDrawByMouse.prototype.getOnDrawEnd=function(){return this.onDrawEnd},CgsDrawByMouse.prototype.setOnDrawEnd=function(e){this.onDrawEnd=e},CgsDrawByMouse.prototype.getOnCancel=function(){return this.onDrawEnd},CgsDrawByMouse.prototype.setOnCancel=function(e){this.onCancel=e},CgsDrawByMouse.prototype.removeAll=function(){var t=this.map;this.mode.onCancel(this.mode),t.removeFeatureGroup(this.group),this.group.removeAllFeatures(),_.each(this.overlays,function(e){return t.removeOverlay(e)}),this.overlays=[]},CgsDrawByMouse.removeItemByFeature=function(e){var t,i=e.getMap();i&&(t=e.__drawByMouseObjs.temps||[],_.each(t,function(e){"aaToolTip"===e.type&&e.destroy()}),i.removeFeature(e))},CgsDrawByMouse.isDoubleClick=function(e,t){var i=!1,s=new Date;return s-e[t]<200&&(i=!0),e[t]=s,i},CgsDrawByMouse.createDrawMode=function(e){var t={name:"未命名的模式",ins:null,temp:{},createOptions:{},state:{isDrawing:!1,points:[],feature:null,features:{},leftClickLastTime:new Date,needPopLats:!1,isLeftDbClick:!1},restoreState:function(e){e.state=_.cloneDeep(e._stateStart)},onActive:null,onDeactivate:function(e){e.state.isDrawing?e.onCancel(e):e.restoreState(e)},onCancel:function(e){var t=e.ins,i=e.state,s=_.concat(i.feature,_.values(i.features));e.hideEdit(t,i.feature),_.each(s,function(e){e&&(t.map.removeFeature(e),t.group.removeFeature(e))}),e.restoreState(e),t.onCancel&&t.onCancel()},onLeftClick:null,onLeftDbClick:null,onRightClick:function(e){e.onCancel(e)},onMove:null};return t.temp.originMode=_.cloneDeep(t),_.merge(t,e),t._stateStart=_.cloneDeep(t.state),t},CgsDrawByMouse.createAndAddToMap=function(e,t,i,s){var o=new t(i);return e.map.addFeature(o),s||e.group.addFeature(o),o},CgsDrawByMouse.drawEnd=function(e,t){var i=e.mode;_.set(t,"__drawByMouseObjs.CgsDrawByMouseIns",e),i.showEdit&&_.set(t,"__drawByMouseObjs.showEdit",i.showEdit.bind(t)),i.hideEdit&&_.set(t,"__drawByMouseObjs.hideEdit",i.hideEdit.bind(t)),e.onDrawEnd&&e.onDrawEnd(t),CgsSubPub.publish("featureDrawnByMouse",[t,e])},CgsDrawByMouse.featureAddDragPoint=function(e,i,t,s,o,a){var n=e.map,r=_.get(i,"__drawByMouseObjs.editTempFeatures",[]),l={pixelSize:6,labelfont:"10px 微软雅黑",fillColor:"rgba(0,255,0,1)"};3===t.length&&t.pop(),l.position=t,l.name=CgsDrawByMouse.geoPosToString(t);var u=new CgsPoint(l);return n.addFeature(u),u.feature3D.dragPointFlag=!0,u.feature2D.dragPointFlag=!0,r.push(u),u.setDragEnable(!1),u.__lastPos=t,CgsUtil.funcAfter(u.feature3D,"setPosition",u.feature3D,function(){var e,t=u.getPosition();u.setName(CgsDrawByMouse.geoPosToString(t)),a?a(u,u.__lastPos):"CgsPoint"===i.getType()?i.setPosition(t):(e=i.getPosition(),o?(1==e.length&&(e=e[0]),e=_.set(e,"["+s+"]",t),i.setPosition([e])):(e=_.set(e,"["+s+"]",t),i.setPosition(e))),i.mouseOnEditEnd&&i.mouseOnEditEnd(),u.__lastPos=u.getPosition()}),_.set(i,"__drawByMouseObjs.editTempFeatures",r),u},CgsDrawByMouse.featureHideEdit=function(e){var t,i;e&&e.map&&(t=e.map,i=_.get(e,"__drawByMouseObjs.editTempFeatures",[]),_.each(i,function(e){return t.removeFeature(e)}),_.set(e,"__drawByMouseObjs.editTempFeatures",[]))},CgsDrawByMouse.geoPosToString=function(e){return CgsUtil.getLonLatTextFromPos(e,{buildText:!0,middleText:"  ",format:1,spaceTxt:" "}).text},CgsDrawByMouse.PointMode=CgsDrawByMouse.createDrawMode({name:"画点模式",createOptions:{name:"",fillColor:"blue",pixelSize:5},onLeftClick:function(e,t){var i=e.ins,s=(e.state,e.createOptions);s.position=t;var o=CgsDrawByMouse.createAndAddToMap(i,CgsPoint,s);CgsDrawByMouse.drawEnd(i,o)},showEdit:function(i,s){_.get(s,"__drawByMouseObjs.isEditMode",!1)?console.log("已经时编辑模式了"):(_.set(s,"__drawByMouseObjs.isEditMode",!0),CgsDrawByMouse.editModeOnClickOut(),CgsDrawByMouse.featureArrWithEditModeActived.push(s),_.get(s,"__drawByMouseObjs.editTempFeatures",[]),_.each([s.getPosition()],function(e,t){CgsDrawByMouse.featureAddDragPoint(i,s,e,t).setDragEnable(!0)}))},hideEdit:function(e,t){t&&(_.set(t,"__drawByMouseObjs.isEditMode",!1),CgsDrawByMouse.featureHideEdit(t),t.mouseOnEditHide&&t.mouseOnEditHide())}}),CgsDrawByMouse.LineMode=CgsDrawByMouse.createDrawMode({name:"画线模式",state:{needtPoint:!0},createOptions:{fillColor:"rgba(0,153,255,1.0)"},onLeftClick:function(e,t){var i,s,o=e.ins.map,a=e.ins,n=e.state,r=e.createOptions,l=n.points.length;0===l?(n.points.push(t),r.positions=_.cloneDeep([t,t]),n.feature=CgsDrawByMouse.createAndAddToMap(a,CgsLine,r),n.feature.feature3D&&n.feature.feature3D._posUpdateCallback(!1),n.isDrawing=!0,n.needtPoint&&((i=_.cloneDeep(a.editPointStyle)).position=t,n.features.tPont=new CgsPoint(i),o.addFeature(n.features.tPont))):1<=l&&(s=n.points.pop(),n.points.push(t),n.feature.setPosition(n.points),n.points.push(s)),CgsDrawByMouse.featureAddDragPoint(a,n.feature,t,l)},onLeftDbClick:function(e){var t=e.ins.map,i=e.ins,s=e.state;if(s.isLeftDbClick=!0,!s.isDrawing)return 0;s.isDrawing=!1,s.feature.feature3D&&s.feature.feature3D._posUpdateCallback(!0),s.points.length<3||(s.points.pop(),s.points.pop()),s.feature.setPosition(s.points),s.features.tPont&&t.removeFeature(s.features.tPont),e.hideEdit(i,s.feature),e.restoreState(e),CgsDrawByMouse.drawEnd(i,s.feature)},onMove:function(e,t){e.ins;var i=e.state;if(!i.isDrawing)return 0;i.needPopLats?i.points.pop():i.needPopLats=!0,i.points.push(t),i.feature.setPosition(_.cloneDeep(i.points)),i.features.tPont&&(i.features.tPont.setPosition(t),i.features.tPont.setName(CgsDrawByMouse.geoPosToString(t)))},showEdit:function(i,s){_.get(s,"__drawByMouseObjs.isEditMode",!1)||(_.set(s,"__drawByMouseObjs.isEditMode",!0),CgsDrawByMouse.editModeOnClickOut(),CgsDrawByMouse.featureArrWithEditModeActived.push(s),_.get(s,"__drawByMouseObjs.editTempFeatures",[]),_.each(s.getPosition(),function(e,t){CgsDrawByMouse.featureAddDragPoint(i,s,e,t).setDragEnable(!0)}))},hideEdit:function(e,t){t&&(_.set(t,"__drawByMouseObjs.isEditMode",!1),CgsDrawByMouse.featureHideEdit(t),t.mouseOnEditHide&&t.mouseOnEditHide())}}),CgsDrawByMouse.PolygonMode=CgsDrawByMouse.createDrawMode({name:"多边形模式",state:{},onLeftClick:function(e,t){var i,s,o=e.ins,a=o.map,n=e.state,r=e.createOptions,l=n.points.length;0===l?(n.points.push(t),r.positions=_.cloneDeep([t,t]),n.feature=CgsDrawByMouse.createAndAddToMap(o,CgsPolygon,r),n.feature.feature3D&&n.feature.feature3D._posUpdateCallback(!1),n.isDrawing=!0,(i=_.cloneDeep(o.editPointStyle)).position=t,n.features.tPont=new CgsPoint(i),a.addFeature(n.features.tPont)):1<=l&&(s=n.points.pop(),n.points.push(t),n.feature.setPosition(n.points),n.points.push(s)),CgsDrawByMouse.featureAddDragPoint(o,n.feature,t,l)},onLeftDbClick:function(e){var t=e.ins,i=t.map,s=e.state;e.createOptions;if(s.isLeftDbClick=!1,!s.isDrawing)return 0;s.isDrawing=!1,s.feature.feature3D&&s.feature.feature3D._posUpdateCallback(!0),s.points.length<3||(s.points.pop(),s.points.pop()),s.feature.setPosition(s.points),i.removeFeature(s.features.tPont),e.hideEdit(t,s.feature),e.restoreState(e),CgsDrawByMouse.drawEnd(t,s.feature)},onMove:function(e,t){e.ins;var i=e.state;if(!i.isDrawing)return 0;i.needPopLats?i.points.pop():i.needPopLats=!0,i.points.push(t),i.feature.setPosition(_.cloneDeep(i.points)),i.features.tPont.setPosition(t),i.features.tPont.setName(CgsDrawByMouse.geoPosToString(t))},showEdit:function(e,t){if(!_.get(t,"__drawByMouseObjs.isEditMode",!1)){_.set(t,"__drawByMouseObjs.isEditMode",!0),CgsDrawByMouse.editModeOnClickOut(),CgsDrawByMouse.featureArrWithEditModeActived.push(t);_.get(t,"__drawByMouseObjs.editTempFeatures",[]);var i=t.getPosition();1==i.length&&(i=i[0]);for(var s=0;s<i.length;s++){CgsDrawByMouse.featureAddDragPoint(e,t,i[s],s,!0).setDragEnable(!0)}}},hideEdit:function(e,t){t&&(_.set(t,"__drawByMouseObjs.isEditMode",!1),CgsDrawByMouse.featureHideEdit(t),t.mouseOnEditHide&&t.mouseOnEditHide())}}),CgsDrawByMouse.RectangleMode=CgsDrawByMouse.createDrawMode({name:"矩形模式",state:{},onLeftClick:function(e,t){var i=e.ins,s=i.map,o=e.state,a=e.createOptions;o.needPopLats=!1,o.points.push(t);var n,r=o.points.length;1===r?(a.positions=[t,t],o.feature=CgsDrawByMouse.createAndAddToMap(i,CgsRect,a),o.feature.feature3D&&o.feature.feature3D._posUpdateCallback(!1),o.isDrawing=!0,(n=_.cloneDeep(i.editPointStyle)).position=t,o.features.tPont=new CgsPoint(n),s.addFeature(o.features.tPont),CgsDrawByMouse.featureAddDragPoint(i,o.feature,t,r)):(3===o.points.length&&o.points.pop(),o.feature.setPosition(o.points),o.feature.feature3D&&o.feature.feature3D._posUpdateCallback(!0),s.removeFeature(o.features.tPont),e.hideEdit(i,o.feature),e.restoreState(e),CgsDrawByMouse.drawEnd(i,o.feature))},onMove:function(e,t){e.ins;var i,s,o=e.state;if(!o.isDrawing)return 0;o.needPopLats?o.points.pop():o.needPopLats=!0,o.points.push(t),o.feature.map&&"3D"==o.feature.map.mode?(i=CgsFeature.switchRectToPolygonPos(o.points),s=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(i)),o.feature.feature3D&&(o.feature.feature3D.entity.polygon.hierarchy=new Cesium.CallbackProperty(function(e,t){return s},!1))):o.feature.setPosition(o.points),o.features.tPont.setPosition(t),o.features.tPont.setName(CgsDrawByMouse.geoPosToString(t))},showEdit:function(t,s){var e;_.get(s,"__drawByMouseObjs.isEditMode",!1)||(_.set(s,"__drawByMouseObjs.isEditMode",!0),CgsDrawByMouse.editModeOnClickOut(),CgsDrawByMouse.featureArrWithEditModeActived.push(s),e=s.getPosition(),_.each(e,function(e,i){CgsDrawByMouse.featureAddDragPoint(t,s,e,i,!1,function(e){var t=s.getPosition(),t=_.set(t,"["+i+"]",e.getPosition());s.setPosition(t)}).setDragEnable(!0)}))},hideEdit:function(e,t){t&&(_.set(t,"__drawByMouseObjs.isEditMode",!1),CgsDrawByMouse.featureHideEdit(t),t.mouseOnEditHide&&t.mouseOnEditHide())}}),CgsDrawByMouse.CircleMode=CgsDrawByMouse.createDrawMode({name:"圆模式",state:{radius:0},onLeftClick:function(e,t){var i=e.ins,s=e.state,o=e.createOptions,a=i.map;s.needPopLats=!1,s.points.push(t);var n,r,l=s.points.length;1===l?(o.position=t,n=_.clone(o),o.radius=0,s.feature=CgsDrawByMouse.createAndAddToMap(i,CgsCircle,_.clone(o)),_.set(s.feature,"__drawByMouseObjs.style",_.clone(o)),s.isDrawing=!0,(r=_.clone(i.editPointStyle)).position=t,s.features.tPont=new CgsPoint(r),a.addFeature(s.features.tPont),CgsDrawByMouse.featureAddDragPoint(i,s.feature,t,l).setLabelOffset([0,20]),n.positions=[t,t],i.editPointStyle&&i.editPointStyle.labelfont?n.labelfont=i.editPointStyle.labelfont:n.labelfont="10px 微软雅黑",i.editPointStyle&&i.editPointStyle.labeloffset?n.labeloffset=i.editPointStyle.labeloffset:n.labeloffset=[120,20],s.features.radiusLine=CgsDrawByMouse.createAndAddToMap(i,CgsLine,n)):(3===s.points.length&&s.points.pop(),s.feature.setRadius(CgsUtil.getDistanceBy2Array(s.points[0],s.points[1])),a.removeFeature(s.features.tPont),a.removeFeature(s.features.radiusLine),e.hideEdit(i,s.feature),e.restoreState(e),CgsDrawByMouse.drawEnd(i,s.feature))},onMove:function(e,t){var i=e.ins,s=e.state;if(!s.isDrawing)return 0;s.needPopLats?s.points.pop():s.needPopLats=!0,s.points.push(t);var o,a=CgsUtil.getDistanceBy2Array(s.points[0],t);s.radius=a,"3D"===i.map.mode&&s.feature.feature3D?((o=s.feature.feature3D.entity).ellipse.semiMinorAxis=new Cesium.CallbackProperty(function(){return a},!1),o.ellipse.semiMajorAxis=new Cesium.CallbackProperty(function(){return a},!1)):s.feature.setRadius(a),s.features.tPont.setPosition(t),s.features.tPont.setName(CgsDrawByMouse.geoPosToString(t)),s.features.radiusLine.setPosition(_.cloneDeep(s.points)),s.features.radiusLine.setName(CgsGeometry.formatDistance(a))},showEdit:function(e,i){var s,o,a,n,t;_.get(i,"__drawByMouseObjs.isEditMode",!1)||(_.set(i,"__drawByMouseObjs.isEditMode",!0),CgsDrawByMouse.editModeOnClickOut(),CgsDrawByMouse.featureArrWithEditModeActived.push(i),s=i.getPosition(),(a=CgsDrawByMouse.featureAddDragPoint(e,i,s,0,!1,function(e){s=e.getPosition(),i.setPosition(s),_.get(i,"__drawByMouseObjs.editTempFeatures",[])[1].setPosition(CgsUtil.createPositionByAngle(s,i.getRadius(),0)),o.setPosition([a.getPosition(),n.getPosition()]),o.setName(CgsGeometry.formatDistance(i.getRadius()))})).setDragEnable(!0),(n=CgsDrawByMouse.featureAddDragPoint(e,i,CgsUtil.createPositionByAngle(s,i.getRadius(),0),0,!1,function(e){var t=CgsGeometry.measure2PointDistance(s,e.getPosition());i.setRadius(t),o&&(o.setPosition([a.getPosition(),n.getPosition()]),o.setName(CgsGeometry.formatDistance(i.getRadius())))})).setDragEnable(!0),(t=_.clone(_.get(i,"__drawByMouseObjs.style",{}))).positions=[a.getPosition(),n.getPosition()],t.labelfont="10px 微软雅黑",t.labeloffset=[120,20],(o=CgsDrawByMouse.createAndAddToMap(e,CgsLine,t)).setName(CgsGeometry.formatDistance(i.getRadius())),_.get(i,"__drawByMouseObjs.editTempFeatures",[]).push(o))},hideEdit:function(e,t){var i,s;t&&(i=e.map,_.set(t,"__drawByMouseObjs.isEditMode",!1),s=_.get(t,"__drawByMouseObjs.editTempFeatures",[]),_.each(s,function(e){return i.removeFeature(e)}),_.set(t,"__drawByMouseObjs.editTempFeatures",[]),t.mouseOnEditHide&&t.mouseOnEditHide())}}),CgsDrawByMouse.addToolTip=function(e){var t=e.map,i={},s=document.createElement("div");s.className="cgstooltip cgstooltip-measure",s.style.pointerEvents="none";var o=new CgsOverlay({position:[0,0],element:s,offset:[0,-6],positioning:"bottom-center",stopEvent:!1});return o.setVisible(!1),t.addOverlay(o),e.overlays.push(o),i.feature=o,i.setPosition=function(e){return o.setPosition(e)},i.setText=function(e){return s.innerHTML=e},i.destroy=function(){t.removeOverlay(o),_.pull(e.overlays,o)},i.type="aaToolTip",i},CgsDrawByMouse.MeasureLineMode=_.cloneDeep(CgsDrawByMouse.LineMode),function(e){e.name="普通的距离测量",_.assign(e.state,{sum:0,needtPoint:!1,lb:null}),e._stateStart=_.cloneDeep(e.state),CgsUtil.funcBefore(e,"onLeftClick",null,function(e,t){var i=e.state;i.lb?i.sum+=CgsGeometry.measure2PointDistance(i.points[i.points.length-2],t):(i.lb=CgsDrawByMouse.addToolTip(e.ins),_.defer(function(){_.set(i.feature,"__drawByMouseObjs.temps",[i.lb])}))}),CgsUtil.funcAfter(e,"onMove",null,function(e,t){var i=e.state;if(!i.isDrawing)return 0;i.lb.setPosition([t[0],t[1],0]);var s=i.sum+CgsGeometry.measure2PointDistance(i.points[i.points.length-2],t),o=CgsGeometry.formatDistance(s);i.lb.setText(o)}),CgsUtil.funcBefore(e,"onCancel",null,function(e,t){e.state.lb&&e.state.lb.destroy()})}(CgsDrawByMouse.MeasureLineMode),CgsDrawByMouse.MeasurePolygonMode=_.cloneDeep(CgsDrawByMouse.PolygonMode),function(e){e.name="普通的多边形面积测量",_.assign(e.state,{sum:0,lb:null}),e._stateStart=_.cloneDeep(e.state),CgsUtil.funcBefore(e,"onLeftClick",null,function(e,t){var i=e.state;i.lb||(i.lb=CgsDrawByMouse.addToolTip(e.ins),_.defer(function(){_.set(i.feature,"__drawByMouseObjs.temps",[i.lb])}))}),CgsUtil.funcAfter(e,"onMove",null,function(e,t){var i=e.state;if(!i.isDrawing)return 0;var s,o;_.last(i.points);2<i.points.length&&(i.lb.setPosition([t[0],t[1],0]),s=CgsGeometry.measureArea(i.points),o=CgsGeometry.formatArea(s),i.lb.setText(o))}),CgsUtil.funcBefore(e,"onCancel",null,function(e,t){e.state.lb&&e.state.lb.destroy()})}(CgsDrawByMouse.MeasurePolygonMode),CgsDrawByMouse.MeasureRectangleMode=_.cloneDeep(CgsDrawByMouse.RectangleMode),function(e){e.name="矩形面积测量",_.assign(e.state,{sum:0,lb:null}),e._stateStart=_.cloneDeep(e.state),CgsUtil.funcBefore(e,"onLeftClick",null,function(e,t){var i=e.state;i.lb||(i.lb=CgsDrawByMouse.addToolTip(e.ins),_.defer(function(){_.set(i.feature,"__drawByMouseObjs.temps",[i.lb])}))}),CgsUtil.funcAfter(e,"onMove",null,function(e,t){var i=e.state;if(!i.isDrawing)return 0;i.lb.setPosition([t[0],t[1],0]);var s=CgsGeometry.measureRectAreaBy2Point(i.points),o=CgsGeometry.formatArea(s);i.lb.setText(o)}),CgsUtil.funcBefore(e,"onCancel",null,function(e,t){e.state.lb&&e.state.lb.destroy()})}(CgsDrawByMouse.MeasureRectangleMode),CgsDrawByMouse.MeasureCircleMode=_.cloneDeep(CgsDrawByMouse.CircleMode),function(e){e.name="圆面积测量",_.assign(e.state,{sum:0,lb:null}),e._stateStart=_.cloneDeep(e.state),CgsUtil.funcBefore(e,"onLeftClick",null,function(e,t){var i=e.state;i.lb||(i.lb=CgsDrawByMouse.addToolTip(e.ins),i.lb.setPosition([t[0],t[1],0]),_.defer(function(){_.set(i.feature,"__drawByMouseObjs.temps",[i.lb])}))}),CgsUtil.funcAfter(e,"onMove",null,function(e,t){var i=e.state;if(!i.isDrawing)return 0;var s=CgsGeometry.measureCircleByRadius(i.radius),o=CgsGeometry.formatArea(s);i.lb.setText(o)}),CgsUtil.funcBefore(e,"onCancel",null,function(e,t){e.state.lb&&e.state.lb.destroy()})}(CgsDrawByMouse.MeasureCircleMode),CgsDrawByMouse.featureArrWithEditModeActived=[],CgsDrawByMouse.prototype.setEnableEditMode=function(e){var t=_.merge({enable:!0,showEditBy:"featuredoubleclick"},e);this.editModeEvFeatureclick&&CgsSubPub.unsubscribe(this.editModeEvFeatureclick),this.editModeEvFeatureclickout&&CgsSubPub.unsubscribe(this.editModeEvFeatureclickout),t.enable?(this.enableEditMode=!0,this.deactivate(),this.editModeEvFeatureclick=CgsSubPub.subscribe("featuredoubleclick",function(e,t,i,s){var o=_.get(t,"__drawByMouseObjs.CgsDrawByMouseIns"),a=_.get(t,"__drawByMouseObjs.showEdit");o&&a&&a(o,t)}),this.editModeEvFeatureclickout=CgsSubPub.subscribe("featureclickout",function(e){CgsDrawByMouse.editModeOnClickOut()})):(this.enableEditMode=!1,CgsDrawByMouse.editModeOnClickOut())},CgsDrawByMouse.addFeatureToTool=function(e,t){var i=e||CgsDrawByMouse.defaultIns,s=i.mode,o=s,a=t.getType();"CgsLine"===a?o=CgsDrawByMouse.LineMode:"CgsPolygon"===a?o=CgsDrawByMouse.PolygonMode:"CgsRect"===a?o=CgsDrawByMouse.RectangleMode:"CgsCircle"===a&&(o=CgsDrawByMouse.CircleMode),i.switchMode(o),CgsDrawByMouse.drawEnd(i,t),i.switchMode(s)},CgsDrawByMouse.editModeOnClickOut=function(){_.each(CgsDrawByMouse.featureArrWithEditModeActived,function(e){var t=_.get(e,"__drawByMouseObjs.CgsDrawByMouseIns"),i=_.get(e,"__drawByMouseObjs.hideEdit");t&&i&&i(t,e)}),CgsDrawByMouse.featureArrWithEditModeActived=[]},CgsDrawByMouse.defaultIns=null,CgsSubPub.subscribe(CgsEvent.eMapInstanceCreated,function(e,t){CgsDrawByMouse.defaultIns||(CgsDrawByMouse.defaultIns=new CgsDrawByMouse({map:t,mode:CgsDrawByMouse.LineMode,createOptions:{width:4,fill:!1},editPointStyle:{pixelSize:10,labelfont:"10px 微软雅黑"}}))}),CgsGeometry=function(){},CgsGeometry.isPointInCgsPolygon=function(e,t){var i=turf.point(e),s=t.getPosition(),o=[_.concat(s[0],[_.first(s[0])])],a=turf.polygon(o);return turf.booleanPointInPolygon(i,a)},CgsGeometry.isCgsPointInCgsPolygon=function(e,t){return CgsGeometry.isPointInCgsPolygon(e.getPosition(),t)},CgsGeometry.measure2PointDistance=function(e,t){if(1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG)return new ol.Sphere(6378137).haversineDistance(e,t);var i=Cesium.Cartesian3.fromDegrees(e[0],e[1]),s=Cesium.Cartesian3.fromDegrees(t[0],t[1]);return Cesium.Cartesian3.distance(i,s)},CgsGeometry.measureCgsLineDistance=function(e){for(var t=0,i=e.getPosition(),s=i.length-1,o=0;o<s;o++){var a=i[o],n=i[o+1];t+=CgsGeometry.measure2PointDistance(a,n)}return t},CgsGeometry.formatDistance=function(e){var t=_.ceil(e,2)+"  m";return 1e3<=e&&(t=_.ceil(e/1e3,3)+"  km"),t},CgsGeometry.formatArea=function(e){var t=_.ceil(e,2)+"  ㎡";return 1e6<=e&&(t=_.ceil(e/1e6,3)+"  k㎡"),t},CgsGeometry.measureArea=function(e){var t=new ol.Sphere(CgsUtil.EPSG3857_RADIUS);return Math.abs(t.geodesicArea(e))},CgsGeometry.measureCgsPolygonArea=function(e){return CgsGeometry.measureArea(_.flatten(e.getPosition()))},CgsGeometry.measureRectArea=function(e){var t,i,s,o,a,n,r,l,u,p,h,c=e[0][0],g=e[0][1],d=e[1][0],m=e[1][1],f=((s=c)<(t=d)&&(a=t,t=s,s=a),(o=g)<(i=m)&&(a=i,i=o,o=a),[[t,i],[s,o]]),C=Cesium.Rectangle.fromDegrees(f[0][0],f[0][1],f[1][0],f[1][1]);return n=C,r={area:0,vertexes:{NE:null,NW:null,SE:null,SW:null},lines:{NE_NW:0,NW_SW:0,SW_SE:0,SE_NE:0}},l=Cesium.Rectangle.southwest(n),u=Cesium.Rectangle.southeast(n),p=Cesium.Rectangle.northeast(n),h=Cesium.Rectangle.northwest(n),r.vertexes.NE={lat:Cesium.Math.toDegrees(p.latitude),lng:Cesium.Math.toDegrees(p.longitude)},r.vertexes.NW={lat:Cesium.Math.toDegrees(h.latitude),lng:Cesium.Math.toDegrees(h.longitude)},r.vertexes.SE={lat:Cesium.Math.toDegrees(u.latitude),lng:Cesium.Math.toDegrees(u.longitude)},r.vertexes.SW={lat:Cesium.Math.toDegrees(l.latitude),lng:Cesium.Math.toDegrees(l.longitude)},r.lines.NE_NW=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(r.vertexes.NE.lng,r.vertexes.NE.lat),Cesium.Cartesian3.fromDegrees(r.vertexes.NW.lng,r.vertexes.NW.lat)),r.lines.NW_SW=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(r.vertexes.NW.lng,r.vertexes.NW.lat),Cesium.Cartesian3.fromDegrees(r.vertexes.SW.lng,r.vertexes.SW.lat)),r.lines.SW_SE=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(r.vertexes.SW.lng,r.vertexes.SW.lat),Cesium.Cartesian3.fromDegrees(r.vertexes.SE.lng,r.vertexes.SE.lat)),r.lines.SE_NE=Cesium.Cartesian3.distance(Cesium.Cartesian3.fromDegrees(r.vertexes.SE.lng,r.vertexes.SE.lat),Cesium.Cartesian3.fromDegrees(r.vertexes.NE.lng,r.vertexes.NE.lat)),r.area=Math.round(r.lines.NE_NW*r.lines.NW_SW/1e6),r.area},CgsGeometry.getRectVertexByDiagonalLinePoints=function(e){var t=e[0],i=e[1];t[0]>i[0]&&(t=e[1],i=e[0]);var s=Math.abs(i[0]-t[0]),o=[t[0]+s,t[1]],a=[i[0]-s,i[1]],n=null;return t[1]>a[1]&&(n=a,a=t,t=n),o[1]>i[1]&&(n=i,i=o,o=n),[t,o,i,a]},CgsGeometry.measureRectAreaBy2Point=function(e){return CgsGeometry.measureArea(CgsGeometry.getRectVertexByDiagonalLinePoints(e))},CgsGeometry.measureCgsRectArea=function(e){return CgsGeometry.measureRectAreaBy2Point(e.getPosition())},CgsGeometry.measureCircleByRadius=function(e){return Math.PI*Math.pow(e,2)},CgsGeometry.measureCgsCircle=function(e){return CgsGeometry.measureCircleByRadius(e.getRadius())},CgsGeometry.booleanWithin=function(e,t){var i=CgsGeometry.getTurfFeatureByCgsFeature(e),s=CgsGeometry.getTurfFeatureByCgsFeature(t);return turf.booleanWithin(i,s)},CgsGeometry.lineBufferInFeature=function(e,t,i){var s=e.getPosition(),o=turf.lineString(s),a=turf.buffer(o,i),n=CgsGeometry.getTurfFeatureByCgsFeature(t);return turf.booleanWithin(a,n)},CgsGeometry.buffer=function(e,t){var i,s,o=e.getPosition();return e instanceof CgsPoint?i=turf.point(o):e instanceof CgsLine?i=turf.lineString(o):e instanceof CgsPolygon&&(s=o[0].length,o[0][s-1]!=o[0][s-2]&&o[0].push(o[0][0]),i=turf.polygon(o)),turf.buffer(i,t,{utils:"kilometers"}).geometry.coordinates},CgsGeometry.centerPointBy2Point=function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]},CgsGeometry.getTurfFeatureByCgsFeature=function(e){var t,i,s,o,a,n,r=null;return e instanceof CgsPoint?(n=e.getPosition(),r=turf.point(n)):e instanceof CgsCircle?(n=e.getPosition(),t=e.getRadius(),r=turf.circle(n,.001*t)):e instanceof CgsLine?(n=e.getPosition(),r=turf.lineString(n)):e instanceof CgsPolygon?(i=e.getPosition(),s=[_.concat(i[0],[_.first(i[0])])],r=turf.polygon(s)):e instanceof CgsRect?(n=e.getPosition(),(o=CgsGeometry.getRectVertexByDiagonalLinePoints(n)).push(o[0]),r=turf.polygon([o])):e instanceof CgsSymbol?(n=e.getPosition(),a=[],r=CgsUtil.isArray(n)?1<n.length?(n.forEach(function(e){a.push([e.x,e.y])}),a.push(a[0]),turf.lineString(a)):(a=[n[0].x,n[0].y],turf.point(a)):(a=[n.x,n.y],turf.point(a))):e instanceof CgsMark?(n=e.getPosition(),r=turf.point(n)):console.error("getTurfFeatureByCgsFeature方法没有传入feature元素"),r},CgsGeometry.updatePointArrByPointChanges=function(e,t,i){var s=e[0]-t[0],o=e[1]-t[1];_.each(i,function(e){e[0]+=s,e[1]+=o})},CgsGeometry.hasFeaturesInArea=function(e,t){var i=[];t=t||map.getAllFeatures();var s=!0,o=!1,a=void 0;try{for(var n,r=t[Symbol.iterator]();!(s=(n=r.next()).done);s=!0)feature=n.value,(feature instanceof CgsPoint||feature instanceof CgsLine||feature instanceof CgsPolygon||feature instanceof CgsRect||feature instanceof CgsSymbol||feature instanceof CgsMark||feature instanceof CgsCircle)&&CgsGeometry.booleanWithin(feature,e)&&feature!=e&&i.push(feature)}catch(e){o=!0,a=e}finally{try{!s&&r.return&&r.return()}finally{if(o)throw a}}return i},CgsGeometry.hasJbsInArea=function(e,t){var i=[];t=t||map.getAllSymbols();var s=!0,o=!1,a=void 0;try{for(var n,r=t[Symbol.iterator]();!(s=(n=r.next()).done);s=!0)jb=n.value,jb instanceof CgsSymbol&&CgsGeometry.booleanWithin(jb,e)&&i.push(jb)}catch(e){o=!0,a=e}finally{try{!s&&r.return&&r.return()}finally{if(o)throw a}}return i},CgsGeometry.getIntersectByPolygons=function(e,t){var i=e.getPosition(),s=t.getPosition(),o=i[0].slice(),a=s[0].slice(),n=i[0].length,r=s[0].length;o[n-1][0]==o[n-2][0]&&o[n-1][1]==o[n-2][1]?o[n-1]=o[0]:o.push(o[0]),a[r-1][0]==a[r-2][0]&&a[r-1][1]==a[r-2][1]?a[r-1]=a[0]:a.push(a[0]);var l=turf.intersect(turf.polygon([o]),turf.polygon([a]));return l?l.geometry.coordinates:[]},CgsGeometry.toGeoJson=function(e){var t,i,s,o,a=e.type.toLowerCase(),n=e.coordinates,r=null;return"point"===a?r=turf.point(n):"line"===a||"linestring"===a?r=turf.lineString(n):"polygon"===a?r=turf.polygon(n):"circle"===a&&(t=n.center,i=n.radius,s=n.units||"kilometers",o=n.steps||64,r=turf.circle(t,i,{steps:o,units:s})),r.geometry},CgsGeometry.topologyAnalyse=function(t){return{isWithin:function(e){return CgsGeometry.isWithin(t,e)},isContain:function(e){return CgsGeometry.isContain(t,e)},intersectionWith:function(e){return CgsGeometry.getIntersection(t,e)},difference:function(e){return CgsGeometry.difference(t,e)},summation:function(e){return CgsGeometry.summation(t,e)}}},CgsGeometry.isWithin=function(e,t){CgsGeometry.toGeoJson(e),CgsGeometry.toGeoJson(t);return turf.booleanWithin(e,t)},CgsGeometry.isContain=function(e,t){CgsGeometry.toGeoJson(e),CgsGeometry.toGeoJson(t);return turf.booleanContains(e,t)},CgsGeometry.getIntersection=function(e,t){CgsGeometry.toGeoJson(e),CgsGeometry.toGeoJson(t);var i=turf.intersect(e,t);return i?i.geometry:i},CgsGeometry.difference=function(e,t){CgsGeometry.toGeoJson(e),CgsGeometry.toGeoJson(t);var i=turf.difference(e,t);return i?i.geometry:i},CgsGeometry.summation=function(e,t){var i=turf.union(turf.polygon(e.coordinates),turf.polygon(t.coordinates));return i?i.geometry:i},function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsScaleLine=t()}(window,function(){function e(e){1!=window.WGMODEFLAG&&3!=window.WGMODEFLAG||e.map&&(this.map_=e.map,this.container_=e.container||this.map_.container,this.minWidth_=e.minWidth||30,this.maxWidth_=e.maxWidth||Number.POSITIVE_INFINITY,this.className=e.className||"cgs-scale-line")}return e.prototype.createScaleDiv_=function(){for(var e=this.container_,t=e.getElementsByClassName(this.className),i=0,s=t.length;i<s;i++)e.removeChild(t[i]);var o=document.createElement("div");o.setAttribute("class",this.className);var a=document.createElement("div");return a.setAttribute("class","cgs-scale-line-inner"),o.appendChild(a),e.appendChild(o),this.element_=o,this.innerElement_=a,this},e.prototype.updateElement_=function(){var e=this.map_,t=e.container,i=[];i.push(t.clientWidth/2-50),i.push(t.clientHeight/2),i.push(t.clientWidth/2+50),i.push(t.clientHeight/2);var s=e.pixelToLonLat([i[0],i[1]]),o=e.pixelToLonLat([i[2],i[3]]);if(!s||isNaN(s[0])||isNaN(s[1])||!o||isNaN(o[0])||isNaN(o[1]))return this.element_.style.display="none",void(this.renderedVisible_=!1);var a=Cesium.Cartesian3.fromDegrees(s[0],s[1]),n=Cesium.Cartesian3.fromDegrees(o[0],o[1]),r=Cesium.Cartesian3.distance(a,n)/100,l=this.minWidth_*r,u="";if(this.element_&&this.innerElement_){l<.001?(u="μm",r*=1e6):l<1?(u="mm",r*=1e3):l<1e3?u="m":(u="km",r/=1e3);for(var p,h,c=3*Math.floor(Math.log(this.minWidth_*r)/Math.log(10)),g=[1,2,5];;){if(p=g[(c%3+3)%3]*Math.pow(10,Math.floor(c/3)),h=Math.round(p/r),isNaN(h))return this.element_.style.display="none",void(this.renderedVisible_=!1);if(h>=this.minWidth_&&h<=this.maxWidth_)break;++c}var d=p+" "+u;this.renderedHTML_!=d&&(this.innerElement_.innerHTML=d,this.renderedHTML_=d),this.renderedWidth_!=h&&(this.innerElement_.style.width=h+"px",this.renderedWidth_=h),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0)}},e.prototype.show=function(){var t;this.element_?this.element_.style.display="":this.createScaleDiv_().updateElement_(),this.listener_||((t=this).listener_=CgsSubPub.subscribe("postrender",function(){var e=t.map_;e.map3D&&0!=e.map3D.scene.viewIndex||t.updateElement_()}))},e.prototype.hide=function(){this.element_&&(this.element_.style.display="none"),this.listener_&&(CgsSubPub.unsubscribe(this.listener_),this.listener_=null)},e.prototype.destroy=function(){this.listener_&&(CgsSubPub.unsubscribe(this.listener_),this.listener_=null),this.element_&&this.container_.removeChild(this.element_)},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsScreenShot=t()}(window,function(){function e(e){this.map_=e.map,this.penColor=e.penColor||g,this.strokeWidth=1,this.fillColor=e.fillColor||d,this.interactType="click"===e.interactType?"click":"drag"}var g="rgba(0,153,255,1.0)",d="rgba(255, 255, 255, 0.3)";function m(e,t){var i=1<arguments.length&&void 0!==t?t:{},p=document.getElementsByClassName("cesium-infoBox");0<p.length&&(p[0].style.display="none");var s,h=i.name;h||(s=new Date,h="screenShot"+s.getFullYear()+(s.getMonth()+1)+s.getDate()+s.getHours()+s.getMinutes()+s.getSeconds()),document.getElementById("navigationDiv")&&(document.getElementById("navigationDiv").style.visibility="hidden");var c=void 0===i.showEffect||i.showEffect,g="2D"===e.mode?e.map2D.container:e.map3D.container,d=void 0===i.saveImage||i.saveImage;return function(e,t,l,u){return html2canvas(g,{useCORS:!0,x:e,y:t,width:l,height:u}).then(function(e){0<p.length&&(p[0].style.display="block");var t,i,s,o,a,n,r=e.toDataURL("image/jpeg");return c&&(t=g,i=l,s=u,o=r,(a=document.createElement("img")).style.position="absolute",a.style.pointerEvents=null,a.style.bottom="0px",a.style.width=i,a.style.height=s,t.appendChild(a),a.style.transformOrigin="left bottom 0px",a.style.transition="all 0.1s ease-out",setTimeout(function(){a.style.backgroundColor="rgba(255,255,255,0.4)"},0),setTimeout(function(){a.src=o,a.style.transition="all 1s ease-out",a.style.transform="scale(0.1)"},200),setTimeout(function(){t.removeChild(a)},2e3)),d&&((n=document.createElement("a")).download=h+".png",n.href=r,n.click()),document.getElementById("navigationDiv")&&(document.getElementById("navigationDiv").style.visibility="visible"),r})}}return e.prototype.activate=function(e,s){var o,t,i,a,n,r,l,u,p;function h(e){l=e.clientX*window.devicePixelRatio,u=e.clientY*window.devicePixelRatio,a.onmousemove=function(e){var t=e.clientX*window.devicePixelRatio-l,i=e.clientY*window.devicePixelRatio-u;n(l,u,t,i)}}function c(e){a.onmousemove=null;var t=e.clientX*window.devicePixelRatio-l,i=e.clientY*window.devicePixelRatio-u;n(l,u,t,i),o.removeChild(a),r(l,u,t,i).then(function(e){s instanceof Function&&s(e)})}this.canvas||(t=(o=this.map_.container).clientWidth,i=o.clientHeight,(a=document.createElement("canvas")).width=t,a.height=i,a.style="position: absolute;left: 0;top: 0;z-index:1;",o.appendChild(a),this.canvas=a,n=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:g,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:d,s=arguments[3],o=s.getContext("2d");o.strokeStyle=e,o.lineWidth=t,o.fillStyle=i;var a=s.getBoundingClientRect(),n=a.left,r=a.top,l=s.width,u=s.height;return function(e,t,i,s){o.clearRect(0,0,l,u),o.beginPath(),o.rect(e-n,t-r,i,s),o.closePath(),o.fill(),o.stroke()}}(this.penColor,this.strokeWidth,this.fillColor,a),r=m(this.map_,e),"click"===this.interactType?(p=!1,a.onclick=function(e){p?c(e):(p=!0,h(e))}):"drag"===this.interactType&&(a.onmousedown=h,a.onmouseup=c))},e.prototype.deActivate=function(){this.canvas&&(this.canvas.onmousedown=null,this.canvas.onmousemove=null,this.canvas.onmouseup=null,this.map_.container.removeChild(this.canvas))},e.prototype.screenShot=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{left:0,top:0,width:100,height:100},t=arguments[1],i=this.map_.container.getClientRects()[0],s=i.x,o=i.y;m(this.map_,e)(e.left+s,e.top+o,e.width,e.height).then(function(e){"function"==typeof t&&t(e)})},e}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.CgsOverviewMap=t()}(window,function(){function d(e){var t,i,s,o,a,n,r,l,u,p,h=e.map,c=e.size,g=e.position;if(h)return h.overviewMap&&h.overviewMap instanceof d?(this.setSize(c),this.setPosition(g),this.setCollapsed(e.collapsed)):(t=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},s=document.createElement("div");s.id=e,s.style.position="absolute",s.style.width=t.width||"500px",s.style.height=t.height||"300px",i.top?(s.style.bottom="",s.style.top=i.top):s.style.bottom=i.bottom||"65px";i.left?(s.style.right="",s.style.left=i.left):s.style.right=i.right||"20px";return s}("cgs-overviewmap",c,g),i=h.map2D.allLayers.filter(function(e){return!(e instanceof ol.layer.Vector||e instanceof CgsWMSLayer2D)}),this.defaultVectorSource=new m,s=new f({source:this.defaultVectorSource}),i.push(s),a={layers:i,collapsed:e.collapsed,target:t},n=a.layers,r=a.collapsed,l=void 0===r||r,u=a.target,o=p=new ol.control.OverviewMap({collapsed:l,target:u,layers:n,label:"«",collapseLabel:"»",render:function(){C.call(p,"2D"),y.call(p)}}),h.container.appendChild(t),this.target_=t,this.control_=o,(h.overviewMap=this).addOvmapListener_(h),this.addMap3DListener_(h)),this}var m=ol.source.Vector,f=ol.layer.Vector,u=ol.Feature,t=ol.style.Style,p=ol.geom.Point;d.prototype.setCollapsed=function(e){},d.prototype.getCollapsed=function(){},d.prototype.setSize=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.target_;e.width&&(t.style.width=e.width),e.height&&(t.style.height=e.height);var i=Number(t.style.width.replace("px","")),s=Number(t.style.height.replace("px",""));this.control_.getOverviewMap().setSize([i,s])},d.prototype.setPosition=function(e){var t=this.target_,i=t.getElementsByTagName("button")[0];e.top?(t.style.bottom="",t.style.top=e.top,i.style.bottom="",i.style.top="1px"):e.bottom&&(t.style.top="",t.style.bottom=e.bottom,i.style.top="",i.style.bottom="1px"),e.left?(t.style.right="",t.style.left=e.left,i.style.right="",i.style.left="2px"):e.right&&(t.style.left="",t.style.right=e.right||"20px",i.style.left="",i.style.right="2px")},d.prototype.setScale=function(e){var t=e/CGS_INCHES_PER_METER/CGS_DOTS_PER_INCH;this.setResolution(t)},d.prototype.setResolution=function(e){var t=this.control_.ovmap_.getView();t&&(t.setResolution(e),y.call(this.control_))},d.prototype.setMapCenter=function(e){var t=this.control_.ovmap_.getView();t&&(e=ol.proj.transform(e,"EPSG:4326","EPSG:3857"),t.setCenter(e))},d.prototype.setZoomLocked=function(e){this.control_.setProperties({locked:e},!0)},d.prototype.getZoomLocked=function(){return this.control_.getProperties().locked||!1},d.prototype.addOvmapListener_=function(e){function s(e){var t=a.getEventCoordinate(e),i=ol.proj.transform(t,"EPSG:3857","EPSG:4326");o.setCenter(i),window.removeEventListener("mouseup",s)}var o=e.map3D,t=this.control_,a=t.ovmap_,i=t.boxOverlay_.getElement(),n=this;i.addEventListener("mousedown",function(){"3D"===e.mode&&(n.ovChange_=!0,window.addEventListener("mouseup",s))})},d.prototype.addMap3DListener_=function(e){var t=e.map3D,i=this.control_,s=this;this.listener3D_=t.camera.changed.addEventListener(function(){s.ovChange_?s.ovChange_=!1:i.collapsed_||(C.call(i,"3D",e.map3D),y.call(i))})},d.prototype.destroy=function(e){this.listener3D_(),this.target_.remove()},d.prototype.addPoint=function(e){var t=new i(e);return this.defaultVectorSource.addFeature(t),t},d.prototype.removePoint=function(e){this.defaultVectorSource.removeFeature(e)};var i=function(e){this.coordinate=e.position,this.projection=void 0===e.projection?"EPSG:102113":e.projection;var t=new p(this.coordinate);t.transform("EPSG:4326",this.projection),u.call(this,{geometry:t}),this.visible=!0;var i,s,o,a,n,r,l=(i=e,s=new CgsStyleStroke2D({color:void 0===i.outlineColor?"rgba(0,153,255,1.0)":i.outlineColor,width:void 0===i.outlineWidth?1:i.outlineWidth,lineDash:i.lineDash||null}),o=new CgsStyleFill2D({color:void 0===i.fillColor?"rgba(255,255,255,0.4)":i.fillColor}),a=void 0===i.pixelSize?5:i.pixelSize,n=new CgsStylePoint2D({fill:o,stroke:s,radius:a}),r=i.zIndex,new CgsStyle2D({image:n,zIndex:r}));this.style=l,this.setStyle(l)};function C(e,t){var i=this.ovmap_,s=i.getView(),o=[];if("3D"===e){var a,n=t.camera.computeViewRectangle(),r=n.south,l=n.east,u=n.west,p=n.north;r=Cesium.Math.toDegrees(r),p=Cesium.Math.toDegrees(p),l=Cesium.Math.toDegrees(l),u=Cesium.Math.toDegrees(u),(r<=-85||85<=p||u<=-180||180<=l)&&t.getCenter()&&(u=(a=t.getCenter())[0]-90,l=a[0]+90,r=a[1]-45,p=a[1]+45),o=[u=u<-170?-170:u,r=r<-85?-85:r,l=170<l?170:l,p=85<p?85:p],o=ol.proj.transformExtent(o,"EPSG:4326","EPSG:3857")}else{if(!(t=this.getMap()).isRendered()||!i.isRendered())return;var h=t.getSize(),o=t.getView().calculateExtent(h)}var c,g,d,m,f=i.getSize(),C=s.calculateExtent(f),y=i.getPixelFromCoordinate(ol.extent.getTopLeft(o)),v=i.getPixelFromCoordinate(ol.extent.getBottomRight(o)),b=Math.abs(y[0]-v[0]),D=Math.abs(y[1]-v[1]),S=f[0],_=f[1];b<S*ol.OVERVIEWMAP_MIN_RATIO||D<_*ol.OVERVIEWMAP_MIN_RATIO||b>S*ol.OVERVIEWMAP_MAX_RATIO||D>_*ol.OVERVIEWMAP_MAX_RATIO?!0!==this.getProperties().locked&&(c=Math.log(ol.OVERVIEWMAP_MAX_RATIO/ol.OVERVIEWMAP_MIN_RATIO)/Math.LN2,g=1/(Math.pow(2,c/2)*ol.OVERVIEWMAP_MIN_RATIO),"3D"===e?(d=[].concat(_toConsumableArray(o)),ol.extent.scaleFromCenter(d,g),s.fit(d)):s.fit(o)):ol.extent.containsExtent(C,o)||!0===this.getProperties().locked||(m=ol.extent.getCenter(o),s.setCenter(m)),this.extent_=o}function y(){var e,t,i,s,o,a=this.extent_;a&&(e=this.ovmap_.getView().getResolution(),t=ol.extent.getBottomLeft(a),i=ol.extent.getTopRight(a),o=(s=this.boxOverlay_).getElement(),s.setPosition(t),o&&(o.style.width=Math.abs((t[0]-i[0])/e)+"px",o.style.height=Math.abs((i[1]-t[1])/e)+"px"))}return CgsUtil.inherits(i,u),i.prototype.setPosition=function(e){this.coordinate=e;var t=this.getGeometry(),i=ol.proj.transform(e,"EPSG:4326",this.projection);t.setCoordinates(i)},i.prototype.setVisible=function(e){this.visible!==e&&((this.visible=e)?this.setStyle(this.style):this.setStyle(new t))},d}),CgsFeatureLayerType={},CgsFeatureLayer=function(e){this._id=CgsUtil.createGuid(),this._bid=e||CgsUtil.createGuid(),this._text="FEATURE_LAYER_"+this._bid,this._map=void 0,this._show=!0,this._cache={},this._attr={},this._pickEnable=!0,this._state=void 0,this.type=void 0},CgsFeatureLayer.prototype.getId=function(){return this._bid},CgsFeatureLayer.prototype.getText=function(){return this._text},CgsFeatureLayer.prototype.getLayerId=function(){return this._id},CgsFeatureLayer.prototype.getVisible=function(){return this._show},CgsFeatureLayer.prototype.setVisible=function(e){return this._show=e},CgsFeatureLayer.prototype.getType=function(){return this.type},CgsFeatureLayer.prototype.setType=function(e){return this.type=e},CgsFeatureLayer.prototype._onAdd=function(e){return this._map=e,this.layer3D&&(this.layer3D instanceof Cesium.PrimitiveCollection?this._map.map3D.scene.primitives.add(this.layer3D):this._map.map3D.dataSources.add(this.layer3D)),this.layer2D&&this._map.map2D.addLayer(this.layer2D),this._state=CgsState.ADDED,this},CgsFeatureLayer.prototype._onRemove=function(e){this.layer3D&&(this.layer3D instanceof Cesium.PrimitiveCollection?this._map.map3D.scene.primitives.remove(this.layer3D):this._map.map3D.dataSources.remove(this.layer3D)),this.layer2D&&this._map.map2D.removeLayer(this.layer2D),this._state=CgsState.REMOVED},CgsFeatureLayer.prototype.getAttr=function(){return this._attr},CgsFeatureLayer.prototype.setAttr=function(e){this._attr=e},CgsFeatureLayer.prototype.getAddToLayerTree=function(){return!1},CgsFeatureLayer.registerType=function(e){e&&(CgsFeatureLayerType[e.toLocaleUpperCase()]=e.toLocaleLowerCase())},CgsFeatureLayer.getLayerType=function(e){return CgsFeatureLayerType[e.toLocaleUpperCase()]||void 0},CgsVectorLayer=function(e){CgsFeatureLayer.call(this,e),this.layer3D=new Cesium.CustomDataSource(e);var t=new ol.source.Vector({projection:void 0,state:ol.source.State.READY});this.layer2D=new ol.layer.Vector({source:t}),this._state=CgsState.INITIALIZED},CgsInherits(CgsVectorLayer,CgsFeatureLayer),CgsVectorLayer.prototype.addFeature=function(e){e&&!this._cache.hasOwnProperty(e.getId())&&((this._cache[e.getId()]=e).feature3D.label&&this.layer3D.entities.add(e.feature3D.label.entity),this.layer3D.entities.add(e.getEntity()),e.feature2D&&this.layer2D.getSource().addFeature(e.feature2D),CgsSubPub.publish(CgsEvent.eFeatureAdded,[e]))},CgsVectorLayer.prototype.addFeatures=function(e){var t=this;e.forEach(function(e){return t.addFeature(e)})},CgsVectorLayer.prototype.removeFeature=function(e){var t;e&&this._cache[e.getId()]&&(t=e.getId(),e.feature3D.label&&this.layer3D.entities.remove(e.feature3D.label.entity),this.layer3D.entities.remove(e.getEntity()),e.feature2D&&this.layer2D.getSource().removeFeature(e.feature2D),delete this._cache[t])},CgsVectorLayer.prototype.getAllFeatures=function(){var t=this;return Object.keys(this._cache).map(function(e){return t._cache[e]})},CgsVectorLayer.prototype.clear=function(){this.layer3D.entities.removeAll(),this.layer2D.getSource().clear(),this._cache={},this._state=CgsState.CLEARED},CgsVectorLayer.prototype.setVisible=function(e){this.layer3D.show=e,this.layer2D.setVisible(e),this._show=e},CgsVectorLayer.prototype.getVisible=function(){return this._show},CgsVectorLayer.prototype.getFeatureById=function(e){return this._cache[e]},CgsVectorLayer.prototype.addTo=function(e){e.addLayer(this)},CgsFeatureLayer.registerType("vector"),CgsThreeSceneControls=function(e){var t;Cesium.defined(e.mapObject)&&(this.map=e.mapObject,Cesium.defined(this.map.ThreeCesium)&&(this.threeCesium=this.map.ThreeCesium,this.position=Cesium.defaultValue(e.position,[116.35709,39.8978,100]),this.light=new THREE.AmbientLight(15790320,1.5),this.threeCesium.globe.add(this.light),t=this.threeCesium.eastNorthUpToFixedFrame(this.position[0],this.position[1],this.position[2]),this.threeGroup=new THREE.Group,this.threeGroup.matrix=t,this.threeCesium.group=this.threeGroup,this.threeCesium.matrix=t,this.threeCesium.inverseMatrix=(new THREE.Matrix4).getInverse(t),this.threeGroup.matrixAutoUpdate=!1,this.threeGroup.matrixWorldNeedsUpdate=!0,this.threeCesium.globe.add(this.threeGroup)))},CgsThreeSceneControls.prototype.setThreeControlsMode=function(e){this.threeCesium&&(this.threeCesium.isThreeControls=e)},CgsThreeSceneControls.prototype.getThreeControlsMode=function(){if(this.threeCesium)return this.threeCesium.isThreeControls},CgsThreeSceneControls.prototype.destroy=function(){this.light&&this.threeCesium.globe.remove(this.light),this.threeGroup&&this.threeCesium.globe.remove(this.threeGroup),this.threeCesium.group=void 0,this.threeCesium.matrix=void 0,this.threeCesium.inverseMatrix=void 0},CgsBaseClass=function(e){this.options=e};var lastId=0;function falseFn(){return!1}function bind(e,t){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var s=i.call(arguments,2);return function(){return e.apply(t,s.length?s.concat(i.call(arguments)):arguments)}}function stamp(e){return e?(e._mars3d_id=e._mars3d_id||++lastId,e._mars3d_id):0}function bindLayerPopup(e,t){var s=void 0;return"object"==(void 0===e?"undefined":_typeof(e))&&e.html?s=e.html:e={html:s=e},e.html="function"==typeof s?function(e,t,i){return s(e,t,i)}:function(e){return t(s,e)},e.anchor=e.anchor||[0,-15],e}CgsBaseClass.prototype.destroy=function(e){if(!e)for(var t=0,i=this.length;t<i;t++)delete this[t]},CgsBaseClass.prototype.on=function(e,t,i){if(!e)return console.warn("绑定事件时传入了空值",t),this;if(Array.isArray(e))for(var s=0,o=e.length;s<o;s++)this._on(e[s],t,i);else if(CgsUtil.isObject(e))for(var a in e)this._on(a,e[a],t);else for(var n=0,r=(e=CgsUtil.splitWords(e)).length;n<r;n++)this._on(e[n],t,i);return this._onEventHook&&this._onEventHook(Object.keys(this._events).length),this},CgsBaseClass.prototype.off=function(e,t,i){if(e)if(Array.isArray(e))for(var s=0,o=e.length;s<o;s++)this._off(e[s],t,i);else if(CgsUtil.isObject(e))for(var a in e)this._off(a,e[a],t);else for(var n=0,r=(e=CgsUtil.splitWords(e)).length;n<r;n++)this._off(e[n],t,i);else delete this._events;return this},CgsBaseClass.prototype._on=function(e,t,i){this._events=this._events||{};var s=this._events[e];s||(s=[],this._events[e]=s),i==this&&(i=void 0);for(var o={fn:t,ctx:i},a=s,n=0,r=a.length;n<r;n++)if(a[n].fn==t&&a[n].ctx==i)return;a.push(o)},CgsBaseClass.prototype._off=function(e,t,i){var s=void 0,o=void 0,a=void 0;if(this._events&&(s=this._events[e]))if(t){if(i==this&&(i=void 0),s)for(o=0,a=s.length;o<a;o++){var n=s[o];if(n.ctx==i&&n.fn==t)return n.fn=falseFn,this._firingCount&&(this._events[e]=s=s.slice()),void s.splice(o,1)}}else{for(o=0,a=s.length;o<a;o++)s[o].fn=falseFn;delete this._events[e]}},CgsBaseClass.prototype.fire=function(e,t,i){if(!this.listens(e,i))return this;var s=_extends({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var o=this._events[e];if(o){this._firingCount=this._firingCount+1||1;for(var a=0,n=o.length;a<n;a++){var r=o[a];r.fn.call(r.ctx||this,s)}this._firingCount--}}return i&&this._propagateEvent(s),this},CgsBaseClass.prototype.listens=function(e,t){var i=this._events&&this._events[e];if(i&&i.length)return!0;if(t)for(var s in this._eventParents)if(this._eventParents[s].listens(e,t))return!0;return!1},CgsBaseClass.prototype.once=function(e,t,i){var s=this;if(CgsUtil.isObject(e)){for(var o in e)this.once(o,e[o],t);return this}var a=bind(function(){s.off(e,t,i).off(e,a,i)},this);return this.on(e,t,i).on(e,a,i)},CgsBaseClass.prototype.addEventParent=function(e){return this._eventParents=this._eventParents||{},this._eventParents[stamp(e)]=e,this},CgsBaseClass.prototype.removeEventParent=function(e){return this._eventParents&&delete this._eventParents[stamp(e)],this},CgsBaseClass.prototype.hasEventParent=function(e){return!(!this._eventParents||!this._eventParents[stamp(e)])},CgsBaseClass.prototype._propagateEvent=function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,_extends({layer:e.target,propagatedFrom:e.target},e),!0)},CgsBaseLayer=function(e){this._uuid=CgsUtil.createGuid(),e.id=Cesium.defaultValue(e.id,this._uuid),this.pid=Cesium.defaultValue(e.pid,-1),this.name=Cesium.defaultValue(e.name,"未命名"),this._show=Cesium.defaultValue(e.show,!0),this._opacity=Cesium.defaultValue(e.opacity,1),Cesium.defined(e.alpha)&&(this._opacity=e.alpha),this.options=e,this._bindControl(),this._state=CgsState.INITIALIZED},CgsInherits(CgsBaseLayer,CgsBaseClass),CgsBaseLayer.prototype.getuuid=function(){return this._uuid},CgsBaseLayer.prototype.getid=function(){return this.options.id},CgsBaseLayer.prototype.setid=function(e){this.options.id=e},CgsBaseLayer.prototype.gettype=function(){return this._type},CgsBaseLayer.prototype.getstate=function(){return this._state},CgsBaseLayer.prototype.getisAdded=function(){return this._state==State.ADDED},CgsBaseLayer.prototype.getlayer=function(){return null},CgsBaseLayer.prototype.getshow=function(){return this._show},CgsBaseLayer.prototype.setshow=function(t){this._show!=t&&(this.options.show=t,this._show=t,this.layer&&(Array.isArray(this.layer)?this.layer.forEach(function(e){e.show=t}):this.layer.show=t),this.isAdded&&(this._showHook&&this._showHook(t),t?this.fire(CgsEventType.show,{layer:this}):this.fire(CgsEventType.hide,{layer:this})))},CgsBaseLayer.prototype.gethasOpacity=function(){return!!this.setOpacity},CgsBaseLayer.prototype.getopacity=function(){return this._opacity},CgsBaseLayer.prototype.setopacity=function(e){this._opacity=e,this.setOpacity&&this.setOpacity(e)},CgsBaseLayer.prototype.addTo=function(e){return e&&e.addLayer&&e.addLayer(this),this},CgsBaseLayer.prototype.remove=function(e){this._map&&this._map.removeLayer(this,e)},CgsBaseLayer.prototype._onAdd=function(e){this._state!=State.ADDED&&(this._map=e,this.options.stopPropagation||this.addEventParent(e),this._mountedHook&&(this._createOK||(this._mountedHook(),this._createOK=!0)),this._addedHook&&this._addedHook(),this.options.flyTo&&this.flyToByAnimationEnd(),this._state=State.ADDED,this.fire(CgsEventType.add),this.fire(CgsEventType.addLayer,{layer:this},!0))},CgsBaseLayer.prototype._onRemove=function(){this._state!=State.REMOVED&&this._map&&(this._removedHook&&this._removedHook(),this._state=State.REMOVED,this.fire(CgsEventType.remove),this.fire(CgsEventType.removeLayer,{layer:this},!0),this.options&&!this.options.stopPropagation&&this.removeEventParent(this._map),this._map=null)},CgsBaseLayer.prototype._mountedHook=function(){},CgsBaseLayer.prototype._addedHook=function(){},CgsBaseLayer.prototype._removedHook=function(){},CgsBaseLayer.prototype.showError=function(e,t){return t=t||"未知错误",this._map&&this._map.cesiumWidget.showErrorPanel(e,void 0,t),console.warn("layer错误:"+e,t),this},CgsBaseLayer.prototype.flyToByAnimationEnd=function(){var e=this;return this._map&&(this._map.isFlyAnimation()?this._map.openFlyAnimationEndFun=function(){e.flyTo(e.options.flyToOptions)}:this.flyTo(_extends({},this.options.flyToOptions||{},{duration:0}))),this},CgsBaseLayer.prototype.flyTo=function(e){return this._map&&(this.options.center?this._map.setCameraView(this.options.center,e):this.options.extent?this._map.flyToExtent(this.options.extent,e):this.options.onCenterAt&&this.options.onCenterAt(e)),this},CgsBaseLayer.prototype.setOptions=function(e){return e&&0!=Object.keys(e).length&&(this.options=CgsUtil.merge(this.options,e),this._bindControl(),this._setOptionsHook&&this._setOptionsHook(this.options)),this},CgsBaseLayer.prototype.toJSON=function(){var e=CgsUtil.clone(this.options);return e.id=this.id,e.type=this.type,e.show=this.show||this.isAdded,this._toJsonEx(e),e},CgsBaseLayer.prototype._toJsonEx=function(e){},CgsBaseLayer.prototype._bindControl=function(){var o=this;Cesium.defined(this.options.contextmenuItems)&&(this.contextmenuItems=this.options.contextmenuItems),Cesium.defined(this.options.popup)&&(this.popup=bindLayerPopup(this.options.popup,function(e,t){var i=_extends({layer_name:o.options.name},o._getAttrForPopup(t)),s=o.options.popupTitleField?i[o.options.popupTitleField]:o.name;return o.options.popupNoTitle&&(s=null),CgsUtil.getTemplateHtml(_extends({},o.options.popup,{title:s,template:e,attr:i}))})),Cesium.defined(this.options.tooltip)&&(this.tooltip=bindLayerPopup(this.options.tooltip,function(e,t){var i=_extends({layer_name:o.options.name},o._getAttrForPopup(t)),s=o.options.tooltipTitleField?i[o.options.tooltipTitleField]:o.name;return o.options.tooltipNoTitle&&(s=null),CgsUtil.getTemplateHtml(_extends({},o.options.tooltip,{title:s,template:e,attr:i}))}))},CgsBaseLayer.prototype._getAttrForPopup=function(e){if(e.graphic.attr)return e.graphic.attr;if(!e.czmObject)return{};var t=e.czmObject._attr||e.czmObject.properties||e.czmObject.attribute;return t&&t.type&&t.attr&&(t=t.attr),t||{}},CgsBaseLayer.prototype.destroy=function(e){this._state!=State.REMOVED&&(this.clear&&this.clear(),this.remove()),this._state=State.DESTROY},CgsBaseThing=function(e){CgsUtil.isBoolean(e)&&(e={enabled:e}),this._uuid=CgsUtil.createGuid(),this._id=Cesium.defaultValue(e.id,this._uuid),this._enabled=Cesium.defaultValue(e.enabled,!0),this._state=CgsState.INITIALIZED,this.options=e},CgsInherits(CgsBaseThing,CgsBaseClass),CgsBaseThing.prototype.getuuId=function(){return this._uuid},CgsBaseThing.prototype.getState=function(){return this._state},CgsBaseThing.prototype.getIsAdded=function(){return this._state==CgsState.ADDED},CgsBaseThing.prototype.getId=function(){return this._id},CgsBaseThing.prototype.setId=function(e){this._id=e},CgsBaseThing.prototype.getEnabled=function(){return this._enabled},CgsBaseThing.prototype.setEnabled=function(e){this._enabled!=e&&(this._enabled=e,this._enabledHook&&this._enabledHook(e))},CgsBaseThing.prototype.addTo=function(e){return e&&e.addThing&&e.addThing(this),this},CgsBaseThing.prototype.remove=function(e){this._map&&this._map.removeThing(this,e)},CgsBaseThing.prototype._onAdd=function(e){this._state!=CgsState.ADDED&&(this._map=e,this._mountedHook&&(this._createOK||(this._mountedHook(),this._createOK=!0)),this._addedBaseHook&&this._addedBaseHook(),this._addedHook&&this._addedHook(),this._state=CgsState.ADDED,this.fire(CgsEventType.add))},CgsBaseThing.prototype._onRemove=function(){this._state!=CgsState.REMOVED&&this._map&&(this._removedBaseHook&&this._removedBaseHook(),this._removedHook&&this._removedHook(),this._state=State.REMOVED,this.fire(CgsEventType.remove),this.options&&!this.options.stopPropagation&&this.removeEventParent(this._map),this._map=null)},CgsBaseThing.prototype._mountedHook=function(){},CgsBaseThing.prototype._addedHook=function(){},CgsBaseThing.prototype._removedHook=function(){},CgsBaseThing.prototype.destroy=function(e){this._state!=CgsState.REMOVED&&(this.clear&&this.clear(),this.remove())},CgsLatLngPoint=function(e,t,i){this._lng=Number(e||0),this._lat=Number(t||0),this._alt=Number(i||0)},CgsLatLngPoint.prototype.getLng=function(){return this._lng},CgsLatLngPoint.prototype.setLng=function(e){this._lng=+e,this._position=null},CgsLatLngPoint.prototype.getLat=function(){return this._lat},CgsLatLngPoint.prototype.setLat=function(e){this._lat=+e,this._position=null},CgsLatLngPoint.prototype.getAlt=function(){return this._alt||0},CgsLatLngPoint.prototype.setAlt=function(e){this._alt=+e,this._position=null},CgsLatLngPoint.prototype.clone=function(){var e=new CgsLatLngPoint;return e.lng=this.lng||0,e.lat=this.lat||0,e.alt=this.alt||0,e},CgsLatLngPoint.prototype.format=function(){return this.lng=CgsUtil.formatNum(this.lng,6),this.lat=CgsUtil.formatNum(this.lat,6),this.alt=CgsUtil.formatNum(this.alt,1),this},CgsLatLngPoint.prototype.toArray=function(){return this.format(),[this.lng,this.lat,this.alt]},CgsLatLngPoint.prototype.toString=function(){return this.format(),this.lng+","+this.lat+","+this.alt},CgsLatLngPoint.prototype.toCartesian=function(e){return!e&&this._position?this._position:Cesium.Cartesian3.fromDegrees(this.lng,this.lat,this.alt)},CgsLatLngPoint.prototype.toCartographic=function(){return Cesium.Cartographic.fromDegrees(this.lng,this.lat,this.alt)},CgsLatLngPoint.prototype.equals=function(e){return this===e||e instanceof CgsLatLngPoint&&this._alt==e._alt&&this._lat==e._lat&&this._lng==e._lng},CgsLatLngPoint.parse=function(e,t){if(!e)return new CgsLatLngPoint;var i=void 0;if("string"==typeof e)i=CgsLatLngPoint.fromString(e);else if(Array.isArray(e))i=CgsLatLngPoint.fromArray(e);else if(e instanceof CgsLatLngPoint)i=e.clone();else if(Cesium.defined(e.lat)&&Cesium.defined(e.lng))for(var s in i=new CgsLatLngPoint(e.lng,e.lat,e.alt),e)i[s]=e[s];else e instanceof Cesium.Cartesian3||e._value||e.getValue?(i=CgsLatLngPoint.fromCartesian(e,t))._position=e:Cesium.defined(e.x)&&Cesium.defined(e.y)&&Cesium.defined(e.z)?(e=new Cesium.Cartesian3(e.x,e.y,e.z),(i=CgsLatLngPoint.fromCartesian(e,t))._position=e):(i=new CgsLatLngPoint,console.warn("坐标解析失败，请确认参数是否无误",e));return i},CgsLatLngPoint.fromArray=function(e){var t=new CgsLatLngPoint;return Array.isArray(e)&&(t.lng=e[0]||0,t.lat=e[1]||0,t.alt=e[2]||0),t},CgsLatLngPoint.fromString=function(e){var t,i=new CgsLatLngPoint;return e&&"string"==typeof e&&(t=e.split(","),i=this.fromArray(t)),i},CgsLatLngPoint.fromCartesian=function(e,t){var i,s=new CgsLatLngPoint,o=void 0;return e&&(e instanceof Cesium.Cartesian3?o=e:e._value&&e._value instanceof Cesium.Cartesian3?o=e._value:"function"==typeof e.getValue&&(o=e.getValue(t||Cesium.JulianDate.now()))),!o||(i=Cesium.Cartographic.fromCartesian(o))&&(s.lat=Cesium.Math.toDegrees(i.latitude),s.lng=Cesium.Math.toDegrees(i.longitude),s.alt=i.height,s.format()),s._position=e,s},CgsBasePrimitive3D=function(){},CgsInherits(CgsBasePrimitive3D,CgsBaseLayer),CgsBasePrimitive3D.prototype.getCzmObject=function(){return this.primitive},CgsBasePrimitive3D.prototype.getCzmObjectEx=function(){var e=[];return this.primitiveLabel&&e.push(this.primitiveLabel),this.primitiveOutline&&e.push(this.primitiveOutline),e},CgsBasePrimitive3D.prototype.getPrimitiveCollection=function(){return this.layer.primitiveCollection},CgsBasePrimitive3D.prototype.getPrimitive=function(){return this.primitive},CgsBasePrimitive3D.prototype.getGeometryInstanceAttributes=function(){return this.primitive?this.primitive.getGeometryInstanceAttributes(this.uuid):this.primitiveOutline?this.primitiveOutline.getGeometryInstanceAttributes(this.uuid):null},CgsBasePrimitive3D.prototype.getLabel=function(){return this.primitiveLabel?this.primitiveLabel:this.style.label},CgsBasePrimitive3D.prototype.addedHook=function(){var e=this.conversionStyle();Cesium.defaultValue(this.style.fill,!0)&&(this.primitive=this.createPrimitive(e)),this.style.outline&&(this.primitiveOutline=this.createPrimitive(e,!0)),this.style.label&&this.addLabel()},CgsBasePrimitive3D.prototype.removedHook=function(){this.primitive&&(this.primitiveCollection.remove(this.primitive),delete this.primitive),this.primitiveOutline&&this.primitiveCollection.remove(this.primitiveOutline),this.primitiveLabel&&this.layer.labelCollection.remove(this.primitiveLabel)},CgsBasePrimitive3D.prototype.conversionStyle=function(){return this.style},CgsBasePrimitive3D.prototype.createPrimitive=function(e,t){e.material&&!e.classification&&!t||(e.vertexFormat=e.vertexFormat||Cesium.PerInstanceColorAppearance.VERTEX_FORMAT);var i,s=_extends({},this.options,{geometryInstances:this.createGeometryInstance(e,t),show:this.show,shadows:e.shadows});delete s.style,delete s.attr,s.appearance||(!e.material||e.classification||t?(s.geometryInstances instanceof Cesium.GeometryInstance&&(i=Cesium.defaultValue(t?e.outlineColor:e.color,Cesium.Color.YELLOW.withAlpha(.5)),e.translucent=1!=i.alpha,s.geometryInstances.attributes=s.geometryInstances.attributes||{},s.geometryInstances.attributes.color=Cesium.ColorGeometryInstanceAttribute.fromColor(i),s.geometryInstances.attributes.show=new Cesium.ShowGeometryInstanceAttribute(this.show)),s.appearance=new Cesium.PerInstanceColorAppearance(_extends({},e))):s.appearance=new Cesium.MaterialAppearance(_extends({},e)));return this.style.clampToGround?(s.classificationType=e.classificationType,this.primitiveCollection.add(new Cesium.GroundPrimitive(s))):e.classification?(s.classificationType=e.classificationType||Cesium.ClassificationType.CESIUM_3D_TILE,this.primitiveCollection.add(new Cesium.ClassificationPrimitive(s))):this.primitiveCollection.add(new Cesium.Primitive(s))},CgsBasePrimitive3D.prototype.createGeometryInstance=function(e,t){return this.options.geometryInstances},CgsBasePrimitive3D.prototype.updateStyleBaseHook=function(e){return this.czmObject&&this.updateStyleHook(e),e.label&&this.primitiveLabel&&console.warn("需要整合后开发"),this},CgsBasePrimitive3D.prototype.updateStyleHook=function(e){this.isAdded&&this.show&&(this.removedHook(),this.addedHook())},CgsBasePrimitive3D.prototype.addLabel=function(){var e=this.style.label;if(e&&e.text){!Cesium.defined(this.style.clampToGround)||Cesium.defined(e.clampToGround)||Cesium.defined(e.height)||(e.clampToGround=this.style.clampToGround);var t=LabelStyleConver.toCesiumVal(e,{},this.attr);return t.position=this.getLablePosition(),this.primitiveLabel=this.layer.labelCollection.add(t),this.primitiveLabel}},CgsBasePrimitive3D.prototype._updateLabelPosition=function(){this.primitiveLabel&&(this.primitiveLabel.position=this.getLablePosition())},CgsBasePrimitive3D.prototype.getLablePosition=function(){var e,t,i=this.style.label,s=void 0;return i.position&&("center"==i.position?s=this.centerOfMass:CgsUtil.isString(i.position)?(e=CgsUtil.template(i.position,this.attr,!0))&&(s=CgsUtil.LatLngPointParse(e).toCartesian()):s=CgsUtil.LatLngPointParse(i.position).toCartesian()),(s=s||this.center)?((Cesium.defined(i.height)||Cesium.defined(this.style.height))&&(t=Cesium.defaultValue(i.height,this.style.height),s=CgsUtil.setPositionsHeight(s,t)),Cesium.defined(this.style.diffHeight)&&(s=CgsUtil.addPositionsHeight(s,this.style.diffHeight)),Cesium.defined(i.setHeight)&&(s=CgsUtil.setPositionsHeight(s,i.setHeight)),Cesium.defined(i.addHeight)&&(s=CgsUtil.addPositionsHeight(s,i.addHeight)),s):new Cesium.Cartesian3},CgsBasePolyPrimitive=function(e){e||(this.options=new Object),e.positions&&(this.positions=e.positions)},CgsInherits(CgsBasePolyPrimitive,CgsBasePrimitive3D),CgsBasePolyPrimitive.prototype.getCenter=function(){return this.style.closure?this.centerOfMass:this.centerOfLine},CgsBasePolyPrimitive.prototype.getCenterOfMass=function(){return CgsUtil.centerOfMass(this.positions)},CgsBasePolyPrimitive.prototype.getCenterOfLine=function(){var e=this.positions;return!e||e.length<2?null:e.length<10?CgsUtil.sliceByMaxDistance(e,this.distance/2,{point:!0}):e[Math.floor(e.length/2)]},CgsBasePolyPrimitive.prototype.getDistance=function(){return CgsUtil.getDistance(this.positions)},CgsBasePolyPrimitive.prototype.getArea=function(){return CgsUtil.getArea(this.positions)},CgsBasePolyPrimitive.prototype.getPositions=function(){return this.positions},CgsBasePolyPrimitive.prototype.setPositions=function(e){var s,o,a=this;e&&(s=[],o=[],e.forEach(function(e,t){var i=CgsUtil.LatLngPointParse.parse(e);i&&(Cesium.defined(a.style.setHeight)&&(Array.isArray(a.style.setHeight)?i.alt=a.style.setHeight[t]||0:i.alt=a.style.setHeight),Cesium.defined(a.style.addHeight)&&(Array.isArray(a.style.addHeight)?a.style.addHeight[t]&&(i.alt=i.alt+a.style.addHeight[t]):i.alt=i.alt+a.style.addHeight),s.push(i),o.push(i.toCartesian()))}),this.points=s,this.positions=o,this.primitive&&this.updatePositionsHook(),this.primitiveLabel&&this.updateLabelPosition())},CgsBasePolyPrimitive.prototype.getPoints=function(){return this.points},CgsBasePolyPrimitive.prototype.getCoordinates=function(){var t=[];return this.points.forEach(function(e){t.push(e.toArray())}),t},CgsBasePolyPrimitive.prototype.getRectangle=function(){return Cesium.Rectangle.fromCartesianArray(this.positions)},CgsBasePolyPrimitive.prototype.updatePositionsHook=function(){},CgsBasePolyPrimitive.prototype.getGeoJsonGeometry=function(){return{type:"LineString",coordinates:this.coordinates}},CgsBasePolyPrimitive.prototype.isInPoly=function(e){var t=CgsUtil.LatLngPointParse.parse(e);if(!Cesium.Rectangle.contains(Cesium.Rectangle.fromCartesianArray(this.positions),t.toCartographic()))return!1;var i={type:"Feature",geometry:{type:"Point",coordinates:t.toArray()}},s={type:"Polygon",coordinates:[this.coordinates]};return turf.booleanPointInPolygon(i,s)},CgsLatLngArray=function(){},CgsLatLngArray.prototype.toCartesians=function(e){if(!Array.isArray(e))return e;var i=[];return e.forEach(function(e){var t=CgsLatLngPoint.parse(e);t&&i.push(t.toCartesian(!0))}),i},CgsLatLngArray.prototype.toPoints=function(e){if(!Array.isArray(e))return e;var i=[];return e.forEach(function(e){var t=CgsLatLngPoint.parse(e);t&&i.push(t)}),i},CgsLatLngArray.prototype.toArray=function(e){if(!Array.isArray(e))return e;var i=[];return e.forEach(function(e){var t=CgsLatLngPoint.parse(e);t&&i.push(t.toArray())}),i};var czm_cellular="vec3 _czm_permute289(vec3 x)\n{\nreturn mod((34.0 * x + 1.0) * x, 289.0);\n}\nvec2 czm_cellular(vec2 P)\n{\n#define K 0.142857142857 // 1/7\n#define Ko 0.428571428571 // 3/7\n#define jitter 1.0 // Less gives more regular pattern\nvec2 Pi = mod(floor(P), 289.0);\nvec2 Pf = fract(P);\nvec3 oi = vec3(-1.0, 0.0, 1.0);\nvec3 of = vec3(-0.5, 0.5, 1.5);\nvec3 px = _czm_permute289(Pi.x + oi);\nvec3 p = _czm_permute289(px.x + Pi.y + oi); // p11, p12, p13\nvec3 ox = fract(p*K) - Ko;\nvec3 oy = mod(floor(p*K),7.0)*K - Ko;\nvec3 dx = Pf.x + 0.5 + jitter*ox;\nvec3 dy = Pf.y - of + jitter*oy;\nvec3 d1 = dx * dx + dy * dy; // d11, d12 and d13, squared\np = _czm_permute289(px.y + Pi.y + oi); // p21, p22, p23\nox = fract(p*K) - Ko;\noy = mod(floor(p*K),7.0)*K - Ko;\ndx = Pf.x - 0.5 + jitter*ox;\ndy = Pf.y - of + jitter*oy;\nvec3 d2 = dx * dx + dy * dy; // d21, d22 and d23, squared\np = _czm_permute289(px.z + Pi.y + oi); // p31, p32, p33\nox = fract(p*K) - Ko;\noy = mod(floor(p*K),7.0)*K - Ko;\ndx = Pf.x - 1.5 + jitter*ox;\ndy = Pf.y - of + jitter*oy;\nvec3 d3 = dx * dx + dy * dy; // d31, d32 and d33, squared\n// Sort out the two smallest distances (F1, F2)\nvec3 d1a = min(d1, d2);\nd2 = max(d1, d2); // Swap to keep candidates for F2\nd2 = min(d2, d3); // neither F1 nor F2 are now in d3\nd1 = min(d1a, d2); // F1 is now in d1\nd2 = max(d1a, d2); // Swap to keep candidates for F2\nd1.xy = (d1.x < d1.y) ? d1.xy : d1.yx; // Swap if smaller\nd1.xz = (d1.x < d1.z) ? d1.xz : d1.zx; // F1 is in d1.x\nd1.yz = min(d1.yz, d2.yz); // F2 is now not in d2.yz\nd1.y = min(d1.y, d1.z); // nor in  d1.z\nd1.y = min(d1.y, d2.x); // F2 is in d1.y, we're done.\nreturn sqrt(d1.xy);\n}";Cesium.ShaderSource._czmBuiltinsAndUniforms.czm_cellular=czm_cellular;var czm_snoise="vec4 _czm_mod289(vec4 x)\n{\nreturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 _czm_mod289(vec3 x)\n{\nreturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec2 _czm_mod289(vec2 x)\n{\nreturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nfloat _czm_mod289(float x)\n{\nreturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 _czm_permute(vec4 x)\n{\nreturn _czm_mod289(((x*34.0)+1.0)*x);\n}\nvec3 _czm_permute(vec3 x)\n{\nreturn _czm_mod289(((x*34.0)+1.0)*x);\n}\nfloat _czm_permute(float x)\n{\nreturn _czm_mod289(((x*34.0)+1.0)*x);\n}\nvec4 _czm_taylorInvSqrt(vec4 r)\n{\nreturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat _czm_taylorInvSqrt(float r)\n{\nreturn 1.79284291400159 - 0.85373472095314 * r;\n}\nvec4 _czm_grad4(float j, vec4 ip)\n{\nconst vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\nvec4 p,s;\np.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\np.w = 1.5 - dot(abs(p.xyz), ones.xyz);\ns = vec4(lessThan(p, vec4(0.0)));\np.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\nreturn p;\n}\nfloat czm_snoise(vec2 v)\n{\nconst vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n-0.577350269189626,  // -1.0 + 2.0 * C.x\n0.024390243902439); // 1.0 / 41.0\nvec2 i  = floor(v + dot(v, C.yy) );\nvec2 x0 = v -   i + dot(i, C.xx);\nvec2 i1;\ni1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\nvec4 x12 = x0.xyxy + C.xxzz;\nx12.xy -= i1;\ni = _czm_mod289(i); // Avoid truncation effects in permutation\nvec3 p = _czm_permute( _czm_permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0 ));\nvec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\nm = m*m ;\nm = m*m ;\nvec3 x = 2.0 * fract(p * C.www) - 1.0;\nvec3 h = abs(x) - 0.5;\nvec3 ox = floor(x + 0.5);\nvec3 a0 = x - ox;\nm *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\nvec3 g;\ng.x  = a0.x  * x0.x  + h.x  * x0.y;\ng.yz = a0.yz * x12.xz + h.yz * x12.yw;\nreturn 130.0 * dot(m, g);\n}\nfloat czm_snoise(vec3 v)\n{\nconst vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\nconst vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\nvec3 i  = floor(v + dot(v, C.yyy) );\nvec3 x0 =   v - i + dot(i, C.xxx) ;\nvec3 g = step(x0.yzx, x0.xyz);\nvec3 l = 1.0 - g;\nvec3 i1 = min( g.xyz, l.zxy );\nvec3 i2 = max( g.xyz, l.zxy );\nvec3 x1 = x0 - i1 + C.xxx;\nvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\nvec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\ni = _czm_mod289(i);\nvec4 p = _czm_permute( _czm_permute( _czm_permute(\ni.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n+ i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\nfloat n_ = 0.142857142857; // 1.0/7.0\nvec3  ns = n_ * D.wyz - D.xzx;\nvec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\nvec4 x_ = floor(j * ns.z);\nvec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\nvec4 x = x_ *ns.x + ns.yyyy;\nvec4 y = y_ *ns.x + ns.yyyy;\nvec4 h = 1.0 - abs(x) - abs(y);\nvec4 b0 = vec4( x.xy, y.xy );\nvec4 b1 = vec4( x.zw, y.zw );\nvec4 s0 = floor(b0)*2.0 + 1.0;\nvec4 s1 = floor(b1)*2.0 + 1.0;\nvec4 sh = -step(h, vec4(0.0));\nvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\nvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\nvec3 p0 = vec3(a0.xy,h.x);\nvec3 p1 = vec3(a0.zw,h.y);\nvec3 p2 = vec3(a1.xy,h.z);\nvec3 p3 = vec3(a1.zw,h.w);\nvec4 norm = _czm_taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\np0 *= norm.x;\np1 *= norm.y;\np2 *= norm.z;\np3 *= norm.w;\nvec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\nm = m * m;\nreturn 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\ndot(p2,x2), dot(p3,x3) ) );\n}\nfloat czm_snoise(vec4 v)\n{\nconst vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\n0.276393202250021,  // 2 * G4\n0.414589803375032,  // 3 * G4\n-0.447213595499958); // -1 + 4 * G4\n#define F4 0.309016994374947451\nvec4 i  = floor(v + dot(v, vec4(F4)) );\nvec4 x0 = v -   i + dot(i, C.xxxx);\nvec4 i0;\nvec3 isX = step( x0.yzw, x0.xxx );\nvec3 isYZ = step( x0.zww, x0.yyz );\ni0.x = isX.x + isX.y + isX.z;\ni0.yzw = 1.0 - isX;\ni0.y += isYZ.x + isYZ.y;\ni0.zw += 1.0 - isYZ.xy;\ni0.z += isYZ.z;\ni0.w += 1.0 - isYZ.z;\nvec4 i3 = clamp( i0, 0.0, 1.0 );\nvec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\nvec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\nvec4 x1 = x0 - i1 + C.xxxx;\nvec4 x2 = x0 - i2 + C.yyyy;\nvec4 x3 = x0 - i3 + C.zzzz;\nvec4 x4 = x0 + C.wwww;\ni = _czm_mod289(i);\nfloat j0 = _czm_permute( _czm_permute( _czm_permute( _czm_permute(i.w) + i.z) + i.y) + i.x);\nvec4 j1 = _czm_permute( _czm_permute( _czm_permute( _czm_permute (\ni.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n+ i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n+ i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n+ i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\nvec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\nvec4 p0 = _czm_grad4(j0,   ip);\nvec4 p1 = _czm_grad4(j1.x, ip);\nvec4 p2 = _czm_grad4(j1.y, ip);\nvec4 p3 = _czm_grad4(j1.z, ip);\nvec4 p4 = _czm_grad4(j1.w, ip);\nvec4 norm = _czm_taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\np0 *= norm.x;\np1 *= norm.y;\np2 *= norm.z;\np3 *= norm.w;\np4 *= _czm_taylorInvSqrt(dot(p4,p4));\nvec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\nvec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\nm0 = m0 * m0;\nm1 = m1 * m1;\nreturn 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n+ dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n}";Cesium.ShaderSource._czmBuiltinsAndUniforms.czm_snoise=czm_snoise;var LineFlowMaterial="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = repeat * materialInput.st;\nvec4 colorImage = texture2D(image, vec2(fract((axisY?st.t:st.s) - speed*czm_frameNumber/1000.0), st.t));\nif(color.a == 0.0) {\nmaterial.alpha = colorImage.a;\nmaterial.diffuse = colorImage.rgb;\n}\nelse {\nmaterial.alpha = colorImage.a * color.a;\nmaterial.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb);\n}\nif(hasImage2)  {\nvec4 colorBG = texture2D(image2,materialInput.st);\nif(colorBG.a>0.5){\nmaterial.diffuse = color2.rgb;\n}\n}\nreturn material;\n}";Cesium.Material.LineFlowType=MaterialType.LineFlow,Cesium.Material._materialCache.addMaterial(Cesium.Material.LineFlowType,{fabric:{type:Cesium.Material.LineFlowType,uniforms:{image:Cesium.Material.DefaultImageId,color:new Cesium.Color(1,0,0,1),repeat:new Cesium.Cartesian2(1,1),axisY:!1,speed:10,hasImage2:!1,image2:Cesium.Material.DefaultImageId,color2:new Cesium.Color(1,1,1)},source:LineFlowMaterial},translucent:!0});var LineFlowColorMaterial="uniform vec4 color;\nuniform float speed;\nuniform float percent;\nuniform float alpha;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat t =fract(czm_frameNumber * speed / 1000.0);\nt *= (1.0 + percent);\nfloat alpha1 = smoothstep(t- percent, t, st.s) * step(-t, -st.s);\nalpha1 += alpha;\nmaterial.diffuse = color.rgb;\nmaterial.alpha = alpha1;\nreturn material;\n}";Cesium.Material.LineFlowColorType=MaterialType.LineFlowColor,Cesium.Material._materialCache.addMaterial(Cesium.Material.LineFlowColorType,{fabric:{type:Cesium.Material.LineFlowColorType,uniforms:{color:new Cesium.Color(1,0,0,.7),speed:2,percent:.04,alpha:.1},source:LineFlowColorMaterial},translucent:!0});var ODLineMaterial="uniform vec4 color;\nuniform vec4 bgColor;\nuniform float speed;\nuniform float startTime;\nuniform float bidirectional;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat t = fract(startTime + czm_frameNumber * speed / 1000.0);\nt *= 1.03;\nfloat alpha0 = smoothstep(t - 0.03, t, st.s) * step(st.s, t);\nfloat mt = 1. - t;\nfloat alpha1 = smoothstep(mt + 0.03, mt, st.s) * step(mt, st.s);\nfloat a0 = step(abs(bidirectional - 0.0) - 0.001, 0.);\nfloat a1 = step(abs(bidirectional - 1.0) - 0.001, 0.);\nfloat db = step(abs(bidirectional - 2.0) - 0.001, 0.);\nfloat alpha = alpha0 * (a0 + db) + alpha1 * (a1 + db);\nalpha = clamp(alpha, 0., 1.);\nmaterial.diffuse = color.rgb * alpha + bgColor.rgb * (1. - alpha);\nmaterial.alpha = color.a * alpha + bgColor.a * (1. - alpha);\nreturn material;\n}";Cesium.Material.ODLineType=MaterialType.ODLine,Cesium.Material._materialCache.addMaterial(Cesium.Material.ODLineType,{fabric:{type:Cesium.Material.ODLineType,uniforms:{color:new Cesium.Color(1,1,0,.7),startTime:0,speed:20,bgColor:new Cesium.Color(1,1,0,.1),bidirectional:0},source:ODLineMaterial},translucent:!0});var LineFlickerMaterial="uniform vec4 color;\nuniform float speed;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat time = fract( czm_frameNumber  *  speed / 1000.0);\nvec2 st = materialInput.st;\nfloat scalar = smoothstep(0.0,1.0,time);\nmaterial.diffuse = color.rgb * scalar;\nmaterial.alpha = color.a * scalar ;\nreturn material;\n}";Cesium.Material.LineFlickerType=MaterialType.LineFlicker,Cesium.Material._materialCache.addMaterial(Cesium.Material.LineFlickerType,{fabric:{type:Cesium.Material.LineFlickerType,uniforms:{color:new Cesium.Color(1,0,0,.7),speed:10},source:LineFlickerMaterial},translucent:function(){return!0}});var LineTrailMaterial="uniform sampler2D image;\nuniform vec4 color;\nuniform float speed;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat time = fract(czm_frameNumber * speed / 1000.0);\nvec4 colorImage = texture2D(image,st);\nvec3 fragColor = color.rgb;\nif(st.t > 0.45 && st.t < 0.55 ) {\nfragColor = vec3(1.0);\n}\nif(color.a == 0.0){\nmaterial.alpha = colorImage.a * 1.5 * fract(st.s - time);\nmaterial.diffuse = colorImage.rgb;\n}else{\nmaterial.alpha = colorImage.a * color.a * 1.5 * smoothstep(.0,1., fract(st.s - time));\nmaterial.diffuse = max(fragColor.rgb * material.alpha , fragColor.rgb);\n}\nreturn material;\n}";Cesium.Material.LineTrailType=MaterialType.LineTrail,Cesium.Material._materialCache.addMaterial(Cesium.Material.LineTrailType,{fabric:{type:Cesium.Material.LineTrailType,uniforms:{color:new Cesium.Color(1,0,0,.7),image:Cesium.Material.DefaultImageId,speed:5},source:LineTrailMaterial},translucent:function(){return!0}});var WallScrollMaterial="uniform sampler2D image;\nuniform float speed;\nuniform vec4 color;\nuniform float count;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat perDis = 1.0 / count / 3.0  ;\nvec2 st = materialInput.st * vec2(1.0,count);\nfloat time = fract(czm_frameNumber * speed / 1000.0);\nvec4 colorImage = texture2D(image, vec2(st.s, fract(st.t - time)));\nmaterial.alpha =  colorImage.a * smoothstep(.2 ,1. ,distance(st.t * perDis ,1. + perDis ));\nmaterial.diffuse = max(color.rgb * material.alpha * 1.5, color.rgb);\nmaterial.emission = max(color.rgb * material.alpha * 1.5, color.rgb);\nreturn material;\n}";Cesium.Material.WallScrollType=MaterialType.WallScroll,Cesium.Material._materialCache.addMaterial(Cesium.Material.WallScrollType,{fabric:{type:Cesium.Material.WallScrollType,uniforms:{color:new Cesium.Color(1,0,0,.7),image:Cesium.Material.DefaultImageId,count:1,speed:5},source:WallScrollMaterial},translucent:function(){return!0}});var ScanLineMaterial="float circle(vec2 uv, float r, float blur) {\nfloat d = length(uv) * 2.0;\nfloat c = smoothstep(r+blur, r, d);\nreturn c;\n}\nuniform vec4 color;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st - .5;\nmaterial.diffuse = color.rgb;\nmaterial.emission = vec3(0);\nfloat t =fract(czm_frameNumber * speed / 1000.0);\nfloat s = 0.3;\nfloat radius1 = smoothstep(.0, s, t) * 0.5;\nfloat alpha1 = circle(st, radius1, 0.01) * circle(st, radius1, -0.01);\nfloat alpha2 = circle(st, radius1, 0.01 - radius1) * circle(st, radius1, 0.01);\nfloat radius2 = 0.5 + smoothstep(s, 1.0, t) * 0.5;\nfloat alpha3 = circle(st, radius1, radius2 + 0.01 - radius1) * circle(st, radius1, -0.01);\nmaterial.alpha = smoothstep(1.0, s, t) * (alpha1 + alpha2*0.1 + alpha3*0.1);\nmaterial.alpha *= color.a;\nreturn material;\n}";Cesium.Material.ScanLineType=MaterialType.ScanLine,Cesium.Material._materialCache.addMaterial(Cesium.Material.ScanLineType,{fabric:{type:Cesium.Material.ScanLineType,uniforms:{color:new Cesium.Color(1,1,0,1),speed:10},source:ScanLineMaterial},translucent:!0});var CircleScanMaterial="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec4 imgC = texture2D(image,st);\nif(imgC.a>.0){\nmaterial.diffuse = color.rgb;\n}\nmaterial.alpha = imgC.a;\nreturn material;\n}";Cesium.Material.CircleScanType=MaterialType.CircleScan,Cesium.Material._materialCache.addMaterial(Cesium.Material.CircleScanType,{fabric:{type:Cesium.Material.CircleScanType,uniforms:{color:new Cesium.Color(1,0,0,1),image:Cesium.Material.DefaultImageId},source:CircleScanMaterial},translucent:!0});var CircleWaveMaterial="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nmaterial.diffuse = 1.5 * color.rgb;\nvec2 st = materialInput.st;\nfloat dis = distance(st, vec2(0.5, 0.5));\nfloat per = fract(speed*czm_frameNumber/1000.0);\nif(count==1.0){\nif(dis > per * 0.5){\ndiscard;\n}else {\nmaterial.alpha = color.a  * dis / per / 2.0;\n}\n}\nelse{\nvec3 str = materialInput.str;\nif(abs(str.z)>0.001){\ndiscard;\n}\nif(dis >0.5){\ndiscard;\n}\nelse {\nfloat perDis = 0.5/count;\nfloat disNum;\nfloat bl = 0.0;\nfor(int i=0;i<=999;i++){\nif(float(i)<=count){\ndisNum = perDis*float(i) - dis + per/count;\nif(disNum>0.0){\nif(disNum<perDis){\nbl = 1.0-disNum/perDis;\n}\nelse if(disNum-perDis<perDis){\nbl = 1.0 - abs(1.0-disNum/perDis);\n}\nmaterial.alpha = pow(bl,(1.0 + 10.0 * (1.0 - gradient)));\n}\n}\n}\n}\n} \nreturn material;\n}";Cesium.Material.CircleWaveType=MaterialType.CircleWave,Cesium.Material._materialCache.addMaterial(Cesium.Material.CircleWaveType,{fabric:{type:Cesium.Material.CircleWaveType,uniforms:{color:new Cesium.Color(1,1,0,1),speed:10,count:1,gradient:.1},source:CircleWaveMaterial},translucent:!0});var RadarLineMaterial="uniform vec4 color;\nuniform float speed;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st * 2.0 - 1.0;\nfloat t = czm_frameNumber * speed / 1000.0 ;\nvec3 col = vec3(0.0);\nvec2 p = vec2(sin(t), cos(t));\nfloat d = length(st - dot(p, st) * p);\nif (dot(st, p) < 0.) {\nd = length(st);\n}\ncol = .006 / d * color.rgb;\nif(distance(st,vec2(0)) >  0.99 ){\ncol =color.rgb;\n}\nmaterial.alpha  = pow(length(col),2.0);\nmaterial.diffuse = col * 3.0 ;\nreturn material;\n}";Cesium.Material.RadarLineType=MaterialType.RadarLine,Cesium.Material._materialCache.addMaterial(Cesium.Material.RadarLineType,{fabric:{type:Cesium.Material.RadarLineType,uniforms:{color:new Cesium.Color(0,1,1,.7),speed:5},source:RadarLineMaterial},translucent:!0});var RadarWaveMaterial="uniform vec4 color;\nuniform float speed;\n#define PI 3.14159265359\nfloat rand(vec2 co){\nreturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec2 pos = st - vec2(0.5);\nfloat time = czm_frameNumber * speed / 1000.0 ;\nfloat r = length(pos);\nfloat t = atan(pos.y, pos.x) - time * 2.5;\nfloat a = (atan(sin(t), cos(t)) + PI)/(2.0*PI);\nfloat ta = 0.5;\nfloat v = smoothstep(ta-0.05,ta+0.05,a) * smoothstep(ta+0.05,ta-0.05,a);\nvec3 flagColor = color.rgb * v;\nfloat blink = pow(sin(time*1.5)*0.5+0.5, 0.8);\nflagColor = color.rgb *  pow(a, 8.0*(.2+blink))*(sin(r*500.0)*.5+.5) ;\nflagColor = flagColor * pow(r, 0.4);\nmaterial.alpha = length(flagColor) * 1.3;\nmaterial.diffuse = flagColor * 3.0;\nreturn material;\n}";Cesium.Material.RadarWaveType=MaterialType.RadarWave,Cesium.Material._materialCache.addMaterial(Cesium.Material.RadarWaveType,{fabric:{type:Cesium.Material.RadarWaveType,uniforms:{color:new Cesium.Color(0,1,1,.7),speed:5},source:RadarWaveMaterial},translucent:!0});var RectSlideMaterial="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec4 colorImage = texture2D(image, vec2(fract(st.s + czm_frameNumber * speed / 1000.0),fract(st.t)));\nmaterial.alpha = colorImage.a * color.a;\nif(pure) {\nmaterial.diffuse = diffusePower * color.rgb;\n}\nelse {\nmaterial.diffuse = colorImage.rgb;\n}\nreturn material;\n}";Cesium.Material.RectSlideType=MaterialType.RectSlide,Cesium.Material._materialCache.addMaterial(Cesium.Material.RectSlideType,{fabric:{type:Cesium.Material.RectSlideType,uniforms:{image:Cesium.Material.DefaultImageId,color:Cesium.Color.WHITE,speed:10,pure:!1,diffusePower:1.3},source:RectSlideMaterial},translucent:!0});var EllipsoidElectricMaterial="uniform vec4 color;\nuniform float speed;\n#define pi 3.1415926535\n#define PI2RAD 0.01745329252\n#define TWO_PI (2. * PI)\nfloat rands(float p){\nreturn fract(sin(p) * 10000.0);\n}\nfloat noise(vec2 p){\nfloat time = fract( czm_frameNumber * speed / 1000.0);\nfloat t = time / 20000.0;\nif(t > 1.0) t -= floor(t);\nreturn rands(p.x * 14. + p.y * sin(t) * 0.5);\n}\nvec2 sw(vec2 p){\nreturn vec2(floor(p.x), floor(p.y));\n}\nvec2 se(vec2 p){\nreturn vec2(ceil(p.x), floor(p.y));\n}\nvec2 nw(vec2 p){\nreturn vec2(floor(p.x), ceil(p.y));\n}\nvec2 ne(vec2 p){\nreturn vec2(ceil(p.x), ceil(p.y));\n}\nfloat smoothNoise(vec2 p){\nvec2 inter = smoothstep(0.0, 1.0, fract(p));\nfloat s = mix(noise(sw(p)), noise(se(p)), inter.x);\nfloat n = mix(noise(nw(p)), noise(ne(p)), inter.x);\nreturn mix(s, n, inter.y);\n}\nfloat fbm(vec2 p){\nfloat z = 2.0;\nfloat rz = 0.0;\nvec2 bp = p;\nfor(float i = 1.0; i < 6.0; i++){\nrz += abs((smoothNoise(p) - 0.5)* 2.0) / z;\nz *= 2.0;\np *= 2.0;\n}\nreturn rz;\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec2 st2 = materialInput.st;\nfloat time = fract( czm_frameNumber * speed / 1000.0);\nif (st.t < 0.5) {\ndiscard;\n}\nst *= 4.;\nfloat rz = fbm(st);\nst /= exp(mod( time * 2.0, pi));\nrz *= pow(15., 0.9);\nvec4 temp = vec4(0);\ntemp = mix( color / rz, vec4(color.rgb, 0.1), 0.2);\nif (st2.s < 0.05) {\ntemp = mix(vec4(color.rgb, 0.1), temp, st2.s / 0.05);\n}\nif (st2.s > 0.95){\ntemp = mix(temp, vec4(color.rgb, 0.1), (st2.s - 0.95) / 0.05);\n}\nmaterial.diffuse = temp.rgb;\nmaterial.alpha = temp.a * 2.0;\nreturn material;\n}";Cesium.Material.EllipsoidElectricType=MaterialType.EllipsoidElectric,Cesium.Material._materialCache.addMaterial(Cesium.Material.EllipsoidElectricType,{fabric:{type:Cesium.Material.EllipsoidElectricType,uniforms:{color:new Cesium.Color(0,1,1,.7),speed:5},source:EllipsoidElectricMaterial},translucent:!0});var EllipsoidWaveMaterial="uniform vec4 color;\nuniform float speed;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat time = fract(czm_frameNumber * speed / 1000.0);\nfloat alpha = abs(smoothstep(0.5,1.,fract( -st.t - time)));\nalpha += .1;\nmaterial.alpha = alpha;\nmaterial.diffuse = color.rgb;\nreturn material;\n}";Cesium.Material.EllipsoidWaveType=MaterialType.EllipsoidWave,Cesium.Material._materialCache.addMaterial(Cesium.Material.EllipsoidWaveType,{fabric:{type:Cesium.Material.EllipsoidWaveType,uniforms:{color:new Cesium.Color(0,1,1,.7),speed:5},source:EllipsoidWaveMaterial},translucent:!0});var PolyGradientMaterial="uniform vec4 color;\nuniform float diffusePower;\nuniform float alphaPower;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat alpha = distance(st,vec2(0.5, 0.5));\nmaterial.alpha = color.a  * alpha  * alphaPower;\nmaterial.diffuse = color.rgb * diffusePower;\nreturn material;\n}";Cesium.Material.PolyGradientType=MaterialType.PolyGradient,Cesium.Material._materialCache.addMaterial(Cesium.Material.PolyGradientType,{fabric:{type:Cesium.Material.PolyGradientType,uniforms:{color:new Cesium.Color(1,1,0,.5),diffusePower:1.6,alphaPower:1.5},source:PolyGradientMaterial},translucent:!0});var AsphaltMaterial="uniform vec4 asphaltColor;\nuniform float bumpSize;\nuniform float roughness;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 color = asphaltColor;\nvec2 st = materialInput.st;\nvec2 F = czm_cellular(st / bumpSize);\ncolor.rgb -= (F.x / F.y) * 0.1;\nfloat noise = czm_snoise(st / bumpSize);\nnoise = pow(noise, 5.0) * roughness;\ncolor.rgb += noise;\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}";Cesium.Material.PolyAsphaltType=MaterialType.PolyAsphalt,Cesium.Material._materialCache.addMaterial(Cesium.Material.PolyAsphaltType,{fabric:{type:Cesium.Material.PolyAsphaltType,uniforms:{asphaltColor:new Cesium.Color(.15,.15,.15,1),bumpSize:.02,roughness:.2},source:AsphaltMaterial},translucent:function(e){return e.uniforms.asphaltColor.alpha<1}});var BlobMaterial="uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform float frequency;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 F = czm_cellular(materialInput.st * frequency);\nfloat t = 1.0 - F.x * F.x;\nvec4 color = mix(lightColor, darkColor, t);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}";Cesium.Material.PolyBlobType=MaterialType.PolyBlob,Cesium.Material._materialCache.addMaterial(Cesium.Material.PolyBlobType,{fabric:{type:Cesium.Material.PolyBlobType,uniforms:{lightColor:new Cesium.Color(1,1,1,.5),darkColor:new Cesium.Color(0,0,1,.5),frequency:10},source:BlobMaterial},translucent:function(e){var t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<0}});var FacetMaterial="uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform float frequency;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 F = czm_cellular(materialInput.st * frequency);\nfloat t = 0.1 + (F.y - F.x);\nvec4 color = mix(lightColor, darkColor, t);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}";Cesium.Material.PolyFacetType=MaterialType.PolyFacet,Cesium.Material._materialCache.addMaterial(Cesium.Material.PolyFacetType,{fabric:{type:Cesium.Material.PolyFacetType,uniforms:{lightColor:new Cesium.Color(.25,.25,.25,.75),darkColor:new Cesium.Color(.75,.75,.75,.75),frequency:10},source:FacetMaterial},translucent:function(e){var t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<0}});var PolyGrassMaterial="uniform vec4 grassColor;\nuniform vec4 dirtColor;\nuniform float patchiness;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat noise1 = (czm_snoise(st * patchiness * 1.0)) * 1.0;\nfloat noise2 = (czm_snoise(st * patchiness * 2.0)) * 0.5;\nfloat noise3 = (czm_snoise(st * patchiness * 4.0)) * 0.25;\nfloat noise = sin(noise1 + noise2 + noise3) * 0.1;\nvec4 color = mix(grassColor, dirtColor, noise);\nfloat verticalNoise = czm_snoise(vec2(st.x * 100.0, st.y * 20.0)) * 0.02;\nfloat horizontalNoise = czm_snoise(vec2(st.x * 20.0, st.y * 100.0)) * 0.02;\nfloat stripeNoise = min(verticalNoise, horizontalNoise);\ncolor.rgb += stripeNoise;\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}";Cesium.Material.PolyGrassType=MaterialType.PolyGrass,Cesium.Material._materialCache.addMaterial(Cesium.Material.PolyGrassType,{fabric:{type:Cesium.Material.PolyGrassType,uniforms:{grassColor:new Cesium.Color(.25,.4,.1,1),dirtColor:new Cesium.Color(.1,.1,.1,1),patchiness:1.5},source:PolyGrassMaterial},translucent:function(e){var t=e.uniforms;return t.grassColor.alpha<1||t.dirtColor.alpha<1}});var PolyWoodMaterial="uniform vec4 lightWoodColor;\nuniform vec4 darkWoodColor;\nuniform float ringFrequency;\nuniform vec2 noiseScale;\nuniform float grainFrequency;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec2 noisevec;\nnoisevec.x = czm_snoise(st * noiseScale.x);\nnoisevec.y = czm_snoise(st * noiseScale.y);\nvec2 location = st + noisevec;\nfloat dist = sqrt(location.x * location.x + location.y * location.y);\ndist *= ringFrequency;\nfloat r = fract(dist + noisevec[0] + noisevec[1]) * 2.0;\nif(r > 1.0)\nr = 2.0 - r;\nvec4 color = mix(lightWoodColor, darkWoodColor, r);\nr = abs(czm_snoise(vec2(st.x * grainFrequency, st.y * grainFrequency * 0.02))) * 0.2;\ncolor.rgb += lightWoodColor.rgb * r;\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}";Cesium.Material.PolyWoodType=MaterialType.PolyWood,Cesium.Material._materialCache.addMaterial(Cesium.Material.PolyWoodType,{fabric:{type:Cesium.Material.PolyWoodType,uniforms:{lightWoodColor:new Cesium.Color(.6,.3,.1,1),darkWoodColor:new Cesium.Color(.4,.2,.07,1),ringFrequency:3,noiseScale:new Cesium.Cartesian2(.7,.5),grainFrequency:27},source:PolyWoodMaterial},translucent:function(e){var t=e.uniforms;return t.lightWoodColor.alpha<1||t.darkWoodColor.alpha<1}}),CgsBaseOptsConver=function(e){this.options=e},CgsBaseOptsConver.prototype.toCesiumVal=function(e,t){for(var i in t=t||{},this.toCesiumValBefore(e,t),e){var s,o=e[i];CgsUtil.isSimpleType(o)?this.excluded&&-1!=this.excluded.indexOf(i)||null!=(s=this.toOneCesiumVal(i,o,e,t))&&(t[i]=s):t[i]=o}return this.toCesiumValEnd(e,t),t},CgsBaseOptsConver.prototype.toCesiumValBefore=function(e,t){},CgsBaseOptsConver.prototype.toCesiumValEnd=function(e,t){},CgsBaseOptsConver.prototype.toOneCesiumVal=function(e,t,i,s){s[e]=t},CgsBaseOptsConver.prototype.toJSON=function(e,t){for(var i in t=t||{},e=CgsUtil.getAttrVal(e)){var s=e[i];CgsUtil.isSimpleType(s)?t[i]=s:this.toOneJson(i,e[i],t)}return t},CgsBaseOptsConver.prototype.toOneJson=function(e,t,i){},CgsBaseOptsConver.prototype.getColorByStyle=function(e){return this.baseOptsConver||(this.baseOptsConver=new CgsBaseOptsConver),this.baseOptsConver.getColorByStyle(e)},CgsBaseOptsConver.prototype.getColorByStyle=function(e){return CgsUtil.getColorByStyle(e,this.options.color)},CgsBaseOptsConver.prototype.getOutlineColorByStyle=function(e){var t=void 0;return(t=e.outlineColor?CgsUtil.isString(e.outlineColor)?Cesium.Color.fromCssColorString(e.outlineColor):e.outlineColor:this.options.outlineColor)&&(Cesium.defined(e.outlineOpacity)?t=t.withAlpha(Number(e.outlineOpacity)):Cesium.defined(e.opacity)&&(t=t.withAlpha(Number(e.opacity)))),t},CgsBaseMaterialConver=function(){},CgsInherits(CgsBaseMaterialConver,CgsBaseOptsConver),CgsBaseMaterialConver.prototype.getExcluded=function(){return["label"].concat(this.getExcludedStyle())},CgsBaseMaterialConver.prototype.getExcludedStyle=function(){return[]},CgsBaseMaterialConver.prototype.toOneCesiumVal=function(e,t,i,s){switch(e){default:s[e]=t;break;case"color":case"randomColor":s.color=this.getColorByStyle(i);break;case"color2":case"evenColor":case"outlineColor":case"oddColor":case"baseWaterColor":case"blendColor":case"gapColor":case"strokeColor":case"backgroundColor":case"asphaltColor":case"lightColor":case"darkColor":case"grassColor":case"dirtColor":case"lightWoodColor":case"darkWoodColor":s[e]=CgsUtil.getCesiumColor(t);break;case"repeat_x":case"repeat_y":var o=Cesium.defaultValue(i.repeat_x,1),a=Cesium.defaultValue(i.repeat_y,1);s.repeat=new Cesium.Cartesian2(o,a);break;case"repeat":i.materialType==MaterialType.Stripe||i.materialType==MaterialType.CylinderWave?s[e]=t:s[e]=new Cesium.Cartesian2(i.repeat_x||t,i.repeat_y||t);break;case"lineCount":case"lineThickness":case"lineOffset":case"noiseScale":s[e]=new Cesium.Cartesian2(t,t)}},CgsBaseMaterialConver.prototype.toJSON=function(e,t){return this.baseMaterialConver||(this.baseMaterialConver=new CgsBaseMaterialConver),this.baseMaterialConver.toJSON(e,t)},CgsBaseMaterialConver.prototype.toOneJson=function(e,t,i){if(t instanceof Cesium.Color)i[e]=t.toCssColorString();else switch(e){default:console.log("未处理的属性",e,t);break;case"label":break;case"color":case"evenColor":case"outlineColor":case"oddColor":case"baseWaterColor":case"blendColor":case"gapColor":case"strokeColor":case"backgroundColor":case"asphaltColor":case"lightColor":case"darkColor":case"grassColor":case"dirtColor":case"lightWoodColor":case"darkWoodColor":var s=CgsUtil.getCesiumValue(t,Cesium.Color);s&&(i[e]=s.toCssColorString());break;case"repeat":t instanceof Cesium.Cartesian2?t.x!=t.y?(i[e+"_x"]=t.x,i[e+"_y"]=t.y):i[e]=t.x:i[e]=t;break;case"lineCount":case"lineThickness":case"lineOffset":case"noiseScale":i[e+"_x"]=t.x,i[e+"_y"]=t.y}},CgsUtil.registerOptsConver("default",new CgsBaseMaterialConver),CgsColorOptsConver=function(){},CgsInherits(CgsColorOptsConver,CgsBaseMaterialConver),CgsColorOptsConver.prototype.toCesiumVal=function(e,t){return this.isProperty?this.getColorByStyle(e):{color:this.getColorByStyle(e)}},CgsColorOptsConver.prototype.toJSON=function(e,t,i){return this.colorOptsConver||(this.colorOptsConver=new CgsColorOptsConver),this.colorOptsConver.isProperty=i,this.colorOptsConver.toJSON(e,t)},CgsColorOptsConver.prototype.GetToJSON=function(e,t){var i=CgsUtil.getCesiumValue(e,Cesium.Color);i.color&&(i=i.color),t.color=i.toCssColorString()},CgsUtil.registerOptsConver(MaterialType.Color,new CgsColorOptsConver),CgsUtil.registerOptsConver(MaterialType.PolylineArrow,new CgsColorOptsConver),CgsImageOptsConver=function(){},CgsInherits(CgsImageOptsConver,CgsBaseMaterialConver),CgsImageOptsConver.prototype.getExcluded=function(){return["repeat_y"]},CgsImageOptsConver.prototype.toOneCesiumVal=function(e,t,i,s){switch(e){default:s[e]=t;break;case"repeat_x":var o=Cesium.defaultValue(i.repeat_x,1),a=Cesium.defaultValue(i.repeat_y,1);s.repeat=new Cesium.Cartesian2(o,a);break;case"repeat":s[e]=new Cesium.Cartesian2(i.repeat_x||t,i.repeat_y||t);break;case"color":break;case"opacity":s.color=Cesium.Color.WHITE.withAlpha(i.opacity)}},CgsImageOptsConver.prototype.toCesiumValEnd=function(e,t){t.transparent=Cesium.defaultValue(t.transparent,!0)},CgsImageOptsConver.prototype.toJSON=function(e,t){return this.imageOptsConver||(this.imageOptsConver=new CgsImageOptsConver),this.imageOptsConver.toJSON(e,t)},CgsImageOptsConver.prototype.toOneJson=function(e,t,i){switch(e){default:console.log("未处理的属性",e,t);break;case"repeat":i.repeat_x=t.x,i.repeat_y=t.y;break;case"color":i.opacity=1==CgsUtil.getCesiumValue(t,Cesium.Color).alpha}},CgsUtil.registerOptsConver(MaterialType.Image,new CgsImageOptsConver),CgsBaseStyleConver=function(e){this.options=e},CgsInherits(CgsBaseStyleConver,CgsBaseOptsConver),CgsBaseStyleConver.prototype.createMaterial=function(e,t){var i={};if(e){var s=i[e]||i.default;s&&(t.materialType=e,t=s.toCesiumVal(t));var o=void 0,a=MaterialClass[e];return(o=a?new a(t):Cesium.Material.fromType(e,t))._mars_type=e,o}logError("createMaterial：请指定mars3d.MaterialType类型")},CgsBaseStyleConver.prototype.createMaterialProperty=function(e,t){var i=MaterialPropertyClass[e];if(i){var s=OptsConverClass[e]||OptsConverClass.default;s&&(t.materialType=e,t=s.toCesiumVal(t,{},!0));var o=new i(t);return o._mars_type=e,o}logWarn("createMaterialProperty:未找到该类型的对应材质属性",e)},CgsBaseStyleConver.toJSON=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=void 0;e._mars_type?i=e._mars_type:e._template.type?i=e._template.type:e.getType&&(i=e.getType()),i||(e instanceof Cesium.Color?i="Color":logWarn("toJSON：未识别的材质类型",e));var s=OptsConverClass[i]||OptsConverClass.default;return s&&(t.materialType=i,s.toJSON(e,t)),t},CgsBaseStyleConver.getExcluded=function(){return["label","outlineOpacity","lineCount","lineThickness","cellAlpha","oddcolor","speed","axisY","image2","color2","scaleByDistance_near","scaleByDistance_nearValue","scaleByDistance_far","scaleByDistance_farValue","distanceDisplayCondition_far","distanceDisplayCondition_near"].concat(this.getExcludedStyle())},CgsBaseStyleConver.getExcludedStyle=function(){return[]},CgsBaseStyleConver.toCesiumValBefore=function(e,t){e.material||e.materialType||(e.color||e.randomColor?e.materialType=Cesium.Material.ColorType:e.image&&(e.materialType=Cesium.Material.ImageType))},CgsBaseStyleConver.toOneCesiumValPoint=function(e,t,i,s){switch(e){default:s[e]=t;break;case"clampToGround":s.heightReference=t?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE;break;case"visibleDepth":s.disableDepthTestDistance=t?0:Number.POSITIVE_INFINITY;break;case"scaleByDistance":s.scaleByDistance=t?new Cesium.NearFarScalar(Number(Cesium.defaultValue(i.scaleByDistance_near,1e3)),Number(Cesium.defaultValue(i.scaleByDistance_nearValue,1)),Number(Cesium.defaultValue(i.scaleByDistance_far,1e6)),Number(Cesium.defaultValue(i.scaleByDistance_farValue,.1))):void 0;break;case"distanceDisplayCondition":s.distanceDisplayCondition=t?new Cesium.DistanceDisplayCondition(Number(Cesium.defaultValue(i.distanceDisplayCondition_near,0)),Number(Cesium.defaultValue(i.distanceDisplayCondition_far,1e5))):void 0}},CgsBaseStyleConver.toOneCesiumValPoly=function(e,t,i,s){switch(e){default:s[e]instanceof Cesium.CallbackProperty||(s[e]=t);break;case"materialType":this.isEntity?s.material=this.createMaterialProperty(i.materialType,i):s.material=this.createMaterial(i.materialType,i);break;case"color":case"randomColor":s.color=this.getColorByStyle(i);break;case"outlineColor":s.outlineColor=this.getOutlineColorByStyle(i);break;case"hasShadows":s.shadows=t?Cesium.ShadowMode.ENABLED:Cesium.ShadowMode.DISABLED;break;case"distanceDisplayCondition":s.distanceDisplayCondition=t?new Cesium.DistanceDisplayCondition(Number(Cesium.defaultValue(i.distanceDisplayCondition_near,0)),Number(Cesium.defaultValue(i.distanceDisplayCondition_far,1e5)+6378137)):void 0}},CgsBaseStyleConver.toOneJsonPoly=function(e,t,i){switch(e){default:console.log("未处理的属性",t);break;case"label":break;case"material":this.toJSON(t,i);break;case"color":var s=CgsUtil.getCesiumValue(t,Cesium.Color);s&&(i[e]=s.toCssColorString());break;case"outlineColor":var o=CgsUtil.getCesiumValue(t,Cesium.Color);o&&(i[e]=o.toCssColorString());break;case"shadows":t==Cesium.ShadowMode.ENABLED?i.shadows=!0:i[e]=t;break;case"distanceDisplayCondition":i.distanceDisplayCondition_near=t.near,i.distanceDisplayCondition_far=t.far}},CgsBaseStyleConver.toOneJsonPoint=function(e,t,i){switch(e){default:console.log("未处理的属性",t);break;case"label":break;case"color":var s=CgsUtil.getCesiumValue(t,Cesium.Color);s&&(i.color=s.toCssColorString());break;case"heightReference":t==Cesium.HeightReference.CLAMP_TO_GROUND&&(i.clampToGround=!0);break;case"disableDepthTestDistance":t===Number.POSITIVE_INFINITY?i.visibleDepth=!1:i.disableDepthTestDistance=t;break;case"scaleByDistance":i.scaleByDistance=!0,i.scaleByDistance_near=t.near,i.scaleByDistance_nearValue=t.nearValue,i.scaleByDistance_far=t.far,i.scaleByDistance_farValue=t.farValue;break;case"distanceDisplayCondition":i.distanceDisplayCondition=!0,i.distanceDisplayCondition_near=t.near,i.distanceDisplayCondition_far=t.far}},CgsLabelStyleConver=function(){},CgsInherits(CgsLabelStyleConver,CgsBaseStyleConver),CgsLabelStyleConver.toCesiumVal=function(e,t,i){return this.labelStyleConver||(this.labelStyleConver=new CgsLabelStyleConver),this.labelStyleConver.attr=i,t=this.labelStyleConver.toCesiumVal(e,t)},CgsLabelStyleConver._toCesiumValBefore=function(e,t){t.horizontalOrigin=Cesium.defaultValue(t.horizontalOrigin,Cesium.HorizontalOrigin.CENTER),t.verticalOrigin=Cesium.defaultValue(t.verticalOrigin,Cesium.HorizontalOrigin.BOTTOM)},CgsLabelStyleConver._toCesiumValEnd=function(e,t){var i;Cesium.defined(e.font)||(i=(e.font_style||"normal")+" small-caps "+(e.font_weight||"normal")+" "+(e.font_size||"18")+"px "+(e.font_family||"楷体"),t.font=i),!Cesium.defined(e.style)&&Cesium.defaultValue(e.fill,!0)&&(e.outline?t.style=Cesium.LabelStyle.FILL_AND_OUTLINE:t.style=Cesium.LabelStyle.FILL)},CgsLabelStyleConver._getExcludedStyle=function(){return["font_style","font_weight","font_size","font_family","backgroundOpacity","fill","outline"]},CgsLabelStyleConver._toOneCesiumVal=function(e,t,i,s){switch(e){default:this._toOneCesiumVal_Point(e,t,i,s);break;case"text":this.attr&&(t=CgsUtil.template(t,this.attr,!0)),s.text=t.replace(new RegExp("<br />","gm"),"\n");break;case"color":s.fillColor=this.getColorByStyle(i);break;case"outlineColor":s.outlineColor=this.getOutlineColorByStyle(i);break;case"background":s.showBackground=t;break;case"backgroundColor":var o=Cesium.Color.fromCssColorString(t||"#000000");Cesium.defined(i.backgroundOpacity)?o=o.withAlpha(Number(i.backgroundOpacity)):Cesium.defined(i.opacity)&&(o=o.withAlpha(Number(i.opacity))),s.backgroundColor=o;break;case"backgroundPadding":s.backgroundPadding=new Cesium.Cartesian2(1.2*t,t);break;case"hasPixelOffset":t||(s.pixelOffset=new Cesium.Cartesian2(0,0));break;case"pixelOffsetX":case"pixelOffsetY":s.pixelOffset=new Cesium.Cartesian2(i.pixelOffsetX||0,i.pixelOffsetY||0);break;case"pixelOffset":Cesium.defined(t[0])&&Cesium.defined(t[1])?s.pixelOffset=new Cesium.Cartesian2(t[0],t[1]):s.pixelOffset=t}},CgsLabelStyleConver.toJSON=function(e,t){return this.labelStyleConver||(this.labelStyleConver=new LabelStyleConver),this.labelStyleConver.toJSON(e,t)},CgsLabelStyleConver._toOneJson=function(e,t,i){switch(e){default:this._toOneJson_Point(e,t,i);break;case"pixelOffset":i.pixelOffsetX=t.x,i.pixelOffsetY=t.y;break;case"disableDepthTestDistance":t===Number.POSITIVE_INFINITY?i.visibleDepth=!1:i.disableDepthTestDistance=t}},CgsPolylineStyleConver=function(){},CgsInherits(CgsPolylineStyleConver,CgsBaseStyleConver),CgsPolylineStyleConver.prototype.toCesiumVal=function(e,t,i){return this.polylineStyleConver||(this.polylineStyleConver=new CgsPolylineStyleConver),this.polylineStyleConver.isEntity=i,this.polylineStyleConver.toCesiumVal(e,t)},CgsPolylineStyleConver.prototype.toCesiumValBefore=function(e,t){e.clampToGround&&(t.arcType=Cesium.ArcType.GEODESIC),e.materialType==MaterialType.Color&&e.outline&&e.outlineColor&&(e.materialType=MaterialType.PolylineOutline)},CgsPolylineStyleConver.prototype.toOneCesiumVal=function(e,t,i,s){switch(e){default:this.toOneCesiumVal_Poly(e,t,i,s);break;case"distanceDisplayCondition":s.distanceDisplayCondition=t?new Cesium.DistanceDisplayCondition(Number(Cesium.defaultValue(i.distanceDisplayCondition_near,0)),Number(Cesium.defaultValue(i.distanceDisplayCondition_far,1e5))):void 0;break;case"depthFail":t?(s.depthFailMaterial=Cesium.Color.fromCssColorString(i.depthFailColor||"#FFFF00").withAlpha(Number(Cesium.defaultValue(i.depthFailOpacity,Cesium.defaultValue(i.opacity,.9)))),1==i.opacity&&(i.opacity=.9)):s.depthFailMaterial=void 0;break;case"closure":this.isEntity||(s.loop=t)}},CgsPolylineStyleConver.prototype.toJSON=function(e,t,i){return this.polylineStyleConver||(this.polylineStyleConver=new CgsPolylineStyleConver),this.polylineStyleConver.isEntity=i,this.polylineStyleConver.toJSON(e,t)},CgsPolylineStyleConver.prototype.toOneJson=function(e,t,i){"loop"!==e?this.toOneJson_Poly(e,t,i):i.closure=t},CgsRectangleStyleConver=function(){},CgsInherits(CgsRectangleStyleConver,CgsBaseStyleConver),CgsRectangleStyleConver.toCesiumVal=function(e,t,i){return this.rectangleStyleConver||(this.rectangleStyleConver=new CgsRectangleStyleConver),this.rectangleStyleConver.isEntity=i,this.rectangleStyleConver.toCesiumVal(e,t)},CgsRectangleStyleConver.toCesiumValBefore=function(e,t){e.clampToGround?(e.hasOwnProperty("height")&&delete e.height,e.hasOwnProperty("diffHeight")&&delete e.diffHeight,e.hasOwnProperty("extrudedHeight")&&delete e.extrudedHeight):(e.clampToGround=!1,t.height=0)},CgsRectangleStyleConver.toOneCesiumVal=function(e,t,i,s){switch(e){default:this.toOneCesiumValPoly(e,t,i,s);break;case"height":s.height=t,i.diffHeight&&(s.diffHeight=Number(i.diffHeight)+Number(t));break;case"diffHeight":0<t&&Cesium.defined(i.height)&&(s.extrudedHeight=i.height+t);break;case"rotation":s.rotation=t,i.stRotation||(s.stRotation=s.rotation);break;case"rotationDegree":s.rotation=Cesium.Math.toRadians(t),i.stRotation||(s.stRotation=s.rotation);break;case"stRotationDegree":s.stRotation=Cesium.Math.toRadians(t)}},CgsRectangleStyleConver.toJSON=function(e,t,i){return this.rectangleStyleConver||(this.rectangleStyleConver=new RectangleStyleConver),this.rectangleStyleConver.isEntity=i,this.rectangleStyleConver.toJSON(e,t)},CgsRectangleStyleConver.toOneJson=function(e,t,i){this.toOneJsonPoly(e,t,i)},CgsCorridorStyleConver=function(){},CgsInherits(CgsCorridorStyleConver,CgsBaseStyleConver),CgsCorridorStyleConver.prototype.toCesiumVal=function(e,t,i){return this.corridorStyleConver||(this.corridorStyleConver=new CgsCorridorStyleConver),this.corridorStyleConver.isEntity=i,this.corridorStyleConver.toCesiumVal(e,t)},CgsCorridorStyleConver.prototype._toCesiumValBefore=function(e,t){e.clampToGround&&(e.hasOwnProperty("height")&&delete e.height,e.hasOwnProperty("extrudedHeight")&&delete e.extrudedHeight,e.hasOwnProperty("diffHeight")&&delete e.diffHeight)},CgsCorridorStyleConver.prototype._toOneCesiumVal=function(e,t,i,s){switch(e){default:this._toOneCesiumVal_Poly(e,t,i,s);break;case"outlineColor":s.outlineColor=this.getOutlineColorByStyle(i);break;case"height":s.height=t,i.diffHeight&&(s.extrudedHeight=Number(i.diffHeight)+Number(t));break;case"diffHeight":0<t&&Cesium.defined(i.height)&&(s.extrudedHeight=i.height+t)}},CgsCorridorStyleConver.prototype.toJSON=function(e,t,i){return this.corridorStyleConver||(this.corridorStyleConver=new CgsCorridorStyleConver),this.corridorStyleConver.isEntity=i,this.corridorStyleConver.toJSON(e,t)},CgsCorridorStyleConver.prototype._toOneJson=function(e,t,i){this._toOneJson_Poly(e,t,i)},CgsBaseGraphic=function(e){(e=e||new Object).style=e.style||{},e.attr=e.attr||{},this.options=e,this._uuid=CgsUtil.uuid(),this._id=Cesium.defaultValue(e.id,this._uuid),this._name=e.attr.name||e.name||"",this._show=Cesium.defaultValue(e.show,!0),this.popup=e.popup,this.tooltip=e.tooltip,this.contextmenuItems=e.contextmenuItems,this._state=State.INITIALIZED},CgsInherits(CgsBaseGraphic,CgsBaseClass),CgsBaseGraphic.prototype.getType=function(){return this._type},CgsBaseGraphic.prototype.getUuid=function(){return this._uuid},CgsBaseGraphic.prototype.getId=function(){return this._id},CgsBaseGraphic.prototype.setId=function(e){this._id=e},CgsBaseGraphic.prototype.getState=function(){return this._state},CgsBaseGraphic.prototype.getIsAdded=function(){return this._state==State.ADDED},CgsBaseGraphic.prototype.getCzmObject=function(){return null},CgsBaseGraphic.prototype.getCzmObjectEx=function(){return null},CgsBaseGraphic.prototype.getShow=function(){return this._show},CgsBaseGraphic.prototype.setShow=function(t){this._show!=t&&(this._show=t,this.czmObject&&(this.czmObject.show=this._show),this.czmObjectEx&&this.czmObjectEx.forEach(function(e){e.show=t}),this._showHook&&this._showHook(t),t?this.fire(EventType.show,{graphic:this}):this.fire(EventType.hide,{graphic:this}))},CgsBaseGraphic.prototype.getName=function(){return this._name},CgsBaseGraphic.prototype.setName=function(e){this._name=e},CgsBaseGraphic.prototype.getAttr=function(){return this.options.attr},CgsBaseGraphic.prototype.setAttr=function(e){this.options.attr=e,this.fire(EventType.updateAttr,{graphic:this,attr:e},!0)},CgsBaseGraphic.prototype.getStyle=function(){return this.options.style},CgsBaseGraphic.setStyle=function(e){this.setStyle(e)},CgsBaseGraphic.prototype.getCenter=function(){return null},CgsBaseGraphic.prototype.getCenterPoint=function(){return CgsLatLngPoint.fromCartesian(this.center)},CgsBaseGraphic.prototype.addTo=function(e){return e&&e.addGraphic&&e.addGraphic(this),this},CgsBaseGraphic.prototype.remove=function(e){this._layer&&this._layer.removeGraphic(this,e)},CgsBaseGraphic.prototype.bindPickId=function(e){return e._mars3d_layerId=this._layer._uuid,e._mars3d_graphicId=this._uuid,this},CgsBaseGraphic.prototype._onAdd=function(e){var t=this;this._state!=State.ADDED&&(this._layer=e,this._map=e._map,this.options.stopPropagation||this.addEventParent(e),this.czmObject||this._mountedHook&&this._mountedHook(),this._addedHook&&this._addedHook(),this.czmObject&&this.bindPickId(this.czmObject),this.czmObjectEx&&this.czmObjectEx.forEach(function(e){t.bindPickId(e)}),this._state=State.ADDED,this.fire(EventType.add),this._isDragger||this.fire(EventType.addGraphic,{graphic:this},!0))},CgsBaseGraphic.prototype._onRemove=function(){this._state!=State.REMOVED&&this._layer&&(this._closeAllControl(),this._removedHook&&this._removedHook(),this._state=State.REMOVED,this.fire(EventType.remove),this._isDragger||this.fire(EventType.removeGraphic,{graphic:this},!0),this.options&&!this.options.stopPropagation&&this.removeEventParent(this._layer),this._layer=null,this._map=null)},CgsBaseGraphic.prototype._mountedHook=function(){},CgsBaseGraphic.prototype._addedHook=function(){},CgsBaseGraphic.prototype._removedHook=function(){},CgsBaseGraphic.prototype.setOptions=function(e){return e.attr&&(this.options.attr=CgsUtil.merge(this.options.attr,e.attr),this.fire(EventType.updateAttr,{graphic:this,attr:e.attr},!0)),e.style&&(this.options.style=CgsUtil.merge(this.options.style,e.style),this._updateStyleBaseHook(e.style),this.fire(EventType.updateStyle,{graphic:this,style:e.style},!0)),e.position&&(this.position=e.position),e.positions&&(this.positions=e.positions),this},CgsBaseGraphic.prototype.setStyle=function(e){return this.options.style=CgsUtil.merge(this.options.style,e),this._updateStyleBaseHook(e),this.fire(EventType.updateStyle,{graphic:this,style:e},!0),this},CgsBaseGraphic.prototype._updateStyleBaseHook=function(e){},CgsBaseGraphic.prototype.toGeoJSON=function(){var e={type:"Feature",properties:_extends({},this.attr,{id:this.id,type:this.type,style:this._style2JsonBase(this.style)}),geometry:this._getGeoJsonGeometry()};return Cesium.defined(this.options.edittype)&&(e.properties.edittype=this.options.edittype),e},CgsBaseGraphic.prototype.toJSON=function(){var e={id:this.id,type:this.type,attr:this.attr,style:this._style2JsonBase(this.style)};return this.coordinate?e.position=this.coordinate:this.coordinates?e.positions=this.coordinates:logError("toJSON:缺少坐标信息",this),e},CgsBaseGraphic.prototype._getGeoJsonGeometry=function(){return{}},CgsBaseGraphic.prototype._style2JsonBase=function(e){var t=void 0,t=this._style2Json?this._style2Json(e):CgsUtil.getAttrVal(e);return e.label&&(t.label=CgsLabelStyleConver.toJSON(e.label)),t},CgsBaseGraphic.prototype.getExtent=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.positionsShow||this.positions;if(t&&0!=t.length){var i=CgsUtil.getRectangle(t,e);return i?(i.height=CgsUtil.getMaxHeight(t),i):null}},CgsBaseGraphic.prototype.flyTo=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(this._map){var t=this.positionsShow||this.positions;return e.clampToGround=this.style.clampToGround,this._map.flyToPositions(t,e),this}},CgsBaseGraphic.prototype.hasPopup=function(){return null!=this.popup&&0!=this.popup},CgsBaseGraphic.prototype.bindPopup=function(e,t){return this.popup=_extends({html:e},t),this._onEventHook&&this._onEventHook("popup"),this},CgsBaseGraphic.prototype.unbindPopup=function(e){return this.popup=!e&&null,this._onEventHook&&this._onEventHook("popup"),this},CgsBaseGraphic.prototype.openPopup=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.popup&&this._map&&this._map.openPopup(e||this.center,this,_extends({heightReference:this.style.heightReference,clampToGround:this.style.clampToGround,event:{graphic:this}},t)),this},CgsBaseGraphic.prototype.closePopup=function(){return this._map&&this._map.closePopup(this),this},CgsBaseGraphic.prototype.hasTooltip=function(){return null!=this.tooltip&&0!=this.tooltip},CgsBaseGraphic.prototype.bindTooltip=function(e,t){return this.tooltip=_extends({html:e},t),this._onEventHook&&this._onEventHook("tooltip"),this},CgsBaseGraphic.prototype.unbindTooltip=function(e){return this.tooltip=!e&&null,this._onEventHook&&this._onEventHook("tooltip"),this},CgsBaseGraphic.prototype.openTooltip=function(e,t){return this.tooltip&&this._map&&this._map.openTooltip(e||this.center,this,t),this},CgsBaseGraphic.prototype.closeTooltip=function(){return this._map&&this._map.closeTooltip(this),this},CgsBaseGraphic.prototype.openSmallTooltip=function(e,t){return this._map&&this._map.openSmallTooltip(e,t),this},CgsBaseGraphic.prototype.closeSmallTooltip=function(){return this._map&&this._map.closeSmallTooltip(),this},CgsBaseGraphic.prototype.hasContextMenu=function(){return null!=this.contextmenuItems},CgsBaseGraphic.prototype.getContextMenu=function(){return this.contextmenuItems},CgsBaseGraphic.prototype.bindContextMenu=function(e,t){return this.contextmenuItems=e,this._onEventHook&&this._onEventHook("contextMenu"),this},CgsBaseGraphic.prototype.unbindContextMenu=function(e){return this.contextmenuItems=!e&&null,this._onEventHook&&this._onEventHook("contextMenu"),this},CgsBaseGraphic.prototype.openContextMenu=function(e,t){return this.contextmenuItems&&this._map&&this._map.openContextMenu(e||this.center,this,t),this},CgsBaseGraphic.prototype.closeContextMenu=function(){return this._map&&this._map.closeContextMenu(this),this},CgsBaseGraphic.prototype._closeAllControl=function(){this.closePopup(),this.closeTooltip(),this.closeSmallTooltip(),this.closeContextMenu()},CgsBaseGraphic.prototype.destroy=function(e){this._state!=State.REMOVED&&(this.clear&&this.clear(),this.remove())};var State={INITIALIZED:"inited",ADDED:"added",REMOVED:"removed",DESTROY:"destroy"};function addPositionsHeight(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,t=Number(t);if(isNaN(t)||0==t)return e;if(Array.isArray(e)){for(var i=[],s=0,o=e.length;s<o;s++){var a=Cesium.Cartographic.fromCartesian(e[s]),n=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,a.height+t);i.push(n)}return i}var r=Cesium.Cartographic.fromCartesian(e);return Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,r.height+t)}function setPositionsHeight(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!e)return e;if(Array.isArray(e)){for(var i=[],s=0,o=e.length;s<o;s++){var a=Cesium.Cartographic.fromCartesian(e[s]),n=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,t);i.push(n)}return i}var r=Cesium.Cartographic.fromCartesian(e);return Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,t)}CgsBaseEntity=function(){},CgsInherits(CgsBaseEntity,CgsBaseGraphic),CgsBaseEntity.prototype.getDataSource=function(){return this._layer.dataSource},CgsBaseEntity.prototype.getCzmObject=function(){return this._entity},CgsBaseEntity.prototype.getCzmObjectEx=function(){var e=[];return this._primitive_label&&e.push(this._primitive_label),this._entity_outlines&&(e=e.concat(this._entity_outlines)),e},CgsBaseEntity.prototype.getEntity=function(){return this._entity},CgsBaseEntity.prototype.getEntityGraphic=function(){return this._entity.point},CgsBaseEntity.prototype.getLabel=function(){return this._primitive_label?this._primitive_label.label:this._entity.label?this._entity.label:this.style.label?this.style.label:{}},CgsBaseEntity.prototype._mountedHook=function(){},CgsBaseEntity.prototype._addedHook=function(){var t=this;this.dataSource.entities.add(this.czmObject),this.czmObjectEx.forEach(function(e){e instanceof Cesium.Entity&&t.dataSource.entities.add(e)})},CgsBaseEntity.prototype._removedHook=function(){var t=this;this.stopEditing(),this.stopDraw(),this.dataSource.entities.remove(this.czmObject),this.czmObjectEx.forEach(function(e){e instanceof Cesium.Entity&&t.dataSource.entities.remove(e)}),this._primitive_label&&(this._layer.labelCollection.remove(this._primitive_label),delete this._primitive_label)},CgsBaseEntity.prototype._initFromEntity=function(e){return e.entityCollection&&e.entityCollection.remove(e),e._id=this.uuid,e},CgsBaseEntity.prototype._updateEditDraggers=function(){this._enabledEdit&&this.editing&&this.editing.updateDraggers()},CgsBaseEntity.prototype._updateStyleBaseHook=function(e){if(this.czmObject)return this._updateStyleHook(e,this._entity),e.label&&this._primitive_label&&(Cesium.defined(this.style.clampToGround)&&!Cesium.defined(this.style.label.clampToGround)&&(e.label.clampToGround=this.style.clampToGround),CgsLabelStyleConver.toCesiumVal(this.style.label,this._primitive_label,this.attr)),this._enabledEdit&&this.editing&&this.editing._updateStyleHook(e),this},CgsBaseEntity.prototype._updateStyleHook=function(e){},CgsBaseEntity.prototype._createEntity=function(e){return this.options.onBeforeCreate&&(e=this.options.onBeforeCreate(e)||e),new Cesium.Entity(_extends({id:this.uuid,name:this.name||this.id,properties:this.attr,show:this.show,availability:this.options.availability,description:this.options.description,viewFrom:this.options.viewFrom,parent:this.options.parent},e))},CgsBaseEntity.prototype._addLabel=function(){var e=this.style.label;if(e&&e.text){!Cesium.defined(this.style.clampToGround)||Cesium.defined(e.clampToGround)||Cesium.defined(e.height)||(e.clampToGround=this.style.clampToGround);var t=CgsLabelStyleConver.toCesiumVal(this.style.label,{},this.attr);return t.position=this._getLablePosition(),this._primitive_label=this._layer.labelCollection.add(t),this.bindPickId(this._primitive_label),this._primitive_label}},CgsBaseEntity.prototype._updateLabelPosition=function(){this._primitive_label&&(this._primitive_label.position=this._getLablePosition())},CgsBaseEntity.prototype._getLablePosition=function(){var e,t=this.style.label,i=void 0;return t.position&&("center"==t.position?i=this.centerOfMass:CgsUtil.isString(t.position)?(e=CgsUtil.template(t.position,this.attr,!0))&&(i=CgsLatLngPoint.parse(e).toCartesian()):i=CgsLatLngPoint.parse(t.position).toCartesian()),(i=i||this.center)?((Cesium.defined(t.height)||Cesium.defined(this.style.height))&&(i=setPositionsHeight(i,Cesium.defaultValue(t.height,this.style.height))),Cesium.defined(this.style.diffHeight)&&(i=addPositionsHeight(i,this.style.diffHeight)),Cesium.defined(t.setHeight)&&(i=setPositionsHeight(i,t.setHeight)),Cesium.defined(t.addHeight)&&(i=addPositionsHeight(i,t.addHeight)),i):new Cesium.Cartesian3},CgsBaseEntity.prototype._getOutlineStyle=function(e){var t=_extends({},this.style);return delete t.material,delete t.materialType,_extends({},t,{show:Cesium.defaultValue(this.style.outline,!1),color:Cesium.defaultValue(this.style.outlineColor,this.style.color),opacity:Cesium.defaultValue(this.style.outlineOpacity,this.style.opacity),width:Cesium.defaultValue(this.style.outlineWidth,1),arcType:Cesium.defaultValue(this.style.arcType,this.style.clampToGround?Cesium.ArcType.GEODESIC:Cesium.ArcType.NONE)},this.style.outlineStyle||{},e||{})},CgsBaseEntity.prototype._updateOutlineStyle=function(e,t,i){var s=this._getOutlineStyle(i);if(s.show&&1<s.width){if(e.outline=!1,this._entity_outlines)for(var o=0,a=this._entity_outlines.length;o<a;o++){var n,r=this._entity_outlines[o].polyline;t&&t[o]&&((n=t[o])instanceof Cesium.CallbackProperty?r.positions=n:Array.isArray(n)&&0<n.length&&(r.positions=n.concat(n[0]))),CgsPolylineStyleConver.toCesiumVal(s,r,!0)}else if(t){this._entity_outlines=[];for(var l=0,u=t.length;l<u;l++){var p=t[l],h=CgsPolylineStyleConver.toCesiumVal(s,{},!0);p instanceof Cesium.CallbackProperty?h.positions=p:Array.isArray(p)&&0<p.length&&(h.positions=p.concat(p[0]));var c=this._createEntity({id:this.uuid+"-outline"+l,polyline:h});this.bindPickId(c),this._entity_outlines.push(c),this._state==State.ADDED&&this.dataSource.entities.add(c)}}return!0}if(this._entity_outlines)for(var g=0,d=this._entity_outlines.length;g<d;g++){this._entity_outlines[g].polyline.show=!1}return e.outline=s.show&&1==s.width,!1},CgsBaseEntity.prototype._updateOutlineToCallback=function(){var t=this;if(this._entity_outlines)for(var e=0,i=this._entity_outlines.length;e<i;e++){var s=this._entity_outlines[e];s.polyline.positions instanceof Cesium.CallbackProperty||(s.polyline.positions=new Cesium.CallbackProperty(function(e){return t.outlinePositions},!1))}},CgsBaseEntity.prototype._cancelOutlinePositionsCallback=function(){if(this._entity_outlines)for(var e=0,t=this._entity_outlines.length;e<t;e++){var i=this._entity_outlines[e];i.polyline.positions instanceof Cesium.CallbackProperty&&(i.polyline.positions=this.outlinePositions)}},CgsBaseEntity.prototype.setOpacity=function(e){var t,i,s=e*(this.style.opacity||1);this.entityGraphic.material.color&&this._updatEntityAlpha(this.entityGraphic.material.color,s),this._entity.label&&(t=e*(this.style.label.opacity||1),this._entity.label.fillColor&&this._updatEntityAlpha(this._entity.label.fillColor,t),this._entity.label.outlineColor&&this._updatEntityAlpha(this._entity.label.outlineColor,t),this._entity.label.backgroundColor&&this._updatEntityAlpha(this._entity.label.backgroundColor,t)),this._primitive_label&&(i=e*(this.style.label.opacity||1),this._primitive_label.fillColor&&this._updatEntityAlpha(this._primitive_label.fillColor,i),this._primitive_label.outlineColor&&this._updatEntityAlpha(this._primitive_label.outlineColor,i),this._primitive_label.backgroundColor&&this._updatEntityAlpha(this._primitive_label.backgroundColor,i))},CgsBaseEntity.prototype._updatEntityAlpha=function(e,t){if(e){var i=CgsUtil.getCesiumColor(e,Cesium.Color,this._map.clock.currentTime);if(!i||!i.withAlpha)return e;i=i.withAlpha(t),e.setValue(i)}},CgsBaseEntity.prototype.startDraw=function(e){if(this._enabledDraw)return this;if(this._enabledDraw=!0,e&&this.addTo(e),!this._map)throw new Error("绘制时_map不能为空,请将对象添加到图层，并且图层已添加到Map");this._map.mouseEvent.noPickEntity=this._entity,this._map.setCursor(!0),this.enableControl(!1),this._setPositionsToCallback(),this._startDrawHook(),this.fire(EventType.drawStart,{drawtype:this.type,graphic:this},!0)},CgsBaseEntity.prototype.stopDraw=function(){if(!this._enabledDraw)return this;this._stopDrawHook(),this._map.setCursor(!1),this.enableControl(!0),this._map.closeSmallTooltip(),this._map.mouseEvent.noPickEntity=null,this._enabledDraw=!1,!(this._position_draw||this._positions_draw&&0!=this._positions_draw.length)||this._positions_draw&&this._positions_draw.length<this._minPointNum?this.remove():(this._layer.options.isRestorePositions&&this._cancelPositionsCallback(),this.options.success&&this.options.success(this),this.fire(EventType.drawCreated,{drawtype:this.type,graphic:this},!0))},CgsBaseEntity.prototype._setPositionsToCallback=function(){},CgsBaseEntity.prototype._cancelPositionsCallback=function(){},CgsBaseEntity.prototype._startDrawHook=function(){},CgsBaseEntity.prototype._stopDrawHook=function(){},CgsBaseEntity.prototype._showDrawMouseMoveSmallTooltip=function(e){var t,i=e.endPosition;this._positions_draw.length<=1?this._map.openSmallTooltip(i,this._map.getLangText("_单击开始绘制")):this._positions_draw.length<this._minPointNum?this._map.openSmallTooltip(i,this._map.getLangText("_单击增加点右击删除点")):this._positions_draw.length>=this._maxPointNum?this._map.openSmallTooltip(i,this._map.getLangText("_单击完成绘制")):(t=this._map.getLangText("_单击增加点右击删除点")+"<br/>"+this._map.getLangText("_双击完成绘制"),this._map.openSmallTooltip(i,t))},CgsBaseEntity.prototype._onMouseMoveHandler=function(e){this._showDrawMouseMoveSmallTooltip(e);var t=e.cartesian;t&&(this.lastPointTemporary&&this._positions_draw.pop(),this.lastPointTemporary=!0,this._positions_draw.push(t),this.updateAttrForDrawing(!1),this.fire(EventType.drawMouseMove,_extends({},e,{drawtype:this.type,graphic:this,positions:this._positions_draw}),!0))},CgsBaseEntity.prototype._onClickHandler=function(e){var t,i=(new Date).getTime()-(this._last_clickTime||0);this._last_clickTime&&i<200||(this._last_clickTime=(new Date).getTime(),this._last_clickPositionX&&Math.abs(this._last_clickPositionX-e.windowPosition.x)<10&&Math.abs(this._last_clickPositionY-e.windowPosition.y)<10||(this._last_clickPositionX=e.windowPosition.x,this._last_clickPositionY=e.windowPosition.y,!(t=e.cartesian)&&this.lastPointTemporary&&(t=this._positions_draw[this._positions_draw.length-1]),t&&(this.lastPointTemporary&&this._positions_draw.pop(),this.lastPointTemporary=!1,this.removeNearPoint(),this.options.addHeight&&(t=addPositionsHeight(t,this.options.addHeight)),this._positions_draw.push(t),this.updateAttrForDrawing(!1),this.fire(EventType.drawAddPoint,_extends({},e,{drawtype:this.type,graphic:this,positions:this._positions_draw}),!0),this._positions_draw.length>=this._maxPointNum&&this.stopDraw())))},CgsBaseEntity.prototype._onRightClickHandler=function(e){this._positions_draw.pop();var t=e.cartesian;t&&(this.lastPointTemporary&&this._positions_draw.pop(),this.lastPointTemporary=!0,this.fire(EventType.drawRemovePoint,_extends({},e,{drawtype:this.type,graphic:this,positions:this._positions_draw}),!0),this._positions_draw.push(t),this.updateAttrForDrawing(!1))},CgsBaseEntity.prototype._onDbClickHandler=function(e){this.removeNearPoint(),this.endDraw()},CgsBaseEntity.prototype.removeNearPoint=function(){if(!(this._positions_draw.length<3))for(var e=this._positions_draw.length-1;0<e;e--){var t=this._positions_draw[e],i=this._positions_draw[e-1];if(!(Cesium.Cartesian3.distance(t,i)<.01))break;this._positions_draw.splice(e,1)}},CgsBaseEntity.prototype.endDraw=function(){if(!this._enabledDraw)return this;this._positions_draw.length<this._minPointNum||(this.updateAttrForDrawing(!1),this.stopDraw())},CgsBaseEntity.prototype.updateAttrForDrawing=function(e){},CgsBaseEntity.prototype.enableControl=function(e){this._map.mouseEvent.enabledMoveTarget=e,this._map.popup&&(this._map.popup.enabled=e),this._map.tooltip&&(this._map.tooltip.enabled=e),this._map.contextmenu&&(this._map.contextmenu.enabled=e)},CgsBaseEntity.prototype.startEditing=function(){if(this._enabledEdit)return this;if(this._enabledEdit=!0,!this._map)throw new Error("编辑时_map不能为空,请将对象添加到图层，并且图层已添加到Map");this._map.mouseEvent.noPickEntity=this._entity,this._map.mouseEvent.enabledMoveTarget=!1,this.editing||(this.editing=new this.EditClass(this)),this.editing.activate&&this.editing.activate()},CgsBaseEntity.prototype.stopEditing=function(){if(!this._enabledEdit)return this;this.editing.disable&&this.editing.disable(),this._map.closeSmallTooltip(),this._map.mouseEvent.noPickEntity=null,this._map.mouseEvent.enabledMoveTarget=!0,this._enabledEdit=!1};var EventType={add:"add",remove:"remove",addGraphic:"addGraphic",removeGraphic:"removeGraphic",addLayer:"addLayer",removeLayer:"removeLayer",update:"update",updateStyle:"updateStyle",updateAttr:"updateAttr",show:"show",hide:"hide",start:"start",change:"change",endItem:"endItem",end:"end",stop:"stop",loadBefore:"loadBefore",load:"load",error:"error",loadConfig:"loadConfig",click:"click",clickGraphic:"clickGraphic",clickTileGraphic:"clickTileGraphic",clickMap:"clickMap",dblClick:"dblClick",leftDown:"leftDown",leftUp:"leftUp",mouseMove:"mouseMove",mouseMoveTarget:"mouseMoveTarget",wheel:"wheel",rightClick:"rightClick",rightDown:"rightDown",rightUp:"rightUp",middleClick:"middleClick",middleDown:"middleDown",middleUp:"middleUp",pinchStart:"pinchStart",pinchEnd:"pinchEnd",pinchMove:"pinchMove",mouseDown:"mouseDown",mouseUp:"mouseUp",mouseOver:"mouseOver",mouseOut:"mouseOut",keydown:"keydown",keyup:"keyup",drawStart:"drawStart",drawMouseMove:"drawMouseMove",drawAddPoint:"drawAddPoint",drawRemovePoint:"drawRemovePoint",drawCreated:"drawCreated",editStart:"editStart",editMouseDown:"editMouseDown",editMouseMove:"editMouseMove",editMovePoint:"editMovePoint",editRemovePoint:"editRemovePoint",editStyle:"editStyle",editStop:"editStop",move:"move",initialTilesLoaded:"initialTilesLoaded",allTilesLoaded:"allTilesLoaded",addTile:"addTile",addTileSuccess:"addTileSuccess",addTileError:"addTileError",removeTile:"removeTile",cameraMoveStart:"cameraMoveStart",cameraMoveEnd:"cameraMoveEnd",cameraChanged:"cameraChanged",preUpdate:"preUpdate",postUpdate:"postUpdate",preRender:"preRender",postRender:"postRender",morphStart:"morphStart",morphComplete:"morphComplete",clockTick:"clockTick"};CgsBasePolyEntity=function(e){e=e||new Object,this.options=e,this.hasEdit=Cesium.defaultValue(this.options.hasEdit,!0),this._minPointNum=Cesium.defaultValue(e.minPointNum,2),this._maxPointNum=Cesium.defaultValue(e.maxPointNum,9999),this._hasMoveEdit=Cesium.defaultValue(e.hasMoveEdit,!0),e.positions&&(this.positions=e.positions)},CgsInherits(CgsBasePolyEntity,CgsBaseEntity),CgsBasePolyEntity.prototype.getCenter=function(){return this.style.closure?this.centerOfMass:this.centerOfLine},CgsBasePolyEntity.prototype.getCenterOfMass=function(){var e=this.positionsShow;return!e||e.length<2?null:CgsUtil.centerOfMass(e)},CgsBasePolyEntity.prototype.getCenterOfLine=function(){var e=this.positionsShow;return!e||e.length<2?null:e.length<10?CgsUtil.sliceByMaxDistance(e,this.distance/2,{point:!0}):e[Math.floor(e.length/2)]},CgsBasePolyEntity.prototype.getDistance=function(){return CgsMeasureUtil.getDistance(this.positionsShow)},CgsBasePolyEntity.prototype.getArea=function(){return CgsMeasureUtil.getArea(this.positionsShow)},CgsBasePolyEntity.prototype.getPositions=function(){return this._positions},CgsBasePolyEntity.prototype.setPositions=function(e){var s,o,a=this;e&&(Array.isArray(e)?(s=[],o=[],e.forEach(function(e,t){var i=CgsLatLngPoint.parse(e);i&&(Cesium.defined(a.style.setHeight)&&(Array.isArray(a.style.setHeight)?i.alt=a.style.setHeight[t]||0:i.alt=a.style.setHeight),Cesium.defined(a.style.addHeight)&&(Array.isArray(a.style.addHeight)?a.style.addHeight[t]&&(i.alt=i.alt+a.style.addHeight[t]):i.alt=i.alt+a.style.addHeight),s.push(i),o.push(i.toCartesian()))}),this._enabledEdit&&this.editing?this._positions_draw=o:this._positions=o,this._points=s):this._positions=e,this._entity&&this._updatePositionsHook())},CgsBasePolyEntity.prototype.getPositionsShow=function(){var e=CgsUtil.getCesiumValue(this._positions);return e instanceof Cesium.PolygonHierarchy?e=e.positions:e instanceof Cesium.Rectangle&&(e=this.outlinePositions),e},CgsBasePolyEntity.prototype.getPoints=function(){var e,i;return this._positions instanceof Cesium.CallbackProperty&&(e=void 0,this._positions_draw?e=this._positions_draw:(e=this.positionsShow,this.style.closure&&e.pop()),i=[],e.forEach(function(e){var t=CgsLatLngPoint.parse(e);t&&i.push(t)}),this._points=i),this._points},CgsBasePolyEntity.prototype.getCoordinates=function(){var t=[];return this.points.forEach(function(e){t.push(e.toArray())}),t},CgsBasePolyEntity.prototype.getRectangle=function(){return Cesium.Rectangle.fromCartesianArray(this.positions)},CgsBasePolyEntity.prototype.getEntityPositions=function(){return this.entityGraphic.positions},CgsBasePolyEntity.prototype._mountedHook=function(){},CgsBasePolyEntity.prototype._updateStyleHook=function(e){},CgsBasePolyEntity.prototype._updatePositionsHook=function(){this._updateLabelPosition(),this._updateEditDraggers()},CgsBasePolyEntity.prototype._getGeoJsonGeometry=function(){return{type:"LineString",coordinates:this.coordinates}},CgsBasePolyEntity.prototype.isInPoly=function(e){var t=CgsLatLngPoint.parse(e);if(!Cesium.Rectangle.contains(Cesium.Rectangle.fromCartesianArray(this.positionsShow),t.toCartographic()))return!1;var i={type:"Feature",geometry:{type:"Point",coordinates:t.toArray()}},s={type:"Polygon",coordinates:[this.coordinates]};return turf.booleanPointInPolygon(i,s)},CgsBasePolyEntity.prototype.clampToGround=function(){var i=this,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return CgsUtil.computeSurfacePoints({map:this._map,positions:this.positionsShow,callback:function(e,t){t||(i.positions=e),s.callback&&s.callback(e,t)}}),this},CgsBasePolyEntity.prototype._setPositionsToCallback=function(){var t=this;this._isCallbackPositions||(this._isCallbackPositions=!0,this._positions_draw=this._positions||[],this.positions=new Cesium.CallbackProperty(function(e){return t._positions_CallbackProperty()},!1),this._updateOutlineToCallback(),this.updateAttrForDrawing&&this.updateAttrForDrawing(!0))},CgsBasePolyEntity.prototype._positions_CallbackProperty=function(){return this._positions_draw},CgsBasePolyEntity.prototype._cancelPositionsCallback=function(){this._isCallbackPositions&&(this._isCallbackPositions=!1,this._positions=this._positions_draw,this._updatePositionsHook(),this._cancelOutlinePositionsCallback())},CgsBasePolyEntity.prototype._startDrawHook=function(){this._map.on(EventType.mouseMove,this._onMouseMoveHandler,this),this._map.on(EventType.click,this._onClickHandler,this),this._map.on(EventType.rightClick,this._onRightClickHandler,this),this._map.on(EventType.dblClick,this._onDbClickHandler,this)},CgsBasePolyEntity.prototype._stopDrawHook=function(){this._map.off(EventType.mouseMove,this._onMouseMoveHandler,this),this._map.off(EventType.click,this._onClickHandler,this),this._map.off(EventType.rightClick,this._onRightClickHandler,this),this._map.off(EventType.dblClick,this._onDbClickHandler,this)},CgsTextMaterialProperty=function(e){e=e||new Object,this.transparent=Cesium.defaultValue(e.transparent,!0),this._text=e.text,this._textStyles=CgsLabelStyleConver.toCesiumVal(e,{font:"23px 楷体",fill:!0,fillColor:new Cesium.Color(1,1,0,1),stroke:!0,strokeWidth:2,strokeColor:new Cesium.Color(1,1,1,.8),backgroundColor:new Cesium.Color(1,1,1,.1),textBaseline:"top",padding:10}),this.image=CgsUtil.getTextImage(this._text,this._textStyles)},CgsExtend(CgsTextMaterialProperty,Cesium.ImageMaterialProperty),CgsTextMaterialProperty.getText=function(){return this._text},CgsTextMaterialProperty.setText=function(e){this._text=e,this.image=CgsUtil.getTextImage(this._text,this._textStyles)},CgsTextMaterialProperty.getTextStyles=function(){return this._textStyles},CgsTextMaterialProperty.setTextStyles=function(e){this._textStyles=LabelStyleConver.toCesiumVal(e,this._textStyles),this.image=getTextImage(this._text,this._textStyles)},CgsMaterialType=function(){},CgsMaterialType.Color=Cesium.Material.ColorType,CgsMaterialType.Image=Cesium.Material.ImageType,CgsMaterialType.Grid=Cesium.Material.GridType,CgsMaterialType.Checkerboard=Cesium.Material.CheckerboardType,CgsMaterialType.Stripe=Cesium.Material.StripeType,CgsMaterialType.Water=Cesium.Material.WaterType,CgsMaterialType.PolylineDash=Cesium.Material.PolylineDashType,CgsMaterialType.PolylineOutline=Cesium.Material.PolylineOutlineType,CgsMaterialType.PolylineArrow=Cesium.Material.PolylineArrowType,CgsMaterialType.PolylineGlow=Cesium.Material.PolylineGlowType,CgsMaterialType.LineFlow="LineFlow",CgsMaterialType.LineFlowColor="LineFlowColor",CgsMaterialType.ODLine="ODLine",CgsMaterialType.LineFlicker="LineFlicker",CgsMaterialType.LineTrail="LineTrail",CgsMaterialType.WallScroll="WallScroll",CgsMaterialType.ScanLine="ScanLine",CgsMaterialType.CircleScan="CircleScan",CgsMaterialType.CircleWave="CircleWave",CgsMaterialType.RadarLine="RadarLine",CgsMaterialType.RadarWave="RadarWave",CgsMaterialType.Text="Text",CgsMaterialType.RectSlide="RectSlide",CgsMaterialType.PolyGradient="PolyGradient",CgsMaterialType.PolyAsphalt="PolyAsphalt",CgsMaterialType.PolyBlob="PolyBlob",CgsMaterialType.PolyFacet="PolyFacet",CgsMaterialType.PolyGrass="PolyGrass",CgsMaterialType.PolyWood="PolyWood",CgsMaterialType.EllipsoidElectric="EllipsoidElectric",CgsMaterialType.EllipsoidWave="EllipsoidWave",CgsMaterialType.CylinderWave="CylinderWave";var OptsConverClass={},MaterialClass={},MaterialPropertyClass={};CgsMaterialUtil=function(){},CgsMaterialUtil.prototype.registerOptsConver=function(e,t){OptsConverClass[e],OptsConverClass[e]=t},CgsMaterialUtil.prototype.register=function(e,t){MaterialClass[e],MaterialClass[e]=t},CgsMaterialUtil.prototype.registerProperty=function(e,t){MaterialPropertyClass[e],MaterialPropertyClass[e]=t},CgsMaterialUtil.prototype.createMaterialProperty=function(e,t){this.registerProperty(CgsMaterialType.Color,Cesium.ColorMaterialProperty),this.registerProperty(CgsMaterialType.Image,Cesium.ImageMaterialProperty),this.registerProperty(CgsMaterialType.PolylineArrow,Cesium.PolylineArrowMaterialProperty),this.registerProperty(CgsMaterialType.PolylineOutline,Cesium.PolylineOutlineMaterialProperty),this.registerProperty(CgsMaterialType.PolylineDash,Cesium.PolylineDashMaterialProperty),this.registerProperty(CgsMaterialType.PolylineGlow,Cesium.PolylineGlowMaterialProperty),this.registerProperty(CgsMaterialType.Grid,Cesium.GridMaterialProperty),this.registerProperty(CgsMaterialType.Checkerboard,Cesium.CheckerboardMaterialProperty),this.registerProperty(CgsMaterialType.Stripe,Cesium.StripeMaterialProperty),this.registerProperty(CgsMaterialType.Text,CgsTextMaterialProperty);var i=MaterialPropertyClass[e];if(i){var s=OptsConverClass[e]||OptsConverClass.default;s&&(t.materialType=e,t=s.toCesiumVal(t,{},!0));var o=new i(t);return o._mars_type=e,o}},CgsMaterialUtil.prototype.createMaterial=function(e,t){if(e){var i=OptsConverClass[e]||OptsConverClass.default;i&&(t.materialType=e,t=i.toCesiumVal(t));var s=void 0,o=MaterialClass[e];return(s=o?new o(t):Cesium.Material.fromType(e,t))._mars_type=e,s}},CgsMaterialUtil.prototype.toJSON=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=void 0;e._mars_type?i=e._mars_type:e._template.type?i=e._template.type:e.getType&&(i=e.getType()),i||e instanceof Cesium.Color&&(i="Color");var s=OptsConverClass[i]||OptsConverClass.default;return s&&(t.materialType=i,s.toJSON(e,t)),t};var that=void 0;function getOutlinePositions(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(!e||!e.rectangle)return[];var i=CgsUtil.getCesiumValue(e.rectangle.coordinates,Cesium.Rectangle);if(!i)return[];var s=CgsUtil.getCesiumValue(e.rectangle.rotation,Number)||0,o=CgsUtil.getCesiumValue(e.rectangle.height,Number)||0,a=CgsUtil.getRectangleOuterPositions({rectangle:i,rotation:s,height:o});return t&&a.push(a[0]),a}CgsRectangleEntity=function(e){e=e||new Object,this.options=e,this.style=this.options.style,this.positions=e.positions,this._minPointNum=2,this._maxPointNum=2,this.options.coordinates&&(this._rectangle=this.options.coordinates),this.options.positions,that=this},CgsInherits(CgsRectangleEntity,CgsBasePolyEntity),CgsRectangleEntity.prototype.getEntityGraphic=function(){return this._entity.rectangle},CgsRectangleEntity.prototype.getCenter=function(){var e=CgsUtil.getCesiumValue(this.rectangle);return this.rectangle?Cesium.Cartographic.toCartesian(Cesium.Rectangle.center(e)):null},CgsRectangleEntity.prototype.getOutlinePositions=function(){return this._entity&&(this._outlinePositions=getOutlinePositions(this._entity)),this._outlinePositions},CgsRectangleEntity.prototype.setOutlinePositions=function(e){this._outlinePositions=e},CgsRectangleEntity.prototype.getOutlineCoordinates=function(){return CgsUtil.cartesians2lonlats(this.outlinePositions)},CgsRectangleEntity.prototype.getRectangle=function(){return!this._rectangle&&this.positions&&(this._rectangle=Cesium.Rectangle.fromCartesianArray(this.positions)),this._rectangle},CgsRectangleEntity.prototype.setRectangle=function(e){this._rectangle=e,this._entity&&(this.entityGraphic.coordinates=e)},CgsRectangleEntity.prototype.getPoints=function(){var i=[];return((this._positions_draw?this._positions_draw:this._positions)||getOutlinePositions(this._entity,!1)).forEach(function(e){var t=CgsLatLngPoint.parse(e);t&&i.push(t)}),this._points=i,this._points},CgsRectangleEntity.prototype.getDistance=function(){return CgsUtil.getDistance(this.outlinePositions)},CgsRectangleEntity.prototype.getArea=function(){return CgsUtil.getArea(this.outlinePositions)},CgsRectangleEntity.prototype.getEntityPositions=function(){if(!this._entity.rectangle)return null;var e=CgsUtil.getCesiumValue(this._entity.rectangle.coordinates,Cesium.Rectangle),t=CgsUtil.getCesiumValue(this._entity.rectangle.height,Number)||0;return[Cesium.Cartesian3.fromRadians(e.west,e.south,t),Cesium.Cartesian3.fromRadians(e.east,e.north,t)]},CgsRectangleEntity.prototype._mountedHook=function(){var e;this.options.entity?(this._entity=this._initFromEntity(this.options.entity),this.positions=this.getEntityPositions(),this._updateStyleHook(this.style)):((e={rectangle:CgsRectangleStyleConver.toCesiumVal(this.style,{},!0)}).rectangle.coordinates=this.rectangle,this._entity=this._createEntity(e),this.entityGraphic=this.getEntityGraphic(),this.outlinePositions=this.getOutlinePositions,this._updateHeight()),this._updateOutlineStyle(this.entityGraphic,[this.outlinePositions]),this.style.label&&this._addLabel()},CgsRectangleEntity.prototype._createEntity=function(e){return this.options.onBeforeCreate&&(e=this.options.onBeforeCreate(e)||e),new Cesium.Entity(_extends({id:this.uuid,name:this.name||this.id,properties:this.attr,show:this.show||!0,availability:this.options.availability,description:this.options.description,viewFrom:this.options.viewFrom,parent:this.options.parent,position:Cesium.Cartesian3.fromDegrees(121.479593,29.791632,13)},e))},CgsRectangleEntity.prototype._style2Json=function(e,t){return CgsRectangleStyleConver.toJSON(e,t)},CgsRectangleEntity.prototype._updateStyleHook=function(e){CgsRectangleStyleConver.toCesiumVal(this.style,this.entityGraphic,!0),this._updateOutlineStyle(this.entityGraphic,[this.outlinePositions]),(Cesium.defined(e.diffHeight)||Cesium.defined(e.height))&&this._updateHeight()},CgsRectangleEntity.prototype._updatePositionsHook=function(){this.rectangle=Cesium.Rectangle.fromCartesianArray(this.positions),this.outlinePositions=getOutlinePositions(this._entity),this._updateOutlineStyle(this.entityGraphic,[this.outlinePositions]),this._updateLabelPosition(),this._updateHeight(),this._updateEditDraggers()},CgsRectangleEntity.prototype._getGeoJsonGeometry=function(){return{type:"Polygon",coordinates:[this.coordinates]}},CgsRectangleEntity.prototype._setPositionsToCallback=function(){var t=this;this._isCallbackPositions||(this._isCallbackPositions=!0,this.positions?(this._positions_draw=this.positions,this._rectangle_draw=Cesium.Rectangle.fromCartesianArray(this.positions)):(this._positions_draw=[],this._rectangle_draw=null),this.rectangle=new Cesium.CallbackProperty(function(e){return t._rectangle_draw},!1),this._updateOutlineToCallback())},CgsRectangleEntity.prototype._cancelPositionsCallback=function(){this._isCallbackPositions&&(this._isCallbackPositions=!1,this._positions=this._positions_draw,this.rectangle=this._rectangle_draw,this._cancelOutlinePositionsCallback())},CgsRectangleEntity.prototype.updateAttrForDrawing=function(e){this._rectangle_draw=Cesium.Rectangle.fromCartesianArray(this._positions_draw),this._entity_outlines&&(this._updateOutlineToCallback(),this._outlinePositions=getOutlinePositions(this._entity)),this._updateHeight(!1),this._updateLabelPosition()},CgsRectangleEntity.prototype._updateHeight=function(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.style.clampToGround||(e=0,e=t&&Cesium.defined(this.style.height)?this.style.height:CgsUtil.getMaxHeight(this._positions_draw||this._positions),this.entityGraphic.height=e,this.style.height=e,Cesium.defined(this.style.diffHeight)&&(0<this.style.diffHeight?this.entityGraphic.extrudedHeight=e+this.style.diffHeight:this.entityGraphic.extrudedHeight=void 0))},CgsRectangleEntity.prototype.getOutlinePositions=function(e){return getOutlinePositions(this._entity,e)},CgsRectangleEntity.prototype.getOutlineCoordinates=function(e){return CgsUtil.cartesians2lonlats(this.getOutlinePositions(e))},CgsRectangleEntity.prototype.isInPoly=function(e){var t=CgsUtil.getCesiumValue(this._entity.rectangle.coordinates,Cesium.Rectangle);return Cesium.Rectangle.contains(t,CgsLatLngPoint.parse(e).toCartographic())},CgsRectangleEntity.prototype.flyTo=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(this._map)return e.clampToGround=this.style.clampToGround,this._map.flyToExtent(this.rectangle,e),this},CgsRectangleEntity.prototype.fromDraw=function(e,t){var i=new CgsRectangleEntity(t);return i.startDraw(e),i},CgsRectangleEntity.prototype.fromEntity=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(e.rectangle)return new CgsRectangleEntity(_extends({},t,{entity:e}))},CgsRectangleEntity.prototype.getType=function(){return"rectangle"},CgsRectangleEntity.prototype.getMap=function(){return this.map},CgsRectangleEntity.prototype.setMap=function(e){this.map=e},CgsScrollWall=function(e){this.feature3D=new CgsScrollWall3D(e)},CgsInherits(CgsScrollWall,CgsFeature),CgsScrollWall.prototype.getPositions=function(){return this.feature3D.getPositions()},CgsScrollWall.prototype.setPositions=function(e){this.feature3D.setPositions(e)},CgsScrollWall.prototype.getDiffHeight=function(){return this.feature3D.getDiffHeight()},CgsScrollWall.prototype.setDiffHeight=function(e){this.feature3D.setDiffHeight(e)},CgsScrollWall.prototype.getColor=function(){return this.feature3D.getColor()},CgsScrollWall.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsScrollWall.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsScrollWall.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsScrollWall.prototype.getReverse=function(){return this.feature3D.getReverse()},CgsScrollWall.prototype.setReverse=function(e){this.feature3D.setReverse(e)},CgsScrollWall.prototype.getShow=function(){return this.feature3D.getShow()},CgsScrollWall.prototype.setShow=function(e){this.feature3D.setShow(e)};var CgsScrollWall3D_STYLE={diffHeight:100,speed:10,style:1};CgsScrollWall3D=function(e){this.options=CgsScrollWall3D_STYLE,e=e||new Object,this.uuid=CgsUtil.createGuid(),this.id=this.uuid,this.options=e,this.posArr=e.positions;var i=[];e.positions.forEach(function(e){var t=CgsUtil.LatLngPointParse(e);t&&i.push(Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt))}),this.options.positions=i,this.primitiveCollection=new Cesium.PrimitiveCollection,this.addedHook()},CgsInherits(CgsScrollWall3D,CgsBasePolyPrimitive),CgsScrollWall3D.prototype.getCzmObject=function(){return this.primitive},CgsScrollWall3D.prototype.getPositions=function(){return this.posArr},CgsScrollWall3D.prototype.setPositions=function(e){this.posArr=e;var i=[];e.forEach(function(e){var t=CgsUtil.LatLngPointParse(e);t&&i.push(Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt))}),this.options.positions=i,this.removedHook(),this.addedHook()},CgsScrollWall3D.prototype.getDiffHeight=function(){return this.options.style.diffHeight},CgsScrollWall3D.prototype.setDiffHeight=function(e){this.options.style.diffHeight=e,this.removedHook(),this.addedHook()},CgsScrollWall3D.prototype.getColor=function(){return this.options.style.color},CgsScrollWall3D.prototype.setColor=function(e){this.options.style.color=e,this.removedHook(),this.addedHook()},CgsScrollWall3D.prototype.getSpeed=function(){return this.options.style.speed},CgsScrollWall3D.prototype.setSpeed=function(e){this.options.style.speed=e,this.removedHook(),this.addedHook()},CgsScrollWall3D.prototype.getShow=function(){return this.options.show},CgsScrollWall3D.prototype.setShow=function(e){this.options.show=e,this.removedHook(),this.addedHook()},CgsScrollWall3D.prototype.getReverse=function(){return this.options.style.reverse},CgsScrollWall3D.prototype.setReverse=function(e){this.options.style.reverse=e,this.removedHook(),this.addedHook()},CgsScrollWall3D.prototype.addedHook=function(){for(var e=this.options.positions,t=CgsUtil.addPositionsHeight(e,this.options.style.diffHeight),i=[],s=[],o=[],a=[],n=0,r=e.length;n<r;n++){var l=n+1;l==r&&(l=0),i.push.apply(i,[e[n].x,e[n].y,e[n].z]),i.push.apply(i,[e[l].x,e[l].y,e[l].z]),i.push.apply(i,[t[l].x,t[l].y,t[l].z]),i.push.apply(i,[t[n].x,t[n].y,t[n].z]),a.push.apply(a,[0,0,1]),a.push.apply(a,[0,0,1]),a.push.apply(a,[0,0,1]),a.push.apply(a,[0,0,1]),s.push.apply(s,[0,0,1,0,1,1,0,1]);var u=4*n,p=1+u,h=2+u,c=3+u;o.push.apply(o,[u,p,h,h,c,u])}var g=new Float64Array(i),d=new Cesium.GeometryInstance({id:this.uuid,geometry:new Cesium.Geometry({attributes:{position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:g}),normal:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array(a)}),st:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(s)})},indices:new Uint16Array(o),primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:Cesium.BoundingSphere.fromVertices(g)})}),m=CgsUtil.getColorByStyle(this.options.style);this.primitive=new Cesium.Primitive({geometryInstances:d,appearance:new Cesium.MaterialAppearance({material:new Cesium.Material({translucent:!0,fabric:{uniforms:{u_color:m,speed:this.options.style.speed,direction:this.options.style.reverse?1:-1},source:this.createShader()}}),vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\nvarying vec2 v_st;\nvarying vec3 v_normalEC;\nvarying vec3 v_positionEC;\nvoid main()\n{\nvec4 p = czm_translateRelativeToEye(position3DHigh,position3DLow);\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC = czm_normal * normal;\nv_st=st;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec3 positionToEyeEC = -v_positionEC;\nvec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nczm_materialInput materialInput;\nmaterialInput.normalEC = normalEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nmaterialInput.st = v_st;\nczm_material material = czm_getMaterial(materialInput);\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n}"}),asynchronous:!1,shadows:this.options.style.shadows,show:this.options.show}),this.primitiveCollection.add(this.primitive)},CgsScrollWall3D.prototype.removedHook=function(){this.primitive&&(this.primitiveCollection.remove(this.primitive),delete this.primitive)},CgsScrollWall3D.prototype.createShader=function(){if(2!=this.options.style.style){return"czm_material czm_getMaterial( czm_materialInput cmi )\n{\nczm_material material = czm_getDefaultMaterial(cmi);\nvec2 st = cmi.st;\nfloat t = fract(speed*czm_frameNumber/1000.0) * direction;\nvec2 st1 = vec2(st.s,fract(st.t - t));\nvec4 color = vec4(0.,0.,0.,0.);\nfloat tt = 0.5 - abs(0.5 - st1.t);\nfloat ss = st1.s ;\nfloat alpha = tt * 2.;\ncolor = vec4(u_color.rgb * u_color.a, alpha * 1.2);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}"}return"czm_material czm_getMaterial( czm_materialInput cmi )\n{\nczm_material material = czm_getDefaultMaterial(cmi);\nvec2 st = cmi.st;\nfloat t = fract(speed*czm_frameNumber/1000.0) * direction;\nvec2 st1 = vec2(fract(st.s - t),st.t);\nvec4 color = vec4(0.,0.,0.,0.);\nfloat alpha = 1.-st.t;\nfloat value = fract(st1.s/0.25);\nalpha *= sin(value * 3.1415926);\ncolor = vec4(u_color.rgb * u_color.a, alpha * 1.2);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}"},CgsScrollWall3D.prototype.getType=function(){return"ScrollWall"},CgsScrollWall3D.prototype.getMap=function(){return this.map},CgsScrollWall3D.prototype.setMap=function(e){this.map=e},CgsAlert=function(){alert(1)};var HeatMaterial="\n  uniform sampler2D image;\n  czm_material czm_getMaterial(czm_materialInput materialInput){\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    vec2 st = materialInput.st;\n    vec4 colorImage = texture2D(image,st);\n    if(colorImage.rgb == vec3(1.0) || colorImage.rgb == vec3(0.0)){\n      discard;\n    }\n    material.diffuse = colorImage.rgb;\n    material.alpha = colorImage.a;\n    return material;\n  }",DEF_HEATSTYLE={maxOpacity:.8,minOpacity:.1,blur:.85,radius:25,gradient:{.4:"blue",.6:"green",.8:"yellow",.9:"red"}},HEAT_DEF_STYLE={arcRadiusScale:1.5,arcBlurScale:1.5,vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT};function getMercatorBounds(e){var t=CgsUtil.lonlat2mercator([e.xmin,e.ymin]),i=CgsUtil.lonlat2mercator([e.xmax,e.ymax]);return{xmin:t[0],ymin:t[1],xmax:i[0],ymax:i[1]}}function geLatLngBounds(e){var t=CgsUtil.mercator2lonlat([e.xmin,e.ymin]),i=CgsUtil.mercator2lonlat([e.xmax,e.ymax]);return{xmin:t[0],ymin:t[1],xmax:i[0],ymax:i[1]}}CgsHeatMapLayer=function(e){for(var t in e)this[t]=e[t];for(var i in(this.options=e).maxCanvasSize?this.options.maxCanvasSize=e.maxCanvasSize:this.options.maxCanvasSize=document.body.clientWidth,e.minCanvasSize?this.options.minCanvasSize=e.minCanvasSize:this.options.minCanvasSize=document.body.clientHeight,this.options.maxCanvasSize=Math.min(this.options.maxCanvasSize,5e3),this.options.minCanvasSize=Math.max(this.options.minCanvasSize,700),e.heatStyle)DEF_HEATSTYLE[i]=e.heatStyle[i];for(var s in this.options.heatStyle=_extends({},DEF_HEATSTYLE),e.style)HEAT_DEF_STYLE[s]=e.style[s];this.options.style=_extends({},HEAT_DEF_STYLE),this.options.positions&&(this.positions=this.options.positions),this.updatePositionsHook()},CgsInherits(CgsHeatMapLayer,CgsBaseLayer),CgsHeatMapLayer.prototype.getLayer=function(){return this.graphic},CgsHeatMapLayer.prototype.getHeatStyle=function(){return this.options.heatStyle},CgsHeatMapLayer.prototype.setHeatStyle=function(e){this.options.heatStyle=CgsUtil.merge(this.options.heatStyle,e),this.heat&&this.heat.configure(this.options.heatStyle)},CgsHeatMapLayer.prototype.getStyle=function(){return this.options.style},CgsHeatMapLayer.prototype.setStyle=function(e){this.options.style=CgsUtil.merge(this.options.style,e)},CgsHeatMapLayer.prototype.getPositions=function(){return this.positions},CgsHeatMapLayer.prototype.setPositions=function(e){this.positions=e,this.updatePositionsHook()},CgsHeatMapLayer.prototype.getRectangle=function(){return this.rectangle},CgsHeatMapLayer.prototype.distory=function(){this.heatStyle.container&&(this.map.container.removeChild(this.heatStyle.container),delete this.heatStyle.container),this.graphic&&(this.map.scene.primitives.remove(this.graphic),delete this.graphic)},CgsHeatMapLayer.prototype.addPosition=function(e){this.positions=this.positions||[],this.positions.push(e),this.updatePositionsHook()},CgsHeatMapLayer.prototype.updatePositionsHook=function(){if(!this.show||!this.map||!this.positions||0===this.positions.length)return this;var e=this.getHeatCanvasImg();return this.options.flyTo&&this.cameraflyTo(),this.style.arc?this.createArcGraphic(e):this.createGraphic(e),this},CgsHeatMapLayer.prototype.getHeatCanvasImg=function(){var e=this.positions,i=[],s=void 0,o=void 0,a=void 0,n=void 0;e.forEach(function(e){var t=CgsLatLngPoint.parse(e);t&&(t.value=e.value||1,n=null==s?(s=t.lng,o=t.lng,a=t.lat,t.lat):(s=Math.min(s,t.lng),o=Math.max(o,t.lng),a=Math.min(a,t.lat),Math.max(n,t.lat)),i.push(t))});var t=1.5*this.heatStyle.radius,r={xmin:s,xmax:o,ymin:a,ymax:n},l=getMercatorBounds(r),u=Math.abs(l.xmax-l.xmin),p=Math.abs(l.ymax-l.ymin),h=Math.max(u,p),c=Math.min(u,p);this.mBoundsMax=h;var g=1;h>this.options.maxCanvasSize?c/(g=h/this.options.maxCanvasSize)<this.options.minCanvasSize&&(g=c/this.options.minCanvasSize):c<this.options.minCanvasSize&&h/(g=c/this.options.minCanvasSize)>this.options.maxCanvasSize&&(g=h/this.options.maxCanvasSize);var d=u/g+2*t,m=p/g+2*t,f=t*g;l.xmin-=f,l.ymin-=f,l.xmax+=f,l.ymax+=f,r=geLatLngBounds(l),this.rectangle=Cesium.Rectangle.fromDegrees(r.xmin,r.ymin,r.xmax,r.ymax);var C=i[0].value||1,y=i[0].value||0,v=[];i.forEach(function(e){var t=CgsUtil.lonlat2mercator([e.lng,e.lat]),i=e.value||1,s=Math.round((t[0]-l.xmin)/g),o=Math.round((l.ymax-t[1])/g);C=Math.max(C,i),y=Math.min(y,i),v.push({x:s,y:o,value:i})});var b,D={min:y,max:C,data:v};this.lastHeatData=D,this.lastMBounds&&l.xmin===this.lastMBounds.xmin&&l.ymin===this.lastMBounds.ymin&&l.xmax===this.lastMBounds.xmax&&l.ymax===this.lastMBounds.ymax||(this.lastMBounds=l,this.heatStyle.container||((b=document.createElement("div")).className="Cgsheatmap",this.map.container.appendChild(b),this.heatStyle.container=b),this.heatStyle.container.style.cssText="\n        margin:0;\n        width:"+d+"px;\n        height:"+m+"px;",this.heat?this.heat.configure(this.heatStyle):this.heat=h337.create(this.heatStyle)),this.heat.setData(D);var S=this.heat._renderer.canvas.toDataURL("image/png");return this.heatStyle.container&&(this.map.container.removeChild(this.heatStyle.container),delete this.heatStyle.container),S},CgsHeatMapLayer.prototype.createGraphic=function(e){this.distory(),this.graphic=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance(_extends({},this.options,{geometry:new Cesium.RectangleGeometry(_extends({rectangle:this.rectangle},this.style))})),appearance:new Cesium.EllipsoidSurfaceAppearance({material:new Cesium.Material({fabric:{uniforms:{image:e},source:HeatMaterial},translucent:!0}),flat:!0})}),this.map.scene.primitives.add(this.graphic)},CgsHeatMapLayer.prototype.createArcGraphic=function(e){this.distory(),this.heat.configure(_extends({},this.options.heatStyle,{radius:this.options.heatStyle.radius*this.options.style.arcRadiusScale,blur:this.options.heatStyle.blur*this.options.style.arcBlurScale,gradient:{.25:"rgb(0,0,0)",.55:"rgb(140,140,140)",.85:"rgb(216,216,216)",1:"rgb(255,255,255)"}}));var t=this.heat._renderer.canvas.toDataURL("image/png"),i=Cesium.RenderState.fromCache({cull:{enabled:!0},depthTest:{enabled:!0},stencilTest:{enabled:!0,frontFunction:Cesium.StencilFunction.ALWAYS,frontOperation:{fail:Cesium.StencilOperation.KEEP,zFail:Cesium.StencilOperation.KEEP,zPass:Cesium.StencilOperation.REPLACE},backFunction:Cesium.StencilFunction.ALWAYS,backOperation:{fail:Cesium.StencilOperation.KEEP,zFail:Cesium.StencilOperation.KEEP,zPass:Cesium.StencilOperation.REPLACE},reference:2,mask:2},blending:Cesium.BlendingState.ALPHA_BLEND}),s=Math.floor(Cesium.defaultValue(this.style.diffHeight,.02*this.mBoundsMax))+.1,o=Cesium.defaultValue(this.style.splitNum,100),a=Math.max(this.rectangle.height,this.rectangle.width);this.style.granularity=a/=o,this.graphic=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance(_extends({},this.options,{geometry:new Cesium.RectangleGeometry(_extends({rectangle:this.rectangle},this.style))})),appearance:new Cesium.EllipsoidSurfaceAppearance({aboveGround:!0,renderState:i,material:new Cesium.Material({fabric:{uniforms:{image:e,repeat:new Cesium.Cartesian2(1,1),color:new Cesium.Color(1,1,1,.01),bumpMap:t},source:HeatMaterial},translucent:!0}),vertexShaderSource:"attribute vec3 position3DHigh;\n          attribute vec3 position3DLow;\n          attribute vec2 st;\n          attribute float batchId;\n          uniform sampler2D bumpMap_3;\n          varying vec3 v_positionMC;\n          varying vec3 v_positionEC;\n          varying vec2 v_st;\n          void main()\n          {\n            vec4 p = czm_computePosition();\n            v_positionMC = position3DHigh + position3DLow;\n            v_positionEC = (czm_modelViewRelativeToEye * p).xyz;\n            v_st = st;\n            vec4 color = texture2D(bumpMap_3, v_st);\n            float centerBump = distance(vec3(0.0),color.rgb);\n            vec3 upDir = normalize(v_positionMC.xyz);\n            vec3 disPos = upDir * centerBump * "+s+";\n            p +=vec4(disPos,0.0);\n            gl_Position = czm_modelViewProjectionRelativeToEye * p;\n          }\n        ",flat:!0})}),console.log(this.graphic),this.map.scene.primitives.add(this.graphic)},CgsHeatMapLayer.prototype.cameraflyTo=function(e){return this.options.center?this.map.setCameraView(this.options.center,{duration:e}):this.options.extent?this.map.flyToExtent(this.options.extent,{duration:e}):this.rectangle&&this.map.camera.flyTo({destination:this.rectangle}),this},CgsPitWallGeometry=function(e){var t=(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT)).minimumArr,i=e.maximumArr;Cesium.Check.defined("dingmian",i),Cesium.Check.defined("dimianmian",t),Cesium.Check.typeOf.number.greaterThanOrEquals("dingmian.length",i.length,3),Cesium.Check.typeOf.number.greaterThanOrEquals("dimian.length",t.length,3);var s=new Cesium.VertexFormat({st:!0,position:!0,bitangent:!1,normal:!1,color:!1,tangent:!1});this._minimumArr=Cesium.clone(t),this._maximumArr=Cesium.clone(i),this._vertexFormat=s,this._workerName=""},CgsPitWallGeometry.prototype.createGeometry=function(e,t,i){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=e._minimumArr,a=e._maximumArr,n=e._vertexFormat,r=new Cesium.GeometryAttributes,l=void 0,u=void 0,p=void 0,h=void 0;if(Cesium.defined(n.position)&&Cesium.defined(n.st)){if(Cesium.defined(n.position)){u=new Float64Array(4*a.length*3);for(var c=0;c<a.length;c++)c==a.length-1?(u[12*c+0]=a[c].x,u[12*c+1]=a[c].y,u[12*c+2]=a[c].z,u[12*c+3]=o[c].x,u[12*c+4]=o[c].y,u[12*c+5]=o[c].z,u[12*c+9]=o[0].x,u[12*c+10]=o[0].y,u[12*c+11]=o[0].z,u[12*c+6]=a[0].x,u[12*c+7]=a[0].y,u[12*c+8]=a[0].z):(u[12*c+0]=a[c].x,u[12*c+1]=a[c].y,u[12*c+2]=a[c].z,u[12*c+3]=o[c].x,u[12*c+4]=o[c].y,u[12*c+5]=o[c].z,u[12*c+9]=o[c+1].x,u[12*c+10]=o[c+1].y,u[12*c+11]=o[c+1].z,u[12*c+6]=a[c+1].x,u[12*c+7]=a[c+1].y,u[12*c+8]=a[c+1].z);r.position=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:u})}if(Cesium.defined(n.st)){for(var g=new Float32Array(4*a.length*2),d=a.length,m=0;m<a.length;m++){var f=m/d,C=((t&&t[m]||0)-i)/(s-i),y=m+1,v=y/d,b=((t&&t[y]||0)-i)/(s-i);g[8*m+0]=f,g[8*m+1]=C,g[8*m+2]=f,g[8*m+3]=C-C,g[8*m+4]=v,g[8*m+5]=b,g[8*m+6]=v,g[8*m+7]=b-b}r.st=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:g})}l=new Uint16Array(2*a.length*3),p=new Cesium.Cartesian3(9999999999999,9999999999999,9999999999999),h=new Cesium.Cartesian3(-9999999999999,-9999999999999,-9999999999999);for(var D=0;D<a.length;D++)l[6*D+0]=4*D+0,l[6*D+1]=4*D+1,l[6*D+2]=4*D+2,l[6*D+3]=4*D+1,l[6*D+4]=4*D+2,l[6*D+5]=4*D+3,a[D].x>=h.x&&a[D].y>=h.y&&a[D].z>=h.z&&(h=a[D]),o[D].x<=p.x&&o[D].y<=p.y&&o[D].z<=p.z&&(p=o[D])}var S=Cesium.Cartesian3.subtract(h,p,new Cesium.Cartesian3),_=.5*Cesium.Cartesian3.magnitude(S);return new Cesium.Geometry({attributes:r,indices:l,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO,_)})},CgsPit3D=function(e){this.options=e,this.map=e.map,this.style=e.style,this.posArr=e.positions,this.style.diffHeight=Cesium.defaultValue(this.options.style.diffHeight,10),this.style.splitNum=Cesium.defaultValue(this.options.style.splitNum,50),this.primitiveCollection=new Cesium.PrimitiveCollection;var i=[];e.positions.forEach(function(e){var t=CgsUtil.LatLngPointParse(e);t&&i.push(Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt))}),this.positions=i,this.addedHook()},CgsInherits(CgsPit3D,CgsBasePolyPrimitive),CgsPit3D.prototype.getCzmObjectEx=function(){var e=[];return this.bottomPrimitive&&e.push(this.bottomPrimitive),this.primitivelabel&&e.push(this.primitivelabel),e},CgsPit3D.prototype.getCenter=function(){return this.centerOfMass},CgsPit3D.prototype.getPosition=function(){return this.posArr},CgsPit3D.prototype.setPosition=function(e){this.posArr=e;var i=[];e.forEach(function(e){var t=CgsUtil.LatLngPointParse(e);t&&i.push(Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt))}),this.positions=i,this.removedHook(),this.addedHook()},CgsPit3D.prototype.getImage=function(){return this.style.image},CgsPit3D.prototype.setImage=function(e){this.style.image=e,this.removedHook(),this.addedHook()},CgsPit3D.prototype.getImageBottom=function(){return this.style.imageBottom},CgsPit3D.prototype.setImageBottom=function(e){this.style.imageBottom=e,this.removedHook(),this.addedHook()},CgsPit3D.prototype.getDiffHeight=function(){return this.style.diffHeight},CgsPit3D.prototype.setDiffHeight=function(e){this.style.diffHeight=e;for(var t=[],i=this.minHeight-e,s=this.wellData.cartoList,o=0,a=s.length;o<a;o++){var n=s[o];t.push(Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,i))}this.wellData.bottomPositions=t,this.removePit(),this.createPit(this.wellData)},CgsPit3D.prototype.getWellData=function(){if(0!=this.options.positions.length){this.minHeight=CgsUtil.getMinHeight(this.options.positions);for(var e=this.minHeight-this.style.diffHeight,t=[],i=[],s=[],o=CgsUtil.PolyinterPolyline({scene:this.map.scene,positions:this.positions.concat(this.positions[0]),splitNum:this.style.splitNum}),a=0,n=o.length;a<n;a++){var r=Cesium.Cartographic.fromCartesian(o[a]);s.push(new Cesium.Cartographic(r.longitude,r.latitude)),i.push(Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,e)),t.push(Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,0))}return{cartoList:s,bottomPositions:i,wallTopPositions:t}}},CgsPit3D.prototype.addedHook=function(){var e=this.getWellData();this.wellData=e,this.createPit(e),this.style.label},CgsPit3D.prototype.removedHook=function(){this.removePit()},CgsPit3D.prototype.removePit=function(){this.primitive&&(this.primitiveCollection.remove(this.primitive),delete this.primitive),this.bottomPrimitive&&(this.primitiveCollection.remove(this.bottomPrimitive),delete this.bottomPrimitive)},CgsPit3D.prototype.createPit=function(r){var e,l=this;this.createBottomSurface(r.bottomPositions),this.map.hasTerrain?(e=Cesium.sampleTerrainMostDetailed(this.map.terrainProvider,r.cartoList),Cesium.when(e,function(e){for(var t=[],i=-9999,s=[],o=0,a=e.length;o<a;o++){var n=e[o];t.push(n.height),i=Math.max(n.height,i),s.push(Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,n.height))}l.maxHeight=i,l.topHeights=t,l.createWellWall(r.bottomPositions,s)})):this.createWellWall(r.bottomPositions,r.wallTopPositions)},CgsPit3D.prototype.createWellWall=function(e,t){var i=this.minHeight-this.diffHeight,s=(s=new CgsPitWallGeometry({minimumArr:e,maximumArr:t})).createGeometry(s,this.topHeights,i,this.maxHeight);this.primitive=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:s,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.GREY)},id:this.uuid}),appearance:new Cesium.MaterialAppearance({translucent:!1,flat:!0,material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:this.style.image,color:Cesium.Color.WHITE.withAlpha(this.style.opacity||1)}}})}),asynchronous:!1}),this.primitiveCollection.add(this.primitive)},CgsPit3D.prototype.createBottomSurface=function(e){e.length&&(this.bottomPrimitive=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:Cesium.PolygonGeometry.fromPositions({vertexFormat:Cesium.VertexFormat.ALL,positions:e,perPositionHeight:!0})}),appearance:new Cesium.MaterialAppearance({material:Cesium.Material.fromType(Cesium.Material.ImageType,{image:this.style.imageBottom,color:Cesium.Color.WHITE.withAlpha(this.style.opacity||1)})})}),this.primitiveCollection.add(this.bottomPrimitive))},CgsPit3D.prototype.getType=function(){return"Pit"},CgsPit3D.prototype.getMap=function(){return this.map},CgsPit3D.prototype.setMap=function(e){this.map=e},CgsPit=function(e){this.feature3D=new CgsPit3D(e)},CgsInherits(CgsPit,CgsFeature),CgsPit.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsPit.prototype.setPosition=function(e){this.feature3D.setPosition(e)},CgsPit.prototype.getDiffHeight=function(){return this.feature3D.getDiffHeight()},CgsPit.prototype.setDiffHeight=function(e){this.feature3D.setDiffHeight(e)},CgsPit.prototype.getImage=function(){return this.feature3D.getImage()},CgsPit.prototype.setImage=function(e){this.feature3D.setImage(e)},CgsPit.prototype.getImageBottom=function(){return this.feature3D.getImageBottom()},CgsPit.prototype.setImageBottom=function(e){this.feature3D.setImageBottom(e)};var CgsDynamicRiver3DSTYLE={opacity:.5,width:10,height:0,speed:10,axisY:!1,move:!0,direction:!0,moveVar:new Cesium.Cartesian3(50,1,100)};function Lines2Plane(e,t,i){if(e&&!(e.length<=1)&&t&&0!=t){for(var s=e.length,o=[],a=[],n=t/2,r=0;r<s;r++){var l,u=void 0,p=void 0,h=void 0,c=void 0,g=void 0,h=0==r?(u=e[r],p=e[r],e[r+1]):r==s-1?(u=e[r-1],p=e[r],e[r-1]):(u=e[r-1],p=e[r],e[r+1]);0!=i&&(u=RaisePoint(u,i),p=RaisePoint(p,i),h=RaisePoint(h,i)),u&&p&&h&&(c=(l=GetSide2(u,p,h,n)).left,g=l.right,o.push(g),a.push(c))}for(var d=o,m=a,f=[],C=[],y=[],v=[],b=[],D=0;D<s;D++){var S=Cesium.EncodedCartesian3.fromCartesian(m[D]);C.push(m[D].x),C.push(m[D].y),C.push(m[D].z),y.push(S.high.x),y.push(S.high.y),y.push(S.high.z),v.push(S.low.x),v.push(S.low.y),v.push(S.low.z),f.push(1,1),D<s-1&&(b.push(D+2*s),b.push(D+1),b.push(D+1+s),b.push(D+2*s),b.push(D+1+s),b.push(s+D+2*s))}for(var _=0;_<s;_++){var w=Cesium.EncodedCartesian3.fromCartesian(d[_]);C.push(d[_].x),C.push(d[_].y),C.push(d[_].z),y.push(w.high.x),y.push(w.high.y),y.push(w.high.z),v.push(w.low.x),v.push(w.low.y),v.push(w.low.z),f.push(1,0)}for(var P=0;P<s;P++){var T=Cesium.EncodedCartesian3.fromCartesian(m[P]);C.push(m[P].x),C.push(m[P].y),C.push(m[P].z),y.push(T.high.x),y.push(T.high.y),y.push(T.high.z),v.push(T.low.x),v.push(T.low.y),v.push(T.low.z),f.push(0,1)}for(var M=0;M<s;M++){var L=Cesium.EncodedCartesian3.fromCartesian(d[M]);C.push(d[M].x),C.push(d[M].y),C.push(d[M].z),y.push(L.high.x),y.push(L.high.y),y.push(L.high.z),v.push(L.low.x),v.push(L.low.y),v.push(L.low.z),f.push(0,0)}return{left:d,right:m,self:e,vertexs:new Float32Array(C),vertexsH:new Float32Array(y),vertexsL:new Float32Array(v),indexs:new Uint16Array(b),uvs:new Float32Array(f)}}console.error("请确认参数符合规则：数组长度大于1，宽高不能为0！",e)}function RaisePoint(e,t){if(e instanceof Cesium.Cartesian3){if(t&&0!=t){var i=Cesium.Cartesian3.normalize(e,new Cesium.Cartesian3),s=new Cesium.Ray(e,i);return Cesium.Ray.getPoint(s,t)}console.error("请确认高度是非零数值！")}else console.error("请确认点是Cartesian3类型！")}function GetSide2(e,t,i,s){var o,a,n,r,l,u,p,h,c,g,d,m,f,C,y,v,b,D,S,_,w,P,T,M,L,x,E,A,I,F,k=void 0,R=void 0;return R=Cesium.Cartesian3.equals(e,t)?(o=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(i,t,new Cesium.Cartesian3),new Cesium.Cartesian3),a=Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3),n=Cesium.Cartesian3.cross(a,o,new Cesium.Cartesian3),r=Cesium.Cartesian3.cross(o,a,new Cesium.Cartesian3),l=new Cesium.Ray(t,n),u=new Cesium.Ray(t,r),k=Cesium.Ray.getPoint(l,s),Cesium.Ray.getPoint(u,s)):Cesium.Cartesian3.equals(i,t)?(p=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),new Cesium.Cartesian3),h=Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3),c=Cesium.Cartesian3.cross(h,p,new Cesium.Cartesian3),g=Cesium.Cartesian3.cross(p,h,new Cesium.Cartesian3),d=new Cesium.Ray(t,c),m=new Cesium.Ray(t,g),k=Cesium.Ray.getPoint(d,s),Cesium.Ray.getPoint(m,s)):(f=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),new Cesium.Cartesian3),C=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(i,t,new Cesium.Cartesian3),new Cesium.Cartesian3),y=Cesium.Cartesian3.add(f,C,new Cesium.Cartesian3),Cesium.Cartesian3.equals(y,new Cesium.Cartesian3)?(v=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),new Cesium.Cartesian3),b=Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3),D=Cesium.Cartesian3.cross(b,v,new Cesium.Cartesian3),S=Cesium.Cartesian3.cross(v,b,new Cesium.Cartesian3),_=new Cesium.Ray(t,D),w=new Cesium.Ray(t,S),k=Cesium.Ray.getPoint(_,s),Cesium.Ray.getPoint(w,s)):(P=Cesium.Cartesian3.normalize(y,new Cesium.Cartesian3),T=Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3),M=Cesium.Cartesian3.cross(T,P,new Cesium.Cartesian3),L=Cesium.Cartesian3.cross(P,T,new Cesium.Cartesian3),x=new Cesium.Ray(t,M),E=new Cesium.Ray(t,L),A=Cesium.Cartesian3.dot(f,C)/Cesium.Cartesian3.magnitude(f)/Cesium.Cartesian3.magnitude(C),I=Cesium.Math.toDegrees(Math.acos(A))/2,F=2*s/Math.cos(Cesium.Math.toRadians(I)),k=Cesium.Ray.getPoint(x,F/2),Cesium.Ray.getPoint(E,F/2))),{left:k,right:R}}CgsDynamicRiver3D=function(e){for(var t in e)this[t]=e[t];if(this.style=CgsDynamicRiver3DSTYLE,0!=Object.keys(e.style).length)for(var i in e.style)this.style[i]=e.style[i];var s=[];e.positions.forEach(function(e){var t=CgsUtil.LatLngPointParse(e);t&&s.push(Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt))}),this.uuid=CgsUtil.createGuid(),this.id=this.uuid,this.positions=s,this.posArray=e.positions,this.primitiveCollection=new Cesium.PrimitiveCollection,this.addedHook()},CgsInherits(CgsDynamicRiver3D,CgsBasePolyPrimitive),CgsDynamicRiver3D.prototype.getCzmObject=function(){return this.primitive},CgsDynamicRiver3D.prototype.getImage=function(){return this.style.image},CgsDynamicRiver3D.prototype.setImage=function(e){this.style.image=e,this.material.uniforms.image=e},CgsDynamicRiver3D.prototype.getPositions=function(){return this.posArray},CgsDynamicRiver3D.prototype.setPositions=function(e){this.posArray=e;var i=[];e.forEach(function(e){var t=CgsUtil.LatLngPointParse(e);t&&i.push(Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt))}),this.positions=i,this.update()},CgsDynamicRiver3D.prototype.getWidth=function(){return this.style.width},CgsDynamicRiver3D.prototype.setWidth=function(e){e=Number(e)||1,this.style.width=e,this.update()},CgsDynamicRiver3D.prototype.getHeight=function(){return this.style.height},CgsDynamicRiver3D.prototype.setHeight=function(e){this.style.height=e,this.update()},CgsDynamicRiver3D.prototype.getOpacity=function(){return this.style.opacity},CgsDynamicRiver3D.prototype.setOpacity=function(e){this.style.opacity=Number(e),this.material.uniforms.alpha=e},CgsDynamicRiver3D.prototype.getDirection=function(){return this.style.direction},CgsDynamicRiver3D.prototype.setDirection=function(e){e=Boolean(e),this.style.direction=e,this.material.uniforms.reflux=e?-1:1},CgsDynamicRiver3D.prototype.getSpeed=function(){return this.style.speed},CgsDynamicRiver3D.prototype.setSpeed=function(e){e=Number(e)||1,this.style.speed=e,this.material.uniforms.speed=e},CgsDynamicRiver3D.prototype.getMove=function(){return this.style.move},CgsDynamicRiver3D.prototype.setMove=function(e){e=Boolean(e),this.style.move=e,this.material.uniforms.move=e},CgsDynamicRiver3D.prototype.getAxisY=function(){return this.style.axisY},CgsDynamicRiver3D.prototype.setAxisY=function(e){e=Boolean(e),this.style.axisY=e,this.material.uniforms.flipY=e},CgsDynamicRiver3D.prototype.getMoveVar=function(){return this.style.moveVar},CgsDynamicRiver3D.prototype.setMoveVar=function(e){this.style.moveVar=e,this.material.uniforms.moveVar=e},CgsDynamicRiver3D.prototype.updatePositionsHook=function(){this.update()},CgsDynamicRiver3D.prototype.update=function(){this.primitive&&(this.removedHook(),this.addedHook())},CgsDynamicRiver3D.prototype.addedHook=function(){this.sideRes=Lines2Plane(this.positions,this.style.width,this.style.height),this.sideRes&&(this.material=this.prepareMaterial(),this.primitive=this.createPrimitive(),this.primitiveCollection.add(this.primitive))},CgsDynamicRiver3D.prototype.removedHook=function(){this.dhEvent&&(this.map.clock.onTick.removeEventListener(this.dhEvent,this),delete this.dhEvent),this.primitive&&(this.primitiveCollection.remove(this.primitive),delete this.primitive),this.material&&(this.material.destroy(),delete this.material)},CgsDynamicRiver3D.prototype.prepareMaterial=function(){var e=void 0;return this.style.image?e=new Cesium.Material({fabric:{uniforms:{image:this.style.image,alpha:this.style.opacity,moveVar:this.style.moveVar,reflux:this.style.direction?-1:1,speed:this.style.speed,move:this.style.move,flipY:this.style.axisY},source:"czm_material czm_getMaterial(czm_materialInput materialInput) {\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nif(move){\nfloat r = sqrt((st.x-0.8)*(st.x-0.8) + (st.y-0.8)*(st.y-0.8));\nfloat r2 = sqrt((st.x-0.2)*(st.x-0.2) + (st.y-0.2)*(st.y-0.2));\nfloat z = cos(moveVar.x*r + czm_frameNumber/100.0*moveVar.y)/moveVar.z;\nfloat z2 = cos(moveVar.x*r2 + czm_frameNumber/100.0*moveVar.y)/moveVar.z;\nst += sqrt(z*z+z2*z2);\nst.s += reflux * czm_frameNumber/1000.0 * speed;\nst.s = mod(st.s,1.0);\n}\nif(flipY){\nst = vec2(st.t,st.s);\n}\nvec4 colorImage = texture2D(image, st);\nmaterial.alpha = alpha;\nmaterial.diffuse = colorImage.rgb;\nreturn material;\n}"}}):(e=Cesium.Material.fromType("Color")).uniforms.color=new Cesium.Color(0,1,0,this.style.opacity),e},CgsDynamicRiver3D.prototype.createPrimitive=function(){var e=this.sideRes,t=new Float64Array(e.vertexs),i=new Cesium.GeometryAttributes;i.position=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:t}),i.st=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:e.uvs});var s=new Cesium.GeometryInstance({id:this.uuid,geometry:new Cesium.Geometry({attributes:i,indices:e.indexs,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:Cesium.BoundingSphere.fromVertices(t)})}),o=new Cesium.RenderState;o.depthTest.enabled=!0;return new Cesium.Primitive({geometryInstances:s,appearance:new Cesium.Appearance({material:this.material,renderState:o,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec2 st;\nattribute float batchId;\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_positionMC = position3DHigh + position3DLow;\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_st = st;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}",fragmentShaderSource:"varying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\nvoid main()\n{\nczm_materialInput materialInput;\nvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nmaterialInput.s = v_st.s;\nmaterialInput.st = v_st;\nmaterialInput.str = vec3(v_st, 0.0);\nmaterialInput.normalEC = normalEC;\nmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\nvec3 positionToEyeEC = -v_positionEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}"}),asynchronous:!1})},CgsDynamicRiver3D.prototype.offsetHeight=function(t,e){if(t&&e&&this.primitive){for(var i=0,s=t/(20*e),o=this.sideRes.self,a=new Cesium.Cartesian3,n=0,r=o.length;n<r;n++){var l=Cesium.Cartesian3.normalize(o[n],new Cesium.Cartesian3);Cesium.Cartesian3.add(a,l,a)}Cesium.Cartesian3.normalize(a,a);var u=Cesium.clone(this.primitive.modelMatrix);this.dhEvent=function(){var e;this.primitive&&this.map&&(Math.abs(i)<=Math.abs(t)?(e=Cesium.Cartesian3.multiplyByScalar(a,i,new Cesium.Cartesian3),this.primitive.modelMatrix=Cesium.Matrix4.multiplyByTranslation(u,e,new Cesium.Matrix4)):this.dhEvent&&(this.map.clock.onTick.removeEventListener(this.dhEvent,this),delete this.dhEvent),i+=s)},this.map.clock.onTick.addEventListener(this.dhEvent,this)}},CgsDynamicRiver3D.prototype.getType=function(){return"dynamicRiver"},CgsDynamicRiver3D.prototype.getMap=function(){return this.map},CgsDynamicRiver3D.prototype.setMap=function(e){this.map=e},CgsDynamicRiver=function(e){this.feature3D=new CgsDynamicRiver3D(e)},CgsInherits(CgsDynamicRiver,CgsFeature),CgsDynamicRiver.prototype.getImage=function(){return this.feature3D.getImage()},CgsDynamicRiver.prototype.setImage=function(e){this.feature3D.setImage(e)},CgsDynamicRiver.prototype.getWidth=function(){return this.feature3D.getWidth()},CgsDynamicRiver.prototype.setWidth=function(e){this.feature3D.setWidth(e)},CgsDynamicRiver.prototype.getHeight=function(){return this.feature3D.getHeight()},CgsDynamicRiver.prototype.setHeight=function(e){this.feature3D.setHeight(e)},CgsDynamicRiver.prototype.offsetHeight=function(e,t){this.feature3D.offsetHeight(e,t)},CgsDynamicRiver.prototype.getOpacity=function(){return this.feature3D.getOpacity()},CgsDynamicRiver.prototype.setOpacity=function(e){this.feature3D.setOpacity(e)},CgsDynamicRiver.prototype.getDirection=function(){return this.feature3D.getDirection()},CgsDynamicRiver.prototype.setDirection=function(e){this.feature3D.setDirection(e)},CgsDynamicRiver.prototype.getSpeed=function(){return this.feature3D.getSpeed()},CgsDynamicRiver.prototype.setSpeed=function(e){this.feature3D.setSpeed(e)},CgsDynamicRiver.prototype.getMove=function(){return this.feature3D.getMove()},CgsDynamicRiver.prototype.setMove=function(e){this.feature3D.setMove(e)},CgsDynamicRiver.prototype.getAxisY=function(){return this.feature3D.getAxisY()},CgsDynamicRiver.prototype.setAxisY=function(e){this.feature3D.setAxisY(e)},CgsDynamicRiver.prototype.getPositions=function(){return this.feature3D.getPositions()},CgsDynamicRiver.prototype.setPositions=function(e){this.feature3D.setPositions(e)};var ROAD_DEF_STYLE={opacity:1,move:!1,axisY:!0,speed:0,direction:!0,moveVar:new Cesium.Cartesian3(50,1,100)};CgsRoad3D=function(e){for(var t in e)this[t]=e[t];if(this.style=ROAD_DEF_STYLE,0!=Object.keys(e.style).length)for(var i in e.style)this.style[i]=e.style[i];var s=[];e.positions.forEach(function(e){var t=CgsUtil.LatLngPointParse(e);t&&s.push(Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt))}),this.uuid=CgsUtil.createGuid(),this.id=this.uuid,this.positions=s,this.primitiveCollection=new Cesium.PrimitiveCollection,this.addedHook()},CgsInherits(CgsRoad3D,CgsDynamicRiver3D),CgsRoad3D.prototype.getType=function(){return"road"},CgsRoad3D.prototype.getMap=function(){return this.map},CgsRoad3D.prototype.setMap=function(e){this.map=e},CgsRoad=function(e){this.feature3D=new CgsRoad3D(e)},CgsInherits(CgsRoad,CgsDynamicRiver),CgsInherits(CgsRoad,CgsFeature),CgsRoad.prototype.setWidth=function(e){this.feature3D.setWidth(e)},CgsRoad.prototype.setHeight=function(e){this.feature3D.setHeight(e)};var CgsDiffuseWall3D_STYLE={diffHeight:1e3,speed:10};CgsDiffuseWall3D=function(e){var i=this;this.options=CgsDiffuseWall3D_STYLE,e=e||new Object,this.uuid=CgsUtil.createGuid(),this.id=this.uuid,this.options=e;var s=[];e.positions?(this.center=this.centerOfMass(this.positions),e.positions.forEach(function(e){var t=CgsUtil.LatLngPointParse(e);t&&(t.alt=t.alt+i.options.style.diffHeight,s.push(Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt)))}),this.positions=s):(this.center=CgsLatLngPoint.parse(e.position).toCartesian(),this.positions=CgsUtil.getEllipseOuterPositions({position:this.options.position,radius:Cesium.defaultValue(this.options.style.radius,100),count:Cesium.defaultValue(this.options.style.count,50)})),this._mScale=Cesium.Matrix4.fromUniformScale(1),this._xyScale=2,this.primitiveCollection=new Cesium.PrimitiveCollection,this._addedHook()},CgsInherits(CgsDiffuseWall3D,CgsBasePolyPrimitive),CgsDiffuseWall3D.prototype.getCzmObject=function(){return this._primitive},CgsDiffuseWall3D.prototype.getCenter=function(){return this._center},CgsDiffuseWall3D.prototype.setCenter=function(e){this._center=e},CgsDiffuseWall3D.prototype.centerOfMass=function(e,t){if(e&&0!=e.length){var i=e;try{if(1==i.length)return i[0];if(2==i.length)return CgsUtil.getMidpoint(i[0],i[1]);null==t&&(t=CgsUtil.getMaxHeight(i));var s=Cesium.BoundingSphere.fromPoints(i);return CgsUtil.setPositionsHeight(s.center,t)}catch(e){return i[Math.floor(i.length/2)]}}},CgsDiffuseWall3D.prototype._addedHook=function(){for(var e=this.positions,t=CgsUtil.addPositionsHeight(this.positions,this.options.style.diffHeight),i=[],s=[],o=[],a=[],n=0,r=e.length;n<r;n++){var l=(n+1)%r;i.push.apply(i,[e[n].x,e[n].y,e[n].z]),i.push.apply(i,[e[l].x,e[l].y,e[l].z]),i.push.apply(i,[t[l].x,t[l].y,t[l].z]),i.push.apply(i,[t[n].x,t[n].y,t[n].z]),a.push.apply(a,[0,0,1]),a.push.apply(a,[0,0,1]),a.push.apply(a,[0,0,1]),a.push.apply(a,[0,0,1]),s.push.apply(s,[0,0,1,0,1,1,0,1]);var u=4*n,p=1+u,h=2+u,c=3+u;o.push.apply(o,[h,c,u,u,p,h])}var g=new Float64Array(i),d=new Cesium.GeometryInstance({id:this.uuid,geometry:new Cesium.Geometry({attributes:{position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:g}),normal:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array(a)}),st:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(s)})},indices:new Uint16Array(o),primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:Cesium.BoundingSphere.fromVertices(g)})}),m=CgsUtil.getColorByStyle(this.options.style);this._primitive=new Cesium.Primitive({geometryInstances:d,appearance:new Cesium.MaterialAppearance({material:new Cesium.Material({translucent:!0,fabric:{uniforms:{u_color:m},source:this.getShader(!0)}}),vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\nvarying vec2 v_st;\nvarying vec3 v_normalEC;\nvarying vec3 v_positionEC;\nvoid main()\n{\nvec4 p = czm_translateRelativeToEye(position3DHigh,position3DLow);\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC = czm_normal * normal;\nv_st=st;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvoid main(){\ngl_FragColor = xh_getMaterial(v_st);\n}"}),asynchronous:!1,shadows:this.options.style.shadows,show:this.options.show}),this.primitiveCollection.add(this._primitive),this.primitiveCollection.add(this)},CgsDiffuseWall3D.prototype._removedHook=function(){this._primitive&&(this.primitiveCollection.remove(this._primitive),delete this._primitive),this.primitiveCollection.remove(this)},CgsDiffuseWall3D.prototype.update=function(e){var t,i;this._primitive&&this.options.show&&(i=(i=(t=e.frameNumber/1e3*this.options.style.speed)-Math.floor(t))<.01?.01:i,this._mScale[0]=this._mScale[5]=i*this._xyScale,this._mScale[10]=1.1-i,this._center=this.centerOfMass(this.positions),this._primitive.modelMatrix=this.scaleXYZ(this._center,this._mScale))},CgsDiffuseWall3D.prototype.getShader=function(e){var t="    uniform vec4 u_color;\n    vec4 xh_getMaterial(vec2 st){    float alpha = pow(1. - st.t, 4.);\n";return t+=e?"    vec4 color = vec4(u_color.rgb * u_color.a, alpha);":"    vec4 color = vec4(u_color.rgb * u_color.a, 1.);",t+="    return color;\n}\n",this.update(t),t},CgsDiffuseWall3D.prototype.scaleXYZ=function(e,t){var i=Cesium.Transforms.eastNorthUpToFixedFrame(e),s=Cesium.Matrix4.inverse(i,new Cesium.Matrix4),o=Cesium.Matrix4.multiply(t,s,new Cesium.Matrix4);return Cesium.Matrix4.multiply(i,o,new Cesium.Matrix4)},CgsDiffuseWall3D.prototype.getType=function(){return"diffuseWall"},CgsDiffuseWall3D.prototype.getMap=function(){return this.map},CgsDiffuseWall3D.prototype.setMap=function(e){this.map=e},CgsDiffuseWall=function(e){this.feature3D=new CgsDiffuseWall3D(e)},CgsInherits(CgsDiffuseWall,CgsFeature),CgsLightCone=function(e){this.feature3D=new CgsLightCone3D(e)},CgsInherits(CgsLightCone,CgsFeature),CgsLightCone.prototype.getColor=function(){return this.feature3D.getColor()},CgsLightCone.prototype.setColor=function(e){this.feature3D.setColor(e)},CgsLightCone.prototype.getadius=function(){return this.feature3D.getShow()},CgsLightCone.prototype.setShow=function(e){this.feature3D.setShow(e)},CgsLightCone.prototype.getRadius=function(){return this.feature3D.getRadius()},CgsLightCone.prototype.setRadius=function(e){this.feature3D.setRadius(e)},CgsLightCone.prototype.getHeight=function(){return this.feature3D.getHeight()},CgsLightCone.prototype.setHeight=function(e){this.feature3D.setHeight(e)},CgsLightCone.prototype.getPosition=function(){return this.feature3D.getPosition()},CgsLightCone.prototype.setPosition=function(e){this.feature3D.setPosition(e)};var CgsLightCone3D_STYLE={height:1e3,radius:100,color:"#00ffff"},particleImage=new Image;particleImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAEACAYAAADSoXR2AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExQTg0NDEyMDEzQjExRUFBNDhBRjhGMUMzOUUyNTU0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExQTg0NDEzMDEzQjExRUFBNDhBRjhGMUMzOUUyNTU0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MTFBODQ0MTAwMTNCMTFFQUE0OEFGOEYxQzM5RTI1NTQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MTFBODQ0MTEwMTNCMTFFQUE0OEFGOEYxQzM5RTI1NTQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz41vRwAAAAE90lEQVR42uydyW4UMRCG3T2dgYSAEGs4sp44cCJBcGUJbwCvALwWPAI8ABwAiUVwgLBdkEikJEiAGMhkZqhfU1aa1sy0g+yaJPyWSupOpPjz0uVyucrJer2eG2fJ3ZgLAQhAgC0PgN8XIlkqgGLE75oih0WmRVZEvop0rHog18rnRe6IzInsthyCXFt+TuSKyGmRXZZDgK5eFrkv8l7kiUhrxN/JSo3pigSvcNmI1bCh3b5LK2+NqHyvyEF9x3z5HgqRRViOAXhW5JrCoNdei/y20gMYxhmRSyIXRY6JTMT4DENLW+SdyD19x/NajDmwmYIW79Hnn+MA4GJEAAIQgABJbMJB+n5Sl9zWZvR9DABUfkJkVt8fi3zUldAEoKl24Y2S1fPZEmBdZFHkkb4vxTLRQ5djbyUf0ncYrD/UADUB8MZno2Q19yx7gIqIAAQgAAEIQIAtYZT+85LvRnjQCoPKR3rQUgN4Y3ZeK30g8qps0qeeAzDn4TWD9+ySG+BBS90DaGnVg9a2tgnR4il9/jkOACoiAhCAAASIZpAAFl6yulO0JACo/IDrn6CedP1zxOciv6wAYNnAP3RVBeWtJQCWzG8iL/X9g4vkqNzMctzUXtintt2KM/aS+bmQaY90rb8CF6tSKiICEIAABCAAAQiwbfcFIWVCbUcc9bZDLKiYAKj4uOv7Bb+ILLj+8W7PCgC7Jhzv44Qdh9yrru8V61jPgd645gD2io+15RiC5ZA5ENNPmGmDmtrta9YAVEQE2FlrQUM/J6efU8cSAD87ojodBaccS6kgiiErGiq/qe93XT+3oGU5BJnbyKrIUs6BQZoQUEcrQ7CYagiGqeKiMgnXLXsg5uJUm/RQJKy8fGS7PMw6SgVQPrJFGZr0kCfUL/7IFjIzrLGpemBQ0kPbehL6I9vMjUh6oEVEAAIQgAAEIAABdpyj0qcK71YrqGUJANNrv+sHOcAiRpDDM1cTY1BEHk7kqyP/2Ac5vLEEQEG8aDnIoTb5ObZRWg5ywG5o1dX4ClNYxT7IISgJPsXGpLut9MCWU0S5bqkmdAa3LQEwcZDAfkZ3tthQfkwNkVeeD6kiuaUabcp6DpS9YyalrAdQ8bT1EFQVUabarND9fNuyB2gREYAABCAAAQhAAAIQoM770UgBXARCIr/koDogVlzgrWuxemBKd0m4JnBed0+5ZQ9gn3BK5LK+P4y5ewoB8DFiKO91COLFfwVuTCZV1hSoYw1APZCsFIkbN1Haaa87wwiKQe6eT27AEX6esPVVd8/kOOdAz/oz9FE0p+uGIKUeqE5C8xgSKiICEIAABCAAAQhAAAIQgAAEIAABCECA6AA+sbkREyDUUYlKD6ggZwzRkr8tewBhusisv+0in5qE/hFchoZTE0TL4p8sTbtIpyahQ4Ag5fKpSVBmfdDECvQTZjoM0U9N6KgkwH9xY7PXpPiCmq5yuaLVldHIO7jgNi5XfOEhCqNh9udHV/RnC5YAUDTftdV4/ivvwEoRVS9XXPWa1FIT5ird8jpSB+BDN3rO8AaGMnGy0I0QRYTvdk6NkOsucuhGCMAgI8Q0isaHbmAevNMhiD4P6iZhstANGiQE2PEGCRo2NcgAsQDwKnxWFdlT17/duWU1BJmuHz6A5bwbEsCScgh+qAHit3Jr1oooOPExdRBLbeJjSpuwuy30AAH+CDAAPH5ltESNYl4AAAAASUVORK5CYII=",particleImage.onload=function(){},CgsLightCone3D=function(e){CgsFeature.call(this,e),this.options=e,0==Object.keys(this.options.style).length&&(this.options.style=CgsLightCone3D_STYLE),this.primitive1=null,this.primitive2=null,this.primitive3=null,this.primitive4=null,this.color=CgsUtil.getColorByStyle(this.options.style),this.primitiveCollection=new Cesium.PrimitiveCollection,this.addedHook()},CgsInherits(CgsLightCone3D,CgsFeature),CgsLightCone3D.prototype.getCzmObject=function(){return this.primitive1},CgsLightCone3D.prototype.getCzmObjectEx=function(){return[this.primitive2,this.primitive3,this.primitive4]},CgsLightCone3D.prototype.getType=function(){return"lightCone"},CgsLightCone3D.prototype.getColor=function(){return this.options.style.color},CgsLightCone3D.prototype.setColor=function(e){this.options.style.color=e,this.color=CgsUtil.getColorByStyle(this.options.style),this.removedHook(),this.addedHook()},CgsLightCone3D.prototype.getRadius=function(){return this.options.style.radius},CgsLightCone3D.prototype.setRadius=function(e){this.options.style.radius=e,this.removedHook(),this.addedHook()},CgsLightCone3D.prototype.getHeight=function(){return this.options.style.height},CgsLightCone3D.prototype.setHeight=function(e){this.options.style.height=e,this.removedHook(),this.addedHook()},CgsLightCone3D.prototype.getPosition=function(){return this.options.position},CgsLightCone3D.prototype.setPosition=function(e){this.options.position=e,this.removedHook(),this.addedHook()},CgsLightCone3D.prototype.addedHook=function(){var e=this.options.style.radius;this.topRadius=e/100,this.topRadius=1<this.topRadius?1:this.topRadius,this.inner_controlPoints=CgsUtil.getCirclePosition(this.options.position,.7*e),this.outer_controlPoints=CgsUtil.getCirclePosition(this.options.position,e),this.circular_clone_topPoints=CgsUtil.getCirclePosition(this.options.position,this.topRadius),this.circlePoints_2=CgsUtil.getCirclePosition(this.options.position,2*e),this.ringCanvas=this.drawRingCanvas(),this.gradientCircleCanvas=this.cirdrawGradientCircleCanvas(),this.image=this.drawCanvas(particleImage),this.addInner(),this.addOuter(),this.addCircle(),this.addRing()},CgsLightCone3D.prototype.removedHook=function(){this.primitive1&&(this.primitiveCollection.remove(this.primitive1),delete this.primitive1),this.primitive2&&(this.primitiveCollection.remove(this.primitive2),delete this.primitive2),this.primitive3&&(this.primitiveCollection.remove(this.primitive3),delete this.primitive3),this.primitive4&&(this.primitiveCollection.remove(this.primitive4),delete this.primitive4)},CgsLightCone3D.prototype.getShow=function(){return this.options.show},CgsLightCone3D.prototype.setShow=function(e){this.options.show=e,this.primitive1.show=e,this.primitive2.show=e,this.primitive3.show=e,this.primitive4.show=e},CgsLightCone3D.prototype.drawRingCanvas=function(){var e=document.createElement("canvas");e.width=512,e.height=512;var t=e.getContext("2d");return t.fillStyle="rgba(255,255,255,0)",t.strokeStyle="rgba(255, 255, 255,255)",t.setLineDash([50,50]),t.lineWidth=30,t.beginPath(),t.arc(256,256,150,0,2*Math.PI,!0),t.stroke(),t.restore(),e},CgsLightCone3D.prototype.cirdrawGradientCircleCanvas=function(){var e=document.createElement("canvas");e.width=512,e.height=512;var t=e.getContext("2d"),i=t.createRadialGradient(256,256,0,256,256,256);return i.addColorStop(.1,"rgba(255, 255, 255, 1.0)"),i.addColorStop(.2,"rgba(255, 255, 255, 0.0)"),i.addColorStop(.3,"rgba(255, 255, 255, 0.9)"),i.addColorStop(.5,"rgba(255, 255, 255, 0.0)"),i.addColorStop(.9,"rgba(255, 255, 255, 0.2)"),i.addColorStop(1,"rgba(255, 255, 255, 1.0)"),t.clearRect(0,0,512,512),t.beginPath(),t.arc(256,256,256,0,2*Math.PI,!0),t.fillStyle=i,t.fill(),t.restore(),e},CgsLightCone3D.prototype.drawCanvas=function(e){var t=document.createElement("canvas");t.width=64,t.height=256;var i=t.getContext("2d");return i.clearRect(0,0,64,256),i.drawImage(e,0,0),i.drawImage(e,33,0),t};var ConeGlowCylinderGaussMaterial="uniform vec4 u_color;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat powerRatio = 1./(fract(czm_frameNumber / 30.0) +  1.) ;\nfloat alpha = pow(1. - st.t,powerRatio);\nvec4 color = vec4(u_color.rgb, alpha*u_color.a);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}";CgsLightCone3D.prototype.addInner=function(){var e=CgsUtil.createCylinderInstance(this.inner_controlPoints,this.circular_clone_topPoints,{height:this.options.style.height,color:this.color,distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute}),t=new Cesium.EllipsoidSurfaceAppearance({material:new Cesium.Material({fabric:{uniforms:{u_color:this.color},source:ConeGlowCylinderGaussMaterial},translucent:function(e){return e.uniforms.u_color.alpha<1}})});this.primitive1=new Cesium.Primitive({geometryInstances:e,appearance:t,asynchronous:!1,show:this.options.show}),this.primitiveCollection.add(this.primitive1)};var ConeGlowCircleOuterMaterial="uniform vec4 u_color;\nczm_material czm_getMaterial(czm_materialInput materialInput){\n czm_material material = czm_getDefaultMaterial(materialInput);\n  vec2 st = materialInput.st;\n  float time = fract(czm_frameNumber / 90.) ;\n  vec2 new_st = fract(st-vec2(time,time));\n  vec4 color = texture2D(image,new_st);\n  vec3 diffuse = color.rgb;\n  float alpha = color.a;\n  diffuse *= u_color.rgb;\n  alpha *= u_color.a;\n  alpha *= u_color.a;\n  material.diffuse = diffuse;\n  material.alpha = alpha * pow(1. - st.t,u_color.a);\nreturn material;\n}";CgsLightCone3D.prototype.addOuter=function(){var e=CgsUtil.createCylinderInstance(this.outer_controlPoints,this.circular_clone_topPoints,{height:this.options.style.height,distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute,color:new Cesium.Color(.5,.8,1,2)});this.primitive2=new Cesium.Primitive({geometryInstances:e,appearance:new Cesium.EllipsoidSurfaceAppearance({material:new Cesium.Material({fabric:{uniforms:{u_color:this.color,image:this.image},source:ConeGlowCircleOuterMaterial},translucent:!0})}),asynchronous:!1,show:this.options.show}),this.primitiveCollection.add(this.primitive2)};var ConeGlowGradientMaterial=" czm_material czm_getMaterial(czm_materialInput materialInput){\n czm_material material = czm_getDefaultMaterial(materialInput);\n vec4 tColor = u_color;\n vec2 st = materialInput.st;\n vec2 center = st - vec2(0.5,0.5);\n float length = length(center)/0.5;\n float time = 1. - abs(czm_frameNumber / 360. - 0.5);\n float param = 1. - step(length, 0.6);\n float scale = param * length;\n float alpha = param * (1.0 - abs(scale - 0.8) / 0.2);\n float param1 = step(length, 0.7);\n float scale1 = param1 * length;\n alpha += param1 * (1.0 - abs(scale1 - 0.35) / 0.35);\n material.diffuse = u_color.rgb * vec3(u_color.a);\n material.alpha = pow(alpha, 4.0);\n return material;\n }";CgsLightCone3D.prototype.addCircle=function(){var e=Cesium.Cartographic.fromCartesian(this.options.position),t=CgsUtil.createCircleInstance(this.circlePoints_2,{perPositionHeight:1<=e.height,distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute});this.primitive3=new Cesium.Primitive({geometryInstances:t,appearance:new Cesium.EllipsoidSurfaceAppearance({material:new Cesium.Material({fabric:{uniforms:{u_color:this.color,image:this.gradientCircleCanvas},source:ConeGlowGradientMaterial},translucent:!0})}),asynchronous:!1,show:this.options.show}),this.primitiveCollection.add(this.primitive3)};var ConeGlowRingScanMaterial=" czm_material czm_getMaterial(czm_materialInput materialInput){\n czm_material material = czm_getDefaultMaterial(materialInput);\n vec2 st = materialInput.st;\n vec2 center = st - vec2(0.5,0.5);\n float time = -czm_frameNumber * 3.1415926 / 180.;\n float sin_t = sin(time);\n float cos_t = cos(time);\n vec2 center_rotate = vec2(center.s*cos_t-center.t*sin_t+0.5,center.s*sin_t+center.t*cos_t+0.5);\n vec4 color = texture2D(image,center_rotate);\n vec3 tColor = color.rgb * u_color.rgb;\n tColor *= u_color.a;\n material.diffuse = tColor;\n float length = 2. - length(center)/0.5;\n material.alpha = color.a * pow(length, 0.5);\n return material;\n }";CgsLightCone3D.prototype.addRing=function(){var e=CgsUtil.createCircleInstance(this.circlePoints_2,{perPositionHeight:1<=this.options.style.height,distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute});this.primitive4=new Cesium.Primitive({geometryInstances:e,appearance:new Cesium.EllipsoidSurfaceAppearance({material:new Cesium.Material({fabric:{uniforms:{u_color:this.color,image:this.ringCanvas},source:ConeGlowRingScanMaterial},translucent:!0})}),asynchronous:!1,show:this.options.show}),this.primitiveCollection.add(this.primitive4)},CgsLightCone3D.prototype.getMap=function(){return this.map},CgsLightCone3D.prototype.setMap=function(e){this.map=e},CgsCustomPrimitive=function(e){this.commandType=e.commandType,this.geometry=e.geometry,this.attributeLocations=e.attributeLocations,this.primitiveType=e.primitiveType,this.uniformMap=e.uniformMap,this.vertexShaderSource=e.vertexShaderSource,this.fragmentShaderSource=e.fragmentShaderSource,this.rawRenderState=e.rawRenderState,this.framebuffer=e.framebuffer,this.outputTexture=e.outputTexture,this.autoClear=Cesium.defaultValue(e.autoClear,!1),this.preExecute=e.preExecute,this.show=!0,this.commandToExecute=void 0,this.clearCommand=void 0,this.autoClear&&(this.clearCommand=new Cesium.ClearCommand({color:new Cesium.Color(0,0,0,0),depth:1,framebuffer:this.framebuffer,pass:Cesium.Pass.OPAQUE}))},CgsCustomPrimitive.prototype.createCommand=function(e){switch(this.commandType){case"Draw":var t=Cesium.VertexArray.fromGeometry({context:e,geometry:this.geometry,attributeLocations:this.attributeLocations,bufferUsage:Cesium.BufferUsage.STATIC_DRAW}),i=Cesium.ShaderProgram.fromCache({context:e,attributeLocations:this.attributeLocations,vertexShaderSource:this.vertexShaderSource,fragmentShaderSource:this.fragmentShaderSource}),s=Cesium.RenderState.fromCache(this.rawRenderState);return new Cesium.DrawCommand({owner:this,vertexArray:t,primitiveType:this.primitiveType,uniformMap:this.uniformMap,modelMatrix:Cesium.Matrix4.IDENTITY,shaderProgram:i,framebuffer:this.framebuffer,renderState:s,pass:Cesium.Pass.OPAQUE});case"Compute":return new Cesium.ComputeCommand({owner:this,fragmentShaderSource:this.fragmentShaderSource,uniformMap:this.uniformMap,outputTexture:this.outputTexture,persists:!0})}},CgsCustomPrimitive.prototype.setGeometry=function(e,t){this.geometry=t;var i=Cesium.VertexArray.fromGeometry({context:e,geometry:this.geometry,attributeLocations:this.attributeLocations,bufferUsage:Cesium.BufferUsage.STATIC_DRAW});this.commandToExecute.vertexArray=i},CgsCustomPrimitive.prototype.update=function(e){this.show&&e.mode==Cesium.SceneMode.SCENE3D&&(Cesium.defined(this.commandToExecute)||(this.commandToExecute=this.createCommand(e.context)),Cesium.defined(this.preExecute)&&this.preExecute(),Cesium.defined(this.clearCommand)&&e.commandList.push(this.clearCommand),e.commandList.push(this.commandToExecute))},CgsCustomPrimitive.prototype.isDestroyed=function(){return!1},CgsCustomPrimitive.prototype.destroy=function(){return Cesium.defined(this.commandToExecute)&&(this.commandToExecute.shaderProgram=this.commandToExecute.shaderProgram&&this.commandToExecute.shaderProgram.destroy()),Cesium.destroyObject(this)};var segmentDraw_vert="attribute vec2 st;\nattribute vec3 normal; // (point to use, offset sign, not used component)\nuniform sampler2D currentParticlesPosition;\nuniform sampler2D postProcessingPosition;\nuniform sampler2D postProcessingSpeed;\nuniform float particleHeight;\nuniform float aspect;\nuniform float pixelSize;\nuniform float lineWidth;\nvarying float speedNormalization;\nvec3 convertCoordinate(vec3 lonLatLev) {\nfloat a = 6378137.0; // Semi-major axis \nfloat b = 6356752.3142; // Semi-minor axis \nfloat e2 = 6.69437999014e-3; // First eccentricity squared\nfloat latitude = radians(lonLatLev.y);\nfloat longitude = radians(lonLatLev.x);\nfloat cosLat = cos(latitude);\nfloat sinLat = sin(latitude);\nfloat cosLon = cos(longitude);\nfloat sinLon = sin(longitude);\nfloat N_Phi = a / sqrt(1.0 - e2 * sinLat * sinLat);\nfloat h = particleHeight;\nvec3 cartesian = vec3(0.0);\ncartesian.x = (N_Phi + h) * cosLat * cosLon;\ncartesian.y = (N_Phi + h) * cosLat * sinLon;\ncartesian.z = ((b * b) / (a * a) * N_Phi + h) * sinLat;\nreturn cartesian;\n}\nvec4 calcProjectedCoordinate(vec3 lonLatLev) {\nlonLatLev.x = mod(lonLatLev.x + 180.0, 360.0) - 180.0;\nvec3 particlePosition = convertCoordinate(lonLatLev);\nvec4 projectedCoordinate = czm_modelViewProjection * vec4(particlePosition, 1.0);\nreturn projectedCoordinate;\n}\nvec4 calcOffset(vec4 currentProjectedCoordinate, vec4 nextProjectedCoordinate, float offsetSign) {\nvec2 aspectVec2 = vec2(aspect, 1.0);\nvec2 currentXY = (currentProjectedCoordinate.xy / currentProjectedCoordinate.w) * aspectVec2;\nvec2 nextXY = (nextProjectedCoordinate.xy / nextProjectedCoordinate.w) * aspectVec2;\nfloat offsetLength = lineWidth / 2.0;\nvec2 direction = normalize(nextXY - currentXY);\nvec2 normalVector = vec2(-direction.y, direction.x);\nnormalVector.x = normalVector.x / aspect;\nnormalVector = offsetLength * normalVector;\nvec4 offset = vec4(offsetSign * normalVector, 0.0, 0.0);\nreturn offset;\n}\nvoid main() {\nvec2 particleIndex = st;\nvec3 currentPosition = texture2D(currentParticlesPosition, particleIndex).rgb;\nvec4 nextPosition = texture2D(postProcessingPosition, particleIndex);\nvec4 currentProjectedCoordinate = vec4(0.0);\nvec4 nextProjectedCoordinate = vec4(0.0);\nif (nextPosition.w > 0.0) {\ncurrentProjectedCoordinate = calcProjectedCoordinate(currentPosition);\nnextProjectedCoordinate = calcProjectedCoordinate(currentPosition);\n} else {\ncurrentProjectedCoordinate = calcProjectedCoordinate(currentPosition);\nnextProjectedCoordinate = calcProjectedCoordinate(nextPosition.xyz);\n}\nfloat pointToUse = normal.x;\nfloat offsetSign = normal.y;\nvec4 offset = pixelSize * calcOffset(currentProjectedCoordinate, nextProjectedCoordinate, offsetSign);\nif (pointToUse < 0.0) {\ngl_Position = currentProjectedCoordinate + offset;\n} else {\ngl_Position = nextProjectedCoordinate + offset;\n}\nspeedNormalization = texture2D(postProcessingSpeed, particleIndex).a;\n}",segmentDraw_frag="uniform sampler2D colorTable;\nvarying float speedNormalization;\nvoid main() {\ngl_FragColor = texture2D(colorTable, vec2(speedNormalization, 0.0));\n}",fullscreen_vert="attribute vec3 position;\nattribute vec2 st;\nvarying vec2 textureCoordinate;\nvoid main() {\ntextureCoordinate = st;\ngl_Position = vec4(position, 1.0);\n}",trailDraw_frag="uniform sampler2D segmentsColorTexture;\nuniform sampler2D segmentsDepthTexture;\nuniform sampler2D currentTrailsColor;\nuniform sampler2D trailsDepthTexture;\nuniform float fadeOpacity;\nvarying vec2 textureCoordinate;\nvoid main() {\nvec4 pointsColor = texture2D(segmentsColorTexture, textureCoordinate);\nvec4 trailsColor = texture2D(currentTrailsColor, textureCoordinate);\ntrailsColor = floor(fadeOpacity * 255.0 * trailsColor) / 255.0;\nfloat pointsDepth = texture2D(segmentsDepthTexture, textureCoordinate).r;\nfloat trailsDepth = texture2D(trailsDepthTexture, textureCoordinate).r;\nfloat globeDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, textureCoordinate));\ngl_FragColor = vec4(0.0);\nif (pointsDepth < globeDepth) {\ngl_FragColor = gl_FragColor + pointsColor;\n}\nif (trailsDepth < globeDepth) {\ngl_FragColor = gl_FragColor + trailsColor;\n}\ngl_FragDepthEXT = min(pointsDepth, trailsDepth);\n}",screenDraw_frag="uniform sampler2D trailsColorTexture;\nuniform sampler2D trailsDepthTexture;\nvarying vec2 textureCoordinate;\nvoid main() {\nvec4 trailsColor = texture2D(trailsColorTexture, textureCoordinate);\nfloat trailsDepth = texture2D(trailsDepthTexture, textureCoordinate).r;\nfloat globeDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, textureCoordinate));\nif (trailsDepth < globeDepth) {\ngl_FragColor = trailsColor;\n} else {\ngl_FragColor = vec4(0.0);\n}\n}";CgsParticlesRendering=function(e,t,i,s,o){this.createRenderingTextures(e,t),this.createRenderingFramebuffers(e),this.createRenderingPrimitives(e,i,s,o)},CgsParticlesRendering.prototype.createRenderingTextures=function(e,t){var i={context:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_BYTE},s={context:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,pixelFormat:Cesium.PixelFormat.DEPTH_COMPONENT,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_INT},o={context:e,width:t.colorTable.colorNum,height:1,pixelFormat:Cesium.PixelFormat.RGB,pixelDatatype:Cesium.PixelDatatype.FLOAT,sampler:new Cesium.Sampler({minificationFilter:Cesium.TextureMinificationFilter.LINEAR,magnificationFilter:Cesium.TextureMagnificationFilter.LINEAR})};this.textures={segmentsColor:CgsUtil.createTexture(i),segmentsDepth:CgsUtil.createTexture(s),currentTrailsColor:CgsUtil.createTexture(i),currentTrailsDepth:CgsUtil.createTexture(s),nextTrailsColor:CgsUtil.createTexture(i),nextTrailsDepth:CgsUtil.createTexture(s),colorTable:CgsUtil.createTexture(o,t.colorTable.array)}},CgsParticlesRendering.prototype.createRenderingFramebuffers=function(e){this.framebuffers={segments:CgsUtil.createFramebuffer(e,this.textures.segmentsColor,this.textures.segmentsDepth),currentTrails:CgsUtil.createFramebuffer(e,this.textures.currentTrailsColor,this.textures.currentTrailsDepth),nextTrails:CgsUtil.createFramebuffer(e,this.textures.nextTrailsColor,this.textures.nextTrailsDepth)}},CgsParticlesRendering.prototype.createSegmentsGeometry=function(e){for(var t=[],i=0;i<e.particlesTextureSize;i++)for(var s=0;s<e.particlesTextureSize;s++)for(var o=0;o<4;o++)t.push(i/e.particlesTextureSize),t.push(s/e.particlesTextureSize);t=new Float32Array(t);for(var a=[],n=[-1,1],r=[-1,1],l=0;l<e.maxParticles;l++)for(var u=0;u<2;u++)for(var p=0;p<2;p++)a.push(n[u]),a.push(r[p]),a.push(0);a=new Float32Array(a);for(var h=6*e.maxParticles,c=new Uint32Array(h),g=0,d=0,m=0;g<e.maxParticles;g++)c[d++]=m+0,c[d++]=m+1,c[d++]=m+2,c[d++]=m+2,c[d++]=m+1,c[d++]=m+3,m+=4;return new Cesium.Geometry({attributes:new Cesium.GeometryAttributes({st:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:t}),normal:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:a})}),indices:c})},CgsParticlesRendering.prototype.createRenderingPrimitives=function(e,t,i,s){var o=this;this.primitives={segments:new CgsCustomPrimitive({commandType:"Draw",attributeLocations:{st:0,normal:1},geometry:this.createSegmentsGeometry(t),primitiveType:Cesium.PrimitiveType.TRIANGLES,uniformMap:{currentParticlesPosition:function(){return s.particlesTextures.currentParticlesPosition},postProcessingPosition:function(){return s.particlesTextures.postProcessingPosition},postProcessingSpeed:function(){return s.particlesTextures.postProcessingSpeed},colorTable:function(){return o.textures.colorTable},aspect:function(){return e.drawingBufferWidth/e.drawingBufferHeight},pixelSize:function(){return i.pixelSize},lineWidth:function(){return t.lineWidth},particleHeight:function(){return t.particleHeight}},vertexShaderSource:new Cesium.ShaderSource({sources:[segmentDraw_vert]}),fragmentShaderSource:new Cesium.ShaderSource({sources:[segmentDraw_frag]}),rawRenderState:CgsUtil.createRawRenderState({viewport:void 0,depthTest:{enabled:!0},depthMask:!0}),framebuffer:this.framebuffers.segments,autoClear:!0}),trails:new CgsCustomPrimitive({commandType:"Draw",attributeLocations:{position:0,st:1},geometry:CgsUtil.getFullscreenQuad(),primitiveType:Cesium.PrimitiveType.TRIANGLES,uniformMap:{segmentsColorTexture:function(){return o.textures.segmentsColor},segmentsDepthTexture:function(){return o.textures.segmentsDepth},currentTrailsColor:function(){return o.framebuffers.currentTrails.getColorTexture(0)},trailsDepthTexture:function(){return o.framebuffers.currentTrails.depthTexture},fadeOpacity:function(){return t.fadeOpacity}},vertexShaderSource:new Cesium.ShaderSource({defines:["DISABLE_GL_POSITION_LOG_DEPTH"],sources:[fullscreen_vert]}),fragmentShaderSource:new Cesium.ShaderSource({defines:["DISABLE_LOG_DEPTH_FRAGMENT_WRITE"],sources:[trailDraw_frag]}),rawRenderState:CgsUtil.createRawRenderState({viewport:void 0,depthTest:{enabled:!0,func:Cesium.DepthFunction.ALWAYS},depthMask:!0}),framebuffer:this.framebuffers.nextTrails,autoClear:!0,preExecute:function(){var e=o.framebuffers.currentTrails;o.framebuffers.currentTrails=o.framebuffers.nextTrails,o.framebuffers.nextTrails=e,o.primitives.trails.commandToExecute.framebuffer=o.framebuffers.nextTrails,o.primitives.trails.clearCommand.framebuffer=o.framebuffers.nextTrails}}),screen:new CgsCustomPrimitive({commandType:"Draw",attributeLocations:{position:0,st:1},geometry:CgsUtil.getFullscreenQuad(),primitiveType:Cesium.PrimitiveType.TRIANGLES,uniformMap:{trailsColorTexture:function(){return o.framebuffers.nextTrails.getColorTexture(0)},trailsDepthTexture:function(){return o.framebuffers.nextTrails.depthTexture}},vertexShaderSource:new Cesium.ShaderSource({defines:["DISABLE_GL_POSITION_LOG_DEPTH"],sources:[fullscreen_vert]}),fragmentShaderSource:new Cesium.ShaderSource({defines:["DISABLE_LOG_DEPTH_FRAGMENT_WRITE"],sources:[screenDraw_frag]}),rawRenderState:CgsUtil.createRawRenderState({viewport:void 0,depthTest:{enabled:!1},depthMask:!0,blending:{enabled:!0}}),framebuffer:void 0})}};var getWind_frag="uniform sampler2D U;\nuniform sampler2D V;\nuniform sampler2D currentParticlesPosition;\nuniform vec3 dimension;\nuniform vec3 minimum;\nuniform vec3 maximum;\nuniform vec3 interval;\nvarying vec2 v_textureCoordinates;\nvec2 mapPositionToNormalizedIndex2D(vec3 lonLatLev) {\nlonLatLev.x = mod(lonLatLev.x, 360.0);\nlonLatLev.y = clamp(lonLatLev.y, -90.0, 90.0);\nvec3 index3D = vec3(0.0);\nindex3D.x = (lonLatLev.x - minimum.x) / interval.x;\nindex3D.y = (lonLatLev.y - minimum.y) / interval.y;\nindex3D.z = (lonLatLev.z - minimum.z) / interval.z;\nvec2 index2D = vec2(index3D.x, index3D.z * dimension.y + index3D.y);\nvec2 normalizedIndex2D = vec2(index2D.x / dimension.x, index2D.y / (dimension.y * dimension.z));\nreturn normalizedIndex2D;\n}\nfloat getWind(sampler2D windTexture, vec3 lonLatLev) {\nvec2 normalizedIndex2D = mapPositionToNormalizedIndex2D(lonLatLev);\nfloat result = texture2D(windTexture, normalizedIndex2D).r;\nreturn result;\n}\nconst mat4 kernelMatrix = mat4(\n 0.0, -1.0, 2.0, -1.0,\n2.0, 0.0, -5.0, 3.0,\n0.0, 1.0, 4.0, -3.0,\n0.0, 0.0, -1.0, 1.0\n);\nfloat oneDimensionInterpolation(float t, float p0, float p1, float p2, float p3) {\nvec4 tVec4 = vec4(1.0, t, t * t, t * t * t);\ntVec4 = tVec4 / 2.0;\nvec4 pVec4 = vec4(p0, p1, p2, p3);\nreturn dot((tVec4 * kernelMatrix), pVec4);\n}\nfloat calculateB(sampler2D windTexture, float t, float lon, float lat, float lev) {\nfloat lon0 = floor(lon) - 1.0 * interval.x;\nfloat lon1 = floor(lon);\nfloat lon2 = floor(lon) + 1.0 * interval.x;\nfloat lon3 = floor(lon) + 2.0 * interval.x;\nfloat p0 = getWind(windTexture, vec3(lon0, lat, lev));\nfloat p1 = getWind(windTexture, vec3(lon1, lat, lev));\nfloat p2 = getWind(windTexture, vec3(lon2, lat, lev));\nfloat p3 = getWind(windTexture, vec3(lon3, lat, lev));\nreturn oneDimensionInterpolation(t, p0, p1, p2, p3);\n}\nfloat interpolateOneTexture(sampler2D windTexture, vec3 lonLatLev) {\nfloat lon = lonLatLev.x;\nfloat lat = lonLatLev.y;\nfloat lev = lonLatLev.z;\nfloat lat0 = floor(lat) - 1.0 * interval.y;\nfloat lat1 = floor(lat);\nfloat lat2 = floor(lat) + 1.0 * interval.y;\nfloat lat3 = floor(lat) + 2.0 * interval.y;\nvec2 coefficient = lonLatLev.xy - floor(lonLatLev.xy);\nfloat b0 = calculateB(windTexture, coefficient.x, lon, lat0, lev);\nfloat b1 = calculateB(windTexture, coefficient.x, lon, lat1, lev);\nfloat b2 = calculateB(windTexture, coefficient.x, lon, lat2, lev);\nfloat b3 = calculateB(windTexture, coefficient.x, lon, lat3, lev);\nreturn oneDimensionInterpolation(coefficient.y, b0, b1, b2, b3);\n}\nvec3 bicubic(vec3 lonLatLev) {\nfloat u = interpolateOneTexture(U, lonLatLev);\nfloat v = interpolateOneTexture(V, lonLatLev);\nfloat w = 0.0;\nreturn vec3(u, v, w);\n}\nvoid main() {\nvec3 lonLatLev = texture2D(currentParticlesPosition, v_textureCoordinates).rgb;\nvec3 windVector = bicubic(lonLatLev);\ngl_FragColor = vec4(windVector, 0.0);\n}",updateSpeed_frag="uniform sampler2D currentParticlesSpeed;\nuniform sampler2D particlesWind;\nuniform vec2 uSpeedRange;\nuniform vec2 vSpeedRange;\nuniform float pixelSize;\nuniform float speedFactor;\nvarying vec2 v_textureCoordinates;\nfloat calculateWindNorm(vec3 speed) {\nvec3 percent = vec3(0.0);\npercent.x = (speed.x - uSpeedRange.x) / (uSpeedRange.y - uSpeedRange.x);\npercent.y = (speed.y - vSpeedRange.x) / (vSpeedRange.y - vSpeedRange.x);\nfloat normalization = length(percent);\nreturn normalization;\n}\nvoid main() {\nvec3 currentSpeed = texture2D(currentParticlesSpeed, v_textureCoordinates).rgb;\nvec3 windVector = texture2D(particlesWind, v_textureCoordinates).rgb;\nvec4 nextSpeed = vec4(speedFactor * pixelSize * windVector, calculateWindNorm(windVector));\ngl_FragColor = nextSpeed;\n}",updatePosition_frag="uniform sampler2D currentParticlesPosition;\nuniform sampler2D currentParticlesSpeed;\nvarying vec2 v_textureCoordinates;\nvec2 lengthOfLonLat(vec3 lonLatLev) {\nfloat latitude = radians(lonLatLev.y);\nfloat term1 = 111132.92;\nfloat term2 = 559.82 * cos(2.0 * latitude);\nfloat term3 = 1.175 * cos(4.0 * latitude);\nfloat term4 = 0.0023 * cos(6.0 * latitude);\nfloat latLength = term1 - term2 + term3 - term4;\nfloat term5 = 111412.84 * cos(latitude);\nfloat term6 = 93.5 * cos(3.0 * latitude);\nfloat term7 = 0.118 * cos(5.0 * latitude);\nfloat longLength = term5 - term6 + term7;\nreturn vec2(longLength, latLength);\n}\nvoid updatePosition(vec3 lonLatLev, vec3 speed) {\nvec2 lonLatLength = lengthOfLonLat(lonLatLev);\nfloat u = speed.x / lonLatLength.x;\nfloat v = speed.y / lonLatLength.y;\nfloat w = 0.0;\nvec3 windVectorInLonLatLev = vec3(u, v, w);\nvec3 nextParticle = lonLatLev + windVectorInLonLatLev;\ngl_FragColor = vec4(nextParticle, 0.0);\n}\nvoid main() {\nvec3 lonLatLev = texture2D(currentParticlesPosition, v_textureCoordinates).rgb;\nvec3 speed = texture2D(currentParticlesSpeed, v_textureCoordinates).rgb;\nupdatePosition(lonLatLev, speed);\n}",postProcessingPosition_frag="uniform sampler2D nextParticlesPosition;\nuniform sampler2D nextParticlesSpeed;\nuniform vec2 lonRange;\nuniform vec2 latRange;\nuniform float randomCoefficient;\nuniform float dropRate;\nuniform float dropRateBump;\nvarying vec2 v_textureCoordinates;\nconst vec3 randomConstants = vec3(12.9898, 78.233, 4375.85453);\nconst vec2 normalRange = vec2(0.0, 1.0);\nfloat rand(vec2 seed, vec2 range) {\nvec2 randomSeed = randomCoefficient * seed;\nfloat temp = dot(randomConstants.xy, randomSeed);\ntemp = fract(sin(temp) * (randomConstants.z + temp));\nreturn temp * (range.y - range.x) + range.x;\n}\nvec3 generateRandomParticle(vec2 seed, float lev) {\nfloat randomLon = mod(rand(seed, lonRange), 360.0);\nfloat randomLat = rand(-seed, latRange);\nreturn vec3(randomLon, randomLat, lev);\n}\nbool particleOutbound(vec3 particle) {\nreturn particle.y < -90.0 || particle.y > 90.0;\n}\nvoid main() {\nvec3 nextParticle = texture2D(nextParticlesPosition, v_textureCoordinates).rgb;\nvec4 nextSpeed = texture2D(nextParticlesSpeed, v_textureCoordinates);\nfloat particleDropRate = dropRate + dropRateBump * nextSpeed.a;\nvec2 seed1 = nextParticle.xy + v_textureCoordinates;\nvec2 seed2 = nextSpeed.xy + v_textureCoordinates;\nvec3 randomParticle = generateRandomParticle(seed1, nextParticle.z);\nfloat randomNumber = rand(seed2, normalRange);\nif (randomNumber < particleDropRate || particleOutbound(nextParticle)) {\ngl_FragColor = vec4(randomParticle, 1.0);\n} else {\ngl_FragColor = vec4(nextParticle, 0.0);\n}\n}",postProcessingSpeed_frag="uniform sampler2D postProcessingPosition;\nuniform sampler2D nextParticlesSpeed;\nvarying vec2 v_textureCoordinates;\nvoid main() {\nvec4 randomParticle = texture2D(postProcessingPosition, v_textureCoordinates);\nvec4 particleSpeed = texture2D(nextParticlesSpeed, v_textureCoordinates);\nif (randomParticle.a > 0.0) {\ngl_FragColor = vec4(0.0);\n} else {\ngl_FragColor = particleSpeed;\n}\n}";CgsParticlesComputing=function(e,t,i,s){this.data=t,this.createWindTextures(e,t),this.createParticlesTextures(e,i,s),this.createComputingPrimitives(t,i,s)},CgsParticlesComputing.prototype.createWindTextures=function(e,t){var i={context:e,width:t.dimensions.lon,height:t.dimensions.lat*t.dimensions.lev,pixelFormat:Cesium.PixelFormat.LUMINANCE,pixelDatatype:Cesium.PixelDatatype.FLOAT,flipY:!1,sampler:new Cesium.Sampler({minificationFilter:Cesium.TextureMinificationFilter.NEAREST,magnificationFilter:Cesium.TextureMagnificationFilter.NEAREST})};this.windTextures={U:CgsUtil.createTexture(i,t.U.array),V:CgsUtil.createTexture(i,t.V.array)}},CgsParticlesComputing.prototype.createParticlesTextures=function(e,t,i){var s={context:e,width:t.particlesTextureSize,height:t.particlesTextureSize,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,flipY:!1,sampler:new Cesium.Sampler({minificationFilter:Cesium.TextureMinificationFilter.NEAREST,magnificationFilter:Cesium.TextureMagnificationFilter.NEAREST})},o=this.randomizeParticles(t.maxParticles,i),a=new Float32Array(4*t.maxParticles).fill(0);this.particlesTextures={particlesWind:CgsUtil.createTexture(s),currentParticlesPosition:CgsUtil.createTexture(s,o),nextParticlesPosition:CgsUtil.createTexture(s,o),currentParticlesSpeed:CgsUtil.createTexture(s,a),nextParticlesSpeed:CgsUtil.createTexture(s,a),postProcessingPosition:CgsUtil.createTexture(s,o),postProcessingSpeed:CgsUtil.createTexture(s,a)}},CgsParticlesComputing.prototype.randomizeParticles=function(e,t){for(var i=new Float32Array(4*e),s=0;s<e;s++)i[4*s]=Cesium.Math.randomBetween(t.lonRange.x,t.lonRange.y),i[4*s+1]=Cesium.Math.randomBetween(t.latRange.x,t.latRange.y),i[4*s+2]=Cesium.Math.randomBetween(this.data.lev.min,this.data.lev.max),i[4*s+3]=0;return i},CgsParticlesComputing.prototype.destroyParticlesTextures=function(){var t=this;Object.keys(this.particlesTextures).forEach(function(e){t.particlesTextures[e].destroy()})},CgsParticlesComputing.prototype.createComputingPrimitives=function(e,t,i){var s=new Cesium.Cartesian3(e.dimensions.lon,e.dimensions.lat,e.dimensions.lev),o=new Cesium.Cartesian3(e.lon.min,e.lat.min,e.lev.min),a=new Cesium.Cartesian3(e.lon.max,e.lat.max,e.lev.max),n=new Cesium.Cartesian3((a.x-o.x)/(s.x-1),(a.y-o.y)/(s.y-1),1<s.z?(a.z-o.z)/(s.z-1):1),r=new Cesium.Cartesian2(e.U.min,e.U.max),l=new Cesium.Cartesian2(e.V.min,e.V.max),u=this;this.primitives={getWind:new CgsCustomPrimitive({commandType:"Compute",uniformMap:{U:function(){return u.windTextures.U},V:function(){return u.windTextures.V},currentParticlesPosition:function(){return u.particlesTextures.currentParticlesPosition},dimension:function(){return s},minimum:function(){return o},maximum:function(){return a},interval:function(){return n}},fragmentShaderSource:new Cesium.ShaderSource({sources:[getWind_frag]}),outputTexture:this.particlesTextures.particlesWind,preExecute:function(){u.primitives.getWind.commandToExecute.outputTexture=u.particlesTextures.particlesWind}}),updateSpeed:new CgsCustomPrimitive({commandType:"Compute",uniformMap:{currentParticlesSpeed:function(){return u.particlesTextures.currentParticlesSpeed},particlesWind:function(){return u.particlesTextures.particlesWind},uSpeedRange:function(){return r},vSpeedRange:function(){return l},pixelSize:function(){return i.pixelSize},speedFactor:function(){return t.speedFactor}},fragmentShaderSource:new Cesium.ShaderSource({sources:[updateSpeed_frag]}),outputTexture:this.particlesTextures.nextParticlesSpeed,preExecute:function(){var e=u.particlesTextures.currentParticlesSpeed;u.particlesTextures.currentParticlesSpeed=u.particlesTextures.postProcessingSpeed,u.particlesTextures.postProcessingSpeed=e,u.primitives.updateSpeed.commandToExecute.outputTexture=u.particlesTextures.nextParticlesSpeed}}),updatePosition:new CgsCustomPrimitive({commandType:"Compute",uniformMap:{currentParticlesPosition:function(){return u.particlesTextures.currentParticlesPosition},currentParticlesSpeed:function(){return u.particlesTextures.currentParticlesSpeed}},fragmentShaderSource:new Cesium.ShaderSource({sources:[updatePosition_frag]}),outputTexture:this.particlesTextures.nextParticlesPosition,preExecute:function(){var e=u.particlesTextures.currentParticlesPosition;u.particlesTextures.currentParticlesPosition=u.particlesTextures.postProcessingPosition,u.particlesTextures.postProcessingPosition=e,u.primitives.updatePosition.commandToExecute.outputTexture=u.particlesTextures.nextParticlesPosition}}),postProcessingPosition:new CgsCustomPrimitive({commandType:"Compute",uniformMap:{nextParticlesPosition:function(){return u.particlesTextures.nextParticlesPosition},nextParticlesSpeed:function(){return u.particlesTextures.nextParticlesSpeed},lonRange:function(){return i.lonRange},latRange:function(){return i.latRange},randomCoefficient:function(){var e=Math.random();return e},dropRate:function(){return t.dropRate},dropRateBump:function(){return t.dropRateBump}},fragmentShaderSource:new Cesium.ShaderSource({sources:[postProcessingPosition_frag]}),outputTexture:this.particlesTextures.postProcessingPosition,preExecute:function(){u.primitives.postProcessingPosition.commandToExecute.outputTexture=u.particlesTextures.postProcessingPosition}}),postProcessingSpeed:new CgsCustomPrimitive({commandType:"Compute",uniformMap:{postProcessingPosition:function(){return u.particlesTextures.postProcessingPosition},nextParticlesSpeed:function(){return u.particlesTextures.nextParticlesSpeed}},fragmentShaderSource:new Cesium.ShaderSource({sources:[postProcessingSpeed_frag]}),outputTexture:this.particlesTextures.postProcessingSpeed,preExecute:function(){u.primitives.postProcessingSpeed.commandToExecute.outputTexture=u.particlesTextures.postProcessingSpeed}})}},CgsParticleSystem=function(e,t,i,s){this.context=e,this.data=t,this.userInput=i,this.viewerParameters=s,this.particlesComputing=new CgsParticlesComputing(this.context,this.data,this.userInput,this.viewerParameters),this.particlesRendering=new CgsParticlesRendering(this.context,this.data,this.userInput,this.viewerParameters,this.particlesComputing)},CgsParticleSystem.prototype.canvasResize=function(e){var t=this;this.particlesComputing.destroyParticlesTextures(),Object.keys(this.particlesComputing.windTextures).forEach(function(e){t.particlesComputing.windTextures[e].destroy()}),this.particlesRendering.textures.colorTable.destroy(),Object.keys(this.particlesRendering.framebuffers).forEach(function(e){t.particlesRendering.framebuffers[e].destroy()}),this.context=e,this.particlesComputing=new CgsParticlesComputing(this.context,this.data,this.userInput,this.viewerParameters),this.particlesRendering=new CgsParticlesRendering(this.context,this.data,this.userInput,this.viewerParameters,this.particlesComputing)},CgsParticleSystem.prototype.clearFramebuffers=function(){var t=this,i=new Cesium.ClearCommand({color:new Cesium.Color(0,0,0,0),depth:1,framebuffer:void 0,pass:Cesium.Pass.OPAQUE});Object.keys(this.particlesRendering.framebuffers).forEach(function(e){i.framebuffer=t.particlesRendering.framebuffers[e],i.execute(t.context)})},CgsParticleSystem.prototype.refreshParticles=function(e){var t,i;this.clearFramebuffers(),this.particlesComputing.destroyParticlesTextures(),this.particlesComputing.createParticlesTextures(this.context,this.userInput,this.viewerParameters),e&&(t=this.particlesRendering.createSegmentsGeometry(this.userInput),this.particlesRendering.primitives.segments.geometry=t,i=Cesium.VertexArray.fromGeometry({context:this.context,geometry:t,attributeLocations:this.particlesRendering.primitives.segments.attributeLocations,bufferUsage:Cesium.BufferUsage.STATIC_DRAW}),this.particlesRendering.primitives.segments.commandToExecute.vertexArray=i)},CgsParticleSystem.prototype.applyUserInput=function(t){var i=this,e=!1;this.userInput.maxParticles!=t.maxParticles&&(e=!0),Object.keys(t).forEach(function(e){i.userInput[e]=t[e]}),this.refreshParticles(e)},CgsParticleSystem.prototype.applyViewerParameters=function(t){var i=this;Object.keys(t).forEach(function(e){i.viewerParameters[e]=t[e]}),this.refreshParticles(!1)};var defaultParticleSystemOptions={maxParticles:4096,particleHeight:100,fadeOpacity:.996,dropRate:.003,dropRateBump:.01,speedFactor:.5,lineWidth:2};function fRandomByfloat(e,t){return e+Math.random()*(t-e)}CgsWindLayer3D=function(e){if(this.options=e,this.maxParticles=defaultParticleSystemOptions.maxParticles,this.particleHeight=defaultParticleSystemOptions.particleHeight,this.fadeOpacity=defaultParticleSystemOptions.fadeOpacity,this.dropRate=defaultParticleSystemOptions.dropRate,this.dropRateBump=defaultParticleSystemOptions.dropRateBump,this.speedFactor=defaultParticleSystemOptions.speedFactor,this.lineWidth=defaultParticleSystemOptions.lineWidth,e)for(var t in e)this[t]=e[t]},CgsInherits(CgsWindLayer3D,CgsBaseLayer),CgsWindLayer3D.prototype.getlayer=function(){return this.primitives},CgsWindLayer3D.prototype.mountedHook=function(){this.scene=this.map.scene,this.camera=this.map.camera,this.primitives=new Cesium.PrimitiveCollection,this.viewerParameters={lonRange:new Cesium.Cartesian2,latRange:new Cesium.Cartesian2,pixelSize:0},this.globeBoundingSphere=new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO,6314355.63),this.data&&this.setData(this.data)},CgsWindLayer3D.prototype.addedHook=function(){this.updateViewerParameters()},CgsWindLayer3D.prototype.destroy=function(){this.primitives.removeAll(),this.map.scene.primitives.remove(this.primitives)},CgsWindLayer3D.prototype.setData=function(e){this.particleSystem=new CgsParticleSystem(this.scene.context,e,this.getUserInput(),this.viewerParameters),this.addPrimitives(),this.setupEventListeners(),this.updateViewerParameters()},CgsWindLayer3D.prototype.setOptions=function(e){if(e)for(var t in e)this[t]=e[t];return this.particleSystem.applyUserInput(this.getUserInput()),this},CgsWindLayer3D.prototype.getUserInput=function(){var e=Math.ceil(Math.sqrt(this.maxParticles));return this.maxParticles=e*e,{particlesTextureSize:e,maxParticles:this.maxParticles,particleHeight:this.particleHeight,fadeOpacity:this.fadeOpacity,dropRate:this.dropRate,dropRateBump:this.dropRateBump,speedFactor:this.speedFactor,lineWidth:this.lineWidth,globeLayer:this.globeLayer,WMS_URL:this.WMS_URL}},CgsWindLayer3D.prototype.addPrimitives=function(){if(!this.particleSystem)return!1;this.primitives.add(this.particleSystem.particlesComputing.primitives.getWind),this.primitives.add(this.particleSystem.particlesComputing.primitives.updateSpeed),this.primitives.add(this.particleSystem.particlesComputing.primitives.updatePosition),this.primitives.add(this.particleSystem.particlesComputing.primitives.postProcessingPosition),this.primitives.add(this.particleSystem.particlesComputing.primitives.postProcessingSpeed),this.primitives.add(this.particleSystem.particlesRendering.primitives.segments),this.primitives.add(this.particleSystem.particlesRendering.primitives.trails),this.primitives.add(this.particleSystem.particlesRendering.primitives.screen)},CgsWindLayer3D.prototype.updateViewerParameters=function(){var e,t=this.camera.computeViewRectangle(this.scene.globe.ellipsoid);t||(e=this.map.getExtent(),t=Cesium.Rectangle.fromDegrees(e.xmin,e.ymin,e.xmax,e.ymax));var i=CgsUtil.viewRectangleToLonLatRange(t);this.viewerParameters.lonRange.x=i.lon.min,this.viewerParameters.lonRange.y=i.lon.max,this.viewerParameters.latRange.x=i.lat.min,this.viewerParameters.latRange.y=i.lat.max;var s=this.camera.getPixelSize(this.globeBoundingSphere,this.scene.drawingBufferWidth,this.scene.drawingBufferHeight);0<s&&(this.viewerParameters.pixelSize=s),this.CanvasWidth=this.scene.canvas.width,this.CanvasHeight=this.scene.canvas.height},CgsWindLayer3D.prototype.setupEventListeners=function(){var e=this;this.camera.moveStart.addEventListener(function(){e.map&&(e.primitives._primitives.forEach(function(e){}),e.primitives.show=!1)}),this.camera.moveEnd.addEventListener(function(){e.map&&(e.updateViewerParameters(),e.particleSystem.applyViewerParameters(e.viewerParameters),e.primitives.show=!0)});var t=!1;this.scene.preRender.addEventListener(function(){if(e.map&&e instanceof CgsWindLayer3D){if(e.CanvasWidth!=e.scene.canvas.width||e.CanvasHeight!=e.scene.canvas.height){if(!(0<e.primitives._primitives.length))return!1;e.primitives.removeAll(),e.primitives.show=!1,e.CanvasWidth=e.scene.canvas.width,e.CanvasHeight=e.scene.canvas.height,t=!0}t&&(e.particleSystem.canvasResize(e.scene.context),t=!1,e.addPrimitives(),e.primitives.show=!0)}})},CgsWindLayer3D.prototype.getType=function(e){return"windlayer"},CgsWindLayer3D.prototype.getMap=function(){return this.map},CgsWindLayer3D.prototype.setMap=function(e){e&&e.scene&&(this.map=e,this.mountedHook())},CgsWindLayer=function(e){this.feature3D=new CgsWindLayer3D(e)},CgsWindLayer.prototype.setData=function(e){this.feature3D.setData(e)},CgsWindLayer.prototype.setOptions=function(e){this.feature3D.setOptions(e)},CgsWindLayer.prototype.getMap=function(){return this.feature3D.getMap()},CgsWindLayer.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsWindLayer.prototype.destroy=function(){this.feature3D.destroy()},CgsCanvasParticle=function(){this.lng=null,this.lat=null,this.tlng=null,this.tlat=null,this.age=null},CgsCanvasWindField=function(e,t){this.rows=e.rows,this.cols=e.cols,this.xmin=e.xmin,this.xmax=e.xmax,this.ymin=e.ymin,this.ymax=e.ymax,this.grid=[];var i=e.udata,s=e.vdata,o=!1;i.length===this.rows&&i[0].length===this.cols&&(o=!0);for(var a=0,n=null,r=null,l=0;l<this.rows;l++){n=[];for(var u=0;u<this.cols;u++,a++)r=o?this._calcUV(i[l][u],s[l][u]):this._calcUV(i[a],s[a]),n.push(r);this.grid.push(n)}t&&this.grid.reverse()},CgsCanvasWindField.prototype.toGridXY=function(e,t){return{x:(e-this.xmin)/(this.xmax-this.xmin)*(this.cols-1),y:(this.ymax-t)/(this.ymax-this.ymin)*(this.rows-1)}},CgsCanvasWindField.prototype.getUVByXY=function(t,i){if(t<0||t>=this.cols||i>=this.rows)return[0,0,0];var e,s,o=Math.floor(t),a=Math.floor(i);if(o===t&&a===i)return this.grid[i][t];e=o+1,s=a+1;var n=this.getUVByXY(o,a),r=this.getUVByXY(e,a),l=this.getUVByXY(o,s),u=this.getUVByXY(e,s),p=null;try{p=this._bilinearInterpolation(t-o,i-a,n,r,l,u)}catch(e){console.log(t,i)}return p},CgsCanvasWindField.prototype._bilinearInterpolation=function(e,t,i,s,o,a){var n=1-e,r=1-t,l=n*r,u=e*r,p=n*t,h=e*t,c=i[0]*l+s[0]*u+o[0]*p+a[0]*h,g=i[1]*l+s[1]*u+o[1]*p+a[1]*h;return this._calcUV(c,g)},CgsCanvasWindField.prototype._calcUV=function(e,t){return[+e,+t,Math.sqrt(e*e+t*t)]},CgsCanvasWindField.prototype.getUVByPoint=function(e,t){if(!this.isInExtent(e,t))return null;var i=this.toGridXY(e,t);return this.getUVByXY(i.x,i.y)},CgsCanvasWindField.prototype.isInExtent=function(e,t){return e>=this.xmin&&e<=this.xmax&&t>=this.ymin&&t<=this.ymax},CgsCanvasWindField.prototype.getRandomLatLng=function(){var e=fRandomByfloat(this.xmin,this.xmax);return{lat:fRandomByfloat(this.ymin,this.ymax),lng:e}},CgsCanvasWindLayer3D=function(e){this.options=e,this.calc_speedRate=[0,0],this.particles=[],this.speedRate=e.speedRate||50,this.particlesNumber=e.particlesNumber||2e4,this.maxAge=e.maxAge||120,this.frameTime=1e3/(e.frameRate||10),this.pointerEvents=Cesium.defaultValue(e.pointerEvents,!1),this.color=e.color||"#ffffff",this.lineWidth=e.lineWidth||1,this.fixedHeight=Cesium.defaultValue(e.fixedHeight,0),this.reverseY=Cesium.defaultValue(e.reverseY,!1),this.canvas=null,this.show=!0},CgsInherits(CgsCanvasWindLayer3D,CgsBaseLayer),CgsCanvasWindLayer3D.prototype.getlayer=function(){return this.canvas},CgsCanvasWindLayer3D.prototype.getcanvasWidth=function(){return this.map.scene.canvas.clientWidth},CgsCanvasWindLayer3D.prototype.getcanvasHeight=function(){return this.map.scene.canvas.clientHeight},CgsCanvasWindLayer3D.prototype.getpointerEvents=function(){return this.pointerEvents},CgsCanvasWindLayer3D.prototype.setpointerEvents=function(e){this.pointerEvents=e,this.canvas.style["pointer-events"]=e?"all":"none"},CgsCanvasWindLayer3D.prototype.getspeedRate=function(){return this.speedRate},CgsCanvasWindLayer3D.prototype.setspeedRate=function(e){this.speedRate=e,this.speedRate1=100*(100-(99<e?99:e)),this.calcStep()},CgsCanvasWindLayer3D.prototype.getparticlesNumber=function(){return this.particlesNumber},CgsCanvasWindLayer3D.prototype.setparticlesNumber=function(e){var t=this;this.particlesNumber=e,clearTimeout(this.canrefresh),this.canrefresh=setTimeout(function(){t.redraw()},500)},CgsCanvasWindLayer3D.prototype.getmaxAge=function(){return this.maxAge},CgsCanvasWindLayer3D.prototype.setmaxAge=function(e){var t=this;this.maxAge=e,clearTimeout(this.canrefresh),this.canrefresh=setTimeout(function(){t.redraw()},500)},CgsCanvasWindLayer3D.prototype.getdata=function(){return this.windData},CgsCanvasWindLayer3D.prototype.setdata=function(e){this.updateDate(e)},CgsCanvasWindLayer3D.prototype.showHook=function(e){this.canvas&&(this.canvas.style.visibility=e?"visible":"hidden")},CgsCanvasWindLayer3D.prototype.addedHook=function(){this.canvas=this.createCanvas(),this.canvasContext=this.canvas.getContext("2d"),this.bindEvent(),this.options.data&&this.updateDate(this.options.data)},CgsCanvasWindLayer3D.prototype.destroy=function(){this.clear(),this.unbindEvent(),this.canvas&&(this.map.container.removeChild(this.canvas),delete this.canvas)},CgsCanvasWindLayer3D.prototype.createCanvas=function(){var e=document.createElement("canvas");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",e.style.pointerEvents=this.pointerEvents?"auto":"none",e.style.zIndex=10,e.setAttribute("id","canvasWindy"),e.setAttribute("class","canvasWindy"),this.map.container.appendChild(e);var t=this.map.scene;return e.width=t.canvas.clientWidth,e.height=t.canvas.clientHeight,this.canvasWidth=t.canvas.clientWidth,this.canvasHeight=t.canvas.clientHeight,e},CgsCanvasWindLayer3D.prototype.bindEvent=function(){var t=this,s=this,o=Date.now();!function e(){s.animateFrame=window.requestAnimationFrame(e);var t=Date.now(),i=t-o;i>s.frameTime&&(o=t-i%s.frameTime,s.update())}(),this.handler=new Cesium.ScreenSpaceEventHandler(this.map.scene.canvas);var i=!1,a=!1;this.handler.setInputAction(function(e){clearTimeout(-1),t.show=!1,setTimeout(function(){t.redraw(),t.show=!0},200)},Cesium.ScreenSpaceEventType.WHEEL),this.handler.setInputAction(function(e){i=!0},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction(function(e){i=!0},Cesium.ScreenSpaceEventType.RIGHT_DOWN),this.handler.setInputAction(function(e){i&&(t.show=!1,a=!0,t.canvas.style.visibility="hidden")},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){i&&a&&(t.canvas.style.visibility="visible",t.redraw()),t.show=!0,a=i=!1},Cesium.ScreenSpaceEventType.LEFT_UP),this.handler.setInputAction(function(e){i&&a&&(t.canvas.style.visibility="visible",t.redraw()),t.show=!0,a=i=!1},Cesium.ScreenSpaceEventType.RIGHT_UP)},CgsCanvasWindLayer3D.prototype.unbindEvent=function(){window.cancelAnimationFrame(this.animateFrame),delete this.animateFrame,this.handler&&(this.handler.destroy(),this.handler=null)},CgsCanvasWindLayer3D.prototype.redraw=function(){this.particles=[],this.drawWind()},CgsCanvasWindLayer3D.prototype.updateDate=function(e){this.clear(),this.windData=e,this.windField=new CgsCanvasWindField(this.windData,this.reverseY),this.drawWind()},CgsCanvasWindLayer3D.prototype.drawWind=function(){this.speedRate1=100*(100-(99<this.speedRate?99:this.speedRate)),this.calcStep();for(var e=0;e<this.particlesNumber;e++){var t=this.randomParticle(new CgsCanvasParticle);this.particles.push(t)}this.canvasContext.fillStyle="rgba(0, 0, 0, 0.97)",this.canvasContext.globalAlpha=.6,this.update()},CgsCanvasWindLayer3D.prototype.calcStep=function(){this.windField&&(this.calc_speedRate=[(this.windField.xmax-this.windField.xmin)/this.speedRate1,(this.windField.ymax-this.windField.ymin)/this.speedRate1])},CgsCanvasWindLayer3D.prototype.update=function(){var s,o,a,n=this;!this.show||this.particles.length<=0||(a=o=s=null,this.particles.forEach(function(e){var t,i;e.age<=0&&n.randomParticle(e),0<e.age&&(t=e.tlng,i=e.tlat,(a=n.windField.getUVByPoint(t,i))?(s=t+n.calc_speedRate[0]*a[0],o=i+n.calc_speedRate[1]*a[1],e.lng=t,e.lat=i,e.tlng=s,e.tlat=o,e.age--):e.age=0)}),this.drawLines())},CgsCanvasWindLayer3D.prototype.tomap=function(e,t,i){var s=Cesium.Cartesian3.fromDegrees(e,t,this.fixedHeight),o=this.map.scene;if(o.mode===Cesium.SceneMode.SCENE3D&&!new Cesium.EllipsoidalOccluder(o.globe.ellipsoid,o.camera.positionWC).isPointVisible(s))return i.age=0,null;var a=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.map.scene,s);return a?[a.x,a.y]:null},CgsCanvasWindLayer3D.prototype.drawLines=function(){var o=this,e=this.particles;this.canvasContext.canvas.width==this.map.scene.canvas.width&&this.canvasContext.canvas.height==this.map.scene.canvas.height||(this.canvasContext.canvas.width=this.map.scene.canvas.width,this.canvasContext.canvas.height=this.map.scene.canvas.height),this.canvasContext.lineWidth=o.lineWidth,this.canvasContext.globalCompositeOperation="destination-in",this.canvasContext.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.canvasContext.globalCompositeOperation="lighter",this.canvasContext.globalAlpha=.9,this.canvasContext.beginPath(),this.canvasContext.strokeStyle=this.color;var a=this.map.scene.mode!==Cesium.SceneMode.SCENE3D;e.forEach(function(e){var t,i=o.tomap(e.lng,e.lat,e),s=o.tomap(e.tlng,e.tlat,e);null!=i&&null!=s&&(t=Math.abs(i[0]-s[0]),a&&t>=o.canvasWidth||(o.canvasContext.moveTo(i[0],i[1]),o.canvasContext.lineTo(s[0],s[1])))}),this.canvasContext.stroke()},CgsCanvasWindLayer3D.prototype.randomParticle=function(e){for(var t=void 0,i=void 0,s=0;s<30&&(t=this.windField.getRandomLatLng(),!((i=this.windField.getUVByPoint(t.lng,t.lat))&&0<i[2]));s++);if(!i)return e;var o=t.lng+this.calc_speedRate[0]*i[0],a=t.lat+this.calc_speedRate[1]*i[1];return e.lng=t.lng,e.lat=t.lat,e.tlng=o,e.tlat=a,e.age=Math.round(Math.random()*this.maxAge),e},CgsCanvasWindLayer3D.prototype.clear=function(){this.particles=[],delete this.windField,delete this.windData},CgsCanvasWindLayer3D.prototype.getType=function(e){return"CanvasWindLayer"},CgsCanvasWindLayer3D.prototype.getMap=function(){return this.map},CgsCanvasWindLayer3D.prototype.setMap=function(e){e&&e.scene&&(this.map=e,this.addedHook())},CgsCanvasWindLayer=function(e){this.feature3D=new CgsCanvasWindLayer3D(e)},CgsCanvasWindLayer.prototype.setdata=function(e){this.feature3D.setdata(e)},CgsCanvasWindLayer.prototype.setParticlesNumber=function(e){this.feature3D.particlesNumber=e},CgsCanvasWindLayer.prototype.getParticlesNumber=function(){return this.feature3D.particlesNumber},CgsCanvasWindLayer.prototype.setMaxAge=function(e){this.feature3D.maxAge=e},CgsCanvasWindLayer.prototype.getMaxAge=function(){return this.feature3D.maxAge},CgsCanvasWindLayer.prototype.setSpeedRate=function(e){this.feature3D.speedRate=e},CgsCanvasWindLayer.prototype.getSpeedRate=function(){return this.feature3D.speedRate},CgsCanvasWindLayer.prototype.setLineWidth=function(e){this.feature3D.lineWidth=e},CgsCanvasWindLayer.prototype.getLineWidth=function(){return this.feature3D.lineWidth=val},CgsCanvasWindLayer.prototype.setColor=function(e){this.feature3D.color=e},CgsCanvasWindLayer.prototype.getColor=function(){return this.feature3D.color=color},CgsCanvasWindLayer.prototype.getMap=function(){return this.feature3D.getMap()},CgsCanvasWindLayer.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsCanvasWindLayer.prototype.destroy=function(){this.feature3D.destroy()},CgsCompositeCoordinateSystem=function(e,t){this.GLMap=e,this.dimensions=["lng","lat"],this.mapOffset=[0,0],this.api=t},CgsCompositeCoordinateSystem.prototype.setMapOffset=function(e){this.mapOffset=e},CgsCompositeCoordinateSystem.prototype.getBMap=function(){return this.GLMap},CgsCompositeCoordinateSystem.prototype.dataToPoint=function(e){var t=this.GLMap,i=[NaN,NaN],s=t.echartsFixedHeight;t.echartsAutoHeight&&(s=t.globe.getHeight(Cesium.Cartographic.fromDegrees(e[0],e[1])));var o=Cesium.Cartesian3.fromDegrees(e[0],e[1],s);if(!o)return i;var a=Cesium.SceneTransforms.wgs84ToWindowCoordinates(t,o);if(!a)return i;if(t.echartsDepthTest&&t.mode===Cesium.SceneMode.SCENE3D&&!new Cesium.EllipsoidalOccluder(t.globe.ellipsoid,t.camera.positionWC).isPointVisible(o))return i;return[a.x-this.mapOffset[0],a.y-this.mapOffset[1]].splice(),[a.x-this.mapOffset[0],a.y-this.mapOffset[1]]},CgsCompositeCoordinateSystem.prototype.getViewRect=function(){var e=this.api;return new echarts.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())},CgsCompositeCoordinateSystem.prototype.getRoamTransform=function(){return echarts.matrix.create()},CgsCompositeCoordinateSystem.prototype.create=function(e,i){var s=void 0;e.eachComponent("GLMap",function(e){var t;i.getZr().painter&&(t=echarts.glMap,(s=new CgsCompositeCoordinateSystem(t,i)).setMapOffset(e.mapOffset||[0,0]),e.coordinateSystem=s)}),e.eachSeries(function(e){"GLMap"===e.get("coordinateSystem")&&(e.coordinateSystem=s)})};var div_zIndex=999;CgsEchartsLayer3D=function(e){this.options=e,this.pointerEvents=Cesium.defaultValue(this.options.pointerEvents,!1),this.isRegistered=!1},CgsInherits(CgsEchartsLayer3D,CgsBaseLayer),CgsEchartsLayer3D.prototype.getlayer=function(){return this.echartsInstance},CgsEchartsLayer3D.prototype.showHook=function(e){this.echartsContainer.style.visibility=e?"visible":"hidden"},CgsEchartsLayer3D.prototype.mountedHook=function(){if(!echarts)throw new Error("请引入 echarts 库 ");this.map.scene.echartsDepthTest=Cesium.defaultValue(this.options.depthTest,!0),this.map.scene.echartsAutoHeight=Cesium.defaultValue(this.options.clampToGround,!1),this.map.scene.echartsFixedHeight=Cesium.defaultValue(this.options.fixedHeight,0),this.addedHook()},CgsEchartsLayer3D.prototype.addedHook=function(){this.echartsInstance=this.createChartOverlay(),this.setEchartsOption(this.options);var e=this;this.map.scene.preRender.addEventListener(function(){e.map&&e.echartsContainer&&(e.echartsContainer.style.width==e.map.scene.canvas.width+"px"&&e.echartsContainer.style.height==e.map.scene.canvas.height+"px"||e.resize())})},CgsEchartsLayer3D.prototype.destory=function(){this.echartsContainer&&(this.map.container.removeChild(this.echartsContainer),this.echartsContainer=null),this.echartsInstance&&(this.echartsInstance.dispose(),this.echartsInstance=null)},CgsEchartsLayer3D.prototype.createChartOverlay=function(){var e=this.map.scene;e.canvas.setAttribute("tabIndex",0);var t=document.createElement("div");return t.className="Cgs-echarts",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.width=e.canvas.clientWidth+"px",t.style.height=e.canvas.clientHeight+"px",t.style.pointerEvents=this.pointerEvents?"auto":"none",t.style.zIndex=div_zIndex++,this.map.container.appendChild(t),this.echartsContainer=t,echarts.glMap=e,this.register(),echarts.init(t)},CgsEchartsLayer3D.prototype.register=function(){this.isRegistered||(echarts.registerCoordinateSystem("GLMap",new CgsCompositeCoordinateSystem(echarts.glMap)),echarts.registerAction({type:"GLMapRoam",event:"GLMapRoam",update:"updateLayout"},function(e,t){}),echarts.extendComponentModel({type:"GLMap",getBMap:function(){return this.GLMap},defaultOption:{roam:!1}}),echarts.extendComponentView({type:"GLMap",init:function(e,t){this.api=t,echarts.glMap.postRender.addEventListener(this.moveHandler,this)},moveHandler:function(){this.api.dispatchAction({type:"GLMapRoam"})},render:function(){},dispose:function(){echarts.glMap.postRender.removeEventListener(this.moveHandler,this)}}),this.isRegistered=!0)},CgsEchartsLayer3D.prototype.resize=function(){var e;this.echartsInstance&&(e=this.map.scene,this.echartsContainer.style.width=e.canvas.clientWidth+"px",this.echartsContainer.style.height=e.canvas.clientHeight+"px",this.echartsInstance.resize())},CgsEchartsLayer3D.prototype.setEchartsOption=function(e,t,i){this.echartsInstance&&this.echartsInstance.setOption(e,t,i)},CgsEchartsLayer3D.prototype.getType=function(e){return"EchartsLayer"},CgsEchartsLayer3D.prototype.getMap=function(){return this.map},CgsEchartsLayer3D.prototype.setMap=function(e){e&&(this.map=e)};var initOP={depthTest:!0,fixedHeight:0,clampToGround:!1,pointerEvents:!1};CgsEchartsLayer=function(e){e=e||initOP,this.feature3D=new CgsEchartsLayer3D(e)},CgsEchartsLayer.prototype.getlayer=function(){return this.feature3D.getlayer()},CgsEchartsLayer.prototype.showHook=function(e){this.feature3D.showHook(e)},CgsEchartsLayer.prototype.resize=function(){this.feature3D.resize()},CgsEchartsLayer.prototype.setEchartsOption=function(e,t,i){this.feature3D.setEchartsOption(e,t,i)},CgsEchartsLayer.prototype.getMap=function(){return this.feature3D.getMap()},CgsEchartsLayer.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsEchartsLayer.prototype.destory=function(){this.feature3D.destory()},CgsThreeLayer3D=function(e){for(var t in e)this[t]=e[t],this.pointerEvents=Cesium.defaultValue(e.pointerEvents,void 0)},CgsInherits(CgsThreeLayer3D,CgsBaseLayer),CgsThreeLayer3D.prototype.showHook=function(e){this.threejsContainer.style.visibility=e?"visible":"hidden"},CgsThreeLayer3D.prototype.mountedHook=function(){if(!THREE)throw new Error("请引入 three.js 库 ");var e=this.map.scene,t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.width=e.canvas.clientWidth+"px",t.style.height=e.canvas.clientHeight+"px",t.style.pointerEvents=this.pointerEvents?"auto":"none",this.container=t;var i=e.canvas.clientWidth/e.canvas.clientHeight;this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(45,i,1,1e7),this.renderer=new THREE.WebGLRenderer({alpha:!0}),t.appendChild(this.renderer.domElement),this.addedHook()},CgsThreeLayer3D.prototype.addedHook=function(){this.container&&this.map.container.appendChild(this.container),this.map.useDefaultRenderLoop=!1;var t=this;!function e(){t.animateFrame=window.requestAnimationFrame(e),t.update()}()},CgsThreeLayer3D.prototype.destory=function(){window.cancelAnimationFrame(this.animateFrame),delete this.animateFrame,this.map.useDefaultRenderLoop=!0,this.container&&this.map.container.removeChild(this.container),this.map=null},CgsThreeLayer3D.prototype.update=function(){this.renderCesium(),this.renderThreeObj(),this.renderCamera()},CgsThreeLayer3D.prototype.renderCesium=function(){this.map.cesiumWidget.render()},CgsThreeLayer3D.prototype.renderThreeObj=function(){var e=this.container.clientWidth,t=this.container.clientHeight;this.renderer.setSize(e,t),this.renderer.render(this.scene,this.camera)},CgsThreeLayer3D.prototype.renderCamera=function(){this.camera.fov=Cesium.Math.toDegrees(this.map.camera.frustum.fovy),this.camera.updateProjectionMatrix(),this.camera.matrixAutoUpdate=!1,this.camera.lookAt(new THREE.Vector3(0,0,0));var e=this.map.camera.viewMatrix,t=this.map.camera.inverseViewMatrix;this.camera.matrixWorld.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this.camera.matrixWorldInverse.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]);var i=this.map.scene.canvas.clientWidth,s=this.map.scene.canvas.clientHeight;this.camera.aspect=i/s,this.renderer.setSize(i,s),this.camera.updateProjectionMatrix(),this.renderer.clear(),this.renderer.render(this.scene,this.camera)},CgsThreeLayer3D.prototype.getType=function(e){return"threeLayer"},CgsThreeLayer3D.prototype.getMap=function(){return this.map},CgsThreeLayer3D.prototype.setMap=function(e){e&&(this.map=e)},CgsThreeLayer=function(e){this.feature3D=new CgsThreeLayer3D(e)},CgsThreeLayer.prototype.getMap=function(){return this.feature3D.getMap()},CgsThreeLayer.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsThreeLayer.prototype.destory=function(){this.feature3D.destory()},CgsPolylinePrimitive3D=function(e){for(var t in e)this[t]=e[t];this.primitiveCollection=new Cesium.PolylineCollection},CgsInherits(CgsPolylinePrimitive3D,CgsBasePolyPrimitive),CgsPolylinePrimitive3D.prototype.getPrimitiveCollection=function(){return this.layer.polylineCollection},CgsPolylinePrimitive3D.prototype.addedHook=function(e){for(var t in e)this[t]=e[t];var i=this.style;i.show=!this.show||this.show,this.style.closure&&0<this.positions.length?i.positions=this.positions.concat(this.positions[0]):i.positions=this.positions,this.primitiveCollection.add(i)},CgsPolylinePrimitive3D.prototype.updateStyleHook=function(e){PolylineStyleConver.toCesiumVal(this.style,this.primitive)},CgsPolylinePrimitive3D.prototype.updatePositionsHook=function(){this.style.closure&&0<this.positions.length?this.primitive.positions=this.positions.concat(this.positions[0]):this.primitive.positions=this.positions},CgsPolylinePrimitive3D.prototype.getType=function(){return"PolylinePrimitive"},CgsPolylinePrimitive3D.prototype.getMap=function(){return this.map},CgsPolylinePrimitive3D.prototype.setMap=function(e){this.map=e},CgsPolylinePrimitive=function(e){this.feature3D=new CgsPolylinePrimitive3D(e)},CgsPolylinePrimitive.prototype.addedHook=function(e){this.feature3D.addedHook(e)},CgsPolylinePrimitive.prototype.getType=function(){return this.feature3D.getType()},CgsPolylinePrimitive.prototype.getMap=function(){return this.feature3D.getMap()},CgsPolylinePrimitive.prototype.setMap=function(e){this.feature3D.setMap(e)},CgsPolygonStyleConver=function(){},CgsInherits(CgsPolygonStyleConver,CgsBaseStyleConver),CgsPolygonStyleConver.prototype.toCesiumVal=function(e,t,i){return this.polygonStyleConve=new CgsBaseOptsConver,this.polygonStyleConve.toCesiumVal(e,e,!0)},CgsPolygonStyleConver.prototype.toCesiumValBefore=function(e,t){this.isEntity||"Color"!=e.materialType||delete e.materialType,e.clampToGround?t.arcType=Cesium.ArcType.GEODESIC:Cesium.defined(e.height)?(e.clampToGround=!1,t.perPositionHeight=!1):(e.clampToGround=!1,t.perPositionHeight=!0)},CgsPolygonStyleConver.prototype.toOneCesiumVal=function(e,t,i,s){switch(e){default:this.toOneCesiumValPoly(e,t,i,s);break;case"outlineColor":s.outlineColor=this.getOutlineColorByStyle(i);break;case"height":s[e]=t,s.perPositionHeight=!1;break;case"diffHeight":0<t&&Cesium.defined(i.height)&&(s.extrudedHeight=t+i.height);break;case"clampToGround":s[e]=t,s.perPositionHeight=!t&&!Cesium.defined(i.height);break;case"stRotationDegree":s.stRotation=Cesium.Math.toRadians(t)}},CgsPolygonStyleConver.prototype.toJSON=function(e,t,i){return this.polygonStyleConve=new CgsBaseOptsConver,this.polygonStyleConve.toJSON(e,t)},CgsPolygonStyleConver.prototype.toOneJson=function(e,t,i){"stRotation"!==e?this.toOneJsonPoly(e,t,i):i.stRotationDegree=CgsUtil.formatNum(Cesium.Math.toDegrees(t),1)};var nullColor=new Cesium.Color(0,0,0,.01);CgsPolygonPrimitive=function(e){this.options=e},CgsInherits(CgsPolygonPrimitive,CgsPolygonStyleConver),CgsPolygonPrimitive.prototype.getCenter=function(){return this.centerOfMass},CgsPolygonPrimitive.prototype.getPositions=function(){return this._positions},CgsPolygonPrimitive.prototype.setPositions=function(e){e&&0<e.length&&Array.isArray(e[0])&&0<e[0].length&&Array.isArray(e[0][0])&&CgsUtil.isNumber(e[0][0][0])&&(this._hierarchy=CgsUtil.getPolygonHierarchy(e),e=this._hierarchy.positions)},CgsPolygonPrimitive.prototype._createGeometryInstance=function(e,t){this._hierarchy?e.polygonHierarchy=this._hierarchy:e.polygonHierarchy=new Cesium.PolygonHierarchy(this.positions);var i=t?Cesium.PolygonOutlineGeometry:Cesium.PolygonGeometry;return new Cesium.GeometryInstance({id:this.uuid,geometry:new i(e),attributes:this.options.attributes})},CgsPolygonPrimitive.prototype._conversionStyle=function(){var e=this.toCesiumVal(this.style);return e=this._bindExType(e)},CgsPolygonPrimitive.prototype._bindExType=function(e){var t,i,s,o,a=this.options.buildings;a&&(a.bottomHeight&&(t=Number(this.attr[a.bottomHeight]||0),e.height=t),i=Number(this.attr[a.cloumn]||1),s=void 0,s=CgsUtil.isNumber(a.height)?a.height:CgsUtil.isString(a.height)?this.attr[a.height]||s:3.5,o=e.height||0,e.extrudedHeight=o+i*s),this.options.dth&&(Cesium.defined(e.color)||(e.color=nullColor),e.classification=!0,e.zIndex=99);var n,r,l=this.options.mask;return l&&(n={xmin:73,xmax:136,ymin:3,ymax:59},CgsUtil.isObject(l)&&Cesium.defined(l.xmin)&&Cesium.defined(l.xmax)&&Cesium.defined(l.ymin)&&Cesium.defined(l.ymax)&&(n=l),r=CgsUtil.lonlats2cartesians([[n.xmin,n.ymax],[n.xmin,n.ymin],[n.xmax,n.ymin],[n.xmax,n.ymax],[n.xmin,n.ymax]]),this._hierarchy=new Cesium.PolygonHierarchy(r,[new Cesium.PolygonHierarchy(this._positions)])),e},CgsPolygonPrimitive.prototype.updateHeight=function(e){for(var t=0,i=this.primitiveCollection.length;t<i;t++){var s=this.primitiveCollection.get(t),o=(6378137+e)/(6378137+this.style.height),a=Cesium.Matrix4.fromScale(new Cesium.Cartesian3(o,o,o));s.modelMatrix=a}},CgsPolygonPrimitive.prototype._style2Json=function(e,t){return this.toJSON(e,t)},CgsPolygonPrimitive.prototype._getGeoJsonGeometry=function(){return{type:"Polygon",coordinates:[this.coordinates]}},CgsPolygonPrimitive.prototype.getType=function(){return"polygonP"},CgsPolygonPrimitive.prototype.getMap=function(){return this.map},CgsPolygonPrimitive.prototype.setMap=function(e){this.map=e},CgsWaterNormals3D=function(e){this.options=e,this.positions=e.options,this.style=e.style,this.style.height=e.style.height,this.style.specularIntensity=e.style.specularIntensity,this.style.baseWaterColor=e.style.baseWaterColor,this.style.blendColor=e.style.blendColor,this.style.opacity=e.style.opacity,this.show=e.show,this.style.clampToGround=e.style.clampToGround,this.style.classificationType=e.style.classificationType,this.primitiveCollection=new Cesium.PrimitiveCollection;var i=[];e.positions.forEach(function(e){var t=CgsUtil.LatLngPointParse(e);t&&i.push(Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt))}),this.positions=i},CgsInherits(CgsWaterNormals3D,CgsPolygonPrimitive),CgsWaterNormals3D.prototype._addedHook=function(){var e=this._conversionStyle(),t={geometryInstances:this._createGeometryInstance(e),appearance:new Cesium.EllipsoidSurfaceAppearance({aboveGround:!1,material:new Cesium.Material({fabric:{type:"Water",uniforms:{normalMap:e.normalMap,frequency:e.frequency||8e3,animationSpeed:e.animationSpeed||.03,amplitude:e.amplitude||5,specularIntensity:this.style.specularIntensity||.8,baseWaterColor:Cesium.Color.fromCssColorString(this.style.baseWaterColor||"#123e59"),blendColor:Cesium.Color.fromCssColorString(this.style.blendColor||"#123e59")}}}),fragmentShaderSource:this.getWaterShader(this.style.opacity)}),show:this.show};this.style.clampToGround?(t.classificationType=Cesium.defaultValue(this.style.classificationType,Cesium.ClassificationType.TERRAIN),this._primitive=this.primitiveCollection.add(new Cesium.GroundPrimitive(t))):this._primitive=this.primitiveCollection.add(new Cesium.Primitive(t))},CgsWaterNormals3D.prototype.getWaterShader=function(e){return"\n      varying vec3 v_positionMC;\n      varying vec3 v_positionEC;\n      varying vec2 v_st;\n\n      void main()\n      {\n          czm_materialInput materialInput;\n          vec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n          #ifdef FACE_FORWARD\n              normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n          #endif\n              materialInput.s = v_st.s;\n              materialInput.st = v_st;\n              materialInput.str = vec3(v_st, 0.0);\n              materialInput.normalEC = normalEC;\n              materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n              vec3 positionToEyeEC = -v_positionEC;\n              materialInput.positionToEyeEC = positionToEyeEC;\n              czm_material material = czm_getMaterial(materialInput);\n          #ifdef FLAT\n              gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n          #else\n              gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n              gl_FragColor.a = "+(e=Cesium.defaultValue(e,.5))+";\n          #endif\n      }"},CgsWaterNormals3D.prototype.getType=function(){return"water"},CgsWaterNormals3D.prototype.getMap=function(){return this.map},CgsWaterNormals3D.prototype.setMap=function(e){this.map=e},CgsWaterNormals=function(e){this.feature3D=new CgsWaterNormals3D(e)},CgsInherits(CgsWaterNormals,CgsFeature),CgsRoamLineCone=function(e,t){this.map=t,(this.options=e).overlay&&(this.overlay=new CgsOverlay(e.overlay),this.map.addOverlay(this.overlay),this.overlay.setVisible(e.overlay.setVisible||!0)),e.ribbon&&(this.ribbon=new CgsRibbon(e.ribbon),this.map.addFeature(this.ribbon),this.ribbon.setVisible(e.ribbon.setVisible||!1)),e.model&&(this.model=new CgsModel(e.model),this.map.addFeature(this.model),this.model.setVisible(e.model.setVisible||!0)),e.mask&&(this.mask=new CgsMark(e.mask),e.airLine.model=this.model,e.airLine.mask=this.mask),e.mask&&e.airLine&&(this.airLine=new CgsAirLine(e.airLine),this.airLine.setPoints(e.setPoints),this.airLine.start(),this.airLine.freeze()),this.map.map3D.scene.globe.depthTestAgainstTerrain=e.depthTestAgainstTerrain||!1,e.showPassPath&&e.airLine&&this.airLine.showPassPath(),e.isGround&&(this.isGround=e.isGround),e.isChangeOverlayContext&&(this.isChangeOverlayContext=e.isChangeOverlayContext),e.spreadRadar&&(this.spreadRadar=new CgsSpreadRadar(e.spreadRadar),this.map.addFeature(this.spreadRadar),this.spreadRadar.setVisible(e.spreadRadar.setVisible||!0)),e.manipulates?this.manipulate=e.manipulates:this.manipulate=t.getManipulate(),e.angles&&(this.angles=e.angles),e.line&&(e.line.positions,this.line=new CgsLine(e.line),this.map.addFeature(this.line),this.line.setVisible(e.line||!0))},CgsRoamLineCone.prototype.setViewInModel=function(e){var t,i=e||3;2==i?(t=this.map.getFeatureById(this.model.getId()),this.manipulate.setSelectFeature(t),this.manipulate.setManipulateType(2)):3==i&&(this.manipulate.createAircraftCockpit(),this.manipulate.setSelectFeature(this.model),this.manipulate.setManipulateType(3))},CgsRoamLineCone.prototype.getTerrain=function(e){return this.map.map3D.scene.globe.getHeight(new Cesium.Cartographic.fromDegrees(e[0],e[1]))},CgsRoamLineCone.prototype.updatePosition=function(){var e,t=this.model.getPosition(),i=[];if(this.isChangeOverlayContext){if(this.isGround){var s,o=this.getTerrain(t),a=!0,n=!1,r=void 0;try{for(var l,u=t[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var p=l.value;i.push(p)}}catch(e){n=!0,r=e}finally{try{!a&&u.return&&u.return()}finally{if(n)throw r}}e=i,o?(s=o.toFixed(6),e[2]=o):s=t[2].toFixed(6),$$($$(this.overlay.overlay3D.dom).find("span")[2]).html(t[0].toFixed(6)),$$($$(this.overlay.overlay3D.dom).find("span")[4]).html(t[1].toFixed(6)),$$($$(this.overlay.overlay3D.dom).find("span")[6]).html(s)}}else{var h=!0,c=!1,g=void 0;try{for(var d,m=t[Symbol.iterator]();!(h=(d=m.next()).done);h=!0){p=d.value;i.push(p)}}catch(e){c=!0,g=e}finally{try{!h&&m.return&&m.return()}finally{if(c)throw g}}e=i}this.spreadRadar&&this.spreadRadar.setPosition(e),this.overlay.setPosition(e),this.overlay.setVisible(!0),this.overlay.setPixelOffset(this.options.setPixelOffset)},CgsRoamLineCone.prototype.start=function(){this.airLine.unfreeze(),this.overlay&&this.map.map3D.scene.preUpdate.addEventListener(this.updatePosition,this)},CgsRoamLineCone.prototype.remove=function(e,t){this.map.map3D.scene.preUpdate.removeEventListener(this.updatePosition,this),this.map.removeOverlay(e.overlay),e.model&&this.map.removeFeature(e.model),e.ribbon&&this.map.removeFeature(e.ribbon),e.spreadRadar&&this.map.removeFeature(e.spreadRadar),this.map.map3D.scene.globe.depthTestAgainstTerrain=!1,e.airLine&&(e.airLine.hidePassPath(),e.airLine.hidePath(),e.airLine.stop()),this.map.manipulate.setLocateFlag(!1),t&&t.setManipulateType(1),this.map.setCurrentTime(void 0),this.map.setMultiplier(1),this.map.setShadowVisible(!1)},CgsRoamLineCone.prototype.stop=function(){this.airLine.freeze()};